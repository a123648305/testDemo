(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1543],{26392:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"html-065e5c"},88183:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"html-b1e61a"},90940:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"html-b94486"},61543:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(81506),s=i.n(n),t=i(85354),r=i.n(t),n=i(67294),o=i.n(n),l=i(92360),u=i(29383),c=i(36144),m=i(12518),t=i(67154),h=i.n(t),d=i(5133),f=function(a){function e(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).state={visible:!1,form:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}},t.sure=function(e){e.preventDefault(),t.refs.form.validate(function(e){if(!e)return console.log("error submit!!"),!1;e=t.state.form;c.h.post("/thirdauth/zhihu/userpwdcheck",h()({},e)).then(function(e){2e4===e.data.code&&t.add()})})},t}r()(e,a);var t=e.prototype;return t.show=function(){this.setState({visible:!0})},t.onChange=function(e,t){var n;this.setState({form:Object.assign(this.state.form,((n={})[e]=t,n))})},t.add=function(){var t=this,e=this.state.form;c.h.post("/thirdauth/add",h()({platformType:"ZHIHU"},e)).then(function(e){t.resetForm(),d.Z.success("授权成功"),t.props.done()})},t.resetForm=function(){this.refs.form.resetFields(),this.setState({visible:!1,form:{username:"",password:""}})},t.componentDidMount=function(){},t.render=function(){var e=this,t=this.state.form;return o().createElement(l.Dialog,{className:"authorizationWrap",title:"",size:"tiny",style:{width:"460px"},visible:this.state.visible,onCancel:function(){return e.setState({visible:!1})}},o().createElement("div",{className:"authorization"},o().createElement("div",{className:"img"},o().createElement("img",{src:i(90940),alt:""})),o().createElement("p",null,"账号授权"),o().createElement("span",null,"请填写以下信息"),o().createElement(l.Dialog.Body,null,o().createElement(l.Form,{model:t,ref:"form",rules:this.state.rules},o().createElement(l.Form.Item,{label:"",prop:"username"},o().createElement(l.Input,{value:t.username,placeholder:"用户名",onChange:this.onChange.bind(this,"username")})),o().createElement(l.Form.Item,{label:"",prop:"password"},o().createElement(l.Input,{value:t.password,placeholder:"密码",type:"password",onChange:this.onChange.bind(this,"password")}))))),o().createElement(l.Dialog.Footer,{className:"authorizationFooter"},o().createElement(l.Button,{onClick:function(){return e.setState({visible:!1})}},"取 消"),o().createElement(l.Button,{type:"primary",onClick:this.sure},"确 定")))},e}(n.Component),p=function(a){function e(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).state={visible:!1,form:{username:"",smscode:""},rules:{username:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:function(e,t,n){/^1[34578]\d{9}$/.test(t)?n():n(new Error("请输入正确手机号"))},trigger:"blur"}],smscode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},disableButton:!1,time:60,timing:""},t.sure=function(e){e.preventDefault(),t.refs.form.validate(function(e){if(!e)return console.log("error submit!!"),!1;e=t.state.form;c.h.post("/thirdauth/baidu/smscodecheck",h()({},e)).then(function(e){2e4===e.data.code&&t.add()})})},t}r()(e,a);var t=e.prototype;return t.timing=function(){var t=this,e=setInterval(function(){var e=--t.state.time;t.setState({time:e}),0==e&&(clearInterval(t.state.timing),t.setState({time:60,timing:"",disableButton:!1}))},1e3);this.setState({timing:e})},t.show=function(){this.setState({visible:!0})},t.onChange=function(e,t){var n;this.setState({form:Object.assign(this.state.form,((n={})[e]=t,n))})},t.getCode=function(){var n=this;this.refs.form.validateField("username",function(e,t){if(e)return console.log("error submit!!"),!1;e=n.state.form;c.h.post("/thirdauth/baidu/userpwdcheck",{username:e.username}).then(function(e){2e4===e.data.code&&(d.Z.success("发送成功"),n.setState({disableButton:!0}),n.timing())})})},t.add=function(){var t=this,e=this.state.form;c.h.post("/thirdauth/add",h()({platformType:"BAIDU"},e)).then(function(e){t.resetForm(),d.Z.success("授权成功"),t.props.done()})},t.resetForm=function(){this.refs.form.resetFields(),this.setState({visible:!1,form:{username:"",smscode:""}})},t.componentDidMount=function(){},t.render=function(){var e=this,t=this.state.form;return o().createElement(l.Dialog,{className:"authorizationWrap",title:"",size:"tiny",style:{width:"460px"},visible:this.state.visible,onCancel:function(){return e.setState({visible:!1})}},o().createElement("div",{className:"authorization"},o().createElement("div",{className:"img"},o().createElement("img",{src:i(26392),alt:""})),o().createElement("p",null,"账号授权"),o().createElement("span",null,"请填写以下信息"),o().createElement(l.Dialog.Body,{className:"tieba"},o().createElement(l.Form,{model:t,ref:"form",rules:this.state.rules},o().createElement(l.Form.Item,{label:"",prop:"username"},o().createElement(l.Input,{value:t.username,placeholder:"手机号",onChange:this.onChange.bind(this,"username")})),o().createElement(l.Form.Item,{label:"",prop:"smscode",className:"codeInput"},o().createElement(l.Input,{value:t.smscode,placeholder:"验证码",onChange:this.onChange.bind(this,"smscode")})),o().createElement(l.Button,{disabled:this.state.disableButton,onClick:this.getCode.bind(this),type:"primary"},this.state.disableButton?this.state.time+"秒后可重发":"获取短信验证码")))),o().createElement(l.Dialog.Footer,{className:"authorizationFooter"},o().createElement(l.Button,{onClick:function(){return e.setState({visible:!1})}},"取 消"),o().createElement(l.Button,{type:"primary",onClick:this.sure},"确 定")))},e}(n.Component),a=function(a){function e(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(r=a.call.apply(a,[this].concat(t))||this).state={data:null,columns:[{label:"第三方平台",prop:"platformTypeStr"},{label:"第三方用户名",prop:"name",render:function(e){return o().createElement("div",null,e.platformUsername||"暂无")}},{label:"所有者",prop:"username"},{label:"授权日期",render:function(e){return o().createElement("div",null,e.createdAt.replace("T"," ").substring(0,11))}},{label:"过期时间",prop:"name",render:function(e){return o().createElement("div",null,e.expiredAt&&e.expiredAt.replace("T"," ").substring(0,11))}},{label:"状态",prop:"statusStr"},{label:"操作",render:function(e,t,n){return o().createElement("div",{className:"operate"},o().createElement("a",{href:"javascript:;",className:"operation_columns",onClick:r.delete.bind(s()(r),e.id)},"删除"))}}]},r.getList=function(e){c.h.post("/thirdauth/list",{projectId:r.state.id}).then(function(t){r.setState({data:null},function(e){return r.setState({data:t.data.result})})})},r.handleAuthorizationWeiBo=function(e){c.h.get("/weibo/apply").then(function(e){window.open(e.data.result)})},r.authorization=function(e){r.refs[e].show()},r}r()(e,a);var t=e.prototype;return t.componentDidMount=function(){this.getList()},t.delete=function(e){var t=this;l.MessageBox.confirm("确认删除第三方授权?","提示",{type:"warning"}).then(function(){c.h.post("/thirdauth/delete",{id:e}).then(function(e){t.getList()})})},t.finish=function(){this.getList()},t.render=function(){var t=this,e=this.state,n=e.data,r=(e.id,e.columns);e.dialogVisible,e.formZhiHu;return o().createElement("div",null,o().createElement(m.Z,{title:"授权管理"}),o().createElement("div",{className:"top-bar "},o().createElement("div",{className:"wrap authorization-wrap"},"点击图标授权平台账号"),o().createElement("ul",{className:"authorization-platform"},o().createElement("li",{onClick:this.handleAuthorizationWeiBo},o().createElement("img",{src:i(88183),alt:"微博",title:"微博"})),o().createElement("li",{onClick:function(e){return t.authorization("zhihu")}},o().createElement("img",{src:i(90940),alt:"知乎",title:"知乎"})),o().createElement("li",{onClick:function(e){return t.authorization("tieba")}},o().createElement("img",{src:i(26392),alt:"贴吧",title:"贴吧"})))),o().createElement(u.Z,{columns:r,data:n}),o().createElement(f,{ref:"zhihu",done:this.finish.bind(this)}),o().createElement(p,{ref:"tieba",done:this.finish.bind(this)}))},e}(n.Component)}}]);