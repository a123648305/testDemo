(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8651],{48651:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var t=a(67154),o=a.n(t),t=a(85354),i=a.n(t),m=a(67294),g=a.n(m),h=a(92360),c=a(5133),f=a(29383),r=a(36144),C=a(55815),s=a(61193),d=a(61409),u=a(35239),p=s.Z.hasAuthority("PROJECT_EDIT")||s.Z.hasAuthority("PROJECT_DELETE"),n=function(n){function e(e){var l=n.call(this,e)||this;l.fetchTopicValueList=function(){var e=l.state,t=e.topicId,a=e.pageIndex,n=e.pageSize,o=e.sortName,i=e.sortType;l.setState({loading:!0},function(){r.h.post("/project/config/value/list",{projectConfigId:t,configValueIdList:[],pageIndex:a,pageSize:n,sortModelList:[{sortName:o,sortType:i},{sortName:"CONFIG_VALUE",sortType:"DESC"}]}).then(function(e){var t,a;2e4===e.data.code&&(a=(t=e.data.result).list,e=t.total,t.emptyCount,l.setState({data:a,total:e}))}).finally(function(){return l.setState({loading:!1})})})},l.handleSort=function(e){var t=e.prop,e=e.order;l.setState({sortName:t?"configValue"===t?"CONFIG_VALUE":"COUNT":"CREATED_AT",sortType:"ascending"===e?"ASC":"DESC"},function(){return l.fetchTopicValueList(!0)})},l.switchPage=function(e){l.setState({pageIndex:e},function(){return l.fetchTopicValueList(!0)})},l.switchPageSize=function(e){l.setState({pageSize:e,pageIndex:1},function(){return l.fetchTopicValueList(!0)})},l.handleNameChange=function(e){var t=l.state.targetTopicValue;l.setState({targetTopicValue:o()({},t,{name:e})})},l.handleConfirm=function(){switch(l.state.dialogType){case"add":l.handleAddTopicVal();break;case"rename":l.handleRenameTopicVal();break;case"delete":l.handleDeleteTopicVal()}},l.handleCancel=function(){l.setState({dialogVisible:!1,targetTopicValue:{id:"",name:""}})},l.handleAddTopicVal=function(){var e=l.state,t=e.targetTopicValue.name,e=e.topicId;0!==t.trim().length?r.h.post("/project/config/value/add",{id:e,name:t,parentId:null}).then(function(e){2e4===e.data.code&&(c.Z.success("添加成功"),l.handleCancel(),l.fetchTopicValueList(!1))}):c.Z.warning("请输入主题值名称")},l.handleRenameTopicVal=function(){var e=l.state.targetTopicValue,t=e.id,e=e.name;0!==e.trim().length?r.h.post("/project/config/value/update",{id:t,configValue:e}).then(function(e){2e4===e.data.code&&(c.Z.success("更新成功"),l.fetchTopicValueList(!1),l.handleCancel())}):c.Z.warning("请输入主题值名称")},l.handleDeleteTopicVal=function(){var e=l.state.targetTopicValue.id;r.h.post("/project/config/value/delete",{id:e}).then(function(e){2e4===e.data.code&&(c.Z.success("删除成功"),l.fetchTopicValueList(!1),l.handleCancel())})},l.goLinkList=function(e){var t,a;e&&(t=l.state.topicId,(a=u.t.get(u.V.connectionFilter)?JSON.parse(u.t.get(u.V.connectionFilter)):{filterModel:{}}).filterModel.connConfig=[{id:t,values:[e]}],u.t.set(u.V.connectionFilter,JSON.stringify(a)),d.mW.push({pathname:"/account/project/comment"}))};var t,a=e.location.state;return l.state={title:(t={title:a.name},e=t.title,t=t.url,[{title:"所有项目",url:"/account/project"},{title:u.t.get(u.V.backProjectConfig).name,url:"/account/project/preview"},{title:"主题管理",url:"/account/project/topic"},{title:e,url:t}]),topicId:a.id,topicName:a.name,targetTopicValue:{id:"",name:""},dialogType:"",dialogVisible:!1,pageIndex:1,pageSize:20,total:0,loading:!1,data:[],sortName:"CREATED_AT",sortType:"DESC",columns:p?[{label:"",prop:"paddingLeft",width:50},{label:"主题值",prop:"configValue",sortable:"custom"},{label:"链接数",sortable:"custom",prop:"userConnectionCount",render:function(e){return g().createElement("span",{className:e.id?"operation_columns":"",onClick:function(){return l.goLinkList(e.id)}},e.userConnectionCount)}},{label:"操作",prop:"operate",render:function(e,t,a){return g().createElement("div",{className:"operations"},s.Z.hasAuthority("PROJECT_EDIT")&&e.id&&g().createElement(h.Button,{type:"text",className:"operation_columns",onClick:function(){return l.setState({dialogType:"rename",dialogVisible:!0,targetTopicValue:{id:e.id,name:e.configValue}})},disabled:e.configValue.includes("空值")},"重命名"),s.Z.hasAuthority("PROJECT_EDIT")&&e.id&&g().createElement(h.Button,{type:"text",className:"operation_columns",onClick:function(){return l.setState({dialogType:"delete",dialogVisible:!0,targetTopicValue:{id:e.id,name:e.configValue}})},disabled:e.configValue.includes("空值")},"删除"))}}]:[{label:"",prop:"paddingLeft",width:50},{label:"主题值",prop:"configValue",sortable:"custom"},{label:"链接数",sortable:"custom",prop:"userConnectionCount",render:function(e){return g().createElement("span",{className:"operation_columns",onClick:function(){return l.goLinkList(e.id)}},e.userConnectionCount)}}]},l}i()(e,n);var t=e.prototype;return t.componentDidMount=function(){this.fetchTopicValueList(!0)},t.render=function(){var e=this,t=this.state,a=t.data,n=t.title,o=t.columns,i=t.total,l=t.loading,c=t.pageIndex,r=t.pageSize,s=t.dialogType,d=t.dialogVisible,u=t.targetTopicValue,p=t.topicName,t=document.documentElement.clientHeight-46-78-24;return g().createElement("div",{className:"flex-col"},g().createElement("div",{className:"flex-other container"},g().createElement(C.Z,{title:n,rightContent:g().createElement(h.Button,{type:"primary",onClick:function(){return e.setState({dialogType:"add",dialogVisible:!0})}},"添加主题值")}),g().createElement("div",{className:"topicValue"},g().createElement("div",{style:{minHeight:t}},g().createElement(h.Loading,{loading:l,text:"拼命加载中"},g().createElement(f.Z,{columns:o,data:a,total:i,pagePosition:"down",pageSize:r,currentPage:c,onPage:this.switchPage,onSortChange:this.handleSort,rowClassName:function(e){return e.id?"":"highlight-row"},pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,notLimit:!0}))),g().createElement(h.Dialog,{title:"rename"===s?"重命名主题值":"add"===s?"添加主题值":"",size:"tiny",visible:d,onCancel:function(){return e.handleCancel()},customClass:"toggle"===s?"without-padding-dialogbody":"",lockScroll:!0},g().createElement(h.Dialog.Body,null,"delete"===s&&g().createElement(m.Fragment,null,g().createElement("div",{className:"dialog-title"},g().createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"是否删除该主题值？"),g().createElement("div",{className:"delete-tips"},"删除",g().createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"“",u.name,"”"),"后，原本标记为",g().createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"“",u.name,"”"),"的提数任务将在",p,"这个主题上默认自动归为",g().createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"“空值”"),"。")),("add"===s||"rename"===s)&&g().createElement(m.Fragment,null,g().createElement("div",{className:"form-item"},g().createElement("label",null,"主题值名称"),("add"===s||"rename"===s)&&g().createElement(h.Input,{value:u.name,placeholder:"请输入主题值名称",onChange:this.handleNameChange})))),g().createElement(h.Dialog.Footer,{className:"dialog-footer"},g().createElement(h.Button,{type:"primary",onClick:this.handleConfirm},"delete"===s?"是":"确定"),!("add"===s)&&g().createElement(h.Button,{onClick:function(){return e.handleCancel()}},"delete"===s?"否":"取消"))))))},e}(m.PureComponent)}}]);