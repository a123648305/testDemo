(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[390],{10805:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});const n=a.p+"html-79e5bc"},59132:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var t=a(67294),p=a.n(t),u=a(43036),d=a(25713),h=a(39432),t=a(45697),t=a.n(t),m=a(8201),a=function(e){var t=e.title,a=void 0===t?"":t,n=e.data,r=e.titleOverlay,i=e.titleSelector,o=e.children,s=e.onMoreClick,l=e.moreOptions,c=e.className,t=e.status,n=(e.id,!(0,m.P)(n));return p().createElement("div",{className:"yt_dashboard_chart_title_wrapper "+(c||"")},p().createElement("span",{className:"chart_title"},n&&p().createElement("span",{className:"chart_title_name"},a),(i||r)&&p().createElement("span",{className:"chart_title_suffix",style:{marginLeft:n?0:(0,h.jD)(a)+14+(i?14:0)}},!!i&&i,r&&p().createElement(u.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:r},p().createElement("i",{className:"icon-cem_file1"})))),p().createElement("span",{className:"chart_title_buttons"},o,s&&p().createElement(d.Z,{disabled:t||!1,disableType:["copy","edit"],panelOverlay:"出于某种原因，如相关负责人要求\r下架，该图表模板已下架，你可以\r去添加能够满足相同分析意图的图\r表。如果你仍需要该图表，请联系\r系统管理员。",onClick:s,options:l})))};const n=a;a.propTypes={data:t().any,title:t().string,titleOverlay:t().string,titleSelector:t().node,onMoreClick:t().func,moreOptions:t().array}},37957:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Yt});var a=s(85354),i=s.n(a),n=s(67294),E=s.n(n),o=s(13047),l=s(52314),h=s(36144),r=s(53281),c=s(67154),_=s.n(c),g=s(92360),p=function(r){function e(){for(var t,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(t=r.call.apply(r,[this].concat(a))||this).state={value:""},t.getValue=function(){return t.state.value},t.change=function(e){t.setState({value:e})},t}i()(e,r);var t=e.prototype;return t.componentDidMount=function(){},t.render=function(){var e=this.props.title,t=this.state.value;return E().createElement(g.Form.Item,{label:"标题",className:"tool-title"},E().createElement(g.Input,{onChange:this.change,placeholder:"请输入标题（2-20字符）",value:t||e}))},e}(n.Component),u=s(80157),d=(s(66161),function(r){function e(){for(var a,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(a=r.call.apply(r,[this].concat(t))||this).width=4,a.height=4,a.isSingle=!1,a.type=null,a.state={projectId:null,projects:[]},a.apply=function(){var e=a.refs.filter.getParams(),t=a.refs.title.props.title;return""!==a.refs.title.state.value&&(t=a.refs.title.state.value),e.project=e.project||[a.state.projectId],{type:a.type,title:t,filter:e}},a}i()(e,r);var t=e.prototype;return t.componentDidMount=function(){var t=this;h.h.post("/projects/list").then(function(e){e=e.data.result.list;t.setState({projects:e,projectId:t.state.projectId||e&&e[0]&&e[0].id})})},t.componentWillReceiveProps=function(e){this.state.projectId;var t,a=this.props.config.config;a&&a.widget&&a.widget.projectId&&(t=a.widget.projectId,this.setState({projectId:t}))},t.render=function(){var e=this.props.config,t=e.filter,a=e.config,e=a?a.widget.projectId:"",t={filter:t.filter(function(e){return"project"!==e}),type:"dialog",model:"WIDGET",projectId:e,aspect:0<=t.indexOf("aspect"),selectConfig:a&&a.widget?a.widget.filterModel:{}};return E().createElement("div",{className:"tool-wrap"},E().createElement(p,{ref:"title",title:a?a.title:""}),E().createElement(u.Z,_()({ref:"filter"},t)))},e}(n.Component)),m=s(84948),f=s(29531),y=s.n(f),v=s(78436),t={widget:function(n){function e(){for(var s,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(s=n.call.apply(n,[this].concat(t))||this).getChartData=function(){var e=s.state,t=e.total,a=e.today,e=e.avg;s.downloadExcel({titles:["数据总量","今日数据量","平均每天数据量"],data:[[t,a,e]]})},s.buildBody=function(){var e=s.state.json;return e&&"string"!=typeof e?E().createElement("div",{className:"widget-body num-chart",ref:"numChart"},E().createElement("div",null,E().createElement(m.Z,{col:"md-12"},E().createElement("div",{className:"num-body",ref:"total"},s.buildNum(s.state.total,2)))),E().createElement("div",null,E().createElement(m.Z,{col:"md-6"},E().createElement("div",{className:"num-sub-title"},"今日数据量"),E().createElement("div",{className:"num-sub-body",ref:"today"},s.buildNum(s.state.today,2))),E().createElement(m.Z,{col:"md-6"},E().createElement("div",{className:"num-sub-title"},"平均每天数据量"),E().createElement("div",{className:"num-sub-body",ref:"avg"},s.buildNum(s.state.avg,2))))):E().createElement("div",{className:"widget-body"},E().createElement(v.Z,{ref:"chart",className:"widget-chart"}))},s.buildChart=function(){var e,t,a,n,r,i,o=s.state.json;o?"string"!=typeof o?(e=(n=s.state).total,r=n.today,i=n.avg,t=o.total||0,a=o.avgDay||0,n=o.today||0,e===t&&r===n&&i===a||(r=s.refs.numChart.offsetWidth/5,i=s.refs.numChart.offsetHeight/3,document.documentElement.style.fontSize=(r<=24?24:i<=r?i:r)+"px",document.body.style.fontSize="14px",s.setState({total:t,today:n,avg:a}))):s.refs.chart.setEmptyOption(o):s.refs.chart.loading()},s}i()(e,n);var t=e.prototype;return t.setHost=function(e){this.host=e},t.componentWillMount=function(){this.setState({title:"数据量",color:"#B0D3BF",subColor:"#333"})},t.downloadChart=function(t){var a=this;y()(this.refs.widget,{background:"#fff",onrendered:function(e){e=e.toDataURL("png");a.downloadFile(t,e)}})},e}(r.Z),tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).type="COUNTER_NUM",e}return i()(e,r),e}(d)},a=s(81506),C=s.n(a),b=function(r){function e(){for(var t,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(t=r.call.apply(r,[this].concat(a))||this).change=function(e){t.props.changeProject(e)},t}return i()(e,r),e.prototype.render=function(){var e=this.props,t=e.value,e=e.selectAll;return E().createElement(g.Form.Item,{label:"项目"},E().createElement(g.Select,{value:t,onChange:this.change,placeholder:""},e&&e.map(function(e,t){return E().createElement(g.Select.Option,{key:t,label:e.name,value:e.id},e.name)})))},e}(n.Component),O=s(38425),w=s(24473),S=function(r){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=r.call.apply(r,[this].concat(t))||this).clickTopic=function(t){var e=n.props.value,a=[];e.indexOf(t)<0?(e.map(function(e){return a.push(e)}),a.push(t)):e.filter(function(e){return e!==t}).map(function(e){return a.push(e)}),n.props.changeTopics(a)},n}return i()(e,r),e.prototype.render=function(){var a=this,e=this.props,t=e.selectAll,n=e.value,r=e.projectId,e=t?(r?t.filter(function(e){return e.id===r}):t)[0]:null;return E().createElement(g.Form.Item,{label:"主题"},t&&e&&e.topics.map(function(e,t){return E().createElement(w.Z,{key:t,onChange:function(){a.clickTopic(e.id)},value:e.id,checked:0<=n.indexOf(e.id)},e.name)}))},e}(n.Component),T=function(r){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=r.call.apply(r,[this].concat(t))||this).selectSource=function(t){var e=n.props.value,a=[];e.indexOf(t)<0?(e.map(function(e){return a.push(e)}),a.push(t)):e.filter(function(e){return e!==t}).map(function(e){return a.push(e)}),n.props.changeSources(a)},n}return i()(e,r),e.prototype.render=function(){var a=this,e=this.props,t=e.selectAll,n=e.value,r=e.projectId,t=t?(r?t.filter(function(e){return e.id===r}):t)[0]:null;return E().createElement(g.Form.Item,{label:"数据来源"},t&&t.sources.map(function(e,t){return E().createElement(w.Z,{key:t,onChange:function(){a.selectSource(e.id)},value:e.id,checked:0<=n.indexOf(e.id)},e.name)}))},e}(n.Component),c=(n.Component,s(61409),{widget:function(n){function e(){for(var p,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(p=n.call.apply(n,[this].concat(t))||this).getChartData=function(){var e,t;p.refs.chart&&p.refs.chart.myChart&&(e=p.refs.chart.myChart.getOption().series,t=[],e.map(function(e){return e.data.map(function(e){return t.push(e)})}),p.downloadExcel({titles:["日期","数量","类别"],data:t}))},p.buildChart=function(){var t,a,e,n,r,i,o,s=p.state,l=s.colors,c=s.json;c?"string"!=typeof(c="string"!=typeof c&&(0===c.length||0===c[0].buckets.length)?"没有数据可用":c)?(p.jsonStr===JSON.stringify(c)?p.refs.chart.myChart.resize():p.jsonStr=JSON.stringify(c),o=c[0].buckets.map(function(e){return e.date}),t=C()(p),a={},(e=c.map(function(t){return a[t.name]=a[t.name]||0,{name:t.name,data:t.buckets.map(function(e){return a[t.name]+=e.count||0,[e.date,e.count,t.name,t.id]}),type:"line",smooth:.4,smoothMonotone:"none",stack:"line",areaStyle:{opacity:1}}})).sort(function(e,t){return a[e.name]-a[t.name]}),n=8*(2*Math.max.apply(Math,Object.keys(a).map(function(e){return e.length}))),r=8*Math.max.apply(Math,Object.keys(a).map(function(e){return(""+a[e]).length})),s={orient:"vertical",width:180,right:10,data:e.map(function(e){return e.name}).reverse(),formatter:function(e){return"{a|"+e+"}{b|"+t.buildNum(a[e],2)+"}"},textStyle:{rich:{a:{fontSize:14,width:20+n},b:{fontSize:14,width:r,align:"right"}}},type:"scroll"},i=[],s.data.map(function(e,t){i.push(l[t%l.length])}),o={tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross",label:{margin:10,formatter:function(e){return"number"==typeof e.value?e.value.toFixed(0):e.value}}},formatter:function(e){if(e&&e.length)return e[0].name+e.map(function(e){return"<br/>"+e.marker+e.seriesName+"："+e.value[1]}).reverse().join("")}},legend:s,series:e,color:i.reverse(),grid:{containLabel:!0,left:30,right:n+r+100,bottom:10,top:25},yAxis:[{type:"value",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{formatter:function(e){return t.buildNum(e,1)}},splitLine:{show:!0,lineStyle:{type:"dashed"}}}],xAxis:[{type:"category",boundaryGap:!1,data:o,axisTick:{lineStyle:{color:"#999"}},axisLine:{show:!1},axisLabel:{color:"#333",margin:15}}]},p.refs.chart.setOption(o,!0)):p.refs.chart.setEmptyOption(c):p.refs.chart.loading()},p.myChartClick=function(e){var t;e&&(t=p.getParams(e),e.data[0],e.data[2],-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(t))))},p.getParams=function(e){var t,a,n,r=p.props.getParams();return r.id=p.props.id,r.type=p.type,r.projectId=p.projectId,e&&(a=e.data[0],t=e.data[3],e=n=a,"MONTH"==r.dateFilter.dateGroupType&&((n=(a=s(30381)(a,"YYYY-MM")).format("YYYY-MM-DD"))<r.dateFilter.from&&(n=r.dateFilter.from),(e=a.add(1,"M").add(-1,"d").format("YYYY-MM-DD"))>r.dateFilter.to&&(e=r.dateFilter.to)),r.dateFilter.from=n,r.dateFilter.to=e,r.filterModel.source=[t]),r},p}return i()(e,n),e.prototype.componentWillMount=function(){this.setState({colors:this.colors.normal})},e}(r.Z),tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).type="COUNTER_TIME_STACK_AREA_LINE",e}return i()(e,r),e}(d)}),x=s(29030),N=s(43036),f=(s(26470),{widget:function(n){function e(){for(var f,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(f=n.call.apply(n,[this].concat(t))||this).getImgFileObj=function(e){try{return s(41484)("./source_"+x.z[e]+".png")}catch(e){return s(10805)}},f.buildChart=function(){var e=f.state.json,n=f.state.colors;if(e)if("string"!=typeof(e="string"!=typeof e&&0===e.length?"没有数据可用":e)){f.jsonStr===JSON.stringify(e)?f.refs.chart.myChart.resize():f.jsonStr=JSON.stringify(e);for(var r=0,t=e.slice(0,10).map(function(e){return r+=e.doc_count,{name:e.sourceName,value:e.doc_count,key:e.key}}),a=f.refs.chart.myChart,i=a.getWidth(),o=a.getHeight(),s=1,l=o/s,c=80<l,p=c?l-24:l,u=Math.round(i/p);t.length>s*u;)p=(c=80<(l=o/++s))?l-24:l,u=Math.round(i/p),t.length<=(s-1)*u&&(c=80<(l=o/--s));var p=i/(1===s?t.length:u),d=Math.min(p,c?l-24:l),h=Math.max(l-p,0),m=(Math.max(p-l,0),C()(f)),a=t.filter(function(e,t){return t<=u*s}).map(function(t,e){var a=f.colors.normal[e%f.colors.normal.length];return{type:"pie",radius:[.55*d/2,.6*d/2],center:[d*((e+1)%(u+1)-.5),(d+h)*(Math.ceil((e+2)/(u+1))-.5)],clockwise:!1,tooltip:{formatter:function(e){return e.marker.replace(n[0],a)+" "+t.name+"："+t.value}},data:[{value:r-t.value,name:"",sourceName:t.name,source:t.key,label:{normal:{show:!0,position:"center",backgroundColor:{image:x.z[t.name]?f.getImgFileObj(t.name):null},padding:d/8,formatter:function(){return""}}},itemStyle:{normal:{color:n[0]},emphasis:{color:n[0]}}},{name:t.name,sourceName:t.name,source:t.key,value:t.value,label:{normal:{show:c,padding:[6,0,0,0],position:"center",formatter:function(){return"{a|\n}{b|"+m.buildNum(t.value,2)+"}"},rich:{a:{height:d},b:{fontSize:20,color:"#333",fontWeight:"bold"}}}},itemStyle:{normal:{color:a},emphasis:{color:a}}}],startAngle:270,labelLine:{normal:{show:!1},emphasis:{show:!1}},legendHoverLink:!1,hoverAnimation:!1}});f.refs.chart.setOption({tooltip:{confine:!0},series:a},!0)}else f.refs.chart.setEmptyOption(e);else f.refs.chart.loading()},f.getChartData=function(){var e=f.state.data;f.downloadExcel({titles:["资源","数量"],data:e.map(function(e){return[e.name,e.value]})})},f.myChartClick=function(e){e&&(e=e.data.source,e=f.getParams(e),-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(e))))},f.getParams=function(e){var t=f.props.getParams();return t.id=f.props.id,t.type=f.type,t.projectId=f.projectId,e&&(t.filterModel=t.filterModel||{},t.filterModel.source=[e]),t},f.buildTop=function(){var e=f.state.showTitle,t=f.props.name;return E().createElement("div",{className:"widget-top"},E().createElement("div",{className:"widget-title",style:{height:24,lineHeight:"24px"}},E().createElement("span",{style:{marginRight:8}},e?t:""),E().createElement(N.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:E().createElement("div",null,"如果“无效数据”模块为开启“显示无效数据”，则不包含被标记为无效数据的数据。",E().createElement("br",null),"注：由于各平台允许查看的评论数据不会超过一定的页数，会导致部分较早的数据无法提取。")},E().createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative"}}))),f.buildTool())},f}return i()(e,n),e.prototype.componentWillMount=function(){this.setState({colors:["#F0F2F5",this.colors.normal[0]],data:[],count:0,showMore:!1})},e}(r.Z),tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).type="COUNTER_PIES_BY_SOURCE",e}return i()(e,r),e}(d)}),a=(s(89777),{CountNum:t,CountTimeStackAreaLine:c,CountPiesBySource:f,CounterWord:{widget:function(n){function e(){for(var l,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(l=n.call.apply(n,[this].concat(t))||this).getChartData=function(){var e;l.refs.chart&&l.refs.chart.myChart&&(e=l.refs.chart.myChart.getOption().series[0].data.map(function(e){return[e.name,e.value]}),l.downloadExcel({titles:["词语","数量"],data:e}))},l.buildChart=function(){var e,t,a,n,r,i=l.state,o=i.colors,s=i.json;s?"string"!=typeof(s="string"!=typeof s&&0===s.length?"没有数据可用":s)?(n=l.refs.chart.myChart,l.jsonStr===JSON.stringify(s)?n.resize():l.jsonStr=JSON.stringify(s),e=n.getHeight(),t=n.getWidth(),a=0,i=Math.min(4,Math.max.apply(Math,s.map(function(e){return e.count}))),s.map(function(e){return a+=12*e.name.length*12*e.count*e.count}),n=Math.floor(12*s[0].count*Math.sqrt(12*i*(e*t)/a)),(n={type:"wordCloud",sizeRange:[12,n=.9*Math.min(e,t/i,n,112)],rotationRange:[0,0],gridSize:12,textPadding:10,width:"100%",height:"100%",drawOutOfBound:!1,textStyle:{normal:{color:function(e){return o[e.dataIndex%o.length]}}}}).data=s.map(function(e){return{name:e.name,value:e.count}}),r=C()(l),l.refs.chart.setOption({tooltip:{formatter:function(e){return e.marker+e.name+"："+r.buildNum(e.value,2)}},series:[n]},!0)):l.refs.chart.setEmptyOption(s):l.refs.chart.loading()},l.myChartClick=function(e){e&&(e=e.name,e=l.getParams(e),-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(e))))},l.getParams=function(e){var t=l.props.getParams();return t.id=l.props.id,t.type="COUNTER_WORD",t.projectId=l.projectId,e&&(t.filterModel=t.filterModel||{},t.filterModel.content=[{contain:[e]}]),t},l}return i()(e,n),e.prototype.componentWillMount=function(){this.setState({colors:this.colors.normal})},e}(r.Z),tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).type="COUNTER_WORD",e}return i()(e,r),e}(d)}}),t={widget:function(n){function e(){for(var l,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(l=n.call.apply(n,[this].concat(t))||this).getChartData=function(){var e=l.refs.chart.myChart.getOption(),t=[];e.series.map(function(e){return e.data.map(function(e){return t.push([e.name,e.value])})}),l.downloadExcel({titles:["情感","数量"],data:t})},l.buildChart=function(e){var t,a,n,r,i,o,s=l.state.json;s?"string"!=typeof s?(l.jsonStr===JSON.stringify(s)?l.refs.chart.myChart.resize():l.jsonStr=JSON.stringify(s),n=a=t=0,s.aggregations.score.buckets.map(function(e){1===e.key?t=e.doc_count:-1===e.key?a=e.doc_count:n=e.doc_count}),o=[{name:"正面",value:t},{name:"中性",value:n},{name:"负面",value:a}],i=l.refs.chart.myChart.getHeight(),r=[.8*(i=(r=l.refs.chart.myChart.getWidth())<i?r/2-10:Math.min(i,r)/2-52),i],i={data:o.map(function(e){return e.name}),top:10},o={color:l.state.colors,legend:i,tooltip:{formatter:function(e){return e.marker+" "+e.name+"："+e.value}},series:[{name:"",type:"pie",radius:r,center:["50%","50%"],data:o,label:{normal:{show:!1}},labelLine:{normal:{show:!1}}}]},l.refs.chart.setOption(o,!0)):l.refs.chart.setEmptyOption(s):l.refs.chart.loading()},l.myChartClick=function(e){var t;e&&"series"===e.componentType&&(t=e.name,e=l.getParams(t),l.refs.dataModal.onShow(e,"aspect",t))},l.getParams=function(e){var t=l.props.getParams();return t.id=l.props.id,t.type=l.type,t.projectId=l.projectId,e&&(t.filterModel.escore=["正面"===e?1:"负面"===e?-1:0]),t},l}return i()(e,n),e.prototype.componentWillMount=function(){this.setState({colors:this.colors.emotion})},e}(r.Z),tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).type="EMOTION_PIE",e}return i()(e,r),e}(d)},c={widget:function(n){function e(){for(var o,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(o=n.call.apply(n,[this].concat(t))||this).myChartClick=function(e){var t,a;e&&"series"===e.componentType&&(t=e.name,a=e.seriesName,e=o.getParams(t,a),o.refs.dataModal.onShow(e,"aspect",a+" / "+t))},o.getParams=function(e,t){var a,n,r=o.props.getParams();return r.id=o.props.id,r.type=o.type,r.projectId=o.projectId,e&&(n=e,a=e,"MONTH"===r.dateFilter.dateGroupType&&(n=(n=(e=s(30381)(e,"YYYY-MM")).format("YYYY-MM-DD"))<r.dateFilter.from?r.dateFilter.from:n,a=(a=e.add(1,"M").add(-1,"d").format("YYYY-MM-DD"))>r.dateFilter.to?r.dateFilter.to:a),r.dateFilter.from=n,r.dateFilter.to=a),t&&(r.filterModel.escore=["正面"===t?1:"负面"===t?-1:0]),r},o.getChartData=function(){var e,a;o.refs.chart&&o.refs.chart.myChart&&(e=o.refs.chart.myChart.getOption(),a=[],e.series.map(function(t){return t.data.map(function(e){return a.push([t.name,e[1],e[0]])})}),o.downloadExcel({titles:["情感","数值","日期"],data:a}))},o.buildChart=function(){var r,i,t,e,a,n=o.state.json;n?"string"!=typeof n?o.jsonStr!==JSON.stringify(n)?(o.jsonStr=JSON.stringify(n),a=0<(e=n.aggregations.score.buckets||[]).length?e[0].aggs.dateAgg.buckets.map(function(e){return e.key_as_string}):[],r=[{name:"负面",data:[]},{name:"中性",data:[]},{name:"正面",data:[]}],i={},e.map(function(t){t.aggs.dateAgg.buckets.map(function(e){i[e.key_as_string]=i[e.key_as_string]||{},i[e.key_as_string][t.key]=e.doc_count})}),a.map(function(e){var t=i[e][1]||0,a=i[e][0]||0,n=i[e][-1]||0;r[2].data.push([e,(t/(t+a+n||1)*100).toFixed(2),"正面"]),r[1].data.push([e,(a/(t+a+n||1)*100).toFixed(2),"中性"]),r[0].data.push([e,(n/(t+a+n||1)*100).toFixed(2),"负面"])}),t=[],e={data:["正面","中性","负面"],top:12},r.map(function(e){t.push({type:"bar",stack:"bar",name:e.name,data:e.data,barMaxWidth:40})}),a={tooltip:{trigger:"axis",confine:!0,formatter:function(e){return e[0].name+e.map(function(e){return"<br/>"+e.marker+e.seriesName+"："+e.value[1]+"%"}).reverse().join("")}},series:t,color:o.state.colors,grid:{containLabel:!0,left:30,right:50,bottom:0,top:55},legend:e,yAxis:[{type:"value",axisLine:{show:!0,lineStyle:{color:"#999"}},splitLine:{show:!1},min:0,max:100,axisLabel:{color:"#999",formatter:function(e){return 100<e?"":e+"%"}},axisTick:{show:!1}}],xAxis:[{type:"category",data:a}]},o.refs.chart.setOption(a,!0)):o.refs.chart.myChart.resize():o.refs.chart.setEmptyOption(n):o.refs.chart.loading()},o}return i()(e,n),e.prototype.componentWillMount=function(){this.setState({colors:this.colors.emotion.reverse()})},e}(r.Z),tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).type="EMOTION_TIME_STACK_BAR",e}return i()(e,r),e}(d)},D=s(40086),k=s(49975),A=s(31705),f=s(94184),M=s.n(f),f=s(30381),R=s.n(f);R().locale("zh-cn");var P=[{name:"比例",id:1},{name:"数量",id:2}],t={EmotionPie:t,EmotionTimeStackBar:c,EmotionPieAndTimeStackBar:{widget:function(t){function e(e){var y=t.call(this,e)||this;return y.myChartClick=function(e){var t,a,n,r=y.state.queryTimeType;e&&"series"===e.componentType&&("bar"===e.componentSubType?(n=e.name,t=e.seriesName,a=y.getParams(n,t),-1!==location.pathname.indexOf("overview")?(a.dateFilter.from=a.dateFilter.from.substring(0,10),a.dateFilter.to=a.dateFilter.to.substring(0,10),a.dateFilter.dateGroupType=r,a.dateFilter.quickChoice=a.dateFilter.from.replace("-",".").replace("-",".")+" - "+a.dateFilter.to.replace("-",".").replace("-","."),delete a.headerFilterParamsNew,window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(a)))):y.dataModal.onShow(a,"aspect",t+" / "+n)):(n=e.name,e=y.getParams(null,n),-1!==location.pathname.indexOf("overview")?(e.dateFilter.from=e.dateFilter.from.substring(0,10),e.dateFilter.to=e.dateFilter.to.substring(0,10),e.dateFilter.dateGroupType=r,delete e.headerFilterParamsNew,window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(e)))):y.dataModal.onShow(e,"aspect",n)))},y.getParams=function(e,t){var a,n,r=y.props.getParams(),i=y.state.queryTimeType;return r.id=y.props.id,r.projectId=y.projectId,r.dateFilter.dateGroupType=i,e&&(a=e,n=e,"MONTH"===r.dateFilter.dateGroupType?(a=(i=R()(e)).startOf("month").format("YYYY-MM-DD"),n=i.endOf("month").format("YYYY-MM-DD")):"WEEK"===r.dateFilter.dateGroupType&&(e=e.split("-"),a=(e=R()(e[0]).week(e[1])).startOf("week").format("YYYY-MM-DD"),n=e.endOf("week").format("YYYY-MM-DD")),r.dateFilter.from=a,r.dateFilter.to=n),t&&(r.filterModel.escore=["正面"===t?"1":"负面"===t?"-1":"0"],r.headerFilterParamsNew=[{id:"DEFAULT",values:[{id:"CATEGORY_TYPE",values:["COMMENT"]},{id:"MESSAGE_TYPE",values:["COMMENT_APPEND","MESSAGE_COMMENT"]},{id:"EFFECTIVENESS_TYPE",values:["useful"]},{id:"EMOTION_TYPE",values:["正面"===t?"positive":"负面"===t?"negative":"neutral"]}]}]),r},y.getChartData=function(){var e=y.state,t=e.fxValue,e=e.dateDimensionReady;if(y.chart&&e&&y.chart.myChart){var a,e=y.chart.myChart.getOption(),n={},r=[],t="情感"+t.name+"数据";for(a in e.series.filter(function(e){return""!==e.name}).map(function(e){return e.data.forEach(function(e){n[e[0]]=n[e[0]]||{},n[e[0]][e[2]]=1===y.state.fxValue.id?e[1]+"%":e[1]})}),n)r.push([a,n[a]["正面"],n[a]["中性"],n[a]["负面"]]);y.downloadExcel({titles:["日期","正面","中性","负面"],data:r,name:t})}},y.buildChart=function(){var r,e,i,t,a,n,o,s,l,c,p,u,d,h,m,f=y.state.json,g=y.state.fxValue.id;f?"string"!=typeof(f="string"!=typeof f&&0===f.length?"没有数据可用":f)?(y.jsonStr===JSON.stringify(f)?y.chart.myChart.resize():y.jsonStr=JSON.stringify(f),m=0<(d=f||[]).length?d[0].dataList.map(function(e){return e.time}):[],r=[{name:"负面",data:[]},{name:"中性",data:[]},{name:"正面",data:[]}],e=[{name:"负面",value:0},{name:"中性",value:0},{name:"正面",value:0}],i={},d.forEach(function(t){t.dataList.forEach(function(e){i[e.time]=i[e.time]||{},i[e.time][t.key]=e.total}),"-1"===String(t.key)&&(e[0].value=t.total),"0"===String(t.key)&&(e[1].value=t.total),"1"===String(t.key)&&(e[2].value=t.total)}),m.forEach(function(e){var t=i[e][1]||0,a=i[e][0]||0,n=i[e][-1]||0;r[2].data.push([e,1===g?(t/(t+a+n||1)*100).toFixed(2):t,"正面"]),r[1].data.push([e,1===g?(a/(t+a+n||1)*100).toFixed(2):a,"中性"]),r[0].data.push([e,1===g?(n/(t+a+n||1)*100).toFixed(2):n,"负面"])}),t=[],a=["50%","55%"],n=["68%","80%"],o={data:["正面","中性","负面"],type:"scroll"},h=y.chart.myChart.getWidth(),s=y.chart.myChart.getHeight(),l=h<400?.3*h:120,a[0]=s/2,n[0]=.4*s/2,n[1]=.65*s/2,o.left=Number(s)+20,o.orient="vertical",o.top=40,o.width=l,c=e[2].value,p=e[1].value,u=e[0].value,d=o.width+o.left,o.formatter=function(e){var t="正面"===e?c:"负面"===e?u:p;return"{a|"+e+"}{b|"+(1===g?(t/(c+u+p||1)*100).toFixed(2)+"%":t)+"}"},o.textStyle={padding:[s/10-(h=l<100?12:20)/2,0],rich:{a:{width:.4*l},b:{width:.5*l,fontSize:h,align:"right"}}},r.forEach(function(e){t.push({type:"bar",stack:"bar",name:e.name,data:e.data,legendHoverLink:!1,barMaxWidth:40})}),t.push({name:"",type:"pie",radius:n,center:a,data:e,label:{normal:{show:!1}},labelLine:!1,hoverAnimation:!1}),m={tooltip:{axisPointer:{type:"none"},formatter:function(e){return e instanceof Array?e[0].name+e.map(function(e){return"<br/>"+e.marker+e.seriesName+"："+e.value[1]+(1===g?"%":"")}).reverse().join(""):e.marker+" "+e.name+"："+(1===g?(c+p+u===0?"0.00":(e.value/(c+p+u)*100).toFixed(2))+"%":e.value)}},title:[{text:"通用情感",textStyle:{fontSize:14}},{text:"通用情感趋势",textStyle:{fontSize:14},x:d+70}],series:t,color:y.state.colors,legend:o,grid:{tooltip:{trigger:"axis"},containLabel:!0,left:s+l+100,right:40,bottom:10,top:40},yAxis:[{type:"value",axisLine:{show:!0,lineStyle:{color:"#999"}},splitLine:{show:!1},min:0,max:1===g?100:null,axisLabel:{color:"#999",formatter:function(e){return 1===g?100<e?"":e+"%":e}},axisTick:{show:!1}}],xAxis:[{type:"category",data:m,axisLine:{show:!0,lineStyle:{color:"#999"}},axisLabel:{color:"#999"},axisTick:{show:!1}}]},y.chart.setOption(m,!0)):y.chart.setEmptyOption(f):y.chart.loading()},y.switchDateDimension=function(e){y.setState({queryTimeType:e,dateDimensionReady:!0},function(){y.refreshChart()})},y.switchFx=function(e){y.setState({fxValue:e,loading:!0},function(){return y.setState({loading:!1})})},y.buildTop=function(){var e=y.state,t=e.queryTimeType,a=e.fxValue;return E().createElement("div",{className:"widget-top widget-top-extra",style:{width:"100%",zIndex:1}},E().createElement(N.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:E().createElement("div",null,E().createElement("span",{style:{display:"block"}},"正向：仅表达了正向情绪的评论。"),E().createElement("span",{style:{display:"block"}},"负向：评论中只要包含负向情绪，便被判定为负向评论。"),E().createElement("span",{style:{display:"block"}},"中性：不包含正向或负向情感的评论。"))},E().createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative",left:96}})),E().createElement(A.Z,{style:{float:"right",marginRight:"16px"},onDownChartClick:function(){return y.downloadChart("情感"+a.name+"图")},onDownExcelClick:function(){return y.getChartData()}}),E().createElement(k.Z,{uniqueId:"overview-emotion-saved-date-dimension",defaultValue:t,onChange:y.switchDateDimension,style:{float:"right"}}),E().createElement(D.Z,{style:{float:"right"},list:P,onChange:y.switchFx,value:a,placeholder:E().createElement("i",{className:"icon-cem_fx",style:{fontSize:"18px",fontWeight:"bold"}}),partingLine:!0}))},y.buildBody=function(){return E().createElement("div",{className:"widget-body",style:{minHeight:"216px"}},E().createElement(v.Z,{ref:function(e){return y.chart=e},className:"widget-chart",myChartClick:y.myChartClick}))},y.state={queryTimeType:"DAY",fxValue:P[0],dateDimensionReady:!1},y}i()(e,t);var a=e.prototype;return a.componentWillMount=function(){this.setState({colors:this.colors.emotion.reverse()})},a.render=function(){return E().createElement("div",{ref:"widget",className:M()((this.isCanSetting?"widget-container with-aspect-bar":"widget-container")+" emotion-pie-time-bar-extra")},this.buildTop(),this.buildBody())},e}(r.Z),tool:null}},I=s(85151),j=function(e){function t(){return e.apply(this,arguments)||this}return i()(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.labelOff,n=t.labelOn,r=t.type,i=t.disabled;return E().createElement("div",{className:"label-button"},E().createElement("span",{className:(r?"active":"")+(i?"disabled":""),onClick:function(){return i||e.props.onChange(!0)}},n),E().createElement("span",{className:(r?"":"active")+(i?"disabled":""),onClick:function(){return i||e.props.onChange(!1)}},a))},t}(n.Component),L=s(12234),F=function(e){function t(){return e.apply(this,arguments)||this}return i()(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.editTemp,n=t.handleRemove,r=t.id,i=t.isPercent,o=t.emotion,s=t.showLabel,l=t.showLabelPosition,c=t.sort,p=t.decimal,u=t.avg,d=t.singleEmotion,h=this.props,m=h.changePercent,f=h.changeEmotion,g=h.changeSingleEmotion,y=h.changeLabel,v=h.changeLabelPosition,C=h.changeSort,t=h.changeDecimal,h=h.changeAvg;return E().createElement("div",{className:"aspect-config"},E().createElement("div",{className:"aspect-top"},E().createElement("div",{className:"setting"},E().createElement("div",{className:"chart-opt-more"},E().createElement(L.l,{name:"more"}),E().createElement("ul",{className:"widget-overlay"},E().createElement("li",{onClick:function(){return e.props.downloadChart()}},"导出图片"),E().createElement("li",{onClick:function(){return e.props.getChartData()}},"导出数据"),a&&E().createElement("li",{onClick:function(){return a(r)}},"编辑"),n&&E().createElement("li",{onClick:function(){return n(r)}},"删除"))),E().createElement("div",{className:"chart-opt-menu"},E().createElement(L.l,{name:"top-setting"}),E().createElement("ul",{className:"widget-overlay"},m&&E().createElement("li",null,E().createElement("label",null,"展示方式"),E().createElement(j,{type:i,labelOn:"百分比",labelOff:"数值",onChange:m})),f&&E().createElement("li",{className:"emotion-label"},E().createElement("label",null,"正负面"),E().createElement(I.Jg,{value:0,checked:o[0],onChange:function(e){e=e.target.checked;o[0]=e,o[1]=!e&&!o[1]||o[1],f(o)}},"正面"),E().createElement(I.Jg,{value:1,checked:o[1],onChange:function(e){e=e.target.checked;o[1]=e,o[0]=!e&&!o[0]||o[0],f(o)}},"负面")),h&&E().createElement("li",null,E().createElement("label",null,"平均值"),E().createElement(j,{type:u,labelOn:"展示",labelOff:"不展示",onChange:h})),y&&E().createElement("li",null,E().createElement("label",null,"标签"),E().createElement(j,{type:s,labelOn:"展示",labelOff:"不展示",onChange:y})),v&&s&&E().createElement("li",null,E().createElement("label",null,"标签位置"),E().createElement(j,{type:l,labelOn:"内侧",labelOff:"外侧",onChange:v})),C&&E().createElement("li",null,E().createElement("label",null,"排序"),E().createElement(j,{type:c,labelOn:"升序",labelOff:"降序",onChange:C})),C&&g&&o[0]&&o[1]&&E().createElement("li",null,E().createElement("label",null,"排序"),E().createElement(j,{type:d,labelOn:"正面",labelOff:"负面",onChange:g})),!C&&g&&E().createElement("li",null,E().createElement("label",null,d?"好评率":"差评率"),E().createElement(j,{type:d,labelOn:"好评率",labelOff:"差评率",onChange:g})),t&&E().createElement("li",null,E().createElement("label",null,"显示小数"),E().createElement(j,{type:p,labelOn:"显示",labelOff:"不显示",onChange:t})))))))},t}(n.Component),c={widget:function(n){function e(){for(var m,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(m=n.call.apply(n,[this].concat(t))||this).isCanSetting=!0,m.getChartData=function(){var e,t;m.refs.chart&&m.refs.chart.myChart&&(e=m.refs.chart.myChart.getOption().series,t=[],e.map(function(e){return e.data.map(function(e){e[1]=e[1]?e[1].toFixed(3)+"%":"-",t.push(e)})}),m.downloadExcel({titles:["日期","正面占比","类别","正面数","负面数"],data:t}))},m.buildTop=function(){var e=m.props,t=e.editTemp,a=e.handleRemove,n=e.id,r=e.model,i=e.index,e=(e.store,m.state),i={editTemp:t,handleRemove:a,id:n,model:r,index:i,singleEmotion:e.singleEmotion,avg:e.avg,decimal:e.decimal},e={changeSingleEmotion:function(e){m.setState({singleEmotion:e})},changeAvg:function(e){m.setState({avg:e})},changeDecimal:function(e){m.setState({decimal:e})},refreshChart:m.refreshChart,getChartData:m.getChartData,downloadChart:function(){m.downloadChart("产品趋势")}};return E().createElement("div",{className:"widget-top"},E().createElement(F,_()({key:m.time,ref:"selectBar"},i,e)))},m.myChartClick=function(e){var t,a,n=m.props.name;e&&"series"===e.componentType&&(t=e.data[0],a=[e.seriesId],(a=m.getParams(t,a)).leftName=n,a.aspectTotal=e.data[3]+e.data[4],m.refs.dataModal.onShow(a,"aspect",e.seriesName+" / "+t))},m.getParams=function(e,t){var a,n=m.props.getParams();return n?(n.id=m.props.id,n.type=m.type,n.projectId=m.projectId,n.filters=n.filters||[],t&&(n.filterModel=n.filterModel||{},n.filterModel.analysis=n.filterModel.analysis||{},n.filterModel.analysis.values=t),e&&(t=a=e,"MONTH"===n.dateFilter.dateGroupType&&((a=(e=s(30381)(e,"YYYY-MM")).format("YYYY-MM-DD"))<n.dateFilter.from&&(a=n.dateFilter.from),(t=e.add(1,"M").add(-1,"d").format("YYYY-MM-DD"))>n.dateFilter.to&&(t=n.dateFilter.to)),n.dateFilter.from=a,n.dateFilter.to=t),n):null},m.buildChart=function(){var e=m.state,a=e.json,n=e.singleEmotion,t=e.avg,r=e.decimal;if(a)if("string"!=typeof a){m.jsonStr===JSON.stringify(a)?m.refs.chart.myChart.resize():m.jsonStr=JSON.stringify(a);for(var i={text:a.dataSummary&&Object.keys(a.dataSummary).map(function(e){var t=a.dataSummary[e];return"{a|}{b|   "+e+"}    {st|评论：}{sv|"+t.total+"}{st| - 正面：}{sv|"+t.positive+"}{st|，负面：}{sv|"+t.negative+"}"}).join(" "),textStyle:{rich:{a:{borderColor:"#000",borderWidth:1,height:9},b:{fontSize:14,fontWeight:"bold",color:"#000"},st:{color:"#999"},sv:{fontWeight:500,color:"#000"}}},left:16,top:16},o=[],s=a.dateList,l=a.data.map(function(a){return{id:a.id,connectNulls:!0,name:a.title,data:a.emotions.map(function(e){var t=e.docCount?(n?e.positive:e.negative)/e.docCount*100:null;return!t&&0!==t||o.push(t),[e.strDate,t,a.title,e.positive,e.negative]}),markLine:t?{data:[{type:"average",name:"平均占比",label:{formatter:function(e){return e.value?e.value.toFixed(r?2:0)+"%":""}}}]}:null,type:"line",smooth:.4,smoothMonotone:"none"}}),e=l.map(function(e){return e.name}),c=o.length?Math.max.apply(Math,o):100,p=o.length?Math.min.apply(Math,o):0,u=50<c-p?20:10,d=100,h=0;c+2*u<d;)d-=u;for(;h<p-2*u;)h+=u;s={title:i,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross",label:{formatter:function(e){return"number"==typeof e.value?e.value.toFixed(r?2:0)+"%":e.value}}},formatter:function(e){return e&&e.length?e[0].axisValueLabel+e.map(function(e){var t=e.value&&(e.value[1]||0===e.value[1])?Number(e.value[1]).toFixed(r?2:0)+"%":"（无）";return"<br/>"+e.marker+e.seriesName+"："+t+" （正面："+e.value[3]+"，负面："+e.value[4]+"）"}).join(""):null}},legend:{data:e,type:"scroll",top:44},series:l,color:m.state.colors,grid:{containLabel:!0,left:50,right:100,bottom:20,top:100},yAxis:[{type:"value",min:h,max:d,interval:u,axisLine:{show:!1},splitLine:{show:!1},scale:!0,axisLabel:{showMaxLabel:d<=100}}],xAxis:[{type:"category",boundaryGap:!1,data:s}]};m.refs.chart.setOption(s,!0)}else m.refs.chart.setEmptyOption(a);else m.refs.chart&&m.refs.chart.loading()},m}return i()(e,n),e.prototype.componentWillMount=function(){this.setState({colors:["#61a1f8","#f5dc80","#75c9cb","#e26f7e","#7bc77c","#a677fe"],singleEmotion:!0,avg:!1,decimal:!0})},e}(r.Z),tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).width=12,e.height=8,e.isSingle=!1,e.type="EMOTION_ASPECT_TIME_LINE",e}return i()(e,r),e}(d)},r=function(n){function e(){for(var p,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(p=n.call.apply(n,[this].concat(t))||this).isCanSetting=!0,p.getChartData=function(){var r,e=p.state,t=e.json,i=e.decimal;t&&(r=[],t.map(function(e,t){var a,n=p.refs["chart-"+t];n&&n.myChart&&(t=(n=p.refs["chart-"+t].myChart.getOption().series)[0].data,a=n[1].data,t.map(function(e,t){t=a[t];r.push([e.type,e.name,t.count,t.percent.toFixed(i?2:0)+"%",e.count,e.percent.toFixed(i?2:0)+"%"])}))}),p.downloadExcel({titles:["分析对象","分析指标","正面数量","正面占比","负面数量","负面占比"],data:r}))},p.downloadChart=function(){p.state.json.map(function(e,t){t=p.refs["chart-"+t].myChart.getDataURL({pixelRatio:2,backgroundColor:"#fff"});p.downloadFile(e.title,t)})},p.buildTop=function(){var e=p.props,t=e.editTemp,a=e.handleRemove,n=e.id,r=e.model,i=e.index,e=p.state,i={editTemp:t,handleRemove:a,id:n,model:r,index:i,isPercent:e.isPercent,emotion:e.emotion,showLabel:e.showLabel,showLabelPosition:e.showLabelPosition,sort:e.sort,decimal:e.decimal,singleEmotion:e.singleEmotion},e={changePercent:function(e){p.setState({isPercent:e})},changeEmotion:function(e){var t=p.state.singleEmotion;e[0]&&!e[1]?t=!0:!e[0]&&e[1]&&(t=!1),p.setState({emotion:e,singleEmotion:t})},changeSingleEmotion:function(e){p.setState({singleEmotion:e})},changeLabel:function(e){p.setState({showLabel:e})},changeLabelPosition:function(e){p.setState({showLabelPosition:e})},changeSort:function(e){p.setState({sort:e})},changeDecimal:function(e){p.setState({decimal:e})},refreshChart:p.refreshChart,getChartData:p.getChartData,downloadChart:p.downloadChart};return E().createElement("div",{className:"widget-top"},E().createElement(F,_()({key:p.time,ref:"selectBar"},i,e)))},p.getParams=function(e,t,a){var n,r=p.props.getParams();return r?(r.id=p.props.id,r.type=p.type,r.projectId=p.projectId,p.props.getAspect&&(n=p.props.getAspect().aspectType,e&&(r.filterModel.aspect[n?"aspect1":"aspect2"]=[e])),r.filterModel=r.filterModel||{},t&&(r.filterModel.aspect=r.filterModel.aspect||{},r.filterModel.aspect.emotion=["正面"===t?"positive":"negative"]),a&&(r.filterModel.analysis=r.filterModel.analysis||{},r.filterModel.analysis.values=[a]),r):null},p.myChartClick=function(e){var t=p.props.name;if(e)switch(e.componentType){case"series":var a=e.name,n=e.seriesName,r=e.data,i=r.id,o=r.count,s=r.type,i=(r.sourceName,p.getParams(a,n,i));i.leftName=t,i.aspect=e.data.name,i.aspectTotal=o,i.seriesName=n,i.analyseName=s,window.open("/tab/detail?"+encodeURIComponent(JSON.stringify(i)));break;case"yAxis":var l,c=e.value,s=p.props.getAspect(),i=s.aspectList;s.aspectType&&(l=[],i.filter(function(e){return e.name===c})[0].contain.map(function(e){return l.push(e)}),p.props.setAspectType(!1,l))}},p.resize=function(){var e=p.state.json;e&&e.map(function(e,t){p.refs["chart-"+t].myChart.resize()})},p.buildBody=function(){var e=p.state.json;if(!e||"string"==typeof e)return E().createElement("div",{className:"widget-body"},E().createElement(v.Z,{ref:"chart-0",className:"widget-chart"}));var t=e.map(function(e){return e.data&&e.data.length}),a=Math.max.apply(Math,t),r=1<t.length?"50%":"100%",e=window.innerHeight-200,a=30*a+200,i=0,i=2<t.length?a<e/2?"50%":a+"px":a<e?"100%":a+"px";return E().createElement("div",{className:"widget-body"},t.map(function(e,t){var a="chart-"+t,n=+new Date+t,t="d"+(p.time||+new Date)+t;return E().createElement("div",{key:t,style:{width:r,height:i,float:"left"}},E().createElement(v.Z,{myChartClick:p.myChartClick,ref:a,key:n}))}))},p}i()(e,n);var t=e.prototype;return t.componentWillMount=function(){this.setState({color:this.colors.aspect.reverse(),isPercent:!0,emotion:[!0,!0],singleEmotion:!0,showLabel:!1,showLabelPosition:!0,sort:!1,decimal:!0})},t.buildChart=function(){var l=this,p=this.state.json;if(p)if("string"!=typeof p){this.jsonStr===JSON.stringify(p)?this.refs["chart-0"].myChart.resize():this.jsonStr=JSON.stringify(p);var e=this.state,c=e.color,u=e.isPercent,d=e.emotion,t=e.showLabel,h=e.showLabelPosition,a=e.sort,n=e.decimal,r=e.singleEmotion,i=[];0<p.length&&p.forEach(function(e){var t,a={};e.data&&0<e.data.length&&(t=0,e.data.map(function(e){t+=e.doc_count,a[e.key]=e}),e.sum=t,i.push(a))});var m=0<i.length?Object.keys(i[0]).sort(function(e,t){e=r?i[0][e].positive:i[0][e].negative,t=r?i[0][t].positive:i[0][t].negative;return e/=u?p[0].sum:1,t/=u?p[0].sum:1,(a?1:-1)*(e-t)}):[],f=i.map(function(n,r){var i=[],o=[],s=0;Object.keys(n).map(function(e){s+=Number(n[e].doc_count)});var l=0,c=0;return m.map(function(e){var t=n[e],a=t.negative,t=t.positive;l+=a,c+=t,i.push({name:e,id:p[r].id,count:a,percent:a/s*100,type:p[r].title}),o.push({name:e,id:p[r].id,count:t,percent:t/s*100,type:p[r].title})}),{id:p[r].id,type:p[r].title,total:s,positive:c,negative:l,negativeList:i,positiveList:o}}),g=m.map(function(e){return e}),y=u&&n,v={normal:{show:t,formatter:function(e){return Math.abs(e.value).toFixed(y?2:0)+(u?"%":"")}}},o={negativeCount:0,positiveCount:0,negativePercent:0,positivePercent:0};f.map(function(e){o.negativeCount=Math.max.apply(Math,[o.negativeCount].concat(e.negativeList.map(function(e){return e.count||0}))),o.positiveCount=Math.max.apply(Math,[o.positiveCount].concat(e.positiveList.map(function(e){return e.count||0}))),o.negativePercent=Math.max.apply(Math,[o.negativePercent].concat(e.negativeList.map(function(e){return e.percent||0}))),o.positivePercent=Math.max.apply(Math,[o.positivePercent].concat(e.positiveList.map(function(e){return e.percent||0})))});var s=this.refs["chart-0"].myChart.getWidth(),C=0,E=0;t&&(u?(C+=y?8:5,d[0]&&d[1]&&(E+=y?8:5)):(C+=(""+(d[0]?o.positiveCount:o.negativeCount)).length,d[0]&&d[1]&&(E+=(""+o.negativeCount).length)));var b=2*Math.max.apply(Math,m.map(function(e){return e.length})),e=u?d[0]?o.positivePercent:o.negativePercent:d[0]?o.positiveCount:o.negativeCount,n=d[0]&&d[1]?u?o.negativePercent:o.negativeCount:0,O=(e+n)/(s-40-6*b-(C+E)*(h?0:6)),b=e+(t&&!h?C:0)*O,t=n+(t&&!h?E:0)*O,w=b+t,S=100;if(u)S=e+n<100?10:20;else{for(;10<w/S;)10<w/(S*=2)&&(S*=2.5),10<w/S&&(S*=2);for(;w/S<6;)w/(S/=2)<6&&(S/=2.5),w/S<6&&(S/=2)}var T=Math.ceil(b/S)*S,x=Math.ceil(t/S)*S;f.map(function(e,t){var a=l.refs["chart-"+t].myChart,n=a.getHeight()/10,r=Math.min((a.getHeight()-100)/m.length*.8,n);f[t].negativeList.forEach(function(e){e.value=(u?e.percent:e.count)*(d[0]?-1:1);var t=Math.abs(e.value)/O<6*((d[0]?E:C)+1),a=null,a=d[0]?h?t?"insideRight":"insideLeft":"left":h?t?"insideLeft":"insideRight":"right";e.label={normal:{position:a}}}),f[t].positiveList.forEach(function(e){e.value=u?e.percent:e.count;var t=e.value/O<6*((d[0]?E:C)+1);e.label={normal:{position:h?t?"insideLeft":"insideRight":"right"}}});var i=[],o=[],s=[],a=f[t].negativeList.map(function(e){return e}),n=f[t].positiveList.map(function(e){return e});d[0]?(o.push("正面"),d[1]&&(o.push("负面"),s.push(c[0]),i.push({label:v,barGap:"-100%",name:"负面",type:"bar",data:a,barWidth:r})),s.push(c[1]),i.push({label:v,name:"正面",type:"bar",data:n,barWidth:r})):(o.push("负面"),s.push(c[0]),i.push({label:v,name:"负面",type:"bar",data:a,barWidth:r}));i={title:{text:"{a|}{b|   "+e.type+"}    {st|评论：}{sv|"+e.total+"}{st| - 正面：}{sv|"+e.positive+"}{st|，负面：}{sv|"+e.negative+"}",textStyle:{rich:{a:{borderColor:"#000",borderWidth:1,height:9},b:{fontSize:14,fontWeight:"bold",color:"#000"},st:{color:"#999"},sv:{fontWeight:500,color:"#000"}}},left:16,top:16},tooltip:{formatter:function(e){var t=e.data;return u?e.name+"</br>"+e.marker+e.seriesName+" : "+t.percent.toFixed(y?2:0)+"% ("+t.count+")":e.name+"</br>"+e.marker+e.seriesName+" : "+t.count+" ("+t.percent.toFixed(y?2:0)+"%)"}},grid:{containLabel:!0,left:20,right:20,bottom:20,top:94},color:s,legend:{data:o,top:54,left:"center",itemWidth:10,itemHeight:10},xAxis:[{type:"value",min:-x,max:T,interval:S,axisLabel:{formatter:function(e){return Math.abs(e)+(u?"%":"")}}}],yAxis:[{type:"category",axisLine:{lineStyle:{width:3}},zlevel:2,inverse:!0,data:g,triggerEvent:!0}],series:i,animation:!1};l.refs["chart-"+t].setOption(i,!0),l.refs["chart-"+t].group("levelBar")})}else this.refs["chart-0"].setEmptyOption(p);else this.refs["chart-0"]&&this.refs["chart-0"].loading()},e}(r.Z);const z={COUNTER_NUM:a.CountNum,COUNTER_PIES_BY_SOURCE:a.CountPiesBySource,COUNTER_TIME_STACK_AREA_LINE:a.CountTimeStackAreaLine,COUNTER_WORD:a.CounterWord,CONTENT_TABLE:a.ContentTable,EMOTION_ASPECT_LEVEL_BAR:{widget:r,tool:function(r){function e(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return(e=r.call.apply(r,[this].concat(a))||this).width=12,e.height=8,e.isSingle=!1,e.type="EMOTION_ASPECT_LEVEL_BAR",e}return i()(e,r),e}(d)},EMOTION_ASPECT_TIME_LINE:c,EMOTION_PIE:t.EmotionPie,EMOTION_TIME_STACK_BAR:t.EmotionTimeStackBar,EMOTION_PIE_AND_TIME_STACK_BAR:t.EmotionPieAndTimeStackBar};var B=s(19586),Y=s(20899),W=s(82817),V=s(35239),Z=s(94644),H=[{name:"比例",id:1},{name:"数量",id:2}],J=function(t){function e(e){var r=t.call(this,e)||this;return r.resizeFontSize=function(){var e=.03*r.flexWrapper.offsetWidth;document.getElementById("flexSpan").style.fontSize=e+"px";e=document.documentElement.clientWidth;r.divider.style.margin=e<1593?"0 4px":"0 16px";for(var t=document.getElementsByClassName("category"),a=0;a<t.length;a++)t[a].style.marginRight="4px"},r.resize=function(){r.flexWrapper&&(r.resizeFontSize(),r.bar.resize())},r.switchDateDimension=function(e){r.setState({queryTimeType:e,dateDimensionReady:!0},function(){r.fetchData()})},r.switchFx=function(e){r.setState({fxValue:e,loading:!0},function(){return r.setState({loading:!1})})},r._handleChartDownload=function(e){(0,Z._v)(r.bar.chart,e)},r._handleExcelDownload=function(e){var n=r.state.fxValue.id,t=r.state.data.map(function(e){var t=1===n?e.percentageOfPositive+"%":e.positive,a=1===n?e.percentageOfNegative+"%":e.negative;return[e.time,t,a]});t.splice(0,0,["日期","正面","负面"]),(0,Z.aT)([t],e)},r.state={queryParams:null,queryTimeType:{},data:[],sum:0,positive:0,negative:0,projectId:"",model:"",aspect:{aspect1:[],aspect2:[]},fxValue:H[0],loading:!0,dateDimensionReady:!1},r}i()(e,t);var a=e.prototype;return a.componentDidUpdate=function(e,t){this.flexWrapper&&this.resizeFontSize()},a.formatNum=function(e){return 0<=e&&e<1e3?e:e<1e4?(e/1e3).toFixed(2)+"千":(e/1e4).toFixed(2)+"万"},a.fetchAspects=function(r,i){var o=this;r&&i&&h.h.post("filter/find",{filterTypes:["ASPECT"],projectId:r,type:i}).then(function(e){var t,a,n=e.data.result;n.aspect&&0<n.aspect.length&&(t=JSON.parse(n.aspect),V.t.set(V.V.aspect,n.aspect[0]),e=o.state.aspect,a=e.aspect1,e=e.aspect2,Object.keys(t).map(function(e){return a.push(e)}),n.treeAspect&&n.treeAspect[0]&&n.treeAspect[0].treeId&&(o.treeId=n.treeAspect[0].treeId),o.setState({model:i,projectId:r,aspect:{aspect1:a,aspect2:e}},function(){return o.fetchData()}))})},a.fetchData=function(){var r=this,e=this.state,t=e.queryParams,a=e.aspect,n=e.queryTimeType,e=e.dateDimensionReady;t&&t.filterModel&&t.dateFilter&&0<a.aspect1.length&&e&&(t.filterModel.aspect=a,t.filterModel.treeId=this.treeId,t.dateFilter.dateGroupType=n,this.setState({loading:!0},function(){return h.h.post("/widget/data/find/ASPECT_DATE_COUNT_BAR",_()({},t)).then(function(e){var t=e.data.result,a=r.caculatePercentage(t.aspectCounts),n=t.aspectTotal||0,e=t.positiveTotal||0,t=t.negativeTotal||0;r.setState({data:a,sum:n,positive:e,negative:t,loading:!1})})}))},a.refreshChart=function(){var a=this,e=V.t.get(V.V.curProject).id;this.setState({queryParams:_()({},this.props.getParams(),{projectId:e})},function(){var e,t;0<a.state.aspect.aspect1.length?a.fetchData():(e=(t=a.props).projectId,t=t.model,a.fetchAspects(e,t))})},a.caculatePercentage=function(e){for(var t=e.length-1;0<=t;t--){var a=e[t].total;e[t].percentageOfNegative=0<a?(100*e[t].negative/e[t].total).toFixed(2):0,e[t].percentageOfPositive=0<a?(100*e[t].positive/e[t].total).toFixed(2):0}return e},a.getChartOption=function(){var e=this.state,a=e.data,n=e.fxValue,e=["正面","负面"];return{title:{text:"声量趋势",textStyle:{fontSize:14}},barMaxWidth:40,barGap:"30%",legend:_()({},W.I.legend,{top:30,data:e.map(function(e){return{name:""+e,icon:"rect"}})}),grid:_()({},W.I.grid,{top:36,left:40}),xAxis:_()({},W.I.xAxis,{data:a.map(function(e){return e.time})}),yAxis:_()({},W.I.yAxis,{max:1===n.id?100:null}),tooltip:_()({},W.I.tooltip,{formatter:function(e){return e[0].name+e.map(function(e){return"<br/>"+e.marker+e.seriesName+"："+e.value+(1===n.id?"%":"")}).reverse().join("")}}),series:e.map(function(t){return{name:t,data:a.map(function(e){return 1===n.id?"正面"===t?e.percentageOfPositive:e.percentageOfNegative:"正面"===t?e.positive:e.negative}),stack:"评价",cursor:"default",type:"bar",itemStyle:{normal:{color:"正面"===t?"#15B374":"#D96969"}}}}).reverse()}},a.render=function(){var t=this,e=this.state,a=e.sum,n=e.positive,r=e.negative,i=e.queryTimeType,o=e.queryParams,s=e.fxValue,l=e.loading,e=location.pathname.split("/")[1]+"-saved-date-dimension";return E().createElement("div",{className:"overviewChartWrapper"},E().createElement(g.Loading,{loading:l,text:"拼命加载中"},E().createElement("div",null,E().createElement("div",{className:"title"},o&&o.analyseName),E().createElement("div",{className:"detailChart-top",ref:function(e){return t.flexWrapper=e}},E().createElement("div",null,E().createElement("div",null,E().createElement("span",null,"声量"),E().createElement(N.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:"声量是指一定筛选条件和时间范围内评论数据中提取到与产品/服务/市场相关的指标累加，包括表达正面情绪和负面情绪的指标"},E().createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative"}}))),E().createElement("div",{style:{height:"62px"}},E().createElement(N.Z,{placement:"top",overlay:a},E().createElement("span",{id:"flexSpan",style:{fontSize:"50px"}},this.formatNum(a))),E().createElement("span",{style:{color:"#8C8C8C"}},"/ 总量")),E().createElement("div",null,E().createElement("div",null,E().createElement("span",{className:"category"},"正面"),E().createElement(N.Z,{placement:"top",overlay:n},E().createElement("span",null,this.formatNum(n)))),E().createElement("div",{ref:function(e){return t.divider=e}},"|"),E().createElement("div",null,E().createElement("span",{className:"category"},"负面"),E().createElement(N.Z,{placement:"top",overlay:r},E().createElement("span",null,this.formatNum(r)))))),E().createElement("div",{className:"chart-top-wrapper"},E().createElement("div",{className:"time-btn-wrapper"},E().createElement(A.Z,{onDownChartClick:function(){return t._handleChartDownload("声量趋势")},onDownExcelClick:function(){return t._handleExcelDownload("声量趋势")}}),E().createElement(k.Z,{uniqueId:e,defaultValue:i,onChange:this.switchDateDimension,style:{float:"right"}}),E().createElement(D.Z,{style:{float:"right"},list:H,onChange:this.switchFx,value:s,placeholder:E().createElement("i",{className:"icon-cem_fx",style:{fontSize:"18px",fontWeight:"bold"}}),partingLine:!0})),E().createElement(Y.Z,{ref:function(e){return t.bar=e},uniqueId:"insight",option:this.getChartOption(),height:167}))))))},e}(E().Component),c=s(45697),t=s.n(c),U=s(87729),G=s(61193),q=s(97911),K=s(5133),Q=s(97189),X=function(t){function e(e){var s=t.call(this,e)||this;return s.changeState=function(e){s.setState(e,function(){s.updateFilter()})},s.clickCheckbox=function(e){var t=e.aspect1,a=e.aspect2,n=s.state.limit;n&&(t&&t.length>n||a&&a.length>n)?K.Z.warning("当前条件下最多支持选择"+n+"个分析指标"):s.setState(e)},s.updateFilter=function(){var e=s.state.aspectType,t=s.state,a=t.aspect1,t=t.aspect2;e&&a&&0<a.length?t=[]:0<t.length&&(a=[]),s.setState({aspect1:a,aspect2:t})},s.fetchAspects=function(t,a){var e=s.state.fetching;t&&a&&!e&&s.setState({fetching:!0},function(){h.h.post("filter/find",{filterTypes:["ASPECT"],projectId:t,type:a}).then(function(e){e=e.data.result;e.aspect&&(e.treeAspect&&e.treeAspect[0]&&e.treeAspect[0].treeId&&(s.treeId=e.treeAspect[0].treeId),s.setState({projectId:t,model:a,rawAspectList:e.aspect},function(){return s.formatData()}))}).finally(function(){return s.setState({fetching:!1})})})},s.clickCancelBtn=function(){s.state.aspectShow&&s.props.closePanel()},s.orderAspect=function(e){for(var t=s.state.aspectList,a=[],n=[],r=0;r<t.length;r++){for(var i=!1,o=0;o<e.length;o++)if(t[r].name===e[o]){i=!0,a[o]=t[r];break}i||n.push(t[r])}s.setState({aspectList:a.concat(n)})},s.state={aspectShow:!1,aspectType:!0,aspect1:[],aspect2:[],rawAspectList:[],aspectList:[],projectId:e.projectId,model:e.model,ready:!1,fetching:!1,limit:e.limit},s}i()(e,t);var a=e.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){var t=e.aspectShow,e=e.limit;this.setState({aspectShow:t,limit:e})},a.componentDidMount=function(){window.addEventListener("click",this.clickCancelBtn)},a.componentDidUpdate=function(){this.setLeftBlockHeight()},a.componentWillUnmount=function(){window.removeEventListener("click",this.clickCancelBtn)},a.setLeftBlockHeight=function(){var e=document.querySelectorAll(".analyse-aspect-panel-body .left .new-checkbox-panel .wt-checkbox-group .wt-checkbox"),t=document.querySelectorAll(".analyse-aspect-panel-body .right .new-checkbox-panel");if(e.forEach(function(e){return e.style.marginBottom="0"}),0<t.length)for(var a=t.length-1;0<=a;a--){var n=t[a].offsetHeight;36<n&&(e[a].style.marginBottom=n-36+"px")}},a.getValue=function(){var e=this.state,t=e.aspectType,a=e.aspect1,n=e.aspect2;if(e.ready)return{aspect1:t?a:[],aspect2:t?[]:n};t=this.props,n=t.projectId,t=t.model;this.fetchAspects(n,t)},a.getSndIndex=function(e){e=this.state.aspects[e];return e&&0<e.length&&this.setState({aspectType:!1,aspect1:[],aspect2:e}),e},a.setAspectFromOutside=function(e){this.setState(_()({aspectType:0<e.aspect1.length},e))},a.formatData=function(){var a,n,e,t=this,r=this.state,i=r.model,o=r.aspect1,s=r.aspect2,l=r.rawAspectList,c=r.limit,p=this.state,r=p.aspectShow,p=p.aspectType,l=l,u={};"BRAND"===i?(a=l.map(function(e){return e&&JSON.parse(e)}),(i=0)<=(n=G.Z.getAuthority()).indexOf("ANALYZE_PRODUCT")&&i++,0<=n.indexOf("ANALYZE_SERVER")&&i++,0<=n.indexOf("ANALYZE_MARKETING")&&i++,0===i?a.forEach(function(e){Object.keys(e).forEach(function(e,t){return u[t]=e})}):1===i?["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].forEach(function(e,t){0<=n.indexOf(e)&&Object.keys(a[t]).map(function(e,t){return u[t]=e})}):1<i&&(0<=n.indexOf("ANALYZE_PRODUCT")&&(1===(i=Object.keys(a[0])).length?u["产品"]=a[0][i[0]]:1<i.length&&(u["产品"]=a[0])),0<=n.indexOf("ANALYZE_SERVER")&&(1===(e=Object.keys(a[1])).length?u["服务"]=a[1][e[0]]:1<e.length&&(u["服务"]=a[1])),0<=n.indexOf("ANALYZE_MARKETING")&&(1===(e=Object.keys(a[2])).length?u["市场"]=a[2][e[0]]:1<e.length&&(u["市场"]=a[2])))):l&&l[0]&&(u=JSON.parse(l[0]));l=Object.keys(u).map(function(e,t){var n=u[e];return{id:t,name:e,contain:n.length?n:Object.keys(n).map(function(e,t){var a=n[e];return{id:t,name:e,contain:a.length?a:Object.keys(a)}})}});(p=l.length<=1?r=!1:p)&&!o.length?null!==c?l.forEach(function(e,t){t<c&&o.push(e.name)}):l.forEach(function(e){return o.push(e.name)}):p||s.length||l&&l[0]&&l[0].contain.forEach(function(e){"object"==typeof e?s.push(e.name):s.push(e)}),this.setState({aspectList:l,aspectShow:r,aspects:u,aspectType:p,aspect1:o,aspect2:s,ready:!0},function(){t.props.onChange(),t.updateFilter()})},a.handleClickBlock=function(e,t){var a=this.state,n=a.aspectType;a.aspectShow&&n!==e&&(a=document.querySelectorAll(".analyse-aspect-panel-body div"),n="disabled",e?this.hanldeClass("remove",a[1],n):this.hanldeClass("remove",a[0],n),e?this.setState({aspectType:e,aspect2:[]}):this.setState({aspectType:e,aspect1:[]}))},a.hanldeClass=function(e,t,a){("add"===e?(0,Q.addClass):(0,Q.removeClass))(t,a)},a.clickConfirmBtn=function(){this.props.onChange(),this.props.closePanel()},a.clearOptions=function(){this.setState({aspect1:[],aspect2:[]})},a.render=function(){var a=this,e=this.state,t=e.aspectList,n=e.aspectType,r=e.aspect1,i=e.aspect2,o=e.aspectShow,s=e.limit;return E().createElement("div",{className:"analyse-aspect-panel-wrapper",style:{display:o?"block":"none"},onClick:function(e){return e.stopPropagation()}},E().createElement("div",{className:"analyse-aspect-panel-body"},E().createElement("div",{className:n?"left":"left disabled",onClick:function(e){return a.handleClickBlock(!0,e)}},E().createElement(q.Z,{changeState:function(e){return a.clickCheckbox({aspect1:e})},checkedList:r,ITEMS:t.map(function(e){return e.name||e}),categoryTitle:"一级指标",type:"vertical",limit:s})),E().createElement("div",{className:n?"right disabled":"right",onClick:function(e){return a.handleClickBlock(!1,e)}},E().createElement("div",null,"二级指标"),0<t.length&&t.map(function(e,t){return E().createElement(q.Z,{changeState:function(e){return a.clickCheckbox({aspect2:e})},checkedList:JSON.parse(JSON.stringify(i)),key:"aspect1-"+t,categoryTitle:e.name,ITEMS:e.contain.map(function(e){return e.name||e}),type:"horizontal",limit:s})}))),E().createElement("div",{className:"analyse-aspect-panel-footer"},E().createElement("span",{onClick:function(){return a.clearOptions()}},"清空全部选项"),E().createElement("div",null,E().createElement(g.Button,{type:"primary",disabled:n&&(0===r.length||null!==s&&r.length>s)||!n&&0===i.length||null!==s&&i.length>s,onClick:function(){return a.clickConfirmBtn()}},"确定"),E().createElement("span",{className:"cancelBtn",onClick:function(){return a.clickCancelBtn()}},"取消"))))},e}(E().Component),$=function(a){function e(e){var t=a.call(this,e)||this;return t.closePanel=function(){t.setState({showPanel:!1})},t.state={showPanel:!1},t}i()(e,a);var t=e.prototype;return t.togglePanel=function(e){var t=this,a=this.state.showPanel;a&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){return t.setState({showPanel:!a})},0)},t.getValue=function(){if(this.panel)return this.panel.getValue()},t.getSndIndex=function(e){return this.panel.getSndIndex(e)},t.setAspectFromOutside=function(e){return this.panel.setAspectFromOutside(e)},t.orderAspect=function(e){this.panel.orderAspect(e)},t.render=function(){var t=this,e=this.state.showPanel;return E().createElement("div",{className:"analyse-aspect-wrapper"},E().createElement("div",{className:"analyse-aspect-trigger",style:{backgroundColor:e?"rgb(97,121,155)":"",color:e?"white":"#8C8C8C"},onClick:function(e){return t.togglePanel(e)}},E().createElement("span",null,"分析指标"),E().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:e?"rotate(-180deg)":"",color:e?"white":"#8C8C8C"}})),E().createElement(X,_()({ref:function(e){t.panel=e},aspectShow:e,closePanel:this.closePanel},this.props)))},e}(E().Component),ee=function(t){function e(e){var n=t.call(this,e)||this;return n.emit=function(){n.props.type&&n.competeRules(),n.props.onChange&&n.props.onChange(n.getValue())},n.getValue=function(){var e=n.refs.AnalyzeObject.getValue();return e.type&&(e.type=e.type.toUpperCase()),{analysis:e,aspect:n.refs.AnalyzeIndex.getValue()?n.refs.AnalyzeIndex.getValue():{aspect1:[],aspect2:[]},treeId:n.refs.AnalyzeIndex.panel?n.refs.AnalyzeIndex.panel.treeId:""}},n.competeRules=function(){var e=n.state.rules;"trend"===n.props.type&&(e.trend=function(){var e=n.getValue(),t=e.analysis,a=e.aspect,e=a.aspect1,a=a.aspect2;if(t.values)return 1<t.values.length?[null,1]:1<e.length||1<a.length?[1,null]:t.values.length<=1&&(e.length<=1||a.length<=1)?[null,null]:void 0}(),n.setState({rules:e}))},n.state={rules:{emotion:[10,10],trend:[1,null]}},n}i()(e,t);var a=e.prototype;return a.getFilterList=function(){},a.componentDidMount=function(){this.getFilterList()},a.render=function(){var e=this.props,t=e.projectId,a=e.model,n=e.type,e=this.state.rules;return E().createElement("div",{className:"analyze-filter"},E().createElement(U.ZP,{ref:"AnalyzeObject",left:-58,onChange:this.emit,limit:n&&e[n]?e[n][0]:null,type:n}),E().createElement($,{ref:"AnalyzeIndex",onChange:this.emit,projectId:t,model:a,limit:n&&e[n]?e[n][1]:null}))},e}(n.Component);ee.propTypes={onChange:t().func,type:t().string};var te={c10:["cem_radar-gray","cem_radar","雷达图"],c0:["cem_multi-graph-withcolor1","cem_multi-graph","平铺图"],c1:["cem_red-negative-dee","cem_red-negative-wit","负面情感图"],c2:["cem_red-negative-noc","cem_green-front-with","正面情感图"],c3:["cem_twocolor-separat","cem_twocolor-separat1","情感对比图"],c4:["cem_twocolor-oneway-","cem_twocolor-oneway-1","情感堆叠图"]},ae={c0:["cem_line-chart","cem_line-chart-color","趋势图"]},ne=[{type:"s1",img:"#icon-cem_user-voice1",title:"用户声量",hint:"计数",desc:"对具体分析指标的数量计数累加，对用户的意见进行客观的数量统计，表示用户发出的“声音量”。"},{type:"s3",img:"#icon-cem_index",title:"指标满意度",hint:"比例",desc:'对具体指标的A的正面情感A1和负面情感A2数量进行统计后，计算该指标A的"好评率＝A1÷(A1+A2)"和"坏评率＝A2÷(A1+A2)"。'},{type:"s4",img:"#icon-cem_special-emotions",title:"特定情感占比",hint:"比例",desc:"对图表中展示的所有指标，如A、B、C、D...等指标的正向情感A1、B1、C1、D1...等数量累加和负面情感A2、B2、C2、D2...等数量累加，以此计算A1÷(A1+B1+C1+D1+...)和A2÷(A2+B2+C2+D2+..)的值。通过该公式，我们可以快速的比较具体指标A的正面情感A1在全部正面情感中的占比，A的负面情感也如此。让我们更直观的了解影响正面情感的主要指标或者影响负面情感的主要指标。"},{type:"s5",img:"#icon-cem_total-proportion",title:"总占比",hint:"比例",desc:'计算具体指标的A的正面情感量"A1÷用户声量”和“A2÷用户声量"，其他指标B、C、D...等也如此计算。该公式在多个分析对象对比时尤其有用，可以让不同声量等级的分析对象进行有效比较，如刚推出的新品和已推向市场的成熟产品的指标比较。'},{type:"s2",img:"#icon-cem_geometry",title:"几何平均",hint:"指数",desc:"对单个指标A的正向情感A1或A2的指标满意度、特定情感占比和总占比三个公式计算得出的比例值进行几何平均处理（即连乘后开根号），将得到一个新的比例数值，该指标可以综合描述指标A中A1（或A2）的重要程度。日常生活中，”复利下的平均年利率“和”连续作业的车间求产品的平均合格率“都是基于几何平均计算公式得出的。"}],re={s1:"COUNT",s2:"WEIGHT",s3:"A",s4:"B",s5:"C"},ie=[{title:"指标排序",type:"rangeObject",options:[{key:"positive",value:"正面高到低"},{key:"negative",value:"负面高到低"}]},{title:"数据展示",type:"showValue",options:[{key:"yes",value:"展示"},{key:"no",value:"不展示"}]}],oe=[{title:"负面情感",value:"negative"},{title:"正面情感",value:"positive"}],se=[{title:"按日分析",value:"DAY"},{title:"按周分析",value:"WEEK"},{title:"按月分析",value:"MONTH"},{title:"按年分析",value:"YEAR"}],le=[{title:"导出图片",type:"image"},{title:"导出数据",type:"excel"}],ce={time:"DAY",chartType:"c0",rangeType:"desc",statisticType:"s1",rangeObject:"positive",showValue:"no"};const pe=function(t){function e(e){var a=t.call(this,e)||this;return a._setPadShowFalse=function(){a.state.isPadShow&&a.setState({isPadShow:!1})},a._setEvent=function(e){return 0===e?{onMouseEnter:function(){a.setState({firstLiHover:!0})},onMouseLeave:function(){a.setState({firstLiHover:!1})}}:{}},a._handleLiClick=function(e,t){e.stopPropagation(),a.setState({type:t.type,isPadShow:!1}),a.props.onStatisticChange({type:t.type,title:t.title,desc:t.desc})},a._handleOnFxClick=function(e){a.state.isPadShow&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){a.setState({isPadShow:!a.state.isPadShow})},0)},a.state={type:ce.statisticType,firstLiHover:!1,isPadShow:!1},a}i()(e,t);var a=e.prototype;return a.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},a.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},a.render=function(){var a=this,e=this.state.isPadShow;return E().createElement("div",{className:"statistic-button-wrapper",onClick:this._handleOnFxClick},E().createElement("div",{className:"button-icon "+(e?"click":""),style:e?{color:"#262626",backgroundColor:"#F7F8FA",fontWeight:"bold"}:{}},E().createElement("span",null,E().createElement("i",{className:"icon-cem_fx fx-icon"}),E().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:e?"rotate(-180deg)":""}}))),E().createElement("div",{className:"selPad "+(this.state.firstLiHover||"s1"===this.state.type?"selPadHover":""),style:{display:this.state.isPadShow?"block":"none"}},E().createElement("ul",null,ne.map(function(t,e){return E().createElement("li",_()({className:a.state.type===t.type?"liSel":"",key:e},a._setEvent(e),{onClick:function(e){return a._handleLiClick(e,t)}}),E().createElement("div",{className:"sta-image"},E().createElement("svg",{className:"icon-svg"},E().createElement("use",{xlinkHref:t.img}))),E().createElement("div",{className:"sta-content"},E().createElement("div",null,E().createElement("span",{className:"sta-content-hint"},t.hint," - "),E().createElement("span",{className:"sta-content-title"},t.title)),E().createElement("div",{className:"sta-content-desc"},t.desc)))}))))},e}(E().Component),ue=function(n){function e(){for(var r,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(r=n.call.apply(n,[this].concat(t))||this)._handleOptionClick=function(e,t){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();var a=r.props,n=a.data,e=a.onMoreOptionChange;a.chosenKey!==t&&e(((e={})[n.type]=t,e))},r}i()(e,n);var t=e.prototype;return t.componentDidMount=function(){var t=this,e=document.getElementsByClassName("option");e&&e instanceof Array&&e.forEach(function(e){e.addEventListener("click",t._handleOptionClick)})},t.componentWillUnmount=function(){var t=this,e=document.getElementsByClassName("option");e&&e instanceof Array&&e.forEach(function(e){e.removeEventListener("click",t._handleOptionClick)})},t.render=function(){var a=this,e=this.props,t=e.data,n=e.chosenKey;return E().createElement("div",{className:"analysis-chart-radio-select-wrapper"},E().createElement("div",{className:"title"},t.title),E().createElement("ul",null,t.options.map(function(t){return E().createElement("li",{key:t.key,className:"option "+(t.key===n?"chosen":"")},E().createElement("span",{onClick:function(e){return a._handleOptionClick(e,t.key)}},t.value))})))},e}(E().Component);var de=s(33798),c=function(a){function e(e){var t=a.call(this,e)||this;return t._setPadShowFalse=function(){t.state.showPanel&&t.setState({showPanel:!1})},t._handleBtnClick=function(e){t.state.showPanel&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){t.setState({showPanel:!t.state.showPanel})},0)},t.state={showPanel:!1},t}i()(e,a);var t=e.prototype;return t.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},t.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},t.render=function(){var e=this.state.showPanel,t=this.props,a=t.chosenOptions,n=t.onChange,t=t.options;return E().createElement("div",{className:"analysis-chart-header-setting-wrapper"},E().createElement(de.Z,{defaultIcon:"cem_more-two",activeIcon:"cem_chart-setting",onClick:this._handleBtnClick}),E().createElement("div",{className:"more-panel",style:{display:e?"block":"none"}},t.map(function(e,t){return E().createElement(ue,{key:t,chosenKey:a[e.type],data:e,onMoreOptionChange:n})})))},e}(E().Component);c.propTypes={chosenOptions:t().object.isRequired,onChange:t().func.isRequired,options:t().array.isRequired};const he=c;var me=s(60496),fe=s(35303),ge=s(91751),c=s(59108),ye=s.n(c),c=s(82784),ve=s.n(c);s(83839);R().locale("zh-cn");var Ce="YYYY-MM-DD";function Ee(e){return e?e.format(Ce):""}function be(e){var t=R()();return e.isAfter(t)}var Oe=function(r){function e(){for(var t,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(t=r.call.apply(r,[this].concat(a))||this).onStandaloneSelect=function(e){"calendar"===t.props.type?t.props.getDateRange(Ee(e)):e[0]&&e[1]&&t.props.getDateRange([Ee(e[0]),Ee(e[1])])},t}i()(e,r);var t=e.prototype;return t.stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},t.render=function(){var t=this,e=this.props.type,a={showDateInput:!1,locale:ve(),showOk:!1,showToday:!1,format:Ce,onSelect:this.onStandaloneSelect,disabledDate:be,renderFooter:function(){return null}};return E().createElement("div",{className:"fixed-datepicker-wrapper",onClick:function(e){return t.stop(e)}},"calendar"===e?E().createElement(ge.Z,_()({},a,this.props)):E().createElement(ye(),_()({},a,this.props)))},e}(E().PureComponent);Oe.propTypes={type:t().string.isRequired,getDateRange:t().func.isRequired};var we=s(94157),Se=function(t){function e(e){var a=t.call(this,e)||this;return a.openPanel=function(e){a.state.panelShow&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){return a.setState({panelShow:!0})},0)},a.closePanel=function(){a.setState({panelShow:!1})},a.getDateRange=function(e){var t=a.props.index;a.closePanel(),a.props.getDateRange(e,t)},a.state={panelShow:!1,value:e.value||[],index:e.index,type:e.type,disabledDate:e.disabledDate},a}i()(e,t);var a=e.prototype;return a.componentDidMount=function(){window.addEventListener("click",this.closePanel)},a.UNSAFE_componentWillReceiveProps=function(e){this.setState(_()({},e))},a.componentWillUnmount=function(){window.removeEventListener("click",this.closePanel)},a.render=function(){var t=this,e=this.state,a=e.value,n=e.type,r=e.disabledDate,i=e.panelShow,e=[];return a&&2===a.length&&(e=a.map(function(e){return R()(e,"YYYY-MM-DD")})),E().createElement(we.Z,{ref:function(e){return t.trigger=e},action:["click"],popupAlign:{points:["tl","bl"],offset:[0,4]},popup:E().createElement(Oe,{type:n,getDateRange:this.getDateRange,defaultSelectedValue:"calendar"===n?e[0]:e,disabledDate:r}),popupVisible:i},E().createElement(g.Input,{value:a&&2===a.length&&a.join("~")||"",placeholder:"请选择日期",onClick:this.openPanel}))},e}(E().Component);Se.propTypes={type:t().string.isRequired,value:t().array,getDateRange:t().func.isRequired,index:t().number,disabledDate:t().func};var Te="YYYY-MM-DD",xe=[{label:"平均值对比",value:"AVG"},{label:"不另设对比对象",value:"NONE"},{label:"具体分析对象",value:"SELECT"}],Ne=["仅所选主题"],De=["不另设对比时间","同比","环比","对比相对日期（偏移）"],_e=["去年","上月","上周"],ke={multiple:!1,tags:!1,optionFilterProp:"label",optionLabelProp:"label",showSearch:!1},Ae={multiple:!0,tags:!1},Me=function(t){function e(e){var g=t.call(this,e)||this;return g.handleChangeCompareObj=function(e){var t=g.state,a=t.currDate,n=t.selectedObj,r=t.selectedObjList,i=t.dateParamsList;if("NONE"===e&&n.length&&g.setState({selectedObj:[]}),"NONE"!==e&&"SELECT"!==e||0!==i.length)g.setState({compareObj:e});else{for(var o=0;o<r.length;o++)i.push(a);g.setState({compareObj:e,dateParamsList:i})}},g.handleChangeAnalyseObj=function(e){var t=g.state,a=t.selectedObjList,n=t.compareTime,r=t.dateParamsList,t=t.currDate;if(3!==n)g.setState({selectedObjList:e,selectedObj:e});else{if(a.length>e.length){for(var i=-1,o=0;o<a.length;o++)e.includes(a[o])||(i=o);r.splice(i,1)}else r.push(t);g.setState({selectedObjList:e,selectedObj:e,dateParamsList:r})}},g.handleChangeAvgCompareType=function(e){g.setState({avgCompareType:e})},g.handleChangeCompareTime=function(e){var t=g.state,a=t.currDate,n=t.dateRangeType,r=t.selectedObjList,i=t.dateParamsList,o=t.compareObj;g.state.compareDate;if(2===e){var s=a[0],t=a[1],t=R()(t,Te).diff(R()(s,Te),"days"),l=[R()(s,Te).subtract(t+1,"days").format(Te),R()(s,Te).subtract(1,"days").format(Te)];g.setState({compareTime:e,compareDate:l})}else if(3===e){if("AVG"===o)g.setState({compareDate:a});else if(0===i.length){for(var c=0;c<r.length;c++)i.push(a);g.setState({compareTime:e,dateParamsList:i})}else if(i.length<r.length)for(var p=r.length-i.length,u=0;u<p;u++)i.push(a)}else 1===e&&g.handleChangeDateRangeType(n);g.setState({compareTime:e})},g.handleChangeDateRangeType=function(e){var t=g.state.currDate,a=t[0],n=t[1],r=[];switch(e){case 0:r=[R()(a,Te).subtract(1,"years").format(Te),R()(n,Te).subtract(1,"years").format(Te)];break;case 1:r=[R()(a,Te).subtract(1,"months").format(Te),R()(n,Te).subtract(1,"months").format(Te)];break;default:r=[R()(a,Te).subtract(1,"weeks").format(Te),R()(n,Te).subtract(1,"weeks").format(Te)]}g.setState({dateRangeType:e,compareDate:r})},g.handleSetDateParamsList=function(e,t){var a=g.state,n=a.currDate,r=a.dateParamsList,a=n[0],n=n[1],a=R()(n,Te).diff(R()(a,Te),"days"),a=[e,R()(e,Te).add(a,"days").format(Te)];r[t]=a,g.setState({dateParamsList:r})},g.handleSetCompareDate=function(e){var t=g.state.currDate,a=t[0],t=t[1],a=R()(t,Te).diff(R()(a,Te),"days"),a=[e,R()(e,Te).add(a,"days").format(Te)];g.setState({compareDate:a})},g.getFormatedAnylyseObjList=function(){for(var e=g.state,t=e.selectedObjList,a=e.analyseObjList,n=[],r=0;r<a.length;r++){var i=a[r],o=i.id,i=i.name;t.includes(i)&&n.push(o)}return n},g.onConfirm=function(){var e=g.state,t=e.compareTime,a=e.compareObj,n=e.selectedObjList,r=e.selectedObj,i=e.dateParamsList,o=e.currDate,s=e.compareDate,l=e.dateRangeType,e=e.avgCompareType;if("SELECT"!==a||0!==r.length){var c={type:"",dateFilters:[],values:[],compareTime:t,dateRangeType:l,compareDate:s,avgCompareType:e,selectedObj:r};c.type=a;r=g.getFormatedAnylyseObjList();switch(t){case 0:for(var p=0;p<n.length;p++)c.dateFilters.push({from:o[0],to:o[1],dateGroupType:"DAY"});break;case 1:case 2:for(var u=0;u<n.length;u++)c.dateFilters.push({from:s[0],to:s[1],dateGroupType:"DAY"});break;case 3:if("AVG"===a)for(var d=0;d<n.length;d++)c.dateFilters.push({from:s[0],to:s[1],dateGroupType:"DAY"});else for(var h=0;h<i.length;h++){var m=i[h],f=m[0],m=m[1];c.dateFilters.push({from:f,to:m,dateGroupType:"DAY"})}}c.values=r,g.props.getParams(c),g.onCancel()}else K.Z.warning("请至少选择一个分析对象")},g.onCancel=function(){var e=g.props,t=e.selectedObjList,a=e.compareTime,n=e.dateRangeType,r=e.compareDate,i=e.avgCompareType,e=e.selectedObj;g.setState({show:!1,compareObj:1<t.length?"AVG":e.length?"SELECT":"NONE",avgCompareType:i,compareTime:a,dateRangeType:n,compareDate:r,selectedObj:e})},g.openSettingDialog=function(){g.setState({show:!0})},g.state={show:!1,compareObj:1<e.selectedObjList.length?"AVG":e.selectedObj.length?"SELECT":"NONE",avgCompareType:0,compareTime:e.compareTime||0,dateRangeType:0,currDate:e.currDate||[],compareDate:e.compareDate||[],analyseObjList:e.analyseObjList||[],selectedObjList:e.selectedObjList||[],selectedObj:void 0,dateParamsList:[]},g}i()(e,t);var a=e.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){this.setState(_()({},e,{compareObj:1<e.selectedObjList.length?"AVG":e.selectedObj.length?"SELECT":"NONE"}))},a.render=function(){function a(e){return e.isAfter(R()(f,Te))}var n=this,e=this.state,t=e.show,r=e.compareObj,i=e.avgCompareType,o=e.compareTime,s=e.dateRangeType,l=e.currDate,c=e.compareDate,p=e.analyseObjList,u=e.selectedObjList,d=e.dateParamsList,h=e.selectedObj,m=this.props.selectedObjList,e=l[0],f=R()(e,Te).add(1,"days").format(Te);return E().createElement(g.Dialog,{title:"同比环比设置",visible:t,customClass:"setting-dialog-wrapper",onCancel:this.onCancel},E().createElement(g.Dialog.Body,null,E().createElement("div",{className:"form-item"},E().createElement("label",null,"对比对象"),E().createElement(fe.RS,_()({value:r,onChange:this.handleChangeCompareObj},ke),xe.slice(1===m.length?1:0,3).map(function(e,t){return E().createElement(fe.Wx,{key:t,label:e.label,value:e.value},e.label)}))),"AVG"===r&&E().createElement("div",{className:"form-item"},E().createElement("label",null),E().createElement(fe.RS,_()({value:i,onChange:this.handleChangeAvgCompareType},ke),Ne.map(function(e,t){return E().createElement(fe.Wx,{key:t,label:e+"的平均值",value:t},e+"的平均值")}))),"SELECT"===r&&E().createElement("div",{className:"form-item"},E().createElement("label",null),E().createElement(fe.RS,_()({value:h||[],onChange:this.handleChangeAnalyseObj},Ae),p&&0<p.length&&p.map(function(e,t){return E().createElement(fe.Wx,{key:t,label:e.name,value:e.name},e.name)}))),E().createElement("div",{className:"form-item"},E().createElement("label",null,"对比时间"),E().createElement(fe.RS,_()({value:o,onChange:this.handleChangeCompareTime},ke),De.map(function(e,t){return E().createElement(fe.Wx,{key:t,label:e,value:t},e)}))),1===o&&E().createElement("div",{className:"form-item"},E().createElement("label",null),E().createElement(fe.RS,_()({value:s,onChange:this.handleChangeDateRangeType},ke),_e.map(function(e,t){return E().createElement(fe.Wx,{key:t,label:e+"同期",value:t},e+"同期")}))),0!==o&&E().createElement("div",{className:"form-item"},E().createElement("label",null,"当前"),E().createElement(g.Input,{value:l.join("~"),disabled:!0})),(1===o||2===o)&&E().createElement("div",{className:"form-item"},E().createElement("label",null,"对比"),E().createElement(g.Input,{value:c.join("~"),disabled:!0})),3===o&&"AVG"===r&&E().createElement("div",{className:"form-item"},E().createElement("label",{title:"对比"},"对比"),E().createElement(Se,{type:"calendar",value:c,getDateRange:this.handleSetCompareDate,disabledDate:a})),u&&0<u.length&&"AVG"!==r&&u.map(function(e,t){return d[t]?E().createElement("div",{key:t,className:"form-item",style:{display:3===o?"block":"none"}},E().createElement("label",{title:e},e),E().createElement(Se,{type:"calendar",value:d[t],getDateRange:n.handleSetDateParamsList,index:t,disabledDate:a})):null}),E().createElement("div",null,E().createElement(g.Button,{type:"primary",onClick:this.onConfirm},"确认"),E().createElement(g.Button,{type:"default",onClick:this.onCancel},"取消"))))},e}(E().Component);Me.propTypes={currDate:t().array.isRequired,selectedObjList:t().array,analyseObjList:t().array,getParams:t().func.isRequired};var Re=s(25713);const Pe=function(t){function e(e){var p=t.call(this,e)||this;p._handleChartTypeChange=function(e){var t=p.state,a=t.filterParams,n=t.statisticType;p.state.chartType!==e&&(t={},"c1"===e?(t.rangeClicked="r1",t.rangeObject="negative",t.rangeType=p.state.isR1Desc?"desc":"asc"):"c2"===e?(t.rangeClicked="r2",t.rangeObject="positive",t.rangeType=p.state.isR2Desc?"desc":"asc"):(t.rangeClicked=p.state.rangeClicked,t.rangeObject="r1"===p.state.rangeClicked?"negative":"positive",t.rangeType="negative"===t.rangeObject?p.state.isR1Desc?"desc":"asc":p.state.isR2Desc?"desc":"asc"),p.setState(_()({},p._updateTitleValue(a,t.rangeObject,e,n),{chartType:e},t),function(){return p._updateRefreshData()}))},p._handleOnRangeClick=function(e){var t={rangeClicked:e};t["is"+e.toUpperCase()+"Desc"]=!p.state["is"+e.toUpperCase()+"Desc"],p.setState(_()({rangeType:t["is"+e.toUpperCase()+"Desc"]?"desc":"asc",rangeObject:"r1"===e?"negative":"positive"},t),function(){return p._updateRefreshData()})},p._handleOnStatisticChange=function(e){var t=p.state,a=t.filterParams,n=t.rangeObject,t=t.chartType,e=e.type;p.setState(_()({},p._updateTitleValue(a,n,t,e),{statisticType:e}),function(){return p._updateRefreshData()})},p._updateTitleValue=function(e,t,a,n){var r=p.props.chartType;return{title:e.filterModel.analysis.name+(0<e.filterModel.aspect.aspect1.length?"一级指标":"二级指标")+("emotion"===r&&("c0"===a||"c3"===a||"c4"===a)?"情感":"positive"===t?"正面情感":"负面情感")+"分析-"+ne.find(function(e){return e.type===n}).title}},p._updateRefreshData=function(){var e=p.props.onChange,t=p.state,a=t.chartType,n=t.rangeObject,r=t.rangeType,i=t.statisticType,o=t.showValue,s=t.filterParams,l=t.compareData,c=t.time;e({filterParams:s,compareData:l,controlState:{title:t.title,time:c,chartType:a,rangeObject:n,rangeType:r,statisticType:i,showValue:o}})},p._handleOnFilterChange=function(t){var e=p.props.getParams,a=p.state,n=a.filterParams,r=a.rangeObject,i=a.statisticType,o=a.chartType,a=e(),e=a.dateFilter,a=a.filterModel;!t&&n?p.setState({filterParams:{filterModel:_()({},n.filterModel,JSON.parse(JSON.stringify(a))),dateFilter:e},currDate:[e.from,e.to]},function(){return p._updateRefreshData()}):t&&(!t.analysis||t.analysis.values&&0===t.analysis.values.length||!t.aspect||0===t.aspect.aspect1.length&&0===t.aspect.aspect2.length||t.treeId&&(t.analysis&&"CONNCONFIG"===t.analysis.type&&(t.analysis.type="CONN_CONFIG"),t.analysis&&"EXPANDTOPIC"===t.analysis.type&&(t.analysis.type="EXPAND_TOPIC"),n=p.refs.AnalyzeFilter&&p.refs.AnalyzeFilter.refs.AnalyzeObject.getSecondLevelList(),a.connConfig&&(a.connConfig=a.connConfig.map(function(e){return t.analysis.id===e.id&&(e.values=t.analysis.values),e})),a={dateFilter:e,filterModel:_()({},JSON.parse(JSON.stringify(a)),JSON.parse(JSON.stringify(t)))},p.setState(_()({},p._updateTitleValue(a,r,o,i),{objList:n,isMutiObject:a.filterModel.analysis.values&&1<a.filterModel.analysis.values.length,filterParams:a,currDate:[e.from,e.to]}),function(){return p._updateRefreshData()})))},p._handleOnMoreClick=function(e){var t=p.props.parentRef;"image"===e?t.refs.chart.refs.bar.downloadImage():"excel"===e?t.refs.chart.refs.bar.downloadExcel():"compare"===e?p.refs.SettingDialog.openSettingDialog():"alert"===e&&p.alertRef.current.wrappedInstance.visibleToggle()},p._handleOnCompareChange=function(e){p.setState({compareData:e},function(){return p._updateRefreshData()})},p._handleCommonOptionChange=function(e){var t,a,n,r=_()({},e);"rangeObject"===Object.keys(e)[0]&&(t=(n=p.state).filterParams,a=n.chartType,n=n.statisticType,r.title=p._updateTitleValue(t,e.rangeObject,a,n).title),p.setState(_()({},r),function(){return p._updateRefreshData()})},p._handleOnAlertSettingOk=function(){var e=p.state.filterParams;p.setState({filterParams:_()({},e,{dirty:!e.dirty})},function(){return p._updateRefreshData()})};e=e.type.includes("trend")?ae:te;return p.alertRef=E().createRef(),p.state=_()({},ce,{chartTypeOptions:e,title:"...",isMutiObject:!1,filterData:void 0,compareData:void 0,filterParams:void 0,currDate:[],objList:void 0,isR1Desc:!0,isR2Desc:!0,rangeClicked:"r1"}),p}return i()(e,t),e.prototype.render=function(){var t=this,e=this.props,a=e.model,n=e.projectId,r=e.type,i=e.chartType,o=this.state,s=o.chartType,l=o.rangeObject,c=o.showValue,p=o.chartTypeOptions,u=o.time,d=o.title,h=o.objList,m=o.currDate,f=(o.filterParams,o.compareData),g="c0"===s,y="c1"===s,v="c2"===s,e="c10"===s,o=JSON.parse(JSON.stringify(ie));"emotion"===i?(y?o[0].options=[{key:"negative",value:"负面高到低"}]:v&&(o[0].options=[{key:"positive",value:"正面高到低"}]),g||e||(o=o.filter(function(e){return"showValue"!==e.type})),e&&(o=o.filter(function(e){return"rangeObject"!==e.type}))):"trend"===i&&(o=o.filter(function(e){return"rangeObject"!==e.type}));g="emotion"===i&&e||"trend"===i,e=g?le:le.filter(function(e){return"compare"!==e.type}),r=r.includes("time");return E().createElement("div",{className:"analysis-haeder-container"},E().createElement("div",{className:"title-zone"},E().createElement("span",{className:"title"},d)),E().createElement("div",{className:"control-pad"},E().createElement(ee,{ref:"AnalyzeFilter",onChange:this._handleOnFilterChange,model:a,projectId:n,type:"trend"===i?i:void 0}),E().createElement(pe,{onStatisticChange:this._handleOnStatisticChange}),g&&E().createElement(me.Z,{objName:"rangeObject",activeObj:l,onChange:this._handleCommonOptionChange,options:oe}),r&&E().createElement(me.Z,{objName:"time",activeObj:u,onChange:this._handleCommonOptionChange,options:se}),E().createElement("span",{className:"chart-type-btns-wrapper"},Object.keys(p).map(function(e){return E().createElement(N.Z,{key:e,placement:"top",overlay:p[e][2]},E().createElement("span",{style:{paddingTop:10}},E().createElement(de.Z,{onClick:function(){return t._handleChartTypeChange(e)},isActive:s===e,defaultIcon:p[e][0],activeIcon:p[e][1]})))})),E().createElement("span",{className:"chart-type-btns-no-divider-wrapper"},E().createElement(N.Z,{placement:"top",overlay:"设置"},E().createElement("span",{style:{paddingTop:10}},E().createElement(he,{options:o,onChange:this._handleCommonOptionChange,chosenOptions:{rangeObject:l,showValue:c}})))),E().createElement("span",{className:"chart-type-btns-no-divider-wrapper"},E().createElement(N.Z,{placement:"top",overlay:"更多"},E().createElement("span",{style:{paddingTop:10}},E().createElement(Re.Z,{options:e,onClick:this._handleOnMoreClick})))),E().createElement(Me,{ref:"SettingDialog",selectedObj:f&&f.selectedObj?f.selectedObj:[],selectedObjList:h?h.valueList.map(function(e){return e.name}):[],analyseObjList:h?h.list:[],currDate:m,compareTime:f?f.compareTime:0,dateRangeType:f?f.dateRangeType:0,compareDate:f?f.compareDate:[],avgCompareType:f?f.avgCompareType:0,getParams:this._handleOnCompareChange})))},e}(E().PureComponent);function Ie(e,t,a){var n={borderRadius:"11px",color:"#8c8c8c"};return 0===a?(n.backgroundColor="#D96969",n.color="#ffffff"):1===a?(n.backgroundColor="#D3A615",n.color="#ffffff"):2===a&&(n.backgroundColor="#1574B3",n.color="#ffffff"),E().createElement("div",{style:_()({},n,{display:"inline-block",width:20,height:20})},a+1)}function je(n,r,i){return function(e,t,a){t="normal"!==n&&n||t.prop,a=e[t]||i[a][t],t=0;return 0<a&&(t="s1"===r?(0,We.ao)(a):(.01<(t=new Ve.Decimal(100*a))?t.toFixed(2):t.toExponential(2))+"%"),E().createElement("span",{style:{color:"#8C8C8C"}},t)}}function Le(t,e){var o=e.chartType,s=e.statisticType,l=e.isMultiple;return e.aspects.map(function(i){var e;return _()(((e={})["指标"]=i,e),t.reduce(function(e,t){var a,n=t.data.find(function(e){return e.title===i}),r=l?"c1"===o||"c2"===o?((a={})[t.title]=n[(0,We.yc)(s,"c1"===o?"negative":"positive")],a):((a={})[t.title+" 负面"]=n[(0,We.yc)(s,"negative")],a[t.title+" 正面"]=n[(0,We.yc)(s,"positive")],a):((r={})["负面"]=n[(0,We.yc)(s,"negative")],r["正面"]=n[(0,We.yc)(s,"positive")],r);return _()({},e,r)},{}))})}function Fe(n,r,e){var t=e.chartType,i=e.statisticType,e=n[0],o="c1"===t||"c2"===t?1:2,e=(t=Object.keys(e).filter(function(e){return"指标"!==e})).slice(0,1+o),s=t.slice(o).map(function(e){return{text:e,value:e}});return e.reduce(function(e,t,a){t=a<o?{label:t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",{className:"cell-title"},e.label)},render:je("normal",i,n)}:{label:r||t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",{className:"cell-title-more",title:e.label},e.label)},render:je(r,i,n),filters:s,filterMultiple:!1,className:"other-columns",filterMethod:function(){return!0}};return[].concat(e,[t])},[{label:"排序",headerAlign:"center",align:"center",width:50,render:Ie},{label:"指标",prop:"指标",headerAlign:"center",align:"center",width:100}])}function ze(n,r,e){var i=e.statisticType,e=n[0],o=Object.keys(e).filter(function(e){return"分析对象"!==e}),e=o.slice(0,3),s=o.slice(3).map(function(e){return{text:e,value:e}});return e.reduce(function(e,t,a){t=a<2?{label:t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",{className:"cell-title"},e.label)},render:je("normal",i,n)}:3<o.length?{label:r||t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",{className:"cell-title-more",title:e.label},e.label)},render:je(r,i,n),filters:s,filterMultiple:!1,className:"other-columns",filterMethod:function(){return!0}}:{label:r||t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",null,e.label)},render:je(r,i,n)};return[].concat(e,[t])},[{label:"排序",headerAlign:"center",align:"center",width:50,render:Ie},{label:"分析对象",prop:"分析对象",headerAlign:"center",align:"center",width:100}])}function Be(n,r,e){var i=e.statisticType,e=n[0],o=Object.keys(e).filter(function(e){return"日期"!==e}),e=o.slice(0,3),s=o.slice(2).map(function(e){return{text:e,value:e}}),s=r?s.filter(function(e){return e.text!==r}):s.slice(1);return e.reduce(function(e,t,a){t=o.length<=3?{label:t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",{className:"cell-title"},e.label)},render:je("normal",i,n)}:a<2?{label:t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",{className:"cell-title"},e.label)},render:je("normal",i,n)}:{label:r||t,prop:t,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return E().createElement("span",{className:"cell-title-more",title:e.label},e.label)},render:je(r,i,n),filters:s,filterMultiple:!1,className:"other-columns",filterMethod:function(){return!0}};return[].concat(e,[t])},[{label:"日期",prop:"日期",headerAlign:"center",align:"center",width:100}])}var c=s(70596),Ye=s.n(c),We=s(33905),Ve=s(93776);const Ze=function(t){function e(e){var d=t.call(this,e)||this;return d.refreshTable=function(e,t){var a,n,i,o,s,r,l,c=t.chartType,p=d.props.type,u=c!==d.state.chartType||JSON.stringify(a)!==JSON.stringify(d.state.tableDatas)?void 0:d.state.tableDTDefaultFilter;"emotion"===p?n="c10"!==c?(a=Le(e,t),Fe(a,u,t)):(r=t.rangeObject,l=t.statisticType,a=e.map(function(e){var t;return e.data.reduce(function(e,t){return _()({},e,((e={})[t.title]=t[(0,We.yc)(l,r)],e))},((t={})["分析对象"]=e.title,t))}),ze(a,u,t)):"trend"===p&&(i=t.statisticType,o=t.rangeObject,a=(s=e.filter(function(e){return"solid"===e.type}))[0].data.map(function(e){return e.title}).map(function(r){var e;return _()(((e={})["日期"]=r,e),s.reduce(function(e,t){var a=t.data.find(function(e){return e.title===r});if(!a)return _()({},e);var n=((n={})[t.title]=a[(0,We.yc)(i,o)],n);return _()({},e,n)},{}))}),n=Be(a,u,t)),d.setState({chartData:e,mOption:t,tableDatas:a,columns:n})},d._handleOnFilterChange=function(e){var t,a=d.state,n=a.tableDatas,r=a.mOption,i=r.chartType,a=d.props.type,e=Object.values(e)[0];"emotion"===a?t=("c10"!==i?Fe:ze)(n,e,r):"trend"===a&&(t=Be(n,e,r)),d.setState({columns:t})},d.state={tableDTDefaultFilter:void 0,tableDatas:[],option:{},columns:[],chartData:[]},d}i()(e,t);var a=e.prototype;return a.componentDidUpdate=function(){},a.render=function(){var e=this.state,t=e.columns,a=e.tableDatas,e=e.mOption;return 0!==a.length?E().createElement(g.Table,{className:"analysis-table-style",id:"table",border:!1,onFilterChange:this._handleOnFilterChange,maxHeight:e.chartHeight,columns:t,data:a}):null},e}(E().PureComponent);function He(t){return{symbol:["none","none"],label:{position:"start",formatter:function(e){return"s1"===t?Math.abs(e.value):100*Math.abs(e.value)+"%"}}}}function Je(e,t,a){return e?("c1"===t?We.t7:We.rf)[a]:We.ch["c1"===t?0:1]}function Ue(r,e,t,i,a,n,o){var s,l,c,p=1<a.length,u=JSON.parse(JSON.stringify($e));u.tooltip.formatter=(s=r,l=i,c=a[0].aspectRel,function(e){var n=Array(e.length);return e.forEach(function(e,t){var a;e.seriesName.includes("not_show")?n.splice(n.length-1,1):("s2"===l||"s3"===l||"s4"===l||"s5"===l?(a=new Ve.Decimal(Math.abs(100*e.data)),a=0===e.data?0:(.01<a?a.toFixed(2):a.toExponential(2))+"%"):"s1"===l&&(a=Math.abs(e.data)),a=""+e.marker+e.seriesName+": "+a,"c0"===s||"c3"===s||"c4"===s||"c5"===s?t%2==0?n[t+1]=a:n[t-1]=a:"c1"!==s&&"c2"!==s||(n[t]=a))}),(c?c[e[0].axisValue]+"-":"")+e[0].axisValue+"<br/>"+n.join("<br/>")});var d=0;u.yAxis.data=a[0].data.map(function(e){e=e.title;return d=0<d-e.length?d:e.length,e});var h=12*d+10;u.grid.left=h=h<50?50:h,!p&&"c5"!==r||(u.yAxis.axisTick={show:!0,inside:!0,length:1e4,lineStyle:{color:"#EBEBEB",type:"dashed"}}),"c0"===r&&(u.title={text:a[0].title,textStyle:{fontSize:16,fontWeight:"bold"}}),u.xAxis.axisLabel.formatter="s1"!==i?function(e){return 0===e?0:Math.abs(100*e)+"%"}:function(e){return Math.abs(e)},u.legend.formatter=function(e){var t=e.lastIndexOf(" ");return p?"c1"===r||"c2"===r?e.substring(0,t):e:e.substring(t+1)};var m,f,g,y,v,C,E,b,O,w=(m=r,f=a.length,g=u.yAxis.data.length,y=JSON.parse(JSON.stringify(We.kQ)),v=y.barWidth,w=y.height,C=y.barCategoryGap,E=y.barGap,b=y.marginBottom,O=y.marginTop,h=.9*document.getElementsByClassName("analysis-index-container")[0].clientHeight,E=parseFloat(E)/100,O=(f*(v=(v="c5"===m?Math.floor((h-C*g)/(g*(2+E))):Math.floor((h/g-C)/(f+(f-1)*E)))<5?5:21<v?21:v)+(f-1)*E*v+C)*g+b+O,w=O<w?w:O,_()({},y,{barWidth:v,height:w}));u.mOption={rangeObject:e,chartType:r,statisticType:i,isMultiple:p,chartHeight:w.height,aspects:u.yAxis.data};var S,T,x=_()({label:{show:"c0"===r&&"yes"===n,position:"right",formatter:function(e){if("s1"===i)return Math.abs(e.data);var t=Math.abs(100*e.data);return 0===e.data?0:(.01<t?t.toFixed(2):t.toExponential(2))+"%"}},type:"bar"},w);if("c1"===r||"c2"===r)u.series=a.map(function(e,t,a){var n=e.title+" "+("c1"===r?"负面":"正面");return u.legend.data.push({name:n,icon:"rect"}),_()({},x,{id:e.id+"-"+("c1"===r?qe:Ke),name:n,itemStyle:{color:Je(p,p?"c2":r,t)},data:e.data.map(function(e){return e[(0,We.yc)(i,"c1"===r?qe:Ke)]})})}),u.series[0].markLine=_()({},He(i),{data:o[Qe[r]].map(function(e){return{xAxis:e,lineStyle:{normal:{color:"c2"===r?We.ch[1]:We.ch[0],type:"dashed"}}}})});else{"c0"===r||"c3"===r?(S=a.map(function(e,t,a){var n=e.data.map(function(e){return e[(0,We.yc)(i,Ke)]});return _()({},x,{id:e.id+"-"+Ke,name:e.title+" 正面",stack:e.title,itemStyle:{color:Je(p,"c2",t)},data:n,maxData:Math.max.apply(Math,n)})}),T=a.map(function(e,t){var a=e.data.map(function(e){return-1*e[(0,We.yc)(i,qe)]});return _()({},x,{label:_()({},x.label,{position:"left"}),id:e.id+"-"+qe,name:e.title+" 负面",stack:e.title,itemStyle:{color:Je(p,"c1",t)},data:a,minData:Math.min.apply(Math,a)})})):"c4"===r?(S=a.map(function(e,t){return _()({},x,{id:e.id+"-"+Ke,name:e.title+" 正面",stack:e.title,itemStyle:{color:Je(p,"c2",t)},data:e.data.map(function(e){return e[(0,We.yc)(i,Ke)]})})}),T=a.map(function(e,t){return _()({},x,{id:e.id+"-"+qe,name:e.title+" 负面",stack:e.title,itemStyle:{color:Je(p,"c1",t)},data:e.data.map(function(e){return e[(0,We.yc)(i,qe)]})})})):"c5"===r&&(S=a.map(function(e,t){return _()({},x,{id:e.id+"-"+Ke,name:e.title+" 正面",itemStyle:{color:Je(p,"c2",t)},data:e.data.map(function(e){return e[(0,We.yc)(i,Ke)]})})}),T=a.map(function(e,t){return _()({},x,{id:e.id+"-"+qe,name:e.title+" 负面",itemStyle:{color:Je(p,"c1",t)},data:e.data.map(function(e){return e[(0,We.yc)(i,qe)]})})}));for(var N,D=0;D<S.length;D++)u.legend.data.push({name:T[D].name,icon:"rect"}),u.legend.data.push({name:S[D].name,icon:"rect"}),"c0"===r||"c3"===r||"c4"===r?(u.series.push(T[D]),u.series.push(S[D])):"c5"===r&&(u.series.push(S[D]),u.series.push(T[D]));"c0"===r&&(w=Math.max.apply(Math,S.map(function(e){return e.maxData})),a=Math.abs(Math.min.apply(Math,T.map(function(e){return e.minData}))),N=0===w&&0===a?"s1"===i?2:1:w===a||w<a?1.1*a:"s1"===i&&1===w?2:w,u.series.push(_()({},x,{itemStyle:{normal:{color:"rgba(0,0,0,0)"}},name:"not_show_neg",silent:!0,barGap:"-100%",label:{show:!1},data:u.yAxis.data.map(function(e){return-N})})),u.series.push(_()({},x,{itemStyle:{normal:{color:"rgba(0,0,0,0)"}},name:"not_show_pos",silent:!0,barGap:"-100%",label:{show:!1},data:u.yAxis.data.map(function(e){return N})}))),u.series[0].markLine=_()({},He(i),{data:["POSITIVE","NEGATIVE"].reduce(function(e,t){return[].concat(e,o[t].map(function(e){return{xAxis:"s1"===i?e:parseFloat(e.substring(0,e.length-1))/100*("POSITIVE"===t?1:-1),label:{normal:{show:"yes"===n}},lineStyle:{normal:{color:"POSITIVE"===t?We.ch[1]:We.ch[0],type:"dashed"}}}}))},[])})}return u}function Ge(e,a,i,t,n,r,o,s){var l=t[0],c=l.maxList,p=(0,We.yc)(i,a),u=l.data.map(function(e){return e.title}),d=0===(d="s1"===i?"positive"===a?l.maxPositive:l.maxNegative:1)?1:1<d?Math.ceil(1.2*d):1.2*d,r=r[a.toUpperCase()],h=""+We.ch["negative"===a?0:1];return{color:We.rf,grid:{left:80,right:40,bottom:We.kQ.marginBottom,top:We.kQ.marginTop},tooltip:{textStyle:Xe,padding:10,backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);",formatter:function(r){return u.reduce(function(e,t,a){var n=r.value[a];return"s1"!==i&&(a=new Ve.Decimal(100*n),n=0===n?0:(.01<a?a.toFixed(2):a.toExponential(2))+"%"),[].concat(e,['<span style="display: inline-block; min-width: 100px;">'+t+"："+n+"</span>"])},""+r.marker+r.name).join("<br/>")}},legend:{data:t.map(function(e){return{name:e.title,icon:"solid"===e.type?"roundRect":"pin"}}),type:"scroll",show:!0,left:0,right:45,itemWidth:11,itemHeight:3},radar:{splitArea:{show:!0},center:["50%","55%"],splitLine:{lineStyle:{color:"#C1C1C1"}},axisLine:{lineStyle:{color:"#C1C1C1"}},indicator:u.map(function(e){return{name:e,max:c[p][e]}})},series:[{id:"-"+a,type:"radar",data:[].concat(t.map(function(e,t){return{value:e.data.map(function(e){return e[p]}),name:e.title,label:{show:t===o&&t!==s},lineStyle:{normal:{type:e.type,opacity:.7},emphasis:{type:e.type,opacity:1}},areaStyle:{normal:{opacity:0===t?.1:0}}}}),r.map(function(t){return t<d?{value:u.map(function(e){return t}),silent:!0,name:("negative"===a?"负面情感":"正面情感")+"预警线",symbol:"yes"===n?"pin":"none",label:{normal:{fontSize:10,show:"yes"===n,color:h+"aa",formatter:function(e){return 0===e.value?0:1<e.value?e.value:100*e.value+"%"}}},lineStyle:{normal:{color:h,type:"dotted",opacity:.5}}}:{}}))}],mOption:{chartHeight:.6*document.getElementsByClassName("analysis-index-container")[0].clientHeight,statisticType:i,chartType:e,isMultiple:!0,rangeObject:a,aspects:u}}}var qe="negative",Ke="positive",Qe={c1:"NEGATIVE",c2:"POSITIVE"},Xe={color:"#262626",fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"},$e={textStyle:Xe,grid:{left:80,right:40,bottom:We.kQ.marginBottom,top:We.kQ.marginTop,splitLine:{show:!1}},legend:{type:"scroll",data:[],show:!0,itemWidth:11,itemHeight:11,pageIconSize:12},tooltip:{trigger:"axis",padding:10,axisPointer:{type:"none"},textStyle:Xe,backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);"},xAxis:{type:"value",axisTick:!1,axisLine:{lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1},axisLabel:{interval:0}},yAxis:{inverse:!0,triggerEvent:!0,type:"category",axisTick:!1,axisLine:{lineStyle:{color:"#EBEBEB"}},axisLabel:{interval:0}},series:[]},et=function(t){function e(e){var n=t.call(this,e)||this;return n.downloadImage=function(){var e=n.props.refreshState,t=e.chartType,a=e.title;setTimeout(function(){var e;"c0"===t?0===n.charts.length||(1<n.charts.length?(e=n.charts.map(function(e){return e.getOption().title[0].text}),(0,Z.OH)(n.charts,a,e)):(e=n.charts[0],(0,Z._v)(e,e.getOption().title[0].text))):(0,Z._v)(n.chart,a)},0)},n.downloadExcel=function(){var e=n.props.refreshState,t=e.title,a=e.chartType,e=e.chartData,e="c0"===a?Le(e,_()({},n.mOption,{isMultiple:!0})):n.refs.analysisTable.state.tableDatas,e=[""].concat(e).map(function(e,t,a){return 0===t?Object.keys(a[1]):Object.values(a[t])});(0,Z.aT)([e],t)},n._renderMutilChart=function(){var e=n.props.refreshState.chartData;return E().createElement("ul",null,e.map(function(e,t,a){return E().createElement("li",{key:t,className:"divided-chart half-width"},E().createElement("div",{className:"divided-analysis-chart"},E().createElement("div",{id:""+n.state.barId+t,style:{width:"100%",minHeight:We.kQ.height}})))}))},n._renderSigleChart=function(){return E().createElement("div",{className:"analysis-chart"},E().createElement("div",{className:"analysis-bar"},E().createElement("div",{id:n.state.barId,style:{width:"100%",minHeight:We.kQ.height}})),E().createElement("div",{className:"analysis-table"},E().createElement(Ze,{ref:"analysisTable",type:"emotion"})))},n._renderEmpty=function(){return E().createElement("div",{className:"no-data"},E().createElement("img",{src:s(76180)}),E().createElement("span",null,"暂无可用数据"))},n.mOption=void 0,n.state={barId:e.model+"-"+e.type+"-"+e.refreshState.chartType+"-chart",lastIndex:void 0},n.chart=void 0,n.charts=[],n}i()(e,t);var a=e.prototype;return a._refreshChart=function(){var n=this,e=this.props.refreshState,r=e.chartType,i=e.rangeObject,o=(e.rangeType,e.statisticType),a=e.chartData,s=e.showValue,l=e.warningList;a&&("c0"===r?(this.charts=this.charts.slice(0,a.length),a.forEach(function(e,t){var a=Ue(r,i,0,o,[e],s,l),e=n.charts[t];e&&(e.clear(),e.dispose()),(e=Ye().init(document.getElementById(""+n.state.barId+t))).on("click",function(e){return n.props.onChartClick(e)}),e.setOption(a),e.resize({width:"auto",height:a.mOption.chartHeight}),n.mOption=a.mOption,n.charts[t]=e})):(e="c10"===r?Ge(r,i,o,a,s,l):Ue(r,i,0,o,a,s,l),this.chart&&(this.chart.clear(),this.chart.dispose()),this.chart=Ye().init(document.getElementById(this.state.barId)),"c10"!==r&&this.chart.on("click",function(e){return n.props.onChartClick(e)}),this.chart.on("click",function(e){var t=e.dataIndex,e=n.state.lastIndex,e="c10"===r&&Ge(r,i,o,a,s,l,t,e);n.chart.setOption(e),t===n.state.lastIndex?n.setState({lastIndex:void 0}):n.setState({lastIndex:t})}),this.chart.setOption(e),this.chart.resize({width:"auto",height:e.mOption.chartHeight}),this.mOption=e.mOption,this.refs.analysisTable.refreshTable(a,e.mOption)))},a.componentDidUpdate=function(e){JSON.stringify(e.refreshState)!==JSON.stringify(this.props.refreshState)&&this._refreshChart()},a.resize=function(){this.chart&&this.chart.resize(),this.charts&&this.charts instanceof Array&&this.charts.forEach(function(e){return e.resize()})},a.render=function(){var e=this.props.refreshState,t=e.chartData,e=e.chartType;return E().createElement("div",{className:"analysis-bar-container"},t?0<t.length?"c0"===e?this._renderMutilChart():this._renderSigleChart():this._renderEmpty():null)},e}(E().Component),tt=["无时间比","同比","环比","相对时间"];const at=function(t){function e(e){var d=t.call(this,e)||this;return d.setMaxList=function(r){var e=r[0],t=Object.keys(e.data[0]).filter(function(e){return"title"!==e}),a=e.data.map(function(e){return e.title}),t=t.reduce(function(e,n){return _()({},e,((e={})[n]=a.reduce(function(e,t,a){return _()({},e,((e={})[t]=Math.max.apply(Math,r.map(function(e){return e.data[a][n]})),e))},{}),e))},{});e.maxList=t},d.setAspectList=function(e,t){var n,r,i,a,o=JSON.parse(JSON.stringify(e)),s=d.props.headerRef;0<o.filterModel.aspect.aspect2.length?(e=o.filterModel.aspect.aspect2,o=JSON.parse(V.t.get(V.V.aspect)),n=Object.keys(o).reverse(),r=Object.values(o).reverse(),i=-1,a=e.reduce(function(e,t){var a;return-1!==i&&r[i].includes(t)?_()({},e,((a={})[t]=n[i],a)):(i=r.findIndex(function(e){return e.includes(t)}),_()({},e,((e={})[t]=n[i],e)))},{}),t.forEach(function(e){e.aspectRel=a})):(t=t[0].data.map(function(e){return e.title}),s&&s.refs.AnalyzeFilter.refs.AnalyzeIndex.orderAspect(t))},d.refresh=function(e){var t=d.props,a=t.projectId,n=t.refreshData,r=t.onLoading,t=t.model,n=n.controlState,i=n.rangeObject,o=n.rangeType,s=n.statisticType,l=_()({projectId:a,name:t,otherInfo:Object.keys(te).map(function(e){return"emotion-"+e})},e,{type:"RADAR_CHART"});r(!0),h.h.post("/analysis/data",l).then(function(e){var t=e.data,e=[];2e4===t.code&&(e=t.result.list.map(function(e){return _()({},e,{type:"solid"})}),e=(0,We.KT)(i,o,s,e),d.setMaxList(e),d.setAspectList(l,e)),d.setState({filterModel:JSON.parse(JSON.stringify(l.filterModel)),dateFilter:JSON.parse(JSON.stringify(l.dateFilter)),chartData:e,warningData:t.result.warningTypeData,cChartData:e.slice()},function(){return r(!1)})})},d.fetchCompareData=function(e){var t=e.dateFilters,a=e.values,n=e.type,r=e.compareTime,i="AVG"!==n?"-"+tt[r]:"",o=d.props,s=o.projectId,e=o.refreshData,l=o.onLoading,r=d.state,o=r.filterModel,c=r.chartData,p=e.controlState,u={projectId:s,dateFilters:t,filterModel:_()({},o,{analysis:_()({},o.analysis,{values:a})}),type:"RADAR_CHART",compareType:n};l(!0),h.h.post("/widget/data/compare/find/RADAR_CHART",u).then(function(e){var t=e.data,e=[].concat(c);2e4===t.code&&(e=[].concat(e,t.result.list.map(function(e){return _()({},e,{title:e.title+i,type:"dashed"})})),e=(0,We.KT)(p.rangeObject,p.rangeType,p.statisticType,e),d.setMaxList(e),d.setAspectList(u,e)),d.setState({cChartData:e,cFilterModel:u.filterModel,cDateFilter:u.dateFilters},function(){return l(!1)})})},d._handleOnChartClick=function(e){var t=e.componentType;"yAxis"===t?d._handleYAxisClick(e):"series"===t&&d._handleBarClick(e)},d._handleYAxisClick=function(e){var t=e.value,a=d.props.headerRef,n=d.state,e=n.filterModel,n=n.dateFilter;t&&(d.lastAspectObj?(a.refs.AnalyzeFilter.refs.AnalyzeIndex.setAspectFromOutside(d.lastAspectObj),d.refresh({filterModel:_()({},e,{aspect:_()({},d.lastAspectObj)}),dateFilter:n}),d.lastAspectObj=void 0):(t=a.refs.AnalyzeFilter.refs.AnalyzeIndex.getSndIndex(t))&&0<t.length&&(d.lastAspectObj=e.aspect,d.refresh({filterModel:_()({},e,{aspect:{aspect1:[],aspect2:JSON.parse(JSON.stringify(t))}}),dateFilter:n})))},d._handleBarClick=function(e){var t=e.seriesId,a=e.seriesName,n=e.data,r=e.name,i=e.dataIndex,o=d.state,s=o.filterModel,l=o.dateFilter,c=o.chartData,p=d.props,u=p.name,e=p.projectId,o=t.split("-"),p=o[0],t=o[1],o=a.lastIndexOf(" "),t={projectId:e,leftName:u,analyseName:-1!==o?a.substring(0,o):a,type:"EMOTION_ASPECT_LEVEL_BAR",aspect:r,aspectTotal:n,seriesName:"positive"===t?"正面":"负面",dateFilter:_()({},l),analysisObjs:c.map(function(e){return e.id}),filterModel:_()({},s,{analysis:_()({},s.analysis,{values:[void 0!==p?p:c[i].id]}),aspect:{aspect1:s.aspect.aspect1.filter(function(e){return e===r}),aspect2:s.aspect.aspect2.filter(function(e){return e===r}),emotion:[t]}})};window.open("/tab/detail?"+encodeURIComponent(JSON.stringify(t)))},d.state={filterModel:void 0,dateFilter:void 0,chartData:void 0,diffData:void 0,cChartData:void 0,warningData:void 0,loading:!0},d}i()(e,t);var a=e.prototype;return a.componentDidMount=function(){var e=this.props.refreshData.filterParams;this.refresh(e)},a.componentDidUpdate=function(e,t){var a=this.props,n=a.refreshData,r=(a.onLoading,e.refreshData),i=e.headerRef,o=t.filterModel,s=n.controlState,l=n.filterParams,c=n.compareData,a=r.controlState,e=r.filterParams,t=r.compareData,n=this.state,r=n.filterModel,n=n.chartData;s.rangeObject===a.rangeObject&&s.rangeType===a.rangeType&&s.statisticType===a.statisticType||(n=(0,We.KT)(s.rangeObject,s.rangeType,s.statisticType,n),0<r.aspect.aspect1.length&&(r=n[0].data.map(function(e){return e.title}),i.refs.AnalyzeFilter.refs.AnalyzeIndex.orderAspect(r)),this.setState({chartData:n})),JSON.stringify(l)!==JSON.stringify(e)&&(0<l.filterModel.aspect.aspect1.length&&o&&0<o.aspect.aspect2.length&&(this.lastAspectObj=void 0),this.refresh(l)),JSON.stringify(c)!==JSON.stringify(t)&&this.fetchCompareData(c)},a.render=function(){var e=this.props,t=e.model,a=e.refreshData.controlState,n=this.state,r=n.chartData,e=n.cChartData,n=n.warningData,r="c10"===a.chartType?e:r,n=n?n["emotion-"+a.chartType][re[a.statisticType]]:{POSITIVE:[],NEGATIVE:[]};return E().createElement(et,{type:"emotion",onChartClick:this._handleOnChartClick,model:t,refreshState:_()({},a,{chartData:r,warningList:n}),ref:"bar"})},e}(E().Component),nt=function(a){function e(e){var t=a.call(this,e)||this;return t._handleOnChange=function(e){t.setState({refreshData:e})},t._handleOnLoading=function(e){t.setState({loading:e})},t.state={refreshData:void 0,loading:!1},t}return i()(e,a),e.prototype.render=function(){var e=this.state,t=e.refreshData,a=e.loading,e=this.props.headerReady;return E().createElement(g.Loading,{loading:!e||a,className:"analysis-bar-chart-loading",text:"拼命加载中"},E().createElement("div",{className:"analysis-container"},e&&E().createElement(Pe,_()({key:"1"},this.props,{type:["emotion"],chartType:"emotion",ref:"Header",parentRef:this,onChange:this._handleOnChange})),t&&E().createElement("div",{style:{display:e&&t?"block":"none"}},E().createElement(at,_()({},this.props,{refreshData:t,onLoading:this._handleOnLoading,headerRef:this.refs.Header,ref:"chart"})))))},e}(E().Component);var rt={color:"#262626",fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"};const it=function(t){function e(e){var a=t.call(this,e)||this;return a._renderEmpty=function(){return E().createElement("div",{className:"no-data"},E().createElement("img",{src:s(76180)}),E().createElement("span",null,"暂无可用数据"))},a.downloadImage=function(){var e=a.props.refreshState.title;(0,Z._v)(a.chart,e)},a.downloadExcel=function(){var e=a.props.refreshState.title,t=a.refs.analysisTrendTable.state.tableDatas,t=[""].concat(t).map(function(e,t,a){return 0===t?Object.keys(a[1]):Object.values(a[t])});(0,Z.aT)([t],e)},a._renderChart=function(){return E().createElement("div",{className:"analysis-chart"},E().createElement("div",{className:"analysis-bar"},E().createElement("div",{id:a.state.barId,style:{width:"100%",minHeight:We.kQ.height}})),E().createElement("div",{className:"analysis-table"},E().createElement(Ze,{ref:"analysisTrendTable",type:"trend"})))},a.state={barId:e.model+"-"+e.type+"-"+e.refreshState.chartType+"-chart"},a.chart=void 0,a}i()(e,t);var a=e.prototype;return a._refreshChart=function(){var n,a,r,t=this,e=this.props.refreshState,i=e.chartType,o=e.rangeObject,s=(e.rangeType,e.statisticType),l=e.chartData,e=e.showValue;l&&(i=i,o=o,n=s,s=l,a=e,r=(0,We.yc)(n,o),e=s[0].data.map(function(e){return e.title}),e={textStyle:rt,color:We.rf,grid:{left:80,right:40,bottom:We.kQ.marginBottom+50,top:We.kQ.marginTop+20},tooltip:{textStyle:rt,trigger:"axis",padding:10,backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);",formatter:function(e){return e.reduce(function(e,t){var a=0===(a=t.value)?0:"s1"===n||0===a?a:(100*a).toFixed(2)+"%";return[].concat(e,['<span style="display: inline-block; min-width: 100px;">'+t.marker+t.seriesName+"："+a+"</span>"])},e[0].axisValueLabel).join("<br/>")}},legend:{data:s.map(function(e){return{name:e.title,icon:"solid"===e.type?"roundRect":"pin"}}),type:"scroll",show:!0,left:0,right:45,itemWidth:11,itemHeight:3},xAxis:{type:"category",boundaryGap:!1,data:e},yAxis:{type:"value",splitLine:{show:!1},axisLabel:{interval:0}},dataZoom:[{type:"inside"},{type:"slider"}],series:[].concat(s.map(function(e,t){return{type:"line",symbol:"yes"===a?"circle":"none",name:e.title,label:{normal:{show:"yes"===a,position:"top",formatter:function(e){return 0===e.value?0:1<e.value?e.value:(100*e.value).toFixed(2)+"%"}}},data:e.data.map(function(e){return Number.isInteger(e[r])?e[r]:Math.round(1e4*e[r])/1e4}),lineStyle:{normal:{type:e.type}}}})),mOption:{chartHeight:.6*document.getElementsByClassName("analysis-index-container")[0].clientHeight,statisticType:n,rangeObject:o,chartType:i,isMultiple:!0,titles:e}},"s1"!==n&&(e.yAxis.axisLabel.formatter=function(e){return 0===e?0:(Number.isInteger(100*e)?100*e:(100*e).toFixed(2))+"%"}),e=e,this.chart&&(this.chart.clear(),this.chart.dispose()),this.chart=Ye().init(document.getElementById(this.state.barId)),this.chart.on("click",function(e){return t.props.onChartClick(e)}),this.chart.setOption(e),this.chart.resize({width:"auto",height:e.mOption.chartHeight}),this.refs.analysisTrendTable.refreshTable(l,e.mOption))},a.componentDidUpdate=function(e){JSON.stringify(e.refreshState)!==JSON.stringify(this.props.refreshState)&&this._refreshChart()},a.resize=function(){this.chart&&this.chart.resize(),this.charts&&this.charts instanceof Array&&this.charts.forEach(function(e){return e.resize()})},a.render=function(){var e=this.props.refreshState.chartData;return E().createElement("div",{className:" analysis-trend-container "},e?0<e.length?this._renderChart():this._renderEmpty():null)},e}(E().PureComponent);var ot=["无时间比","同比","环比","相对时间"];const st=function(t){function e(e){var c=t.call(this,e)||this;return c.activeRefresh=function(){var e=c.props.refreshData.filterParams;c.refresh(e)},c.refresh=function(e){var t=c.props,a=t.projectId,n=t.refreshData,r=t.onLoading;t.model;if(n){var n=n.controlState,i=_()({projectId:a},e,{dateFilter:_()({},e.dateFilter,{dateGroupType:n.time}),type:"ASPECT_TREND_LINE"});if(i.filterModel.connConfig){n=i.filterModel.connConfig.find(function(e){return e.id===i.filterModel.analysis.id});if(!n)return;i.filterModel.analysis.values=n.values}r(!0),h.h.post("/widget/data/find/ASPECT_TREND_LINE",i).then(function(e){var t=e.data,e=[];2e4===t.code&&(e=t.result.list.map(function(e){return _()({},e,{type:"solid"})})),c.setState({filterModel:i.filterModel,dateFilter:i.dateFilter,chartData:e},function(){return r(!1)})})}},c.fetchCompareData=function(e){var t=e.dateFilters,a=e.values,n=e.type,r=e.compareTime,i="AVG"!==n?"-"+ot[r]:"",o=c.props,e=o.projectId,s=o.onLoading,r=c.state,o=r.filterModel,l=r.chartData,t={projectId:e,filterModel:_()({},o,{analysis:_()({},o.analysis,{values:a})}),dateFilters:t,type:"ASPECT_TREND_LINE",compareType:n};s(!0),h.h.post("/widget/data/compare/find/ASPECT_TREND_LINE",t).then(function(e){var t=e.data,e=[].concat(l.filter(function(e){return"solid"===e.type}));2e4===t.code&&"NONE"!==n&&(e=[].concat(l,t.result.list.map(function(e){return _()({},e,{title:e.title+i,type:"dashed"})}))),c.setState({chartData:e},function(){return s(!1)})})},c.state={filterModel:void 0,dateFilter:void 0,chartData:void 0,loading:!0},c}i()(e,t);var a=e.prototype;return a.componentDidUpdate=function(e){var t=this.props.refreshData,a=e.refreshData,n=t.controlState,r=t.filterParams,i=t.compareData,e=a.controlState,t=a.filterParams,a=a.compareData;JSON.stringify(r)===JSON.stringify(t)&&n.time===e.time||this.refresh(r),JSON.stringify(i)!==JSON.stringify(a)&&this.fetchCompareData(a)},a.render=function(){var e=this.props,t=e.model,a=e.refreshData.controlState,e=this.state.chartData;return E().createElement(it,{ref:"bar",type:"trend",model:t,refreshState:_()({},a,{chartData:e})})},e}(E().PureComponent),lt=function(a){function e(e){var t=a.call(this,e)||this;return t._handleOnChange=function(e){t.setState({refreshData:e})},t._handleOnLoading=function(e){t.setState({loading:e})},t.state={refreshData:void 0,loading:!1},t}return i()(e,a),e.prototype.render=function(){var e=this.state,t=e.refreshData,a=e.loading,e=this.props.headerReady;return E().createElement(g.Loading,{loading:!e||a,className:"analysis-trend-chart-loading",text:"拼命加载中"},E().createElement("div",{className:"analysis-container"},e&&E().createElement(Pe,_()({},this.props,{ref:"Header",key:"2",type:["emotion","time","trend"],chartType:"trend",parentRef:this,onChange:this._handleOnChange})),t&&E().createElement("div",{style:{display:e&&t?"block":"none"}},E().createElement(st,_()({},this.props,{refreshData:t,onLoading:this._handleOnLoading,headerRef:this.refs.Header,ref:"chart"})))))},e}(E().PureComponent),ct=function(a){function e(e){var t=a.call(this,e)||this;return t.refreshChart=function(e){t.refs.overViewChart.refreshChart(e),t.props.headerReady&&(t.refs.analysisChart&&t.refs.analysisChart.refs.Header&&t.refs.analysisChart.refs.Header._handleOnFilterChange(),t.refs.analysisTrendChart&&t.refs.analysisTrendChart.refs.Header&&t.refs.analysisTrendChart.refs.Header._handleOnFilterChange())},t.resize=function(){t.refs.overViewChart&&t.refs.overViewChart.resize(),t.refs.analysisChart&&t.refs.analysisChart.refs.chart&&t.refs.analysisChart.refs.chart.refs.bar.resize(),t.refs.analysisTrendChart&&t.refs.analysisTrendChart.refs.chart&&t.refs.analysisTrendChart.refs.chart.refs.bar.resize()},t._handleOnTabClick=function(e){"2"!==e.props.name||t.tab2Inited||(t.tab2Inited=!0,t.refs.analysisTrendChart&&t.refs.analysisTrendChart.refs.chart&&t.refs.analysisTrendChart.refs.chart.activeRefresh()),t.resize()},t.tab2Inited=!1,t}return i()(e,a),e.prototype.render=function(){return E().createElement("div",{className:"analysis-index-container",style:{overflow:"scroll",height:"100%"}},E().createElement(J,_()({},this.props,{ref:"overViewChart"})),E().createElement("div",{className:"divider"}),E().createElement(g.Tabs,{className:"analysis-chart-tab-wrapper",onTabClick:this._handleOnTabClick},E().createElement(g.Tabs.Pane,{label:"正负面情感对比",name:"1"},E().createElement(nt,_()({},this.props,{ref:"analysisChart"}))),E().createElement(g.Tabs.Pane,{label:"指标走势对比",name:"2"},E().createElement(lt,_()({},this.props,{ref:"analysisTrendChart"})))))},e}(E().Component);var pt=s(39432);R().locale("zh-cn");var ut=["COUNTER_NUM","COUNTER_TIME_STACK_AREA_LINE"],dt=function(t){function e(e){var o=t.call(this,e)||this;return o.resizeFontSize=function(){var e=.03*o.flexWrapper.offsetWidth;document.getElementById("flexSpan").style.fontSize=e+"px";e=document.documentElement.clientWidth;o.divider.style.margin=e<1593?"0 4px":"0 16px";for(var t=document.getElementsByClassName("category"),a=0;a<t.length;a++)t[a].style.marginRight="4px"},o.resize=function(){o.flexWrapper&&(o.resizeFontSize(),o.chart&&o.chart.resize())},o.getOption=function(){var e=o.state,t=e.data,a=e.CATEGORY_TITLES,n=function(e){var n=[];return e.forEach(function(e){var t=document.createElement("canvas"),a=t.getContext("2d");document.body.appendChild(t),a.font="14px Arial",document.body.removeChild(t);e=a.measureText(e);n.push(e.width)}),Math.max.apply(Math,n)},r=n(a.map(function(e){return e.name})),e=n(a.map(function(e){return pt.ZP.formatNumber(e.count)})),n=r+e;return{title:{padding:[0,0,0,20],text:"数据量详情",textStyle:{fontSize:14}},legend:_()({},W.I.legend,{right:0,top:34,type:"scroll",pageIconSize:12,data:a.map(function(e){return{name:""+e.name,icon:"circle"}}),formatter:function(t){return"{a|"+t+"}{b|"+pt.ZP.formatNumber(a.filter(function(e){return e.name===t})[0].count)+"}"},textStyle:{rich:{a:{width:r},b:{width:e,align:"right"}}}}),grid:_()({},W.I.grid,{right:n+25+32,top:35}),xAxis:_()({},W.I.xAxis,{boundaryGap:!1,axisPointer:{show:!0},data:t[0].list.map(function(e){return e.time})}),yAxis:_()({},W.I.yAxis,{axisLabel:{show:!0,color:"#999"}}),tooltip:_()({},W.I.tooltip,{trigger:"axis",confine:!0,axisPointer:{type:"cross",label:{backgroundColor:"rgb(0, 0, 0)",margin:10,formatter:function(e){return"number"==typeof e.value?e.value.toFixed(0):e.value}}},formatter:function(e){return e[0].name+e.map(function(e){return"<br/>"+e.marker+e.seriesName+"："+e.value}).reverse().join("")}}),series:a.map(function(e,t){return{name:e.name,showSymbol:!1,type:"line",stack:"数据来源",areaStyle:{color:W.o[t],opacity:1},itemStyle:{normal:{color:W.o[t]}},smooth:.4,smoothMonotone:"none",data:e.data}}).reverse()}},o.clickChart=function(e){"expandTopic"!==o.state.analyzeObject.type?e&&(e=o.getParams(e),-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(e)))):K.Z.warning("当前分析对象为组合分析，不可跳转")},o.switchDateDimension=function(e){o.setState({queryTimeType:e,dateDimensionReady:!0},function(){o.fetchData()})},o.analyzeObjectChange=function(){!o.analysis||JSON.stringify(o.state.analyzeObject)===JSON.stringify(o.analysis.getValue())&&o.state.analysisObjReady||o.setState({analyzeObject:o.analysis.getValue(),analysisObjReady:!0},function(){return o.fetchData()})},o.downloadChart=function(){(0,Z._v)(o.chart.chart,"数据量详情图")},o.getChartData=function(){var e=o.state.data,n=e.map(function(e){return e.name}),r={};e.forEach(function(t){t.list.forEach(function(e){r[e.time]=r[e.time]||{},r[e.time][t.name]=e.total})});var t,i=[];for(t in r)!function(t){var a=[t];n.forEach(function(e){return a.push(r[t][e])}),i.push(a)}(t);n.unshift("日期"),i.splice(0,0,n),(0,Z.aT)([i],"数据量详情图")},o.state={total:0,today:0,average:0,data:[{}],loading:!0,queryTimeType:{},analyzeObject:{},analysisObjReady:!1,dateDimensionReady:!1},o}i()(e,t);var a=e.prototype;return a.componentDidUpdate=function(e,t){this.flexWrapper&&this.resizeFontSize()},a.formatNum=function(e){return 0<=e&&e<1e3?e:e<1e4?(e/1e3).toFixed(2)+"千":(e/1e4).toFixed(2)+"万"},a.fetchTotalData=function(){var n=this,e=this.props.getParams();h.h.post("/widget/data/find",_()({},e,{projectId:V.t.get(V.V.curProject).id,type:"COUNTER_NUM"})).then(function(e){var t,a=JSON.parse(e.data.result);a&&(t=a.total,e=a.today,a=a.avgDay,n.setState({total:t,today:e,average:a}))})},a.fetchData=function(){var a=this,e=this.props.getParams(),t=JSON.parse(JSON.stringify(this.state)).analyzeObject;e.dateFilter.dateGroupType=this.state.queryTimeType,this.state.analysisObjReady&&this.state.dateDimensionReady&&e.dateFilter.from&&(t.id&&("connConfig"===t.type?t.type="CONN_CONFIG":"expandTopic"===t.type?t.type="EXPAND_TOPIC":t.type=t.type.toUpperCase(),e.filterModel.analysis=t),this.setState({loading:!0},function(){return h.h.post("/widget/data/find/COUNTER_TIME_STACK_AREA_LINE",_()({},e,{projectId:V.t.get(V.V.curProject).id})).then(function(e){var e=e.data.result.list,t=[];e&&0<e.length&&e.map(function(e){return t.push({id:e.id,name:e.name,count:e.list.map(function(e){return e.total}).reduce(function(e,t){return e+t}),data:e.list.map(function(e){return e.total})})}),a.setState({data:e,CATEGORY_TITLES:t,loading:!1})})}))},a.refreshChart=function(){this.fetchTotalData(),this.fetchData()},a.getParams=function(e){var t,a,n,r=this,i=this.state,o=i.CATEGORY_TITLES,s=i.queryTimeType,l=this.props.getParams();return l.type=ut[1],l.projectId=V.t.get(V.V.curProject).id,e&&(t=e.seriesName,(n=e.name)&&(a=n,i=n,"MONTH"===s?(a=(e=R()(n)).startOf("month").format("YYYY-MM-DD"),i=e.endOf("month").format("YYYY-MM-DD")):"WEEK"===s&&(n=n.split("-"),a=(n=R()(n[0]).week(n[1])).startOf("week").format("YYYY-MM-DD"),i=n.endOf("week").format("YYYY-MM-DD")),l.dateFilter.from=a,l.dateFilter.to=i),l.dateFilter.dateGroupType=s,o.forEach(function(e){if(e.name===t)switch(r.state.analyzeObject.type){case"source":l.filterModel.source=[e.id];break;case"connConfig":l.filterModel.connConfig=[{id:r.state.analyzeObject.id,special:"connConfig",values:[e.id]}]}})),l},a.render=function(){var t=this,e=this.state,a=e.data,n=e.total,r=e.today,i=e.average,o=e.loading,e=e.queryTimeType;return E().createElement("div",{className:"overviewTopWrapper"},E().createElement(g.Loading,{loading:o,text:"拼命加载中",style:{zIndex:10}},0<a.length?E().createElement("div",null,E().createElement("div",{className:"detailChart-top",ref:function(e){return t.flexWrapper=e}},E().createElement("div",null,E().createElement("div",null,E().createElement("span",null,"数据量"),E().createElement(N.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:"数据量为一定筛选条件和时间范围内提取到的有效评论数，不包含已被“无效消息”功能标记的无效消息。"},E().createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative"}}))),E().createElement("div",{style:{height:"62px"}},E().createElement(N.Z,{placement:"top",overlay:n},E().createElement("span",{id:"flexSpan",style:{fontSize:"50px"}},this.formatNum(n))),E().createElement("span",{style:{color:"#8C8C8C"}},"/ 总量")),E().createElement("div",null,E().createElement("div",null,E().createElement("span",{className:"category"},"今日"),E().createElement(N.Z,{placement:"top",overlay:r},E().createElement("span",null,this.formatNum(r)))),E().createElement("div",{ref:function(e){return t.divider=e}},"|"),E().createElement("div",null,E().createElement("span",{className:"category"},"日均"),E().createElement(N.Z,{placement:"top",overlay:i},E().createElement("span",null,this.formatNum(i)))))),E().createElement("div",{className:"chart-wrapper"},E().createElement("div",{className:"time-btn-wrapper"},E().createElement(A.Z,{style:{float:"right"},onDownChartClick:this.downloadChart,onDownExcelClick:this.getChartData}),E().createElement(k.Z,{defaultValue:e,uniqueId:"overview-top-saved-date-dimension",onChange:this.switchDateDimension,style:{float:"right"}}),E().createElement(U.ZP,{ref:function(e){return t.analysis=e},style:{float:"right",marginRight:"12px"},onChange:this.analyzeObjectChange,defaultSelValue:{id:"source"},left:-276})),!o&&E().createElement(Y.Z,{ref:function(e){return t.chart=e},uniqueId:"overviewTop",option:this.getOption(),height:166,clickChart:this.clickChart})))):E().createElement("div",{className:"noDataTips"},E().createElement("img",{src:s(76180)}),E().createElement("span",null,"暂无可用数据"))),E().createElement("div",{className:"dashed-divider"}))},e}(E().Component),t=s(37316),ht=s.n(t),c=s(55609),mt=s(8201),ft=s(70715),gt=s(87300),yt={n:"名词",a:"形容词",un:"其他"},vt=[{title:"比例",value:"rate"},{title:"数量",value:"count"}],Ct=[{type:"image",title:"导出图片"},{type:"data",title:"导出数据"},{type:"config",title:"偏好设置"}],t=function(r){function e(){for(var t,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(t=r.call.apply(r,[this].concat(a))||this).chartRef=void 0,t.barDatas=void 0,t.getChartRef=function(e){return t.chartRef=e},t}i()(e,r);var t=e.prototype;return t.renderChart=function(e,t,a){this.setValue(e,a),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,a))},t.setValue=function(e,t){this.barDatas={positiveData:("count"===t?e.sort(function(e,t){return t.positiveCount-e.positiveCount}):e.sort(function(e,t){return t.posRate-e.posRate})).slice(0,10),negativeData:("count"===t?e.sort(function(e,t){return t.negativeCount-e.negativeCount}):e.sort(function(e,t){return t.negRate-e.negRate})).slice(0,10)}},t.getOption=function(e,a){var l=this;return{title:{top:20,text:e},grid:[{x:"3%",y:"20%",width:"92%",height:"25%"},{x:"3%",y2:"8%",width:"92%",height:"25%"}],tooltip:{trigger:"axis",showDelay:200,hideDelay:500,enterable:!0,padding:0,position:function(e,t,a,n,r){var i=r.contentSize,o=r.viewSize,r=e[0]<o[0]/2?0:-1,o=e[1]<o[1]/2?-.5:-1;return[e[0]+r*i[0]+(r?-10:10),e[1]+o*i[1]]},formatter:function(i,o,s){return setTimeout(function(){var e=i[0],t=e.marker,a=e.name,n=e.data,r=e.seriesName,r=[("positive"===r?"正面":"负面")+"声量："+(0,pt.hE)(n[r+"Count"]),"声量占比："+(100*n[r.substring(0,3)+"Rate"]).toFixed(2)+"%"];n.pos&&r.push("词性："+yt[n.pos]),s(o,(0,gt.r)(t+" "+a,r,[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return l.handleOnMsgClick(e)}}]))},0)}},graphic:[{type:"group",top:"13%",silent:!0,children:[{type:"text",left:15,style:{text:"TOP 10 热词",font:"bolder 12px "+ft.I8,fill:"#262626"}},{type:"text",left:100,style:{text:"(正面消息"+("count"===a?"数量":"比例")+")",font:"normal 12px "+ft.I8,fill:"#8C8C8C"}}]},{type:"group",top:"58%",silent:!0,children:[{type:"text",left:15,style:{text:"TOP 10 热词",font:"bolder 12px "+ft.I8,fill:"#262626"}},{type:"text",left:100,style:{text:"(负面消息"+("count"===a?"数量":"比例")+")",font:"normal 12px "+ft.I8,fill:"#8C8C8C"}}]}],xAxis:["positive","negative"].map(function(a,e){return{gridIndex:e,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{interval:0,formatter:function(e,t){t=l.barDatas[a+"Data"][t].pos;return t?"{"+t+"|"+e+"}":e},rich:{n:{color:"#61799b"},a:{color:"#d07b49"},un:{color:"#626262"}}},data:l.barDatas[a+"Data"].map(function(e){return e.name})}}),yAxis:["positive","negative"].map(function(e,t){return{gridIndex:t,axisLabel:{show:!1},axisLine:{show:!1},splitLine:{show:!0,lineStyle:{color:"#E8E8E8",type:"dashed"}}}}),series:["positive","negative"].map(function(t,e){return{type:"bar",name:t,barWidth:30,xAxisIndex:e,yAxisIndex:e,data:l.barDatas[t+"Data"].map(function(e){return _()({},e,{value:"count"===a?e[t+"Count"]:e[t.substring(0,3)+"Rate"],escore:["positive"===t?1:-1]})})}})}},e}(E().Component),Et=s(50976),bt=s(59132),Ot=function(n){function e(e){var c=n.call(this,e)||this;return c.renderChart=function(){var e=c.props,t=e.data,a=e.title,e=c.state.formulaType;(0,mt.P)(t)&&c.chartRef&&n.prototype.renderChart.call(C()(c),t,a,e)},c._handleOnMoreClick=function(e){var n,r,t,a,i=c.props,o=i.data,s=i.onConfig,i=i.title,l=c.state.formulaType;c.chartRef&&"image"===e?(0,Z._v)(c.chartRef,i):(0,mt.P)(o)&&"data"===e?("rate"===l?(n="posRate",r="negRate",t="正面比例",a="负面比例"):"count"===l&&(n="positiveCount",r="negativeCount",t="正面声量",a="负面声量"),t=c.barDatas.positiveData.reduce(function(e,t,a){0===a&&t.pos&&e[0].push("词性");a=t[n],a=[t.name,"rate"===l?(100*a).toFixed(2)+"%":a];return t.pos&&a.push(yt[t.pos]),e.push(a),e},[["热词",t]]),a=c.barDatas.negativeData.reduce(function(e,t,a){0===a&&t.pos&&e[0].push("词性");a=t[r],a=[t.name,"rate"===l?(100*a).toFixed(2)+"%":a];return t.pos&&a.push(yt[t.pos]),e.push(a),e},[["热词",a]]),(0,Z.aT)([[].concat(t,[""],a)],i)):"config"===e&&s&&s()},c._handleOnStatChange=function(e){c.setState({formulaType:e},function(){return c.renderChart()})},c._handleOnMouseover=function(e){var t=e.componentType,a=e.componentSubType,n=e.name,e=e.data;"series"===t&&"bar"===a&&window.postMessage({from:"product_overview_double_bar_chart",action:"mouseover",pos:e.pos,param:{name:n,componentType:t,componentSubType:"wordCloud"}})},c._handleOnMouseout=function(e){var t=e.componentType,e=e.componentSubType;"series"===t&&"bar"===e&&window.postMessage({from:"product_overview_double_bar_chart",action:"mouseout",param:{componentType:t,componentSubType:"wordCloud"}})},c.handleOnMsgClick=function(e){var t=c.props,a=t.title;(0,t.onChartClick)(e,a)},c.dialogRef=void 0,c.state={formulaType:"rate"},c}i()(e,n);var t=e.prototype;return t.componentDidMount=function(){var n=this;this.internalId=setInterval(function(){var e,t,a;n.chartRef&&(clearInterval(n.internalId),n.renderChart(),t=(e=n.chartRef._dom.children)[0],a=e[1],t.addEventListener("mouseleave",function(e){n.chartLeaveTimeout=setTimeout(function(){n.chartLeaveTimeout&&(a.style.display="none")},2e3)}),a&&a.addEventListener("mouseenter",function(e){n.chartLeaveTimeout=void 0}))},200)},t.componentDidUpdate=function(e,t){var a=e.data,e=this.props.data;JSON.stringify(a)!==JSON.stringify(e)&&this.renderChart(),!(0,mt.P)(e)&&this.chartRef&&(this.chartRef=void 0)},t.render=function(){var e=this.state.formulaType,t=this.props,a=t.data,n=t.title,r=t.loading,i=t.className,i=void 0===i?"":i;return t.enableConfig||Ct.splice(2,1),E().createElement(E().Fragment,null,E().createElement(mt.Z,{className:"yt_product_overview_double_bar_chart_wrapper "+i,loading:r,data:a,renderTitle:E().createElement(bt.Z,{title:n,data:a,onMoreClick:this._handleOnMoreClick,moreOptions:Ct},E().createElement(me.Z,{options:vt,activeObj:e,onChange:this._handleOnStatChange}))},E().createElement(Et.Z,{theme:"yunting_pos_neg",option:{},style:{height:"100%",width:"100%"},onChartReady:this.getChartRef,onEvents:{mouseover:this._handleOnMouseover,mouseout:this._handleOnMouseout}})))},e}(t),t=s(23279),wt=s.n(t),St={n:"#61799b",a:"#d07b49",un:"#626262"},Tt={n:"名词",a:"形容词",un:"其他"};const xt=function(e){var t=e.data,a=e.style,n=e.getRef,e=E().useState(1),i=e[0],r=e[1],e=t.slice(20*(i-1),20*i);return E().createElement("div",{className:"wordlist-wrapper",style:a,ref:n},E().createElement("div",{className:"title"},"词频表"),E().createElement("div",{className:"list"},e.map(function(e,t){var a,n=t+1+20*(i-1),r=e.pos?St[e.pos]:n<11?ft.Fq[t%ft.Fq.length]:"#8c8c8c";return E().createElement(N.Z,{key:e.name+"_"+t,placement:"top",overlay:E().createElement(E().Fragment,null,E().createElement("div",{dangerouslySetInnerHTML:{__html:'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+r+';"></span> '+e.name}}),e.pos&&E().createElement("div",null,"词性："+Tt[e.pos]))},E().createElement("div",{className:"item"},E().createElement("span",{className:"index",style:{background:r}},n),E().createElement("span",{className:"name"},e.name),E().createElement("span",{className:"total"},(n=e.total)?n/1e4<1?n:n/1e8<1?(n/1e4).toFixed(a||0)+"万":(n/1e8).toFixed(a||0)+"亿":0),E().createElement("span",{className:"precent"},"("+(100*e.precent).toFixed(2)+"%)")))})),E().createElement("div",{className:"pagination"},E().createElement(g.Pagination,{layout:"prev, pager, next",small:!0,total:t.length,pageSize:20,currentPage:i,onCurrentChange:function(e){return r(e)}})))};function Nt(e){return'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+e+';"></span>'}function Dt(e){return'<span style="color: #8c8c8c">('+(100*e).toFixed(2)+"%)</span>"}function _t(t,a,n,r){setTimeout(function(){var e={type:a,seriesIndex:0,seriesName:"overview-wordcloud"};r?e.dataIndex=r:n&&(e.name=n),t.dispatchAction(e)},0)}var kt={n:"#61799b",a:"#d07b49",un:"#626262",pos:"#00B76E",neu:"#0074B8",neg:"#D96969"},At={n:"名词",a:"形容词",un:"其他"},Mt=[{type:"image",title:"导出图片"},{type:"data",title:"导出数据"},{type:"config",title:"偏好设置"}],Rt=[{title:"TOP 10 ",value:10},{title:"TOP 20 ",value:20},{title:"TOP 40 ",value:40},{title:"TOP 100 ",value:100}],t=function(r){function e(){for(var t,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(t=r.call.apply(r,[this].concat(a))||this).chartRef=void 0,t.tableRef=void 0,t.graphPieData=void 0,t.wordData=void 0,t.getChartRef=function(e){return t.chartRef=e},t.getTableRef=function(e){return t.tableRef=e},t}i()(e,r);var t=e.prototype;return t.renderChart=function(e,t){this.setValue(e),this.updateChart(t)},t.setValue=function(e){this.wordData=e.map(function(e){return _()({},e,{value:Math.sqrt(e.total),escore:[-1,0,1]})});var t=Math.sqrt(e[0].total);this.graphPieData=e.slice(0,10).map(function(e){return _()({},e,{rate:Math.sqrt(e.total)/t})})},t.updateChart=function(e){this.chartRef&&this.chartRef.clear(),0===e?(this.chartRef.setOption(this.getGraphOption()),this.chartRef.setOption(this.getPieOption())):1===e&&this.chartRef.setOption(this.getWordCloudOption())},t.getGraphOption=function(){var e=this.chartRef.getHeight()-60,t=this.chartRef.getWidth()-60,a=e<t?e:t;return{series:[{type:"graph",layout:"force",silent:!0,animation:!1,legendHoverLink:!1,force:{repulsion:[.4*a,.8*a],gravity:.11,layoutAnimation:!1},data:this.graphPieData.map(function(e){return{symbolSize:e.rate*a/3}})}]}},t.getPieOption=function(){var c=this,e=this.chartRef.getHeight(),t=this.chartRef.getWidth(),r=e<t?e:t;return{color:ft.Rt,tooltip:{showDelay:200,hideDelay:500,enterable:!0,padding:0,position:function(e,t,a,n,r){var i=r.contentSize,o=r.viewSize,r=e[0]<o[0]/2?0:-1,o=e[1]<o[1]/2?-.5:-1;return[e[0]+r*i[0]+(r?-10:10),e[1]+o*i[1]]},formatter:function(o,s,l){return setTimeout(function(){var e,t,a=o.marker,n=o.data,r=n.value,i=n.name,n=n.total;"label"!==i?(e=a+" "+i,t=["声量："+r,"占比："+(r/n*100).toFixed(2)+"%"],n.pos&&t.push("词性："+At[n.pos])):(e=n.name+"："+n.total,t=[Nt(kt.neg)+" 负面："+(0,pt.hE)(n.negativeCount)+" "+Dt(n.negativeCount/n.total),Nt(kt.neu)+" 中性："+(0,pt.hE)(n.neutralCount)+" "+Dt(n.neutralCount/n.total),Nt(kt.pos)+" 正面："+(0,pt.hE)(n.positiveCount)+" "+Dt(n.positiveCount/n.total)],n.pos&&t.push(Nt(kt[n.pos])+" 词性："+At[n.pos])),l(s,(0,gt.r)(e,t,[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return c._handleOnMsgClick(o)}}]))},0)}},graphic:[{type:"group",top:24,left:20,silent:!0,children:[{type:"text",left:10,style:{text:"TOP 10 热词",font:"bolder 14px "+ft.I8,lineWidth:4,fill:"#262626"}},{type:"text",left:100,style:{text:"(来自全部消息)",font:"normal 14px "+ft.I8,fill:"#8C8C8C"}}]}],series:this.chartRef._zr.storage._displayList.map(function(e,t){var a=c.graphPieData[t],n=a.rate*r/3*.35,t=c.chartRef.convertToPixel({seriesIndex:0},[e.transform[4]+30,e.transform[5]+30]),e=26*a.rate,e=e*a.name.length>2*(n-10)?2*(n-10)/a.name.length:e;return{type:"pie",name:a.name,center:t,hoverOffset:4,radius:[n-5,n],label:{normal:{show:!0,position:"center",formatter:"{a|"+a.name+"}",rich:{a:{color:a.pos?kt[a.pos]:"#262626",fontSize:e,fontFamily:ft.I8}}}},itemStyle:{shadowBlur:10,shadowColor:"rgba(155,155,155,0.5)",borderColor:"#ffffff",borderWidth:.5},data:[{value:a.positiveCount,name:"正面",realName:a.name,total:a.total,escore:[1]},{value:a.neutralCount,name:"中性",realName:a.name,total:a.total,escore:[0]},{value:a.negativeCount,name:"负面",realName:a.name,total:a.total,escore:[-1]},{value:0,name:"label",total:a,realName:a.name,escore:[-1,0,1]}]}})}},t.getWordCloudOption=function(){var h=this;return{graphic:[{type:"group",top:24,left:20,silent:!0,children:[{type:"text",left:10,style:{text:"热词",font:"bolder 14px "+ft.I8,fill:"#262626"}},{type:"text",left:45,style:{text:"(来自全部消息)",font:"normal 14px "+ft.I8,fill:"#8C8C8C"}}]}],tooltip:{showDelay:200,hideDelay:500,enterable:!0,padding:0,position:function(e,t,a,n,r){var i=r.contentSize,o=r.viewSize,r=e[0]<o[0]/2?0:-1,o=e[1]<o[1]/2?-.5:-1;return[e[0]+r*i[0]+(r?-10:10),e[1]+o*i[1]]},formatter:function(p,u,d){return setTimeout(function(){var e=p.marker,t=p.data,a=t.name,n=t.total,r=t.pos,i=t.positiveCount,o=t.posRate,s=t.negativeCount,l=t.negRate,c=t.neutralCount,t=t.neuRate,o=["负面："+s+" "+Dt(l),"中性："+c+" "+Dt(t),"正面："+i+" "+Dt(o)];r&&o.push("词性："+At[r]),d(u,(0,gt.r)(e+' <span style="font-weight: bold">'+a+": "+n+"</span>",o,[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return h._handleOnMsgClick(p)}}]))},0)}},series:[{type:"wordCloud",name:"overview-wordcloud",gridSize:8,sizeRange:[12,60],rotationRange:[0,0],width:"95%",height:"85%",data:this.wordData,textStyle:{normal:{color:function(e){var t=e.dataIndex,e=e.data.pos;return e?kt[e]:ft.Fq[t%We.rf.length]}},emphasis:{color:"#D8D8D8"}}}]}},e}(E().PureComponent),Pt=function(a){function e(e){var i=a.call(this,e)||this;return i.renderChart=function(){var e=i.props.data,t=i.state.type;(0,mt.P)(e)&&i.chartRef&&a.prototype.renderChart.call(C()(i),e,t)},i._handleOnMessageReceive=function(e){var t=e.data;i.chartRef&&"product_overview_double_bar_chart"===t.from&&("mouseover"===t.action?(-1<(e=i.wordData.findIndex(function(e){return e.name===t.param.name&&e.pos===t.pos}))&&(t.param.dataIndex=e),i._handleOnMouseOver(t.param)):"mouseout"===t.action&&i._handleOnMouseOut(t.param))},i._handleOnTopChange=function(e){var t=i.props.data,a=void 0;if(100!==e)for(var a=[],n=t.length-1;e<=n;n--)a.push(t[n].name);i.setState({top:e,hightlightNames:a},function(){1===i.state.type&&(_t(i.chartRef,"downplay",void 0),a&&_t(i.chartRef,"highlight",a))})},i._handleOnMoreClick=function(e){var t=i.props,a=t.data,n=t.onConfig,r=i.state.type,t=0===r?"TOP10热词":1===r?"热词":"词频表";"image"===e?2===r&&i.tableRef?(0,Z.Mx)(i.tableRef,t):i.chartRef&&(0,Z._v)(i.chartRef,t):(0,mt.P)(a)&&"data"===e?(r=(0===r?i.graphPieData:i.wordData).reduce(function(e,t,a){0===a&&t.pos&&e[0].splice(1,0,"词性");a=[t.name,t.total,t.positiveCount,(100*t.posRate).toFixed(2)+"%",t.neutralCount,(100*t.neuRate).toFixed(2)+"%",t.negativeCount,(100*t.negRate).toFixed(2)+"%"];return t.pos&&a.splice(1,0,At[t.pos]),e.push(a),e},[["热词","总声量","正面声量","正面比例","中性声量","中性比例","负面声量","负面比例"]]),(0,Z.aT)([r],t)):"config"===e&&n&&n()},i._handleOnTypeChange=function(e){i.state.type!==e&&i.setState({type:e},function(){2!==e&&setTimeout(function(){i.updateChart(e)},100)})},i._resetChart=function(){var e=i.state.type;0===e&&i.updateChart(e),i.shouldNotCallOutside=!1},i._handleOnMouseOver=function(e){var t=e.componentType,a=e.componentSubType,n=e.name,e=e.dataIndex;1===i.state.type&&(i.shouldNotCallOutside=!0,"series"===t&&"wordCloud"===a&&(_t(i.chartRef,"downplay",n),_t(i.chartRef,"showTip",n,e)))},i._handleOnMouseOut=function(e){var t=e.componentType,a=e.componentSubType;1===i.state.type&&(i.shouldNotCallOutside=!0,e=i.state.hightlightNames,"series"===t&&"wordCloud"===a&&(_t(i.chartRef,"downplay",void 0),e&&_t(i.chartRef,"highlight",e),_t(i.chartRef,"hideTip",void 0)))},i._handleFinished=function(){var e;1!==i.state.type||i.shouldNotCallOutside||(e=i.state.hightlightNames,i.lastFinishTimeoutId||i.setState({wcReady:!1}),i.lastFinishTimeoutId&&clearTimeout(i.lastFinishTimeoutId),i.lastFinishTimeoutId=setTimeout(function(){i.setState({wcReady:!0},function(){e&&(_t(i.chartRef,"downplay",void 0),_t(i.chartRef,"highlight",e))}),i.lastFinishTimeoutId=void 0},100))},i._handleOnMsgClick=function(e){var t=i.state.type;i.props.onChartClick(e,0===t?"TOP10热词（来自全部消息）":1===t?"热词（来自全部消息）":"")},i.lastFinishTimeoutId=void 0,i.shouldNotCallOutside=!1,i.state={type:0,top:100,wcReady:!1,hightlightNames:void 0},i}i()(e,a);var t=e.prototype;return t.componentDidMount=function(){var n=this;this.internalId=setInterval(function(){var e,t,a;n.chartRef&&(clearInterval(n.internalId),n.renderChart(),t=(e=n.chartRef._dom.children)[0],a=e[1],t.addEventListener("mouseleave",function(e){n.chartLeaveTimeout=setTimeout(function(){n.chartLeaveTimeout&&(a.style.display="none")},2e3)}),a&&a.addEventListener("mouseenter",function(e){n.chartLeaveTimeout=void 0}))},200),window.addEventListener("resize",wt()(this._resetChart,200)),window.addEventListener("message",this._handleOnMessageReceive)},t.componentWillUnmount=function(){window.removeEventListener("resize",this._resetChart),window.removeEventListener("message",this._handleOnMessageReceive)},t.componentDidUpdate=function(e,t){var a=e.data,e=this.props.data;JSON.stringify(a)!==JSON.stringify(e)&&this.renderChart(),!(0,mt.P)(e)&&this.chartRef&&(this.chartRef=void 0)},t.render=function(){var e=this,t=this.props,a=t.data,n=t.loading,r=t.className,i=void 0===r?"":r,o=t.enableConfig,s=this.state,r=s.type,t=s.wcReady,s=s.top;return o||Mt.splice(2,1),E().createElement(E().Fragment,null,E().createElement(mt.Z,{className:"yt_graph_pie_word_chart_wrapper "+i,data:a,loading:n,renderTitle:E().createElement(bt.Z,{data:a,title:"",onMoreClick:this._handleOnMoreClick,moreOptions:Mt},1===r&&E().createElement(me.Z,{enable:t,options:Rt,activeObj:s,onChange:this._handleOnTopChange}),E().createElement("span",{className:"buttons"},E().createElement("i",{className:"icon-cem_hotspot icon "+(0===r?"icon-selected":""),onClick:function(){return e._handleOnTypeChange(0)}}),E().createElement("i",{className:"icon-cem_cloud-new icon "+(1===r?"icon-selected":""),onClick:function(){return e._handleOnTypeChange(1)}}),E().createElement("i",{className:"icon-cem_form icon "+(2===r?"icon-selected":""),onClick:function(){return e._handleOnTypeChange(2)}})))},E().createElement(Et.Z,{theme:"yunting_multi_color",option:{},onChartReady:this.getChartRef,style:{width:"100%",height:"100%",display:2!==r?"block":"none"},onEvents:{finished:this._handleFinished,mouseover:this._handleOnMouseOver,mouseout:this._handleOnMouseOut}}),(0,mt.P)(a)&&E().createElement(xt,{getRef:this.getTableRef,data:a,style:{display:2===r?"block":"none"}})))},e}(t),It={callback:void 0,visible:!1,enable:!1,wordTypes:[]};const jt=function(t){function e(e){var n=t.call(this,e)||this;return n._handleOnConfirm=function(){var e=n.state,t=e.callback,a=e.enable,e=e.wordTypes;t&&t({enable:a,wordTypes:e}),n._handleOnCancel()},n._handleOnCancel=function(){n.setState(JSON.parse(JSON.stringify(It)))},n._handleOnEnableChange=function(e){n.setState({enable:e,wordTypes:e?["n","a","un"]:[]})},n._handleOnWordTypeChange=function(e){n.setState({wordTypes:e})},n.state=JSON.parse(JSON.stringify(It)),n}i()(e,t);var a=e.prototype;return a.show=function(e){this.setState(_()({visible:!0},e))},a.render=function(){var e=this.state,t=e.visible,a=e.enable,e=e.wordTypes;return E().createElement(g.Dialog,{title:"偏好设置",className:"yt_product_overview_config_wrapper",size:"tiny",visible:t,onCancel:this._handleOnCancel},E().createElement(g.Dialog.Body,null,E().createElement("div",{className:"item"},E().createElement("span",null,"区分热词词性"),E().createElement(g.Radio.Group,{value:a,onChange:this._handleOnEnableChange},E().createElement(g.Radio,{value:!0},"是"),E().createElement(g.Radio,{value:!1},"否"))),E().createElement("div",{className:"item"},E().createElement("span",null,"词性展示"),E().createElement(g.Checkbox.Group,{value:e,onChange:this._handleOnWordTypeChange},E().createElement(g.Checkbox,{label:"n",disabled:!a},"名词"),E().createElement(g.Checkbox,{label:"a",disabled:!a},"形容词"),E().createElement(g.Checkbox,{label:"un",disabled:!a},"其他")))),E().createElement(g.Dialog.Footer,null,E().createElement(g.Button,{type:"default",onClick:this._handleOnCancel},"取消"),E().createElement(g.Button,{type:"primary",onClick:this._handleOnConfirm},"确定")))},e}(E().PureComponent);const Lt=function(e){var t=e.doublebarDatas,a=e.wordCloudDatas,n=e.loading,r=e.posList,i=e.propEnable,o=e.onChartClick,s=e.onFilterChange,l=G.Z.hasAuthority("HOT_WORD_SETTING"),c=E().useRef(void 0),e=function(){c.current.show({enable:i,wordTypes:r,callback:function(e){var t=e.enable,e=e.wordTypes;s&&s({propEnable:t,posList:e})}})};return E().createElement("div",{className:"overview-obttom-wrapper"},E().createElement(Ot,{className:"left",enableConfig:l,title:"反馈焦点",data:t,loading:n,onFilterChange:s,onChartClick:o,onConfig:e}),E().createElement(Pt,{className:"right",enableConfig:l,data:a,loading:n,onFilterChange:s,onChartClick:o,onConfig:e}),l&&E().createElement(jt,{ref:c}))};var Ft=s(64396).Z.product.overview,t=function(t){function e(e){var o=t.call(this,e)||this;return o.refreshChart=function(){var e=o.props,t=e.getParams,e=e.fetchWordCloudDatas,t=t();e({filterModel:t.filterModel,dateFilter:t.dateFilter,projectId:V.t.get(V.V.curProject).id})},o._handleOnFilterChange=function(e){void 0!==e.propEnable&&o.props.fetchWordCloudDatas(e)},o._handleOnMoreClick=function(e){var t=o.props.wordCloudDatas;if("image"===e.funType)switch(e.chartType){case-1:(0,Z._v)(o.barChartIns,"反馈焦点-柱状图");break;case 0:(0,Z._v)(o.graphPieChartIns,"TOP10热词-气泡图");break;case 1:(0,Z._v)(o.wordcloudChartIns,"热词-词云图")}else{t=t.reduce(function(e,t){return[].concat(e,[[t.name,t.positiveCount,t.neutralCount,t.negativeCount,t.total]])},[["词名","正面","中性","负面","总数"]]);(0,Z.aT)([t],"热词")}},o._handleOnChartClick=function(e,t){var a=e.data,n=a.realName,r=a.name,i=a.escore,e=a.pos,a=(0,o.props.getParams)();a.projectId=V.t.get(V.V.curProject).id,a.filterModel=_()({},a.filterModel,{escore:i}),a.textRankWord=n||r,a.textRankWordPos=e||"",a.filterTip="产品洞察/概览/"+t,window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(a)))},o.event={onFilterChange:o._handleOnFilterChange,onChartClick:o._handleOnChartClick},o.state={},o}return i()(e,t),e.prototype.render=function(){return E().createElement(Lt,_()({},this.state,this.props,this.event))},e}(n.PureComponent);const zt=(0,c.connect)(function(e){var t=e.loading,e=ht()(e,["loading"])[Ft];return{doublebarDatas:e.doublebarDatas,wordCloudDatas:e.wordCloudDatas,propEnable:e.propEnable,posList:e.posList,loading:t.effects[Ft+"/fetchWordCloudDatas"]||!1}},function(t){return{fetchWordCloudDatas:function(e){return t({type:Ft+"/fetchWordCloudDatas",payload:e})}}},null,{withRef:!0})(t);var Bt={overview:["COUNTER_OVERVIEW","COUNTER_PIES_BY_SOURCE","EMOTION_TIME_STACK_BAR","COUNTER_WORD"],product:"EMOTION_ASPECT_LEVEL_BAR",service:"EMOTION_ASPECT_LEVEL_BAR",marketing:"EMOTION_ASPECT_LEVEL_BAR",price:"CONTENT_TABLE"},Yt=function(r){function e(){for(var a,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(a=r.call.apply(r,[this].concat(t))||this).state={index:V.t.get(V.V.curProject).id,type:a.props.type||"product",model:a.props.type||"product",filter:{},headerReady:!1},a.getParams=function(){return a.refs.filter.getValue()},a.getAspect=function(){return a.refs.filter.getValue().filterModel.aspect||{}},a.setAspectType=function(){},a.onWindowResize=function(){a.waiter||(a.waiter=!0,setTimeout(function(){a.waiter=!1,a.resize()},300))},a.refreshOverview=function(){var e=a.state,t=e.index,e=e.type;t?"overview"===e?Bt[e].forEach(function(e){(a.refs[e].wrappedInstance||a.refs[e]).refreshChart({projectId:t,type:e})}):a.refs[Bt[e]]&&a.refs[Bt[e]].refreshChart({projectId:t,type:Bt[e]}):a.setState({index:V.t.get(V.V.curProject).id},function(){return a.refreshOverview()})},a.resize=function(){var e=a.state.type;"overview"===e?Bt[e].forEach(function(e){(a.refs[e].wrappedInstance||a.refs[e]).resize()}):a.refs[Bt[e]].resize()},a.onFilterChange=function(){a.state.headerReady&&a.refreshOverview()},a.handleOnFilterReady=function(){a.setState({headerReady:!0},function(){return a.refreshOverview()})},a}i()(e,r);var t=e.prototype;return t.componentDidMount=function(){window.addEventListener("resize",this.onWindowResize)},t.componentWillUnmount=function(){window.removeEventListener("resize",this.onWindowResize)},t.render=function(){var e=this.state,t=e.type,a=e.model,n=(e.index,e.headerReady),r={overview:"数据预览",product:"产品分析",brand:"品牌分析",service:"服务分析",marketing:"市场分析",price:"价格分析"},e=M()("overview-container",{"analyze-container":"overview"!==t});return E().createElement("div",{className:e},E().createElement(B.Z,{ref:"filter",model:a.toUpperCase(),title:r[t],showList:["condition","time","save"],filterCondition:Object.assign({filter:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"]},{filterConfig:"overview"===this.props.type?["MESSAGE_TYPE","ESCORE"]:["ESCORE"]}),onChange:this.onFilterChange,onFilterReady:this.handleOnFilterReady,saveFilterListShow:V.V.overviewFilterListSave}),"overview"===t?E().createElement("div",{className:"overview-body data-overview",style:{padding:"0 16px"}},E().createElement("div",null,n&&E().createElement(dt,{getParams:this.getParams,ref:"COUNTER_OVERVIEW"})),E().createElement("div",{className:"block"},E().createElement(z.COUNTER_PIES_BY_SOURCE.widget,{getParams:this.getParams,name:"数据来源",ref:"COUNTER_PIES_BY_SOURCE"})),E().createElement("div",{className:"block"},E().createElement(z.EMOTION_PIE_AND_TIME_STACK_BAR.widget,{name:"情感",getParams:this.getParams,ref:"EMOTION_TIME_STACK_BAR"})),E().createElement("div",{className:"block"},E().createElement(zt,{getParams:this.getParams,ref:"COUNTER_WORD",projectId:this.state.index}))):E().createElement("div",{className:"overview-body data-overview"},E().createElement(l.X,{row:"md-12",style:{paddingTop:0}},E().createElement(l.J,{col:"md-12"},E().createElement(ct,{type:t,getParams:this.getParams,ref:Bt[t],name:r[t],projectId:this.state.index,headerReady:n,model:a.toUpperCase()})))),E().createElement(o.Z,{ref:"dataModal"}))},e}(n.Component)},33905:(e,t,a)=>{"use strict";a.d(t,{kQ:()=>o,ao:()=>c,yc:()=>s,ch:()=>i,rf:()=>n,t7:()=>r,KT:()=>l});var t=a(67154),n=["#1550B3","#CC6A77","#119073","#CDB446","#D969BF","#2684FF","#C8662B","#9369D9","#0E97AD","#1BBF69","#D07B49","#61799B","#1EA082","#A9A557","#D8727F"],r=["#3D85FF","#FFA7B2","#15D4A9","#F7D956","#FF9FE9","#75B1FF","#FF9E63","#C7A6FF","#1AC9E5","#47F79B","#FFA875","#4D6282","#2EE0B7","#D2CE77","#FF9FAC"],i=["#D96969","#15B374"],o={barWidth:21,barGap:"30%",barCategoryGap:20,height:300,marginTop:40,marginBottom:40},s=function(e,t){switch(e){case"s1":return t;case"s2":return"positive"===t?"positiveWeight1":"negativeWeight1";case"s3":return"positive"===t?"positiveA":"negativeA";case"s4":return"positive"===t?"positiveB":"negativeB";case"s5":return"positive"===t?"positiveC":"negativeC"}},l=function(e,a,t,n){if(n.length<1)return n;var r=s(t,e),e=JSON.parse(JSON.stringify(n)).map(function(e){return e.data=[],e});return e.forEach(function(e,t){e.data=JSON.parse(JSON.stringify(n[t])).data.sort(function(e,t){return"asc"===a?e[r]-t[r]:"desc"===a?t[r]-e[r]:null})}),e},c=function(e){return 0<=e&&e<1e3?e:e<1e4?(e/1e3).toFixed(2)+"千":(e/1e4).toFixed(2)+"万"}},20899:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var n=a(85354),r=a.n(n),t=a(67294),i=a.n(t),n=a(45697),t=a.n(n),n=a(70596),o=a.n(n),s=a(67592),l=function(a){function e(e){var t=a.call(this,e)||this;return t.setChartOption=function(e){t.chart&&t.chart.setOption(e)},t.chart="",t}r()(e,a);var t=e.prototype;return t.componentDidMount=function(){var t=this,e=this.props.uniqueId;this.chart=o().init(document.getElementById(e)),this.chart.on("click",function(e){t.props.clickChart&&t.props.clickChart(e)}),this.setChartOption(this.props.option)},t.UNSAFE_componentWillReceiveProps=function(e){(0,s.d)(this.props.option,e.option)||this.setChartOption(e.option)},t.resize=function(){this.chart.resize()},t.render=function(){var e=this.props,t=e.uniqueId,e=e.height;return i().createElement("div",{className:"barchart-wrapper"},i().createElement("div",{id:t,className:"baseChart",style:{width:"100%",height:e}}))},e}(i().PureComponent);l.propTypes={uniqueId:t().string.isRequired,option:t().object,height:t().number.isRequired,clickChart:t().func}},82817:(e,t,a)=>{"use strict";a.d(t,{I:()=>n,o:()=>r});var n={legend:{data:[],itemWidth:13,itemHeight:13,itemGap:12,right:10,top:0,orient:"vertical"},textStyle:{color:"#262626",fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"},grid:{tooltip:{trigger:"axis"},containLabel:!0,left:30,right:80,bottom:5,top:5,splitLine:{show:!0}},xAxis:{type:"category",axisTick:{show:!1},axisLine:{show:!0,lineStyle:{type:"solid",color:"#E5E5E5"}},axisLabel:{show:!0,color:"#999"},axisPointer:!1,data:[]},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dotted",color:"#E8E8E8"}},axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},tooltip:{trigger:"axis",backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",padding:10,textStyle:{color:"#262626"},extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);",confine:!0}},r=["#1550B3","#CC6A77","#119073","#CDB446","#D969BF","#2684FF","#C8662B","#9369D9","#0E97AD","#1BBF69","#D07B49","#61799B","#1EA082","#A9A557","#D8727F"]}}]);