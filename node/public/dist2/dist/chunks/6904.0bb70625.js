(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6904],{86904:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var n=a(37316),r=a.n(n),i=a(67154),l=a.n(i),t=a(85354),o=a.n(t),n=a(67294),T=a.n(n),i=a(55609),c=a(35239),b=a(26198),R=a(8201),D=a(98191),t=a(45697),n=a.n(t),s=a(50976),u=a(39432),p=a(70715),h=a(90126),d=["#D96969","#1574B3","#15B374","#E29494","#599BC7","#59C79B","#ECBFBF","#9DC3DD","#9DDDC3"],v={1:["negativeCount","positiveCount"],2:["negativeRate","positiveRate","voiceRate"],3:["negativeRate","positiveRate"]},f={1:["负面","正面"],2:["负面声量占比","正面声量占比","总相对占比"],3:["差评率","好评率"]},t=function(i){function e(){for(var c,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(c=i.call.apply(i,[this].concat(t))||this).getChartRef=function(e){var t=c.props,a=t.chartType,t=t.onChartReady;c.chartRef=e,t(((t={})[a]=e,t))},c._handleOnClick=function(e){var t=c.props,a=t.onClick,n=t.chartType,r=t.emotionType,i=e.componentType,l=(e.componentIndex,e.seriesIndex,e.seriesName),o=e.encode,t=e.value;"series"===i?(e=l,1===n?e=l.substring(0,l.length-2):2===n?e=l.substring(0,l.length-("all"===r?5:6)):3===n&&(e=l.substring(0,l.length-3)),l=o.x[0],o.y[0],a&&a({type:i,chartType:n,name:e,aspect:t[0],value:t[l],aspectEmotion:1===l?3:2===l?8:""})):"yAxis"===i&&a&&a({type:i,aspect:t,chartType:n})},c}o()(e,i);var t=e.prototype;return t.componentDidMount=function(){this.renderChart()},t.componentDidUpdate=function(e){var t=e.data,a=e.emotionType,n=this.props,e=n.data,n=n.emotionType;((0,R.P)(e)&&JSON.stringify(t)!==JSON.stringify(e)||n!==a)&&this.renderChart(),!(0,R.P)(e)&&this.chartRef&&(this.chartRef=void 0)},t.renderChart=function(){var e=this.props,t=e.data,a=e.title,n=e.emotionType,r=e.chartType,e=e.onDataReady;(0,R.P)(t)&&this.chartRef&&i.prototype.renderChart.call(this,t,a,n,r,e)},t.render=function(){var e=this.props,t=e.data,a=e.title,n=e.titleOverlay,r=e.loading,i=e.className,e=e.emptyHint;return T().createElement(R.Z,{className:"yt_social_analysis_tap_bar_chart_wrapper "+i,data:t,loading:r,emptyHint:e,renderTitle:T().createElement(D.Z,{data:t,title:a,titleOverlay:n})},T().createElement(s.Z,{onChartReady:this.getChartRef,option:{},theme:"yunting_multi_color",style:{height:"100%"},onEvents:{click:this._handleOnClick}}))},e}(function(n){function e(){for(var i,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(i=n.call.apply(n,[this].concat(t))||this).chartRef=void 0,i.dataset=[],i.color=[],i.dataPos=[],i.barWidth=24,i.setValue=function(a,n,o){var e=[],c=[];1===o?"all"===n?(e=[1,2],c=d.reduce(function(e,t,a){return a%3!=1&&e.push(t),e},[])):"8"===n?(e=[2],c=d.reduce(function(e,t,a){return a%3==2&&e.push(t),e},[])):"3"===n&&(e=[1],c=d.reduce(function(e,t,a){return a%3==0&&e.push(t),e},[])):2===o?"all"===n?(e=[3],c=d.reduce(function(e,t,a){return a%3==1&&e.push(t),e},[])):"8"===n?(e=[2],c=d.reduce(function(e,t,a){return a%3==2&&e.push(t),e},[])):"3"===n&&(e=[1],c=d.reduce(function(e,t,a){return a%3==0&&e.push(t),e},[])):3===o&&("all"===n?(e=[1,2],c=d.reduce(function(e,t,a){return a%3!=1&&e.push(t),e},[])):"8"===n?(e=[2],c=d.reduce(function(e,t,a){return a%3==2&&e.push(t),e},[])):"3"===n&&(e=[1],c=d.reduce(function(e,t,a){return a%3==0&&e.push(t),e},[])));var s=[],r=a.reduce(function(e,r,i){var t=h.fv[r.name.toLocaleLowerCase()];t&&("all"===n?2===o?c[i]=t[1]:(c[2*i]=t[0],c[2*i+1]=t[2]):"8"===n?c[i]=t[2]:"3"===n&&(c[i]=t[0])),s.push(["指标"].concat(f[o].map(function(e){return""+r.name+e})));var t=a[0].values&&a[0].values instanceof Array&&a[0].values||[],l=t.map(function(e){return[e.name]});return t.forEach(function(t,a){var n;0===i?v[o].forEach(function(e){l[a].push(t[e])}):(n=r.values.find(function(e){return e.name===t.name}))&&v[o].forEach(function(e){l[a].push(n[e])})}),e.push(l),e},[]);i.dataPos=e,i.color=c,i.dataset=s.map(function(e,t){return{dimensions:e,source:r[t]}})},i.getOption=function(e,r){return{title:{top:10,text:e},color:i.color,grid:{containLabel:!0,top:80,left:20,right:40,bottom:30},legend:{type:"scroll",top:40,left:20,right:20,itemWidth:10,itemHeight:10,pageIconSize:12,icon:p.W4.square,textStyle:{lineHeight:14}},dataset:i.dataset,tooltip:{formatter:function(e){var t=e.encode,a=e.marker,n=e.value,e=e.seriesName,t=n[t.x[0]];return[(0,p.Zi)(e),a+" "+n[0]+"："+(1!==r?(100*t).toFixed(2)+"%":(0,u.uf)(t))].join("</br>")}},xAxis:{type:"value",splitNumber:2,axisLabel:{formatter:function(e){return 1!==r?100*e+"%":e}}},yAxis:{type:"category",inverse:!0,triggerEvent:!0,zlevel:1,axisLabel:{formatter:["{a|value}"],rich:{a:{}}}},series:i.dataset.reduce(function(e,t,a){var n=t.dimensions,t=i.dataPos.map(function(e){return{name:n[e],type:"bar",stack:a+1,datasetIndex:a,barWidth:i.barWidth,encode:{x:e,y:0},barGap:"2%",barCategoryGap:20,itemStyle:{borderWidth:2,borderColor:"#fff"}}});return e.concat(t)},[])}},i}return o()(e,n),e.prototype.renderChart=function(e,t,a,n,r){this.setValue(e,a,n),r&&r(((r={})[n]=this.dataset,r)),this.chartRef.clear(),this.chartRef.resize(),this.chartRef.setOption(this.getOption(t,n))},e}(T().PureComponent));const A=t;t.propTypes={className:n().string,loading:n().bool,data:n().any,title:n().string,titleOverlay:n().string|n().node,onChartReady:n().func,emotionType:n().string,chartType:n().number,onClick:n().func,onDataReady:n().func,emptyHint:n().string};var P=a(24062),N=[{title:"全部情感",value:"all"},{title:"正面情感",value:"8"},{title:"负面情感",value:"3"}],k=[{title:"一级标签",value:"VOC_ASPECT_FIRST"},{title:"二级标签",value:"VOC_ASPECT_SECOND"},{title:"三级标签",value:"VOC_ASPECT_THIRD"},{title:"四级标签",value:"VOC_ASPECT_FOURTH"}],F=[{title:"按左图升序",value:"group_asc"},{title:"按左图降序",value:"group_desc"},{title:"独立升序",value:"asc"},{title:"独立降序",value:"desc"}];const m=function(t){var e=t.chart1Data,a=t.fetchingChart1Data,n=t.chart2Data,r=t.fetchingChart2Data,i=t.chart3Data,l=t.emotionType,o=t.flavorEmotionType,c=t.aspectLevel,s=t.flavorAspectLevel,u=t.rangeType,p=t.flavorRangeType,h=t.onFilterReady,d=t.onFilterChange,v=t.onMoreClick,f=t.onChartReady,m=t.onFlavorChange,y=t.onChartClick,g=t.onDataReady,C=t.pageType,_=t.analysisModel,t=0;try{var O=e instanceof Array?(24*.3*(e.length-1)+24*e.length+20)*e[0].values.length+160:0,E=n instanceof Array?(24*.3*(n.length-1)+24*n.length+20)*n[0].values.length+160:0,t=Math.max(O,E,500)}catch(e){t=500}return T().createElement("div",{className:"yt_social_analysis_tag_top_wrapper"},T().createElement(b.Z,{pageType:C.includes("brand")?"SOCIAL_TAG_BRAND_TOP_30":"SOCIAL_TAG_SERIES_TOP_30",values:[],onReady:h,onChange:d}),T().createElement("div",{className:"content"},T().createElement(R.Z,{className:"content_view",data:{},renderTitle:T().createElement(D.Z,{title:"标签分析",titleOverlay:T().createElement("div",null,T().createElement("div",null,"负面相对占比 = 机型A指标a负面 ÷ 机型A的总负面"),T().createElement("div",null,"正面相对占比 = 机型A指标a正面 ÷ 机型A的总正面"),T().createElement("div",null,"总相对占比 = 机型A指标a正负面 ÷ 机型A的总声量"),T().createElement("div",null,"好评率 = 机型A指标a正面 ÷ 机型A指标a总声量"),T().createElement("div",null,"差评率 = 机型A指标a负面 ÷ 机型A指标a总声量")),onMoreClick:v},T().createElement(P.Z,{options:N,activeObj:l,onChange:d,objName:"emotionType",flavor:o,onFlavorChange:m}),T().createElement(P.Z,{options:k,activeObj:c,onChange:d,objName:"aspectLevel",flavor:s,onFlavorChange:m}),T().createElement(P.Z,{options:F,onChange:d,activeObj:u,objName:"rangeType",flavor:p,onFlavorChange:m}))},T().createElement("div",{className:"chart_view",style:{height:t}},T().createElement(A,{className:"chart",title:"指标声量",chartType:1,emotionType:l,onChartReady:f,titleOverlay:T().createElement("div",null,"基于NLP算法，每一个指标的情感均有两种：正面情感和负面情感。"),key:"指标声量",data:e,loading:a,onClick:y,onDataReady:g,emptyHint:_&&0<_.length&&"【"+_[0].values[0].values[0].split("_")[1]+"】暂无数据"}),T().createElement(A,{className:"chart",title:"all"===l?"总相对占比":"相对占比",chartType:2,emotionType:l,onChartReady:f,titleOverlay:T().createElement("div",null,T().createElement("div",null,"负面相对占比 = 机型A指标a负面 ÷ 机型A的总负面"),T().createElement("div",null,"正面相对占比 = 机型A指标a正面 ÷ 机型A的总正面"),T().createElement("div",null,"总相对占比 = 机型A指标a正负面 ÷ 机型A的总声量")),key:"总相对占比",data:n,loading:a||r,onClick:y,onDataReady:g,emptyHint:_&&0<_.length&&"【"+_[0].values[0].values[0].split("_")[1]+"】暂无数据"}),T().createElement(A,{className:"chart",title:"好评率&差评率",chartType:3,emotionType:l,onChartReady:f,titleOverlay:T().createElement("div",null,T().createElement("div",null,"好评率 = 机型A指标a正面 ÷ 机型A指标a总声量"),T().createElement("div",null,"差评率 = 机型A指标a负面 ÷ 机型A指标a总声量")),key:"好评率&差评率",data:i,loading:a,onClick:y,onDataReady:g,emptyHint:_&&0<_.length&&"【"+_[0].values[0].values[0].split("_")[1]+"】暂无数据"})))))};var y=a(94644),n=a(64396),g=a(87219),C=n.Z.social.tag.top30,_=["VOC_ASPECT_FIRST","VOC_ASPECT_SECOND","VOC_ASPECT_THIRD","VOC_ASPECT_FOURTH"],n=function(t){function e(e){var d=t.call(this,e)||this;d._handleOnChartReady=function(e){d.chartRefObj=l()({},d.chartRefObj,e)},d._handleOnDataReady=function(e){d.chartDataObj=l()({},d.chartDataObj,e)},d._handleOnFilterReady=function(e){var t=d.state.pageType,a=e.analysisModel;("BRAND"===a[0].values[0].id&&"brand_top"===t||"SERIES"===a[0].values[0].id&&"models_top"===t)&&(d.props.save({projectId:c.t.get(c.V.curProject).id}),d.props.fetchParams(l()({},e,{filterModel:e.filterValue,pageType:d.state.pageType,projectId:c.t.get(c.V.curProject).id})))},d._handleOnFilterChange=function(e){var t;e.filterValue?(t=JSON.stringify(e.dateFilter)!==JSON.stringify(d.props.dateFilter),d.props.fetchChartsData(l()({},e,{filterModel:e.filterValue,filtedObjs:t?void 0:(0,h.ZT)(d.props,e),projectId:c.t.get(c.V.curProject).id}))):e.aspectLevel?(t=_.indexOf(e.aspectLevel),d.chartLevel=t,d.props.fetchChartsData(l()({},e,{projectId:c.t.get(c.V.curProject).id}))):(e.rangeType||e.emotionType)&&d.props.fetchChartsData(l()({},e,{projectId:c.t.get(c.V.curProject).id}))},d._handleOnFlavorChange=function(e){d.props.updateFlavors(e)},d._handleOnMoreClick=function(e){var t="标签Top30（"+("brand_top"===d.state.pageType?"品牌":"机型")+"）";"image"===e?(0,y.OH)(Object.values(d.chartRefObj),t,["指标声量","总相对占比","好评率&差评率"]):"data"===e&&(e=[].concat(Object.values(d.chartDataObj).map(function(e){return e.reduce(function(t,e){return t.push(e.dimensions),e.source.forEach(function(e){e=e.map(function(e,t){return 0!==t&&e<1?(100*e).toFixed(2)+"%":e});t.push(e)}),t.push([""]),t},[])})),console.log(e),(0,y.aT)(e,t,["指标声量","总相对占比","好评率&差评率"]))},d._handleOnChartClick=function(e){var t,a,n=e.type,r=e.aspectEmotion,i=e.name,l=e.aspect,o=e.chartType,c=d.props,s=c.filterModel,u=c.dateFilter,p=c.analysisModel,h=c.aspectLevel,e=c.cachedOrigin1,c=c.cachedOrigin2,o=(2===o?c:e)[0].tagCountVOs.find(function(e){return e.aspect===l}),c=o.id,e=o.relation;"series"===n?(o={},o=function e(t){return 1<t.length?{id:t[0].split("_")[0],value:e(t.slice(1))}:{id:t[0].split("_")[0]}}(e.slice(0,d.chartLevel+1)),t=p[0].id,a=p[0].values[0].id,p={name:i,label:o,aspect:l,pageType:d.state.pageType,aspectEmotion:r,filterModel:(0,g.ZP)(s,function(e){e=e.find(function(e){return e.id===t});!e||(e=e.values.find(function(e){return e.id===a}))&&(e.values=e.values.filter(function(e){return e.includes(i)}))}),dateFilter:u,analysisModel:(0,g.ZP)(p,function(e){var t=e[0].values[0].values;e[0].values[0].values=t.filter(function(e){return e.includes(i)})})},window.open("/social/tag/brand/detail?"+JSON.stringify(p),"_blank")):"yAxis"===n&&"VOC_ASPECT_FOURTH"!==h&&(n=_.indexOf(h),d.chartLevel=n+1,d.props.fetchChartsData({aspect:c,lastAspectLevel:h,aspectLevel:_[d.chartLevel]}))};e=e.location.pathname.split("/");return d.state={pageType:e[3]+"_"+e[4]},d.event={onFilterReady:d._handleOnFilterReady,onFilterChange:d._handleOnFilterChange,onFlavorChange:d._handleOnFlavorChange,onMoreClick:d._handleOnMoreClick,onChartReady:d._handleOnChartReady,onChartClick:d._handleOnChartClick,onDataReady:d._handleOnDataReady},d.chartRefObj={},d.chartDataObj={},d.chartLevel=0,d}o()(e,t);var a=e.prototype;return a.componentWillUnmount=function(){this.props.clean()},a.render=function(){return T().createElement(m,l()({},this.props,this.state,this.event))},e}(T().PureComponent);const O=(0,i.connect)(function(e){var t=e.loading,e=r()(e,["loading"]);return l()({},e[C],{fetchingChart1Data:t.effects[C+"/fetchChart1Data"]||!1,fetchingChart2Data:t.effects[C+"/fetchChart2Data"]||!1,fetchingChart3Data:t.effects[C+"/fetchChart3Data"]||!1})},function(t){return{save:function(e){return t({type:C+"/save",payload:e})},clean:function(e){return t({type:C+"/clean",payload:e})},fetchParams:function(e){return t({type:C+"/fetchParams",payload:e})},fetchChartsData:function(e){return t({type:C+"/fetchChartsData",payload:e})},updateFlavors:function(e){return t({type:C+"/updateFlavors",payload:e})}}})(n)},24062:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var t=a(85354),n=a.n(t),t=a(67294),v=a.n(t),t=a(45697),t=a.n(t),r=a(39432),f=a(43036),a=function(t){function e(e){var a=t.call(this,e)||this;return a.getPanelWidth=function(){var e=a.props,t=e.flavor,e=e.options,e=Math.max.apply(null,e.map(function(e){return(0,r.jD)(e.title,14)}))+2+10+32;return 100<(e+=void 0!==t?24:0)?e:100},a._setPadShowFalse=function(){a.state.show&&a.setState({show:!1})},a._handleParentClick=function(e){a.state.show&&a.props.showFlavor&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},a._handleTriggerOnClick=function(){var e=a.state.show;setTimeout(function(){a.setState({show:!e})},0)},a.state={show:!1,firstLiHover:!1,panelWidth:a.getPanelWidth()},a}n()(e,t);var a=e.prototype;return a.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},a.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},a.componentDidUpdate=function(e){var t=e.options,e=this.props.options;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({panelWidth:this.getPanelWidth()})},a.render=function(){var e=this.state,t=e.show,a=e.panelWidth,n=this.props,r=n.activeObj,i=void 0===r?"":r,l=n.onChange,o=n.options,c=n.objName,s=n.preTitle,u=n.sufTitle,p=void 0===u?"":u,e=n.showTitle,r=void 0===e||e,u=n.overlay,e=n.divider,e=void 0===e?"right":e,h=n.flavor,d=n.onFlavorChange,n=o.find(function(e){return e.value===i}),n=""===i?p:n&&n.title;return v().createElement("div",{className:"single_select_button_wrapper single_select_diviver_"+e,onClick:this._handleParentClick},v().createElement("div",{className:"button_content"},v().createElement("span",{onClick:this._handleTriggerOnClick},v().createElement("span",{className:"button-trigger "+(t?"sel":"")},r&&v().createElement(v().Fragment,null,s&&v().createElement("span",{className:"pre-title"},s,"："),v().createElement("span",{className:"button-title"},n)),v().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),u&&v().createElement("span",{style:{marginLeft:4}},v().createElement(f.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:u},v().createElement("i",{className:"icon-cem_file1"})))),v().createElement("div",{className:"button-panel "+(t?"active":""),style:{minWidth:a}},o.map(function(a,e){return v().createElement("div",{className:"panel-item "+(a.value===i?"sel":"")+" "+(a.disabled?"disabled":""),key:a.value,onClick:function(){var e;a.disabled||l(c?((e={})[c]=a.value,e):a.value)}},a.title,v().createElement("i",{className:h===a.value?"icon-cem_star":"icon-cem_star-filling star_hide",onClick:function(e){var t;e.stopPropagation(),d(h===a.value?((t={})[c]="",t):((t={})[c]=a.value,t))}}))}))))},e}(v().PureComponent);a.propTypes={activeObj:t().any,onChange:t().func.isRequired,options:t().array.isRequired,objName:t().any,preTitle:t().string,sufTitle:t().string,showTitle:t().bool,overlay:t().string,divider:t().oneOf(["both","left","right"]),flavor:t().string,onFlavorChange:t().func};const i=a}}]);