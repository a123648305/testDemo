(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5930],{2786:(e,t,n)=>{"use strict";n.d(t,{X_:()=>r});var t=n(30381),d=n.n(t),a=n(87219);function p(e,t){var n,a=JSON.parse(JSON.stringify(e)),r=e.quickChoice,i=e.from,o=e.to,e=d()().format("YYYY-MM-DD HH:mm:ss").split(" ")[1];return"近24小时"===r?1===t?(n=i.split(" ").map(function(e){return e.trim()}),a.from=d()(n[0]).format("YYYY-MM-DD")+" "+e,a.to=""+d()(n[0]).endOf("day").format("YYYY-MM-DD HH:mm:ss")):(n=o.split(" ").map(function(e){return e.trim()}),a.from=""+d()(n[0]).startOf("day").format("YYYY-MM-DD"),a.to=d()(n[0]).format("YYYY-MM-DD")+" "+e):/小时/.test(r)&&(r=i.split(" ").map(function(e){return e.trim()}),1===t?(a.from=i,a.to=d()(r[0]).format("YYYY-MM-DD")+" "+d()(i).hour()+":59:59"):(a.from=""+d()(r[0]).startOf("day").format("YYYY-MM-DD HH:mm:ss"),a.to=o)),a}var r=function(e,i,o,l,s,t){i.quickChoice;var c=i.numOfDays,u=/:/.test(i.quickChoice)||-1===i.quickChoice.indexOf("-");return"line"===e&&l instanceof Array&&0<l.length?(0,a.ZP)(i,function(e){var t,n=function(e,t,n){var a=n?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD";switch(t){case"HOUR":return{from:d()(e).format("YYYY-MM-DD HH:00:00"),to:d()(e).format("YYYY-MM-DD HH:59:59")};case"YEAR":var r=d()(e);return{from:r.startOf("year").format(a),to:r.endOf("year").format(a)};case"QUARTER":var i=e.split("-"),i=d()().year(i[0]).quarter(i[1]);return{from:i.startOf("quarter").format(a),to:i.endOf("quarter").format(a)};case"MONTH":var o=d()(e);return{from:o.startOf("month").format(a),to:o.endOf("month").format(a)};case"WEEK":i=e.split("-"),o=i[0],i=i[1],i=d()().year(o).week(i);return{from:i.startOf("week").format(a),to:i.endOf("week").format(a)};case"DAY":default:return{from:e,to:e}}}(o,s,u),a=n.from,r=n.to;"DAY"!==s&&"HOUR"!==s?JSON.stringify(o)===JSON.stringify(l[0])?a=e.from:JSON.stringify(o)===JSON.stringify(l[l.length-1])&&(r=e.to):"DAY"!==s&&"HOUR"!==s||1!==c&&2!==c||(JSON.stringify(o)===JSON.stringify(l[0])?(a=p(i,1).from,r=p(i,1).to):JSON.stringify(o)===JSON.stringify(l[l.length-1])&&(r=p(i,2).to,a=p(i,2).from)),e.from=a,e.to=r,e.numOfDays=(t=r,n=a,t=Date.parse(r),n=Date.parse(n),n=Math.abs(t-n),Math.floor(n/864e5)+1),e.quickChoice=a.replaceAll("-",".")+" - "+r.replaceAll("-",".")}):i}},15930:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>G});function o(e){var t=0;e.forEach(function(e){e=e.slice(1).sort(function(e,t){return t-e}),e=parseFloat(e[0]);t<e&&(t=e)});for(var t=Math.ceil(t),n=0;n<4;n++)t%4!=0&&t++;return{intVal:(t=0===t?4:t)/4,maxVal:t}}var a=n(37316),r=n.n(a),t=n(67154),i=n.n(t),a=n(85354),l=n.n(a),t=n(67294),T=n.n(t),b=n(48577),h=(n(43378),n(62443)),E=n(8201),y=n(98191),v=n(50976),m=n(39432),p=n(87300),s=n(94644),c=[{title:"使用人的性别",value:"性别"},{title:"使用人的年龄段",value:"年龄段"},{title:"角色与关系",value:"角色与关系"},{title:"购买决策",value:"购买决策"},{title:"使用场合",value:"使用场合"},{title:"用途",value:"用途"},{title:"代言人",value:"代言人"}];function u(e,t){var n=e.map(function(e){return e.name}),a=e[0].data.map(function(e){return e.name}),a=c.reduce(function(e,t){return a.find(function(e){return t.value===e})&&e.push(t.title),e},[]),e=e.map(function(a){return{name:a.name,list:c.reduce(function(e,t){var n=a.data.find(function(e){return t.value===e.name});return n&&e.push({scene:t.title,total:n.total}),e},[])}}),t=e.reduce(function(t,n){return n.list.map(function(e){return t.push([n.name,e.scene,e.total])}),t},[[""+t,"场景","标签数量"]]);return{rangedName:n,sceneName:a,source:e,datasets:t}}function d(e,t,n,a,r){"image"===t?(0,s._v)(e,a):"data"===t&&(r=u(n,r).datasets,(0,s.aT)([r],a))}const x=function(n){function e(e){var t=n.call(this,e)||this;return t.getChartRef=function(e){return t.chartRef=e},t.state={showLabel:!0},t}l()(e,n);var t=e.prototype;return t.componentDidMount=function(){var a=this;this.internalId=setInterval(function(){var e,t,n;a.chartRef&&(clearInterval(a.internalId),a.renderChart(),t=(e=a.chartRef._dom.children)[0],n=e[1],t.addEventListener("mouseleave",function(){a.chartLeaveTimeout=setTimeout(function(){a.chartLeaveTimeout&&(n.style.dispaly="none")},2e3)}),n&&n.addEventListener("mouseenter",function(){return a.chartLeaveTimeout=void 0}))},200)},t.componentDidUpdate=function(e,t){var n=e.data,a=this.props.data,e=t.showLabel,t=this.state.showLabel;(0,E.P)(a)&&JSON.stringify(n)!==JSON.stringify(a)&&this.renderChart(),e!==t&&this.renderChart(),!(0,E.P)(a)&&this.chartRef&&(this.chartRef=void 0)},t.renderChart=function(){var t,e=this.props,n=e.data,a=e.title,r=e.analysisModel,i=r&&r[0].values[0].label,e=this.state.showLabel;(0,E.P)(n)&&this.chartRef&&(r=a,t=e,n=u(a=n,e=i),i=n.rangedName,a=n.sceneName,e=n.source,n=n.datasets,e={title:{text:r},grid:{top:100,left:40,right:50,bottom:24,containLabel:!0},dataset:{datasets:n},xAxis:{type:"category",axisTick:{show:!1},data:a},yAxis:{type:"value",axisLabel:{color:"#626262",formatter:function(e){return(0,m.hE)(e)}},interval:o(n.map(function(e){return e.slice(1)})).intVal,max:o(n.map(function(e){return e.slice(1)})).maxVal,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}},legend:{top:50,left:30,right:48,itemWidth:10,itemHeight:10,itemGap:24,type:"scroll",data:i,icon:"circle"},tooltip:{trigger:"axis",showDelay:20,hideDelay:10,enterable:!0,confine:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n      box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",axisPointer:{type:"none",label:{show:!1}},formatter:function(n,a,r){if(n.length)return setTimeout(function(){var e='\n            <span style="font-size: 12px; color: #8c8c8c; font-weight: 400;"style="font-size: 12px; color: #8c8c8c; font-weight: 400;">\n            '+n[0].axisValue+"\n            </span>\n          ",t=n.map(function(e){var t=e.marker,n=e.seriesName,e=e.data;return"\n            <div style='display: flex;justify-content: space-between; align-items: center; color: #8c8c8c;'><div><span style='vertical-align: bottom'>"+t+"</span>"+n+"</div><div style='color: #262626;margin-left: 10px;'>\n              "+(0,m.hE)(e.value)+"\n            </div></div>\n          "});r(a,(0,p.r)(e,t))})}},series:[].concat(e.map(function(e){return{name:e.name,type:"bar",barGap:0,barMaxWidth:24,emphasis:{focus:"series"},data:e.list.map(function(e){return{value:e.total,label:{show:t,position:"top",color:"#262626"}}})}}))},this.chartRef.clear(),this.chartRef.setOption(e))},t.render=function(){var e=this,t=this.props,n=t.title,a=t.data,r=t.loading,t=t.analysisModel,i=this.state.showLabel,o=t&&t[0].values[0].label;return T().createElement(E.Z,{className:"yt_scene_competitor_bar_chart_wrapper",data:a,loading:r,renderTitle:T().createElement(y.Z,{title:n,data:a},T().createElement(h.default,{placement:"top",content:"显示图表标签",mouseEnterDelay:.6},T().createElement("i",{className:"icon-tubiaobiaoqian "+(i?"active":""),onClick:function(){e.setState({showLabel:!i})}})),T().createElement(h.default,{placement:"top",content:"导出数据",mouseEnterDelay:.6},T().createElement("i",{className:"icon-daochu",onClick:function(){return d(e.chartRef,"data",a,n,o)}})),T().createElement(h.default,{placement:"top",content:"导出图片",mouseEnterDelay:.6},T().createElement("i",{className:"icon-xiazaitupian",onClick:function(){return d(e.chartRef,"image",a,n,o)}})))},T().createElement(v.Z,{theme:"yt_multi_color_10",option:{},style:{width:"100%",height:"100%"},onChartReady:this.getChartRef}))},e}(T().Component);n(61105);var g=n(71535),S=n(70715),f=n(81408),a=function(a){function e(){for(var d,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(d=a.call.apply(a,[this].concat(t))||this).chartRef=void 0,d.source=void 0,d.lineSource=void 0,d.objNames=void 0,d.mColor=S.OW,d.legendSelected=void 0,d.getChartRef=function(e){return d.chartRef=e},d.setValue=function(a,e){var t=a.map(function(e){return e.name}),n=t.reduce(function(e,t){var n=a.find(function(e){return e.name===t});return d.legendSelected&&!d.legendSelected[t]||e.push([n.name,n.total]),e},[[e,"标签数量"]]),e=a[0].data.map(function(e){return e.name});d.lineSource=e.map(function(n){return[n].concat(t.map(function(t){var e=a.find(function(e){return e.name===t});if(e){e=e.data.find(function(e){return e.name===n});return e?e.count:0}return 0}))});e=[["日期"].concat(t)].concat(d.lineSource);d.objNames=t,d.source=[n,e]},d.getOption=function(e){var s=e.dataInfo,c=e.title,n=e.showLabel,u=Object.values(d.props.dateType)[0],e=160<(0,m.jD)(d.source[0].reduce(function(e,t,n){return 0===n?"":e+t[0]},""),12);return{title:{text:c},grid:[{left:36,top:100,width:270,bottom:52,containLabel:!0},{left:360,right:48,top:100,bottom:52,containLabel:!0}],dataset:d.source.map(function(e){return{source:e}}),tooltip:{trigger:"axis",showDelay:20,hideDelay:10,enterable:!0,confine:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n        box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",axisPointer:{type:"none",label:{show:!1}},position:function(e,t,n,a,r){var i=r.contentSize,o=r.viewSize,l=e[0]<o[0]/2?0:-1,r=e[1]<o[1]/2?-.5:-1,o=e[0]<o[0]/2?12:-12;return[e[0]+l*i[0]+o,e[1]+r*i[1]]},formatter:function(r,i,o){if(r.length)return setTimeout(function(){var e,t,n,a;"bar"!==r[0].seriesType?(e=r[0].axisValue,t=r.map(function(e){var t=e.marker,n=e.seriesName,e=e.data;return{name:"<div style='display: flex;justify-content: space-between;align-items: center;color: #8c8c8c;'><div><span style='vertical-align: bottom'>"+t+"</span>"+n+"</div><div style='color: #262626;margin-left: 10px;'>\n                  "+(0,m.hE)(e.value)+"\n                </div></div>",value:e.value}}).map(function(e){return e.name}),e='\n            <span style="font-size: 12px; color: #8c8c8c; font-weight: 400;">'+(0,m.Sn)(u,e)+"</span>",o(i,(0,p.r)(e,t))):(t=(e=r[0]).marker,n=e.data,a=s.find(function(e){return e.name===n[0]}).id,o(i,(0,p.r)(""+n[0],["<div style='display: flex;justify-content: space-between;align-items: center;color: #8c8c8c;'><div><span style='vertical-align: bottom'>"+t+"</span>标签数量</div><div style='color: #262626;margin-left: 10px;'>\n                       "+(0,m.hE)(n[1])+"\n                    </div></div>"],[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return d._handleOnJumpMsg(r[0],c,a)}}],"yt_new_tooltip_wrapper")))},0)}},legend:{top:50,left:40,right:48,itemWidth:10,itemHeight:10,type:"scroll",itemGap:24,selected:d.legendSelected,data:d.objNames,icon:"circle"},dataZoom:[{show:!0,bottom:24,xAxisIndex:1,height:16,handleSize:"100%",showDetail:!1,borderColor:"transparent",dataBackground:{lineStyle:{color:"rgba(231, 243, 255, 1)",opacity:1},areaStyle:{color:"rgba(231, 243, 255, 1)",opacity:1}},fillerColor:"rgba(114, 98, 253, 0.3)",handleIcon:"path://M249.376256 0m102.4 0l0 0q102.4 0 102.4 102.4l0 819.2q0 102.4-102.4 102.4l0 0q-102.4 0-102.4-102.4l0-819.2q0-102.4 102.4-102.4Z",handleColor:"rgba(114, 98, 253, 1)"}],xAxis:[{type:"category",gridIndex:0,axisLabel:{rotate:e?45:0,show:!0,data:d.objNames,formatter:function(e){return 6<e.length?e.substring(0,5)+"...":e}}},{type:"category",gridIndex:1,boundaryGap:!1,axisPointer:{type:"line",label:{show:!1}},axisLabel:{formatter:function(e){return(0,m.Sn)(u,e)}},data:d.lineSource.map(function(e){return e[0]})}],yAxis:[{type:"value",gridIndex:0,axisLabel:{color:"#626262",formatter:function(e){return(0,m.hE)(e)}},interval:(0,f.lQ)(d.source[0].slice(1)).intVal,max:(0,f.lQ)(d.source[0].slice(1)).maxVal,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}},{type:"value",gridIndex:1,axisLabel:{color:"#626262",formatter:function(e){return(0,m.hE)(e)}},interval:(0,f.lQ)(d.source[1].slice(1)).intVal,max:(0,f.lQ)(d.source[1].slice(1)).maxVal,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}}],series:[{type:"bar",xAxisIndex:0,yAxisIndex:0,datasetIndex:0,barMaxWidth:24,data:d.source[0].slice(1),itemStyle:{color:function(e){var t=e.dataIndex,n=e.name;if(d.legendSelected){e=Object.keys(d.legendSelected);return S.OW[e.indexOf(n)]}return S.OW[t]}},label:{show:!0,position:"top",color:"#262626",formatter:function(e){e=e.value;return(0,m.hE)(e[1])}}}].concat(d.objNames.map(function(e,t){return{type:"line",name:d.objNames[t],xAxisIndex:1,yAxisIndex:1,symbolSize:1,datasetIndex:1,data:d.lineSource.map(function(e){return{value:e[t+1],tooltip:{trigger:"item",formatter:function(i,o,l){return setTimeout(function(){var t=i.seriesName,e=i.name,n=i.data,a=i.marker,r=s.find(function(e){return e.name===t}).id,e="\n                  <div style=\"font-size: 12px; color: #8c8c8c; font-weight: 400;position:relative;\">\n                    <span style='position:absolute;width:40px;height:150px;left:-40px;top:-30px;'></span>\n                    <span style='position:absolute;width:40px;height:150px;right:-40px;top:-30px;'></span>\n                  </div>\n                  <span style=\"font-size: 12px; color: #8c8c8c; font-weight: 400;\">"+(0,m.Sn)(u,e)+"</span>",n=["<div style='display: flex;justify-content: space-between;align-items: center;color: #8c8c8c;'><div><span style='vertical-align: bottom'>"+a+"</span>"+t+"</div><div style='color: #262626;margin-left: 10px;'>\n                      "+n.value+"\n                    </div></div>"];l(o,(0,p.r)(e,n,[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return d._handleOnJumpMsg(i,c,r)}}],"yt_new_tooltip_wrapper"))},0)}},label:{show:n,position:"top",color:"#262626"}}}),itemStyle:{color:S.OW[t]}}}))}},d}return l()(e,a),e.prototype.renderChart=function(e,t,n,a){this.setValue(e,a),this.chartRef.clear(),this.chartRef.setOption(this.getOption({dataInfo:e,title:t,showLabel:n}))},e}(T().PureComponent),_=n(60496),t=n(45697),t=n.n(t),a=function(p){function e(e){var i=p.call(this,e)||this;return i.handleOnMoreClick=function(e){var t=i.props,n=t.title,t=t.data;"image"===e?(0,s._v)(i.chartRef,n):"data"===e&&(0,E.P)(t)&&(0,s.aT)([i.source[0].map(function(e){return e.map(function(e){return e%1?(100*e).toFixed(2)+"%":e})}),i.source[1].map(function(e){return e.map(function(e){return e%1?(100*e).toFixed(2)+"%":e})})],n)},i.handleOnLegendChange=function(e){e=e.selected;i.legendSelected=e,i.renderChart()},i._handleOnJumpMsg=function(e,t,n){var a=i.props,r=a.sceneType,a=a.analysisModel,a={id:a[0].values[0].id,name:"bar"===e.seriesType?e.data[0]:e.seriesName,label:a[0].values[0].label};i.props.onMsgClick(e,t,r,n,a)},i.state={showLabel:!1,showColor:!1},i}l()(e,p);var t=e.prototype;return t.componentDidMount=function(){var a=this;this.internalId=setInterval(function(){var e,t,n;a.chartRef&&(clearInterval(a.internalId),a.renderChart(),t=(e=a.chartRef._dom.children)[0],n=e[1],t.addEventListener("mouseleave",function(e){a.chartLeaveTimeout=setTimeout(function(){a.chartLeaveTimeout&&(n.style.display="none")},2e3)}),n&&n.addEventListener("mouseenter",function(e){a.chartLeaveTimeout=void 0}))},200)},t.componentDidUpdate=function(e,t){var n=e.data,a=e.sceneType,r=this.props,i=r.data,e=r.sceneType,r=t.showLabel,t=this.state.showLabel;(0,E.P)(i)&&JSON.stringify(n)!==JSON.stringify(i)&&this.renderChart(),r===t&&a===e||this.renderChart(),!(0,E.P)(i)&&this.chartRef&&(this.chartRef=void 0)},t.renderChart=function(){var t,a,n,r,i,e=this.props,o=e.data,l=e.title,s=e.sceneType,c=e.analysisModel,u=e.sceneBrand,d=c&&c[0].values[0].label,e=this.state.showLabel;(0,E.P)(o)&&this.chartRef&&(t=s,s=c,c=u,a=[],n=[],r=[],u=[],i=[],(o=o)&&(i=c[0].data.reduce(function(t,e){return"品牌"!==e.label&&"型号"!==e.label||e.options.map(function(e){return t.push({id:e.id,label:e.label})}),t},[]),u=(a=o.map(function(n){return n.data.map(function(t){return t.data.map(function(e){return{id:n.id,name:n.name,sceneName:t.name+"/"+e.name,total:e.total,data:e.data}})})})).flat(2),r=u.find(function(e){return 0!==e.data.length}).data.map(function(e){return e.name}),a=u.reduce(function(e,t){var n=e.find(function(e){return e.sceneName===t.sceneName});return n?n.list.push({id:t.id,name:t.name,data:t.data,total:t.total}):(n={sceneName:t.sceneName,list:[{id:t.id,name:t.name,data:t.data,total:t.total}]},e.push(n)),e},[]),n=s[0].values[0].values,a=a.find(function(e){return e.sceneName===t})&&a.find(function(e){return e.sceneName===t}).list,a=n.reduce(function(e,t){var n=(a||[]).find(function(e){return e.id===t});return n?e.push(n):e.push({id:t,name:i.some(function(e){return e.id===t})?i.find(function(e){return e.id===t}).label:"",data:r.map(function(e){return{count:0,name:e}}),total:0}),e},[])),a.sort(function(e,t){return n.indexOf(e.id)-n.indexOf(t.id)}),p.prototype.renderChart.call(this,a,l,e,d))},t.render=function(){var t=this,e=this.props,n=e.data,a=e.loading,r=e.title,i=e.onChange,o=e.onFlavorChange,l=e.dateOptions,s=e.dateType,c=e.flavorDateType,u=(e.style,e.sceneOptions),d=e.sceneType,e=this.state,p=e.showLabel,e=e.showColor,f=Object.keys(s)[0],m=Object.keys(c)[0];return T().createElement(E.Z,{className:"yt_explore_scene_competitor_bar_line_chart",data:n,loading:a,renderTitle:T().createElement(y.Z,{title:r,data:n},T().createElement("div",{className:"cascader_wrapper"},T().createElement(g.Z,{value:d.split("/"),options:u,expandTrigger:"hover",allowClear:!1,bordered:!1,className:e?"text_color":"",popupPlacement:"bottomLeft",suffixIcon:T().createElement("i",{className:"icon-cem_pull-down-or-take-up"}),popupClassName:"yt_explore_scene_competitor_cascader",getPopupContainer:function(){return document.querySelector(".yt_explore_scene_competitor_bar_line_chart")},onChange:function(e){return i({sceneType:e.join("/")})},onPopupVisibleChange:function(e){return t.setState({showColor:e})}})),T().createElement(_.Z,{options:l,activeObj:s[f],flavor:c[m],rightHook:!0,onChange:function(e){var t;return i(((t={})[f]=e,t))},onFlavorChange:function(e){var t;return o(((t={})[m]=e,t))}}),T().createElement(h.default,{placement:"top",content:"显示图表标签",mouseEnterDelay:.6},T().createElement("i",{className:"icon-tubiaobiaoqian "+(p?"active":""),onClick:function(){t.setState({showLabel:!p})}})),T().createElement(h.default,{placement:"top",content:"导出数据",mouseEnterDelay:.6},T().createElement("i",{className:"icon-daochu",onClick:function(){return t.handleOnMoreClick("data")}})),T().createElement(h.default,{placement:"top",content:"导出图片",mouseEnterDelay:.6},T().createElement("i",{className:"icon-xiazaitupian",onClick:function(){return t.handleOnMoreClick("image")}})))},T().createElement(v.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{legendselectchanged:this.handleOnLegendChange}}))},e}(a);a.propTypes={data:t().any,style:t().object,titleOverlay:t().oneOf([t().string,t().node]),title:t().string,loading:t().bool,onChange:t().func,onMsgClick:t().func,onChartClick:t().func,dateOptions:t().arrayOf({title:t().string,value:t().string}),dateType:t().object,flavorDateType:t().object};const M=a;n(92871);function C(e,t,n){var a=[];return e&&e.forEach(function(e){a.push(Y(e.data&&e.data.some(function(e){return e.name===t})?e.data.find(function(e){return e.name===t}).data:[],n).length)}),Math.max.apply(Math,a)}var N=n(74806),O=n(5133),a=n(29531),A=n.n(a),D=n(93162),w=[{title:"使用人的性别",value:"性别"},{title:"使用人的年龄段",value:"年龄段"},{title:"角色与关系",value:"角色与关系"},{title:"购买决策",value:"购买决策"},{title:"代言人",value:"代言人"}],L=[{title:"top10",value:"top10"},{title:"top20",value:"top20"},{title:"全部",value:"all"}],Y=function(e,t){return"top10"===t?e.slice(0,10):"top20"===t?e.slice(0,20):e};const P=function(t){function e(e){var o=t.call(this,e)||this;return o.renderTooltip=function(){var e=o.props,t=e.data,n=e.singleSceneType,e=(e.analysisModel,e.singleTopType);(0,E.P)(t)&&(e=C(t,n,e),o.setState({height:0===e?"100%":22*e+16*(e-1)+34+16}))},o.onExportImage=function(){var t,n,e=o.props,a=e.title,r=e.data,i=e.singleSceneType,e=e.singleTopType;!(0,E.P)(r)||C(r,i,e)<1?O.Z.error("导出失败"):(i=document.querySelector(".yt_explore_scene_compare_progressbar_chart"),t=a,n=i.cloneNode(!0),e=i.clientWidth,a=i.clientHeight,(i=document.createElement("canvas")).className="yt_explore_scene_competingAnalysis_canvas",i.width=10*e,i.height=10*a,i.style.width=e+"px",i.style.height=a+"px",i.getContext("2d").scale(10,10),n.style.background="transparent !important",n.style.width=e+"px",n.style.height=a+"px",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex=-1,n.style.opacity=1,n.querySelector(".yt_chart_title_wrapper .chart_title_name").fontWeight="bold",n.querySelector(".chart_title_buttons").style.display="none",n.querySelectorAll(".name").forEach(function(e){e.style.fontWeight="bold",e.style.lineHeight="18px"}),n.querySelectorAll(".ant-progress").forEach(function(e){e.style.lineHeight="18px",e.style.marginTop="4px"}),n.querySelectorAll(".count").forEach(function(e){e.style.display="inline-block",e.style.fontWeight="bold",e.style.lineHeight="20px"}),document.body.appendChild(n),A()(n,{dpi:10*window.devicePixelRatio,allowTaint:!0,taintTest:!1,canvas:i,useCORS:!0,width:e,height:a,onrendered:function(e){document.body.appendChild(e);e=e.toDataURL("image/jpeg");(0,D.saveAs)(e,t,"image/jpeg"),setTimeout(function(){document.body.removeChild(n),document.body.removeChild(document.querySelector(".yt_explore_scene_competingAnalysis_canvas"))},0)}}))},o.onExportExcel=function(){var e=o.props,t=e.title,n=e.data,a=e.analysisModel,r=e.singleSceneType,i=e.singleTopType;(0,E.P)(n)&&0!==C(n,r,i)&&(e=[a[0].values[0].label,"场景","场景标签","标签数量","占比"],n=n.sort(function(e,t){return a[0].values[0].values.indexOf(e.id)-a[0].values[0].values.indexOf(t.id)}).reduce(function(e,t){var n=[];return t.data.some(function(e){return e.name===r})&&0<t.data.find(function(e){return e.name===r}).total&&Y(t.data.find(function(e){return e.name===r}).data,i).forEach(function(e){n.push([t.name,r,e.name,e.total,e.total/t.data.find(function(e){return e.name===r}).total])}),[].concat(e,n)},[]),n=[e].concat(n),(0,s.aT)([n],t))},o._handleOnJumpMsg=function(e,t){var n=o.props,a=n.singleSceneType,r=n.title,n=n.analysisModel,n={id:n[0].values[0].id,name:e.name,label:n[0].values[0].label},t=a+"/"+t.name;o.props.onMsgClick({},r,t,e.id,n)},o._handleOnMouseEnter=function(e,t,n){setTimeout(function(){o.setState({e:e,idx:t,f:n},function(){o.setState({display:"block"})})},100)},o._handleOnMouseMove=function(e,t,n){var a=document.querySelectorAll(".content_wrap .item")[t].childNodes[1].childNodes[n].getBoundingClientRect(),t=(a.left,a.top),a=document.querySelector(".nav .menu-bottom-wrap").offsetWidth,r=e.pageX-a-16+10>document.body.offsetWidth-410?e.pageX-a-71-32-24:e.pageX-a-16+10,i=(60<e.pageY-t||6<n&&e.pageY-t<20?60:e.pageY-t)+10*n+(0===n?0:16*(n-1))+78-10;setTimeout(function(){o.setState({display:"block",left:r+"px",top:i+"px"})},60)},o._handleOnMouseLeave=function(){setTimeout(function(){o.popoverHover||o.setState({display:"none"})},200)},o.renderTooltips=function(){var e=o.state,t=e.e,n=e.idx,a=e.f,r=e.display,i=e.left,e=e.top;return T().createElement("div",{onMouseEnter:function(){o.popoverHover=!0,setTimeout(function(){"none"===r&&o.setState({display:"block"})},100)},onMouseLeave:function(){o.popoverHover=!1,setTimeout(function(){o.setState({display:"none"})},200)},className:"yt_explore_scene_competingAnalysis_popover",style:{display:r,left:i,top:e}},T().createElement("div",{className:"title_wrapper",dangerouslySetInnerHTML:{__html:t.name}}),T().createElement("div",{className:"content_wrapper"},T().createElement("div",null,T().createElement("span",{className:"marker",style:{background:S.OW[n]}}),T().createElement("span",null,a.name)),T().createElement("span",{className:"num"},(0,m.hE)(a.total))),T().createElement("div",{className:"footer_wrapper"},T().createElement("span",{className:"item_content",alt:"消息",onClick:function(){return o._handleOnJumpMsg(t,a)}},T().createElement("i",{className:"icon-cem_jump-message icon_style"}),T().createElement("span",{className:"title_style"},"消息"))))},o.state={height:"100%",idx:-1,e:{},f:{},display:"none",left:0,top:0},o.popoverHover=!1,o}l()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.renderTooltip()},n.componentDidUpdate=function(e,t){var n=e.data,a=e.singleSceneType,r=e.singleTopType,i=this.props,o=i.data,e=i.singleSceneType,i=i.singleTopType;JSON.stringify(n)!==JSON.stringify(o)&&(0,E.P)(o)&&this.renderTooltip(),a===e&&r===i||this.renderTooltip()},n.render=function(){var i=this,e=this.props,t=e.menuList,n=e.data,a=e.loading,r=e.title,o=e.singleSceneType,l=e.fSingleSceneType,s=e.singleTopType,c=e.fSingleTopType,u=e.onFilterChange,d=e.onFlavorChange,p=e.analysisModel,f=this.state.height;return T().createElement(E.Z,{className:"yt_explore_scene_compare_progressbar_chart",data:n,loading:a,renderTitle:T().createElement(y.Z,{title:r},T().createElement(_.Z,{options:(r=t,t=JSON.parse(JSON.stringify(w)),r&&(r.some(function(e){return"使用场合"===e.name})&&t.splice(3,0,{title:"使用场合",value:"使用场合"}),r.some(function(e){return"用途"===e.name})&&t.splice(4,0,{title:"用途",value:"用途"})),t),activeObj:o,flavor:l,onChange:function(e){return u({singleSceneType:e})},onFlavorChange:function(e){return d({fSingleSceneType:e})}}),T().createElement(_.Z,{options:L,activeObj:s,flavor:c,onChange:function(e){return u({singleTopType:e})},onFlavorChange:function(e){return d({fSingleTopType:e})}}),T().createElement(h.default,{placement:"top",content:"导出数据",mouseEnterDelay:.6},T().createElement("i",{className:"icon-daochu",onClick:this.onExportExcel})),T().createElement(h.default,{placement:"top",content:"导出图片",mouseEnterDelay:.6},T().createElement("i",{className:"icon-xiazaitupian",onClick:this.onExportImage})))},T().createElement("div",{className:"bar_content"},(0,E.P)(n)?this.renderTooltips():null,(0,E.P)(n)?T().createElement("div",{className:"content_wrap",style:{maxHeight:10<C(n,o,s)?418:436}},n.sort(function(e,t){return p[0].values[0].values.indexOf(e.id)-p[0].values[0].values.indexOf(t.id)}).map(function(a,r){return T().createElement("div",{className:"item",key:a.id,style:{height:f}},T().createElement("div",{className:"analysis_name"},a.name),T().createElement("div",{className:"scenes"},a.data.some(function(e){return e.name===o})&&0<a.data.find(function(e){return e.name===o}).total?T().createElement(T().Fragment,null,Y(a.data.find(function(e){return e.name===o}).data,s).map(function(e,t,n){return T().createElement("div",{className:"scene_item",key:e.name,onMouseEnter:function(){return i._handleOnMouseEnter(a,r,e)},onMouseLeave:function(){return i._handleOnMouseLeave(a,r,e)},onMouseMove:function(e){return i._handleOnMouseMove(e,r,t)}},T().createElement("div",{className:"name",style:{width:5<Math.max.apply(Math,n.map(function(e){return e.name.length}))?84:14*Math.max.apply(Math,n.map(function(e){return e.name.length}))}},e.name),T().createElement(N.default,{percent:e.total/a.data.find(function(e){return e.name===o}).total*100,showInfo:!1,strokeColor:S.OW[r],trailColor:"#e5e5e5",style:{width:"calc(100% - 84px - 16px - 96px)",margin:"-4px 8px 0"},strokeWidth:10}),T().createElement("div",null,(0,m.hE)(e.total)+"（"+(e.total/a.data.find(function(e){return e.name===o}).total*100).toFixed(2)+"%）"))})):T().createElement("div",{className:"empty_block"},"暂无数据")))})):null))},e}(T().PureComponent);const k=function(e){var t=e.pageType,n=e.dateOptions,a=e.fetchingSceneData,r=e.singleSceneBarData,i=e.singleSceneType,o=e.fSingleSceneType,l=e.singleTopType,s=e.fSingleTopType,c=e.menuList,u=e.sceneBarData,d=e.projectId,p=e.sceneHeaderData,f=e.sceneType,m=e.timeType,h=e.fTimeType,E=e.sceneBarLineData,y=e.fetchingSceneLabelData,v=e.filterReady,g=e.filterChange,S=e.onFilterChange,_=e.onFlavorChange,C=e.analysisModel,N=e.onMsgClick,e=function(e){if(0!==e.length){var a=e[0].data,r={SCENE_SEX:"使用人的性别",SCENE_AGE:"使用人的年龄段",SCENE_RELATION:"角色与关系",SCENE_BUY_DECISION:"购买决策",SCENE_SPOKESMAN_ANALYSIS:"代言人",SCENE_USE_SCENE:"使用场合",SCENE_USE:"用途"},i={SCENE_SEX:"性别",SCENE_AGE:"年龄段",SCENE_RELATION:"角色与关系",SCENE_BUY_DECISION:"购买决策",SCENE_SPOKESMAN_ANALYSIS:"代言人",SCENE_USE_SCENE:"使用场合",SCENE_USE:"用途"};return["SCENE_SEX","SCENE_AGE","SCENE_RELATION","SCENE_BUY_DECISION","SCENE_SPOKESMAN_ANALYSIS","SCENE_USE_SCENE","SCENE_USE"].reduce(function(e,t){var n=a.filter(function(e){return e.id===t})&&a.filter(function(e){return e.id===t})[0];return n&&n.options&&e.push({value:i[n.id],label:r[n.id],children:n.options.map(function(e){return{value:e.id,label:e.label}})}),e},[])}}(p.filter(function(e){return"场景标签"===e.label}))||[],p=p.filter(function(e){return"主题"===e.label});return T().createElement("div",{className:"yt_explore_scene_competitor_wrapper"},T().createElement(b.Z,{onReady:v,onChange:g,pageType:t,advanceAuthority:!1,touchData:["电商评论"],selectValue:"电商评论",valueConf:["fullInfo"],showList:["fullDate","screening","save","sourceSearch"],hasHour:!0},T().createElement("div",{className:"content"},T().createElement(x,{data:u,title:"各场景标签数量",loading:a,analysisModel:C}),T().createElement(P,{singleSceneType:i,fSingleSceneType:o,singleTopType:l,fSingleTopType:s,analysisModel:C,data:r,loading:a,title:C&&C[0].values[0].label.includes("型号")?"单个场景的型号对比":"单个场景的品牌对比",onFilterChange:S,onFlavorChange:_,menuList:c&&c.sceneConfig&&c.sceneConfig[d],onMsgClick:N}),T().createElement(M,{title:C&&"型号"===C[0].values[0].label?"单个标签的型号对比":"单个标签的品牌对比",data:E,dateOptions:n,dateType:{timeType:m},flavorDateType:{fTimeType:h},onChange:S,onFlavorChange:_,loading:a||y,sceneOptions:e,analysisModel:C,sceneBrand:p,sceneType:f||(0!==e.length?e[0].value+"/"+e[0].children[0].value:""),onMsgClick:N}))))};var a=n(55609),I=n(35239),R=n(97194),F=n(2786),n=n(64396),U=n.Z.explore.scene.competingAnalysis,j=n.Z.IDBHeaderScreening.screening,H=n.Z.public.menu,n=function(t){function e(e){var p=t.call(this,e)||this;return p._handleFilterReady=function(e,t){var n=(0,R.X)(e.dateFilter.numOfDays,!0),a=n.dateOptions,n=n.defaultDateType;p.props.fetchParams({projectId:I.t.get(I.V.curProject).id,headerFilterParamsNew:e.headerFilterParamsNew,dateFilter:e.dateFilter,analysisModel:e.analysisModel,dateOptions:a,defaultDateType:n,filterValues:t.fullInfo.filterValue})},p._handleFilterChange=function(e,t,n){var a=(0,R.X)(e.dateFilter.numOfDays,!0),r=a.dateOptions,a=a.defaultDateType;p.props.fetchDatas(i()({},e,{dateOptions:r,defaultDateType:a,analysisModel:e.analysisModel,timeType:a,filterValues:t.fullInfo.filterValue}))},p._handleOnFilterChange=function(e){e.timeType?p.props.fetchSceneLabelData(e):(e.singleTopType||e.singleSceneType||e.sceneType)&&p.props.save(e)},p._handleOnFlavorChange=function(e){e.fTimeType,p.props.setDefaultValue(e)},p._handleOnMsgClick=function(e,t,n,a,r){var i=p.props,o=i.projectId,l=i.dateFilter,s=i.headerFilterParamsNew,c=i.timeType,u=i.sceneBarLineData,d=i.filterValues,i=e.name,e=e.componentSubType,d={projectId:o,dateFilter:(0,F.X_)(e,l,i,u.find(function(e){return 0!==e.total}).data.find(function(e){return 0!==e.total}).data[0].data.map(function(e){return e.name}),c),headerFilterParamsNew:t.includes("标签")||t.includes("场景")?(0,f.R5)(s,n.split("/")[0],n.split("/")[1],a,r,!1):s,filterModel:{project:[o],messageCategory:["COMMENT"]},filterTip:null,filterValues:t.includes("标签")||t.includes("场景")?(0,f.R5)(d,n.split("/")[0],n.split("/")[1],a,r,!0):d};window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(d)))},p.state={},p.events={filterReady:p._handleFilterReady,filterChange:p._handleFilterChange,onFilterChange:p._handleOnFilterChange,onFlavorChange:p._handleOnFlavorChange,onMsgClick:p._handleOnMsgClick},p}l()(e,t);var n=e.prototype;return n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return T().createElement(k,i()({},this.props,this.state,this.events))},e}(T().Component);const G=(0,a.connect)(function(e){var t=e.loading,e=r()(e,["loading"]);return i()({},e[U],{menuList:e[H].menuList,sceneHeaderData:e[j].screeningList,fetchingSceneData:t.effects[U+"/fetchSceneData"]||!1,fetchingSceneLabelData:t.effects[U+"/fetchSceneLabelData"]||!1})},function(t){return{save:function(e){return t({type:U+"/save",payload:e})},clean:function(){return t({type:U+"/clean"})},setDefaultValue:function(e){return t({type:U+"/setDefaultValue",payload:e})},fetchParams:function(e){return t({type:U+"/fetchParams",payload:e})},fetchDatas:function(e){return t({type:U+"/fetchDatas",payload:e})},fetchSceneLabelData:function(e){return t({type:U+"/fetchSceneLabelData",payload:e})}}})(n)},81408:(e,t,n)=>{"use strict";n.d(t,{lQ:()=>a,v1:()=>r,dR:()=>i,$x:()=>u,$5:()=>o,gt:()=>l,R5:()=>s});var t=n(67154),c=n.n(t);n(87219),n(39432);var a=function(e){var t=0;e.forEach(function(e){e=e.slice(1).sort(function(e,t){return t-e}),e=parseFloat(e[0]);t<e&&(t=e)});for(var t=Math.ceil(t),n=0;n<4;n++)t%4!=0&&t++;return{intVal:(t=0===t?4:t)/4,maxVal:t}},r={SCENE_SEX:"user.gender",SCENE_AGE:"user.age",SCENE_USE_SCENE:"space",SCENE_USE:"usage",SCENE_BUY_DECISION:"buy_decision",SCENE_RELATION:"relation",SCENE_MY_ADVICE:"suggestion"},i=function(e){var t=e.oLineData,i=e.oBarData,n=e.alzOptions,a=e.alzName,r=t&&t.find(function(e){return e.name===a}),e=void 0,o=n.find(function(e){return e.name===a}).idKey+":"+a,t=i.nodes.find(function(e){return e.key===o}),l=t?t.total:0,e=i.relations.reduce(function(e,t){var n,a,r=void 0;return t.source===o?r="target":t.target===o&&(r="source"),r&&(n=i.nodes.find(function(e){return e.key===t[r]}),a=0===l?0:t.total/l,0,n&&e.push(c()({},n,{relTotal:t.total,aspectCount:l,messageCount:0,trustRate:a,upRate:0}))),e},[]);return{analyzeLineData:r=void 0===r?"empty":r,analyzeBarData:e=void 0===(e=n.find(function(e){return"relation"===e.idKey})?e.filter(function(e){return"relation"!==e.scene&&"user.age"!==e.scene&&"user.gender"!==e.scene}):e)?"empty":e}},u={"性别分布":"SCENE_SEX","性别":"SCENE_SEX","使用人的性别":"SCENE_SEX","年龄段分布":"SCENE_AGE","年龄段":"SCENE_AGE","使用人的年龄段":"SCENE_AGE","关系":"SCENE_RELATION","角色与关系":"SCENE_RELATION","使用场合":"SCENE_USE_SCENE","用途":"SCENE_USE","购买决策":"SCENE_BUY_DECISION","代言人":"SCENE_ENDORSER"},o={SCENE_USE_SCENE:"使用场合",SCENE_USE:"用途",SCENE_BUY_DECISION:"购买决策",relation:"关系","user.gender":"性别","user.age":"年龄段"},l=function(e,t,n,a,r){var i,o=e&&e.find(function(e){return"SCENE_ASPECT"===e.id}),l=e&&e.find(function(e){return"DEFAULT"===e.id});return t.includes("性别")||t.includes("年龄段")||t.includes("关系")||t.includes("使用场合")||t.includes("用途")||t.includes("购买决策")||t.includes("代言人")?(i=[].concat(e.filter(function(e){return"SCENE_ASPECT"!==e.id&&"DEFAULT"!==e.id}).map(function(e){return c()({},e)}),[{id:"SCENE_ASPECT",isSelectAll:o&&o.isSelectAll?o.isSelectAll:null,values:o?[].concat(o.values.filter(function(e){return e.id!==u[t]}).map(function(e){return c()({},e)}),[{id:u[t],label:t,values:[n]}]):[{id:u[t],label:t,values:[n]}]},{id:"DEFAULT",isSelectAll:l&&l.isSelectAll?l.isSelectAll:null,values:l?[].concat(l.values.filter(function(e){return"MESSAGE_TYPE"!==e.id}).map(function(e){return c()({},e)}),[{id:"MESSAGE_TYPE",label:"消息类型",values:a?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]):[{id:"MESSAGE_TYPE",label:"消息类型",values:a?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]}]),r&&i.find(function(e){return"SCENE_ASPECT"===e.id}).values.push(r),i):t?e:i=[].concat(e.filter(function(e){return"DEFAULT"!==e.id}).map(function(e){return c()({},e)}),[{id:"DEFAULT",isSelectAll:l&&l.isSelectAll?l.isSelectAll:null,values:l?[].concat(l.values.filter(function(e){return"MESSAGE_TYPE"!==e.id}).map(function(e){return c()({},e)}),[{id:"MESSAGE_TYPE",label:"消息类型",values:a?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]):[{id:"MESSAGE_TYPE",label:"消息类型",values:a?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]}])},s=function(e,t,n,a,r,i){var o=e&&e.find(function(e){return"SCENE_ASPECT"===e.id}),l=e&&e.find(function(e){return"DEFAULT"===e.id}),s=e&&e.find(function(e){return"TOPIC"===e.id});return t.includes("性别")||t.includes("年龄段")||t.includes("关系")||t.includes("使用场合")||t.includes("用途")||t.includes("购买决策")||t.includes("代言人")?[].concat(e.filter(function(e){return"SCENE_ASPECT"!==e.id&&"DEFAULT"!==e.id&&"TOPIC"!==e.id}).map(function(e){return c()({},e)}),[{id:"SCENE_ASPECT",isSelectAll:o&&o.isSelectAll?o.isSelectAll:null,values:o?[].concat(o.values.filter(function(e){return e.id!==u[t]}).map(function(e){return c()({},e)}),[{id:u[t],label:t,values:[n]}]):[{id:u[t],label:t,values:[n]}]},{id:"DEFAULT",isSelectAll:l&&l.isSelectAll?l.isSelectAll:null,values:l?[].concat(l.values.filter(function(e){return"MESSAGE_TYPE"!==e.id}).map(function(e){return c()({},e)}),[{id:"MESSAGE_TYPE",label:"消息类型",values:i?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]):[{id:"MESSAGE_TYPE",label:"消息类型",values:i?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]},{id:"TOPIC",isSelectAll:s&&s.isSelectAll?s.isSelectAll:null,values:s?[].concat(s.values.filter(function(e){return e.id!==r.id}).map(function(e){return c()({},e)}),[{id:r.id,label:r.label,values:i?[r.name]:[a]}]):[{id:r.id,label:r.label,values:i?[r.name]:[a]}]}]):t?e:[].concat(e.filter(function(e){return"DEFAULT"!==e.id}).map(function(e){return c()({},e)}),[{id:"DEFAULT",isSelectAll:l&&l.isSelectAll?l.isSelectAll:null,values:l?[].concat(l.values.filter(function(e){return"MESSAGE_TYPE"!==e.id}).map(function(e){return c()({},e)}),[{id:"MESSAGE_TYPE",label:"消息类型",values:i?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]):[{id:"MESSAGE_TYPE",label:"消息类型",values:i?["电商追评","电商评论"]:["COMMENT_APPEND","MESSAGE_COMMENT"]}]}])}}}]);