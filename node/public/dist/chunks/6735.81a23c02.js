(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6735],{55882:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),echarts_for_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(50976),element_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(92360),element_react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(element_react__WEBPACK_IMPORTED_MODULE_2__),getOption=function getOption(op){if(null===op||"error"===op)return{};var option={},source;try{eval(op)}catch(err){return console.error("op解析失败，请查看返回， "+err),{option:null}}return{option:option,source:source}},Enlarge=function(e){var t=e.name,n=e.shrink,a=e.option,r={},o=getOption(a),e=o.option,o=o.source;a&&null!==e&&(r=a.includes("table")?o:e);var l;return react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div",{className:"edit_elarge_wrap"},react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div",{className:"elarge_header"},react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span",{className:"chart_name"},t||"预览"),react__WEBPACK_IMPORTED_MODULE_0___default().createElement("i",{className:"icon-cem_cancel",onClick:n})),react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div",{className:"elarge_chart_wrap"},(l=r)instanceof Array?react__WEBPACK_IMPORTED_MODULE_0___default().createElement(element_react__WEBPACK_IMPORTED_MODULE_2__.Table,{className:"hover_table",columns:l[0].map(function(e,t){return{label:e,render:function(e){return e[t]}}}),data:l.slice(1)}):react__WEBPACK_IMPORTED_MODULE_0___default().createElement(echarts_for_react__WEBPACK_IMPORTED_MODULE_1__.Z,{theme:"yunting_dashboard_theme",loadingOption:{text:"加载中",color:"#20a0ff"},option:l,style:{width:"100%",height:"100%"}})))};const __WEBPACK_DEFAULT_EXPORT__=Enlarge},46735:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var a=n(37316),r=n.n(a),o=n(67154),i=n.n(o),t=n(85354),l=n.n(t),a=n(67294),C=n.n(a),v=n(92360),s=n(43036),o=n(45697),t=n.n(o),c=30,E=function(n){function e(e){var t=n.call(this,e)||this;return t._handleOnBlur=function(e){e=e.target.value;""===e.trim()?(t.setState({tipText:"输入框不能为空"}),t.input.style.border="1px solid #D96969"):e.length===c&&(t.setState({tipText:""}),t.input.style.border="1px solid #e5e5e5")},t._handleOnChange=function(e){e=e.target;t.isCompositionHandling||(e=e.value,t.setState({name:e,hasChanged:t.state.originName!==e}),""===e.trim()?(t.setState({tipText:"输入框不能为空"}),t.input.style.border="1px solid #D96969"):e.length===c?(t.setState({tipText:"最多只能输入30个字符"}),t.input.style.border="1px solid #D96969"):(t.setState({tipText:""}),t.input.style.border="1px solid #e5e5e5"))},t._handlingOnComposition=function(){t.isCompositionHandling=!0},t._handleOnComposition=function(e){e=e.target;t.isCompositionHandling=!1,t._handleOnChange({target:e})},t.getValue=function(){var e=t.state;return{name:e.name,description:e.description}},t.hasChanged=function(){return t.state.hasChanged},t.resetChanged=function(){t.setState({hasChanged:!1})},t.test=function(){return""===t.state.tipText||t.state.name.length===c},t.state={tipText:"",hasChanged:!1,description:"",sequenceId:"",name:"",originName:""},t.isCompositionHandling=!1,t}l()(e,n);var t=e.prototype;return t.componentDidUpdate=function(e,t){var n,a=e.value,r=this.props,o=r.value,l=r.isCopy;JSON.stringify(a)!==JSON.stringify(o)&&(n=o.name,e=o.sequenceId,r=o.description,a="副本-"+n,o=(l?a:n).substring(0,c),this.setState({name:o,tipText:o.length>c?"最多输入30个字":"",originName:(l?a:n).substring(0,c),sequenceId:e,description:r}))},t.render=function(){var t=this,e=this.state,n=e.tipText,a=e.name,r=e.sequenceId,e=e.description;return C().createElement("div",{className:"dash_edit_info_wrapper"},C().createElement("div",{className:"title"},"图表信息"),C().createElement("div",null,C().createElement("span",{className:"name"},"图表名称"),C().createElement("input",{className:"edit_input_normal "+(""!==n&&"edit_input_error"),placeholder:"请输入图表名称（最多30个字)",defaultValue:a.substring(0,c),ref:function(e){return t.input=e},maxLength:c,onBlur:this._handleOnBlur,onChange:this._handleOnChange,onCompositionStart:this._handlingOnComposition,onCompositionUpdate:this._handlingOnComposition,onCompositionEnd:this._handleOnComposition})),C().createElement("p",{className:"tip_text"},n),C().createElement("div",{style:{marginTop:8}},C().createElement("span",{className:"id_name"},"模板ID"),C().createElement(s.Z,{overlay:"模板ID将被用于远程沟通时针对有问题的图表的定位",placement:"top"},C().createElement("i",{className:"icon-cem_file1"})),C().createElement("span",null,r)),C().createElement("div",{style:{marginTop:"30px",display:"flex"}},C().createElement("span",{className:"summary_name"},"图表说明"),C().createElement("span",{className:"summary_description",dangerouslySetInnerHTML:{__html:e.replace(/\n\n/g,"<br/>")}})))},e}(a.Component);E.propTypes={value:t().shape({name:t().string,sequenceId:t().string,description:t().string})};var u=n(83425),p=n(2258),h=n.n(p),m=n(7660),f={like:"包含",notlike:"不包含",in:"其中一个",notin:"不为其中任一个"},o=function(t){function e(e){var r=t.call(this,e)||this;return r._handleOnAddTag=function(e){var t=e.name,n=r.props,a=n.onChange,e=n.index,n=n.data.contents,t=t.trim();t&&n.length<5&&a(e,{type:"contents",value:n.concat([t])})},r._handleOnTagDelete=function(e,t,n){var a=r.props;(0,a.onChange)(a.index,{type:"contents",value:n.map(function(e){return e.name})})},r._handleOnTagBlur=function(e){e=e.target;r.tagInputRef&&e.value&&(r._handleOnAddTag({name:e.value}),r.tagInputRef.setState({tagName:""}))},r._handleOnObjectSelect=function(e){var t=r.props,n=t.index;(0,t.onChange)(n,{type:"name",value:e})},r._handleOnConditionSelect=function(e){var t=r.props,n=t.index;(0,t.onChange)(n,{type:"type",value:e})},r._handleOnContentsSelect=function(e){var t=r.props,n=t.index;(0,t.onChange)(n,{type:"contents",value:[e]})},r._handleOnDelete=function(){var e=r.props,t=e.index;(0,e.onDelete)(t)},r._handleInputKeyDown=function(e){8===e.keyCode&&r.tagInputElm&&!r.tagInputElm.value&&(0,(e=r.props).onChange)(e.index,{type:"contents",value:(e=e.data.contents).slice(0,e.length-1)})},r.tagInputRef=void 0,r.tagInputElm=void 0,r}l()(e,t);var n=e.prototype;return n.componentDidUpdate=function(){var e=this.props.data.contents;e&&5===e.length&&this.tagInputElm&&this.tagInputElm.setAttribute("disabled",!0),e&&e.length<5&&this.tagInputElm&&this.tagInputElm.removeAttribute("disabled")},n.componentWillUnmount=function(){this.tagInputElm&&this.tagInputElm.removeEventListener("keydown",this._handleInputKeyDown)},n.render=function(){var t=this,e=this.props,n=e.index,a=e.data,r=e.objOptions,o=e.conOptions,l=e.plaOptions,i=e.test,s=1===n,c=s?"rule_first":5===n?"rule_last":"",u=a.name,e=a.type,d=a.contents,a=d.map(function(e){return{name:e}});return C().createElement("div",{className:"yt_link_rule_wrapper"},C().createElement("span",{className:"rule_index "+c},C().createElement("span",null,n)),C().createElement("span",{className:"rule_object "+(s?"rule_object_first":"")},C().createElement(h(),{value:u,className:"rule_select",tags:!1,showSearch:!1,inputIcon:C().createElement("i",{className:"icon-cem_pull-down-or-take-up"}),onSelect:this._handleOnObjectSelect},r.map(function(e){return C().createElement(p.Option,{key:e,value:e,disabled:1===n&&"平台"===e},e)}))),C().createElement(h(),{value:f[e],className:"rule_select",style:{width:140,minWidth:140},tags:!1,showSearch:!1,inputIcon:C().createElement("i",{className:"icon-cem_pull-down-or-take-up"}),onSelect:this._handleOnConditionSelect},o.map(function(e){return C().createElement(p.Option,{key:e,value:e},f[e])})),"平台"===u?C().createElement(h(),{className:"rule_content_select",value:l.find(function(e){return e.id===d[0]}).name,tags:!1,showSearch:!1,inputIcon:C().createElement("i",{className:"icon-cem_pull-down-or-take-up"}),onSelect:this._handleOnContentsSelect},l.map(function(e){return C().createElement(p.Option,{key:e.id,value:e.id},e.name)})):C().createElement(m.EG,{ref:function(e){e&&(e=(t.tagInputRef=e).refs.tagInput.getElementsByTagName("input")[0],t.tagInputElm=e,t.tagInputElm.addEventListener("keydown",t._handleInputKeyDown))},className:"rule_content "+(!i&&"rule_content_error")+" "+(5===d.length?"rule_content_input_hide":"rule_content_input_show"),tags:a,onAdd:this._handleOnAddTag,createTagOnKeys:[13],placeholder:"还可输入"+(5-d.length)+"个关键词",onDelete:this._handleOnTagDelete,onBlur:this._handleOnTagBlur}),C().createElement("i",{onClick:this._handleOnDelete,className:"icon-cem_delete rule_delete_icon"}))},e}(C().PureComponent);const d=o;o.propTypes={index:t().number,data:t().shape({id:t().string,key:t().string,name:t().string,type:t().string,content:t().arrayOf(t().string)}).isRequired,objOptions:t().arrayOf(t().string).isRequired,conOptions:t().arrayOf(t().string).isRequired,plaOptions:t().array,onDelete:t().func.isRequired,onChange:t().func.isRequired,test:t().bool};var g=n(58992),_=n(61409),o=function(t){function e(e){var n=t.call(this,e)||this;return n._handleConpositing=function(){n.compositing=!0},n._handleCompositionEnd=function(e){var t=e.currentTarget,e=n.props.onChange;n.compositing=!1,e(t.value)},n._handleOnChange=function(e){var t=e.target,e=n.props.onChange;n.compositing||e(t.value)},n.compositing=!1,n}return l()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.title,a=e.value,r=void 0===a?"":a,a=e.test,a=void 0===a||a,e=e.placeHolder;return C().createElement("div",{className:"yt_content_input_wrapper"},n,C().createElement("input",{className:a?"":"error",placeholder:e,value:r,onChange:function(e){e=e.target;return t.props.onChange(e.value)}}))},e}(C().PureComponent);const y=o;o.propTypes={onChange:t().func.isRequired,title:t().string.isRequired,value:t().string,placeHolder:t().string,test:t().bool};var O={14:{title:"贴吧名",placeHolder:'输入贴吧名称，不要带"吧"字'}},o=function(t){function e(e){var c=t.call(this,e)||this;return c.setQueAnsState=function(e){var t=e.preConData,n=e.nowConData,e=e.value;JSON.stringify(t)!==JSON.stringify(n)&&c.setState({content:e})},c.setBBSState=function(e){var t=e.preConData,n=e.nowConData,a=e.preValue,a=void 0===a?"":a,e=e.nowValue;JSON.stringify(t)===JSON.stringify(n)&&JSON.stringify(a)===JSON.stringify(e)||c.setState({contentStr:e})},c.setSocialState=function(e){var a,r,o,t=e.preConData,n=e.nowConData,l=e.preValue,e=e.nowValue;JSON.stringify(t)===JSON.stringify(n)&&JSON.stringify(l)===JSON.stringify(e)||(n.list[0],a=[],r={},o={},n.list.forEach(function(e){var t=e.name,n=e.key,e=e.type;a.push(t),r[t]=n,o[t]=[e,"not"+e]}),l={objOptions:a,keyDict:r,conDict:o},e&&0<e.length&&n?l.rules=e.map(function(e){return i()({},e,{contents:e.contents||e[e.type]||[],type:e.type})}):l.rules=[],c.setState(l))},c.getValue=function(){var e=c.state,t=e.rules,n=e.content,e=e.contentStr;return t?{rules:t.map(function(e){var t={key:e.key};return t[e.type]=e.contents,t})}:n?{content:c.contentRuleRef.getValue()}:e?{contentStr:e}:void 0},c.hasChanged=function(){return c.contentRuleRef?c.contentRuleRef.hasChanged():c.state.hasChanged},c.resetChanged=function(){return c.setState({hasChanged:!1})},c.test=function(){var e=c.state,t=e.rules,n=e.content,e=e.contentStr,a=!0;return 0<t.length?(t=t.map(function(e){e=0<e.contents.length;return a=e&&a,e}),c.setState({testRules:t})):n||void 0!==e&&c.setState({testRules:a=!!e}),a},c._handleOnLinkRuleChange=function(e,t){var n=c.state,a=n.rules,r=n.conDict,o=n.keyDict,l=n.testRules,i=c.props,n=i.plaData,s=i.onChange,e=a[e-1];e[t.type]=t.value,"name"===t.type&&(e.type=r[t.value][0],e.key=o[t.value],"平台"===t.value?e.contents=[n[0].id]:e.contents=[]),c.setState({rules:JSON.parse(JSON.stringify(a)),testRules:"contents"===t.type?void 0:l,hasChanged:!0},function(){s&&s(c.state.rules)})},c._handleOnLinkRuleDelete=function(e){var t=c.state.rules,n=c.props.onChange;t.splice(e-1,1),c.setState({hasChanged:!0,rules:JSON.parse(JSON.stringify(t))},function(){n&&n(c.state.rules)})},c._handleOnLinkRuleAdd=function(){var e=c.props,t=e.conData,n=e.onChange,e=c.state.rules,t=t.list[0];c.setState({hasChanged:!0,rules:e.concat([{key:t.key,name:t.name,type:t.type,contents:[]}])},function(){n&&n(c.state.rules)})},c._handleOnContentInputChange=function(e){c.setState({hasChanged:!0,contentStr:e,testRules:void 0})},c.state={rules:void 0,content:void 0,contentStr:void 0,objOptions:[],conDict:{},keyDict:{},testRules:void 0,hasChanged:!1},c}l()(e,t);var n=e.prototype;return n.componentDidMount=function(){var e=this.props,t=e.conData,n=e.value;e.messageCategory;this.setSocialState({preConData:void 0,nowConData:t,value:n})},n.componentDidUpdate=function(e,t){var n=e.conData,a=e.value,r=this.props,o=r.conData,e=r.value,r=r.messageCategory;"BBS"===r?this.setBBSState({preConData:n,nowConData:o,preValue:a,nowValue:e}):"SOCIAL"!==r&&"NEWS"!==r&&"QUE_ANS"!==r||this.setSocialState({preConData:n,nowConData:o,preValue:a,nowValue:e})},n.render=function(){var n=this,e=this.state,t=e.rules,a=e.content,r=e.contentStr,o=e.objOptions,l=e.conDict,i=e.testRules,s=this.props,c=s.conData,e=s.loading,u=s.plaData,s=c&&O[Number(c.sourceId)];return C().createElement("div",{className:"yt_dashboard_rule_com_wrapper "+(this.props.className||"")},C().createElement("div",{className:"dashboard_rule_title"},"内容（以下规则将逐层生效过滤要获取的数据，关键词不区分英文大小写）"),C().createElement(v.Loading,{loading:e,className:"dashboard_rule_content"},t?C().createElement(C().Fragment,null,t.map(function(e,t){return C().createElement(d,{data:e,objOptions:o,conOptions:l[e.name],plaOptions:u,key:"rule_"+t,index:t+1,conData:c.list,test:!i||i[t],onDelete:n._handleOnLinkRuleDelete,onChange:n._handleOnLinkRuleChange})}),t.length<5?C().createElement("div",{className:"dashboard_rule_more "+(0===t.length?"dashboard_rule_more_empty":"")},C().createElement("span",{onClick:this._handleOnLinkRuleAdd},C().createElement("i",{className:"icon-cem_add-to"})),(0===t.length?"":"还")+"可添加"+(5-t.length)+"条规则"):C().createElement("div",{className:"dashboard_rule_no_more"},"最多可添加5条规则")):a?C().createElement("div",{className:"dashboard_content_rule"},C().createElement(g.Z,{value:a,ref:function(e){return n.contentRuleRef=e}})):void 0!==r?C().createElement(y,{title:s?s.title:"专栏",placeHolder:s?s.placeHolder:"请输入规则内容",test:i,onChange:this._handleOnContentInputChange,value:r}):""))},e}(C().PureComponent);const N=o;o.propTypes={className:t().string,conData:t().object,plaData:t().array.isRequired,loading:t().bool,value:t().any,messageCategory:t().string,onChange:t().func};var b=n(19586),R=function(n){function e(e){var t=n.call(this,e)||this;return t._handleGetFilterRef=function(e){return t.filterRef=e},t._handleGetRuleRef=function(e){return t.ruleRef=e},t._handleOnFilterChange=function(e){t.changed=!0,t.setState({filter:(0,b.C)(e)})},t._handleOnRuleChange=function(e){t.setState({rules:e}),t.changed=!0},t.getValue=function(){return{filterModel:t.filterRef.getReFormatValue(),rules:t.ruleRef.getValue().rules}},t.hasChanged=function(){return t.changed},t.resetChanged=function(){t.changed=!1},t.test=function(){return t.ruleRef.test()},t._handleOnFilterReady=function(){t.props.onFilterReady(!0),t.setState({ready:!0})},t._handelClear=function(){t.filterRef.clearData(),t.setState({rules:[]})},t.state={filter:[],rules:[],ruleConData:void 0,ready:!1,filterValue:{}},t.changed=!1,t}l()(e,n);var t=e.prototype;return t.componentDidUpdate=function(e){var t=e.value,a=this.props.value;JSON.stringify(t)!==JSON.stringify(a)&&(e=a.rules?a.rules.map(function(e){return i()({},e,{contents:e[e.type]||[]})}):[],t=a.filterModel?Object.keys(a.filterModel).reduce(function(e,t){var n;return t?i()({},e,((n={})[t]=a.filterModel[t],n)):e},{}):{},this.setState({filter:(0,b.C)(t),rules:e,ruleConData:{sourceId:"11",list:[{name:"商品详情页标题",type:"like",key:"title"},{name:"评论/追评",type:"like",key:"content"}]}}))},t.render=function(){var e=this.state,t=e.filter,n=e.rules,a=e.ruleConData,r=e.ready,e=this.props.dimensionModelId;return C().createElement("div",{className:"yt_dashboard_template_filter_wrapper"},C().createElement("div",{className:"filter_header"},C().createElement("span",null,"数据过滤"),C().createElement(s.Z,{placement:"top",overlay:"图外筛选：可过滤图表展示的数据",overlayClassName:"title_desc_popup"},C().createElement("i",{className:"icon-cem_file1"})),(0<t.length||0<n.length)&&C().createElement("span",{onClick:this._handelClear},"清空选项")),e&&C().createElement(u.Z,{ref:this._handleGetFilterRef,style:{display:"block"},type:"PRICE_WARNING",value:r?t:[],noFresh:r,filter:["MESSAGE_RELATION","CONN_CONFIG","DS001"===e?"ALL_ASPECT":"VOC_ASPECT","TAG","BRAND_SERIES"],filterConfig:["ESCORE","messageType","KEY_WORD","USEFUL_DATA"],noBottom:!0,moreFilterPosition:"top",onFilterChange:this._handleOnFilterChange,onFilterReady:this._handleOnFilterReady,hideAdvanced:!0}),C().createElement("div",{className:"filter_rule"},C().createElement(N,{value:n,ref:this._handleGetRuleRef,messageCategory:"QUE_ANS",conData:a,onChange:this._handleOnRuleChange,plaData:[{id:"11",name:"知乎"}],loading:!1})))},e}(a.Component);R.propTypes={value:t().shape({filter:t().array,rules:t().array}),dimensionModelId:t().string,onFilterReady:t().func};const S=function(t){function e(e){var n=t.call(this,e)||this;return n.showDialog=function(e){n.state.visible?n.setState({visible:!1,callback:void 0},function(){n.setState(i()({visible:!0},e))}):n.setState(i()({visible:!0},e))},n._handleOnCancel=function(){n.setState({visible:!1,data:void 0,callback:void 0})},n._handleOnConfrim=function(){var e=n.state,t=e.callback,e=e.data;t&&t(e),n.setState({visible:!1,data:void 0,callback:void 0})},n.state={visible:!1,data:void 0,callback:void 0},n}return l()(e,t),e.prototype.render=function(){var e=this.state.visible;return C().createElement(v.Dialog,{className:"yt-nps-template-delete-dialog-wrapper",size:"tiny",visible:e,title:"确定离开此页面？",closeOnClickModal:!1,onCancel:this._handleOnCancel},C().createElement(v.Dialog.Body,null,"你修改的信息将不会被保存"),C().createElement(v.Dialog.Footer,null,C().createElement(v.Button,{onClick:this._handleOnCancel},"取消"),C().createElement(v.Button,{type:"primary",onClick:this._handleOnConfrim},"确定")))},e}(C().PureComponent);var k=n(55815),D=n(55882);const I=function(e){var t=C().useState(!1),n=t[0],a=t[1],r=e.title,o=e.loading,l=e.onSave,i=e.onCancel,s=e.onChartPreview,c=e.onBeforeJump,u=e.getExitDialogRef,d=e.isCopy,p=e.templateData,h=e.getNameRef,m=e.getFilterRef,f=e.dimensionModelId,g=e.dashId,_=e.previewLoading,t=e.option,e=e.closePreview,g=[{title:r,url:"/dashboard/"+g},{title:"选择模板",url:"/dashboard/"+g+"/list"},{title:"设置图表",url:""}];return C().createElement("div",{className:"yt_dashboard_template_edit_wrapper"},C().createElement(v.Loading,{loading:o||!n||_,style:{height:"100%"}},C().createElement(k.Z,{title:g,beforeJump:c}),C().createElement("div",{className:"edit_content"},C().createElement(E,{isCopy:d,value:p,ref:h}),C().createElement(R,{ref:m,value:p,dimensionModelId:f,onFilterReady:a})),C().createElement("div",{className:"button_zone"},C().createElement(v.Button,{type:"primary",onClick:function(){l("back")}},"保存并返回"),C().createElement(v.Button,{onClick:function(){l("noback")}},"保存"),C().createElement(v.Button,{onClick:i},"取消"),C().createElement(v.Button,{onClick:s},"预览"))),C().createElement(S,{ref:u}),t&&C().createElement(D.Z,{option:t,shrink:e}))};var t=n(55609),P=n(35239),w=n(5133),n=n(64396),T=n.Z.dashboard.template.edit,L=n.Z.public.menu,n=function(a){function e(e){var n=a.call(this,e)||this;n._handleOnBeforeJump=function(e,t){n.getNameRef.hasChanged()||n.filterRef.hasChanged()?n.exitDialogRef.showDialog({callback:function(){n.props.router.setRouteLeaveHook(n.props.route,n.routerCancleConfirm),e()}}):e()},n._handleOnCancel=function(){n.getNameRef.hasChanged()||n.filterRef.hasChanged()?n.exitDialogRef.showDialog({callback:function(){n.props.router.setRouteLeaveHook(n.props.route,n.routerCancleConfirm),_.mW.replace("/dashboard/"+n.state.dashId)}}):_.mW.replace("/dashboard/"+n.state.dashId)},n._handleOnSave=function(e){n.getNameRef.test()&&(n.filterRef.test()?n.saveLock||(n.saveLock=!0,n.props.commitChart(i()({isCopy:n.state.isCopy},n.getNameRef.getValue(),n.filterRef.getValue(),{callback:function(){w.Z.success("保存成功"),n.getNameRef.resetChanged(),n.filterRef.resetChanged(),"back"===e&&_.mW.replace("/dashboard/"+n.state.dashId)}})).then(function(e){n.saveLock=!1})):w.Z.error("内容规则存在非法值"))},n._handelChartPreview=function(){n.getNameRef.test()?n.filterRef.test()?n.props.fetchPreviewChart(i()({},n.getNameRef.getValue(),n.filterRef.getValue())):w.Z.error("内容规则存在非法值"):w.Z.error("图表名称不能为空")},n._jumpToList=function(){_.mW.push("/dashboard/"+n.state.dashId+"/list")},n.routerWillLeave=function(){return!n.getNameRef.hasChanged()&&!n.filterRef.hasChanged()||"你修改的信息将不会被保存，确定离开此页面？"},n.routerCancleConfirm=function(){if(n.getNameRef.hasChanged()||n.filterRef.hasChanged())return!0};var t=e.params,e=e.location.state;return n.state={projectId:P.t.get(P.V.curProject).id,dashId:t.id||location.pathname.split("/")[2],chartId:e&&e.chartId||"",temId:e&&e.temId||"",isCopy:e&&e.isCopy||!1,title:"",loading:!0},n.saveLock=!1,n.event={onBeforeJump:n._handleOnBeforeJump,onCancel:n._handleOnCancel,onSave:n._handleOnSave,onChartPreview:n._handelChartPreview,getNameRef:function(e){return n.getNameRef=e},getFilterRef:function(e){return n.filterRef=e},getExitDialogRef:function(e){return n.exitDialogRef=e},onFilterReady:n._handleOnFilterReady},n}l()(e,a);var t=e.prototype;return t.componentDidMount=function(){this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave);var e=this.state,t=e.projectId,n=e.dashId,a=e.chartId,e=e.temId;this.props.fetchTemplateData({projectId:t,dashId:n,chartId:a,temId:e})},t.componentDidUpdate=function(e){var t=this;(this.props.titleList.dashboards||e.menuLoading&&!this.props.menuLoading)&&this.props.titleList.dashboards.map(function(e){return e.dataDashboardVOList}).forEach(function(e){!e||(e=e.find(function(e){return e.id===t.state.dashId}))&&t.setState({title:e.name})}),e.dataLoading&&!this.props.dataLoading&&this.setState({loading:!1})},t.componentWillUnmount=function(){this.props.clean(),this.getNameRef.resetChanged(),this.filterRef.resetChanged()},t.render=function(){return C().createElement(I,i()({},this.props,this.state,this.event))},e}(C().PureComponent);const x=(0,t.connect)(function(e){var t=e.loading,e=r()(e,["loading"]);return i()({},e[T],{titleList:e[L].menuList,dataLoading:t.effects[T+"/fetchTemplateData"]||!1,previewLoading:t.effects[T+"/fetchPreviewChart"]||!1,menuLoading:t.effects[L+"/fetchMenuList"]||!1})},function(t){return{fetchTemplateData:function(e){return t({type:T+"/fetchTemplateData",payload:e})},commitChart:function(e){return t({type:T+"/commitChart",payload:e})},fetchPreviewChart:function(e){return t({type:T+"/fetchPreviewChart",payload:e})},closePreview:function(){return t({type:T+"/closePreview"})},clean:function(e){return t({type:T+"/clean",payload:e})}}})(n)},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(67154),d=n.n(a),r=n(37316),p=n.n(r),t=n(85354),o=n.n(t),a=n(67294),h=n.n(a),r=n(45697),t=n.n(r),r=n(94184),m=n.n(r),a=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,r=e.block,o=e.indeterminate,l=e.value,i=e.checked,s=e.defaultChecked,c=e.onChange,u=e.disabled,e=p()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),c={value:l,checked:i,defaultChecked:s,onChange:c,disabled:u},a=m()(t,((u={})[t+"-disabled"]=c.disabled,u[t+"-block"]=r,u[t+"-indeterminate"]=o,u),a);return h().createElement("label",d()({tabIndex:c.disabled?-1:0,className:a},e),h().createElement("input",d()({type:"checkbox",className:t+"-input"},c)),h().createElement("span",{className:t+"-status"}),n&&h().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const l=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>i});var a=n(24473),r=n(67154),s=n.n(r),o=n(37316),c=n.n(o),t=n(85354),l=n.n(t),r=n(67294),u=n.n(r),o=n(45697),t=n.n(o),o=n(94184),d=n.n(o),o=function(r){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=r.call.apply(r,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return l()(e,r),e.prototype.render=function(){var r=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,o=(e.onChange,e.values),l=e.checkedList,i=e.block,e=c()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=o?o.map(function(e,t){var n=0!==l.length&&-1!==l.indexOf(e);return u().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return r.handleCheckBoxChange(e)},block:i},e)}):u().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==l.length&&-1!==l.indexOf(a);return u().cloneElement(e,{checked:a,key:t,block:n.block||i,onChange:function(){var e=n.value;r.handleCheckBoxChange(e)}})}});return u().createElement("div",s()({className:d()(t,a)},e),n)},e}(r.Component);o.defaultProps={prefixCls:"wt-checkbox-group"},o.propTypes={onChange:t().func,values:t().array,block:t().bool};const i=o;var p=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},r=function(e){function t(){return e.apply(this,arguments)||this}return l()(t,e),t.prototype.render=function(){var e=this.props,t=p(e);return u().createElement("label",{className:e.className,title:e.children},u().createElement("div",{className:"checkbox"},u().createElement("input",s()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),u().createElement("div",{className:"checkbox-body"}))," ",u().createElement("span",null,e.children))},t}(r.Component);r.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},58992:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var t=n(67154),l=n.n(t),t=n(85354),a=n.n(t),t=n(67294),g=n.n(t),_=n(92360),t=n(45697),t=n.n(t),C=n(2258),v=n.n(C),E=n(85151),y=[{label:"包含",value:"contain"},{label:"不包含",value:"notContain"}];const i=function(e){var o=e.ruleGroup,l=e.formRef,i=e.groupIdx,r=e.editable,s=e.onSelectChange,c=e.onInputChange,u=e.onRuleItemDelete,t=e.onRuleGroupDelete,n=e.onRuleItemAdd,a=e.onActiveRuleCheckChange,d=(0===o.contain.length||""===o.contain[0])&&0===o.notContain.length,p=g().useState(d),h=p[0],m=p[1],e=g().useState(""),d=e[0],f=e[1];g().useEffect(function(){var e,n;h||f((e=o.sentence,n=o,(e?"一句话中":"全文中")+"："+["contain","notContain"].reduce(function(e,t){return n[t]&&0<n[t].length?[].concat(e,[("contain"===t?"包含":"不包含")+n[t].map(function(e){return'<span style="color: #262626;">“'+e+"”</span>"}).join("，")]):e},[]).join("，且")))},[h]);p=o.contain.length+o.notContain.length,e=42*p+30+10;return g().createElement("div",{className:"content-rule-group"},g().createElement("div",{className:"content-rule-group-top"},g().createElement("span",{className:"show-icon",onClick:function(){var t,a,e,n,r;h?(t=o,a=i,e=l,n=["contain","notContain"].reduce(function(e,n){return[].concat(e,t[n].map(function(e,t){return"rule-"+a+"-"+n+"-"+t}))},[]),r=e[0],n=n.map(function(e){return new Promise(function(t,n){r?r.validateField(e,function(e){(null===e?t:n)()}):n()})}),Promise.all(n).then(function(){m(!1)})):m(!0)}},g().createElement("i",{className:"icon-cem_pull-or-take-up",style:{transform:"rotate("+(h?-180:0)+"deg)"}})),g().createElement("span",{className:"content-rule-group-title"},h?g().createElement("span",{className:"group-title-check"},g().createElement(E.Jg,{checked:o.sentence,onChange:function(e){e=e.currentTarget.checked;return a(i,e)}}),g().createElement("span",{style:{marginLeft:8}},"以下关键词出现在",g().createElement("span",{style:{color:"#262626"}},"“一句话”"),"中条件才生效?")):g().createElement("span",{dangerouslySetInnerHTML:{__html:d}})),g().createElement("span",{className:"group-delete",onClick:function(){return t(i)}},g().createElement("i",{className:"icon-cem_delete"}))),g().createElement("div",{className:"content-rule-group-list",style:{height:h?e:0,paddingTop:h?10:0}},g().createElement("div",{className:"group-list "+(1<p?"mulit-group-list":"")},g().createElement("span",{className:"list-left"},g().createElement("span",{style:{fontSize:14}},"且")),g().createElement("span",{className:"list-right"},["contain","notContain"].map(function(a){return o[a]&&o[a].map(function(e,t){var n="rule-"+i+"-"+a+"-"+t;return g().createElement("div",{key:n,className:"content-rule-group-item"},g().createElement("span",null,g().createElement(v(),{disabled:!r,value:y.find(function(e){return e.value===a}).label,onChange:function(e){return s(n,e)}},y.map(function(e){return g().createElement(C.Option,{key:e.value,title:e.label},e.label)}))),g().createElement("span",{style:{height:42}},g().createElement(_.Form.Item,{prop:n},g().createElement(_.Input,{disabled:!r,value:e,onChange:function(e){return c(n,e)}}))),r&&g().createElement("span",{onClick:function(){return u(n)}},g().createElement("i",{className:"icon-cem_delete"})))})}))),r&&g().createElement(g().Fragment,null,g().createElement("span",{className:"add-icon",onClick:function(){return n(i)}},g().createElement("i",{className:"icon-cem_add-to"})),g().createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"添加新的关键词"))))};var r={contain:[""],notContain:[],sentence:!0,id:Math.round(1e4*Math.random())},n=function(t){function e(e){var i=t.call(this,e)||this;i._handleOnRuleGroupAdd=function(){var e=i.state.content,e=[].concat(e,[JSON.parse(JSON.stringify(r))]);i.setState({content:e,formProps:i.getFormProps(e),hasChanged:!0})},i._handleOnRuleItemAdd=function(e){var t,n=i.state.content,a=i.props.onChange;n[e]&&((t=JSON.parse(JSON.stringify(n)))[e].contain||(t[e].contain=[]),t[e].contain.push(""),i.setState({content:t,formProps:i.getFormProps(t),hasChanged:!0},function(){return a&&a(t)}))},i._handleOnRuleItemDelete=function(e){var t,n,a,r,o;e&&(t=i.state.content,n=i.props.onChange,(r=e.split("-"))[0],a=r[1],e=r[2],r=r[3],t[a]&&t[a][e]&&void 0!==t[a][e][r]&&((o=JSON.parse(JSON.stringify(t)))[a][e].splice(r,1),0===o[a].contain.length&&0===o[a].notContain.length&&o.splice(a,1),i.setState({content:o,formProps:i.getFormProps(o),hasChanged:!0},function(){return n&&n(o)})))},i._handleOnSelecChange=function(e,t){var n,a,r,o,l;e&&t&&(n=i.state.content,a=i.props.onChange,(l=e.split("-"))[0],r=l[1],e=l[2],l=l[3],n[r]&&n[r][e]&&void 0!==n[r][e][l]&&(l=(o=JSON.parse(JSON.stringify(n)))[r][e].splice(l,1),o[r][t].push(l[0]),i.setState({content:o,formProps:i.getFormProps(o),hasChanged:!0},function(){return a&&a(o)})))},i._handleOnInputChange=function(e,t){var n,a,r,o,l;e&&(n=i.state.content,a=i.props.onChange,(o=e.split("-"))[0],r=o[1],e=o[2],o=o[3],n[r]&&n[r][e]&&void 0!==n[r][e][o]&&((l=JSON.parse(JSON.stringify(n)))[r][e][o]=t,i.setState({content:l,formProps:i.getFormProps(l),hasChanged:!0},function(){return a&&a(l)})))},i._handleOnActiveRuleCheckChange=function(e,t){var n,a=i.state.content,r=i.props.onChange;a[e]&&((n=JSON.parse(JSON.stringify(a)))[e].sentence=t,i.setState({content:n,hasChanged:!0},function(){return r&&r(n)}))},i._handleOnRuleGroupDelete=function(e){var t,n=i.state.content,a=i.props.onChange;!n[e]||(t=JSON.parse(JSON.stringify(n))).splice(e,1)&&i.setState({content:t,hasChanged:!0,formProps:i.getFormProps(t)},function(){return a&&a(t)})},i.getValue=function(){return i.state.content},i.hasChanged=function(){return i.state.hasChanged},i.getFormProps=function(e){var r={model:{},rules:{}};return e&&0<e.length&&e.forEach(function(e,a){e&&["contain","notContain"].forEach(function(n){e[n]&&e[n].forEach(function(e,t){t="rule-"+a+"-"+n+"-"+t;r.model[t]=e,r.rules[t]=[{required:!0,message:" ",trigger:"blur"}]})})}),r},i.mRefs=[],i.formRef=void 0;e=(e.value||[r]).map(function(e){return l()({},e,{id:Math.round(1e4*Math.random())})});return i.state={content:e,formProps:i.getFormProps(e),hasChanged:!1},i}a()(e,t);var n=e.prototype;return n.componentDidUpdate=function(e){var t=e.value,e=this.props.value;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({content:e,formProps:this.getFormProps(e)})},n.render=function(){var n=this,e=this.state,t=e.content,a=e.formProps,r=this.props,e=r.editable,o=void 0===e||e,r=r.className,r=void 0===r?"":r;return g().createElement("div",{className:"content-rule-wrapper "+r},g().createElement("span",{className:"content-rule-title"},"内容"),g().createElement("div",{className:"content-rule"},g().createElement(_.Form,l()({},a,{ref:function(e){n.formRef=e,n.mRefs.splice(0,n.mRefs.length),n.mRefs.push(e)}}),0<t.length&&g().createElement("span",{className:"content-rule-hint"},"满足任意一组条件，该规则即生效"),t.map(function(e,t){return g().createElement(i,{key:e.id,formRef:n.mRefs,ruleGroup:e,groupIdx:t,editable:o,onSelectChange:n._handleOnSelecChange,onRuleGroupDelete:n._handleOnRuleGroupDelete,onInputChange:n._handleOnInputChange,onRuleItemDelete:n._handleOnRuleItemDelete,onRuleItemAdd:n._handleOnRuleItemAdd,onActiveRuleCheckChange:n._handleOnActiveRuleCheckChange})})),o&&g().createElement(g().Fragment,null,g().createElement("span",{className:"add-icon",onClick:this._handleOnRuleGroupAdd},g().createElement("i",{className:"icon-cem_add-to"})),g().createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"添加新的条件"))))},e}(g().PureComponent);const o=n;n.propTypes={value:t().array,editable:t().bool,onChange:t().func,className:t().string}}}]);