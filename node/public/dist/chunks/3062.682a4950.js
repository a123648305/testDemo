(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3062],{13062:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var a=n(37316),o=n.n(a),t=n(67154),i=n.n(t),a=n(85354),r=n.n(a),t=n(67294),D=n.n(t),a=n(55609),T=n(17051),E=n(99543),S=n(50196),y=n(41192),v=n(60496),C=n(50976),d=n(71339);const b=function(e){var t=e.option,n=e.data,a=e.loading,o=D().useState(1),i=o[0],r=o[1],c=D().useState(10),s=c[0],e=c[1],o=D().useState([]),c=o[0],l=o[1];D().useEffect(function(){l(n.slice(0,s)),r(1)},[s,t.aspectType]),D().useEffect(function(){n&&n instanceof Array&&l(n.slice((i-1)*s,i*s))},[n,i]);o=function(e){e=e-5-24-40-32;return[{label:"",width:16},{label:"排序",width:.3*e,render:function(e,t,n){return n+1}},{label:"关注点",width:.3*e,prop:"name"},{label:"数量",width:.3*e,prop:"value"},{label:"占比",width:.1*e,prop:"precent",render:function(e){return(100*e.precent).toFixed(2)+"%"}},{label:"",width:16}]}(t.width);return D().createElement("div",{className:"yt-aspect-table-wrapper",style:t.style},D().createElement(d.Z,{data:c,loading:a,option:t,columns:o,total:n.length,pageIndex:i,pageSize:s,onPageSizeChange:e,onPageChange:r}))};var w=n(8201),x=n(53754),k=n(43036),P=n(22120),_=n(98191),O=n(39432),F=[{title:"导出图片",type:"image"},{title:"导出数据",type:"data"}],A=[{title:"一级关注点",value:"ASPECT1"},{title:"二级关注点",value:"ASPECT2"}],N={c0:["cem_histogram","cem_histogram-col","柱状图"],c1:["cem_area","cem_area-col","面积图"],c2:["cem_form-new","cem_form-new-col","表格"]};const W=function(e){var t=e.title,l=e.data,r=e.onMoreClick,n=e.loading,a=e.aspectType,o=e.onFilterChange,i=e.contentWidth,c=e.onChartClick,s=e.defChartType,d=e.conPosition,p=e.onConPositionChange,u=D().useState(s),h=u[0],e=u[1],s=D().useState(void 0),f=s[0],m=s[1],u=D().useState([]),s=u[0],g=u[1],u="c2"===h?F.slice(1):F;return D().useEffect(function(){var e,t,n,a,o,i,r,c,s;f&&"c2"!==h&&(f.resize(),(0,w.P)(l)?(e="c0"===h?(t=l,n=f.getWidth(),a=t.chartData,o=t.title,i=t.dataType,r=Array.from({length:a.length}),t=a.source[0],c=.8*n/(70*t.length),s=1<(0,O.jD)(t.join(""),12)/(.6*n),{title:{text:o,textStyle:{fontSize:14}},color:["#1574B3","#A1C7E1"],dataset:r.map(function(e,t){return{dimensions:[a.dimensions[0],a.dimensions[t+1]],sourceHeader:!1,source:[a.source[0],a.source[t+1]]}}),grid:r.map(function(){return{show:!1,left:24,right:24,top:60,bottom:s?60:c<1?50:30,containLabel:!0}}),tooltip:{formatter:function(e){var t=e.marker,e=e.data;return[t+" "+e[0],"关注点数量："+e[1]].join("<br />")}},dataZoom:{show:c<1,type:"slider",xAxisIndex:r.map(function(e,t){return t}),start:0,end:+(100*c).toFixed(0),height:20,handleSize:"100%",showDelay:!1},xAxis:r.map(function(e,t){return{type:"category",triggerEvent:"aspect"===i,gridIndex:t,show:0===t,axisTick:{show:0===t,alignWithLabel:!0},axisLabel:{interval:0,rotate:s?45:0,margin:s?15:8,formatter:function(e){return 6<e.length?e.substring(0,5)+"...":e}}}}),yAxis:r.map(function(e,t){return{type:"value",gridIndex:t,minInterval:1,show:0===t}}),series:r.map(function(e,t){return{type:"bar",zlevel:1-t,yAxisIndex:t,xAxisIndex:t,seriesLayoutBy:"row",datasetIndex:t,barMinHeight:20,barMaxWidth:0===t?24:40}})}):(e=l.tableData,{title:{text:l.title},tooltip:{formatter:function(e){var t=e.marker,n=e.data,a=n.value,n=n.name;return e.name?[t+" "+n,"关注点数量："+a].join("<br />"):""}},series:[{type:"treemap",roam:!1,zoomToNodeRatio:void 0,leafDepth:1,nodeClick:!1,left:24,right:24,top:60,bottom:30,levels:[{itemStyle:{borderWidth:0,gapWidth:2}}],breadcrumb:{show:!1},data:e}]}),f.clear(),f.setOption(e)):m(void 0))},[l,f,h,a]),D().useEffect(function(){(0,w.P)(l)&&l.tableData&&g(l.tableData)},[l,h]),D().createElement(w.Z,{data:l,className:d?"yt-bar-tree-table-chart-wrapper higher-z-index":"yt-bar-tree-table-chart-wrapper",renderTitle:D().createElement(_.Z,{title:"c2"!==h?t:"",moreOptions:u,data:l,onMoreClick:function(e){return t=f,n=l,a=r,i=void 0,"image"===(e=e)?i=t:"data"===e&&(o=JSON.parse(JSON.stringify(n.chartData.source)),["product"===n.dataType?"产品":"关注点","会话数量"].forEach(function(e,t){return o[t].splice(0,0,e)}),o.push(["占比"]),n.tableData&&n.tableData.forEach(function(e){o[2].push((100*e.precent).toFixed(2)+"%")}),i=[o]),void a({type:e,obj:i,name:t.getOption().title[0].text});var t,n,a,o,i}},a&&D().createElement(v.Z,{onChange:o,objName:"aspectType",activeObj:a,options:A}),d&&D().createElement("div",{className:"con-position"},D().createElement(x.Z,{type:1,title:"会话位置",options:P.R,value:d,onChange:p}),D().createElement(k.Z,{placement:"top",overlay:"由于客户从某个商品链接进入阿里旺旺等咨询聊天窗口后，不一定是咨询该商品。为了提高业务分析的灵活性，这里将“商品”在会话中的位置做区分，供用户切换",overlayClassName:"restricted-width-pop"},D().createElement("i",{className:"icon-cem_problem-new"}))),D().createElement(y.Z,{onChange:e,chartType:h,options:N}))},D().createElement(C.Z,{theme:"yunting_multi_color",option:{},style:{width:"100%",height:375,display:"c2"===h?"none":"block"},onEvents:{click:c},onChartReady:function(e){return m(e)}}),D().createElement(b,{option:{aspectType:a,width:i,style:{display:"c2"===h?"block":"none",paddingTop:40}},data:s,loading:n}))};var z=n(67641);const c=function(e){var t=e.isInitial,n=e.conData,a=e.overviewLoading,o=e.trendData,i=e.trendLoading,r=e.trendTimeType,c=e.trendPlatformType,s=e.onTrendFilterChange,l=e.conPosition,d=e.onConPositionChange,p=e.productDisData,u=e.productLoading,h=e.focusDisData,f=e.focusLoading,m=e.focusAspectType,g=e.onFocusFilterChange,y=e.onMoreClick,v=e.contentWidth,C=e.onFilterChange,b=e.onProductChartClick,w=e.onAspectChartClick,e=e.headerDefValue;return D().createElement("div",{className:"yt-conversation-overview-wrapper"},D().createElement(z.Z,{onChange:C,type:"overview",title:"数据概览",value:e}),D().createElement("div",{className:"co-content",id:"co-content"},D().createElement("div",null,D().createElement(T.Z,{type:1,titlePrefix:"",loading:a,isInitial:t,total:n.total,quantity:n.sum,leftSubTitle:"提及商品",leftContent:n.mentionedGoods,rightSubTitle:"提及关注点",rightContent:n.mentionedAspect}),D().createElement(E.Z,{titlePrefix:"",data:n.sourceList,loading:a,isInitial:t}),D().createElement(S.Z,{pageType:"overview",data:o,loading:i,onMoreClick:y,timeType:r,platformType:c,onFilterChange:s})),D().createElement(W,{title:"商品分布",defChartType:"c0",data:p,loading:u,contentWidth:v,onMoreClick:y,onChartClick:b,conPosition:l,onConPositionChange:d}),D().createElement(W,{title:"关注点分布",defChartType:"c1",data:h,loading:f,aspectType:m,onFilterChange:g,contentWidth:v,onMoreClick:y,onChartClick:w})))};var l=n(35239),p=n(94644),u=n(61409),s=n(64396).Z.conversation.overview,t=function(t){function e(e){var s=t.call(this,e)||this;return s._handleWindowResize=function(){s.setState({contentWidth:document.getElementById("co-content").offsetWidth})},s._handleOnFilterChange=function(e,t){l.t.set(l.V.conversationOverviewHeader,t),s.headerValue=t,s.props.fetchDatas({projectId:l.t.get(l.V.curProject).id,headerState:JSON.parse(JSON.stringify(t)),filter:i()({source:[],shopName:[],waiter:[],typeList:[],aspect1:[],aspect2:[],product:[]},JSON.parse(JSON.stringify(e)))})},s._handleOnTrendFilterChange=function(e){s.props.fetchConversationTrendData(i()({},e))},s._handleOnFocusFilterChange=function(e){s.props.fetchFocusDistributionData(i()({},e))},s._handleOnMoreClick=function(e){"image"===e.type?(0,p._v)(e.obj,e.name):"data"===e.type&&(0,p.aT)(e.obj,e.name)},s._handleOnProductChartClick=function(e){var t,n;"series"===e.componentType&&(n=s.props.headerState,t=e.name,-1!==(n=(e=JSON.parse(JSON.stringify(n))).indexOf(function(e){return"product"===e.id}))&&e.splice(n,1),e.push({id:"product",name:"分析商品",serverKey:"product",type:"radio",values:t}),u.mW.push({pathname:"/conversation/commodityAnalyze",state:{defHeader:e,from:"overview"}}))},s._handleOnAspectChartClick=function(e){var t=s.props,n=t.focusAspectType,a=t.headerState,o=e.componentType,i=e.name,r=e.value,c=e.data,t=e.componentSubType,e="ASPECT1"===n;"series"===o?"bar"===t||"treemap"===t&&!e?(n=i,-1!==(a=(i=JSON.parse(JSON.stringify(a))).indexOf(function(e){return"product"===e.id}))&&i.splice(a,1),i.push({id:"aspect",name:"关注点",serverKey:"aspect",type:"cascade",values:[{id:e?n:"",name:e?n:"",values:e?[]:[{id:n,name:n}]}]}),u.mW.push({pathname:"/conversation/concernAnalyze",state:{defHeader:i,from:"overview"}})):"treemap"===t&&e&&s._handleAspectJump(e,c.name):"xAxis"===o&&s._handleAspectJump(e,r)},s._handleAspectJump=function(e,t){(0,s.props.fetchFocusDistributionData)({aspectType:e?"ASPECT2":"ASPECT1",aspect1:e?[t]:[]})},s._handleConPositionChange=function(e){var t=s.props,n=t.save,t=t.fetchProductDistributionData;n({conPosition:e}),t()},s.state={contentWidth:0},s.event={onFilterChange:s._handleOnFilterChange,onTrendFilterChange:s._handleOnTrendFilterChange,onFocusFilterChange:s._handleOnFocusFilterChange,onMoreClick:s._handleOnMoreClick,onProductChartClick:s._handleOnProductChartClick,onAspectChartClick:s._handleOnAspectChartClick,onConPositionChange:s._handleConPositionChange},s}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return D().createElement(c,i()({},this.props,this.state,this.event))},e}(t.Component);const h=(0,a.connect)(function(e){var t=e.loading,e=o()(e,["loading"]);return i()({},e[s],{headerDefValue:e[s].headerState,overviewLoading:t.effects[s+"/fetchConversationData"]||!1,trendLoading:t.effects[s+"/fetchConversationTrendData"]||!1,productLoading:t.effects[s+"/fetchProductDistributionData"]||!1,focusLoading:t.effects[s+"/fetchFocusDistributionData"]||!1})},function(t){return{save:function(e){return t({type:s+"/save",payload:e})},fetchDatas:function(e){return t({type:s+"/fetchDatas",payload:e})},fetchConversationTrendData:function(e){return t({type:s+"/fetchConversationTrendData",payload:e})},fetchProductDistributionData:function(e){return t({type:s+"/fetchProductDistributionData",payload:e})},fetchFocusDistributionData:function(e){return t({type:s+"/fetchFocusDistributionData",payload:e})}}})(t)}}]);