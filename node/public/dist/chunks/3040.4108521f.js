(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3040],{13040:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var t=n(81506),i=n.n(t),t=n(85354),o=n.n(t),t=n(67294),c=n.n(t),l=n(92360),r=n(5133),a=n(29383),s=n(36144),u=n(55815),h=n(85151),d=function(a){function e(){for(var o,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(o=a.call.apply(a,[this].concat(t))||this).state={visible:!1,config:[{label:"消息模块",authority:!0,tip:"消息模块的配置，选中后统一授权全部消息、消息转发、消息回复等功能",contain:[{label:"全部消息",authority:"INBOX_ALL",tip:"选中后拥有该权限的用户可以查看所有消息内容",checked:!1},{label:"消息转发",authority:"INBOX_FORWARD",tip:"选中后拥有该权限的用户可以将消息转发给其他成员",checked:!1},{label:"消息回复",authority:"INBOX_REPLY",tip:"选中后拥有该权限的用户可以将消息通过消息来源进行回复",checked:!1}]},{label:"分析模块",authority:"ANALYZE",tip:"分析模块的配置，选中后统一授权系统提供能的分析面板",contain:[{label:"数据概览",authority:"ANALYZE_OVERVIEW",tip:"选中后拥有该权限的用户可以看到对应项目的数据概览",checked:!1},{label:"产品分析",authority:"ANALYZE_PRODUCT",tip:"选中后拥有该权限的用户可以看到对应项目的产品分析",checked:!1},{label:"服务分析",authority:"ANALYZE_SERVER",tip:"选中后拥有该权限的用户可以看到对应项目的服务分析",checked:!1},{label:"市场分析",authority:"ANALYZE_MARKETING",tip:"选中后拥有该权限的用户可以看到对应项目的市场分析",checked:!1},{label:"品牌分析",authority:"ANALYZE_BRAND",tip:"选中后拥有该权限的用户可以看到对应项目的品牌分析",checked:!1},{label:"价格分析",authority:"ANALYZE_PRICE",tip:"选中后拥有该权限的用户可以看到对应项目的价格分析",checked:!1}]},{label:"仪表盘模块",authority:"DASHBOARD",tip:"仪表盘模块的配置",contain:[{label:"查看",authority:!0,tip:"选中后拥有该权限的用户可以看到账户下的所有仪表盘",checked:!1},{label:"编辑",authority:"DASHBOARD_EDIT",tip:"选中后拥有该权限的用户可以对仪表盘内容进行编辑",checked:!1},{label:"删除",authority:"DASHBOARD_DELETE",tip:"选中后拥有该权限的用户可以对仪表盘进行删除",checked:!1}]},{label:"数据详情",authority:"DATA_DETAIL",tip:"图表中点击元素查看数据详情的权限",contain:[{label:"查看",authority:!0,tip:"可以查看数据详情，否则无法点击图表元素查看数据内容",checked:!1},{label:"编辑",authority:"DATA_DETAIL_EDIT",tip:"选中后拥有该权限的用户可以对数据得正负面及指标进行编辑",checked:!1},{label:"下载",authority:"DATA_DOWNLOAD",tip:"选中后拥有该权限的用户可以对数据进行下载",checked:!1}]},{label:"账户信息",authority:"ACCOUNT",tip:"账户设置模块配置",contain:[{label:"概览",authority:"ACCOUNT_OVERVIEW",tip:"选中后拥有该权限的用户可以账户下各项资源的使用情况信息",checked:!1},{label:"查看基本信息",authority:"ACCOUNT_INFO",tip:"可以查看账户的基本信息",checked:!1},{label:"编辑",authority:"ACCOUNT_INFO_EDIT",tip:"选中后拥有该权限的用户可以对账户的基本信息进行编辑",checked:!1}]},{label:"用户管理",authority:"USER",tip:"账户设置模块配置，对账户下所有用户进行管理",contain:[{label:"查看用户信息",authority:!0,tip:"可以查看用户的基本信息",checked:!1},{label:"编辑",authority:"USER_EDIT",tip:"选中后拥有该权限的用户可以对用户、角色、团队进行管理",checked:!1}]},{label:"项目管理",authority:"PROJECT",tip:"账户设置模块配置，对账户下所有项目进行管理",contain:[{label:"查看项目信息",authority:!0,tip:"可以查看项目的信息",checked:!1},{label:"编辑",authority:"PROJECT_EDIT",tip:"选中后拥有该权限的用户可以对项目、主题、链接进行管理",checked:!1},{label:"删除",authority:"PROJECT_DELETE",tip:"选中后拥有该权限的用户可以将项目删除",checked:!1}]},{label:"安全",authority:"SAFETY",tip:"账户设置模块配置，对账户的安全进行管理",contain:[{label:"审计日志",authority:"SAFETY_AUDIT_LOG",tip:"可以查看账户下所有用户对系统进行的各项操作",checked:!1},{label:"操作日志",authority:"SAFETY_HISTORY_LOG",tip:"可以查看账户下所有用户对账户进行的各项操作",checked:!1},{label:"查看IP白名单",authority:"SAFETY_IP",tip:"选中后拥有该权限的用户查看IP白名单",checked:!1},{label:"添加IP白名单",authority:"SAFETY_IP_ADD",tip:"选中后拥有该权限的用户可以添加IP白名单",checked:!1},{label:"添加IP白名单",authority:"SAFETY_IP_DELETE",tip:"选中后拥有该权限的用户可以删除IP白名单",checked:!1}]},{label:"项目",showAllTime:!0,authority:"PROJECT_LIMIT",tip:"项目",contain:[]},{label:"仪表盘",showAllTime:!0,authority:"DASHBOARD_LIMIT",tip:"仪表盘",contain:[]}],activeName:[]},o.onShow=function(e,t){var a,i=o.state.config,n=t.authorityConfig?JSON.parse(t.authorityConfig):null;t.projects&&(t.projects.forEach(function(e){e.label=e.name,n&&n.projectLimits?e.checked=-1!==n.projectLimits.indexOf(e.id):e.checked=!1}),i.forEach(function(e){"项目"===e.label&&(e.contain=t.projects)})),t.topics&&(t.topics.forEach(function(e){e.label=e.name,n&&n.topicLimits?e.checked=-1!==n.topicLimits.indexOf(e.id):e.checked=!1}),i.forEach(function(e){"主题"===e.label&&(e.contain=t.topics)})),t.dashboards&&(t.dashboards.forEach(function(e){e.label=e.name,n&&n.dashboardLimits?e.checked=-1!==n.dashboardLimits.indexOf(e.id):e.checked=!1}),i.forEach(function(e){"仪表盘"===e.label&&(e.contain=t.dashboards)})),t.authorityConfig&&(a=JSON.parse(t.authorityConfig),["inbox","analyze","dashboard","dataDetail","account","user","projectSetting"].map(function(e,n){a[e].map(function(e,t){i[n].contain[t].checked=e})})),o.setState({visible:!0,id:e,config:i,authorityTypes:t.authorityTypes})},o.onHide=function(){o.setState({visible:!1})},o.getValue=function(){var e=o.state,t=e.config;return{id:e.id,inbox:t[0].contain.map(function(e){return e.checked}),analyze:t[1].contain.map(function(e){return e.checked}),dashboard:t[2].contain.map(function(e){return e.checked}),dataDetail:t[3].contain.map(function(e){return e.checked}),account:t[4].contain.map(function(e){return e.checked}),user:t[5].contain.map(function(e){return e.checked}),projectSetting:t[6].contain.map(function(e){return e.checked}),safety:t[7].contain.map(function(e){return e.checked}).splice(0,2),ip:t[7].contain.map(function(e){return e.checked}).splice(2,5),projectLimits:t[8].contain.filter(function(e){return e.checked}).map(function(e){return e.id}),dashboardLimits:t[9].contain.filter(function(e){return e.checked}).map(function(e){return e.id})}},o.checkedBox=function(e,t,n){var a=o.state.config;a[e].contain[t].checked=!a[e].contain[t].checked,o.setState({config:a})},o.checkedAll=function(e){var t=o.state.config,n=t[e].contain.filter(function(e){return e.checked}).length===t[e].contain.length;t[e].contain.forEach(function(e){return e.checked=!n}),o.setState({config:t})},o}o()(e,a);var t=e.prototype;return t.setOpenOption=function(e){e.sort().toString()!==this.state.activeName.sort().toString()&&this.setState({activeName:e})},t.render=function(){var i=this,e=this.state,t=e.visible,n=e.config,a=e.activeName,o=e.authorityTypes;return c().createElement(l.Dialog,{title:"权限配置",className:"authority-setting-dialog",size:"small",visible:t,onCancel:this.onHide},c().createElement(l.Dialog.Body,null,c().createElement(l.Collapse,{value:a,onChange:this.setOpenOption.bind(this)},n.map(function(n,a){return o&&(0<=o.indexOf(n.authority)||!0===n.authority)?c().createElement(l.Collapse.Item,{key:a,name:String(a),title:c().createElement(h.Jg,{indeterminate:!(n.contain.filter(function(e){return e.checked}).length===n.contain.length||!n.contain.filter(function(e){return e.checked}).length),checked:n.contain.filter(function(e){return e.checked}).length===n.contain.length,onChange:function(){return i.checkedAll(a)}},n.label)},n.contain.map(function(e,t){return n.showAllTime||o&&!(o.indexOf(e.authority)<0)?c().createElement("div",{key:t},c().createElement(h.Jg,{checked:e.checked,onChange:function(){return i.checkedBox(a,t)}},e.label)):c().createElement("div",{key:t})})):c().createElement(l.Collapse.Item,{key:a})}))),c().createElement(l.Dialog.Footer,{className:"dialog-footer"},c().createElement(l.Button,{onClick:this.onHide},"取 消"),c().createElement(l.Button,{type:"primary",onClick:function(){return i.props.apply(i.getValue())}},"确 定")))},e}(t.Component),p=n(88308),m=function(e){function t(){var a=e.call(this)||this;return a.showDialog=function(){a.setState({connectDialogVisible:!0})},a.addRole=function(e){e.preventDefault(),""!==a.state.form.name?s.h.post("/role/add",a.state.form).then(function(e){r.Z.success("添加成功"),a.setState({connectDialogVisible:!1,form:{name:"",des:""}}),a.getRoleList()}):r.Z.warning("请输入角色名称")},a.changeAuthority=function(e){s.h.post("/role/authority/update",e).then(function(e){a.getRoleList(),a.refs.authorityModal.onHide()})},a.state={connectDialogVisible:!1,all:"",used:"",form:{name:"",des:""},columns:[{label:"",prop:"paddingLeft",width:16},{label:"角色",prop:"name",width:240,render:function(t,e,n){return c().createElement("div",{style:{height:"32px",position:"relative"}},c().createElement(p.Z,{id:t.id,canEdit:t.canEdit,type:"btn",value:t.name,name:"角色",confirm:function(e){a.closeInput(t.id,e)},confirmNoChange:function(e){a.confirmNoChange(t.id)},cancel:function(e){a.confirmNoChange(t.id)}}))}},{label:"消息",prop:"inbox",render:function(e,t,n){return c().createElement("span",null,e.inboxInfo||(e.inbox||0)+"/"+(e.inboxTotal||0))}},{label:"分析",prop:"analyze",render:function(e){return c().createElement("span",null,e.analyzeInfo||(e.analyze||0)+"/"+(e.analyzeTotal||0))}},{label:"仪表盘",prop:"dashboard",render:function(e){return c().createElement("span",null,e.dashboardInfo)}},{label:"数据详情",prop:"dataDetail",render:function(e){return c().createElement("span",null,e.dataDetailInfo)}},{label:"管理模块",render:function(e,t,n){return c().createElement("span",null,e.managementInfo||(e.management||0)+"/"+(e.managementTotal||0))}},{label:"操作",width:220,render:function(e,t,n){return e.id.length<2?c().createElement("span",null):c().createElement("span",null,c().createElement("span",{className:"operation_columns",onClick:a.management.bind(i()(a),e.id)},"配置权限"),c().createElement("span",{className:"operation_columns",onClick:a.changeName.bind(i()(a),e.id)},"修改名称"),c().createElement("span",{className:"operation_columns",onClick:a.deleteRole.bind(i()(a),e.id)},"删除"))}},{label:"",prop:"paddingRight",width:16}],roles:[],selTeamName:""},a}o()(t,e);var n=t.prototype;return n.management=function(t){var n=this;s.h.get("/role/authority/list?id="+t).then(function(e){n.refs.authorityModal.onShow(t,e.data.result)})},n.changeName=function(t){var n=this,a=this.state.roles;a.map(function(e){if(e.id===t)return e.canEdit=!0,n.setState({roles:a}),!1})},n.closeInput=function(t,n){var a=this,i=this.state.roles;s.h.post("/role/update",{id:t,name:n}).then(function(e){r.Z.success("修改成功"),i.map(function(e){if(e.id===t)return e.name=n,a.setState({roles:i}),!1}),a.getRoleList()}).catch(function(e){a.getRoleList()})},n.confirmNoChange=function(t){var n=this,a=this.state.roles;a.map(function(e){if(e.id===t)return e.canEdit=!1,n.setState({roles:a}),!1})},n.onChange=function(e,t){var n;this.setState({form:Object.assign(this.state.form,((n={})[e]=t,n))})},n.deleteRole=function(e){var t=this;l.MessageBox.confirm("删除后该角色对应的用户将变为普通成员，是否继续?","提示",{type:"warning"}).then(function(){s.h.post("role/delete",{id:e}).then(function(e){r.Z.success("删除成功"),t.getRoleList()})})},n.getRoleList=function(){var n=this;s.h.get("/role/list").then(function(e){var t=e.data.result.list;t.map(function(e){e.canEdit=!1}),n.setState({roles:[{name:"企业管理员",id:"2",inboxInfo:"全部",analyzeInfo:"全部",dashboardInfo:"全部",dataDetailInfo:"全部",managementInfo:"全部",canEdit:!1},{name:"普通成员",id:"3",inboxInfo:"全部",analyzeInfo:"全部",dashboardInfo:"全部",dataDetailInfo:"全部",managementInfo:"无",canEdit:!1}].concat(t),used:e.data.result.used,all:e.data.result.limit})})},n.componentDidMount=function(){this.getRoleList()},n.render=function(){var e=this,t=document.documentElement.clientHeight-46-54-24;return c().createElement("div",{className:"common-wrapper"},c().createElement(u.Z,{title:"角色("+this.state.used+"/"+this.state.all+")",rightContent:c().createElement(l.Button,{type:"primary",onClick:this.showDialog},"添加角色")}),c().createElement("div",{className:"topic common-padding-12"},c().createElement("div",{className:"teamTable",style:{minHeight:t,backgroundColor:"#fff"}},c().createElement(a.Z,{columns:this.state.columns,data:this.state.roles||[]})),c().createElement(l.Dialog,{title:"角色",className:"yt_role_dialog_wrap",size:"tiny",visible:this.state.connectDialogVisible,onCancel:function(){return e.setState({connectDialogVisible:!1})}},c().createElement(l.Dialog.Body,null,c().createElement("span",null,"角色名"),c().createElement(l.Input,{value:this.state.form.name,onChange:this.onChange.bind(this,"name")})),c().createElement(l.Dialog.Footer,{className:"dialog-footer"},c().createElement(l.Button,{onClick:function(){return e.setState({connectDialogVisible:!1})}},"取 消"),c().createElement(l.Button,{type:"primary",onClick:this.addRole},"确 定")))),c().createElement(d,{ref:"authorityModal",apply:this.changeAuthority}))},t}(t.Component)},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(67154),h=n.n(a),i=n(37316),d=n.n(i),t=n(85354),o=n.n(t),a=n(67294),p=n.n(a),i=n(45697),t=n.n(i),i=n(94184),m=n.n(i),a=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,i=e.block,o=e.indeterminate,c=e.value,l=e.checked,r=e.defaultChecked,s=e.onChange,u=e.disabled,e=d()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),s={value:c,checked:l,defaultChecked:r,onChange:s,disabled:u},a=m()(t,((u={})[t+"-disabled"]=s.disabled,u[t+"-block"]=i,u[t+"-indeterminate"]=o,u),a);return p().createElement("label",h()({tabIndex:s.disabled?-1:0,className:a},e),p().createElement("input",h()({type:"checkbox",className:t+"-input"},s)),p().createElement("span",{className:t+"-status"}),n&&p().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const c=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>l});var a=n(24473),i=n(67154),r=n.n(i),o=n(37316),s=n.n(o),t=n(85354),c=n.n(t),i=n(67294),u=n.n(i),o=n(45697),t=n.n(o),o=n(94184),h=n.n(o),o=function(i){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=i.call.apply(i,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return c()(e,i),e.prototype.render=function(){var i=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,o=(e.onChange,e.values),c=e.checkedList,l=e.block,e=s()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=o?o.map(function(e,t){var n=0!==c.length&&-1!==c.indexOf(e);return u().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return i.handleCheckBoxChange(e)},block:l},e)}):u().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==c.length&&-1!==c.indexOf(a);return u().cloneElement(e,{checked:a,key:t,block:n.block||l,onChange:function(){var e=n.value;i.handleCheckBoxChange(e)}})}});return u().createElement("div",r()({className:h()(t,a)},e),n)},e}(i.Component);o.defaultProps={prefixCls:"wt-checkbox-group"},o.propTypes={onChange:t().func,values:t().array,block:t().bool};const l=o;var d=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},i=function(e){function t(){return e.apply(this,arguments)||this}return c()(t,e),t.prototype.render=function(){var e=this.props,t=d(e);return u().createElement("label",{className:e.className,title:e.children},u().createElement("div",{className:"checkbox"},u().createElement("input",r()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),u().createElement("div",{className:"checkbox-body"}))," ",u().createElement("span",null,e.children))},t}(i.Component);i.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},88308:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(85354),i=n.n(a),o=n(67294),s=n.n(o),t=n(45697),a=n.n(t),u=n(5133),h=n(43036),t=n(94184),d=n.n(t),t={value:a().string,id:a().any.isRequired,enter:a().bool,blurFun:a().func,name:a().string,empty:a().bool,placeholder:a().string,type:a().string,confirmNoChange:a().func},a={value:"",enter:!0,name:"名称",empty:!1,placeholder:"",cancel:function(e,t){console.log("取消")},confirm:function(e,t){console.log("确定后的value:"+e)},type:"normal"},o=function(n){function e(e){var t=n.call(this,e)||this;t.enter=function(e){t.props.enter&&13===e.keyCode&&t.confirmEdit()};e=t.props.value;return t.state={isEdit:!1,curValue:e||"",lastVal:e||"",hover:!1,canEdit:!1},t}i()(e,n);var t=e.prototype;return t.UNSAFE_componentWillReceiveProps=function(e){var t=this;e.value!==this.state.lastVal&&e.value&&this.setState({curValue:e.value,lastVal:e.value}),!0!==e.canEdit||this.state.canEdit||this.setState({canEdit:!0},function(e){t.toEdit()})},t.componentDidMount=function(){var a=this;document.body.addEventListener("click",function(e){var t=e.target||window.event.srcElement,n=a.props.className,e="edit-input-wrap";!function(e,t){for(var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e&&!n.call(e,t);)e=e.parentElement;return e}(t,"."+(e=n?n.split(" ")[0]:e))&&a.cancelEdit()})},t.changeName=function(){var e=this.props.id,e=document.getElementById(e).value;this.setState({curValue:e})},t.toEdit=function(){var e=this.state,t=e.isEdit,n=(e.canEdit,this.props.id);t||this.setState({isEdit:!0,hover:!0},function(e){var t=document.getElementById(n);setTimeout(function(){t.focus()})})},t.checkEdit=function(){"normal"===this.props.type&&this.toEdit()},t.cancelEdit=function(){var e=this.state,t=e.curValue,n=e.lastVal,a=e.isEdit,e=e.canEdit,i=this.props.cancel;a&&(e&&this.setState({canEdit:!1}),this.setState({isEdit:!1,hover:!1,curValue:n},function(e){i&&i(t,n)}))},t.borderShow=function(){var e=this.state.hover;"normal"!==this.props.type||e||this.setState({hover:!0})},t.borderHide=function(){var e=this.state,t=e.hover,e=e.isEdit;"normal"===this.props.type&&t&&!e&&this.setState({hover:!1})},t.confirmEdit=function(){var e=this.state,t=e.curValue,n=e.lastVal,a=e.canEdit,i=this.props,o=i.confirm,c=i.id,l=i.name,r=i.empty,e=i.confirmNoChange,i=i.inputType,s=document.getElementById(c);""!==String(t).replace(/\s/g,"")||r||"remark"===i?(""===String(t).replace(/\s/g,"")&&r||"remark"==i?(this.setState({isEdit:!1,hover:!1,lastVal:t},function(e){s.blur()}),o&&o(t,n)):n===t?this.setState({isEdit:!1,hover:!1},function(e){s.blur()}):(this.setState({isEdit:!1,hover:!1,lastVal:t},function(e){s.blur()}),o&&o(t,n)),a&&(e&&e(t),this.setState({canEdit:!1}))):(u.Z.warning(l+"不能为空"),this.setState({curValue:n},function(e){s.focus()}))},t.render=function(){var e=this.props,t=e.id,n=e.style,a=e.className,i=e.placeholder,o=this.state,c=o.isEdit,l=o.curValue,r=o.hover,e=d()(["edit-input-wrap",a]),o=d()(["edit-input-cont",{hover:r,"is-edit":c}]),a=d()(["edit-input",{disabled:!c}]);return s().createElement("div",{className:e,style:n},s().createElement("div",{className:o,onMouseEnter:this.borderShow.bind(this),onMouseLeave:this.borderHide.bind(this),onClick:this.checkEdit.bind(this)},s().createElement("input",{id:t,className:a,type:"text",value:l,title:l,placeholder:i,style:n,disabled:!c,onInput:this.changeName.bind(this),onKeyDown:this.enter.bind(this)}),r&&!c&&s().createElement(h.Z,{placement:"top",overlay:"编辑"},s().createElement("div",{className:"btn-wrap",title:"编辑"},s().createElement("i",{className:"name-edit edit-btn icon-cem_edit"}))),r&&c&&s().createElement("div",{className:"btn-wrap"},s().createElement(h.Z,{placement:"top",overlay:"取消"},s().createElement("i",{className:"cancel-edit edit-btn icon-cem_delete",onClick:this.cancelEdit.bind(this),title:"取消"})),s().createElement(h.Z,{placement:"top",overlay:"确认"},s().createElement("i",{className:"confirm-edit edit-btn icon-cem_check-out",onClick:this.confirmEdit.bind(this),title:"确认"})))))},e}(o.Component);o.propTypes=t,o.defaultProps=a;const c=o}}]);