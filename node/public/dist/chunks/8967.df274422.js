(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8967],{58967:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var t=n(67154),i=n.n(t),t=n(81506),a=n.n(t),t=n(85354),s=n.n(t),t=n(67294),o=n.n(t),l=n(92360),r=n(5133),c=n(29383),u=n(36144),m=n(43036),d=n(12518),h=function(t){function e(){var e=t.call(this)||this;return e.setShowSelFalse=function(){e.state.showSel&&e.setState({showSel:!1})},e.state={options:[{name:"",id:1,sel:""}],sel:[{name:""},{name:""}],value:"",showSel:!1},e}s()(e,t);var n=e.prototype;return n.selItem=function(e,t){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();e=this.state.options;e[t].sel=!e[t].sel,this.setState({options:e}),this.onChange()},n.onChange=function(){var t=[];JSON.parse(JSON.stringify(this.state.options)).forEach(function(e){e.sel&&(delete e.sel,t.push(e))}),this.props.onChange(t)},n.changeShow=function(e){var t=this;this.state.showSel&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){t.setState({showSel:!t.state.showSel})},0)},n.componentWillReceiveProps=function(e,t){var n,a;(e.options||e.value)&&(n=JSON.parse(JSON.stringify(e.options)),a=JSON.parse(JSON.stringify(e.value)),n.map(function(t){return a.forEach(function(e){t.id===e.id&&(t.sel=!0)}),t}),this.setState({options:n,value:a}))},n.componentDidMount=function(){var e=this;this.setState({options:this.props.options,value:this.props.value||[]},function(){e.state.options.map(function(t){return e.state.value.forEach(function(e){t.id===e.id&&(t.sel=!0)}),t})}),window.addEventListener("click",this.setShowSelFalse)},n.componentWillUnmount=function(){window.removeEventListener("click",this.setShowSelFalse)},n.render=function(){var n,a=this;return o().createElement("div",{className:"multiSelect",onClick:function(e){return a.changeShow(e)}},o().createElement("div",{className:"infor"},this.props.title&&o().createElement("a",null,this.props.title,"："),(n=[],a.state.options.forEach(function(e,t){e.sel&&n.push(i()({},e,{index:t}))}),0<n.length?n.map(function(t,e){return o().createElement("span",{className:t.disable?"disable":"",key:e,onClick:function(e){return a.selItem(e,t.index)}},t.name)}):o().createElement("a",null,a.props.noSelTip&&a.props.noSelTip)),o().createElement("i",{className:"el-icon-arrow-down",style:{transform:this.state.showSel?"rotate(-180deg)":"",top:this.state.showSel?"8px":""}})),o().createElement("div",{className:"selItem",onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},style:{display:this.state.showSel?"block":"none"}},o().createElement("ul",null,0<this.state.options.length?this.state.options.map(function(e,t){return o().createElement("li",{className:(e.sel?"sel":"")+(e.disable?" disable":""),key:t,onClick:function(e){return a.selItem(e,t)}},o().createElement("span",null,e.name),o().createElement("i",{className:"cem-icon cem-icon-zhengque"}))}):o().createElement("div",{className:"noData"},"无数据"))))},e}(t.Component),g=function(e){function t(){var i=e.call(this)||this;return i.changeTime=function(e){i.setState({dateRange:[e[0],e[1]]})},i.sortTime=function(e){var t="",n=i.state.selTypes.map(function(e){return e.id}),a={name:i.state.name,dateFilter:{from:i.state.param_startTime,to:i.state.param_endTime},status:n};0<e.target.className.indexOf("ascending")?t="ascending":0<e.target.className.indexOf("descending")&&(t="descending"),i.setState({sort:t},function(){i.getFileList(a)})},i.onPageSizeChange=function(e){i.setState({pageSize:e,pageIndex:1},function(){return i.getFileList()})},i.onNameSearch=function(){i.getFileList({name:i.state.name})},i.onNameChange=function(e){i.setState({name:e})},i.select=function(e){i.setState({selection:e})},i.batchDownload=function(){var e=i.state.selection,t=[];e.filter(function(e){return"EXPORTED"===e.status}).forEach(function(e){t.push({id:e.id})}),t.length?1===t.length?i.download(t[0].id):u.h.post("/data/download/batch",JSON.stringify(t)).then(function(e){var t;2e4===e.data.code&&((t=document.createElement("a")).href=e.data.result.url,t.click())}):r.Z.warning("请选中可下载的文件")},i.state={name:"",selection:[],timeVal:null,dateRange:[null,null],totalNumber:0,currentPage:1,pageSize:20,selTypes:[],types:[{id:"UNEXPORTED",name:"未生成"},{id:"EXPORTING",name:"生成中"},{id:"EXPORTED",name:"已生成"},{id:"EXPIRED",name:"已过期"},{id:"FAILED",name:"失败"}],connectDialogVisible:!1,form:{name:"",tagValue:[{tagValue:""}]},columns:[{type:"selection"},{label:"文件名",minWidth:360,prop:"name"},{label:"状态",minWidth:180,render:function(e){return"UNEXPORTED"===e.status?o().createElement(m.Z,{overlay:"前方还有"+e.queueIndex+"个任务等待生成",placement:"top"},o().createElement("span",null,i.getStatus(e.status,e.expiredAt))):o().createElement("span",null,i.getStatus(e.status,e.expiredAt))}},{label:"创建时间",minWidth:180,sortable:!0,render:function(e){return o().createElement("span",null,e.createdAt)}},{label:"过期时间",minWidth:180,render:function(e){return o().createElement("span",null,e.expiredAt)}},{label:"操作",width:100,render:function(e){return o().createElement("span",{className:"operation_columns",onClick:i.download.bind(a()(i),e.id)},"下载")}}],copyValues:[],tagValues:[{tagValue:""}],selId:null,sort:"descending"},i}s()(t,e);var n=t.prototype;return n.download=function(e){u.h.post("/data/download",{id:e}).then(function(e){var t;2e4===e.data.code&&((t=document.createElement("a")).href=e.data.result.url,t.click())})},n.getStatus=function(e){switch(e){case"UNEXPORTED":return"未生成";case"EXPORTING":return"生成中";case"EXPORTED":return"已生成";case"EXPIRED":return"已过期";default:return"生成失败"}},n.getFileList=function(e){var t=this;u.h.post("/data/list",i()({pageSize:this.state.pageSize,pageIndex:this.state.currentPage,sort:this.state.sort},e)).then(function(e){t.setState({tags:e.data.result.exportDataVOList,totalNumber:e.data.result.totalNumber,pageSize:e.data.result.pageSize,currentPage:e.data.result.currentPage})})},n.enter=function(e){13===e.keyCode&&this.onNameSearch()},n.selStatus=function(e){var t,n=this;null!==e&&e instanceof Array&&0!==e.size&&(t=e.map(function(e){return e.id}),this.setState({selTypes:e},function(){n.getFileList({status:t,name:n.state.name})}))},n.formatterTime=function(){var e=this.state.timeVal,t={from:null,to:null};return e&&(t.from=new Date(e[0]).getFullYear()+"/"+(9<new Date(e[0]).getMonth()+1?new Date(e[0]).getMonth()+1:"0"+(new Date(e[0]).getMonth()+1))+"/"+(9<new Date(e[0]).getDate()?new Date(e[0]).getDate():"0"+new Date(e[0]).getDate()),t.to=new Date(e[1]).getFullYear()+"/"+(9<new Date(e[1]).getMonth()+1?new Date(e[1]).getMonth()+1:"0"+(new Date(e[1]).getMonth()+1))+"/"+(9<new Date(e[1]).getDate()?new Date(e[1]).getDate():"0"+new Date(e[1]).getDate())),t},n.getPageTable=function(e){var t=this,n={name:this.state.name,dateFilter:this.formatterTime()};this.setState({currentPage:e,tags:[]},function(){return t.getFileList(n)})},n.componentDidMount=function(){this.getFileList()},n.componentDidUpdate=function(){var t=this,e=document.getElementsByClassName("sort-caret");Array.prototype.slice.call(e).map(function(e){return e.onclick=t.sortTime})},n.render=function(){var n=this,t=this.state.timeVal;return o().createElement("div",null,o().createElement(d.Z,{title:"导出记录"}),o().createElement("div",{className:"download"},o().createElement("div",{className:"filter"},o().createElement("div",{className:"selWrap"},o().createElement("div",{className:"topic"},o().createElement("span",null,"文件名"),o().createElement(l.Input,{icon:"search",onChange:this.onNameChange,onIconClick:this.onNameSearch,onKeyDown:this.enter.bind(this)})),o().createElement("div",{className:"source"},o().createElement("span",{style:{marginLeft:"20px"}},"状态"),o().createElement(h,{noSelTip:"全部",value:this.state.selTypes,options:this.state.types,onChange:this.selStatus.bind(this)})),o().createElement("div",null,o().createElement("div",{className:"block"},o().createElement("span",{className:"demonstration",style:{margin:"0 20px"}},"创建时间"),o().createElement(l.DateRangePicker,{value:t,placeholder:"选择日期范围",align:"left",format:"yyyy/MM/dd",ref:function(e){return n.daterangepicker2=e},disabledDate:function(e){return e.getTime()>Date.now()+864e5-864e5},onChange:function(e){JSON.stringify(e)!==JSON.stringify(t)&&n.setState({timeVal:e},function(e){return n.getPageTable(1)})},shortcuts:[{text:"最近一周",onClick:function(){var e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),n.setState({timeVal:[t,e]},function(e){return n.getPageTable(1)}),n.daterangepicker2.togglePickerVisible()}},{text:"最近一个月",onClick:function(){var e=new Date,t=new Date;t.setTime(t.getTime()-2592e6),n.setState({timeVal:[t,e]},function(e){return n.getPageTable(1)}),n.daterangepicker2.togglePickerVisible()}},{text:"最近三个月",onClick:function(){var e=new Date,t=new Date;t.setTime(t.getTime()-7776e6),n.setState({timeVal:[t,e]},function(e){return n.getPageTable(1)}),n.daterangepicker2.togglePickerVisible()}}]}))),o().createElement("div",{style:{marginLeft:"10px"}},o().createElement(l.Button,{onClick:function(){return n.batchDownload()}},"批量下载")))),o().createElement("div",{className:"teamTable"},o().createElement(c.Z,{columns:this.state.columns,data:this.state.tags||[],total:this.state.totalNumber,pageSize:this.state.pageSize,currentPage:this.state.currentPage,onPage:this.getPageTable.bind(this),onPageSizeChange:this.onPageSizeChange,onSelectChange:function(e){return n.select(e)},onSelectAll:function(e){return n.select(e)}}))))},t}(t.Component)}}]);