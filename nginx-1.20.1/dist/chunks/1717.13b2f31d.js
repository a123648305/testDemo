"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1717],{71717:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var i=n(63366),a=n(87462),s=n(94578),r=n(67294),o=n(55609),c=(n(35239),n(64396)),u=n(97189),l=n(61409),d=n(5133),f=n(43144),h=function(){var e=navigator.userAgent.toLowerCase();return/ipad|iphone|midp|rv:1.2.3.4|ucweb|android|windows ce|windows mobile/.test(e)?"mobile":"pc"},m=n(8201),p=n(63736),v=n(39077),g=n(1103);const E=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={isPc:"pc"===h(),isFooter:!1,definedSkin:""},n}(0,s.Z)(t,e);var n=t.prototype;return n.submit=function(){var e=this;this.props.handSubmit().then((function(t){e.setState({isFooter:t})}))},n.calculatedWidth=function(){return document.body.clientWidth<=860?"100%":"1024px"},n.newOpenUrl=function(e){this.props.pageConfig[e].redirectionURL&&location.assign(this.props.pageConfig[e].redirectionURL)},n.resize=function(){"pc"===h()&&location.reload()},n.componentDidMount=function(){window.addEventListener("resize",this.resize)},n.componentWillUnmount=function(){window.removeEventListener("resize",this.resize)},n.componentDidUpdate=function(e){var t=this,n=this.props.qsId;e.qsId!==n&&n&&(0,g.qq)({id:n}).then((function(e){var n,i;2e4===e.data.code?null!=(n=e.data)&&null!=(i=n.result[0])&&i.url&&t.setState({definedSkin:e.data.result[0].url}):d.Z.error("\u8bf7\u6c42\u80cc\u666f\u56fe\u7247\u5931\u8d25")}),(function(e){d.Z.error("\u8bf7\u6c42\u80cc\u666f\u56fe\u7247\u9519\u8bef")}))},n.render=function(){var e=this,t=document.documentElement.clientHeight,n=this.state,i=n.isPc,s=n.isFooter,o=this.props,c=o.pageConfig,u=o.submiting,l=o.fetchingListConfiging,d=o.status;return r.createElement("div",{className:"yt_pc_show_sectionCom",style:{backgroundImage:"url("+this.skinBg+")"}},r.createElement(m.Z,{data:c.questionslist,loading:l,className:(i?"pc_show_sectionCom":"phone_show_sectionCom")+"  "+(this.skinBg?"hasSkin":"")},d&&r.createElement("div",{className:"footer_page",onClick:this.newOpenUrl("finish")},r.createElement("div",{className:"footer_page_image"},r.createElement("img",{src:c.finish.image?c.finish.image.url:c.finish.logo.url})),r.createElement("div",{className:"footer_page_desc"},c.finish.title)),!d&&r.createElement("div",null,!s&&r.createElement("div",{className:(i?"pc_show":"phone_show")+"  "+(this.skinBg?"hasSkin":""),style:{height:t+"px",overflowY:"auto",width:i?this.calculatedWidth():"100%"}},r.createElement(p.Z,{pageConfig:(0,a.Z)({},c,{deviceType:i?"pc":"phone"}),submiting:u,handSubmit:function(){e.submit()}})),s&&r.createElement("div",{className:"footer_page",onClick:this.newOpenUrl("footer")},r.createElement("div",{className:"footer_page_image"},r.createElement("img",{src:c.footer.image?c.footer.image.url:c.footer.logo.url})),r.createElement("div",{className:"footer_page_desc"},c.footer.title)))))},(0,f.Z)(t,[{key:"skinBg",get:function(){var e,t=this.props.skinId,n=this.state.definedSkin,i=null==(e=v.O.find((function(e){return e.skinId===t})))?void 0:e.skinUrl;return i||(n||void 0)}}]),t}(r.Component);var _=["loading"],b=c.Z.research.answer,k=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={},n.events={handSubmit:n._handSubmit,conversionAnswer:n._conversionAnswer,flatten:n._flatten},n}(0,s.Z)(t,e);var n=t.prototype;return n._conversionAnswer=function(e){var t=e.map((function(e){var t={};switch(e.isShow||(e.value=""),e.type){case"NPS":case"CSAT":case"SCALE":t={id:e.id,score:e.value||""};break;case"CSAT_REASON":case"NPS_REASON":t={id:e.id,reason:e.value||""};break;case"SINGLE_PULL_DOWN":t={id:e.id,choosed:e.value?[e.value]:[]};break;case"UPLOAD_FILE":t={id:e.id,files:e.value?e.value.map((function(e){return{name:e.name,url:e.url}})):[]};break;case"MULTI_SELECTION":t={id:e.id,selected:e.value||[],multiOptions:e.options};break;case"SINGLE_SELECTION":t={id:e.id,choosed:e.value?[e.options.filter((function(t){return t.value===e.value.id}))[0].label]:[],answer:e.value.text||""};break;case"SINGLELINE_TEXT":case"MULTILINE_TEXT":t={id:e.id,answer:e.value||""};break;case"SORT":t={id:e.id,sortChoosed:e.value?e.value.map((function(e,t){var n={};return n.value=e.value,n.sort=t+1,n})):[]};break;case"NAME":t={id:e.id,name:e.value};break;case"PHONE_NUMBER":t={id:e.id,phoneNumber:e.value};break;case"EMAIL":t={id:e.id,email:e.value};break;case"GENDER":t={id:e.id,sex:1===e.value?"\u7537":"\u5973"};break;case"DATE":t={id:e.id,date:e.value||""};break;case"MATRIX_SINGLE_CHOICE":case"MATRIX_MULTIPLE_CHOICE":t={id:e.id,choices:e.value?e.value.map((function(e){return{id:e.id,choosed:e.colItems.filter((function(e){return e.value})).map((function(e){return e.title}))}})):[]};break;case"MATRIX_SCALE":t={id:e.id,scores:e.value?e.value.map((function(t){return{id:t.id,score:t.colItems.findIndex((function(e){return!e.value}))>-1?t.colItems.findIndex((function(e){return!e.value}))-1+e.limit[0]:t.colItems.length-1+e.limit[0]}})):[]};break;case"CUSTOMER_INFO":e.children.forEach((function(e){switch(e.type){case"NAME":t.name=e.value;break;case"PHONE_NUMBER":t.phoneNumber=e.value;break;case"EMAIL":t.email=e.value}})),t.id=e.id}return t}));return this.flatten(t)},n._flatten=function(e){var t=this;return e.reduce((function(e,n){return e.concat(Array.isArray(n)?t.flatten(n):n)}),[])},n._handSubmit=function(){var e=this.detailId,t=this.channel,n=this.pageConfig.questionslist,i=this.conversionAnswer(n);return this.submit({channel:t,detailId:e,answerList:i})},n.componentDidMount=function(){(0,u.getQuery)("id")||(0,u.getQuery)("detailId")||(0,u.getQuery)("channel")?this.props.findAnswerQuestionsList({id:(0,u.getQuery)("id"),detailId:(0,u.getQuery)("detailId"),channel:(0,u.getQuery)("channel")}):l.mW.push("/notFind")},n.componentWillUnmount=function(){this.props.clear()},n.render=function(){return r.createElement(E,(0,a.Z)({},this.state,this.props,this.events))},t}(r.Component);const w=(0,o.connect)((function(e){var t=e.loading,n=(0,i.Z)(e,_);return(0,a.Z)({},n[b],{fetchingListConfiging:t.effects[b+"/findAnswerQuestionsList"]||!1,submiting:t.effects[b+"/submit"]||!1})}),(function(e){return{save:function(t){return e({type:b+"/save",payload:t})},findAnswerQuestionsList:function(t){return e({type:b+"/findAnswerQuestionsList",payload:t})},submit:function(t){return e({type:b+"/submit",payload:t})},clear:function(){return e({type:b+"/clear"})}}}))(k)}}]);