"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[9973],{99973:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var r=n(87462),i=n(94578),a=n(67294),o=n(49722),l=n(53281),s=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).json=null,t.myChartClick=function(e){return e&&e.data&&e.data.url&&window.open(e.data.url),!1},t.getParams=function(){},t.buildChart=function(e){var n=t.props.json;if(n)if(0!==n.length){t.jsonStr===JSON.stringify(n)?t.refs.chart.myChart.resize():t.jsonStr=JSON.stringify(n);var r=[],i=[];n instanceof Array&&n.map((function(e,t){var n=e.connConfig.map((function(e){return e})),a=n[1];i[t]=a&&a.topicValue,r[t]={id:a&&a.topicId,name:a&&a.topicValue,value:e.price,url:e.url,category:n}}));var a={tooltip:{confine:!0,formatter:function(e){return e.data.category.map((function(e){return e?e.topicTypeValue+"\uff1a"+e.topicValue+"<br/>":""})).join("")+e.marker+"\u4ef7\u683c\uff1a"+e.value}},series:[{type:"bar",data:r,legendHoverLink:!1,barMaxWidth:20,label:{show:!0,position:"right",color:"#262626",formatter:function(t){var n=void 0===e?1:e;return t.data.category[n]?t.data.category[n].topicValue:""}}}],color:["#1574B3"],grid:{containLabel:!0,left:10,right:200,bottom:12,top:0,splitLine:{show:!0}},xAxis:[{show:!0,type:"value",scale:!0,boundaryGap:["20%","30%"],axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1},axisLabel:{color:"#262626"},axisTick:{show:!1}}],yAxis:[{type:"category",data:r,axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},axisLabel:{color:"#262626",formatter:function(e){return e}},axisTick:{show:!1}}]};t.refs.chart.setOption(a,!0)}else t.refs.chart.setEmptyOption("\u6ca1\u6709\u6570\u636e\u53ef\u7528");else t.refs.chart.loading()},t}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillMount=function(){this.setState({json:this.props.json_bar})},n.componentWillReceiveProps=function(e){this.setState({json:e.json_bar})},n.shouldComponentUpdate=function(e){return(!this.json||this.json!==JSON.stringify(e.json))&&(this.json=JSON.stringify(e.json),!0)},t}(l.Z),c=n(29383),u=n(19586),p=n(39432),d=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).json=null,t.getParams=function(){},t.myChartClick=function(e){return e&&e.data&&e.data.url&&window.open(e.data.url),!1},t.dateFormatter=function(e){var n=t.props.dateGroupType,r=e.replace("-","\u5e74");return["MONTH","DAY","HOUR"].indexOf(n)>=0&&(r=(r=r.replace("-","\u6708")).replace(" ","\u65e5 ")),"HOUR"===n&&(r+="\u65f6"),"WEEK"===n&&(r+="\u5468"),r},t.buildChart=function(){var e=t.props.json;if(e)if(0!==e.length){t.jsonStr===JSON.stringify(e)?t.refs.chart.myChart.resize():t.jsonStr=JSON.stringify(e);var n=[],r=[],i=[];e instanceof Array&&e[0].data.map((function(e,t){n.push(e.date)})),e instanceof Array&&e.map((function(e,t){var n=e.connConfig[1];n&&r.push(n.topicValue);var a=e.data.map((function(t){return{value:t.price,url:e.url,category:n}}));i.push({name:n&&n.topicValue,data:a,type:"line",legendHoverLink:!1,barMaxWidth:20,smooth:!0,connectNulls:!0})}));var a={tooltip:{trigger:"axis",confine:!0,formatter:function(e){return"\u65f6\u95f4\uff1a"+t.dateFormatter(e[0].name)+"<br/>"+e.map((function(e){var t=e.data.category?(e.data.category.topicValue?e.data.category.topicValue:"")+(""===e.data.category.topicValue||null===e.data.category.topicValue?"":"\uff1a")+(e.value?e.value:""):"";return""+e.marker+t})).join("<br/>")}},series:i,color:["#d96969","#c8662b","#c89b2b","#9369d9","#2684ff","#1574b3","#1ea082","#1bbf69","#3accd3","#d2d2d2"],legend:{type:"scroll",show:!0,orient:"vertical",top:20,right:100,bottom:20,data:r,itemGap:20,textStyle:{padding:[0,0,0,7]},formatter:function(e){var t=e.split("").reduce((function(e,t){return(0,p.jD)(e.join("").concat(t))<200&&e.push(t),e}),[]).join("");return t===e?e:t+"..."}},grid:{left:60,right:350,bottom:30,top:20,splitLine:{show:!0}},xAxis:[{show:!0,type:"category",data:n,axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1},axisLabel:{color:"#262626",formatter:t.dateFormatter},axisTick:{show:!1}}],yAxis:[{type:"value",scale:!0,boundaryGap:["20%","30%"],axisLabel:{color:"#262626"},axisTick:{show:!1},axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1}}]};t.refs.chart.setOption(a,!0)}else t.refs.chart.setEmptyOption("\u6ca1\u6709\u6570\u636e\u53ef\u7528");else t.refs.chart.loading()},t}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillMount=function(){this.setState({json:this.props.json_line})},n.shouldComponentUpdate=function(e){return(!this.json||this.json!==JSON.stringify(e.json))&&(this.json=JSON.stringify(e.json),!0)},t}(l.Z),f=n(13853),h=n(92360),m=n(35239),g=function(e){function t(t){var n;return(n=e.call(this,t)||this).ready=function(){n.getBarList(),n.getLineList(),n.getTopics()},n.stop=function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},n.checkHide=function(){(n.state.showCardList2||n.state.showCardList1)&&n.setState({showCardList1:!1,showCardList2:!1})},n.handelCardSel=function(e,t,r){var i,a=n.state["cardValue"+r];a.forEach((function(n){n.id===e&&(n.value=t)})),n.setState(((i={})["cardValue"+r]=a,i),(function(e){return 1===r?n.getBarList():n.getLineList()}))},n.onWindowResize=function(){n.waiter||(n.waiter=!0,setTimeout((function(){n.resize(),n.waiter=!1}),300))},n.resize=function(){n.refs.bar.refs.chart.myChart.resize(),n.refs.line.refs.chart.myChart.resize()},n.getBarList=function(){var e=n.getParams(),t=n.state.cardValue1;e.projectId=n.projectId,e.filterModel.project=e.filterModel.project||[n.projectId],t.forEach((function(t){return e[t.id]=t.value})),n.refs.bar.refs.chart.loading(),n.refs.bar.json=null,o.h.post("/widget/data/find/PRICE_LEVEL_BAR",e).then((function(e){var t=e.data.result.list.reverse();n.setState({json_bar:t},(function(){return n.refs.bar&&n.refs.bar.resize()}))}))},n.getTopics=function(){o.h.post("/projects/config/list",[n.projectId]).then((function(e){var t=[];e.data.result.forEach((function(e,n){var r={label:e.configName,prop:e.id,checked:1===n,minWidth:"60"};t.push(r)}));var r=t,i={label:a.createElement(h.Select,{className:"table-select",onChange:n.changeTopic,value:t.filter((function(e){return e.checked})).length>0?t.filter((function(e){return e.checked}))[0].prop:""},r.map((function(e,t){return a.createElement(h.Select.Option,{key:t,label:e.label,value:e.prop},e.label)})))};n.setState({selectMenuItem:r,column:i})}))},n.changeTopic=function(e){var t=n.state.selectMenuItem;t.forEach((function(t,r){var i=t.prop===e;t.checked=i,i&&n.refs.bar&&n.refs.bar.buildChart(r)})),n.setState({selectMenuItem:t})},n.getParams=function(){if(n.refs.filter&&n.refs.filter.getValue()&&n.refs.filter.getValue().dateFilter){var e=n.refs.filter.getValue();return e.dateFilter.dateGroupType=new Date(e.dateFilter.to).getTime()-new Date(e.dateFilter.from).getTime()<=6048e5?"HOUR":e.dateFilter.dateGroupType,e}return null},n.selectFilter=function(e){n.setState({tab:e})},n.onFilterChange=function(e){n.getBarList(),n.getLineList()},n.getShowColumns=function(e){n.setState({selectMenuItem:e})},n.state={json_bar:void 0,json_line:void 0,topics:[],selTopics:[],selectMenuItem:[],column:{},columns:[{label:"\u6392\u5e8f",width:50,render:function(e,t,n){return a.createElement("span",{style:{color:"#8c8c8c"}},n-0+1)}},{label:"\u4ef7\u683c",width:80,prop:"price"}],filterParams:"",tab:0,computed:"MIN",loading:!0,cardList:[{name:"\u4ef7\u683c\u7c7b\u578b",id:"priceType",list:[{name:"\u6302\u724c\u4ef7",id:"listPrice"},{name:"\u5230\u624b\u4ef7",id:"takePrice"}]},{name:"\u5c55\u793a\u65b9\u5f0f",id:"priceCompareType",list:[{name:"\u5b9e\u65f6\u4ef7\u683c",id:"REAL_TIME"},{name:"\u6700\u9ad8\u4ef7",id:"MAX"},{name:"\u6700\u4f4e\u4ef7",id:"MIN"}]},{name:"\u663e\u793a\u6570\u91cf",id:"topSize",list:[{name:"TOP10",id:"10"},{name:"TOP20",id:"20"},{name:"\u5168\u90e8",id:"2000"}]},{name:"\u987a\u5e8f",id:"sortType",list:[{name:"\u5347\u5e8f",id:"ASC"},{name:"\u964d\u5e8f",id:"DESC"}]}],cardValue1:[{id:"priceType",value:"listPrice"},{id:"priceCompareType",value:"REAL_TIME"},{id:"topSize",value:"10"},{id:"sortType",value:"ASC"}],cardValue2:[{id:"priceType",value:"listPrice"},{id:"priceCompareType",value:"MAX"},{id:"topSize",value:"10"},{id:"sortType",value:"ASC"}]},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.projectId=m.t.get(m.V.curProject).id,window.addEventListener("click",this.checkHide,!1),window.addEventListener("resize",this.onWindowResize)},n.componentWillUnmount=function(){window.removeEventListener("click",this.checkHide,!1),window.removeEventListener("resize",this.onWindowResize)},n.getLineList=function(){var e=this,t=this.getParams(),n=this.state.cardValue2;t.projectId=this.projectId,t.filterModel.project=t.filterModel.project||[this.projectId],n.forEach((function(e){return t[e.id]=e.value})),this.refs.line.refs.chart.loading(),this.refs.line.json=null,o.h.post("/price/compare/trade/line",t).then((function(t){e.setState({json_line:t.data.result.reverse()},(function(){return e.refs.line&&e.refs.line.resize()}))}))},n.render=function(){var e=this,t=this.state,n=t.column,i=t.columns,o=t.json_bar,l=t.json_line,p=t.selTopics,h=t.selectMenuItem,m=t.cardList,g=t.cardValue1,y=t.showCardList1,v=t.showCardList2,E=t.cardValue2;n.label&&(n.render=function(e){return a.createElement("p",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",paddingRight:"20px"},title:h.filter((function(e){return e.checked})).length?e[h.filter((function(e){return e.checked}))[0].prop]:""},h.filter((function(e){return e.checked})).length?e[h.filter((function(e){return e.checked}))[0].prop]:"")});var w={json:o,category:p},C={json:l,category:p,dateGroupType:this.getParams()?this.getParams().dateFilter.dateGroupType:null},b=void 0,j=0;return o&&o instanceof Array&&(j=38*o.length,b=o.slice(0).reverse().map((function(e){return e.connConfig.forEach((function(t){t&&(e[t.topicTypeId]=t.topicValue)})),e}))),a.createElement("div",{className:"price-chart-wrapper"},a.createElement(u.Z,{title:f.v[window.location.pathname],ref:"filter",filterCondition:{filter:["CONN_CONFIG"]},model:"PRICE_COMPARE",showList:["condition","time","save"],onChange:this.onFilterChange,onFilterReady:this.ready}),a.createElement("div",{className:"chart-wrapper",ref:function(t){return e.flexWrapper=t}},a.createElement("div",{style:{float:"right",paddingTop:"20px"}}),a.createElement("div",{className:"title"},a.createElement("p",null,"\u4ef7\u683c\u6bd4\u8f83"),a.createElement("div",{className:"more",onClick:this.stop},a.createElement("span",{onClick:function(t){return e.setState({showCardList1:!y})}},"..."),y&&a.createElement("ul",null,m.map((function(t,n){return a.createElement("li",{key:n},a.createElement("p",null,t.name),t.list.map((function(n,r){return a.createElement("span",{onClick:function(r){return e.handelCardSel(t.id,n.id,1)},key:r,className:g.filter((function(e){return e.id===t.id}))[0].value===n.id?"sel":""},n.name)})))}))))),a.createElement("div",{className:"bar-part",style:{minHeight:(j||570)+58+"px",gridTemplateRows:(j||570)+58+"px",gridTemplateColumns:b&&b.length>0?"calc(100% - 300px) 300px":"100% 0"}},a.createElement(s,(0,r.Z)({},w,{ref:"bar"})),b&&b.length?a.createElement(c.Z,{columns:i.concat(n),data:b}):null),a.createElement("div",{className:"title"},a.createElement("p",null,"\u4ef7\u683c\u8d8b\u52bf"),a.createElement("div",{className:"more",onClick:this.stop},a.createElement("span",{onClick:function(t){return e.setState({showCardList2:!v})}},"..."),v&&a.createElement("ul",null,m.filter((function(e){return"sortType"!==e.id})).map((function(t,n){return a.createElement("li",{key:n},a.createElement("p",null,t.name),t.list.map((function(n,r){return"REAL_TIME"===n.id||"2000"===n.id?null:a.createElement("span",{onClick:function(r){return e.handelCardSel(t.id,n.id,2)},key:r,className:E.filter((function(e){return e.id===t.id}))[0].value===n.id?"sel":""},n.name)})))}))))),a.createElement("div",{className:"line-part"},a.createElement(d,(0,r.Z)({ref:"line"},C)))))},t}(a.Component)}}]);