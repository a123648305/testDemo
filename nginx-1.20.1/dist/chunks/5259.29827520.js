"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5259],{65259:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});var a=n(87462),r=n(63366),c=n(67294),i=(n(98620),n(10149)),s=(n(15086),n(94055)),o=(n(1025),n(65400)),l=(n(75314),n(11187)),u=(n(73431),n(16373)),m=(n(48980),n(20838)),f=(n(89858),n(51024)),d=n(61409),p=n(3061),g=n(35239),E=(n(53294),n(56697)),v=(n(77785),n(59361)),h=n(15861),_=n(23279),y=n.n(_),k=n(87757),N=n.n(k),C=n(76570),b=n(79508),I=n(78924),w=n.n(I),L=n(62563),x=n(87219),T=n(5133),Z=["onClose","onConfirm","projectId","visible","customTag","allTags","customerId"];const S=function(e){var t=e.onClose,n=e.onConfirm,a=e.projectId,i=(e.visible,e.customTag),s=e.allTags,l=e.customerId,u=((0,r.Z)(e,Z),(0,c.useState)([])),m=u[0],f=u[1],d=(0,c.useState)([]),p=d[0],g=d[1],_=(0,c.useState)([]),k=_[0],I=_[1],S=(0,c.useState)(""),j=S[0],P=S[1],O=(0,c.useState)(!1),R=O[0],D=O[1],F=(0,c.useState)([]),q=F[0],K=F[1],Q=(0,c.useState)(!1),M=(Q[0],Q[1],(0,c.useRef)());(0,c.useEffect)((function(){var e=i.map((function(e){return{name:e,id:e,checked:!0}}));K(e),f(e),U(e)}),[]);var U=function(){var e=(0,h.Z)(N().mark((function e(t){var n,a,r,c,i;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,L.gA)();case 2:n=e.sent,a=n.data,r=a.code,c=a.result,2e4===r&&(i=c.map((function(e){var n={id:e,name:e,checked:!1};return t.find((function(t){return t.id===e}))&&(n.checked=!0),n})),I(i.slice(0,10)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=(0,c.useCallback)(y()(function(){var e=(0,h.Z)(N().mark((function e(t){var n,a,r;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",g([]));case 2:n=s.filter((function(e){return e.name.includes(t)})),a=n.find((function(e){return e.name===t})),r=a?n:[{name:"\u65b0\u589e\u201c"+t+"\u201d\u6807\u7b7e",checked:!1,orginName:t}].concat(n),g(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),300),[]),J=function(){var e=(0,h.Z)(N().mark((function e(t,n){var a,r,c,i,s,o,l,u;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,r=t.orginName,c=t.id,i=t.checked,s={name:a,id:c,checked:i,orginName:r},!i){e.next=8;break}return o=(0,x.ZP)(k,(function(e){var t=n||e.findIndex((function(e){return e.name===a}));~t&&(e[t].checked=!1)})),I(o),l=(0,x.ZP)(m,(function(e){var t=e.findIndex((function(e){return e.name===a}));e.splice(t,1)})),f(l),e.abrupt("return");case 8:s.name=c?a:r,s.checked=!0,P(""),g([]),!m.find((function(e){return e.name===s.name}))&&f([].concat(m,[s])),u=(0,x.ZP)(k,(function(e){var t=e.findIndex((function(e){return e.name===s.name}));-1!==t&&e.splice(t,1),e.unshift(s)})),I(u);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=(0,h.Z)(N().mark((function e(){var t,r,c,i,s,o;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(D(!0),t=m.map((function(e){return e.name})),JSON.stringify(m)!==JSON.stringify(q)){e.next=4;break}return e.abrupt("return",n());case 4:return r={projectId:a,id:l,tagName:t},e.prev=6,e.next=9,(0,L.Lp)(r);case 9:c=e.sent,i=c.data,s=i.code,o=i.msg,D(!1),2e4===s?(n({id:l}),T.Z.success(o)):T.Z.error(o),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(6),D(!1),T.Z.error(e.t0);case 21:case"end":return e.stop()}}),e,null,[[6,17]])})));return function(){return e.apply(this,arguments)}}(),V=c.createElement(c.Fragment,null,c.createElement(o.default,{key:"back",onClick:t},"\u53d6\u6d88"),c.createElement(o.default,{key:"submit",type:"primary",onClick:B,loading:R},"\u786e\u5b9a"));return c.createElement(E.Z,{title:"\u8bbe\u7f6e\u6807\u7b7e",visible:!0,onCancel:t,onOk:n,width:"560px",wrapClassName:"tag_customer_dialog",footer:V},c.createElement("div",{className:"tag_box",ref:M},c.createElement("div",{className:"tag_box_containter"},m.map((function(e,t){return c.createElement(v.default,{key:t,closable:!0,onClose:function(){return function(e,t){var n=(0,x.ZP)(m,(function(e){e.splice(t,1)}));f(n);var a=(0,x.ZP)(k,(function(t){var n=t.findIndex((function(t){return t.name===e.name}));~n&&(t[n].checked=!1)}));I(a)}(e,t)},visible:!0},e.name)})),c.createElement("input",{placeholder:"\u65b0\u589e\u6216\u641c\u7d22\u6807\u7b7e",onChange:function(e){var t=e.target.value.replace(/\s/g,"").slice(0,30);P(t),A(t)},onFocus:function(){return M.current.classList.add("tag_box_fcous")},onBlur:function(){return M.current.classList.remove("tag_box_fcous")},value:j,maxLength:30,onKeyDown:function(e){return function(e,t){var n=e.keyCode;if(13===n&&p.length>0&&J(p[0]),8===n&&!t){var a=m.slice(-1)[0];m.length>0&&J(a)}}(e,j)}})),c.createElement(C.Z,{style:{color:"#E5E5E5FF",marginLeft:"auto"}})),p&&p.length?c.createElement("ul",{className:"tag_ul"},p.map((function(e,t){return c.createElement("li",{key:t,className:"tag_ul_li",onClick:function(){return J(e)}},e.name)}))):c.createElement(c.Fragment,null,k&&k.length>0&&c.createElement("div",{className:"recently_box"},c.createElement("p",{className:"recently_title"},"\u6700\u8fd1\u4f7f\u7528"),c.createElement("ul",{className:"tag_ul"},k.map((function(e,t){return c.createElement("li",{key:t,className:"tag_ul_li "+(e.checked&&"tag_ul_li_active"),style:{backgroundColor:e.checked?w()["primary-color"]:"white"},onClick:function(){return J(e,t)}},e.checked&&c.createElement(b.Z,{className:"tag_checked"}),e.name)}))))))};n(54038);var j=n(36671),P=(n(31822),n(41764)),O=n(30381),R=n.n(O);const D=function(e){var t=e.dynamicList,n=e.jumpMessagePage;return null!=t&&t.length?c.createElement("ul",{className:"customer_dynamic_timeLine"},t.map((function(e,t){return c.createElement("li",{key:t},c.createElement("p",{className:"customer_dynamic_timeLine_time"},R()(e.ctime).format("YYYY/MM/DD HH:mm")),c.createElement("div",{className:"timeLine_info"},c.createElement("div",{className:"timeLine_info_text",onClick:function(){return n(e)}},c.createElement("i",{className:"iconfont "+("TICKET"===e.dataLevel?"icon-gongdan":"icon-wenjuan")}),c.createElement("span",null,"TICKET"===e.dataLevel?e.title:e.questionnaireName)),e.npsScore&&c.createElement("div",{className:"timeLine_info_remake"},"NPS\u5206\u6570\uff1a",e.npsScore,"\u5206"),e.satisfactionScore&&c.createElement("div",{className:"timeLine_info_remake"},"\u8bc4\u5206",c.createElement(P.Z,{disabled:!0,defaultValue:e.satisfactionScore,className:"timeLine_info_remake_star"}))))}))):c.createElement(j.default,{className:"customer_no_dynamic"})};var F=["customerInfo","loading","baseLabelWidth","listLoading","updateCustomerRemake","fetchQuestList","updateCustomerTags","allTagsList","allDynamicList"],q=f.default.TextArea,K=m.default.TabPane,Q=u.Z.Sider,M=u.Z.Content,U=n(88958);const A=function(e){var t,n=e.customerInfo,f=e.loading,E=e.baseLabelWidth,v=e.listLoading,h=e.updateCustomerRemake,_=e.fetchQuestList,y=e.updateCustomerTags,k=e.allTagsList,N=e.allDynamicList,C=(0,r.Z)(e,F),b=(0,c.useState)(!1),I=b[0],w=b[1],L=(0,c.useState)(!1),x=L[0],T=L[1],Z=(0,c.useState)(!1),j=Z[0],P=Z[1],O=(0,c.useRef)(),R=function(e){var t=e.projectId,n=e.contactId,r=e.projectName,c=e.questionnaireId,i=e.dispatchId,s=e.dispatchDetailId,o=e.dataLevel,u=e.id,m=e.wsId;if(g.t.get(g.V.curProject).id===t){var f,d={filterModel:{project:[t]},projectId:t,headerFilterParamsNew:[],questionnaireId:c,filterTip:"\u5ba2\u6237\u6863\u6848/\u5ba2\u6237\u6863\u6848\u8be6\u60c5"};"TICKET"===o?(f=(0,a.Z)({},d,{id:u}),window.open("/inbox/ticket?"+encodeURIComponent(JSON.stringify(f)))):(f="QUESTIONNAIRE_OTHER"===o?(0,a.Z)({},d,{wsid:m}):(0,a.Z)({},d,{contactId:n,dispatchDetailId:s,dispatchId:i}),window.open("/inbox/questionnaire?"+encodeURIComponent(JSON.stringify(f))))}else l.default.warning("\u8be5\u95ee\u5377\u6765\u81ea\u4e8e("+r+")\u9879\u76ee\uff0c\u8bf7\u5207\u6362\u9879\u76ee\u67e5\u770b\u8be6\u60c5")},A=g.t.get(g.V.curProject);return c.createElement(u.Z,{className:"customer_detail"},c.createElement(Q,{className:"customer_detail_left",width:"600"},c.createElement("div",{className:"customer_header"},!(null!=(t=C.location.query)&&t.customerId)&&c.createElement("span",{className:"reback_btn",onClick:function(){return d.mW.push({pathname:"/customerFile/customersList"})}},c.createElement("i",{className:"iconfont icon-fanhui2"})),c.createElement("div",{className:"customer_headImg"},c.createElement("img",{alt:"\u5ba2\u6237\u5934\u50cf",src:A.pictureUrl?""+U:U})),c.createElement(o.default,{icon:c.createElement("i",{className:"iconfont icon-wenjuan"}),onClick:function(){return T(!0)}},"\u53d1\u9001\u95ee\u5377")),c.createElement("div",{className:"customer_container"},c.createElement("h2",null,"\u57fa\u7840\u4fe1\u606f"),c.createElement(i.default,{loading:f,active:!0},c.createElement("ul",{className:"customer_info"},c.createElement("li",null,c.createElement("span",{className:"customer_info_label",style:{width:E}},"\u59d3\u540d"),c.createElement("span",{className:"customer_info_text"},n.name)),c.createElement("li",null,c.createElement("span",{className:"customer_info_label",style:{width:E}},"\u624b\u673a"),c.createElement("span",{className:"customer_info_text"},n.phoneNumber)),c.createElement("li",null,c.createElement("span",{className:"customer_info_label",style:{width:E}},"\u90ae\u7bb1"),c.createElement("span",{className:"customer_info_text"},n.email)),c.createElement("li",{className:n.newTags&&0===n.newTags.length?"no_tags":""},c.createElement("span",{className:"customer_info_label",style:{width:E,paddingBottom:n.newTags&&n.newTags.length?5:0}},"\u6807\u7b7e"),c.createElement("span",{className:"customer_info_text"},n.newTags&&n.newTags.map((function(e){return e.length>10?c.createElement(s.default,{placement:"top",overlayClassName:"popup-tags",title:e},c.createElement("span",{className:"customer_info_text_tag",key:e},e)):c.createElement("span",{className:"customer_info_text_tag",key:e},e)})),c.createElement("span",{className:"customer_info_text_tag customer_info_add_tag",key:"addTag",onClick:function(){return P(!0)}},c.createElement("i",{className:"icon-cem_add-to"}),"\u6807\u7b7e"))),c.createElement("li",null,c.createElement("span",{className:"customer_info_label",style:{width:E}},"\u5907\u6ce8"),c.createElement("span",{className:"customer_info_text"},I?c.createElement(q,{defaultValue:n.remark,onBlur:function(e){var t=e.target.value;h({remark:t}),w(!1)},maxLength:100,ref:O,autoSize:!0}):c.createElement(c.Fragment,null,n.remark,c.createElement("i",{className:"iconfont icon-bianji",onClick:function(){w(!I),setTimeout((function(){O&&O.current.focus()}),0)}})))),n.mappingInfoList&&n.mappingInfoList.map((function(e){return c.createElement("li",{key:e.id},c.createElement("span",{className:"customer_info_label",style:{width:E}},e.schemaName),c.createElement("span",{className:"customer_info_text"},e.schemaValue))})))))),c.createElement(M,{className:"customer_detail_container"},c.createElement("section",{className:"customer_dynamic"},c.createElement(i.default,{loading:v,active:!0,className:"skeleton_dynamic"},c.createElement(m.default,{defaultActiveKey:"ALL",onChange:function(){},tabBarStyle:{paddingLeft:24,borderBottom:"1px solid #E5E5E5"}},c.createElement(K,{tab:"\u5168\u90e8",key:"ALL"},c.createElement(D,{dynamicList:N,jumpMessagePage:R})),c.createElement(K,{tab:"\u95ee\u5377",key:"QUESTION"},c.createElement(D,{dynamicList:N.filter((function(e){return"TICKET"!==e.dataLevel})),jumpMessagePage:R})),c.createElement(K,{tab:"\u5de5\u5355",key:"WORK"},c.createElement(D,{dynamicList:N.filter((function(e){return"TICKET"===e.dataLevel})),jumpMessagePage:R}))))),x&&c.createElement(p.Z,{visible:!0,onOK:function(e){var t={selectedContact:{list:[(0,a.Z)({},n,{checked:!0})],validPhoneNum:n.phoneNumber?1:0,validEmailNum:n.email?1:0,currpageList:[(0,a.Z)({},n,{checked:!0})],pageIndex:1,pageSize:10},step:3};g.t.set("customerPage",t);var r={questionnaireId:e.id,title:e.title,questionnaireType:e.questionnaireType,pageOrigin:"customer"};window.open("/research/manage/distribute/edit?"+encodeURIComponent(JSON.stringify(r))),T(!1)},onCancel:function(){return T(!1)},fetchQueList:_,options:[]}),j&&c.createElement(S,{onClose:function(){return P(!1)},onConfirm:function(e){P(!1),e&&y(e)},projectId:"projectId",customTag:n.newTags||[],customerId:n.id,allTags:k,visible:!0})))};var J=n(55609),B=n(64396),V=["loading"],W=B.Z.customersFile.customerDetail,Y=B.Z.customersFile.allCustomers;const H=(0,J.connect)((function(e){var t=e.loading,n=(0,r.Z)(e,V);return(0,a.Z)({loading:t.effects[W+"/getCoustomerInfo"]||!1,listLoading:t.effects[W+"/getCustomerDynamic"]||!1},n[W])}),(function(e){return{getCoustomerInfo:function(t){return e({type:W+"/getCoustomerInfo",payload:t})},updateCustomerRemake:function(t){return e({type:W+"/updateCustomerRemake",payload:t})},getCustomerDynamic:function(t){return e({type:W+"/getCustomerDynamic",payload:t})},fetchQuestList:function(t){return e({type:Y+"/fetchQuestList",payload:t})},updateCustomerTags:function(t){return e({type:W+"/updateCustomerTags",payload:t})},fetchTagList:function(t){return e({type:W+"/fetchTagList",payload:t})}}}))((function(e){return(0,c.useEffect)((function(){var t,n,a,r=e.getCoustomerInfo,c=e.location,i=e.getCustomerDynamic,s=e.fetchTagList,o="";if(c.state||null!=(t=c.query)&&t.customerId)o=(null==(n=c.state)?void 0:n.customerId)||(null==(a=c.query)?void 0:a.customerId);else if(c.search){o=JSON.parse(decodeURIComponent(c.search.slice(1))).customerId}r({id:o}),i({id:o}),s()}),[]),c.createElement(A,e)}))},3061:(e,t,n)=>{n.d(t,{Z:()=>m});n(53294);var a=n(56697),r=n(15861),c=(n(29809),n(97538)),i=(n(35797),n(64749)),s=n(87757),o=n.n(s),l=n(67294),u=i.default.Option;const m=function(e){var t=e.visible,n=e.fetchQueList,s=e.onOK,m=e.onCancel,f=c.Z.useForm()[0],d=(0,l.useState)([]),p=d[0],g=d[1],E=function(){var e=(0,r.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:(t=e.sent)&&g(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){E()}),[]);var v=function(){var e=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.validateFields();case 3:t=e.sent,n=p.find((function(e){return e.id===t.id})),s(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return l.createElement(a.Z,{className:"yt-customer-sendQue-dialog",title:"\u53d1\u9001\u95ee\u5377",visible:t,width:480,onOk:v,onCancel:m},l.createElement(c.Z,{labelCol:{span:3,offset:2},wrapperCol:{offset:1},form:f},l.createElement(c.Z.Item,{label:"\u95ee\u5377\u540d\u79f0",name:"id",colon:!1,rules:[{validator:function(){var e=(0,r.Z)(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("\u8bf7\u9009\u62e9\u95ee\u5377")));case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]},l.createElement(i.default,{style:{width:320},placeholder:"\u8bf7\u9009\u62e9"},p&&p.map((function(e,t){return l.createElement(u,{value:e.id,key:t},e.title)}))))))}},88958:(e,t,n)=>{e.exports=n.p+"img/aa245f8de9f2aa549c26.png"}}]);