"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2228],{53074:(e,t,n)=>{n.d(t,{Z:()=>d});n(58344);var a=n(60171),r=(n(43378),n(62443)),l=n(67294),o=n(30755),c=n(51444),i=function(e,t){e=e.replace(/<[^>]+>/g,"");var n=new RegExp(t,"ig");return e=e.replace(n,'<span style="color: #7262fd"} id="'+t+'">'+t+"</span>")},s=function e(t){if(t&&!t.classList.contains("ant-tree-list"))return t.classList.contains("ant-tree-treenode")?t:e(t.parentNode)},u=n(40312);const d=function(e){var t=e.title,n=void 0===t?"\u6743\u9650\u914d\u7f6e":t,d=e.titleOverlay,f=void 0===d?"":d,m=e.authCount,p=e.disabled,h=void 0!==p&&p,v=e.allAuth,E=e.selectedAuth,y=e.showSearch,g=void 0===y||y,N=e.onCheck,C=e.isDefaultExpandAll,k=void 0!==C&&C,b=(0,l.useState)(""),w=b[0],S=b[1],O=(0,l.useState)([]),Z=O[0],D=O[1],L=(0,l.useState)([]),T=L[0],_=L[1];(0,l.useEffect)((function(){if(v){var e=(0,u.findLeafNode)(v).nonLeafNode;D(e),_(k?[]:e)}}),[v]);var I=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(w){var e=document.getElementById(w),t=s(e);t&&I&&I.current&&(I.current.scrollTop=t.offsetTop+16)}}),[w]),l.createElement("div",{className:"authority_tree_wrapper"},l.createElement("div",{className:"header"},l.createElement("div",null,n,f&&l.createElement(r.default,{content:l.createElement("div",{style:{maxWidth:330}},f)},l.createElement("i",{className:"icon-cem_file1",style:{marginLeft:6,color:"#979797"}})),void 0!==m&&l.createElement("span",{className:"tips"},"\u5df2\u9009\u4e2d",m,"\u9879\u6743\u9650")),l.createElement("div",null,g&&l.createElement(o.Z,{placeholder:"\u8bf7\u8f93\u5165\u6743\u9650",onSearch:function(e){_(Z),setTimeout((function(){return S(e)}),0)}}))),l.createElement("div",{className:"content",ref:I},l.createElement(a.Z,{disabled:h,treeData:v,checkedKeys:E,checkable:!0,blockNode:!0,expandedKeys:T,onCheck:N,selectable:!1,onExpand:function(e){_(e)},switcherIcon:l.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:14}}),titleRender:function(e){var t,n=e.title,a=e.remark,r=e.children;return l.createElement(l.Fragment,null,l.createElement("span",{className:(t=r,t&&t instanceof Array&&t.length>0?"nonLeafnode":"leafnode"),dangerouslySetInnerHTML:{__html:w?i(n,w):n}}),a&&l.createElement(c.Z,{overlay:a}))}})))}},51444:(e,t,n)=>{n.d(t,{Z:()=>l});n(15086);var a=n(94055),r=n(67294);const l=function(e){var t=e.overlay;return r.createElement(a.default,{title:t},r.createElement("i",{className:"icon-cem_file1",style:{marginLeft:4,cursor:"pointer",color:"#8C8C8C"}}))}},30755:(e,t,n)=>{n.d(t,{Z:()=>i});n(89858);var a=n(51024),r=n(87462),l=n(63366),o=n(67294),c=["onSearch"];const i=function(e){var t=e.onSearch,n=(0,l.Z)(e,c);return o.createElement(a.default.Search,(0,r.Z)({className:"yt-input-search-wrapper",placeholder:"\u8bf7\u8f93\u5165",suffix:o.createElement("i",{className:"icon-cem_small-search"}),style:{width:200},allowClear:!0,onSearch:t,onBlur:function(e){return t(e.target.value)}},n))}},11186:(e,t,n)=>{n.d(t,{Z:()=>I});n(54277);var a=n(74048),r=(n(1025),n(65400)),l=n(67294),o=n(96889);const c=function(e){var t=e.dataSource,n=e.loading,r=e.tool.constants,c=e.onOpenRoleModal,i=e.onOpenRoleDrawer,s=e.onOpenDelModal,u=(0,l.useState)(0),d=u[0],f=u[1],m=function(){var e=document.querySelector(".business_setting_role_content");f((null==e?void 0:e.offsetHeight)-126)};(0,l.useEffect)((function(){return window.addEventListener("resize",m),m(),function(){return window.removeEventListener("resize",m)}}),[]);var p=[{title:"",width:16},{title:"\u89d2\u8272",dataIndex:"roleName",width:250,render:function(e,t){return l.createElement("span",{className:"operation",onClick:function(){return i(t)}},e)}},{title:"\u63cf\u8ff0",dataIndex:"remark",width:"calc((100% - 16px - 180px - 250px))"},{title:"\u64cd\u4f5c",dataIndex:"m",width:180,render:function(e,t){if(t.roleCode!==r.RoleCode.ROLE_SUPER)return l.createElement(a.default,{className:"operation"},t[r.FilterKey]&&l.createElement("span",{onClick:function(){return c(r.OptType.EDIT,t)}},"\u7f16\u8f91"),l.createElement("span",{onClick:function(){return c(r.OptType.COPY,t)}},"\u590d\u5236"),t[r.FilterKey]&&l.createElement("span",{onClick:function(){return s(t)}},"\u5220\u9664"))}}];return l.createElement(o.ZP,{dataSource:t,columns:p,pagination:!1,rowKey:"id",loading:n,search:!1,options:!1,scroll:{y:d-4}})};n(53294);var i=n(56697),s=(n(29809),n(97538)),u=(n(89858),n(51024)),d=(n(15086),n(94055)),f=n(87462),m=(n(75314),n(11187)),p=n(53074),h=(n(9405),n(89552)),v=n(94184),E=n.n(v);const y=function(e){var t=e.className,n=e.style;return l.createElement("div",{className:E()("yt_loading_component_wrapper",t),style:n},function(e){var t=e.loading,n=void 0!==t&&t;return l.createElement(h.default,{className:"loading_content",spinning:n},e.children)}(e))};var g={labelCol:{span:2},wrapperCol:{span:22}};const N=function(e){var t=e.visible,n=e.titleOverlay,a=e.tool,r=a.api,o=a.utils,c=a.constants,h=e.type,v=e.roleInfo,E=e.onClose,N=e.allAuth,C=e.getList,k=e.listNameData,b=(0,l.useRef)(),w=(0,l.useState)([]),S=w[0],O=w[1],Z=(0,l.useState)([]),D=Z[0],L=Z[1],T=(0,l.useState)(!1),_=T[0],I=T[1];(0,l.useEffect)((function(){t&&v&&(I(!0),r.fetchRoleDetail({roleId:null==v?void 0:v.id}).then((function(e){var t,n=e.data.result,a=n.roleName,r=n.remark,l=n.permissionResponses,i=o.findLeafNode(l),s=i.leafNode,u=i.nonLeafNode;if(O(s),L(u),h===c.OptType.EDIT)null==(t=b.current)||t.setFieldsValue({roleName:a,remark:r});else if(h===c.OptType.COPY){var d;null==(d=b.current)||d.setFieldsValue({remark:r})}})).catch((function(e){var t=e.data;return m.default.error(t.msg)})).finally((function(){I(!1)})))}),[t]);var R=function(){var e;null==(e=b.current)||e.resetFields(),E(),O([]),L([])};return l.createElement(i.Z,{visible:t,title:l.createElement("span",null,h,"\u89d2\u8272",l.createElement(d.default,{title:h+"\u89d2\u8272\u65f6\uff0c"+n},l.createElement("i",{className:"icon-cem_file1",style:{marginLeft:4,cursor:"pointer"}}))),width:720,onCancel:R,onOk:function(){b&&b.current&&b.current.validateFields().then((function(){var e,t=null==(e=b.current)?void 0:e.getFieldsValue(),n=(0,f.Z)({},t,{permissionIds:[].concat(S,D)});h===c.OptType.ADD||h===c.OptType.COPY?r.addRole(n).then((function(){m.default.success("\u6dfb\u52a0\u6210\u529f"),R(),C()})).catch((function(){return m.default.error("\u6dfb\u52a0\u5931\u8d25")})):h===c.OptType.EDIT&&(n.id=v.id,r.updateRole(n).then((function(){m.default.success("\u7f16\u8f91\u6210\u529f"),R(),C()})).catch((function(){return m.default.error("\u7f16\u8f91\u5931\u8d25")})))}))},wrapClassName:"role-modal-wrapper role-add-modal-wrapper",destroyOnClose:!0},l.createElement(y,{loading:_},l.createElement(s.Z,{initialValues:Object.assign({},{roleName:"",remark:""}),ref:b,colon:!1},l.createElement(s.Z.Item,(0,f.Z)({label:"\u540d\u79f0",name:"roleName",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"},{validator:function(e,t,n){k.includes(t)?n("\u89d2\u8272\u540d\u79f0\u91cd\u590d"):t.length>20?n("\u89d2\u8272\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u5b57"):n()}}]},g),l.createElement(u.default,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0\uff08\u4e0d\u8d85\u8fc720\u4e2a\u5b57\uff09"})),l.createElement(s.Z.Item,(0,f.Z)({label:"\u63cf\u8ff0",name:"remark",rules:[{validator:function(e,t,n){t.length>100?n("\u89d2\u8272\u63cf\u8ff0\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57"):n()}}]},g),l.createElement(u.default.TextArea,{autoComplete:"off",autoSize:{minRows:2,maxRows:3},placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u63cf\u8ff0\uff08\u4e0d\u8d85\u8fc7100\u4e2a\u5b57\uff09"})),l.createElement(s.Z.Item,{hasFeedback:!0},l.createElement(p.Z,{allAuth:N,selectedAuth:S,onCheck:function(e,t){O(e),L(t.halfCheckedKeys)},authCount:S.length+D.length,isDefaultExpandAll:c.isDefaultExpandAll})))))};n(16049);var C=n(1825),k=(n(58344),n(60171)),b=n(51444);const w=function(e){var t,n=e.visible,a=e.roleInfo,r=e.tool,o=r.api,c=r.utils,i=e.onClose,s=e.allAuth,u=(0,l.useState)([]),d=u[0],f=u[1],m=(0,l.useState)([]),p=m[0],h=m[1],v=(0,l.useState)(!1),E=v[0],g=v[1];return(0,l.useEffect)((function(){n&&(g(!0),o.fetchRoleDetail({roleId:a.id}).then((function(e){var t=e.data;if(2e4===t.code){var n=t.result.permissionResponses,a=c.findLeafNode(n),r=a.leafNode,l=a.nonLeafNode;f(r),h(l)}})).finally((function(){g(!1)})))}),[a]),l.createElement(C.Z,{title:null!=(t=null==a?void 0:a.roleName)?t:"\u89d2\u8272\u540d\u79f0",placement:"right",onClose:i,visible:n,className:"role-drawer-wrapper",width:480,mask:!1},l.createElement(y,{loading:E},l.createElement("div",{className:"header"},l.createElement("b",null,"\u6743\u9650\u914d\u7f6e"),l.createElement("span",null,"\u5df2\u9009\u4e2d",d.length+p.length,"\u9879\u6743\u9650")),l.createElement(k.Z,{treeData:s,checkedKeys:d,switcherIcon:l.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:14}}),checkable:!0,disabled:!0,defaultExpandAll:!0,titleRender:function(e){var t=e.title,n=e.remark;return l.createElement(l.Fragment,null,t,n&&l.createElement(b.Z,{overlay:n}))}})))};var S=n(68855),O=n(61193),Z=n(15861),D=n(87757),L=n.n(D);const T=function(e){var t=e.visible,n=e.roleInfo,a=e.tool,o=a.api,c=a.constants,s=a.utils,u=e.onClose,d=e.getList,f=function(e,t){var n=(0,l.useState)(!0),a=n[0],r=n[1],o=(0,l.useState)(null),c=o[0],i=o[1],s=(0,l.useState)(null),u=s[0],d=s[1],f=function(){var n=(0,Z.Z)(L().mark((function n(){var a,l,o,c;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r(!0),n.prev=1,n.next=4,e(t);case 4:a=n.sent,l=a.data,o=l.code,c=l.result,2e4===o&&c?i(c):d(new Error(c)),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(1),d(n.t0);case 14:r(!1);case 15:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(){return n.apply(this,arguments)}}();return(0,l.useEffect)((function(){f()}),[]),{loading:a,result:c,error:u}}(o.fetchRelation,{roleId:n.id}),p=f.result,h=f.loading,v=function(){o.delRole({id:n.id}).then((function(e){var t=e.data;2e4===t.code?(m.default.success("\u5220\u9664\u6210\u529f"),d(),u()):m.default.error(t.msg)}))};return l.createElement(i.Z,{visible:t,title:l.createElement("div",{style:{display:"flex",alignItems:"center"}},l.createElement(S.Z,{style:{color:"#FF7955",fontSize:22,marginRight:16}}),"\u5220\u9664\u89d2\u8272"),closable:!1,onCancel:u,wrapClassName:"role-modal-wrapper",footer:p?Boolean(p&&p.deptData.length+p.userData.length)?[l.createElement(r.default,{key:"cancel",type:"primary",onClick:u},"\u77e5\u9053\u4e86")]:[l.createElement(r.default,{key:"back",onClick:u},"\u53d6\u6d88"),l.createElement(r.default,{key:"submit",type:"primary",loading:h,onClick:v},"\u786e\u5b9a")]:l.createElement("span",null),destroyOnClose:!0},l.createElement(y,{loading:h},function(){if(p){var e=p.deptData.length+p.userData.length;return e?l.createElement(l.Fragment,null,l.createElement("div",null,"\u201c",n.roleName,"\u201d\u89d2\u8272\u5173\u8054\u4e86",e,"\u4e2a\u6210\u5458/\u90e8\u95e8\uff0c\u8bf7\u5148\u53d8\u66f4\u4ed6\u4eec\u7684\u89d2\u8272\u3002"),l.createElement("div",{className:"relation-user"},l.createElement("div",null,"\u67e5\u770b\u5173\u8054\u6210\u5458/\u90e8\u95e8",O.Z.hasAuthority(c.authorityCode.skipToList)&&l.createElement("span",{onClick:function(){return s.handleSkip(n)},className:"skip"},"\u67e5\u770b")),l.createElement("div",null,[].concat(p.userData,p.deptData).map((function(e){return e.name})).join("\u3001")))):l.createElement("div",{style:{marginLeft:e?0:36}},"\u662f\u5426\u786e\u8ba4\u5220\u9664\u89d2\u8272\u201c",n.roleName,"\u201d\uff1f")}return""}()))};var _=n(30755);const I=function(e){var t=e.tool,n=t.api,o=t.utils,i=t.constants,s=(0,l.useState)([]),u=s[0],d=s[1],f=(0,l.useState)(!1),m=f[0],p=f[1],h=(0,l.useState)(),v=h[0],E=h[1],y=(0,l.useState)([]),g=y[0],C=y[1],k=(0,l.useState)([]),b=k[0],S=k[1],O=(0,l.useState)(),Z=O[0],D=O[1],L=(0,l.useState)(!1),I=L[0],R=L[1],x=(0,l.useState)(),A=x[0],F=x[1],K=(0,l.useState)(!1),z=K[0],M=K[1],P=(0,l.useState)(!1),B=P[0],j=P[1],V=function(){p(!0),n.fetchList().then((function(e){var t=e.data;if(2e4===t.code&&t.result){var n=t.result.filter((function(e){return!e[i.FilterKey]})),a=t.result.filter((function(e){return e[i.FilterKey]})),r=Object.values(i.RoleCode);n.sort((function(e,t){return r.indexOf(e.roleCode)-r.indexOf(t.roleCode)})),d([].concat(n,a))}})).finally((function(){p(!1)}))};(0,l.useEffect)((function(){n.fetchAllAuth().then((function(e){var t=e.data;if(2e4===t.code&&t.result){var n=o.transformTreeData(t.result),a=o.filterTreeData(n,i.filterCodeOptions);C(n),S(a)}return[]})),V()}),[]);var W=function(e,t){R(!0),F(e),t&&D(t)};return l.createElement("div",{className:"business_setting_role_content"},l.createElement("div",{className:"content_header"},l.createElement(_.Z,{onSearch:function(e){return E(e)},placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272"}),l.createElement(a.default,null,l.createElement(r.default,{type:"primary",onClick:function(){return W(i.OptType.ADD)}},"\u6dfb\u52a0\u89d2\u8272"))),l.createElement("div",null,l.createElement(c,{dataSource:v?u.filter((function(e){return e.roleName.includes(v)})):u,tool:t,loading:m,onOpenRoleModal:W,onOpenRoleDrawer:function(e){M(!0),D(e)},onOpenDelModal:function(e){j(!0),D(e)}})),l.createElement(N,{visible:I,titleOverlay:i.titleOverlay,tool:t,type:A,allAuth:b,roleInfo:Z,onClose:function(){R(!1),D(void 0)},getList:V,listNameData:u.filter((function(e){return!Z||e.roleName!==(null==Z?void 0:Z.roleName)})).map((function(e){return e.roleName}))}),B&&l.createElement(T,{visible:B,roleInfo:Z,tool:t,onClose:function(){j(!1),D(void 0)},getList:V}),l.createElement(w,{visible:z,tool:t,allAuth:g,roleInfo:Z,onClose:function(){M(!1),D(void 0)}}))}},40312:(e,t,n)=>{n.r(t),n.d(t,{transformTreeData:()=>o,findLeafNode:()=>c,filterTreeData:()=>i,handleSkip:()=>s});var a=n(87462),r=n(61409),l=function(e){return e&&e instanceof Array&&e.length>0};function o(e){return e.map((function(e,t){return{id:e.id,key:e.id,title:e.name,code:e.code,remark:e.remark,children:l(e.children)?o(e.children):[]}}))}function c(e){var t=[],n=[];return function e(a){return a.forEach((function(a){l(a.children)?(n.push(a.id),e(a.children)):t.push(a.id)}))}(e),{leafNode:t,nonLeafNode:n}}function i(e,t){return e.map((function(e,n){return(0,a.Z)({},e,{children:l(e.children)?i(e.children,t):[]})})).filter((function(e){return!t.includes(e.code)}))}var s=function(e){r.mW.push({pathname:"/account/businessManager",state:{roleIds:[e.id]}})}},55815:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),r=n(67294),l=n(45697),o=n.n(l),c=n(43036),i=n(61409),s=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this)._handleBreadcrumbClick=function(e){var n=t.props,a=n.title,r=n.beforeJump;e!==a.length-1&&(r?new Promise((function(e,t){return r(e,t)})).then((function(){i.mW.push({pathname:a[e].url,state:a[e].state})})):i.mW.push({pathname:a[e].url,state:a[e].state}))},t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,a=t.mainTitle,l=t.rightContent,o=t.className,i=t.overlay;return r.createElement("div",{className:"breadcumb-wrapper "+o},n instanceof Array?r.createElement("div",{className:"breadcrumb-left"},r.createElement("div",null,n.map((function(t,a){return r.createElement("span",{className:t.url?"":"not_clickable",key:a,onClick:function(){return t.url&&a!==n.length-1&&e._handleBreadcrumbClick(a)}},t.title,a!==n.length-1&&" / ")}))),r.createElement("span",null,a||n[n.length-1].title,i&&r.createElement(c.Z,{placement:"top",overlay:i},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):r.createElement("div",{className:"normal-title"},n,i&&r.createElement(c.Z,{placement:"top",overlay:i},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),l||"")},t}(r.Component);s.propTypes={className:o().string,title:o().oneOfType([o().string,o().arrayOf(o().shape({title:o().string,url:o().string,state:o().object}))]).isRequired,overlay:o().oneOfType([o().string,o().node]),mainTitle:o().oneOfType([o().string,o().node]),beforeJump:o().func,rightContent:o().node};const u=s}}]);