"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3062],{24091:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var a=n(63366),o=n(87462),i=n(94578),r=n(67294),c=n(55609),s=n(17051),l=n(99543),d=n(50196),u=n(41192),p=n(60496),h=n(50976),f=n(71339);const m=function(e){var t=e.option,n=e.data,a=e.loading,o=r.useState(1),i=o[0],c=o[1],s=r.useState(10),l=s[0],d=s[1],u=r.useState([]),p=u[0],h=u[1];r.useEffect((function(){h(n.slice(0,l)),c(1)}),[l,t.aspectType]),r.useEffect((function(){if(n&&n instanceof Array){var e=(i-1)*l,t=i*l;h(n.slice(e,t))}}),[n,i]);var m=function(e,t){var n=e-5-24-40-32;return[{label:"",width:16},{label:"\u6392\u5e8f",width:.3*n,render:function(e,t,n){return n+1}},{label:"\u5173\u6ce8\u70b9",width:.3*n,prop:"name"},{label:"\u6570\u91cf",width:.3*n,prop:"value"},{label:"\u5360\u6bd4",width:.1*n,prop:"precent",render:function(e){return(100*e.precent).toFixed(2)+"%"}},{label:"",width:16}]}(t.width);return r.createElement("div",{className:"yt-aspect-table-wrapper",style:t.style},r.createElement(f.Z,{data:p,loading:a,option:t,columns:m,total:n.length,pageIndex:i,pageSize:l,onPageSizeChange:d,onPageChange:c}))};var g=n(8201),v=n(53754),y=n(43036),C=n(22120),b=n(98191),w=n(39432),D=[{title:"\u5bfc\u51fa\u56fe\u7247",type:"image"},{title:"\u5bfc\u51fa\u6570\u636e",type:"data"}],T=[{title:"\u4e00\u7ea7\u5173\u6ce8\u70b9",value:"ASPECT1"},{title:"\u4e8c\u7ea7\u5173\u6ce8\u70b9",value:"ASPECT2"}],E={c0:["cem_histogram","cem_histogram-col","\u67f1\u72b6\u56fe"],c1:["cem_area","cem_area-col","\u9762\u79ef\u56fe"],c2:["cem_form-new","cem_form-new-col","\u8868\u683c"]};const S=function(e){var t=e.title,n=e.data,a=e.onMoreClick,o=e.loading,i=e.aspectType,c=e.onFilterChange,s=e.contentWidth,l=e.onChartClick,d=e.defChartType,f=e.conPosition,S=e.onConPositionChange,x=r.useState(d),k=x[0],P=x[1],_=r.useState(void 0),O=_[0],F=_[1],A=r.useState([]),Z=A[0],N=A[1],W="c2"===k?D.slice(1):D;return r.useEffect((function(){if(O&&"c2"!==k)if(O.resize(),(0,g.P)(n)){var e="c0"===k?function(e,t){var n=e.chartData,a=e.title,o=e.dataType,i=Array.from({length:n.length}),r=n.source[0],c=.8*t/(70*r.length),s=(0,w.jD)(r.join(""),12)/(.6*t)>1;return{title:{text:a,textStyle:{fontSize:14}},color:["#1574B3","#A1C7E1"],dataset:i.map((function(e,t){return{dimensions:[n.dimensions[0],n.dimensions[t+1]],sourceHeader:!1,source:[n.source[0],n.source[t+1]]}})),grid:i.map((function(){return{show:!1,left:24,right:24,top:60,bottom:s?60:c<1?50:30,containLabel:!0}})),tooltip:{formatter:function(e){var t=e.marker,n=e.data;return[t+" "+n[0],"\u5173\u6ce8\u70b9\u6570\u91cf\uff1a"+n[1]].join("<br />")}},dataZoom:{show:c<1,type:"slider",xAxisIndex:i.map((function(e,t){return t})),start:0,end:(100*c).toFixed(0)-0,height:20,handleSize:"100%",showDelay:!1},xAxis:i.map((function(e,t){return{type:"category",triggerEvent:"aspect"===o,gridIndex:t,show:0===t,axisTick:{show:0===t,alignWithLabel:!0},axisLabel:{interval:0,rotate:s?45:0,margin:s?15:8,formatter:function(e){return e.length>6?e.substring(0,5)+"...":e}}}})),yAxis:i.map((function(e,t){return{type:"value",gridIndex:t,minInterval:1,show:0===t}})),series:i.map((function(e,t){return{type:"bar",zlevel:1-t,yAxisIndex:t,xAxisIndex:t,seriesLayoutBy:"row",datasetIndex:t,barMinHeight:20,barMaxWidth:0===t?24:40}}))}}(n,O.getWidth()):function(e,t){return{title:{text:t},tooltip:{formatter:function(e){var t=e.marker,n=e.data,a=n.value,o=n.name;return e.name?[t+" "+o,"\u5173\u6ce8\u70b9\u6570\u91cf\uff1a"+a].join("<br />"):""}},series:[{type:"treemap",roam:!1,zoomToNodeRatio:void 0,leafDepth:1,nodeClick:!1,left:24,right:24,top:60,bottom:30,levels:[{itemStyle:{borderWidth:0,gapWidth:2}}],breadcrumb:{show:!1},data:e}]}}(n.tableData,n.title);O.clear(),O.setOption(e)}else F(void 0)}),[n,O,k,i]),r.useEffect((function(){(0,g.P)(n)&&n.tableData&&N(n.tableData)}),[n,k]),r.createElement(g.Z,{data:n,className:f?"yt-bar-tree-table-chart-wrapper higher-z-index":"yt-bar-tree-table-chart-wrapper",renderTitle:r.createElement(b.Z,{title:"c2"!==k?t:"",moreOptions:W,data:n,onMoreClick:function(e){return function(e,t,n,a){var o=void 0;if("image"===t)o=e;else if("data"===t){var i=JSON.parse(JSON.stringify(n.chartData.source));["product"===n.dataType?"\u4ea7\u54c1":"\u5173\u6ce8\u70b9","\u4f1a\u8bdd\u6570\u91cf"].forEach((function(e,t){return i[t].splice(0,0,e)})),i.push(["\u5360\u6bd4"]),n.tableData&&n.tableData.forEach((function(e){i[2].push((100*e.precent).toFixed(2)+"%")})),o=[i]}a({type:t,obj:o,name:e.getOption().title[0].text})}(O,e,n,a)}},i&&r.createElement(p.Z,{onChange:c,objName:"aspectType",activeObj:i,options:T}),f&&r.createElement("div",{className:"con-position"},r.createElement(v.Z,{type:1,title:"\u4f1a\u8bdd\u4f4d\u7f6e",options:C.R,value:f,onChange:S}),r.createElement(y.Z,{placement:"top",overlay:"\u7531\u4e8e\u5ba2\u6237\u4ece\u67d0\u4e2a\u5546\u54c1\u94fe\u63a5\u8fdb\u5165\u963f\u91cc\u65fa\u65fa\u7b49\u54a8\u8be2\u804a\u5929\u7a97\u53e3\u540e\uff0c\u4e0d\u4e00\u5b9a\u662f\u54a8\u8be2\u8be5\u5546\u54c1\u3002\u4e3a\u4e86\u63d0\u9ad8\u4e1a\u52a1\u5206\u6790\u7684\u7075\u6d3b\u6027\uff0c\u8fd9\u91cc\u5c06\u201c\u5546\u54c1\u201d\u5728\u4f1a\u8bdd\u4e2d\u7684\u4f4d\u7f6e\u505a\u533a\u5206\uff0c\u4f9b\u7528\u6237\u5207\u6362",overlayClassName:"restricted-width-pop"},r.createElement("i",{className:"icon-cem_problem-new"}))),r.createElement(u.Z,{onChange:P,chartType:k,options:E}))},r.createElement(h.Z,{theme:"yunting_multi_color",option:{},style:{width:"100%",height:375,display:"c2"===k?"none":"block"},onEvents:{click:l},onChartReady:function(e){return F(e)}}),r.createElement(m,{option:{aspectType:i,width:s,style:{display:"c2"===k?"block":"none",paddingTop:40}},data:Z,loading:o}))};var x=n(67641);const k=function(e){var t=e.isInitial,n=e.conData,a=e.overviewLoading,o=e.trendData,i=e.trendLoading,c=e.trendTimeType,u=e.trendPlatformType,p=e.onTrendFilterChange,h=e.conPosition,f=e.onConPositionChange,m=e.productDisData,g=e.productLoading,v=e.focusDisData,y=e.focusLoading,C=e.focusAspectType,b=e.onFocusFilterChange,w=e.onMoreClick,D=e.contentWidth,T=e.onFilterChange,E=e.onProductChartClick,k=e.onAspectChartClick,P=e.headerDefValue;return r.createElement("div",{className:"yt-conversation-overview-wrapper"},r.createElement(x.Z,{onChange:T,type:"overview",title:"\u6570\u636e\u6982\u89c8",value:P}),r.createElement("div",{className:"co-content",id:"co-content"},r.createElement("div",null,r.createElement(s.Z,{type:1,titlePrefix:"",loading:a,isInitial:t,total:n.total,quantity:n.sum,leftSubTitle:"\u63d0\u53ca\u5546\u54c1",leftContent:n.mentionedGoods,rightSubTitle:"\u63d0\u53ca\u5173\u6ce8\u70b9",rightContent:n.mentionedAspect}),r.createElement(l.Z,{titlePrefix:"",data:n.sourceList,loading:a,isInitial:t}),r.createElement(d.Z,{pageType:"overview",data:o,loading:i,onMoreClick:w,timeType:c,platformType:u,onFilterChange:p})),r.createElement(S,{title:"\u5546\u54c1\u5206\u5e03",defChartType:"c0",data:m,loading:g,contentWidth:D,onMoreClick:w,onChartClick:E,conPosition:h,onConPositionChange:f}),r.createElement(S,{title:"\u5173\u6ce8\u70b9\u5206\u5e03",defChartType:"c1",data:v,loading:y,aspectType:C,onFilterChange:b,contentWidth:D,onMoreClick:w,onChartClick:k})))};var P=n(35239),_=n(94644),O=n(61409),F=n(64396),A=["loading"],Z=F.Z.conversation.overview,N=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleWindowResize=function(){n.setState({contentWidth:document.getElementById("co-content").offsetWidth})},n._handleOnFilterChange=function(e,t){P.t.set(P.V.conversationOverviewHeader,t),n.headerValue=t,n.props.fetchDatas({projectId:P.t.get(P.V.curProject).id,headerState:JSON.parse(JSON.stringify(t)),filter:(0,o.Z)({source:[],shopName:[],waiter:[],typeList:[],aspect1:[],aspect2:[],product:[]},JSON.parse(JSON.stringify(e)))})},n._handleOnTrendFilterChange=function(e){n.props.fetchConversationTrendData((0,o.Z)({},e))},n._handleOnFocusFilterChange=function(e){n.props.fetchFocusDistributionData((0,o.Z)({},e))},n._handleOnMoreClick=function(e){"image"===e.type?(0,_._v)(e.obj,e.name):"data"===e.type&&(0,_.aT)(e.obj,e.name)},n._handleOnProductChartClick=function(e){if("series"===e.componentType){var t=n.props.headerState,a=e.name,o=JSON.parse(JSON.stringify(t)),i=o.indexOf((function(e){return"product"===e.id}));-1!==i&&o.splice(i,1),o.push({id:"product",name:"\u5206\u6790\u5546\u54c1",serverKey:"product",type:"radio",values:a}),O.mW.push({pathname:"/conversation/commodityAnalyze",state:{defHeader:o,from:"overview"}})}},n._handleOnAspectChartClick=function(e){var t=n.props,a=t.focusAspectType,o=t.headerState,i=e.componentType,r=e.name,c=e.value,s=e.data,l=e.componentSubType,d="ASPECT1"===a;if("series"===i)if("bar"===l||"treemap"===l&&!d){var u=r,p=JSON.parse(JSON.stringify(o)),h=p.indexOf((function(e){return"product"===e.id}));-1!==h&&p.splice(h,1),p.push({id:"aspect",name:"\u5173\u6ce8\u70b9",serverKey:"aspect",type:"cascade",values:[{id:d?u:"",name:d?u:"",values:d?[]:[{id:u,name:u}]}]}),O.mW.push({pathname:"/conversation/concernAnalyze",state:{defHeader:p,from:"overview"}})}else"treemap"===l&&d&&n._handleAspectJump(d,s.name);else"xAxis"===i&&n._handleAspectJump(d,c)},n._handleAspectJump=function(e,t){(0,n.props.fetchFocusDistributionData)({aspectType:e?"ASPECT2":"ASPECT1",aspect1:e?[t]:[]})},n._handleConPositionChange=function(e){var t=n.props,a=t.save,o=t.fetchProductDistributionData;a({conPosition:e}),o()},n.state={contentWidth:0},n.event={onFilterChange:n._handleOnFilterChange,onTrendFilterChange:n._handleOnTrendFilterChange,onFocusFilterChange:n._handleOnFocusFilterChange,onMoreClick:n._handleOnMoreClick,onProductChartClick:n._handleOnProductChartClick,onAspectChartClick:n._handleOnAspectChartClick,onConPositionChange:n._handleConPositionChange},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return r.createElement(k,(0,o.Z)({},this.props,this.state,this.event))},t}(r.Component);const W=(0,c.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,A);return(0,o.Z)({},n[Z],{headerDefValue:n[Z].headerState,overviewLoading:t.effects[Z+"/fetchConversationData"]||!1,trendLoading:t.effects[Z+"/fetchConversationTrendData"]||!1,productLoading:t.effects[Z+"/fetchProductDistributionData"]||!1,focusLoading:t.effects[Z+"/fetchFocusDistributionData"]||!1})}),(function(e){return{save:function(t){return e({type:Z+"/save",payload:t})},fetchDatas:function(t){return e({type:Z+"/fetchDatas",payload:t})},fetchConversationTrendData:function(t){return e({type:Z+"/fetchConversationTrendData",payload:t})},fetchProductDistributionData:function(t){return e({type:Z+"/fetchProductDistributionData",payload:t})},fetchFocusDistributionData:function(t){return e({type:Z+"/fetchFocusDistributionData",payload:t})}}}))(N)}}]);