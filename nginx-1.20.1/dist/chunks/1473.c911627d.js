"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1473],{71473:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var r=a(94578),l=a(67294),n=a(92360),o=a(5133),i=a(49722),s=a(97189),c=a.n(s),u=function(e){function t(t){var a;return(a=e.call(this,t)||this).handleSort=function(e){var t,r,l=e.prop,n=e.order,o=c().deepClone(a.state.stores);if(l&&n){var i=l.split("-")[0],s=l.split("-")[1];t=o.filter((function(e){for(var t=e.priceDetail,a=!1,r=t.length-1;r>=0;r--)if(t[r].goodsName===s&&t[r].platform===i){a=!0;break}return a})),r=o.filter((function(e){for(var t=e.priceDetail,a=!1,r=t.length-1;r>=0;r--)if(t[r].goodsName===s&&t[r].platform===i){a=!0;break}return!a})),t.sort((function(e,t){var r=a.getTargetPrice(e,s),l=a.getTargetPrice(t,s);return"ascending"===n?r-l:l-r})),a.setState({sortParams:{prop:l,order:n},stores:t.concat(r)})}},a.state={loading:!1,columns:[{width:150,prop:"storeName",fixed:"left",align:"center",render:function(e){return l.createElement("div",{className:"modifiedCell ellipsis",title:e.storeName},e.storeName)}}],stores:[],platforms:[],token:"",sortParams:{}},a}(0,r.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this,t=this.props.location.query.token;this.setState({token:t},(function(){return e.fetchData()}))},a.fetchData=function(){var e=this;this.setState({loading:!0});var t=this.state.token;i.h.post("/price/list/monitors",{token:t}).then((function(t){if(200===t.status||304===t.status){var a=t.data.result;e.generateColumns(a)}e.setState({loading:!1})})).catch((function(e){return o.Z.error(e.toString())}))},a.generateColumns=function(e){for(var t,a=this.state.stores,r=this.state.platforms,n=e.length-1;n>=0;n--)e[n].configDetailVoList&&function(){var o,i,s,c=e[n].configDetailVoList;0===n&&(t=c[1].topicTypeValue);for(var u=!1,f=r.length-1;f>=0;f--)c[0].topicValue===r[f].label&&(u=!0);u||r.push({label:c[0].topicValue,goods:[]});for(var p=!1,m=a.length-1;m>=0;m--)a[m].storeName===c[1].topicValue&&(p=!0);p||a.push({storeName:c[1].topicValue,priceDetail:[]});for(var d=(null==(o=c[0])?void 0:o.topicValue)||"",g=(null==(i=c[2])?void 0:i.topicValue)||(null==(s=c[1])?void 0:s.topicValue),h=r.length-1;h>=0;h--)if(r[h].label===d){for(var v=r[h].goods,N=!1,b=v.length-1;b>=0;b--)v[b].label===g&&(N=!0);if(!N){var E=12*g.length+26;v.push({label:g,prop:d+"-"+g,width:E,align:"center",sortable:"custom",renderHeader:function(e){return l.createElement("span",null,g)},render:function(e){var t=e.priceDetail.filter((function(e){return e.goodsName===g&&e.platform===d})),a=t[0],r="modifiedCell";if(a)switch(a.flag){case 0:default:break;case 1:r+=" increasing";break;case 2:r+=" decreasing"}return a?l.createElement("div",{className:r},a.price>0?a.price:"\u5df2\u4e0b\u67b6"):l.createElement("div",{className:r},"-")}})}}}();for(var o=this.state.columns,i=r.length-1;i>=0;i--)o.push({label:r[i].label,subColumns:r[i].goods});o[0].label=t,a=this.generateRows(a,e),this.setState({stores:a,platforms:r,columns:o})},a.generateRows=function(e,t){for(var a=c().deepClone(e),r=t.length-1;r>=0;r--)for(var l=t[r].configDetailVoList,n=0;n<l.length;n++)for(var o,i,s,u,f=(null==(o=l[0])?void 0:o.topicValue)||"",p=(null==(i=l[1])?void 0:i.topicValue)||"",m=(null==(s=l[2])?void 0:s.topicValue)||(null==(u=l[1])?void 0:u.topicValue),d=a.length-1;d>=0;d--)if(a[d].storeName===p){var g=a[d].priceDetail;if(0===g.length)g.push({goodsName:m,price:t[r].takePrice,platform:f,flag:t[r].flag});else{for(var h=!1,v=void 0,N=void 0,b=g.length-1;b>=0;b--)g[b].goodsName===m&&g[b].platform===f&&(h=!0,v=g[b].price,N=b);h?t[r].takePrice<v&&a[d].priceDetail.splice(N,1,{goodsName:m,price:t[r].takePrice,platform:f,flag:t[r].flag}):a[d].priceDetail.push({goodsName:m,price:t[r].takePrice,platform:f,flag:t[r].flag})}}return a},a.getTargetPrice=function(e,t){for(var a=c().deepClone(e).priceDetail,r=a.length-1;r>=0;r--)if(a[r].goodsName===t)return a[r].price},a.render=function(){var e=this.state,t=e.loading,a=e.stores,r=e.columns,o=e.sortParams,i=document.documentElement.clientHeight-70;return l.createElement("div",{className:"chartPage"},l.createElement("div",{className:"wrap"},t?l.createElement(n.Loading,{fullscreen:!0}):a.length>0?l.createElement("div",null,l.createElement("ul",{className:"description"},l.createElement("li",{className:"item"},l.createElement("div",{className:"square green"}),l.createElement("span",null,"\u6da8\u4ef7")),l.createElement("li",{className:"item"},l.createElement("div",{className:"square red"}),l.createElement("span",null,"\u964d\u4ef7"))),l.createElement(n.Table,{style:{width:"100%"},columns:r,data:a,onSortChange:this.handleSort,border:!0,emptyText:"\u6682\u65e0\u6570\u636e",maxHeight:i,defaultSort:o})):l.createElement("div",{className:"noDataTips"},"\u6682\u65e0\u6570\u636e")))},t}(l.Component)}}]);