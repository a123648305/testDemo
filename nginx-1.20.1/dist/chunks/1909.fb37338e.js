"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1909],{8469:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var a=n(94578),l=n(67294),r=n(92360),i=n(29383),o=n(59762),s=n(33097),c=n(55815),u=n(53754),d=n(66130),p=n(30381),m=n.n(p),h=n(43036),f=n(37841),g=n(61409),v=n(49722),E=n(35239),b=n(60742),C=[{key:"\u5168\u90e8",value:"BOTH"},{key:"\u5f85\u5904\u7406",value:"UNREAD"},{key:"\u5df2\u5904\u7406",value:"READ"}],y=["\u89c4\u5219\u88ab\u89e6\u53d1\u65f6\u63a8\u9001\u51fa\u53bb\u5373\u89c6\u4e3a\u4e00\u6b21\u63a8\u9001","\u5728\u7279\u5b9a\u65f6\u95f4\u5185\u6536\u5230\u63a8\u9001\u7684\u7528\u6237\u6570","\u9884\u8b66\u63a8\u9001\u7ed9\u7279\u5b9a\uff08\u591a\u4e2a\uff09\u7528\u6237\u65f6\uff0c\u53ea\u8981\u88ab\u4efb\u4e00\u7528\u6237\u201d\u5904\u7406\u201c\uff0c\u5373\u89c6\u4e3a\u8be5\u63d0\u9192\u5df2\u5904\u7406"],S=function(e){var t=e.title,n=e.url;return[{title:E.t.get(E.V.backProjectConfig).name,url:"/account/project/preview"},{title:"\u9884\u8b66\u7ba1\u7406",url:"/account/project/alert"},{title:t,url:n}]},D="YYYY-MM-DD",N=[m()().subtract(6,"days"),m()()],I=function(e){function t(t){var n;(n=e.call(this,t)||this).fetchLogList=function(){var e=n.state,t=e.projectId,a=e.searchText,l=e.team,r=e.user,i=e.status,o=e.alertObject,s=e.alertIndex,c=e.pageIndex,u=e.pageSize,d=e.dateFilter;n.setState({loading:!0},(function(){v.h.post("/warning/log/project/aspect/list",{projectId:t,title:a,statusList:"BOTH"===i?["READ","UNREAD"]:[i],receiverTeamIdList:l,receiverUserIdList:r,filterModel:{analysis:o,aspect:s},dateFilter:d,pageIndex:c,pageSize:u}).then((function(e){var t=e.status,a=e.data.result;if((t>=200&&t<300||304===t)&&a){var l=a.total,r=a.remindCount,i=a.remindUserCount,o=a.remindResolveCount,s=a.list;n.setState({list:s,total:l,remindCount:r,remindUserCount:i,remindResolveCount:o})}})).finally((function(){n.setState({loading:!1})}))}))},n.fetchTeamOptions=function(){try{var e=n.state.projectId;v.h.post("filter/find",{projectId:e,filterTypes:["TEAM","USER"],type:"OVERVIEW"}).then((function(e){var t=e.data,a=t.code,l=t.result;if(2e4===a&&l){var r=l.team,i=l.user;n.setState({teamOptions:r.map((function(e){return{id:e.id,name:e.name}})),userOptions:i.map((function(e){return{id:e.id,name:e.username}}))})}}))}catch(t){console.error(t)}},n.handleChangeTeam=function(e){n.setState({team:e},(function(){return n.fetchLogList()}))},n.handleChangeUser=function(e){n.setState({user:e},(function(){return n.fetchLogList()}))},n.handleInputChange=function(e){n.setState({searchText:e})},n.handleKeyUp=function(e){e.stopPropagation(),13===e.keyCode&&n.setState({pageIndex:1},(function(){return n.fetchLogList()}))},n.handleAlertObjChange=function(e){n.setState({alertObject:e,pageIndex:1},(function(){return n.fetchLogList()}))},n.handleAlertIndexChange=function(e){n.setState({alertIndex:e,pageIndex:1},(function(){return n.fetchLogList()}))},n.switchPage=function(e){n.setState({pageIndex:e},(function(){return n.fetchLogList()}))},n.switchPageSize=function(e){n.setState({pageIndex:1,pageSize:e},(function(){return n.fetchLogList()}))},n.handleChangeStatus=function(e){n.state.status!==e&&n.setState({status:e,pageIndex:1},(function(){return n.fetchLogList()}))},n.handleDateChange=function(e){if(Array.isArray(e)&&2===e.length){var t={dateGroupType:"DAY",from:e[0],quickChoice:e[0].replace(/-/g,".")+" - "+e[1].replace(/-/g,"."),remoteName:"cTime",to:e[1]};n.setState({dateFilter:t,pageIndex:1},(function(){return n.fetchLogList()}))}},n.getContent=function(e){if(e){var t=JSON.parse(e),n=t.calType,a=t.dateRangeType,l=t.aspect,r=t.warningValue,i=t.warningBeyondValue,o=t.analysis,s=t.aspectList,c=b.B.filter((function(e){return e.value===a})).length>0&&b.B.filter((function(e){return e.value===a}))[0].label,u=n?"PERCENT"===n?"\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4":"\u8d1f\u9762\u58f0\u91cf":"";return s?""+o+c+"\u7684"+s.map((function(e){return"\u3010"+e.aspectName+"\u3011"})).join("")+"\u7b49\u8d1f\u9762\u58f0\u91cf\u89e6\u53d1\u9884\u8b66":""+o+c+"\u7684"+l+"\u7684"+u+"\u4e3a"+r+"\uff0c\u8d85\u8fc7\u9608\u503c\uff08"+i+"\uff09"}};var a=t.location.state;return n.state={projectId:E.t.get(E.V.backProjectConfig)&&E.t.get(E.V.backProjectConfig).id,alertObject:{},alertIndex:{},dateFilter:{dateGroupType:"DAY",from:N[0].format(D),quickChoice:N[0].format(D).replace(/-/g,".")+" - "+N[1].format(D).replace(/-/g,"."),remoteName:"cTime",to:N[1].format(D)},team:[],teamOptions:[],user:[],userOptions:[],status:"BOTH",searchText:a&&a.title||"",pageIndex:1,pageSize:20,list:[],total:0,loading:!1,columns:[{label:"",prop:"paddingLeft",width:48},{label:"\u9884\u8b66\u540d\u79f0",prop:"title",minWidth:240,render:function(e){return l.createElement(h.Z,{overlay:function(){return n.renderDetailPopup(e.title,e.description)},placement:"topLeft",overlayClassName:"alert-detail-popup"},l.createElement("div",{className:"alert-title",onClick:function(){return n.handleEdit(e.warningId)}},e.title))}},{label:"\u63d0\u9192\u5185\u5bb9",prop:"content",minWidth:240,render:function(e){return l.createElement("div",{className:"alert-title",onClick:function(){return n.goDetail(e.id)}},e.remindMsg)}},{label:"\u63a8\u9001\u6210\u5458",prop:"user",render:function(e){var t=e.receiverTeamList,n=e.receiverUserList;return l.createElement(l.Fragment,null,l.createElement("div",{className:"teams"},l.createElement("span",null,"\u56e2\u961f | "),l.createElement("span",null,t.length>0?t.map((function(e){return e.name})).join("\uff0c"):"\u65e0")),l.createElement("div",{className:"teams"},l.createElement("span",null,"\u6210\u5458 | "),l.createElement("span",null,n.length>0?n.map((function(e){return e.name})).join("\uff0c"):"\u65e0")))},minWidth:240},{label:"\u5904\u7406\u72b6\u6001",prop:"status",render:function(e){return l.createElement("div",{className:(e.status,"alert-log-status")},"READ"===e.status?"\u5df2\u5904\u7406":"\u5f85\u5904\u7406")}},{label:"\u63a8\u9001\u65f6\u95f4",prop:"createdAt",minWidth:140,render:function(e){return l.createElement("span",null,e.createdAt.substring(0,16))}},{label:"",prop:"paddingRight",width:48}],remindCount:0,remindUserCount:0,remindResolveCount:0},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.fetchTeamOptions(),this.fetchLogList()},n.renderDetailPopup=function(e,t){return l.createElement(l.Fragment,null,l.createElement("div",{className:"popup-title"},"\u9884\u8b66\u540d\u79f0"),l.createElement("div",{className:"popup-content",style:{marginBottom:"16px"}},e),l.createElement("div",{className:"popup-title"},"\u9884\u8b66\u8bf4\u660e"),l.createElement("div",{className:"popup-content"},t))},n.handleEdit=function(e){g.mW.push({pathname:"/account/project/alert/edit",state:{id:e,edit:!0}})},n.goDetail=function(e){g.mW.push({pathname:"/account/project/alert/detail",state:{id:e}})},n.render=function(){var e=this.state,t=e.projectId,n=e.teamOptions,a=e.userOptions,p=e.searchText,m=e.status,g=e.columns,v=e.loading,E=e.list,b=e.pageIndex,D=e.pageSize,I=e.total,w=e.remindCount,T=e.remindUserCount,O=e.remindResolveCount;return l.createElement("div",{className:"alert-log"},l.createElement(c.Z,{title:S({title:"\u63a8\u9001\u65e5\u5fd7"})}),l.createElement("div",{className:"search_wrapper"},l.createElement("div",{className:"alert-log-search"},l.createElement("div",null,l.createElement("div",{className:"search-input-wrapper"},l.createElement(r.Input,{icon:"search",value:p,onChange:this.handleInputChange,onKeyUp:this.handleKeyUp,placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u540d\u79f0"})),l.createElement(o.Z,{projectId:t,type:"OVERVIEW",onChange:this.handleAlertObjChange}),l.createElement(s.Z,{projectId:t,onChange:this.handleAlertIndexChange}),l.createElement(u.Z,{title:"\u63a8\u9001\u7528\u6237\u7ec4",options:n,onChange:this.handleChangeTeam}),l.createElement(u.Z,{title:"\u63a8\u9001\u6210\u5458",options:a,onChange:this.handleChangeUser}),l.createElement(f.Z,{activeKey:m,options:C,onTabClick:this.handleChangeStatus})),l.createElement("div",null,l.createElement(d.S,{defaultValue:N,getDateRange:this.handleDateChange})))),l.createElement("div",{className:"alert-log-content"},l.createElement(r.Loading,{loading:v,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},l.createElement("div",{className:"cards"},l.createElement("div",null,l.createElement("span",null,w),l.createElement("span",null,l.createElement("span",null,"\u63a8\u9001\u63d0\u9192\u6b21\u6570"),l.createElement(h.Z,{overlay:y[0],placement:"top",overlayClassName:"alert-log-tips"},l.createElement("i",{className:"cem-icon icon-cem_problem"})))),l.createElement("div",null,l.createElement("span",null,T),l.createElement("span",null,l.createElement("span",null,"\u63a8\u9001\u6210\u5458"),l.createElement(h.Z,{overlay:y[1],placement:"top",overlayClassName:"alert-log-tips"},l.createElement("i",{className:"cem-icon icon-cem_problem"})))),l.createElement("div",null,l.createElement("span",null,O),l.createElement("span",null,l.createElement("span",null,"\u5df2\u5904\u7406\u63d0\u9192"),l.createElement(h.Z,{overlay:y[2],placement:"top",overlayClassName:"alert-log-tips"},l.createElement("i",{className:"cem-icon icon-cem_problem"}))))),l.createElement(i.Z,{columns:g,data:E,total:I,pagePosition:"down",pageSize:D,currentPage:b,onPage:this.switchPage,onSortChange:this.handleSort,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,notLimit:!0}))))},t}(l.PureComponent)},60742:(e,t,n)=>{n.d(t,{B:()=>a});var a=[{label:"\u8fd13\u5929",value:"LAST_THREE_DAYS"},{label:"\u8fd17\u5929",value:"LAST_SENVEN_DAYS"},{label:"\u8fd130\u5929",value:"LAST_THIRTY_DAYS"},{label:"\u5f53\u5929",value:"CURRENT_DAY"},{label:"\u5f53\u5468",value:"CURRENT_WEEK"},{label:"\u5f53\u6708",value:"CURRENT_MONTH"}]},66130:(e,t,n)=>{n.d(t,{M:()=>E,S:()=>I});var a=n(87462),l=n(94578),r=n(67294),i=n(45697),o=n.n(i),s=n(91751),c=n(98619),u=n.n(c),d=n(82784),p=n.n(d),m=n(30381),h=n.n(m),f=(n(83839),"YYYY-MM-DD");function g(e){if(!e)return!1;var t=h()();return e.valueOf()>t.valueOf()}var v=function(e){function t(t){var n;return(n=e.call(this,t)||this).onChange=function(e){n.setState({value:e},(function(){n.props.getDateRange(e)}))},n.onOpenChange=function(e){!n.state.disabled&&n.setState({open:e})},n.onFocus=function(){!n.state.open&&n.state.isMouseDown?n.setState({isMouseDown:!1}):n.setState({open:!0})},n.onMouseEnter=function(){var e=n.state,t=e.value,a=e.disabled;t&&!a&&n.setState({clearable:!0})},n.onMouseDown=function(){n.setState({isMouseDown:!0})},n.clearValue=function(){n.setState({value:null}),n.props.getDateRange("")},n.state={showDateInput:!0,disabled:t.disabled||!1,open:!1,value:t.defaultValue?t.defaultValue:h()(),clearable:!1},n}(0,l.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){var t=this.props,n=t.disabled,a=t.disabledDate,l=t.defaultValue;JSON.stringify(l)!==JSON.stringify(e.defaultValue)&&this.setState({value:e.defaultValue}),JSON.stringify(a)!==JSON.stringify(e.disabledDate)&&this.setState({disabledDate:e.disabledDate}),n!==e.disabled&&this.setState({disabled:e.disabled})},n.render=function(){var e=this,t=this.state,n=t.showDateInput,l=t.value,i=t.open,o=t.disabled,c=t.clearable,d={showDateInput:!0,locale:p(),showOk:!1,showToday:!1,format:f,renderFooter:function(){return null}},m=r.createElement(s.Z,(0,a.Z)({},d,{dateInputPlaceholder:"\u8bf7\u9009\u62e9\u65e5\u671f",showDateInput:n,disabledDate:this.props.disabledDate||g,focusablePanel:!1}));return r.createElement(u(),{animation:"slide-up",calendar:m,value:l,onChange:this.onChange,onOpenChange:this.onOpenChange,open:i,style:{zIndex:1014}},(function(t){var n=t.value;return r.createElement("span",{className:"ant-calendar-picker ant-calendar-picker-default",tabIndex:"0",onMouseDown:e.onMouseDown,onFocus:e.onFocus,onMouseEnter:e.onMouseEnter,onMouseLeave:function(){return e.setState({clearable:!1})}},r.createElement("div",null,r.createElement("input",{placeholder:"\u8bf7\u9009\u62e9\u65e5\u671f",disabled:o,readOnly:!0,tabIndex:"-1",className:o?"ant-calendar-picker-input ant-input disabled":"ant-calendar-picker-input ant-input",value:n&&n.format(f)||""}),r.createElement("i",{className:"icon-cem_time-controller .ant-calendar-picker-icon",style:{visibility:c?"hidden":"visible"}}),r.createElement("i",{className:"icon-cem_close-window .ant-calendar-picker-icon",style:{visibility:c?"visible":"hidden"},onClick:function(t){o||(t.stopPropagation(),e.clearValue())}})))}))},t}(r.Component);v.propTypes={defaultValue:o().object,getDateRange:o().func.isRequired,disabledDate:o().func,disabled:o().bool};const E=v;var b=n(59108),C=n.n(b),y="YYYY-MM-DD";function S(e){return e?e.format(y):""}function D(e){return e&&e[0]&&e[1]}function N(e){return!!e&&h()().valueOf()<e.valueOf()}var I=function(e){function t(t){var n;return(n=e.call(this,t)||this).onChange=function(e){n.setState({value:e});var t=e.map((function(e){return S(e)}));n.props.getDateRange(t)},n.onHoverChange=function(e){n.setState({hoverValue:e})},n.onFocus=function(){!n.state.open&&n.state.isMouseDown?n.setState({isMouseDown:!1}):n.setState({open:!0})},n.onMouseDown=function(){n.setState({isMouseDown:!0})},n.onMouserEnter=function(){D(n.state.value)&&n.setState({clearable:!0})},n.clearValue=function(){n.setState({value:[]}),n.props.getDateRange(["",""])},n.state={disabled:!1,showDateInput:!1,value:t.defaultValue||[],hoverValue:[],clearable:!1},n}return(0,l.Z)(t,e),t.prototype.render=function(){var e=this,t=this.state,n=t.value,l=t.hoverValue,i=t.clearable,o=t.disabled,s=t.defaultValue,c={showDateInput:!1,locale:p(),showOk:!1,showToday:!1,format:y,renderFooter:function(){return null}},d=r.createElement(C(),(0,a.Z)({},c,{hoverValue:l,onHoverChange:this.onHoverChange,dateInputPlaceholder:["\u5f00\u59cb\u65e5\u671f","\u7ed3\u675f\u65e5\u671f"],defaultValue:s,disabledDate:N})),m=D(n);return r.createElement(u(),{animation:"slide-up",calendar:d,value:n,onChange:this.onChange},(function(t){var n=t.value;return r.createElement("span",{tabIndex:"0",className:"ant-calendar-picker",onMouseDown:e.onMouseDown,onFocus:e.onFocus},r.createElement("span",{className:"ant-calendar-picker-input ant-input",onMouseEnter:e.onMouserEnter,onMouseLeave:function(){e.setState({clearable:!1})}},r.createElement("input",{placeholder:"\u5f00\u59cb\u65e5\u671f",style:{width:130},disabled:o,readOnly:!0,tabIndex:"-1",className:"ant-calendar-range-picker-input",value:m&&""+S(n[0])||""}),r.createElement("span",null,"\u81f3"),r.createElement("input",{placeholder:"\u7ed3\u675f\u65e5\u671f",style:{width:130},disabled:o,readOnly:!0,tabIndex:"-1",className:"ant-calendar-range-picker-input",value:m&&""+S(n[1])||""}),r.createElement("i",{className:"icon-cem_time-controller",style:{visibility:m?"hidden":"visible"}}),r.createElement("i",{className:"icon-cem_close-window",style:{visibility:i?"visible":"hidden"},onClick:function(t){t.stopPropagation(),e.clearValue()}})))}))},t}(r.Component);I.propTypes={defaultValue:o().array,getDateRange:o().func.isRequired,disabledDate:o().func,disabled:o().bool}},37841:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),l=n(45697),r=n.n(l),i=function(e){var t=e.activeKey,n=e.options,l=e.onTabClick;return a.createElement("div",{className:"tabs"},n.map((function(e,n){return a.createElement("div",{key:n,className:t===e.value?"active-tab":"",onClick:function(){return t!==e.value&&l(e.value,e)}},e.key||e.label)})))};i.propTypes={activeKey:r().oneOfType([r().string,r().number]),options:r().arrayOf(r().shape({key:r().string,value:r().oneOfType([r().string,r().number])})).isRequired,onTabClick:r().func.isRequired};const o=i}}]);