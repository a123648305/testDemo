(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1387],{21387:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var i=a(97326),n=a(94578),r=a(67294),s=a(49722),o=a(92360),c=a(5133),l=a(29383),p=a(61193),m=a(5747),u=a(88308),d=function(e){function t(t){var a;return(a=e.call(this,t)||this).handleSubmit=function(e){e.preventDefault(),a.form.validate((function(e){if(!e||!a.competeChange())return!1;var t=a.state.form,i=t.name,n=(t.email,t.phone),r=t.job;s.h.post("settings/username/update",{username:i,phone:n,job:r}).then((function(e){var t=p.Z.getUser();t.username=i,p.Z.register(t),a.setState({refresh:!a.state.refresh}),c.Z.info(e.data.msg),a.setState({testForm:Object.assign(a.state.testForm,a.state.form)})}))}))},a.profilePicUpload=function(e){var t=(0,i.Z)(a),n=e.target.files[0];if(n.size/1024>1024)return c.Z.error("\u6587\u4ef6\u4e0d\u80fd\u5927\u4e8e1M"),!1;var r=new FileReader;r.readAsDataURL(n),r.onload=function(e){t.setState({cropShow:!0,uploadPic:e.target.result})}},a.deleteUser=function(){s.h.post("/user/delete",{id:a.props.location.query.id}).then((function(e){2e4===e.data.code&&(c.Z.success("\u5220\u9664\u6210\u529f"),a.setState({dialogVisible:!1}),window.history.back())}))},a.state={form:{img:"",name:"",email:"",roleId:"",phone:""},testForm:{img:"",name:"",email:"",roleId:"",phone:""},rules:{name:[{message:"\u8bf7\u8f93\u5165\u540d\u79f0",trigger:"blur"}]},uploadPic:"",cropPrePic:"",profilePic:"",cropShow:!1,cropLoading:!1,changeProfilePic:!1,profilePicList:[1,2,3,4,5,6],roleList:[],statusList:[{id:0,name:"\u7981\u7528"},{id:1,name:"\u53ef\u7528"}],teamList:[],selTeam:{},columns:[{label:"",prop:"paddingLeft",width:48},{label:"\u6240\u5728\u56e2\u961f",render:function(e){return r.createElement("div",null,e.name)}},{label:"\u64cd\u4f5c",width:180,render:function(e){return r.createElement("span",{onClick:a.delTeam.bind((0,i.Z)(a),e.id),className:"operation_columns",style:{cursor:"pointer"}},"\u79fb\u51fa")}},{label:"",prop:"paddingRight",width:48}],data:[],dialogVisible:!1},a}(0,n.Z)(t,e);var d=t.prototype;return d.componentDidMount=function(){var e=this;this.getUser(),this.getRoleList(),this.getDataList(),this.getTeamList(),window.addEventListener("click",(function(t){e.state.changeProfilePic&&e.setState({changeProfilePic:!1})}),!1)},d.getUser=function(e,t){var i=this;s.h.post("/user/find",{id:this.props.location.query.id}).then((function(n){var r=n.data.result,s=r.email,o=r.username,c=r.roleId,l=r.status,m=r.userHeadUrl,u=r.remark,d=m?m+"?_="+(new Date).getTime():a(7732);if(i.setState({form:{email:s,name:o,roleId:c,status:l,remark:""===u?"\u65e0":u},testForm:{email:s,name:o,roleId:c,status:l},uploadPic:d,profilePic:d}),e){var h=p.Z.getUser();if(h.userId===i.props.location.query.id)h.userHeadUrl=n.data.result,h.headPic=t+"?_="+(new Date).getTime(),p.Z.register(h),document.querySelector(".portrait").setAttribute("src",h.headPic);i.setState({cropShow:!1,changeProfilePic:!1,cropLoading:!1,profilePic:h.userId===i.props.location.query.id?h.headPic:t})}}))},d.getRoleList=function(){var e=this;s.h.get("/role/list").then((function(t){var a=[{id:"2",name:"\u4f01\u4e1a\u7ba1\u7406\u5458"},{id:"3",name:"\u666e\u901a\u6210\u5458"}].concat(t.data.result.list);e.setState({roleList:a})}))},d.getDataList=function(){var e=this;s.h.post("team/list",{id:this.props.location.query.id}).then((function(t){e.setState({data:t.data.result})}))},d.getTeamList=function(){var e=this;s.h.post("team/other/list",{users:[this.props.location.query.id]}).then((function(t){e.setState({teamList:t.data.result})}))},d.onChange=function(e,t){var a=this;switch(e){case"status":s.h.post("/user/operate",{id:a.props.location.query.id,status:t,username:a.state.form.name}).then((function(i){var n;a.setState({form:Object.assign(a.state.form,(n={},n[e]=t,n))}),c.Z.success("\u64cd\u4f5c\u6210\u529f!")}));break;case"roleId":!function(i){a.state.roleMap;s.h.post("/user/role/update",{roleId:t,id:a.props.location.query.id,username:a.state.form.name}).then((function(i){var n;a.setState({form:Object.assign(a.state.form,(n={},n[e]=t,n))}),c.Z.success("\u64cd\u4f5c\u6210\u529f!")}))}()}},d.competeChange=function(){var e=this.state,t=e.form,a=e.testForm,i=!1;for(var n in a)a[n]!==t[n]&&(i=!0);return i||c.Z.warning("\u6ca1\u6709\u4efb\u4f55\u6539\u52a8!"),i},d.convertImgToBase64=function(e,t){var a=document.createElement("CANVAS"),i=a.getContext("2d"),n=new Image;return n.crossOrigin="Anonymous",new Promise((function(r,s){n.onload=function(){a.height=n.height,a.width=n.width,i.drawImage(n,0,0);var e=a.toDataURL(t||"image/png");r(e),a=null},n.src=e}))},d.getBase64=function(e){var t=new Image;if(t.crossOrigin="",t.src=e,e)return new Promise((function(e,a){t.onload=function(){e(function(e,t,a){var i=document.createElement("canvas");return i.width=t||e.width,i.height=a||e.height,i.getContext("2d").drawImage(e,0,0,i.width,i.height),i.toDataURL()}(t))}}))},d.uploadDefault=function(e){var t=this,i=this.state.profilePicList[e],n=a(36219)("./profile_pic_0"+i+".png");this.getBase64(n).then((function(e){t.setState({cropPrePic:e}),t.cropConfirm(e)}))},d._crop=function(){var e=this.cropper.getCroppedCanvas().toDataURL();this.setState({cropPrePic:e})},d.dataURLtoFile=function(e,t){for(var a=e.split(","),i=a[0].match(/:(.*?);/)[1],n=atob(a[1]),r=new Uint8Array(s),s=n.length;s--;)r[s]=n.charCodeAt(s);return new File([r],t,{type:i})},d.cropConfirm=function(e){var t=this;this.setState({cropLoading:!0},(function(a){var i=window.location.hostname+"/-72_72.png",n={base64Code:e,fileName:i,userId:t.props.location.query.id};n=JSON.stringify(n),s.h.post("/upload/user/head",n).then((function(e){c.Z.success(e.data.msg),t.getUser(!0,e.data.result+"?_="+(new Date).getTime())}))}))},d.resetPass=function(){var e=this;s.h.post("invite/password/reset",{email:this.props.location.query.email}).then((function(t){c.Z.success("\u5df2\u5411"+e.props.location.query.email+"\u90ae\u7bb1\u53d1\u9001\u91cd\u7f6e\u5bc6\u7801\u90ae\u4ef6\uff0c\u8bf7\u63d0\u9192\u8be5\u7528\u6237\u67e5\u6536\u90ae\u4ef6\u3002")}))},d.updateName=function(e){var t=this,a=this.state.form;this.setState({form:Object.assign(a,{name:e})},(function(e){s.h.post("settings/username/update",{username:a.name,id:t.props.location.query.id}).then((function(e){c.Z.success("\u4fee\u6539\u6210\u529f")}))}))},d.updateRemark=function(e){var t=this,a=this.state.form;this.setState({form:Object.assign(a,{remark:e})},(function(e){s.h.post("/user/remark/update",{remark:a.remark,id:t.props.location.query.id}).then((function(e){c.Z.success("\u4fee\u6539\u6210\u529f");var a=t.state.form;a.remark=a.remark||"\u65e0",t.setState({form:a})}))}))},d.selectTeam=function(e){var t=this;s.h.post("team/user/add",{users:[this.props.location.query.id],id:e}).then((function(e){t.getDataList(),t.getTeamList()}))},d.delTeam=function(e){var t=this;o.MessageBox.confirm("\u786e\u8ba4\u4ece\u8be5\u56e2\u961f\u4e2d\u79fb\u51fa\u6b64\u7528\u6237?","\u63d0\u793a",{type:"warning"}).then((function(){s.h.post("team/user/remove",{users:[t.props.location.query.id],id:e}).then((function(e){t.getDataList(),t.getTeamList()}))}))},d.render=function(){var e=this,t=this.state,i=t.form,n=t.rules,s=t.roleList,c=t.profilePic,p=t.statusList,d=t.changeProfilePic,h=t.profilePicList,f=t.cropShow,g=t.cropLoading,v=t.uploadPic,E=t.columns,b=t.data,y=t.dialogVisible;return r.createElement("div",{className:"user-setting-container-wrap"},r.createElement(o.Layout.Row,{className:"user-setting-container"},r.createElement("div",{className:"profile-pic-cont",onClick:function(e){e.stopPropagation()}},r.createElement("div",{className:"profile-pic-wrap"},r.createElement("div",{className:"profile-pic",onClick:function(t){e.setState({changeProfilePic:!d})}},r.createElement("img",{src:c}),r.createElement("div",{className:"profile-hover"},"\u66f4\u6362\u5934\u50cf")),r.createElement(o.Form,{model:i,rules:n,ref:function(t){return e.form=t},labelWidth:"78px",labelPosition:"left"},r.createElement(o.Form.Item,{label:"\u7528\u6237\u540d",prop:"name"},r.createElement(u.Z,{id:"editFilter",className:"user-name",value:i.name,confirm:this.updateName.bind(this)})),r.createElement(o.Form.Item,{label:"\u90ae\u7bb1",prop:"email"},r.createElement("div",{style:{paddingLeft:"12px",textAlign:"left"}},i.email)),r.createElement(o.Form.Item,{label:"\u89d2\u8272",prop:"roleId"},r.createElement(o.Select,{className:"hover-visible",value:i.roleId,onChange:this.onChange.bind(this,"roleId"),placeholder:""},s&&s.map((function(e,t){return r.createElement(o.Select.Option,{key:t,label:e.name,value:e.id},e.name)})))),r.createElement(o.Form.Item,{label:"\u72b6\u6001",prop:"job"},r.createElement(o.Select,{className:"hover-visible",value:i.status,onChange:this.onChange.bind(this,"status"),placeholder:""},p&&p.map((function(e,t){return r.createElement(o.Select.Option,{key:t,label:e.name,value:e.id},e.name)})))),r.createElement(o.Form.Item,{label:"\u5907\u6ce8",prop:"remark"},r.createElement(u.Z,{id:"editFilterRemark",className:"user-name",inputType:"remark",name:"\u5907\u6ce8",value:i.remark,confirm:this.updateRemark.bind(this)}))),r.createElement(o.Dialog,{title:"",size:"tiny",visible:y,onCancel:function(){return e.setState({dialogVisible:!1})},lockScroll:!0},r.createElement(o.Dialog.Body,null,r.createElement("div",{className:"dialog-title"},r.createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"\u786e\u5b9a\u5220\u9664\u8be5\u7528\u6237\uff1f")),r.createElement(o.Dialog.Footer,{className:"dialog-footer"},r.createElement(o.Button,{type:"primary",onClick:this.deleteUser},"\u786e\u5b9a"),r.createElement(o.Button,{onClick:function(){return e.setState({dialogVisible:!1})}},"\u53d6\u6d88"))),f&&r.createElement(m.Z,{src:v,title:"\u4e0a\u4f20\u81ea\u5b9a\u4e49\u5934\u50cf",loading:g,tip:"\u4ec5\u652f\u6301png\u683c\u5f0f\uff0c\u6587\u4ef6\u5c0f\u4e8e1M\uff0c\u5efa\u8bae\u4e3a\u6b63\u65b9\u5f62",confirm:this.cropConfirm.bind(this),cancel:function(t){e.setState({cropShow:!1})},borderRadius:!0}),r.createElement("div",{className:"operations"},r.createElement("span",{onClick:function(t){return e.resetPass()}},"\u91cd\u7f6e\u5bc6\u7801"))),d&&r.createElement("div",{className:"profile-pic-select"},r.createElement("h4",{className:"cont-title"},r.createElement("span",null,"\u4fee\u6539\u5934\u50cf"),r.createElement("i",{className:"crop-close select-del",onClick:function(t){e.setState({changeProfilePic:!1})}})),r.createElement("div",{className:"marl-15"},r.createElement("ul",{className:"profile-pic-list"},h.map((function(t,i){return r.createElement("div",{className:"profile-pic-item",key:i,onClick:function(t){e.uploadDefault(i)}},r.createElement("img",{src:a(36219)("./profile_pic_0"+t+".png")}))})))),r.createElement("div",{className:"upload-wrap"},r.createElement("label",{className:"upload-btn",htmlFor:"uploadProfilePic"},r.createElement("i",{className:"el-icon-plus"}),"\u4e0a\u4f20\u81ea\u5b9a\u4e49\u5934\u50cf"),r.createElement("input",{type:"file",hidden:!0,id:"uploadProfilePic",accept:"images/png",onChange:this.profilePicUpload}),r.createElement("div",{className:"upload-tip"},"\u4ec5\u652f\u6301png\u683c\u5f0f\uff0c\u6587\u4ef6\u5c0f\u4e8e1M\uff0c\u5efa\u8bae\u4e3a\u6b63\u65b9\u5f62"))))),r.createElement("div",{className:"table"},r.createElement("div",{className:"top"},r.createElement("p",null,"\u56e2\u961f"),r.createElement(o.Select,{value:this.state.selTeam.id,onChange:this.selectTeam.bind(this),placeholder:"\u6dfb\u52a0\u5230\u56e2\u961f"},this.state.teamList&&this.state.teamList.map((function(e,t){return r.createElement(o.Select.Option,{key:t,label:e.name,value:e.id},e.name)})))),r.createElement(l.Z,{columns:E,data:b})))},t}(r.Component)},5747:(e,t,a)=>{"use strict";a.d(t,{Z:()=>u});var i=a(94578),n=a(67294),r=a(45697),s=a.n(r),o=a(94184),c=a.n(o),l=a(55761),p=a(92360),m=a(5133),u=function(e){function t(){for(var t,a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).state={src:t.props.src,preCropPic:"",once:!0,fileName:t.props.fileName},t}(0,i.Z)(t,e);var a=t.prototype;return a.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({uploadPic:e.uploadPic},(function(e){}))},a._crop=function(){var e=this.props.refName,t=this.refs[e].getCroppedCanvas().toDataURL();this.setState({preCropPic:t})},a.profilePicUpload=function(e){var t=this.props.reUpload,a=this,i=e.target.files[0];if(i.size/1024>1024)return m.Z.error("\u6587\u4ef6\u4e0d\u80fd\u5927\u4e8e1M"),!1;var n=new FileReader;n.readAsDataURL(i),n.onload=function(e){a.setState({src:e.target.result,fileName:i.name}),t&&t(e.target.result)}},a.render=function(){var e=this.state,t=e.src,a=e.preCropPic,i=this.props,r=i.title,s=i.tip,o=i.style,m=i.className,u=i.loading,d=i.refName,h=i.aspectRatio,f=i.accept,g=i.confirm,v=i.cancel,E=i.borderRadius,b=this.state.fileName,y="cropper-pic-wrap";m&&(y=c()("cropper-pic-wrap",m));var N=c()("pre-pic",{"border-radius":E}),S=1;return h&&"[object Number]"===Object.prototype.toString.call(S)&&(S=h),n.createElement("div",{className:y},n.createElement("div",{className:"crop-wrap"},n.createElement(p.Loading,{loading:u},n.createElement("div",{className:"crop-title"},n.createElement("span",null,r),n.createElement("i",{className:"icon-cem_cancel",onClick:function(){return v(a)}})),n.createElement("div",{className:"crop-cont"},n.createElement(l.Z,{ref:d,src:t,style:o,aspectRatio:S,guides:!1,crop:this._crop.bind(this)}),n.createElement("div",{className:"option-cont"},n.createElement("div",{className:"pre-cont"},n.createElement("img",{className:N,src:a})),n.createElement("div",{className:"pre-tip"},"\u9884\u89c8"),n.createElement("div",{className:"reupload-cont"},n.createElement(p.Button,{type:"primary",onClick:function(){return document.getElementById("reupload").click()}},"\u91cd\u65b0\u4e0a\u4f20"),n.createElement("input",{type:"file",id:"reupload",hidden:!0,accept:f,onChange:this.profilePicUpload.bind(this)})))),n.createElement("p",{className:"crop-tip"},s),n.createElement("div",{className:"crop-option"},n.createElement(p.Button,{onClick:function(){v(a)}},"\u53d6\u6d88"),n.createElement(p.Button,{type:"primary",onClick:function(){g(a,b)}},"\u786e\u5b9a")))),n.createElement("div",{className:"crop-bg"}))},t}(n.Component);u.propTypes={show:s().bool,title:s().string,tip:s().string,src:s().string,refName:s().string,accept:s().string,confirm:s().func,cancel:s().func,reUpload:s().func,borderRadius:s().bool,loading:s().bool,fileName:s().string},u.defaultProps={show:!1,src:"",title:"\u4e0a\u4f20\u56fe\u7247",accept:"images/png",tip:"\u4ec5\u652f\u6301png\u683c\u5f0f\uff0c\u6587\u4ef6\u5c0f\u4e8e1M",refName:"cropper"+(new Date).getTime(),style:{height:263,width:263},borderRadius:!1,loading:!1,fileName:""}},88308:(e,t,a)=>{"use strict";a.d(t,{Z:()=>h});var i=a(94578),n=a(67294),r=a(45697),s=a.n(r),o=a(5133),c=a(43036),l=a(94184),p=a.n(l),m={value:s().string,id:s().any.isRequired,enter:s().bool,blurFun:s().func,name:s().string,empty:s().bool,placeholder:s().string,type:s().string,confirmNoChange:s().func},u={value:"",enter:!0,name:"\u540d\u79f0",empty:!1,placeholder:"",cancel:function(e,t){},confirm:function(e,t){},type:"normal"},d=function(e){function t(t){var a;(a=e.call(this,t)||this).enter=function(e){a.props.enter&&13===e.keyCode&&a.confirmEdit()};var i=a.props.value;return a.state={isEdit:!1,curValue:i||"",lastVal:i||"",hover:!1,canEdit:!1},a}(0,i.Z)(t,e);var a=t.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){var t=this;e.value!==this.state.lastVal&&e.value&&this.setState({curValue:e.value,lastVal:e.value}),!0!==e.canEdit||this.state.canEdit||this.setState({canEdit:!0},(function(e){t.toEdit()}))},a.componentDidMount=function(){var e=this;document.body.addEventListener("click",(function(t){var a=t.target||window.event.srcElement,i=e.props.className,n="edit-input-wrap";i&&(n=i.split(" ")[0]);(function(e,t){for(var a=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e&&!a.call(e,t);)e=e.parentElement;return e})(a,"."+n)||e.cancelEdit()}))},a.changeName=function(){var e=this.props.id,t=document.getElementById(e).value;this.setState({curValue:t})},a.toEdit=function(){var e=this.state,t=e.isEdit,a=(e.canEdit,this.props.id);t||this.setState({isEdit:!0,hover:!0},(function(e){var t=document.getElementById(a);setTimeout((function(){t.focus()}))}))},a.checkEdit=function(){"normal"===this.props.type&&this.toEdit()},a.cancelEdit=function(){var e=this.state,t=e.curValue,a=e.lastVal,i=e.isEdit,n=e.canEdit,r=this.props.cancel;i&&(n&&this.setState({canEdit:!1}),this.setState({isEdit:!1,hover:!1,curValue:a},(function(e){r&&r(t,a)})))},a.borderShow=function(){var e=this.state.hover;"normal"!==this.props.type||e||this.setState({hover:!0})},a.borderHide=function(){var e=this.state,t=e.hover,a=e.isEdit;"normal"===this.props.type&&t&&!a&&this.setState({hover:!1})},a.confirmEdit=function(){var e=this.state,t=e.curValue,a=e.lastVal,i=e.canEdit,n=this.props,r=n.confirm,s=n.id,c=n.name,l=n.empty,p=n.confirmNoChange,m=n.inputType,u=document.getElementById(s);""!==String(t).replace(/\s/g,"")||l||"remark"===m?(""===String(t).replace(/\s/g,"")&&l||"remark"==m?(this.setState({isEdit:!1,hover:!1,lastVal:t},(function(e){u.blur()})),r&&r(t,a)):a===t?this.setState({isEdit:!1,hover:!1},(function(e){u.blur()})):(this.setState({isEdit:!1,hover:!1,lastVal:t},(function(e){u.blur()})),r&&r(t,a)),i&&(p&&p(t),this.setState({canEdit:!1}))):(o.Z.warning(c+"\u4e0d\u80fd\u4e3a\u7a7a"),this.setState({curValue:a},(function(e){u.focus()})))},a.render=function(){var e=this.props,t=e.id,a=e.style,i=e.className,r=e.placeholder,s=this.state,o=s.isEdit,l=s.curValue,m=s.hover,u=p()(["edit-input-wrap",i]),d=p()(["edit-input-cont",{hover:m,"is-edit":o}]),h=p()(["edit-input",{disabled:!o}]);return n.createElement("div",{className:u,style:a},n.createElement("div",{className:d,onMouseEnter:this.borderShow.bind(this),onMouseLeave:this.borderHide.bind(this),onClick:this.checkEdit.bind(this)},n.createElement("input",{id:t,className:h,type:"text",value:l,title:l,placeholder:r,style:a,disabled:!o,onInput:this.changeName.bind(this),onKeyDown:this.enter.bind(this)}),m&&!o&&n.createElement(c.Z,{placement:"top",overlay:"\u7f16\u8f91"},n.createElement("div",{className:"btn-wrap",title:"\u7f16\u8f91"},n.createElement("i",{className:"name-edit edit-btn icon-cem_edit"}))),m&&o&&n.createElement("div",{className:"btn-wrap"},n.createElement(c.Z,{placement:"top",overlay:"\u53d6\u6d88"},n.createElement("i",{className:"cancel-edit edit-btn icon-cem_delete",onClick:this.cancelEdit.bind(this),title:"\u53d6\u6d88"})),n.createElement(c.Z,{placement:"top",overlay:"\u786e\u8ba4"},n.createElement("i",{className:"confirm-edit edit-btn icon-cem_check-out",onClick:this.confirmEdit.bind(this),title:"\u786e\u8ba4"})))))},t}(n.Component);d.propTypes=m,d.defaultProps=u;const h=d},36219:(e,t,a)=>{var i={"./profile_pic_01.png":68374,"./profile_pic_02.png":48524,"./profile_pic_03.png":29860,"./profile_pic_04.png":87863,"./profile_pic_05.png":85101,"./profile_pic_06.png":96805};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=36219},68374:(e,t,a)=>{"use strict";e.exports=a.p+"img/c51764ce4120e50d299d.png"},48524:(e,t,a)=>{"use strict";e.exports=a.p+"img/43bb4bdb99bb70f3d2f5.png"},29860:(e,t,a)=>{"use strict";e.exports=a.p+"img/69696df84bc43ee42685.png"},87863:(e,t,a)=>{"use strict";e.exports=a.p+"img/753108555b4f4e8ed042.png"},85101:(e,t,a)=>{"use strict";e.exports=a.p+"img/14d4b020960c4e06078d.png"},96805:(e,t,a)=>{"use strict";e.exports=a.p+"img/43f010a5a2f10ebe0253.png"}}]);