(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6118],{86118:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var n=a(67154),i=a.n(n),t=a(81506),l=a.n(t),n=a(85354),r=a.n(n),t=a(67294),o=a.n(t),s=a(8833),u=a(87920),c=a(55363),d=a(35239),n=a(55609),f=a(64396).Z.public.menu,t=function(a){function e(e){var t=a.call(this,e)||this,e=window.location.pathname;return t.state={boardId:e.substring(e.lastIndexOf("/")+1)},t.viewRef=void 0,t._handleOnFilterChange=t.handleOnFilterChange.bind(l()(t)),t}r()(e,a);var t=e.prototype;return t.handleOnFilterChange=function(){var e=arguments,t=this;setTimeout(function(){t.viewRef&&t.viewRef.active({filterArgs:Array.from(e),questionnaireBoardId:t.state.boardId})},500)},t.render=function(){var t=this,a=this.state.boardId,e=(this.props.boardList?this.props.boardList[d.t.get(d.V.curProject).id]:[]).find(function(e){return e.id===a});return o().createElement(s.Z,{title:o().createElement(c.Z,{titles:[{title:"看板",url:""},{title:e?e.name:"",url:""}]}),expandInfo:{boardId:a},className:"yt_research_sat_boarder_wrapper",pageType:"RESEARCH_BOARD_SATISFACTION",onReady:this._handleOnFilterChange,onChange:this._handleOnFilterChange,noSavingFilterList:!0},o().createElement(u.Z,{ref:function(e){return t.viewRef=e&&e.wrappedInstance}}))},e}(t.Component);const p=(0,n.connect)(function(e){return{boardList:i()({},e)[f].menuList.questionnaireBoards}})(t)},87920:(e,t,a)=>{"use strict";a.d(t,{Z:()=>L});function m(i,e,t){if(0===i.list.length)return"empty";var a=i.list;return{axisPointer:{link:{xAxisIndex:"all"}},title:{text:e},tooltip:{formatter:function(e){return(e||[]).map(function(e){return'<span style="font-weight: bold;font-size: 12px">'+e.name+"</span><br/>"+e.marker+e.seriesName+"："+(null===e.data?"-":e.data)}).join("<br/><br/>")}},xAxis:[{type:"category",data:a.map(function(e){return(0,c.yV)(t,e.time)}),boundaryGap:!1},{type:"category",data:a.map(function(e){return(0,c.yV)(t,e.time)}),gridIndex:1,show:!1,boundaryGap:!1}],yAxis:[{type:"value",name:"满意度",nameTextStyle:{color:"#262626",padding:[0,0,10,0]},minInterval:1,splitNumber:3},{type:"value",axisLine:{show:!1},axisLabel:{show:!1},gridIndex:1,name:"答题数量",nameTextStyle:{color:"#262626"}}],dataZoom:[{type:"slider",show:!0,realtime:!0,xAxisIndex:[0,1],height:16,top:335}],grid:[{left:470,right:50,top:80,height:"32%",tooltip:{trigger:"axis"}},{left:470,right:50,top:265,gridIndex:1,height:"15%",tooltip:{trigger:"axis"}}],graphic:[{type:"text",left:"84",top:"104",silent:!0,style:{text:i.satisfactionValue,fill:"#262626",font:"60px "+s.I8}},{type:"text",left:"84",top:268,silent:!0,style:{text:"答题客户数",fill:"#8C8C8C",font:"14px "+s.I8}},{type:"text",left:"178",top:268,silent:!0,style:{text:i.total,fill:"#262626",font:"14px "+s.I8}}].concat(new Array(5).fill(0).map(function(e,t){return{type:"image",left:83+36*t,top:194,scale:[2,2],style:{image:(a=t+1,n=i.satisfactionValue,t="",t=a<=n?"full":"none",Math.floor(n)!==Number(n)&&Math.floor(n)+1===a&&(t="harf"),d[t].image),width:"14"}};var a,n}),new Array(11).fill(0).map(function(e,t){return{type:"line",shape:{x1:84+16*t,y1:244,x2:90+16*t,y2:244},style:{fill:"#E5E5E5",stroke:"#E5E5E5"},cursor:"none"}})),series:[{data:a.map(function(e){return e.satisfactionValue}),type:"line",smooth:!0,symbol:"circle",symbolSize:2.5,markLine:{symbolSize:0,data:[{type:"average",name:"平均线"}],lineStyle:{color:"#BFBFBF"},label:{show:!1,formatter:"均值"}},lineStyle:{color:"#0074B8"},name:"满意度"},{data:a.map(function(e){return e.questionnaireTotal}),type:"line",smooth:!0,symbol:"circle",symbolSize:2,xAxisIndex:1,yAxisIndex:1,areaStyle:{color:"#E7F1F7"},itemStyle:{color:"#1574B3"},lineStyle:{color:"#1574B3"},name:"答题数量"}]}}var n=a(37316),i=a.n(n),t=a(67154),l=a.n(t),n=a(85354),r=a.n(n),t=a(67294),D=a.n(t),n=a(64396),t=a(55609),o=a(35239),E=a(10291),b=a(17582),w=a(61210),y=a(50976),h=a(8201),v=a(60496),g=a(98191),u=a(43036),s=(a(18446),a(70715)),I=a(94644),c=a(39432),d={none:{image:"data:image/svg+xml;base64,PHN2ZyBpZD0i5Zu+5bGCXzEiIGRhdGEtbmFtZT0i5Zu+5bGCIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDY0IDY0Ij48dGl0bGU+Y2VtPC90aXRsZT48cG9seWdvbiBwb2ludHM9IjMyIDUwLjQ1IDEyLjg0IDYwLjI5IDE2LjUgMzkuNDYgMSAyNC43IDIyLjQyIDIxLjY3IDMyIDIuNzEgNDEuNTggMjEuNjcgNjMgMjQuNyA0Ny41IDM5LjQ2IDUxLjE2IDYwLjI5IDMyIDUwLjQ1IiBmaWxsPSIjZTVlNWU1IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4="},harf:{image:"data:image/svg+xml;base64,PHN2ZyBpZD0i5Zu+5bGCXzEiIGRhdGEtbmFtZT0i5Zu+5bGCIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDY0IDY0Ij48dGl0bGU+Y2VtPC90aXRsZT48cGF0aCBkPSJNNjMsMjQuN2wtMjEuNDItM0wzMiwyLjcxVjUwLjQ1bDE5LjE2LDkuODNMNDcuNSwzOS40NloiIGZpbGw9IiNlNWU1ZTUiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjxwYXRoIGQ9Ik0yMi40MiwyMS42NywxLDI0LjcsMTYuNSwzOS40NiwxMi44NCw2MC4yOSwzMiw1MC40NVYyLjcxWiIgZmlsbD0iI2QwN2I0OSIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+"},full:{image:"data:image/svg+xml;base64,PHN2ZyBpZD0i5Zu+5bGCXzEiIGRhdGEtbmFtZT0i5Zu+5bGCIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDY0IDY0Ij48dGl0bGU+Y2VtPC90aXRsZT48cG9seWdvbiBwb2ludHM9IjMyIDUwLjQ1IDEyLjg0IDYwLjI5IDE2LjUgMzkuNDYgMSAyNC43IDIyLjQyIDIxLjY3IDMyIDIuNzEgNDEuNTggMjEuNjcgNjMgMjQuNyA0Ny41IDM5LjQ2IDUxLjE2IDYwLjI5IDMyIDUwLjQ1IiBmaWxsPSIjZDA3YjQ5IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4="}};const C=function(e){var i=e.data,t=e.dateOptions,a=e.defaultDateType,n=e.setDefaultValue,l=e.flavorObj,r=e.className,o=e.fetchSatisAnalyzeData,e=D().useState(void 0),s=e[0],u=e[1],e=D().useState(void 0),c=e[0],d=e[1],e=D().useState(void 0),f=e[0],p=e[1];return D().useEffect(function(){var e,t;c&&s&&(e=c,(t=s).clear(),t.setOption(e))},[c,s]),D().useEffect(function(){var e;i&&(e=m(i,"满意度",f),d(e))},[i]),D().useEffect(function(){l&&p(t.some(function(e){return e.value===l.satisAnalyze})?l.satisAnalyze:a)},[l,a,t]),D().createElement(h.Z,{data:c,className:"yt_research_analyze_line_chart_wrap "+(r||""),renderTitle:D().createElement(g.Z,{data:c,onMoreClick:function(e){var t,a,n;t=s,a=i,n=void 0,"image"===(e=e)?(0,I._v)(n=t,"满意度分析"):"data"===e&&((n=a.list.map(function(e){return[e.time,e.satisfactionValue||"",e.questionnaireTotal]})).unshift(["日期","满意度","答题数量"]),(0,I.aT)(n=[n],"满意度分析"))},title:"满意度",titleOverlay:"满意度分值的均值"},D().createElement("div",null,D().createElement(v.Z,{onChange:function(e){p(e),o({dateGroupType:e})},activeObj:f,options:t,flavor:(l||{}).satisAnalyze,onFlavorChange:function(e){return n({key:"satisAnalyze",value:e})}})))},D().createElement(y.Z,{theme:"yunting_multi_color",loadingOption:{text:"加载中",color:"#20a0ff"},option:{},opts:{devicePixelRatio:2},style:{width:"100%",height:"100%"},onChartReady:function(e){return u(e)}}))};var f=a(29383);a(98245);var p=[{title:"满意度对比",value:0},{title:"答卷数量对比",value:1}];function x(a,t,n){a&&t&&new Promise(function(e){var t,i;e((t=a,i=n,e=Math.max.apply(Math,t.map(function(e){return e[i?"questionnaireTotal":"satisfactionValue"]})),{title:{text:"各省满意度对比和答题数"},tooltip:{formatter:function(e){var t=e.marker,a=e.data,n=a.name,e=a.value,a=a.other;return[t+'<span style="font-size: 16px; line-height: 30px">'+n+"</span>",(0===i?"满意度：":"答卷数量：")+(0===i&&.99===e?"无":e),(0===i?"答卷数量：":"满意度：")+(0!==i&&.99===a?"无":a)].join("<br/>")}},visualMap:{bottom:20,min:0===i?.99:0,max:0===i?5:0===e?1:e,text:0===i?["5分","1分"]:["高","低"],range:0===i?[1,5]:void 0,inRange:{color:0===i?["#D96969","#0074B8","#15B374"]:["white","#1474B3"]},outOfRange:{color:["white"]},itemWidth:10,itemHeight:80,top:350,left:40},series:[{left:70,type:"map",map:"china",label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{emphasis:{areaColor:"#CDB446"}},data:t.map(function(e){return{name:e.province.replace("省",""),value:0===i?null===e.satisfactionValue?.99:e.satisfactionValue:e.questionnaireTotal,other:0===i?e.questionnaireTotal:null===e.satisfactionValue?.99:e.satisfactionValue}})}]}))}).then(function(e){t.clear(),t.setOption(e)})}const Z=function(e){var l=e.data,t=e.flavorObj,a=e.loading,n=e.setDefaultValue,e=D().useState(void 0),r=e[0],i=e[1],e=D().useState(0),o=e[0],s=e[1];return D().useEffect(function(){x(l,r,o)},[l,r,o]),D().useEffect(function(){s((t||{}).mapAnalyze||0)},[t]),D().createElement(h.Z,{className:"research_analyze_map",renderTitle:D().createElement(g.Z,{data:l,onMoreClick:function(e){var t,a,n,i;t=r,n=l,i=0===(a=e)?"满意度对比":"答卷数量对比",e=void 0,"image"===a?(0,I._v)(e=t,i):"data"===a&&((e=n.map(function(e){return[e.province,e.satisfactionValue||"无",e.questionnaireTotal]})).unshift(["省份","满意度","答题数量"]),(0,I.aT)(e=[e],"各省满意度对比和答题数"))},title:"各省满意度对比和答题数",titleOverlay:D().createElement("div",null,D().createElement("div",null,"收集到满意度的分值题就算1个答题"),D().createElement("div",null,"客户的城市是依据答题访问问卷时获得的IP"),D().createElement("div",null,"地址解析得出"))},D().createElement(v.Z,{onChange:function(e){s(e)},activeObj:o,options:p,flavor:(t||{}).mapAnalyze||null,onFlavorChange:function(e){return n({key:"mapAnalyze",value:e})}})),data:l,defTitle:"各省NPS值对比",loading:a},D().createElement("div",{className:"chart"},D().createElement(y.Z,{theme:"yunting_pos_neu_neg",option:{},style:{width:"100%",height:"100%"},onChartReady:function(e){return i(e)}})),D().createElement("div",{className:"table"},D().createElement(f.Z,{columns:[{label:"省份",prop:"province"},{label:D().createElement("div",{style:{background:"white"}},"满意度",D().createElement(u.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:"满意度分值的均值"},D().createElement("i",{className:"icon-cem_file1"}))),prop:"satisfactionValue",render:function(e){return D().createElement("div",null,e.satisfactionValue||"无")}},{label:"答题数量",prop:"questionnaireTotal"}],data:l,currentPage:1,total:34})))};var T=a(54898);const N=function(e){var t=e.fetchingSatConcerns,a=e.doubleBarChartData,n=e.graphPieChartData,i=e.wordChartData,l=e.fetchSatisAnalyzeData,r=e.satisAnalyzeData,o=e.fetchingSatisCustomerData,s=e.satisCustomerData,u=e.graphicData,c=e.custDataType,d=e.custTimeType,f=e.onFilterChange,p=e.mapData,m=e.dateOptions,y=e.defaultDateType,h=e.flavorObj,v=e.setDefaultValue,g=e.relativeData,I=e.relativeRefreshTime,e=e.relativeDataLoading;return D().createElement("div",{className:"yt_research_satisfaction_analysis_wrapper"},D().createElement(C,{data:r,dateOptions:m,defaultDateType:y,setDefaultValue:v,flavorObj:h,fetchSatisAnalyzeData:l}),D().createElement(E.Z,{loading:o,title:"满意度客户分类",titleOverlay:D().createElement("div",null,D().createElement("div",null,"好评：4分和5分"),D().createElement("div",null,"中评：3分"),D().createElement("div",null,"差评：1分和2分")),type:"SATISFACTION",dateOptions:m,customerData:s,graphicData:u,dataType:c,timeType:d,defaultDateType:y,defaultDataType:h&&h.fCustDataType,setDefaultValue:v,flavorObj:h&&h,onFilterChange:f}),D().createElement(Z,{setDefaultValue:v,flavorObj:h,data:p}),D().createElement(b.Z,{title:"好评客户和差评客户关注点对比",overlay:D().createElement("div",null,D().createElement("div",null,"好评：4分和5分"),D().createElement("div",null,"中评：3分"),D().createElement("div",null,"差评：1分和2分")),positiveTitle:"好评客户",negativeTitle:"差评客户",doubleBarChartData:a,defaultDataType:h&&h.fBarCompareType,setDefaultValue:v,graphPieChartData:n,loading:t}),D().createElement(w.Z,{loading:t,data:i,title:"词频分析"}),D().createElement(T.Z,{title:"词组关联关系分析",data:g,loading:e,refreshTime:I}))};var j=n.Z.research.analyze.satisfaction,n=function(t){function e(e){var a=t.call(this,e)||this;return a._handleOnWsMessage=function(e){var t=e.data;t.type&&"ws"===t.type&&(t=(e=t.payload).type,e=e.result,"QUESTIONNAIRE_TEXT_RESULT"===t&&a.props.save({relativeData:e.data.length?e.data:"empty",relativeRefreshTime:e.createdAt,relativeDataLoading:!1}))},a._handleOnFilterChange=function(e){e.dateGroupType&&a.props.fetchSatisCustomerData({dateGroupType:e.dateGroupType})},a.state={},a.event={onFilterChange:a._handleOnFilterChange},a}r()(e,t);var a=e.prototype;return a.active=function(e){var t=e.filterArgs,a=(e.title,e.questionnaireId),n=e.questionnaireBoardId,e=t[0],t=(t[1],t[2]);this.props.fetchDatas({filterModel:e.filterValue,dateFilter:e.dateFilter,dateOptions:t.dateOptions,defaultDateType:t.defaultDateType,projectId:o.t.get(o.V.curProject).id,questionnaireId:a,questionnaireBoardId:n,pageType:"research_satis"})},a.componentDidMount=function(){window.addEventListener("message",this._handleOnWsMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage),this.props.clear()},a.render=function(){return D().createElement(N,l()({},this.props,this.state,this.event))},e}(D().PureComponent);const L=(0,t.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return l()({},e[j],{fetchingSatConcerns:t.effects[j+"/fetchSatConcerns"]||!1,fetchSatisCustomerData:t.effects[j+"/fetchSatisCustomerData"]||!1})},function(t){return{save:function(e){return t({type:j+"/save",payload:e})},fetchSatisAnalyzeData:function(e){return t({type:j+"/fetchSatisAnalyzeData",payload:e})},setDefaultValue:function(e){return t({type:j+"/setDefaultValue",payload:e})},fetchDatas:function(e){return t({type:j+"/fetchDatas",payload:e})},fetchSatisCustomerData:function(e){return t({type:j+"/fetchSatisCustomerData",payload:e})},clear:function(e){return t({type:j+"/clear",payload:e})}}},null,{withRef:!0})(n)}}]);