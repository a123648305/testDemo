"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5461],{43573:(e,t,n)=>{n.d(t,{Z:()=>W});n(1025);var r=n(65400),a=(n(43378),n(62443)),i=(n(35797),n(64749)),l=n(50361),s=n.n(l),o=n(67294),c=n(34717),d=(n(62713),n(14321)),u=n(30381),f=n.n(u),m="YYYY/MM/DD";const v=function(e){var t=e.value,n=void 0===t?void 0:t,r=e.func,a=e.disabledTimeFuc;return o.createElement(o.Fragment,null,o.createElement(d.default,{allowClear:!1,value:n?f()(n,m):void 0,format:m,style:{width:"291px"},onChange:function(t,n){e.value=n,r()},disabledDate:a||null}))};n(89858);var p=n(51024);const h=function(e,t){var n=e.value,r=(e.id,e.func);return o.createElement(o.Fragment,null,o.createElement(p.default,{value:n,placeholder:"\u8bf7\u8f93\u5165",style:{width:"371px"},onChange:function(t){e.value=t.target.value,r()}}))};const E=function(e,t){var n=e.value,r=e.func,a=e.style,i=e.onChange;return o.createElement(o.Fragment,null,o.createElement(p.default,{value:n,style:a||{width:"291px"},onChange:function(t){var n=t.target.value.replace(/[^\d.-]/g,"");if(n){var a,l=n.split("."),s=l[0],o=l[1],c=n.includes(".");(null==(a=o)?void 0:a.length)>0&&(o=o.replace(/[^\d]/g,"").substring(0,4)),s=s.substring(0,"-"===s[0]?16:15),t.target.value=isNaN(+s)?s:s+(o?"."+o:c?".":"")}else t.target.value=n;i?i(t.target.value):(e.value=t.target.value,r())},placeholder:"\u8bf7\u8f93\u5165\u6570\u5b57"}))};n(77785);var g=n(59361),k=n(15861),y=n(87462),S=(n(9405),n(89552)),L=n(63366),I=n(87757),C=n.n(I),_=n(23279),b=n.n(_),w=n(6406),T=["fetchOptions","debounceTimeout"];function N(e){var t=e.fetchOptions,n=e.debounceTimeout,r=void 0===n?800:n,a=(0,L.Z)(e,T),l=o.useState(!1),s=l[0],c=l[1],d=o.useState([]),u=d[0],f=d[1];o.useEffect((function(){(0,w.Bt)({userName:""}).then((function(e){return f(e.data.result.filter((function(e){return 0!==e.status})).map((function(e){return{label:e.username,value:e.id}})))}))}),[]);var m=o.useRef(0),v=o.useMemo((function(){return b()((function(e){m.current+=1;var n=m.current;f([]),c(!0),t(e).then((function(e){n===m.current&&(f(e),c(!1))}))}),r)}),[t,r]);return o.createElement(i.default,(0,y.Z)({labelInValue:!0,mode:"multiple",tagRender:function(e){return o.createElement(g.default,{style:{backgroundColor:"#F1F3F4",color:"#262626",marginBottom:"2px"},closable:e.closable,onClose:e.onClose},e.label)},filterOption:!1,onSearch:v,notFoundContent:s?o.createElement(S.default,{size:"small"}):null},a,{options:u}))}function R(e){return D.apply(this,arguments)}function D(){return(D=(0,k.Z)(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.Bt)({userName:t}).then((function(e){return e.data.result.filter((function(e){return 0!==e.status})).map((function(e){return{label:e.username,value:e.id}}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}const x=function(e){var t=e.value,n=e.func;return o.createElement(N,{mode:"multiple",value:t||[],placeholder:"\u8bf7\u8f93\u5165",fetchOptions:R,onChange:function(t){var r;r=t,e.value=r,n()},style:{width:"371px"}})};var A=i.default.Option;const O=function(e){var t=e.itemNode,n=e.radioNode,r=e.kind,a=e.func,l=e.checkboxNodes,s=e.value,d=c.Ck[r].items,u=t||n,f=function(t){e.value=t,a()};return"multiple"!==c.Ck[r].mode?o.createElement(o.Fragment,null,u&&o.createElement(i.default,{value:s,style:{width:"371px"},mode:"multiple",placeholder:"\u8bf7\u9009\u62e9",onChange:f,tagRender:function(e){return o.createElement(g.default,{style:{backgroundColor:"#F1F3F4",color:"#262626",marginBottom:"2px"},closable:e.closable,onClose:e.onClose},e.label)}},u.items.map((function(e){return o.createElement(A,{value:e.id,key:e.id},e.value)}))),l&&o.createElement(i.default,{value:s,style:{width:"371px"},mode:"multiple",placeholder:"\u8bf7\u9009\u62e9",onChange:f,tagRender:function(e){return o.createElement(g.default,{style:{backgroundColor:"#F1F3F4",color:"#262626",marginBottom:"2px"},closable:e.closable,onClose:e.onClose},e.label)}},l.map((function(e){return o.createElement(A,{value:e.id,key:e.id},e.value)}))),d&&o.createElement(i.default,{value:s,style:{width:"371px"},placeholder:"\u8bf7\u9009\u62e9",onChange:f},d.map((function(e,t){return o.createElement(A,{value:e.id,key:t},e.value)})))):x(e)};var U="YYYY/MM/DD",M=d.default.RangePicker;const F=function(e,t){var n=e.value,r=e.func,a=e.disabledTimeFuc;return o.createElement(o.Fragment,null,o.createElement(M,{format:U,style:{width:"291px"},allowClear:!1,value:n?[f()(n[0],U),f()(n[1],U)]:[null,null],onChange:function(t,n){e.value=n,r()},disabledDate:a||null}))};n(75314);var j=n(11187);const P={DatePicker:v,InputNumber:E,Select:O,Input:h,RangePicker:F,RangeNumber:function(e,t){var n=e.value,r=e.func,a=function(t,a){var i=n||[null,null],l=1===a?[t,i[1]]:[i[0],t];e.value=l,r(),l[0]&&l[1]&&+l[1]<+l[0]&&j.default.warning("\u6570\u503c\u533a\u95f4\u6709\u8bef")};return o.createElement(o.Fragment,null,o.createElement(E,{value:n?n[0]:null,style:{width:133},onChange:function(e){return a(e,1)}}),o.createElement("span",{style:{margin:"0 6px"}},"\u81f3"),o.createElement(E,{value:n?n[1]:null,style:{width:133},onChange:function(e){return a(e,2)}}))}};var Z=i.default.Option;const W=function(e){var t=e.changeScreenVisible,n=e.screensList,l=e.filtersList,d=e.handlefiltersList,u=e.updatafiltersList,f=e.changeOldFiltersList,m=e.typeContainer,v=e.handleClearFiltersList;return o.createElement("div",{className:"workorder_screen_work_order",id:"workorder_screen_work_order"},o.createElement("div",{className:"screen_header"},o.createElement("span",{className:"header_title"},"\u8bbe\u7f6e\u7b5b\u9009\u6761\u4ef6"),l.length>1&&o.createElement("span",{className:"header_desc"},"\u7b26\u5408\u4ee5\u4e0b\u6240\u6709\u6761\u4ef6")),l.length>=1&&o.createElement("div",{className:"screen_content"},l.length>0&&l.map((function(e,t){return e.func=u,o.createElement("div",{key:t,className:"screen_content_item"},o.createElement(i.default,{value:e.name,placeholder:"\u8bf7\u9009\u62e9",style:{width:"120px",marginRight:"50px"},onChange:function(e,r){!function(e,t,r){var a=s()(l),i=s()(n);a[r]=i[t.key],a[r].value=void 0,i.forEach((function(e){a.map((function(e){return e.id})).includes(e.id)?e.isShow=!1:e.isShow=!0})),d(a,i)}(0,r,t)}},n.map((function(e,t){return e.isShow&&o.createElement(Z,{value:e.id,key:t,type:e.kind},e.name)}))),"board"===m&&"FINISHED_TIME"===e.kind&&o.createElement(a.default,{placement:"top",getPopupContainer:function(){return document.getElementById("workorder_screen_work_order")||document.body},overlayClassName:"tips_popover",content:o.createElement("span",{style:{width:"236px",display:"inline-block"}},"\u770b\u677f\u9690\u85cf\u7ed3\u675f\u65f6\u95f4\u8d85\u8fc77\u5929\u7684\u5de5\u5355\uff0c\u53ea\u80fd\u7b5b\u9009\u8fd17\u5929"),trigger:"hover"},o.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",position:"absolute",top:"10px",left:"130px"}})),"NUMERIC"===e.kind&&o.createElement(a.default,{placement:"top",getPopupContainer:function(){return document.getElementById("workorder_screen_work_order")||document.body},overlayClassName:"tips_popover",content:o.createElement("span",{style:{width:"236px",display:"inline-block"}},"\u6570\u5b57\u6700\u591a\u652f\u630115\u4f4d\u6574\u6570\u30014\u4f4d\u5c0f\u6570"),trigger:"hover"},o.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",position:"absolute",top:"10px",left:"130px"}})),c.rx.includes(e.kind)?o.createElement(i.default,{value:e.timeType,placeholder:"\u8bf7\u9009\u62e9",style:{width:"70px",marginRight:"10px"},onChange:function(e){!function(e,t){var r=s()(l);r[t].timeType=e,("be"===e||"be"!==e&&r[t].value instanceof Array)&&(r[t].value=void 0),d(r,n)}(e,t)}},e.kind&&c.Ck[e.kind].enum.map((function(e,t){return o.createElement(Z,{value:e.value,key:t},e.name)}))):null,"be"===e.timeType?"NUMERIC"===e.kind?P.RangeNumber(e):P.RangePicker(e):P[c.Ck[e.kind].type](e),o.createElement("i",{className:"icon-cem_cancel",style:{marginLeft:"10px",color:"#BEBEBE"},onClick:function(){!function(e){var t=s()(l),r=s()(n);t.splice(e,1),r.forEach((function(e){e.value=void 0,t.map((function(e){return e.id})).includes(e.id)?e.isShow=!1:e.isShow=!0})),d(t,r)}(t)}}))}))),o.createElement("div",{className:"screen_bottom"},o.createElement("div",{className:"add-item"},o.createElement("i",{className:"icon-cem_add-to",style:{color:"#7262fd",fontSize:"18px",position:"relative",top:"2px",left:"-2px"}}),o.createElement("span",{onClick:function(){var e=s()(l).concat([{kind:"TEXT"}]);d(e,n)}},"\u6dfb\u52a0\u7b5b\u9009\u6761\u4ef6")),l.length>0&&o.createElement("span",{className:"clearAll",onClick:function(){v()}},"\u6e05\u7a7a"),o.createElement(r.default,{onClick:function(){t(!1)}},"\u53d6\u6d88"),o.createElement(r.default,{type:"primary",onClick:function(){f(l),t(!1,!0);var e=l.filter((function(e){return e.id&&(Array.isArray(e.value)?e.value.length>0:e.value)}));d(e,n,!0)}},"\u67e5\u8be2")))}},34717:(e,t,n)=>{n.d(t,{MI:()=>r,TL:()=>a,rx:()=>i,Ck:()=>s});var r=["CREATOR","ASSIGNEE","UPDATER","participators","followers","priorityIds"],a=["DATE_TIME","CREATED_TIME","DUE_TIME","UPDATED_TIME","FINISHED_TIME"],i=["DATE_TIME","CREATED_TIME","DUE_TIME","UPDATED_TIME","FINISHED_TIME","NUMERIC"],l=[{name:"\u7b49\u4e8e",id:"1",value:"eq"},{name:"\u65e9\u4e8e",id:"2",value:"ea"},{name:"\u665a\u4e8e",id:"3",value:"af"},{name:"\u4ecb\u4e8e",id:"4",value:"be"}],s={DATE_TIME:{enum:l,type:"DatePicker"},CHECKBOX:{type:"Select"},PRIORITY:{type:"Select"},RADIO:{type:"Select"},NUMERIC:{enum:[{name:"\u7b49\u4e8e",id:"1",value:"eq"},{name:"\u5927\u4e8e",id:"2",value:"ea"},{name:"\u5c0f\u4e8e",id:"3",value:"af"},{name:"\u4ecb\u4e8e",id:"4",value:"be"}],type:"InputNumber"},TEXT:{type:"Input"},RICH_TEXT:{type:"Input"},isFinished:{type:"Select",items:[{id:"true",value:"\u662f"},{id:"false",value:"\u5426"}]},ASSIGNEE:{type:"Select",mode:"multiple"},participators:{type:"Select",mode:"multiple"},followers:{type:"Select",mode:"multiple"},STATE:{type:"Select"},CREATOR:{type:"Select",mode:"multiple"},CREATED_TIME:{enum:l,type:"DatePicker"},DUE_TIME:{enum:l,type:"DatePicker"},UPDATER:{type:"Select",mode:"multiple"},UPDATED_TIME:{enum:l,type:"DatePicker"},FINISHED_TIME:{enum:l,type:"DatePicker"},DESCRIPTION:{type:"Input"},REMARK:{type:"Input"}}},35461:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ae});var r,a,i,l=n(87462),s=n(15861),o=(n(75314),n(11187)),c=n(97326),d=n(94578),u=n(50361),f=n.n(u),m=n(87757),v=n.n(m),p=n(67294),h=(n(9405),n(89552)),E=(n(1025),n(65400)),g=(n(6373),n(82891)),k=(n(43378),n(62443)),y=(n(15086),n(94055)),S=(n(89858),n(51024)),L=(n(54214),n(12386)),I=(n(35797),n(64749)),C=(n(54038),n(36671)),_=function(e){var t=e.searchAssginerValue,n=e.updateSearchValue;return p.createElement(S.default,{placeholder:"\u8bf7\u641c\u7d22",bordered:!1,value:t,onChange:function(e){var t=e.target.value;n(t)},allowClear:!0,style:{width:"210px"}})},b=function(e){var t=e.owner,r=e.cUserList,a=e.userList,i=e.selectUser,l=e.changeUserState,s=e.searchAssginerValue,o=e.updateSearchValue,c=e.clearUserList,d=(0,p.useState)([]),u=d[0],f=d[1],m=(0,p.useState)(),v=m[0],h=m[1],E=(0,p.useState)(),g=E[0],y=E[1],S=(0,p.useState)(!0),L=S[0],I=S[1];return(0,p.useEffect)((function(){var e=a.find((function(e){return e.username.indexOf(s)>=0}));I(e)}),[s]),(0,p.useEffect)((function(){var e=a.find((function(e){return e.id===t})),n=i.filter((function(e){return e.id!==t})).map((function(e){return e})),r=a.filter((function(e){return!n.find((function(t){return t.id===e.id}))&&e.id!==t})).map((function(e){return e}));f([e].concat(n,r))}),[r,i]),p.createElement("div",null,p.createElement("div",{className:"serach-content",onScroll:function(){h(!1)}},L&&p.createElement("span",{className:"search-name"},"\u5904\u7406\u4eba"),p.createElement(p.Fragment,null,u.filter((function(e){return!s||e.username.indexOf(s)>=0})).map((function(e){return p.createElement("div",{className:"search-list",key:e.id,onClick:function(){l(e)}},p.createElement("img",{className:"search-list-img",src:e.userHead||n(7732),alt:""}),p.createElement(k.default,{visible:g===e.id&&v,mouseEnterDelay:.6,content:e.username,overlayClassName:"cUserList_popover",onVisibleChange:function(t){!function(e,t,n){var r=document.createElement("span");r.className="search-list-name",r.style.visibility="hidden",r.style.position="absolute",r.style.zIndex="-1",r.textContent=t,document.body.appendChild(r),r.offsetWidth>110&&(y(e),h(n)),document.body.removeChild(r)}(e.id,e.username,t)}},p.createElement("p",{className:"search-list-name",style:{color:i.find((function(t){return t.id===e.id}))?"#7262fd":"#262626"}},e.username)),i.find((function(t){return t.id===e.id}))&&p.createElement("i",{className:"icon-cem_right1 right"}))}))),!L&&p.createElement(C.default,{image:C.default.PRESENTED_IMAGE_SIMPLE,description:"\u65e0\u641c\u7d22\u7ed3\u679c"})),L&&p.createElement("p",{style:{color:"#7262fd",borderTop:"1px solid #E5E5E5",padding:"8px 20px",fontSize:"12px",cursor:"pointer"},onClick:function(){o(""),c()}},"\u6e05\u7a7a"))},w=n(30579),T=n(61193),N=n(32624),R=n(43573),D=(n(53294),n(56697)),x=n(18446),A=n.n(x);!function(e){e[e.HIGHEST=0]="HIGHEST",e[e.HIGH=1]="HIGH",e[e.MEDIUM=2]="MEDIUM",e[e.LOW=3]="LOW",e[e.LOWEST=4]="LOWEST"}(a||(a={})),function(e){e.PENDING="PENDING",e.PROCESSING="PROCESSING",e.FINISHED="FINISHED"}(i||(i={}));var O=((r={})[i.PENDING]="startStateColor",r[i.PROCESSING]="ingStateColor",r[i.FINISHED]="endStateColor",r),U={ASSIGNEE:"icon-jiaose",CREATOR:"icon-jiaose",UPDATER:"icon-jiaose",CREATED_TIME:"icon-jinhangzhong",UPDATED_TIME:"icon-jinhangzhong",DATE_TIME:"icon-jinhangzhong",RADIO:"icon-cem_single-choice",CHECKBOX:"icon-duoxuan",NUMERIC:"icon-shuzi"},M=n(97448),F=n(40553),j=n(34717),P=n(30381),Z=n.n(P);const W=function(e){var t=e.userInfo,r=e.fileNum,a=e.id,l=e.kind,s=e.title,o=e.assigneeId,c=e.assigneeUserName,d=e.assigneeUserHead,u=e.dueAt,f=e.creatorId,m=e.workOrderMappingResponses,v=e.msgNum,h=e.warningNum,E=e.remarkNum,g=e.priority,y=e.handleEditModalOpen,S=(0,p.useState)(!1),L=S[0],I=S[1],C=function(e){return U[e]||"icon-wenben"};return p.createElement("div",{className:"3"===(null==t?void 0:t.roleId)&&(null==t?void 0:t.id)!==f&&(null==t?void 0:t.id)!==o?"draggable-card drag-disable":"draggable-card",onClick:function(){"function"===typeof y&&y("edit",{id:a,assigneeId:o,creatorId:f})},"data-id":a},p.createElement("div",{onMouseOver:function(){I(!0)},onMouseLeave:function(){I(!1)},className:L?"hover-active kanban-card":"kanban-card"},p.createElement(k.default,{mouseLeaveDelay:0,content:"\u4f18\u5148\u7ea7\uff1a"+(null!=g&&g.name?g.name:"")},p.createElement("div",{className:"kanban-left-border",style:function(){if(g){var e=g.itemNames,t=g.rank;return{background:""+M.d3[e.length][t]}}return{}}()})),p.createElement("div",{className:"card_title"},p.createElement("div",{className:"FINISHED"===l?"card_title_name finished":"card_title_name"},s),p.createElement(k.default,{content:"\u5f53\u524d\u5904\u7406\u4eba\uff1a"+c,overlayClassName:"cUserList_popover"},p.createElement("img",{src:d||n(7732)}))),u&&p.createElement("div",{className:"card_time "+function(e){if(l===i.FINISHED)return"";var t=new Date(e).getTime(),n=(new Date).getTime();return t-n<2592e5?"high":t-n>6048e5?"low":"middle"}(u)},"\u622a\u6b62\u65f6\u95f4\uff1a"+(0,F.C4)(u)),p.createElement("div",null,m&&m.map((function(e,t){return"DUE_TIME"!==e.kind?p.createElement("div",{key:t,className:"card_item"},p.createElement("i",{className:C(e.kind)+" field-icon"}),p.createElement("div",{className:"content"},e.schemaName,"\uff1a",e.schemaValue&&j.TL.includes(e.kind)?Z()(e.schemaValue).format("MM/DD HH:mm"):e.schemaValue&&e.schemaValue.replace(/([,\uff0c\uff0c])/g,"$1 ")||"--")):null}))),(v>0||h>0||E>0||r>0)&&p.createElement("div",{className:"card_footer"},v>0&&p.createElement(k.default,{content:"\u5173\u8054\u7684\u6d88\u606f",overlayClassName:"item_popover"},p.createElement("span",null,p.createElement("i",{className:"icon-huatifenxi special-field-icon"}),v)),h>0&&p.createElement(k.default,{content:"\u5173\u8054\u7684\u9884\u8b66\u901a\u77e5",overlayClassName:"item_popover"},p.createElement("span",null,p.createElement("i",{className:"icon-yujing special-field-icon"}),h)),E>0&&p.createElement(k.default,{content:"\u5907\u6ce8",overlayClassName:"item_popover"},p.createElement("span",null,p.createElement("i",{className:"icon-wenjian special-field-icon"}),E)),r>0&&p.createElement(k.default,{content:"\u6587\u4ef6",overlayClassName:"item_popover"},p.createElement("span",null,p.createElement("i",{className:"icon-cem_file-links special-field-icon"}),r)))))};const H=function(e){return p.createElement("div",{className:"col "+e.classNames},e.children)};var K=n(68855);function B(e){try{return 1===e.nodeType}catch(t){return!1}}function V(e,t){B(e)&&Object.entries(t).forEach((function(t){var n=t[0],r=t[1];e.style.setProperty(n,r)}))}function Y(e,t){if(B(e)){var n=[];"string"===typeof t&&n.push(t),Array.isArray(t)&&(n=t),n.forEach((function(t){e.classList.add(t)}))}}function z(e,t){if(B(e)){var n=[];"string"===typeof t&&n.push(t),Array.isArray(t)&&(n=t),n.forEach((function(t){e.classList.remove(t)}))}}function G(e,t){var n=null;return B(e)&&e.contains(t)&&(n=e.removeChild(t)),n}function q(e,t){B(e)&&!e.contains(t)&&e.appendChild(t)}var $,X,J,Q,ee={draggable:".draggable-item",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",delay:50,group:{name:"shared",put:!0},scroll:!0,direaction:"x",dragMode:"QUEUE",stackTips:"\u677e\u5f00\u653e\u5165\u6b64\u5904",stackDisableTips:"\u8be5\u5de5\u5355\u4e0d\u80fd\u79fb\u52a8\u81f3\u8be5\u72b6\u6001\uff0c\u72b6\u6001\u9700\u4f9d\u6b21\u66f4\u6539"},te=function(){var e=document.createElement("div");return V(e,{left:0,top:"2px",position:"absolute",padding:"16px",width:"100%",height:"100%","z-index":1e3,transition:".18s ease"}),e}(),ne=function(){var e=document.createElement("div");return V(e,{position:"absolute",width:"300px",height:"3px","border-radius":"2px",background:"#7262fd","z-index":1e3,animation:"flashing 0.5s infinite ease-in-out alternate"}),e}(),re=null,ae=null,ie=null,le=null,se={x:0,y:0},oe=!1,ce=!1,de=!1,ue=!1,fe=!1,me=!1,ve={from:void 0,to:void 0,oldIndex:-1,newIndex:-1,clone:void 0,drag:void 0,rankAfterEl:void 0};function pe(e,t){me=!0,ve.clone=e.cloneNode(!0),ve.drag=e,e.classList.add(X.chosenClass),ve.clone.classList.add(X.dragClass);var n=e.getBoundingClientRect();n.width,n.height;Y(ve.drag,"card-hide"),V(ve.clone,{position:"absolute",left:t.x+"px",top:t.y+"px","user-select":"none","z-index":10001}),document.body.appendChild(ve.clone),function(){if(re=document.querySelector(X.verticalScrollContainer),ae=document.querySelector(X.levelScrollContainer),re){var e=re.getBoundingClientRect(),t=e.top,n=e.bottom;ie={top:t,bottom:n}}if(ae){var r=ae.getBoundingClientRect(),a=r.left,i=r.right;le={left:a,right:i}}}()}function he(e){if(z(te,["stack-disable","stack-active"]),"QUEUE"===X.dragMode){var t=ve.from;if(t.previousSibling!==e&&t.nextSibling!==e)return te.textContent=X.stackDisableTips,Y(te,"stack-disable"),!1}return te.textContent=X.stackTips,Y(te,"stack-active"),!0}function Ee(e){var t=ve,n=t.from,r=(t.drag,t.to),a=t.clone;if(n===r){var i=Array.from(n.children);if(!(i.length<=1))for(var l=0;l<i.length;l++){var s=n.children[l];if(l,null==s||!s.classList.contains(X.draggable.replace(".","")))return;var o=s.getBoundingClientRect(),c=(o.left,o.top),d=(o.height,o.bottom),u=n.getBoundingClientRect().top,f=a.getBoundingClientRect(),m=f.height,v=f.top;f.bottom;if(0===l&&c-v>m/3){ve.newIndex=0,s!==ve.drag?(V(ne,{top:0,left:0}),q(n,ne)):G(n,ne);break}if(d>v&&c<v&&d-v<m){ve.rankAfterEl=s,ve.newIndex=l>=ve.oldIndex?l:l+1,s.nextSibling!==ve.drag?(V(ne,{top:d-u-8+"px",left:0}),q(n,ne)):G(n,ne);break}}}else G(n,ne)}function ge(e){if(!oe)return!1;for(var t=0;t<$.length;t++){var n=$[t],r=n.getBoundingClientRect(),a=r.left,i=(r.top,r.width),l=(r.height,a-e.x);if(l>0&&l<i/3||l<0&&l>-i/3){var s=ve,o=s.from,c=(s.to,s.drag);if((null==o?void 0:o.classList)===(null==n?void 0:n.classList))return G(ae,te),ve.to=n,!1;if(null==c?void 0:c.classList.contains(X.filterClass))return"function"===typeof J.onFilter&&!ce&&J.onFilter(),ce=!0,!0;var d=n.parentElement.getBoundingClientRect(),u=(d.top,d.height),f=d.left;V(te,{width:i+"px",display:"block",height:u+2+"px",left:a-f+"px",top:"42px"});var m=he(n);return ve.to=m?n:o,q(ae,te),!0}}return!0}var ke=function(e){de=!0,oe=!1,document.addEventListener("mouseup",Se),window.addEventListener("blur",Se);var t=setTimeout((function(){if(de){oe=!0;var n=(l=X.draggable,B(s=e.target)&&s.closest(l)||!1);if(n){ve.from=ve.to=n.parentElement,ve.newIndex=ve.oldIndex=function(e){if(!B(e))return!1;for(var t=0,n=e;null!=(n=n.previousSibling);)t++;return t}(n),ve.target=n;var r=n.getBoundingClientRect(),a=r.left,i=r.top;se={x:e.clientX-a,y:e.clientY-i},document.addEventListener("mousemove",ye)}else oe=!1,clearTimeout(t)}else oe=!1,clearTimeout(t);var l,s}),X.delay)},ye=function(e){if(oe&&de){var t=e.clientX,n=e.clientY,r=ve.target.getBoundingClientRect(),a=r.left,i=r.top;!me&&pe(ve.target,{x:a,y:i});var l=se,s=t-l.x,o=n-l.y;V(ve.clone,{left:s+"px",top:o+"px"}),function(){var e,t={xScroll:!1,yScroll:!1},n=ve.clone.getBoundingClientRect(),r=n.width,a=n.height,i=n.left,l=n.top,s=le,o=s.left,c=s.right,d=ie,u=d.top,f=d.bottom;if((i<=o||i+r>=c)&&(t.xScroll=!0),(l<=u||l+a>=f)&&(t.yScroll=!0),!t.xScroll&&!t.yScroll)return ue=fe=!1,Q&&window.cancelAnimationFrame(Q),Q=void 0,!1;if(ue&&fe)return!1;Q&&window.cancelAnimationFrame(Q),Q=void 0,ue=fe=!1;var m=i<o?-6:6,v=l<u?-6:6,p=null==(e=ae)?void 0:e.parentElement,h=p.offsetWidth;p.offsetHeight,Q=window.requestAnimationFrame((function e(){if(t.xScroll&&ae){var n=ae,s=n.scrollLeft,d=n.scrollWidth;if(i<=o&&s<=0||i+r>=c&&d-h<=s)return ue=!1,window.cancelAnimationFrame(Q),void(Q=void 0);ue=!0,ae.scrollLeft=ae.scrollLeft+m,ge({x:i,y:l})}if(t.yScroll&&re){var p=re,E=p.scrollTop,g=p.scrollHeight,k=p.offsetHeight;if(l<=u&&E<=0||l+a>=f&&g-k<=E)return fe=!1,X.disabledSort||Ee(),window.cancelAnimationFrame(Q),void(Q=void 0);if(fe=!0,ve.from!==ve.to)return;re.scrollTop=re.scrollTop+v,X.disabledSort||Ee()}Q=window.requestAnimationFrame(e)}))}(),ge({x:s,y:o}),X.disabledSort||Ee()}},Se=function e(t){if(window.cancelAnimationFrame(Q),Q=void 0,G(document.body,ve.clone),G(ve.from,ne),G(ae,te),de=!1,document.removeEventListener("mousemove",ye),document.removeEventListener("mouseup",e),window.removeEventListener("blur",e),me=!1,re=null,ae=null,oe){oe=!1,ce=!1;var n=ve,r=n.from,a=n.to,i=n.oldIndex,l=n.newIndex;if((null==r?void 0:r.classList)===(null==a?void 0:a.classList)&&(z(ve.drag,["card-hide",X.chosenClass]),i!==l)){var s=document.createElement("a");r.children[ve.newIndex].insertAdjacentElement("afterend",s);var o=G(r,ve.drag);o&&(s.insertAdjacentElement("afterend",o),ve.drag=o),r.removeChild(s)}var c=(J||{}).onEnd;"function"===typeof c&&c(f()(ve))}else{var d=(J||{}).onClick;"function"===typeof d&&d(f()(ve))}ve.clone=void 0,ve.from=void 0,ve.to=void 0};const Le=function(e){if(!Array.isArray(e.target))return!1;X=(0,l.Z)({},ee,e.options),J=e.events;return{instances:$=e.target.map((function(e){var t=e.el,n=document.querySelectorAll(t)[0];return n.addEventListener("mousedown",ke,!1),n})),dragCancel:function(){z(ve.drag,["card-hide",X.chosenClass]),ve={}},dragOk:function(){z(ve.drag,["card-hide",X.chosenClass]),ve={}},destory:function(){window.cancelAnimationFrame(Q),Q=void 0,G(document.body,ve.clone),G(ve.from,ne),G(ae,te),de=!1,$=void 0,me=!1,re=null,ae=null,ve={},e.target.forEach((function(e){var t=e.el;document.querySelectorAll(t)[0].removeEventListener("mousedown",ke,!1)})),document.removeEventListener("mousemove",ye),document.removeEventListener("mouseup",Se),window.removeEventListener("blur",Se)},update:function(e){X=(0,l.Z)({},X,e)}}};var Ie=n(6406),Ce=function(e,t){return!(!A()(e.userInfo,t.userInfo)||e.isFilter!==t.isFilter)&&(!(!A()(e.userInfo,t.userInfo)||e.isFilter!==t.isFilter)&&!(!A()(e.cardList,t.cardList)||!A()(e.stateList,t.stateList)))},_e=function(e){var t=e.isFilter,r=e.userInfo,a=e.orderKind,i=e.stateList,s=e.cardList,c=e.handleEditModalOpen,d=e.setCardList,u=e.projectId,f=e.modelKind,m=e.stackSort,v=e.handleRemarkModalOpen,h=(0,p.useRef)(),E=(0,p.useRef)(),k=(0,p.useState)(!1),y=k[0],S=k[1];return(0,p.useEffect)((function(){if(s){E.current=s;var e=!1;Object.values(s).forEach((function(t){(null==t?void 0:t.length)>0&&(e=!0)})),S(e)}}),[s]),(0,p.useEffect)((function(){if(Array.isArray(i)&&0!==i.length&&y){var t=i.map((function(e){return{el:".stack_"+e.id}})),n={onEnd:function(e){var t,n,r=e.from.classList,a=e.to,l=(e.drag,e.oldIndex),s=e.newIndex,o=null!=(t=null==r?void 0:r[r.length-1].replace("stack_",""))?t:void 0,c=null!=(n=null==a?void 0:a.classList[a.classList.length-1].replace("stack_",""))?n:void 0;if(o&&c){o&&(o=+o),c&&(c=+c);var d=i.find((function(e){return e.id===c}));o!==c?d&&d.isRemark?v({fromId:o,fromIndex:l,toId:+a.classList[r.length-1].replace("stack_",""),toIndex:s},h.current):m({fromIndex:l,toIndex:s,toId:c,fromId:o}):l!==s&&m({fromIndex:l,toIndex:s,toId:c,fromId:o},h.current)}},onClick:function(e){},onFilter:function(e){o.default.warning("\u60a8\u6ca1\u6709\u6743\u9650\u53d8\u66f4\u6b64\u5de5\u5355\u72b6\u6001\uff0c\u8bf7\u8054\u7cfb\u5de5\u5355\u521b\u5efa\u4eba\u6216\u5f53\u524d\u5904\u7406\u4eba")}},r={draggable:".draggable-card",filterClass:"drag-disable",verticalScrollContainer:".task-wrapper .task-content",levelScrollContainer:".task-wrapper",disabledSort:"MOVE"!==a,dragMode:f};h.current&&A()(i,e.stateList)?a!==e.dragType&&h.current&&h.current.update({disabledSort:"MOVE"!==a}):h.current?setTimeout((function(){h.current.destory(),h.current=Le({options:r,events:n,target:t})}),100):h.current=Le({options:r,events:n,target:t})}}),[i,y,a]),(0,p.useEffect)((function(){return function(){h.current&&h.current.destory()}}),[]),p.createElement("div",{className:"task-wrapper"},p.createElement("div",{className:"task-header"},Array.isArray(i)&&i.map((function(t){return p.createElement("div",{className:"col-header",key:t.id},p.createElement("span",{className:"title",style:{background:""+M.n0[O[t.kind]]}},t.name),p.createElement("span",{className:"length"},function(t){var n,r,a;return null!=(n=null==(r=e.cardList)||null==(a=r[t])?void 0:a.length)?n:""}(t.id)),T.Z.hasAuthority("DELETED_WORK_ORDER")&&p.createElement(g.default,{overlayClassName:"del_dropdown",trigger:["click"],overlay:p.createElement(L.default,null,p.createElement(L.default.Item,null,p.createElement("p",{style:{cursor:"pointer"},onClick:function(){var e;e=t.id,D.Z.confirm({title:"\u5220\u9664\u5de5\u5355",icon:p.createElement(K.Z,{style:{color:"#FF7955"}}),content:"\u662f\u5426\u786e\u5b9a\u5220\u9664\u8be5\u72b6\u6001\u4e0b\u7684\u6240\u6709\u5de5\u5355\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){(0,Ie.H5)({stateId:e,projectId:u}).then((function(t){if(2e4===t.data.code){o.default.success("\u5220\u9664\u6210\u529f\uff01");var n=(0,l.Z)({},s);n[e]=[],d(n)}else o.default.error(t.data.msg||"\u5220\u9664\u5931\u8d25\uff01")})).catch((function(e){var t;o.default.error((null==e||null==(t=e.data)?void 0:t.msg)||"\u5220\u9664\u5931\u8d25\uff01")}))}})}},"\u6e05\u7a7a\u5de5\u5355")))},p.createElement("span",{className:"more-action"},p.createElement("i",{className:"icon-cem_more-more"}))))}))),p.createElement("div",{className:"task-content",style:{width:function(){var e=i.length;return 300*e+16*(e-1)+48+"px"}()}},Array.isArray(i)&&i.map((function(e){var t=e.id,n=e.kind;return p.createElement(H,{status:t,key:t,classNames:"stack_"+t},null==s?void 0:s[t].map((function(e,t){return e&&p.createElement(W,(0,l.Z)({userInfo:r,key:e.id+"_"+t},e,{kind:n,handleEditModalOpen:c}))})))}))),!y&&(null==i?void 0:i.length)>0&&p.createElement("div",{className:"not-found"},p.createElement("img",{src:n(72400),alt:""}),p.createElement("div",null,t?"\u5f53\u524d\u641c\u7d22\u6761\u4ef6\u4e0b\u6ca1\u6709\u67e5\u8be2\u5230\u5de5\u5355":"\u5c1a\u672a\u521b\u5efa\u5de5\u5355")))};const be=p.memo(_e,Ce);var we=n(33800);const Te=function(e){var t=e.userInfo,n=(e.orderKind,e.stateList),r=e.cardList,a=e.setCardList,i=e.projectId,s=e.modelKind,o=e.orderKind,c=e.handleEditModalOpen,d=e.updateCardList,u=e.handWorkOrderboardDelete,m=e.isFilter,v=(0,p.useRef)(),h=(0,p.useRef)(),E=(0,p.useState)(!1),g=E[0],k=E[1],y=(0,p.useState)({}),S=y[0],L=y[1],I=function(e){var t;null==(t=h.current)||t.dragOk(),h.current=null;var a,l=f()(v.current),s=e.fromId,o=e.toId,c=e.fromIndex,u=e.toIndex,m=e.remark,p=l[s],E=!1,g=null,k=void 0;if(s===o){var y;E=!0,a=p[c].id;var S=null==(y=p.splice(c,1))?void 0:y[0];p.splice(u,0,S);var L=p.findIndex((function(e){return e.id===a}));g=0===L?null:p[L-1].id}else{var I=l[o],C=null==p?void 0:p.splice(c,1)[0],_=n.find((function(e){return e.id===+o}));if(C.stateId=+o,C.kind=_.kind,C&&I.unshift(C),!C)return;k="MOVE",a=C.id}var b={projectId:i,remark:m||"",stateId:o,workOrderId:a,sameState:E,rankAfterId:g,moveOperateKind:k};!g&&E&&(b.rankBeforeId=p[1].id),d({params:b,newCardList:l,oldCardList:r})};return(0,p.useEffect)((function(){v.current=r}),[r]),p.createElement("div",null,p.createElement(be,{userInfo:t,projectId:i,orderKind:o,stateList:n,modelKind:s,cardList:r,stackSort:I,setCardList:a,handleRemarkModalOpen:function(e,t){k(!0),h.current=t,L(e)},handWorkOrderboardDelete:u,handleEditModalOpen:c,isFilter:m}),p.createElement(we.Z,{isShow:g,closeShow:function(){var e;k(!1),null==(e=h.current)||e.dragCancel(),h.current=null},handleSubmitRemark:function(e){k(!1),I((0,l.Z)({},S,{remark:e}))}}))};var Ne=I.default.Option;const Re=function(e){var t=e.isFilter,r=e.projectId,a=e.stateList,i=e.cUserList,s=(e.userList,e.selectUser),o=e.orderKind,c=e.userInfo,d=e.modelKind,u=e.changeUserState,m=e.handWorkOrderboardDelete,v=e.handlekeyword,C=e.onFresh,D=e.screensList,x=e.filtersList,A=e.handlefiltersList,O=e.handleScreenList,U=e.updatafiltersList,M=(e.handleWorkOrderUserList,e.handleOrderBy),F=e.handleChange,j=e.selectType,P=(e.clearUserList,e.loading),Z=e.cardList,W=e.updataCardList,H=e.old_filtersList,K=e.changeOldFiltersList,B=e.keyword,V=e.getKeyWord,Y=e.setCardList,z=e.handleClearFiltersList,G=e.userNumber,q=(0,p.useState)(!1),$=q[0],X=q[1],J=(0,p.useState)(""),Q=J[0],ee=J[1],te=(0,p.useState)(""),ne=te[0],re=te[1],ae=(0,p.useState)(!1),ie=ae[0],le=ae[1],se=(0,p.useState)(void 0),oe=se[0],ce=se[1],de=(0,p.useState)(!1),ue=de[0],fe=de[1],me=(0,p.useState)(""),ve=me[0],pe=me[1];(0,p.useEffect)((function(){return window.addEventListener("click",ge),function(){window.removeEventListener("click",ge)}}),[]);var he=function(e,t){void 0===t&&(t=!1),fe(e),setTimeout((function(){e||t||A(f()(H),D)}),500)},Ee=function(e,t){("new"!==e||T.Z.hasAuthority("ADD_WORK_ORDER"))&&(ee("edit"===e?T.Z.hasAuthority("EDIT_WORK_ORDER")||t.assigneeId===T.Z.getUser().userId||t.creatorId===T.Z.getUser().userId?e:"view":e),"edit"===e&&le(!T.Z.hasAuthority("EDIT_WORK_ORDER")&&t.assigneeId===T.Z.getUser().userId&&t.creatorId!==T.Z.getUser().userId),"edit"===e&&t.id&&re(t.id),X(!0))},ge=function(e){ce(e)},ke=function(e){e.length;return e.filter((function(e){return(e.value instanceof Array&&e.value.length>0||"number"===typeof e.value&&!isNaN(e.value)||"string"===typeof e.value&&e.value)&&void 0!==e.value})).length},ye=p.createElement(L.default,null,p.createElement(L.default.Item,null,p.createElement("p",{style:{fontSize:"12px",color:"#8C8C8C"}},"\u6392\u5e8f")),w.cB.map((function(e){return p.createElement(L.default.Item,{key:e.key,onClick:function(){M(e.key)},style:{color:e.key===o?"#7262fd":"#262626"}},p.createElement("p",{className:"menu_order_list"},p.createElement("span",null,e.title," ")))})));return p.createElement(p.Fragment,null,p.createElement("div",{className:"board-page"},p.createElement(h.default,{spinning:P,size:"large",style:{maxHeight:"800px"}},p.createElement("div",{className:"board-page-header"},p.createElement("div",{className:"board-page-header-left"},p.createElement(I.default,{value:j,style:{width:"160px",marginRight:"10px",height:"28px"},onChange:F,defaultActiveFirstOption:!1,dropdownClassName:"header_select"},w.Fz.map((function(e){return p.createElement(Ne,{key:e.value,value:e.value},e.name)}))),p.createElement(S.default,{placeholder:"\u8bf7\u8f93\u5165",value:B,allowClear:!0,onChange:function(e){V(e.target.value),""===e.target.value&&v("")},suffix:p.createElement("i",{className:"icon-cem_small-search",style:{color:"#BFBFBF",fontSize:"15px"},onClick:function(){v(B)}}),onPressEnter:function(){v(B)},style:{width:"160px",background:"#f8f9fa",height:"28px"}}),p.createElement("div",{className:"board-page-header-imgbox",id:"imgbox"},p.createElement("div",{className:"img_box"},null==i?void 0:i.map((function(e,t){return t<G?p.createElement(y.default,{title:e.username,overlayClassName:"cUserList_popover",placement:"top",mouseEnterDelay:.5},p.createElement("div",{key:e.id,onClick:function(){u(e,"C")},className:s.find((function(t){return t.id===e.id}))?" img-item active":"img-item"},p.createElement("img",{className:s.find((function(t){return t.id===e.id}))?"user_active":"",src:e.userHead||n(7732),alt:""}))):null}))),p.createElement(k.default,{placement:"bottomRight",title:function(){return p.createElement(_,(0,l.Z)({},e,{searchAssginerValue:ve,updateSearchValue:pe}))},content:function(){return p.createElement(b,(0,l.Z)({},e,{searchAssginerValue:ve,updateSearchValue:pe}))},trigger:["click"],overlayClassName:"userList",onVisibleChange:function(e){!e&&pe("")}},p.createElement("span",{className:"more-action"},p.createElement("i",{className:"icon-cem_more-more more-img"}))))),p.createElement("div",{className:"board-page-header-right"},p.createElement(g.default,{overlay:ye,trigger:["click"],overlayClassName:"order_menu",placement:"bottomRight"},p.createElement("div",{className:"sort"===oe?"active sort":"sort",onClick:function(e){e.nativeEvent.stopImmediatePropagation(),ge("sort")}},p.createElement("i",{className:"icon-cem_order",style:{fontSize:"15px",marginRight:"1px"}}),p.createElement("span",null,w.cB.filter((function(e){return e.key===o}))[0]&&w.cB.filter((function(e){return e.key===o}))[0].title))),p.createElement(g.default,{placement:"bottomRight",overlayClassName:"overlayScreen",overlay:function(){return p.createElement(R.Z,{typeContainer:"board",changeScreenVisible:he,screensList:D,filtersList:x,old_filtersList:H,changeOldFiltersList:K,handlefiltersList:A,handleScreenList:O,updatafiltersList:U,handleClearFiltersList:z})},trigger:["click"],visible:ue,onVisibleChange:function(e){he(e)}},p.createElement("div",{className:"screen"===oe||ke(x)>0?"active screen":"screen",onClick:function(e){e.nativeEvent.stopImmediatePropagation(),ge("screen")}},p.createElement("div",null,p.createElement("i",{className:"icon-shaixuan",style:{fontSize:"12px",marginRight:"5px"}}),p.createElement("span",null,"\u7b5b\u9009"),ke(x)>0&&p.createElement("span",{className:"notice"},ke(x))))),T.Z.hasAuthority("ADD_WORK_ORDER")&&p.createElement(E.default,{type:"primary",onClick:function(){return Ee("new")}},"\u521b\u5efa\u5de5\u5355"))),p.createElement(Te,{userInfo:c,projectId:r,orderKind:o,stateList:a,modelKind:d,cardList:Z,setCardList:Y,updataCardList:W,handWorkOrderboardDelete:m,handleEditModalOpen:Ee,updateCardList:e.updateCardList,isFilter:t}))),p.createElement(N.Z,{visible:$,editType:Q,workOrderId:ne,stateList:a,normalAssignee:ie,setVisible:function(e,t){X(e),!e&&re(""),t&&C()}}))};var De=n(35239),xe=localStorage.getItem("__user__");const Ae=function(e){function t(t){var n;return(n=e.call(this,t)||this).events=void 0,n._handleChangeType=function(e){var t=n.state,r=t.owner,a=t.screensList,i=t.ownername,l=t.cUserList,s=t.userList;switch(e){case"1":n.setState({filtersList:[],old_filtersList:[]}),n._clearUserHanlde();break;case"CREATED_TIME":var o=a.filter((function(e){return"CREATED_TIME"===e.kind})),c=Z()().format("YYYY/MM/DD");o[0].value=c,n.setState({filtersList:o,old_filtersList:o}),n._clearUserHanlde();break;case"CREATOR":var d=a.filter((function(e){return"CREATOR"===e.kind})),u=[{label:""+i,value:r,key:r}];d[0].value=u,n.setState({filtersList:d,old_filtersList:d}),n._clearUserHanlde();break;case"ASSGINER":l.map((function(e){return e.id===r?e.checked=!0:e.checked=!1,e})),s.map((function(e){return e.id===r?e.checked=!0:e.checked=!1,e})),n.setState({cUserList:l,userList:s,selectUser:s.filter((function(e){return e.id===r})),filtersList:[],old_filtersList:[]});break;case"participators":n.setState({filtersList:[{kind:"participators",name:"\u53c2\u4e0e\u4eba",id:"ASDSDASD",isSystem:!0,value:[{label:""+i,value:r,key:r}]}],old_filtersList:[{kind:"participators",name:"\u53c2\u4e0e\u4eba",id:"ASDSDASD",isSystem:!0,value:[{label:""+i,value:r,key:r}]}]}),n._clearUserHanlde();break;case"followers":n._clearUserHanlde(),n.setState({filtersList:[{kind:"followers",name:"\u5173\u6ce8\u4eba",id:"euwqickdaspo",isSystem:!0,value:[{label:""+i,value:r,key:r}]}],old_filtersList:[{kind:"followers",name:"\u5173\u6ce8\u4eba",id:"euwqickdaspo",isSystem:!0,value:[{label:""+i,value:r,key:r}]}]})}n.setState({selectType:e,keyword:""}),n._getScreenList()},n._changeOldFiltersList=function(e){n.setState({old_filtersList:f()(e)})},n._handleEditModalState=function(e){var t=n.state.EditModalCallback;t&&t(e),n.setState({isEditModal:!1,EditModalCallback:null})},n._handleShowRemark=function(e){var t,r=e.stateId,a=e.workOrderId,i=e.stateCallbak,l=n.state,s=l.stateList,o=l.projectId;!0===(null==(t=s.find((function(e){return String(e.id)===r})))?void 0:t.isRemark)?n.setState({isShow:!0,isEditModal:!0,stateId:r,workOrderId:a,EditModalCallback:i}):(0,Ie.Lm)({projectId:o,remark:"",stateId:r,workOrderId:a})},n.state={userNumber:5,projectId:De.t.get(De.V.curProject).id,stateList:[],cardList:null,userList:[],remark:void 0,screensList:[],filtersList:[],old_filtersList:[],isShow:!1,loading:!0,stateId:"",workOrderId:"",isEditModal:!1,EditModalCallback:null,owner:encodeURIComponent(JSON.parse(xe).userId),ownername:JSON.parse(xe).username,userInfo:void 0,selectType:"1",cUserList:[],selectUser:[],keyword:"",orderKind:"MOVE",modelKind:"QUEUE",isFilter:!0},n.events={changeUserState:n._changeUserState.bind((0,c.Z)(n)),handWorkOrderboardDelete:n._handWorkOrderboardDelete.bind((0,c.Z)(n)),handlekeyword:n._getkeyword.bind((0,c.Z)(n)),onFresh:n._handleFreshStatusList.bind((0,c.Z)(n)),handleWorkOrderUserList:n._getWorkOrderUserList.bind((0,c.Z)(n)),handlefiltersList:n._handlefiltersList.bind((0,c.Z)(n)),handleScreenList:n._handleScreenList.bind((0,c.Z)(n)),updatafiltersList:n._updatafiltersList.bind((0,c.Z)(n)),closeShow:n._handleCloseShow.bind((0,c.Z)(n)),handleSubmitRemark:n._submitRemark.bind((0,c.Z)(n)),handleOrderBy:n._changeOrderBy.bind((0,c.Z)(n)),handleChange:n._handleChangeType.bind((0,c.Z)(n)),clearUserList:n._clearUserList.bind((0,c.Z)(n)),updateCardList:n._updateCardList.bind((0,c.Z)(n)),changeOldFiltersList:n._changeOldFiltersList.bind((0,c.Z)(n)),getKeyWord:n._handleKeyWord.bind((0,c.Z)(n)),handleClearFiltersList:n._clearFiltersList.bind((0,c.Z)(n)),getWorkOrderList:n.getWorkOrderList.bind((0,c.Z)(n)),setCardList:n.setCardList.bind((0,c.Z)(n))},n}(0,d.Z)(t,e);var n=t.prototype;return n.setCardList=function(e){this.setState({cardList:e})},n.setCardListFormat=function(e,t){void 0===t&&(t=this.state.stateList);var n={};return t.forEach((function(t){var r=e.filter((function(e){return e.stateId===t.id}));n[t.id]=r})),n},n._clearFiltersList=function(){this.setState({filtersList:[]})},n._handleScreenList=function(){var e=this.state,t=e.filtersList,n=e.owner;1===t.length&&"CREATED_TIME"===t[0].kind&&t[0].value&&t[0].value===Z()().format("YYYY/MM/DD")?this.setState({selectType:"CREATED_TIME"}):1===t.length&&"CREATOR"===t[0].kind&&t[0].value[0]&&t[0].value[0].key===n?this.setState({selectType:"CREATOR"}):1===t.length&&"participators"===t[0].kind&&t[0].value[0]&&t[0].value[0].key===n?this.setState({selectType:"participators"}):1===t.length&&"followers"===t[0].kind&&t[0].value[0]&&t[0].value[0].key===n?this.setState({selectType:"followers"}):this.setState({selectType:"1"}),this._getScreenList()},n._handlefiltersList=function(e,t,n){var r=this;t.forEach((function(t){e.map((function(e){return e.id})).includes(t.id)?t.isShow=!1:t.isShow=!0})),this.setState({filtersList:e.map((function(e){return e})),screensList:[].concat(t)},(function(){n&&r._handleScreenList()}))},n._updatafiltersList=function(){var e=this.state.filtersList;this.setState({filtersList:e.map((function(e){return e}))})},n._updateCardList=function(e){var t=this,n=e.params,r=e.newCardList,a=e.oldCardList;this.setState({cardList:r}),(0,Ie.Lm)(n).then((function(e){var n;2e4===(null==e||null==(n=e.data)?void 0:n.code)&&((t.state.filtersList.filter((function(e){return"STATE"===e.kind||"REMARK"===e.kind})).length>0||"MOVE"!==t.state.orderKind)&&t.getWorkOrderList(!0))})).catch((function(e){var n,r=null==e||null==(n=e.data)?void 0:n.code;52012===r&&o.default.warning("\u60a8\u6ca1\u6709\u6743\u9650\u53d8\u66f4\u6b64\u5de5\u5355\u72b6\u6001\uff0c\u8bf7\u8054\u7cfb\u5de5\u5355\u521b\u5efa\u4eba\u6216\u5f53\u524d\u5904\u7406\u4eba"),40010!==r&&40009!==r||o.default.warning("\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u7ba1\u7406\u5458\u66f4\u65b0\u4e86\u5de5\u5355\u72b6\u6001\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u64cd\u4f5c"),t.setState({cardList:a})}))},n._changeOrderBy=function(e){this.setState({orderKind:e}),this._getScreenList()},n._handleCloseShow=function(){this.setState({isShow:!1}),this.state.isEditModal?this._handleEditModalState():this._getScreenList()},n._submitRemark=function(e){var t=this,n=this.state,r=n.projectId,a=n.stateId,i=n.workOrderId;(0,Ie.Lm)({projectId:r,remark:e,stateId:a,workOrderId:i}).then((function(e){t.setState({isShow:!1}),t.state.isEditModal?t._handleEditModalState(!0):t._getScreenList()}))},n._clearUserHanlde=function(){var e=this.state,t=e.cUserList,n=e.userList,r=f()(n).map((function(e){return e.checked=!1,e}));this.setState({userList:r,cUserList:t.map((function(e){return e.checked=!1,e})),selectUser:[],selectType:"1"})},n._clearUserList=function(){var e=(0,s.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._clearUserHanlde();case 2:this._getScreenList();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n._changeUserState=function(e,t){var n=this.state,r=n.userList,a=n.cUserList,i=n.owner,s=n.selectUser,o=n.userNumber,c=f()(r),d=f()(a),u=f()(s),m=(0,l.Z)({},e,{checked:!e.checked});if(t){if("C"===t){var v=d.findIndex((function(e){return e.id===m.id})),p=u.findIndex((function(e){return e.id===m.id}));if(-1!==p?u.splice(p,1):(u.splice(m.id===i?0:1,0,m),v>=0||(d.splice(1,0,m),d.splice(o,1))),p>=0&&u.length>o&&m.id!==i){var h=u.reverse().find((function(e){return!d.find((function(t){return e.id===t.id&&t.id!==i}))}));h&&d.splice(o,0,h),d.splice(v,1)}}}else{var E=u.findIndex((function(e){return e.id===m.id})),g=d.findIndex((function(e){return e.id===m.id}));if(E<0)u.splice(m.id===i?0:1,0,m),g<0&&(d.splice(o,1),d.splice(1,0,m));else if(u.splice(E,1),u.length+1>o){var k=u.reverse().find((function(e){return!d.find((function(t){return e.id===t.id&&t.id!==i}))}));k&&d.splice(o,0,k),d.splice(g,1)}}this.setState({cUserList:d,userList:c,selectUser:u,selectType:1===u.length&&u[0].id===i?"ASSGINER":"1",filtersList:[],old_filtersList:[]}),this._getScreenList()},n.onChangeRemarks=function(e){var t=e.target.value;this.setState({remark:t})},n._getWorkOrderUserList=function(e){var t=this;void 0===e&&(e="");var n=this.state.cUserList;return new Promise((function(r,a){(0,Ie.Bt)({userName:e}).then((function(e){if(2e4===e.data.code){var i=e.data.result.filter((function(e){return 0!==e.status})).map((function(e){return n.length>0&&n.forEach((function(t){t.id===e.id&&(e.checked=t.checked)})),e}));t.setState({userList:i}),r(!0)}else a(!1)}))}))},n._handWorkOrderboardDelete=function(e){var t=this,n=this.state.projectId;(0,Ie.H5)({stateId:e,projectId:n}).then((function(e){t._getScreenList()}))},n._handleKeyWord=function(e){this.setState({keyword:e||""})},n._getkeyword=function(e){this.setState({keyword:e||""}),this._getScreenList()},n._fetchWorkOrderSchemaList=function(){var e=this,t=this.state.projectId;return new Promise((function(n,r){(0,Ie.vt)({projectId:t}).then((function(t){if(2e4===t.data.code){var a=t.data.result;e.setState({screensList:a.filter((function(e){return e.isShow=!0,j.rx.includes(e.kind)&&(e.timeType="eq"),"WARNING"!==e.kind&&"MESSAGE"!==e.kind&&"ATTACHMENT"!==e.kind&&"ASSIGNEE"!==e.kind})).concat([{kind:"participators",name:"\u53c2\u4e0e\u4eba",isSystem:!0,isShow:!0,id:"ASDSDASD"},{kind:"followers",name:"\u5173\u6ce8\u4eba",isSystem:!0,isShow:!0,id:"euwqickdaspo"}]).map((function(e){return"FINISHED_TIME"===e.kind&&(e.disabledTimeFuc=function(e){return e<Z()().subtract("7","days")||e>Z()()}),e}))}),setTimeout((function(){e._getDefaultValue().then((function(){n(!0)}))}),500)}else r(!1)}))}))},n.handleScreenfieds=function(){var e=this.state,t=e.filtersList,n=e.keyword,r=e.orderKind,a=f()(t),i={customRule:[],keyword:n,orderKind:r};a.forEach((function(e){if(j.MI.includes(e.kind))e.value=e.value?e.value.map((function(e){return e.value})).join(","):"";else if(j.rx.includes(e.kind)&&"NUMERIC"!==e.kind){var t=e.value?Z()(e.value).format("YYYY-MM-DD"):"";if(!t)return void(e.value="");"eq"===e.timeType?e.value=t+","+t:"ea"===e.timeType?e.value=","+t:"af"===e.timeType?e.value=t+",":"be"===e.timeType?e.value=e.value.map((function(e){return Z()(e).format("YYYY-MM-DD")})).join(","):e.value=t+","+t}else if("STATE"===e.kind||"PRIORITY"===e.kind&&"NUMERIC"===e.kind)e.value=e.value?e.value.join(","):"";else if("NUMERIC"===e.kind){var n=e.value?e.value:"";if(!n)return void(e.value="");"eq"===e.timeType?e.value=n+","+n:"af"===e.timeType?e.value=","+n:"ea"===e.timeType?e.value=n+",":"be"===e.timeType?e.value=e.value.join(","):e.value=n+","+n}}));var l=a.filter((function(e){return!e.isSystem})).map((function(e){return{key:e.id,kind:e.kind,value:e.value?""+e.value:""}}));return i.customRule=l,a.filter((function(e){return e.isSystem&&w.WI[e.kind]})).forEach((function(e){i[""+w.WI[e.kind]]=e.value||""})),i},n.handlequeryCriteria=function(){var e=this.state,t=e.selectUser,n=e.keyword,r=e.selectType,a=e.orderKind,i=e.cUserList,l=e.userList,s=e.filtersList,o=e.userNumber,c=e.projectId,d=e.owner,u=t.map((function(e){return e.id})),f=this.handleScreenfieds();return u.length>0&&(f.assignees=f.assignees?f.assignees+","+Array.from(new Set(u)).join(","):""+Array.from(new Set(u)).join(",")),this.setState({isFilter:t.length>0||n||"1"!==r||s.length>0}),De.t.set(De.V.ticket,{owner:d,projectId:c,keyword:n,selectType:r,orderKind:a,cUserList:i,userList:l,selectUser:(0,w.dU)(t),filters:s,userNumber:o}),f},n.getWorkOrderList=function(e){var t=this;void 0===e&&(e=!1),e&&this.setState({loading:!0});var n=this.handlequeryCriteria();(0,Ie.Vk)((0,w.Dz)(n),this.state.projectId).then((function(e){if(2e4===e.data.code){var n=e.data.result;t.setState({cardList:t.setCardListFormat(n,t.state.stateList),loading:!1})}else t.setState({loading:!1})}))},n._getScreenList=function(e){var t=this;void 0===e&&(e=!0),setTimeout((function(){t._getWorkOrderScreenList(t.handlequeryCriteria(),e)}),500)},n._getWorkOrderScreenList=function(e,t){var n=this;void 0===t&&(t=!0);var r=this.state,a=r.projectId,i=r.screensList,l=r.filtersList,s={};this.setState({loading:t}),(0,Ie.sR)({projectId:a,key:"WORK_ORDER_FILTER",value:JSON.stringify({filters:l})}),Promise.all([(0,Ie.PH)({projectId:a}),(0,Ie.Vk)((0,w.Dz)(e),a),(0,Ie.Mp)({projectId:a,userId:this.state.owner})]).then((function(e){var t=e[0],r=e[1],a=e[2];if(2e4===t.data.code){var l=t.data.result;l.forEach((function(e){s[""+e.id]=e.name})),n.setState({STATUS_CODE:s,stateList:l}),i.forEach((function(e){"STATE"===e.kind&&(e.checkboxNodes=l.map((function(e){return{id:e.id,value:e.name}})))}))}if(2e4===r.data.code){var o=r.data.result;n.setState({cardList:n.setCardListFormat(o,t.data.result),screensList:[].concat(i),loading:!1})}else n.setState({loading:!1});var c=document.getElementsByClassName("task-wrapper-content")[0];c&&(c.scrollTop=0),2e4===a.data.code&&n.setState({userInfo:a.data.result})})).catch((function(e){o.default.error((null==e?void 0:e.data.msg)||"\u83b7\u53d6\u5de5\u5355\u6570\u636e\u5931\u8d25")})).finally((function(){n.setState({loading:!1})})),(0,Ie.Kz)({projectId:a}).then((function(e){2e4===e.data.code&&n.setState({modelKind:e.data.result.modelKind})}))},n._getDefaultValue=function(){var e=this;return new Promise((function(t,n){var r=e.state,a=r.projectId,i=r.screensList,l=r.owner,s=De.t.get(De.V.ticket);s&&s.projectId===a&&s.owner===l?(e.setState({keyword:s.keyword,selectType:s.selectType,orderKind:s.orderKind,cUserList:s.cUserList,userList:s.userList,selectUser:(0,w.dU)(s.selectUser),filtersList:f()(s.filters),old_filtersList:f()(s.filters),userNumber:s.userNumber}),(!s.cUserList||s.cUserList.length<=0)&&e._getWorkOrderUserList(),t(!0)):(De.t.remove(De.V.ticket),(0,Ie.oG)({projectId:a,key:"WORK_ORDER_FILTER"}).then((function(r){if(2e4===r.data.code){var a=r.data.result;if(a){var s=JSON.parse(a).filters.filter((function(e){var t=i.filter((function(t){return t.id===e.id}));return t.length>0&&(e=Object.assign(e,t[0].timeType=e.timeType)),t.length>0})).map((function(e){var t=e.itemNode&&e.itemNode.items||e.checkboxNodes;return t&&e.value&&e.value.length>0&&(e.value=e.value.filter((function(e){var n=t.filter((function(t){return t.id===e}));return n.length>0&&(e=Object.assign(e,n[0])),n.length>0}))),e})),o=s.filter((function(e){return e.value&&e.value.length>0||0===e.value})),c="1";1===o.length&&"ASDSDASD"===o[0].id&&o[0].value[0].value===l?c="participators":1===o.length&&"euwqickdaspo"===o[0].id&&o[0].value[0].value===l&&(c="followers"),e.setState({filtersList:f()(s),old_filtersList:f()(s),screensList:i.map((function(e){return s.forEach((function(t){e.id===t.id&&(e.isShow=!1)})),e})),selectType:s.filter((function(e){return e.value&&e.value.length>0||0===e.value})).length>0?c:"ASSGINER"})}else{var d=["DUE_TIME","CREATED_TIME","PRIORITY"];e.setState({filtersList:i.filter((function(e){return d.includes(e.kind)})),old_filtersList:f()(i.filter((function(e){return d.includes(e.kind)}))),screensList:i.map((function(e){return d.includes(e.kind)?e.isShow=!1:e.isShow=!0,e})),selectType:"ASSGINER"})}t(!0)}else n(!1)})))}))},n._handleFreshStatusList=function(){this._getWorkOrderScreenList(this.handlequeryCriteria(),!1)},n.initFilterValue=function(){var e=this;return Promise.all([this._fetchWorkOrderSchemaList(),this._getWorkOrderUserList()]).then((function(t){var n=t[0],r=t[1];n&&r&&(De.t.get(De.V.ticket)||e.resize(),e._getScreenList())}))},n.componentDidMount=function(){var e=this;this.initFilterValue(),window.addEventListener("resize",(function(){e.resize()}))},n.resize=function(){var e=this.state,t=e.userList,n=e.selectType,r=e.selectUser,a=(e.cUserList,e.owner),i=5;i=document.body.offsetWidth<=1400?5:10;var l=t.filter((function(e){return!r.find((function(t){return t.id===e.id}))&&e.id!==a}));"ASSGINER"===n&&(t[0].checked=!0,r.push(t[0])),this.setState({userNumber:i,userList:[].concat(t),cUserList:[t[0]].concat(r.filter((function(e){return e.id!==a})),l).splice(0,i),selectUser:(0,w.dU)(r)})},n.componentWillUnmount=function(){var e=this;De.t.remove(De.V.ticket),window.removeEventListener("resize",(function(){e.resize}))},n.render=function(){return p.createElement(Re,(0,l.Z)({},this.props,this.state,this.events))},t}(p.Component)},30579:(e,t,n)=>{n.d(t,{WI:()=>r,Fz:()=>a,cB:()=>i,Dz:()=>l,dU:()=>s});const r={STATE:"stateIds",CREATOR:"creators",CREATED_TIME:"created",ASSIGNEE:"assignees",DUE_TIME:"due",PRIORITY:"priorityIds",UPDATER:"updaters",UPDATED_TIME:"updated",FINISHED_TIME:"finished",DESCRIPTION:"description",participators:"participators",followers:"followers",REMARK:"remark",isFinished:"isFinished"},a=[{name:"\u6240\u6709\u5de5\u5355",value:"1"},{name:"\u4eca\u65e5\u5de5\u5355",value:"CREATED_TIME"},{name:"\u6211\u8d1f\u8d23\u7684",value:"ASSGINER"},{name:"\u6211\u521b\u5efa\u7684",value:"CREATOR"},{name:"\u6211\u53c2\u4e0e\u7684",value:"participators"},{name:"\u6211\u5173\u6ce8\u7684",value:"followers"}],i=[{title:"\u6309\u624b\u52a8\u62d6\u62fd\u6392\u5e8f",key:"MOVE"},{title:"\u6309\u622a\u6b62\u65f6\u95f4\u6700\u8fd1",key:"DUE_CLOSEST"},{title:"\u6309\u66f4\u65b0\u65f6\u95f4\u6700\u65b0",key:"UPDATED_LATEST"},{title:"\u6309\u66f4\u65b0\u65f6\u95f4\u6700\u65e9",key:"UPDATED_EARLIEST"},{title:"\u6309\u521b\u5efa\u65f6\u95f4\u6700\u65b0",key:"CREATED_LATEST"},{title:"\u6309\u521b\u5efa\u65f6\u95f4\u6700\u65e9",key:"CREATED_EARLIEST"},{title:"\u6309\u4f18\u5148\u7ea7\u6700\u9ad8",key:"PRIORITY_HIGHEST"}],l=(e,t="customRules")=>{const n=[];for(const r in e)if(e.hasOwnProperty(r)&&e[r]instanceof Array&&"customRule"===r){const a=e[r].map(((e,n)=>{let r="";for(const a in e)r+=`${encodeURIComponent(`${t}[${n}].${a}`)}=${encodeURIComponent(`${e[a]||""}`)}&`;return r.substring(0,r.length-1)}));n.push(a.join("&"))}else n.push(`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`);return n.join("&")},s=(e,t="id")=>{const n={};return e.reduce(((e,r)=>(!n[r.id]&&(n[r[t]]=e.push(r)),e)),[])}},72400:(e,t,n)=>{e.exports=n.p+"font/87b44dfe73677a67de07.svg"}}]);