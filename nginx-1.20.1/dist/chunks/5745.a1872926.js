"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5745],{95745:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L,dispatchToProps:()=>_,mapStateToProps:()=>I});var a=n(63366),l=n(87462),r=n(94578),o=n(55609),i=n(67294),s=n(81907),c=n(35239),u=(n(1025),n(65400)),p=(n(89858),n(51024)),d=(n(15144),n(2307)),m=(n(48145),n(40987)),h=(n(43378),n(62443)),f=(n(75314),n(11187)),g=(n(35797),n(64749)),C=(n(53294),n(56697)),y=n(55815),v=n(63682),E=n(96889),S=n(68855),N=n(38064),k=n(30381),x=n.n(k),w=n(61409);const b=function(e){function t(t){var n;return(n=e.call(this,t)||this).onDeleteTag=function(e){e.tagData&&e.tagData.length&&C.Z.confirm({icon:i.createElement(S.Z,{style:{fontSize:"20px",color:"#FF7955"}}),title:"\u5220\u9664\u6807\u7b7e",className:"yt_Customerjourney_delete_tag_modal",content:i.createElement(g.default,{mode:"multiple",optionFilterProp:"label",options:e.tagData.map((function(e){return{label:e.name,value:e.id}})),placeholder:"\u8bf7\u9009\u62e9\u4f60\u8981\u5220\u9664\u7684\u6807\u7b7e",allowClear:!1,showArrow:!0,suffixIcon:i.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c",cursor:"pointer"}}),onChange:function(e){n.setState({deletedTags:e})}}),onOk:function(){var t;(null==(t=n.state.deletedTags)?void 0:t.length)&&n.props.fetchBatchAddTag({journeyIds:[e.id],tagIds:e.tagData.map((function(e){return e.id})).filter((function(e){var t;return-1===(null==(t=n.state.deletedTags)?void 0:t.indexOf(e))})),isCover:!0})},onCancel:function(){n.setState({deletedTags:[]})}})},n.onSwitchChange=function(e,t){n.props.journeyList;var a=n.state;a.pageIndex,a.pageSize;e?n.props.fetchStatusChange({id:t,status:"ENABLE"}).then((function(e){2e4===e.code&&(f.default.success("\u64cd\u4f5c\u6210\u529f"),n.setState({pageIndex:1}),n.props.onFilterChange({pageIndex:1}))})):C.Z.confirm({icon:i.createElement(S.Z,{style:{fontSize:"20px",color:"#FF7955"}}),title:"\u505c\u7528\u65c5\u7a0b",content:"\u505c\u7528\u540e\uff0c\u76f8\u5173\u7528\u6237\u5c06\u770b\u4e0d\u5230\u6b64\u65c5\u7a0b\u3002",className:"yt_Customerjourney_delete_tag_modal",onOk:function(){n.props.fetchStatusChange({id:t,status:"DISABLE"}).then((function(e){2e4===e.code&&(f.default.success("\u64cd\u4f5c\u6210\u529f"),n.setState({pageIndex:1}),n.props.onFilterChange({pageIndex:1}))}))}})},n.onDelete=function(e){var t=n.props.journeyList,a=n.state,l=a.pageIndex,r=a.pageSize;C.Z.confirm({icon:i.createElement(S.Z,{style:{fontSize:"20px",color:"#FF7955"}}),title:"\u5220\u9664\u65c5\u7a0b",content:"\u786e\u5b9a\u8981\u5220\u9664\u8be5\u65c5\u7a0b\uff1f",className:"yt_Customerjourney_delete_tag_modal",onOk:function(){n.props.fetchDelete({id:e}).then((function(e){2e4===e.code&&(f.default.success("\u64cd\u4f5c\u6210\u529f"),n.props.onFilterChange({pageIndex:1}))})),1===t.slice((l-1)*r,l*r).length&&n.setState({pageIndex:l-1})}})},n.onSelectChange=function(e){n.setState({selectedRowKeys:e})},n.onCancel=function(){n.setState({visible:!1,selectedTags:[]})},n.onConfirm=function(){var e=n.state,t=e.selectedTags,a=e.selectedRowKeys;n.props.fetchBatchAddTag({journeyIds:a,tagIds:(0,v.HV)(t,n.props.tagList)}).then((function(e){2e4===e.code&&n.onCancel()}))},n.onSelect=function(e){var t=n.props.tagList;""!==e.trim()&&-1===t.findIndex((function(t){return t.name===e}))&&-1===t.findIndex((function(t){return t.id===e}))&&n.props.fetchAddTag({name:e})},n.state={columns:[{title:"",width:"1%"},{title:"\u540d\u79f0",dataIndex:"name",width:"20%",render:function(e,t){return"ENABLE"===t.status?i.createElement("span",{className:"ellipsis",style:{color:"ENABLE"===t.status?"#1890ff":"#262626",cursor:"pointer"},onClick:function(){w.mW.push({pathname:"/customerJourney/introduce",state:{journeyId:t.id}})}},e):i.createElement("span",{className:"ellipsis"},e)}},{title:"\u521b\u5efa\u4eba",dataIndex:"creator",width:"15%"},{title:"\u6700\u65b0\u4fee\u6539\u65f6\u95f4",dataIndex:"updatedAt",width:"15%",render:function(e){return x()(e).format("YYYY/MM/DD HH:mm")}},{title:"\u6807\u7b7e",dataIndex:"tagData",width:"25%",render:function(e,t){return i.createElement("div",{className:"col-tags"},t.tagData&&t.tagData.length?t.tagData.reduce((function(e,t,n,a){return t.name?(n<3?e.push(i.createElement(h.default,{placement:"top",overlayClassName:"popup-tags",content:t.name,getPopupContainer:function(e){return e.parentNode}},i.createElement("span",{key:t.id,title:t.name,className:"tag"},t.name.length>6?t.name.substring(0,6)+"...":t.name))):3===n&&e.push(i.createElement(h.default,{overlayClassName:"popup-tags",content:a.slice(3).map((function(e){return e.name})).join("\u3001"),placement:"top",getPopupContainer:function(e){return e.parentNode}},i.createElement("span",{key:"more"},"..."))),e):e}),[]):i.createElement("div",{style:{margin:6}},"--"))}},{title:"\u662f\u5426\u542f\u7528",dataIndex:"status",width:"12%",render:function(e,t){return i.createElement(h.default,{content:"ENABLE"===e?"\u5df2\u542f\u7528":"\u5df2\u505c\u7528",mouseEnterDelay:.4,getPopupContainer:function(e){return e.parentNode}},i.createElement(m.Z,{checked:"ENABLE"===e,onChange:function(e){return n.onSwitchChange(e,t.id)}}))}},{title:"\u64cd\u4f5c",width:"16%",dataIndex:"operate",render:function(e,t){return i.createElement("span",{className:"operate"},i.createElement("span",{onClick:function(){w.mW.push({pathname:"/customerJourney/introduce",query:{type:1},state:{journeyId:t.id}})}},"\u7f16\u8f91"),i.createElement("span",{onClick:function(){return n.onDelete(t.id)}},"\u5220\u9664"),i.createElement("span",{className:t.tagData&&t.tagData.length?"":"disabled",onClick:function(){return n.onDeleteTag(t)}},"\u5220\u9664\u6807\u7b7e"))}}],selectedRowKeys:[],pageIndex:1,pageSize:10,visible:!1,selectedTags:[],deletedTags:[]},n}return(0,r.Z)(t,e),t.prototype.render=function(){var e=this,t=this.state,n=t.columns,a=t.selectedRowKeys,l=t.pageIndex,r=t.pageSize,o=t.visible,s=t.selectedTags,c=this.props,m=c.onFilterChange,h=c.name,f=c.save,S=c.tagList,k=c.tags,x=c.journeyList,b=c.listLoading,O=c.fetchDeleteTag,T={selectedRowKeys:a,onChange:this.onSelectChange,selections:[d.Z.SELECTION_ALL,d.Z.SELECTION_INVERT,d.Z.SELECTION_NONE]};return i.createElement("div",{className:"yt_customerJourney_manage_wrapper"},i.createElement(y.Z,{title:(0,v.uT)({title:"\u65c5\u7a0b\u7ba1\u7406"})}),i.createElement("div",{className:"container"},i.createElement("div",{className:"content"},i.createElement("div",{className:"table_top"},i.createElement("div",null,i.createElement(p.default,{placeholder:"\u641c\u7d22\u65c5\u7a0b\u540d\u79f0",allowClear:!0,suffix:i.createElement("i",{className:"icon-cem_small-search",onClick:function(){e.setState({pageIndex:1}),m({name:h})}}),onPressEnter:function(){e.setState({pageIndex:1}),m({name:h})},onChange:function(t){f({name:t.target.value}),""===t.target.value&&(e.setState({pageIndex:1}),m({name:t.target.value}))},value:h,style:{height:28,width:160}}),i.createElement(N.Z,{options:S,onChange:function(t){e.setState({pageIndex:1}),m({tags:t})},showClearBtn:!0,title:"\u65c5\u7a0b\u6807\u7b7e",value:k,showClearOpt:{show:!0,name:"\u5220\u9664\u540e\uff0c\u6240\u6709\u65c5\u7a0b\u90fd\u4e0d\u663e\u793a\u6b64\u6807\u7b7e"},onClearOpt:O})),i.createElement("div",null,i.createElement(u.default,{disabled:!a.length,onClick:function(){e.setState({visible:!0})}},"\u6279\u91cf\u6dfb\u52a0\u6807\u7b7e"),i.createElement(u.default,{type:"primary",onClick:function(){w.mW.push("/customerJourney/introduce?type=1")}},"\u65b0\u5efa"))),i.createElement(E.ZP,{tableLayout:"fixed",rowSelection:T,columns:n,dataSource:x,loading:b,rowKey:"id",search:!1,options:!1,tableAlertRender:!1,toolBarRender:!1,pagination:{total:x.length,current:l,pageSize:r},onChange:function(t){r!==t.pageSize?e.setState({pageIndex:1,pageSize:t.pageSize}):e.setState({pageSize:t.pageSize,pageIndex:t.current})}}),i.createElement(C.Z,{className:"yt_customerJourney_manage_addTag_modal",width:480,title:"\u6279\u91cf\u6dfb\u52a0\u6807\u7b7e",visible:o,onCancel:this.onCancel,onOk:this.onConfirm},i.createElement("span",null,"\u6807\u7b7e"),i.createElement(g.default,{mode:"tags",options:S.map((function(e){return{label:e.name,value:e.name}})),placeholder:"\u8bf7\u9009\u62e9\u6216\u8f93\u5165\u6807\u7b7e",allowClear:!1,showArrow:!0,suffixIcon:i.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c",cursor:"pointer"}}),value:s,onBlur:function(t){return e.onSelect(t.target.value)},onChange:function(t){e.setState({selectedTags:Array.from(new Set(t.filter((function(e){return""!==e.trim()}))))})},onSelect:this.onSelect})))))},t}(i.Component);var O=["loading"],T=function(e){function t(t){var n;return(n=e.call(this,t)||this).events=void 0,n._handleOnFilterChange=function(e){e.tags||e.pageIndex?n.props.fetchJourneyList((0,l.Z)({},e,{name:n.props.name})):void 0!==e.name&&n.props.fetchJourneyList(e)},n.state={},n.events={onFilterChange:n._handleOnFilterChange},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.fetchJourneyList({projectId:c.t.get(c.V.curProject).id}),this.props.fetchTagList({projectId:c.t.get(c.V.curProject).id})},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return i.createElement(b,(0,l.Z)({},this.props,this.state,this.events))},t}(i.PureComponent),I=function(e){var t=e.loading,n=(0,a.Z)(e,O);return(0,l.Z)({},n[s.namespace],{listLoading:t.effects[s.namespace+"/fetchJourneyList"]||!1})},_=function(e){return{save:function(t){return e({type:s.namespace+"/save",payload:t})},clean:function(){return e({type:s.namespace+"/clean"})},fetchJourneyList:function(t){return e({type:s.namespace+"/fetchJourneyList",payload:t})},fetchTagList:function(t){return e({type:s.namespace+"/fetchTagList",payload:t})},fetchAddTag:function(t){return e({type:s.namespace+"/fetchAddTag",payload:t})},fetchDeleteTag:function(t){return e({type:s.namespace+"/fetchDeleteTag",payload:t})},fetchBatchAddTag:function(t){return e({type:s.namespace+"/fetchBatchAddTag",payload:t})},fetchStatusChange:function(t){return e({type:s.namespace+"/fetchStatusChange",payload:t})},fetchDelete:function(t){return e({type:s.namespace+"/fetchDelete",payload:t})}}};const L=(0,o.connect)(I,_)(T)},38064:(e,t,n)=>{n.d(t,{Z:()=>f});n(43378);var a=n(62443),l=(n(89858),n(51024)),r=n(87462),o=(n(1025),n(65400)),i=n(94578),s=n(92360),c=n(67294),u=n(45697),p=n.n(u),d=n(94184),m=n.n(d),h=n(43061),f=function(e){function t(t){var n;return(n=e.call(this,t)||this).togglePanel=function(e){var t=n.state,a=t.panelShow;t.value,t.filteredOptions;a&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){return n.setState({panelShow:!a})}),0)},n.handleClear=function(){n.setState({tempValue:[]},(function(){return n.handleCheckAllStatus()})),n.props.onClear&&n.props.onClear()},n.handleCheckAllStatus=function(){var e=n.state,t=e.tempValue,a=e.filteredOptions;n.setState({allChecked:t.length>0&&t.length===a.length,indeterminate:t.length>0&&t.length<a.length})},n.handleConfirm=function(){var e=n.state.tempValue;n.setState({value:JSON.parse(JSON.stringify(e)),panelShow:!1}),n.props.onChange(e)},n.handleCancel=function(){var e=n.state,t=e.value,a=e.filteredOptions;n.setState({tempValue:JSON.parse(JSON.stringify(t)),panelShow:!1,popoverVisible:!1,popoverIndex:-1,allChecked:t&&t.length>0&&t.length===a.length,indeterminate:t&&t.length>0&&t.length<a.length},(function(){return n.handleClearInput()}))},n.handleReset=function(){n.setState({tempValue:[],value:[],panelShow:!1,searchText:""},(function(){return n.handleCheckAllStatus()}))},n.handleFilter=function(e){var t=e.target.value,a=n.state.options;if(t.trim().length>0){var l=a.filter((function(e){return e.name.toUpperCase().includes(t.toUpperCase())}));n.setState({searchText:t,filteredOptions:l})}else n.setState({filteredOptions:a,searchText:t})},n.handleClearInput=function(){var e=n.state,t=e.searchText,a=e.options;t.length>0&&n.setState({searchText:"",filteredOptions:a},(function(){return n.handleCheckAllStatus()}))},n.handlePopoverVisibleChange=function(e,t){n.setState({popoverVisible:e,popoverIndex:e?t:-1})},n.getDeleteContent=function(e){var t=n.state.popoverVisible,a=n.props,l=a.showClearOpt,r=a.onClearOpt;return c.createElement("div",{style:{maxWidth:140}},c.createElement("p",null,l.name),c.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},c.createElement(o.default,{size:"small",onClick:function(e){e.stopPropagation(),n.setState({popoverVisible:!t})}},"\u53d6\u6d88"),c.createElement(o.default,{type:"primary",size:"small",onClick:function(a){a.stopPropagation(),r({id:e.id}).then((function(e){2e4===e.code&&n.setState({popoverVisible:!t})}))}},"\u786e\u5b9a")))},n.state={type:t.type||2,title:t.title||"",options:[],filteredOptions:[],tempValue:t.defaultValue||[],value:t.defaultValue||[],maxLength:t.maxLength||0,indeterminate:!1,allChecked:!1,panelShow:!1,searchText:"",placeholder:t.placeholder||"\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u8bcd",showClearBtn:t.showClearBtn||!1,popoverVisible:!1,popoverIndex:-1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){window.addEventListener("click",this.handleCancel)},t.getDerivedStateFromProps=function(e,t){var n=e.type,a=e.title,l=e.options,r=e.value;return n!==t.type?{type:n}:a!==t.title?{title:a}:JSON.stringify(l)!==JSON.stringify(t.options)?{options:l||[],filteredOptions:l||[]}:Array.isArray(r)&&JSON.stringify(r)!==JSON.stringify(t.value)?{value:r||[],tempValue:r||[],allChecked:r&&r.length>0&&r.length===t.filteredOptions.length,indeterminate:r&&r.length>0&&r.length<t.filteredOptions.length}:null},n.componentWillUnmount=function(){window.removeEventListener("click",this.handleCancel)},n.handleCheckAll=function(){var e=this,t=this.state,n=t.tempValue,a=t.filteredOptions;this.setState({tempValue:n.length===a.length?[]:a.map((function(e){return e.id}))},(function(){return e.handleCheckAllStatus()}))},n.handleCheckOne=function(e){var t=this,n=this.state,a=n.tempValue,l=n.maxLength;if(l>0&&(a.length>=l&&a.includes(e)||a.length<l)||0===l){var r=a.indexOf(e);r>-1?a.splice(r,1):a.push(e),this.setState({tempValue:a},(function(){return t.handleCheckAllStatus()}))}},n.render=function(){var e=this,t=this.state,n=t.type,i=t.title,u=t.options,p=t.filteredOptions,d=t.indeterminate,f=t.allChecked,g=t.panelShow,C=t.tempValue,y=t.value,v=t.maxLength,E=t.style,S=t.searchText,N=t.popoverVisible,k=t.popoverIndex,x=u.length>0?u.filter((function(e){return y.includes(e.id)})).map((function(e){return e.name})):[],w=m()({"multi-select-wrapper":!0,whiteBg:1===n,sel:g}),b=n&&1===n?"\u8bf7\u9009\u62e9":"\u5168\u90e8",O=this.props,T=O.note,I=O.showClearOpt;return c.createElement("div",{className:w,style:(0,r.Z)({backgroundColor:g?"#7262fd":""},E),onClick:this.togglePanel},c.createElement("span",null,i&&i+"\uff1a"),c.createElement("span",{className:"currValue",title:x.length>0?x.length===u.length?"\u5168\u90e8":x.join("\uff0c"):b},x.length>0?x.length===u.length?"\u5168\u90e8":x.join("\uff0c"):b),c.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:g?"rotate(-180deg)":"",top:g?"-2px":"3px"}}),c.createElement("div",{className:"multi-select-panel",style:{display:g?"block":"none"},onClick:function(e){return e.stopPropagation()}},c.createElement("div",{className:"multi-select-header"},c.createElement(l.default,{ref:function(t){return e.input=t},value:S,onChange:this.handleFilter,placeholder:this.state.placeholder,suffix:S.length>0?c.createElement(h.Z,{onClick:this.handleClearInput}):c.createElement("i",{className:"icon-cem_small-search"}),style:{height:28}})),c.createElement("ul",{className:"multi-select-panel-body"},p.length>0?c.createElement(c.Fragment,null,0===v&&c.createElement("li",{className:"all_check",onClick:function(){return e.handleCheckAll()}},c.createElement("div",{className:"all_select"},c.createElement(s.Checkbox,{checked:f,indeterminate:d,onChange:function(){return e.handleCheckAll()}}),c.createElement("label",null,"\u5168\u9009"))),p.slice(0,100).map((function(t,n){return c.createElement("li",{key:n,className:v>0&&C.length>=v&&!C.includes(t.id)?"disabled":"",onClick:function(){return e.handleCheckOne(t.id)},style:{minHeight:T?"50px":"36px"}},c.createElement(s.Checkbox,{disabled:v>0&&C.length>=v&&!C.includes(t.id),checked:C.includes(t.id),value:t.id,onChange:function(){return e.handleCheckOne(t.id)}}),c.createElement("label",{title:t.name},t.name),I&&I.show&&c.createElement(a.default,{placement:"top",content:function(){return e.getDeleteContent(t)},mouseEnterDelay:.4,trigger:"click",visible:N&&k===n,onVisibleChange:function(t){return e.handlePopoverVisibleChange(t,n)}},c.createElement("i",{className:"icon-cem_delete",onClick:function(t){t.stopPropagation(),e.setState({popoverVisible:!N})}})),T&&c.createElement("p",{className:"note"},T(t)))})),p.length>99&&c.createElement("li",{className:"no_data",style:{color:"#d96969",paddingLeft:"18px",fontSize:"12px"}},"\u2014 \u67e5\u770b\u66f4\u591a\u8bf7\u641c\u7d22")):c.createElement("li",{className:"no_data"},"\u6682\u65e0\u6570\u636e")),c.createElement("div",{className:"multi-select-panel-footer"},this.state.showClearBtn&&c.createElement("div",{className:"clearBtn",onClick:this.handleClear},"\u6e05\u9664"),c.createElement(o.default,{onClick:this.handleCancel},"\u53d6\u6d88"),c.createElement(o.default,{type:"primary",onClick:this.handleConfirm},"\u786e\u8ba4"))))},t}(c.Component);f.propTypes={type:p().number,title:p().string.isRequired,options:p().arrayOf(p().shape({id:p().oneOfType([p().string,p().number]),name:p().string})),defaultValue:p().arrayOf(p().string),value:p().arrayOf(p().string),maxLength:p().number,onChange:p().func.isRequired,style:p().object,note:p().func,placeholder:p().string,showClearBtn:p().bool,showClearOpt:p().object,onClearOpt:p().func}},55815:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),l=n(67294),r=n(45697),o=n.n(r),i=n(43036),s=n(61409),c=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return(t=e.call.apply(e,[this].concat(a))||this)._handleBreadcrumbClick=function(e){var n=t.props,a=n.title,l=n.beforeJump;e!==a.length-1&&(l?new Promise((function(e,t){return l(e,t)})).then((function(){s.mW.push({pathname:a[e].url,state:a[e].state})})):s.mW.push({pathname:a[e].url,state:a[e].state}))},t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,a=t.mainTitle,r=t.rightContent,o=t.className,s=t.overlay;return l.createElement("div",{className:"breadcumb-wrapper "+o},n instanceof Array?l.createElement("div",{className:"breadcrumb-left"},l.createElement("div",null,n.map((function(t,a){return l.createElement("span",{className:t.url?"":"not_clickable",key:a,onClick:function(){return t.url&&a!==n.length-1&&e._handleBreadcrumbClick(a)}},t.title,a!==n.length-1&&" / ")}))),l.createElement("span",null,a||n[n.length-1].title,s&&l.createElement(i.Z,{placement:"top",overlay:s},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):l.createElement("div",{className:"normal-title"},n,s&&l.createElement(i.Z,{placement:"top",overlay:s},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),r||"")},t}(l.Component);c.propTypes={className:o().string,title:o().oneOfType([o().string,o().arrayOf(o().shape({title:o().string,url:o().string,state:o().object}))]).isRequired,overlay:o().oneOfType([o().string,o().node]),mainTitle:o().oneOfType([o().string,o().node]),beforeJump:o().func,rightContent:o().node};const u=c}}]);