"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8762],{78762:(t,e,a)=>{a.r(e),a.d(e,{default:()=>I});var n=a(63366),r=a(87462),o=a(94578),i=a(67294),l=(a(98620),a(10149)),s=a(39432),c=["\u5168\u90e8\u5de5\u5355","\u5f85\u5904\u7406","\u8fdb\u884c\u4e2d","\u5df2\u7ed3\u675f"];const u=function(t){var e=t.data,a=t.loading;return i.createElement(l.default,{active:!0,loading:a},i.createElement("div",{className:"yt_warning_statistics_card"},null==e?void 0:e.map((function(t,e){return a=t,n=c[e],i.createElement("div",{className:"card_item"},i.createElement("h2",null,a?(0,s.uf)(a):"--"),i.createElement("span",null,n));var a,n}))))};a(15267);var d=a(64713),f=a(50976),h=a(70715),m=a(30381),p=a.n(m),Y=a(87300),v=function(t){var e=Math.max.apply(Math,t),a=4*Math.ceil(e/4);return{intVal:Math.ceil(e/4),maxVal:a}},y=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).chartRef=void 0,e.getChartRef=function(t){return e.chartRef=t},e.getData=function(t){return t.map((function(t){return{name:t.name,value:t.count}}))},e.getOption=function(t,a,n,r){var o=[null==a?void 0:a.map((function(t){return t.createdCount})),null==a?void 0:a.map((function(t){return t.finishedCount}))],i=t.priorityItems,l=t.stateItems,c=["\u521b\u5efa\u7684\u5de5\u5355","\u5df2\u7ed3\u675f\u7684\u5de5\u5355"],u={title:{text:n,top:14},series:[{type:"pie",smooth:!0,datasetIndex:0,hoverOffset:0,center:["17%","33%"],radius:["14%","20%"],itemStyle:{smooth:!0,normal:{borderWidth:0,borderColor:"#fff",smooth:!0},emphasis:{borderWidth:0,shadowBlur:0,shadowOffsetX:0}},label:{show:!0,position:"outside",color:"#262626",formatter:function(t){var e=t.name,a=t.value,n=t.percent;return[e.length>8?e.substr(0,8)+"...":""+e,"{value|"+(0,s.hE)(a)+" \uff08"+n.toFixed(2)+"%\uff09}"].join("\n")},rich:{value:{fontSize:12,lineHeight:18,color:"#262626",align:"left"}}},labelLine:{show:!0,smooth:!0,length:18},avoidLabelOverlap:!0,data:e.getData(i)}].concat("division"===r?null==i?void 0:i.map((function(t,e){return{name:t.name,type:"bar",stack:"total",emphasis:{focus:"series"},data:null==l?void 0:l.map((function(t){return t.priorityItems[e].count})),barWidth:24,itemStyle:{color:h.OW[e]}}})):[{type:"bar",data:null==l?void 0:l.map((function(t){return t.count})),itemStyle:{color:"#1890ff"},barWidth:24}],null==a?void 0:a.map((function(t,e){return{type:"line",name:c[e],smooth:!0,showSymbol:!0,symbolSize:1,data:o[e],xAxisIndex:1,yAxisIndex:1,itemStyle:{color:h.OW[e]}}}))),grid:[{top:120,bottom:400,left:"35%",right:48,containLabel:!0},{top:560,bottom:16,left:32,right:48,containLabel:!0}],graphic:{elements:[{type:"text",top:66,left:20,silent:!0,style:{text:"\u5de5\u5355\u4f18\u5148\u7ea7",fill:"#262626",font:"400 14px "+h.I8}},{type:"text",top:66,left:"35%",silent:!0,style:{text:"\u5de5\u5355\u72b6\u6001\u5206\u5e03",fill:"#262626",font:"400 14px "+h.I8}},{type:"text",top:492,left:20,silent:!0,style:{text:"\u5de5\u5355\u6570\u91cf",fill:"#262626",font:"400 14px "+h.I8}}]},legend:[{top:90,left:16,right:"68%",itemWidth:10,itemHeight:10,type:"scroll",itemGap:16,data:e.getData(i).map((function(t){return t.name})),icon:"circle"},{top:516,left:16,right:48,itemWidth:10,itemHeight:10,type:"scroll",itemGap:16,data:c,icon:"circle"}],xAxis:[{type:"category",data:null==l?void 0:l.map((function(t){return t.name})),nameTextStyle:{color:"#626262"},axisPointer:{type:"none",label:{show:!1}},axisLabel:{interval:0,rotate:0}},{type:"category",data:null==a?void 0:a.map((function(t){return p()(t.date).format("YYYY/MM/DD")})),boundaryGap:!1,nameTextStyle:{color:"#626262"},axisPointer:{type:"line",label:{show:!1}},gridIndex:1}],yAxis:[{type:"value",axisLabel:{color:"#8C8C8C",formatter:function(t){return(0,s.hE)(t)}},axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}},splitNumber:4,max:v(null==l?void 0:l.map((function(t){return t.count}))).maxVal,interval:v(null==l?void 0:l.map((function(t){return t.count}))).intVal},{type:"value",axisLabel:{color:"#8C8C8C"},axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}},splitNumber:4,gridIndex:1,max:v(o.flat()).maxVal,interval:v(o.flat()).intVal}],tooltip:{trigger:"axis",position:function(t,e,a,n,r){return[t[0]+24,t[1]-a.clientHeight]},showDelay:50,hideDelay:0,confine:!0,enterable:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px; box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",formatter:function(t,e,a){if(t.length)return setTimeout((function(){var n=t[0].axisValue,r="",o=t.map((function(t){var e=t.marker,a=t.seriesName,n=t.data,o=t.name;return{name:"<div style='display: flex;justify-content: space-between;align-items: center;color: #8c8c8c;line-height: 2;'><div><span style='vertical-align: bottom'>"+e+"</span>"+((r=a).includes("series")?o:a)+"</div><div style='color: #262626;margin-left: 10px;'>"+(0,s.uf)(n)+"</div></div>",value:n}})),i=o.map((function(t){return t.name})),l=r.includes("series")?null:'<span style="font-size: 12px; color: #262626; font-weight: 400;">'+n+"</span>";a(e,(0,Y.r)(l,i))}),0)}}};return u},e}return(0,o.Z)(e,t),e.prototype.renderChart=function(t,e,a,n){this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,e,a,n))},e}(i.PureComponent),D=a(8201),g=a(98191),M=[{label:i.createElement("i",{className:"icon-zhuzhuang"}),value:"group"},{label:i.createElement("i",{className:"icon-duidietu"}),value:"division"}];const C=function(t){function e(e){var a;return(a=t.call(this,e)||this).internalId=void 0,a.chartLeaveTimeout=void 0,a.state=void 0,a.onChange=function(t){var e=t.target.value;a.setState({echartsValue:e})},a.state={echartsValue:""},a}(0,o.Z)(e,t);var a=e.prototype;return a.componentDidMount=function(){var t=this;this.internalId=setInterval((function(){if(t.chartRef){clearInterval(t.internalId),t.renderChart();var e=t.chartRef._dom.children,a=e[0],n=e[1];a.addEventListener("mouseleave",(function(e){t.chartLeaveTimeout=setTimeout((function(){t.chartLeaveTimeout&&(n.style.display="none")}),2e3)})),n&&n.addEventListener("mouseenter",(function(e){t.chartLeaveTimeout=void 0}))}}),200)},a.componentDidUpdate=function(t,e){var a=t.data,n=t.count,r=this.props,o=r.data,i=r.count,l=e.echartsValue,s=this.state.echartsValue;((0,D.P)(o)&&JSON.stringify(a)!==JSON.stringify(o)||(0,D.P)(i)&&JSON.stringify(n)!==JSON.stringify(i)||(0,D.P)(s)&&JSON.stringify(l)!==JSON.stringify(s))&&this.renderChart(),!(0,D.P)(o)&&this.chartRef&&(this.chartRef=void 0)},a.renderChart=function(){var e=this.props,a=e.data,n=e.title,r=e.count,o=this.state.echartsValue;(0,D.P)(a)&&this.chartRef&&0!==a.length&&t.prototype.renderChart.call(this,a,r,n,o)},a.render=function(){var t=this.props,e=t.title,a=t.loading,n=t.data;return i.createElement(D.Z,{className:"yt_warning_statistics_chart workorder_chart",data:n,loading:a,renderTitle:i.createElement(g.Z,{title:e,data:n},i.createElement(d.default.Group,{options:M,onChange:this.onChange,defaultValue:"group",optionType:"button"}))},i.createElement(f.Z,{onChartReady:this.getChartRef,theme:"yt_multi_color_10",option:{},style:{width:"100%",height:"100%"}}))},e}(y);var x=a(88332);const b=function(t){var e=t.cardData,a=t.chartData,n=t.dateType,r=t.onFilterChange,o=t.fetchingCardData,l=t.fetchingChartData,s=t.onSearch,c=t.workOrderCount;return i.createElement("div",{className:"yt_warning_statistics_wrapper"},i.createElement(x.Z,{onChange:function(){return s()},nowDate:1}),i.createElement(u,{data:e,loading:o}),i.createElement(C,{data:a,count:c,title:"\u6570\u636e\u6982\u51b5",loading:l,dateType:n,onFilterChange:r}))};var O=a(55609),w=a(64396),S=a(35239),k=["loading"],_=w.Z.workOrder.statistics,E=w.Z.IDBHeaderScreening.quickTimeScreening,V=function(t){function e(e){var a;return(a=t.call(this,e)||this).events=void 0,a._handelSearch=function(){var t=a.props.dateFilter,e=t.from,n=t.to;a.props.fetchDatas({projectId:S.t.get(S.V.curProject).id,startDate:e,endDate:n})},a._handleOnFilterChange=function(t){t.dateType&&a.props.fetchChartData(t)},a.state={},a.events={onFilterChange:a._handleOnFilterChange,onSearch:a._handelSearch},a}(0,o.Z)(e,t);var a=e.prototype;return a.componentDidMount=function(){var t=this;this.props.init({type:"WORK_ORDER_STATISTICS",nowDate:1}).then((function(){var e=t.props.dateFilter,a=e.from,n=e.to;t.props.fetchDatas({projectId:S.t.get(S.V.curProject).id,startDate:a,endDate:n})}))},a.componentWillUnmount=function(){this.props.clean()},a.render=function(){return i.createElement(b,(0,r.Z)({},this.props,this.state,this.events))},e}(i.Component);const I=(0,O.connect)((function(t){var e=t.loading,a=(0,n.Z)(t,k);return(0,r.Z)({},a[_],{dateFilter:a[E].dateFilter,fetchingCardData:e.effects[_+"/fetchCardData"]||!1,fetchingChartData:e.effects[_+"/fetchChartData"]||!1})}),(function(t){return{save:function(e){return t({type:_+"/save",payload:e})},clean:function(){return t({type:_+"/clean"})},fetchDatas:function(e){return t({type:_+"/fetchDatas",payload:e})},fetchCardData:function(e){return t({type:_+"/fetchCardData",payload:e})},fetchChartData:function(e){return t({type:_+"/fetchChartData",payload:e})},init:function(e){return t({type:E+"/init",payload:e})}}}))(V)},88332:(t,e,a)=>{a.d(e,{Z:()=>D});var n=a(87462),r=a(63366),o=(a(62713),a(14321)),i=(a(15267),a(64713)),l=a(94578),s=a(64396),c=a(55609),u=a(87219),d=a(30381),f=a.n(d),h=a(67294),m=a(70339),p=["loading"],Y=s.Z.IDBHeaderScreening.quickTimeScreening,v="YYYY/MM/DD",y=function(t){function e(e){var a;(a=t.call(this,e)||this)._handleOnQuickDateChange=function(t){var e,n=t.target.value,r=a.props,o=r.type,i=r.dateFilter,l=r.nowDate;if("week"!==n&&"month"!==n)a.setState({analyzeDate:(0,m.vc)(t.target.value,v,l)[0]+" ~ "+(0,m.vc)(t.target.value,v,l)[1]}),e=(0,u.ZP)(i,(function(e){e.from=(0,m.vc)(t.target.value,"YYYY-MM-DD",l)[0],e.numOfDays=(0,m.vv)((0,m.vc)(t.target.value,"YYYY-MM-DD",l),"YYYY-MM-DD"),e.quickChoice=m.YM.find((function(t){return t.value===n})).label,e.to=(0,m.vc)(t.target.value,"YYYY-MM-DD",l)[1],e.date=n}));else if("week"===n){var s=f()().format("E");a.setState({analyzeDate:f()().subtract(s-1,"days").format(v)+" ~ "+f()().add(7-s,"days").format(v)}),a.props.save({dateValue:f()()}),e=(0,u.ZP)(i,(function(t){t.from=f()().subtract(s-1,"days").format("YYYY-MM-DD"),t.numOfDays=(0,m.vv)([f()().subtract(s-1,"days").format("YYYY-MM-DD"),f()().add(7-s,"days")],"YYYY-MM-DD"),t.quickChoice=f()().subtract(s-1,"days").format("YYYY.MM.DD")+" - "+f()().add(7-s,"days").format("YYYY.MM.DD"),t.to=f()().add(7-s,"days").format("YYYY-MM-DD"),t.date=n}))}else"month"===n&&(a.setState({analyzeDate:f()().startOf("month").format(v)+" ~ "+f()().endOf("month").format(v)}),a.props.save({dateValue:f()()}),e=(0,u.ZP)(i,(function(t){t.from=f()().startOf("month").format("YYYY-MM-DD"),t.numOfDays=(0,m.vv)([f()().startOf("month").format("YYYY-MM-DD"),f()().endOf("month").format("YYYY-MM-DD")],"YYYY-MM-DD"),t.quickChoice=f()().startOf("month").format("YYYY.MM.DD")+" - "+f()().endOf("month").format("YYYY.MM.DD"),t.to=f()().endOf("month").format("YYYY-MM-DD"),t.date=n})));a.props.save({date:n,dateFilter:e}),a.props.setDefaultValue({key:"default-time-"+o,value:JSON.stringify(e)}),setTimeout((function(){a.props.onChange()}),0)},a._handleOnDateChange=function(t,e){var n,r=a.props,o=r.date,i=r.type,l=r.dateFilter;if("week"===o){var s=f()(t).format("E");a.setState({analyzeDate:f()(t).subtract(s-1,"days").format(v)+" ~ "+f()(t).add(7-s,"days").format(v)}),n=(0,u.ZP)(l,(function(e){e.from=f()(t).subtract(s-1,"days").format("YYYY-MM-DD"),e.numOfDays=(0,m.vv)([f()(t).subtract(s-1,"days").format("YYYY-MM-DD"),f()(t).add(7-s,"days").format("YYYY-MM-DD")],"YYYY-MM-DD"),e.quickChoice=f()(t).subtract(s-1,"days").format("YYYY.MM.DD")+" - "+f()(t).add(7-s,"days").format("YYYY.MM.DD"),e.to=f()(t).add(7-s,"days").format("YYYY-MM-DD")}))}else"month"===o&&(a.setState({analyzeDate:f()(e).startOf("month").format(v)+" ~ "+f()(e).endOf("month").format(v)}),n=(0,u.ZP)(l,(function(t){t.from=f()(e).startOf("month").format("YYYY-MM-DD"),t.numOfDays=(0,m.vv)([f()(e).startOf("month").format("YYYY-MM-DD"),f()(e).endOf("month").format("YYYY-MM-DD")],"YYYY-MM-DD"),t.quickChoice=f()(e).startOf("month").format("YYYY.MM.DD")+" - "+f()(e).endOf("month").format("YYYY.MM.DD"),t.to=f()(e).endOf("month").format("YYYY-MM-DD")})));a.props.setDefaultValue({key:"default-time-"+i,value:JSON.stringify(n)}),a.props.save({dateFilter:n,dateValue:f()(t)}),setTimeout((function(){a.props.onChange()}),0)};var n=e.dateFilter,r=e.nowDate;return a.state={analyzeDate:n&&n.date?"week"===n.date||"month"===n.date?f()(n.from).format(v)+" ~ "+f()(n.to).format(v):(0,m.vc)(n.date,v,r)[0]+" ~ "+(0,m.vc)(n.date,v,r)[1]:(0,m.vc)("7",v)[0]+" ~ "+(0,m.vc)("7",v,r)[1]},a}(0,l.Z)(e,t);var a=e.prototype;return a.componentDidUpdate=function(t){var e=t.dateFilter,a=(t.date,t.dateValue,this.props),n=a.dateFilter,r=(a.date,a.dateValue,a.nowDate);JSON.stringify(e)!==JSON.stringify(n)&&n&&this.setState({analyzeDate:"week"===n.date||"month"===n.date?f()(n.from).format(v)+" ~ "+f()(n.to).format(v):(0,m.vc)(n.date,v,r)[0]+" ~ "+(0,m.vc)(n.date,v,r)[1]})},a.render=function(){var t=this.props,e=t.date,a=t.dateValue,n=this.state.analyzeDate;return h.createElement("div",{className:"filter_quick_date_wrapper"},h.createElement("span",{className:"time"},"\u7edf\u8ba1\u65f6\u95f4\uff1a ",n),h.createElement(i.default.Group,{value:e,onChange:this._handleOnQuickDateChange},m.YM.map((function(t){return h.createElement(i.default.Button,{value:t.value,key:t.value},t.label)}))),h.createElement(o.default,{allowClear:!1,value:a,onChange:this._handleOnDateChange,format:"week"===e?"YYYY/wo":"YYYY/MM",placeholder:"\u8bf7\u9009\u62e9\u65f6\u95f4",className:"filter_quick_date",size:"small",picker:"week"===e||"month"===e?e:"month",disabled:"week"!==e&&"month"!==e,suffixIcon:h.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c"}})}))},e}(h.PureComponent);const D=(0,c.connect)((function(t){t.loading;var e=(0,r.Z)(t,p);return(0,n.Z)({},e[Y])}),(function(t){return{save:function(e){return t({type:Y+"/save",payload:e})},clean:function(){return t({type:Y+"/clean"})},setDefaultValue:function(e){return t({type:Y+"/setDefaultValue",payload:e})}}}))(y)}}]);