"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[37],{50707:(e,t,n)=>{n.d(t,{Z:()=>v});n(53294);var a=n(56697),r=(n(9405),n(89552)),l=(n(1025),n(65400)),c=(n(57780),n(73818)),o=(n(75314),n(11187)),s=n(87462),i=n(94578),u=(n(1131),n(28465)),m=n(67294),p=n(96651),d=n(39432),f=u.Z.Dragger,h={visible:!1,steps:1,file:null,tags:[],allSetTags:[],newSetTags:[],fileTest:!0,fileResult:null,dragenter:!1,uploading:!1},v=function(e){function t(t){var a;return(a=e.call(this,t)||this).show=function(){a.state.visible?a.setState((0,s.Z)({},Object.assign({},h))):a.setState({visible:!0})},a.readFile=function(e){"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(o.default.warning("\u53ea\u652f\u6301 xlsx \u683c\u5f0f,\u8bf7\u91cd\u65b0\u4e0a\u4f20"),a.setState({fileTest:!1})):a.setState({file:e,fileTest:!0},(function(e){}))},a.onFormChange=function(e,t){var n;a.setState({form:(0,s.Z)({},a.state.form,(n={},n[e]=t,n))})},a.downLoadFile=function(){var e=document.createElement("a");e.style.display="none",e.href="/api/"+(0,d.AV)()+"/contact/v2/download/template",document.body.appendChild(e),e.click(),e.remove()},a.upload=function(){a.setState({uploading:!0},(function(){var e=a.xhr=new XMLHttpRequest;e.open("POST","/api/"+(0,d.AV)()+"/contact/v2/import"),e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){var t=JSON.parse(e.responseText);2e4===t.code?(a.setState({steps:a.state.steps+1,fileResult:t.result,uploading:!1}),a.props.onBatchAdd&&a.props.onBatchAdd(t.result.successfulList)):(a.setState({fileResult:null,uploading:!1}),o.default.error(t.msg))}else a.setState({fileResult:null,uploading:!1}),o.default.error("\u4e0a\u4f20\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5\u6587\u4ef6\u683c\u5f0f\u6216\u8054\u7cfb\u7ba1\u7406\u5458")},e.upload.onprogress=function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);a.setState({percent:t})}},e.onabort=function(e){o.default.error("\u4e0a\u4f20\u5df2\u4e2d\u65ad")};var t=new FormData;t.append("file",a.state.file),t.append("allSetTags",a.state.allSetTags),t.append("newSetTags",a.state.newSetTags),t.append("uploadType",a.props.uploadType?a.props.uploadType:"ALL"),e.send(t)}))},a.step1=function(){var e=a.state,t=(e.steps,e.dragenter,e.fileTest),r=e.file,l={name:"file",multiple:!0,action:"",accept:".xls, .xlsx,",showUploadList:!1,beforeUpload:function(e){return a.readFile(e),!1},onChange:function(e){},onDrop:function(e){}};return m.createElement(f,(0,s.Z)({},l,{className:"upload_wrap"}),!r&&m.createElement(m.Fragment,null,m.createElement("div",{className:"upload"},m.createElement("div",{className:"add"},m.createElement("img",{src:n(25026)})),m.createElement("b",null,m.createElement("span",null,"\u70b9\u51fb"),"\u6216\u5c06EXCEL\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc\u4e0a\u4f20"),m.createElement("p",{className:"download_template",onClick:function(e){return a.downLoadFile()}},"\u4e0b\u8f7d\u6807\u51c6\u6a21\u677f"),m.createElement("div",{className:"accept",style:{color:t?"":"#D96969"}},"\uff08\u53ea\u652f\u6301xlsx\u683c\u5f0f\uff0c\u5355\u6b21\u4e0a\u4f20\u4e0d\u8d85\u8fc75000\u6761\uff0c\u82e5\u8d85\u8fc75000\u6761\uff0c\u8bf7\u5206\u6279\u4e0a\u4f20\uff09"))),r&&m.createElement("p",{className:"file_name"},m.createElement("img",{src:n(18614)}),m.createElement("div",null,r.name),m.createElement("span",null,"\u91cd\u65b0\u4e0a\u4f20")))},a.step2=function(){var e=a.props.tags;return m.createElement("div",{className:"step2_wrap"},m.createElement("h3",null,"\u4f60\u53ef\u4ee5\u7ed9\u5bfc\u5165\u7684\u300c\u6240\u6709\u5ba2\u6237\u300d\u6253\u4e0a\u6807\u7b7e"),m.createElement("div",null,m.createElement(p.Z,{options:e,valueProps:"name",placeholder:"\u8bf7\u9009\u62e9\u6216\u8005\u8f93\u5165\u6807\u7b7e\u540e\u6309\u56de\u8f66",style:{width:400},onChange:function(e){a.setState({allSetTags:e})}})),m.createElement("h3",null,"\u4ec5\u7ed9\u5bfc\u5165\u7684\u300c\u65b0\u5ba2\u6237\u300d\u6253\u4e0a\u6807\u7b7e"),m.createElement("div",null,m.createElement(p.Z,{options:e,placeholder:"\u8bf7\u9009\u62e9\u6216\u8005\u8f93\u5165\u6807\u7b7e\u540e\u6309\u56de\u8f66",style:{width:400},onChange:function(e){a.setState({newSetTags:e})},valueProps:"name"})),m.createElement("p",null,"\u6ce8\uff1a\u4f60\u53ef\u4ee5\u8df3\u8fc7\u6b64\u6b65"))},a.step3=function(){var e=a.state.fileResult,t=e.successCount,n=e.failedCount,r=e.fileName;return m.createElement("div",{className:"result_wrapper"},m.createElement(c.ZP,{status:"success",title:m.createElement("p",{className:"result_text"},"\u6210\u529f\u5bfc\u5165",t,"\u4e2a\u6709\u6548\u5ba2\u6237\uff0c\u5bfc\u5165\u5931\u8d25",n,"\u4e2a\u5ba2\u6237"),subTitle:m.createElement("a",{className:"result_faile_text",href:"/api/"+(0,d.AV)()+"/contact/v2/download/excel?fileName="+r,target:"_blank",rel:"noreferrer"},"\u67e5\u770b\u5931\u8d25\u65e5\u5fd7")}),m.createElement("p",{className:"result_tip_text"},"\u7cfb\u7edf\u5df2\u5c06\u8fd9\u4e9b\u5ba2\u6237\u4fdd\u5b58\u5230\u5ba2\u6237\u5217\u8868\u5f53\u4e2d\uff0c\u65b9\u4fbf\u4f60\u4e0b\u6b21\u67e5\u627e"))},a.pre=function(){a.setState({steps:a.state.steps-1})},a.next=function(){a.setState({steps:a.state.steps+1})},a._handleOnCancel=function(){var e=a.state.steps;a.setState((0,s.Z)({},Object.assign({},h))),3===e&&a.props.onCancel()},a.rendStepsContext=function(e){switch(e){case 1:return a.step1();case 2:return a.step2();case 3:return a.step3(1);default:return null}},a.renderFooter=function(){var e=a.state,t=e.steps,n=e.file,r=e.uploading;return 3===t?null:m.createElement(m.Fragment,null,t<3&&m.createElement(l.default,{onClick:1===t?a._handleOnCancel:a.pre},1===t?"\u53d6\u6d88":"\u4e0a\u4e00\u6b65"),m.createElement(l.default,{type:"primary",disabled:!n||r,onClick:2===t?a.upload:a.next},2===t?"\u786e\u5b9a\u4e0a\u4f20":"\u4e0b\u4e00\u6b65"))},a.state=(0,s.Z)({},Object.assign({},h)),a}(0,i.Z)(t,e);var u=t.prototype;return u.componentDidMount=function(){},u.render=function(){var e=this.state,t=e.steps,n=e.visible,l=e.uploading;return m.createElement("div",{className:"np_add_contact_batch_add"},m.createElement(a.Z,{className:"batch_add_dialog",title:"\u6279\u91cf\u4e0a\u4f20",visible:n,onCancel:this._handleOnCancel,width:960,footer:this.renderFooter()},m.createElement(r.default,{spinning:l},m.createElement("div",{className:"steps_warper"},m.createElement("div",{className:1===t?"setps_item sel":"setps_item"},m.createElement("div",{className:"steps_item_circle"},m.createElement("span",null,"1"),m.createElement("p",null,"\u9009\u62e9\u8868\u683c"))),m.createElement("div",{className:2===t?"setps_item sel":"setps_item"},m.createElement("div",{className:"steps_item_circle"},m.createElement("span",null,"2"),m.createElement("p",null,"\u6253\u4e0a\u6807\u7b7e"))),m.createElement("div",{className:3===t?"setps_item sel":"setps_item"},m.createElement("div",{className:"steps_item_circle"},m.createElement("span",null,"3"),m.createElement("p",null,"\u5bfc\u5165\u7ed3\u679c")))),this.rendStepsContext(t))))},t}(m.Component)},36260:(e,t,n)=>{n.d(t,{Z:()=>f});n(53294);var a=n(56697),r=n(15861),l=(n(89858),n(51024)),c=(n(62713),n(14321)),o=(n(29809),n(97538)),s=(n(35797),n(64749)),i=n(87757),u=n.n(i),m=n(67294),p=n(96651),d=s.default.Option;const f=function(e){var t=e.visible,n=e.tags,i=e.formData,f=e.schemaFields,h=e.onOK,v=e.onCancel,E=o.Z.useForm()[0],g=function(){var e=(0,r.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.validateFields();case 3:t=e.sent,h(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return(0,m.useEffect)((function(){i&&E.setFieldsValue(i)}),[i]),m.createElement(a.Z,{className:"yt-customer-sendQue-dialog yt-customer-edit-dialog",title:i?"\u7f16\u8f91\u5ba2\u6237":"\u65b0\u589e\u5ba2\u6237",visible:t,width:480,onOk:g,onCancel:v},m.createElement(o.Z,{labelCol:{span:5,offset:1},wrapperCol:{offset:1},labelAlign:"right",form:E},m.createElement(o.Z.Item,{label:m.createElement("div",{className:"user-label"},m.createElement("span",null,"\u7528\u6237\u540d"),m.createElement("span",null,"\u6807\u8bc6")),name:"unique",colon:!1,rules:[{required:!0,whitespace:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}]},m.createElement(l.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off",disabled:i})),m.createElement(o.Z.Item,{label:"\u59d3\u540d",name:"name",colon:!1},m.createElement(l.default,{maxLength:20,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),m.createElement(o.Z.Item,{label:"\u624b\u673a",name:"phoneNumber",colon:!1},m.createElement(l.default,{maxLength:11,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),m.createElement(o.Z.Item,{label:"\u90ae\u7bb1",name:"email",colon:!1,rules:[{whitespace:!0,message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1",type:"email"}]},m.createElement(l.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),m.createElement(o.Z.Item,{label:"\u6807\u7b7e",name:"newTags",colon:!1},m.createElement(p.Z,{options:n,placeholder:"\u8bf7\u9009\u62e9",style:{width:320},valueProps:"name"})),m.createElement(o.Z.Item,{label:"\u5907\u6ce8",name:"remark",colon:!1},m.createElement(l.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),f&&f.map((function(e){return function(e){var t=e.name,n=(e.code,e.id),a=e.type,r=e.showValues,i=r?JSON.parse(r):[];return m.createElement(m.Fragment,null,"RADIO"===a&&m.createElement(o.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},m.createElement(s.default,{style:{width:320},placeholder:"\u8bf7\u9009\u62e9"},i&&i.map((function(e,t){return m.createElement(d,{value:e.value,key:t},e.value)})))),"CHECKBOX"===a&&m.createElement(o.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},m.createElement(s.default,{style:{width:320},placeholder:"\u8bf7\u9009\u62e9",mode:"multiple"},i&&i.map((function(e,t){return m.createElement(d,{value:e.value,key:t},e.value)})))),"DATE_TIME"===a&&m.createElement(o.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},m.createElement(c.default,{style:{width:320},format:"YYYY/MM/DD"})),"TIME"===a&&m.createElement(o.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},m.createElement(c.default,{style:{width:320},format:"YYYY/MM/DD HH:mm",showTime:{format:"HH:mm"}})),"NUMERIC"===a&&m.createElement(o.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item",rules:[{validator:function(e,t){return t?/^(\-)?\d+(\.\d{1,4})?$/g.test(t)?Promise.resolve():Promise.reject(new Error("\u8bf7\u8f93\u5165\u6570\u5b57\uff0c\u6700\u591a\u652f\u6301\u8f93\u5165\u5c0f\u6570\u70b9\u540e\u56db\u4f4d")):Promise.resolve()}}]},m.createElement(l.default,{maxLength:30,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),"TEXT"===a&&m.createElement(o.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},m.createElement(l.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})))}(e)}))))}},96651:(e,t,n)=>{n.d(t,{Z:()=>c});n(35797);var a=n(64749),r=n(67294),l=a.default.Option;const c=function(e){var t=e.options,n=e.style,c=e.valueProps,o=e.onChange,s=e.placeholder,i=e.value;return r.createElement("div",{className:"customer_tag_select"},r.createElement(a.default,{placeholder:s,mode:"tags",style:n,showArrow:!0,onChange:o,allowClear:!0,value:i},t&&t.map((function(e,t){return r.createElement(l,{key:t,value:c?e[c]:e.id},e.name)}))))}},3061:(e,t,n)=>{n.d(t,{Z:()=>m});n(53294);var a=n(56697),r=n(15861),l=(n(29809),n(97538)),c=(n(35797),n(64749)),o=n(87757),s=n.n(o),i=n(67294),u=c.default.Option;const m=function(e){var t=e.visible,n=e.fetchQueList,o=e.onOK,m=e.onCancel,p=l.Z.useForm()[0],d=(0,i.useState)([]),f=d[0],h=d[1],v=function(){var e=(0,r.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:(t=e.sent)&&h(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){v()}),[]);var E=function(){var e=(0,r.Z)(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.validateFields();case 3:t=e.sent,n=f.find((function(e){return e.id===t.id})),o(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return i.createElement(a.Z,{className:"yt-customer-sendQue-dialog",title:"\u53d1\u9001\u95ee\u5377",visible:t,width:480,onOk:E,onCancel:m},i.createElement(l.Z,{labelCol:{span:3,offset:2},wrapperCol:{offset:1},form:p},i.createElement(l.Z.Item,{label:"\u95ee\u5377\u540d\u79f0",name:"id",colon:!1,rules:[{validator:function(){var e=(0,r.Z)(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("\u8bf7\u9009\u62e9\u95ee\u5377")));case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]},i.createElement(c.default,{style:{width:320},placeholder:"\u8bf7\u9009\u62e9"},f&&f.map((function(e,t){return i.createElement(u,{value:e.id,key:t},e.title)}))))))}},90037:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Se});var a=n(63366),r=n(87462),l=n(94578),c=n(67294),o=n(55609),s=n(64396),i=(n(6373),n(82891)),u=(n(54214),n(12386)),m=(n(1025),n(65400)),p=(n(75314),n(11187)),d=n(15861),f=n(87757),h=n.n(f),v=n(35239),E=n(57254),g=n(30381),y=n.n(g),C=n(61918),w=(n(54277),n(74048)),k=(n(15086),n(94055)),S=n(19155),b=n.n(S),T=n(44908),_=n.n(T),N=n(96889),I=(n(53294),n(56697)),x=["onOK"];const Z=function(e){var t=e.onOK,n=(0,a.Z)(e,x);return c.createElement(I.Z,(0,r.Z)({className:"yt-customer-dialog-wrapper"},n,{onOk:t}),n.content||n.children)};var D=n(61409),L=(n(43378),n(62443)),R=(n(7940),n(31059)),O=n(24616),M=n(87219);const A=function(e){var t=e.systemColumn,n=e.columns,a=e.onColumnChange,r=(0,c.useState)(!0),l=r[0],o=r[1],s=(0,c.useState)(!1),i=s[0],u=s[1],d=(0,c.useState)(!1),f=d[0],h=d[1],E=(0,c.useState)([]),g=E[0],y=E[1],C=function(){var e=(0,M.ZP)(g,(function(e){return e.map((function(e){var n=t.find((function(t){return t.key===e.key}));return e.checked=!!n&&n.checked,e})),e})),n=e.find((function(e){return!e.checked}));y(e),u(!n),o(!!n)};(0,c.useEffect)((function(){!function(){var e=[];for(var t in n){if("opeator"===t)break;var a=n[t],r=a.name,l=a.key,c=a.show;e.push({name:r,key:l,checked:c})}var s=e.find((function(e){return!e.checked}));y(e),u(!s),o(!!s)}()}),[n]);var S=c.createElement("div",{className:"customer_column_box"},c.createElement("ul",{className:"column_list"},g.map((function(e,t){return c.createElement("li",{className:"column_list_item",key:t},c.createElement(R.default,{checked:e.checked,onChange:function(e){return function(e,t){var n=e.target.checked;if(1!==g.filter((function(e){return e.checked})).length||n){var a=(0,M.ZP)(g,(function(e){return e[t].checked=n,e})),r=a.filter((function(e){return e.checked})).length;o(r<g.length),u(r===g.length),y(a)}else p.default.warning("\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u9879\u5c55\u793a")}(e,t)}},e.name))}))),c.createElement("div",{className:"column_footer"},c.createElement(w.default,null,c.createElement(m.default,{size:"small",onClick:function(){C(),h(!1)}},"\u53d6\u6d88"),c.createElement(m.default,{type:"primary",size:"small",onClick:function(){return function(){var e=g.filter((function(e){return e.checked}));e&&e.length<1?p.default.warning("\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u9879\u5c55\u793a"):(a(g),h(!f),v.t.set("customerColumns",g,"sessionStorage"))}()}},"\u786e\u5b9a")))),b=c.createElement("div",{className:"column_title"},c.createElement(R.default,{indeterminate:l,onChange:function(e){var t=e.target.checked,n=(0,M.ZP)(g,(function(e){return e.forEach((function(e){return e.checked=t}))}));y(n),u(t),o(!1)},checked:i},"\u5217\u5c55\u793a"),c.createElement("span",{className:"reset_btn",onClick:C},"\u91cd\u7f6e"));return c.createElement(L.default,{content:S,title:b,trigger:"click",placement:"bottomRight",overlayClassName:"customer_column_popover",visible:f},c.createElement(k.default,{title:"\u5217\u5c55\u793a",key:"leftButton"},c.createElement(O.Z,{onClick:function(){return h(!f)}})))};var P=n(61193),F=[{title:"\u7528\u6237\u540d",dataIndex:"unique",key:"unique",width:200,ellipsis:!0,checked:!0,name:"\u7528\u6237\u540d",render:function(e,t){return c.createElement("span",{className:"table_unique",onClick:function(){return D.mW.push({pathname:"/customerFile/customerDetail",state:{customerId:t.id}})}},e)}},{title:"\u59d3\u540d",dataIndex:"name",key:"name",width:160,ellipsis:!0,checked:!0,name:"\u59d3\u540d"},{title:"\u6807\u7b7e",dataIndex:"newTags",key:"newTags",width:420,checked:!0,name:"\u6807\u7b7e",render:function(e){return c.createElement("div",{className:"col-nps-contact-tags"},e&&e.length?e.reduce((function(e,t,n,a){return t?(n<3?e.push(c.createElement(k.default,{placement:"top",overlayClassName:"popup-tags",title:t},c.createElement("span",{key:t,className:"tag"},t.length>6?t.substring(0,6)+"...":t))):3===n&&e.push(c.createElement(k.default,{overlayClassName:"popup-tags",title:a.slice(3).join("\u3001"),placement:"top"},c.createElement("span",{key:"more"},"..."))),e):e}),[]):c.createElement("div",{style:{margin:6}},"--"))}},{title:"\u90ae\u7bb1",dataIndex:"email",key:"email",width:230,checked:!1,name:"\u90ae\u7bb1"},{title:"\u624b\u673a",dataIndex:"phoneNumber",key:"phoneNumber",width:160,checked:!1,name:"\u624b\u673a"},{title:"\u5e94\u7528",dataIndex:"appInfoVOS",key:"appInfoVOS",width:160,checked:!1,name:"\u5e94\u7528",render:function(e){return c.createElement(w.default,null,e.length>0&&e.map((function(e,t){return c.createElement(k.default,{key:"appPictureUrl",title:"\u5e94\u7528\u540d\u79f0:"+(e.appName?e.appName:"--")+",\u7528\u6237ID:"+(e.appUserId?e.appUserId:"--")},c.createElement("img",{style:{width:"30px",height:"30px"},src:e.appPictureUrl}))})))}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"createdAt",key:"createdAt",width:160,checked:!0,name:"\u521b\u5efa\u65f6\u95f4",render:function(e){return e&&y()(e).format("YYYY/MM/DD HH:mm")}},{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"updatedAt",key:"updatedAt",width:160,checked:!0,name:"\u66f4\u65b0\u65f6\u95f4",render:function(e){return e&&y()(e).format("YYYY/MM/DD HH:mm")}}];const Y=function(e){var t=e.loading,n=e.pagination,a=e.dataSource,l=(e.total,e.selectedRow),o=e.onChangeRowSelect,s=e.schemaFields,i=e.onTableChange,u=e.onDeleteContact,m=e.onEditContact,p=(0,c.useState)(!1),d=p[0],f=p[1],h=(0,c.useState)(),E=h[0],g=h[1],y=(0,c.useCallback)((function(e,t){var n=l.isSelectAll,a=l.keys,c=l.unSelectList,s=l.currentKeys,i=l.currentRows,u=e.id,m=a,p=[],d=s,f=i;t?(m=[].concat(m,[u]),n?p=c.filter((function(e){return e!==u})):(d=_()([].concat(s,[u])),f=b()([].concat(i,[e]),"id"))):(m=m.filter((function(e){return e!==u})),n?p=_()([].concat(c,[u])):(d=null==s?void 0:s.filter((function(e){return e!==u})),f=null==i?void 0:i.filter((function(e){return e.id!==u})))),o((0,r.Z)({},l,{keys:m,unSelectList:p,currentKeys:d,currentRows:f}))}),[l,a]),C=(0,c.useCallback)((function(e,t){var n=l.isSelectAll,c=(l.keys,l.unSelectList),s=l.currentKeys,i=l.currentRows,u=t.map((function(e){return e.id})),m=[],p=s,d=i;if(e)n?m=c.filter((function(e){return!u.includes(e)})):(p=_()([].concat(s,u)),d=b()([].concat(i,t),"id"));else{var f=a.map((function(e){return e.id}));n?m=_()([].concat(c,f)):(p=null==s?void 0:s.filter((function(e){return!f.includes(e)})),d=null==i?void 0:i.filter((function(e){return!f.includes(e.id)})))}o((0,r.Z)({},l,{keys:u,unSelectList:m,currentKeys:p,currentRows:d}))}),[l,a]),S=(0,c.useMemo)((function(){return{fixed:!0,selectedRowKeys:l.keys,selections:[{key:"all",text:"\u5168\u9009\u6240\u6709",onSelect:function(e){o({isSelectAll:!0,keys:e,unSelectList:[],currentKeys:[],currentRows:[]})}},{key:"selection_invert",text:"\u53cd\u9009\u5f53\u9875",onSelect:function(e){var t=l.unSelectList,n=l.currentKeys,r=l.currentRows,c=l.isSelectAll,s=l.keys,i=e.filter((function(e){return!s.includes(e)})),u=a.filter((function(e){return i.includes(e.id)}));if(c){var m=t.filter((function(e){return!i.includes(e)}));t=_()([].concat(m,s))}else n=_()([].concat(n,i)),r=b()([].concat(r,u),"id");o({isSelectAll:c,keys:i,unSelectList:t,currentKeys:n,currentRows:r})}},{key:"selection_empty",text:"\u6e05\u7a7a\u6240\u6709",onSelect:function(){o({isSelectAll:!1,keys:[],unSelectList:[],currentKeys:[],currentRows:[]})}}],onSelect:y,onSelectAll:C}}),[l,y]),T=(0,c.useState)({}),I=T[0],x=T[1];(0,c.useEffect)((function(){var e=l.isSelectAll,t=l.currentKeys,n=l.unSelectList,r=l.currentRows,c=e?a.filter((function(e){return!n.includes(e.id)})).map((function(e){return e.id})):a.filter((function(e){return t.includes(e.id)})).map((function(e){return e.id}));o({isSelectAll:e,keys:c,unSelectList:n,currentKeys:t,currentRows:r})}),[a]);var L=(0,c.useMemo)((function(){var e=document.querySelector(".yt_customerList_content_wrapper");return e?e.offsetHeight-180:660}),[t]);(0,c.useEffect)((function(){Y()}),[s]);var R=(0,c.useState)(F),O=R[0],M=R[1],Y=function(){var e=s.map((function(e){return{title:function(){return c.createElement(k.default,{title:e.name},c.createElement("span",{className:"customer-ellipsis"},e.name))},dataIndex:e.code,key:e.code,width:160,ellipsis:!0,checked:!1,name:e.name,render:function(t,n){var a=n.mappingInfoList.find((function(t){return e.code===t.schemaCode})),r=a&&a.schemaValue;return r&&c.createElement(k.default,{title:r},c.createElement("span",{className:"customer-ellipsis"},r))}}})),t=F.concat(e),n=v.t.get("customerColumns","sessionStorage"),a=n||t,r={};t.map((function(e){var t=a.find((function(t){return t.name===e.name})),n=!!t&&t.checked;return r[e.key]={show:n,title:e.title,name:e.name,key:e.key},e})),M(t),x(r)};return c.createElement("div",{className:"custom-list-wrapper"},c.createElement(N.ZP,{rowSelection:S,columns:[].concat(O,[{title:"\u64cd\u4f5c",dataIndex:"opeator",width:160,key:"opeator",fixed:"right",name:"\u64cd\u4f5c",render:function(e,t){return c.createElement(w.default,null,P.Z.hasAuthority("CUSTOMER_MANAGER_DETAIL")&&c.createElement("span",{className:"opeator-span",onClick:function(){return D.mW.push({pathname:"/customerFile/customerDetail",state:{customerId:t.id}})}},"\u67e5\u770b\u8be6\u60c5"),P.Z.hasAuthority("CUSTOMER_MANAGER_EDIT")&&c.createElement("span",{className:"opeator-span",onClick:function(){return m(t)}},"\u7f16\u8f91"),P.Z.hasAuthority("CUSTOMER_MANAGER_DELETE")&&c.createElement("span",{className:"opeator-span",onClick:function(){g(t.id),f(!0)}},"\u5220\u9664"))}}]),loading:t,rowKey:"id",pagination:n,onChange:i,dataSource:a,search:!1,scroll:{y:L,x:"100%"},options:!1,tableAlertRender:!1,toolBarRender:function(){return[c.createElement(A,{key:"setColumn",columns:I,onColumnChange:function(e){return function(e){var t=JSON.parse(JSON.stringify(I));e.map((function(e){return t[e.key]={show:e.checked,title:e.title,key:e.key,name:e.name},e})),x(t)}(e)},systemColumn:F})]},columnsStateMap:I,onColumnsStateChange:function(e){return x(e)}}),c.createElement(Z,{title:"\u5220\u9664\u5ba2\u6237",content:"\u5220\u9664\u540e\uff0c\u8be5\u5ba2\u6237\u4fe1\u606f\u5c06\u5f7b\u5e95\u88ab\u5220\u9664\u3002",visible:d,onOK:function(){f(!1),u(E)},onCancel:function(){f(!1)},width:424,closable:!1}))};n(35797);var K=n(64749),H=n(50361),V=n.n(H),q=["DATE_TIME","TIME","RANGE_NUMBER","CREATED_TIME","NUMERIC","TIME"],B=["TIME"],U={DATE_TIME:{enum:[{name:"\u7b49\u4e8e",id:"1",value:"EQ"},{name:"\u65e9\u4e8e",id:"2",value:"LT"},{name:"\u665a\u4e8e",id:"3",value:"GT"},{name:"\u4ecb\u4e8e",id:"4",value:"BETWEEN"}],type:"DatePicker"},TIME:{enum:[{name:"\u7b49\u4e8e",id:"1",value:"EQ"},{name:"\u65e9\u4e8e",id:"2",value:"LT"},{name:"\u665a\u4e8e",id:"3",value:"GT"},{name:"\u4ecb\u4e8e",id:"4",value:"BETWEEN"}],type:"DatePicker"},CHECKBOX:{type:"Select",mode:"multiple"},PRIORITY:{type:"Select"},RADIO:{type:"Select"},NUMERIC:{enum:[{name:"\u7b49\u4e8e",id:"1",value:"EQ"},{name:"\u5c0f\u4e8e",id:"2",value:"LT"},{name:"\u5927\u4e8e",id:"3",value:"GT"},{name:"\u4ecb\u4e8e",id:"4",value:"BETWEEN"}],type:"InputNumber"},TEXT:{type:"Input"},RICH_TEXT:{type:"Input"},ASSIGNEE:{type:"Select",mode:"multiple"},STATE:{type:"Select"},CREATOR:{type:"Select",mode:"multiple"},CREATED_TIME:{enum:[{name:"\u7b49\u4e8e",id:"1",value:"eq"},{name:"\u65e9\u4e8e",id:"2",value:"ea"},{name:"\u665a\u4e8e",id:"3",value:"af"},{name:"\u4ecb\u4e8e",id:"4",value:"be"}],type:"DatePicker"},REMARK:{type:"Input"}},j=(n(62713),n(14321));const Q=function(e){var t=e.value,n=e.showTime,a=e.func,r=n?"YYYY/MM/DD HH:mm":"YYYY/MM/DD";return c.createElement(c.Fragment,null,c.createElement(j.default,{allowClear:!1,value:t?y()(t,r):void 0,format:r,style:{width:290},onChange:function(t,n){e.value=n,a()},showTime:n,placeholder:"\u8bf7\u9009\u62e9"+(n?"\u65f6\u95f4":"\u65e5\u671f")}))};n(89858);var X=n(51024);const G=function(e,t){var n=e.value,a=(e.id,e.func);return c.createElement(c.Fragment,null,c.createElement(X.default,{value:n,placeholder:"\u8bf7\u8f93\u5165",style:{width:370},onChange:function(t){e.value=t.target.value,a()}}))};n(59567);var W=n(8799);const z=function(e,t){var n=e.value,a=e.func;return c.createElement(W.Z,{value:n,style:{width:290},onChange:function(t){e.value=t,a()},precision:4,stringMode:!0,formatter:function(e){return e},placeholder:"\u8bf7\u8f93\u5165\u6570\u5b57"})};var J=K.default.Option;const $=function(e){var t=e.value,n=e.type,a=e.showValues,r=e.func,l=a?JSON.parse(a):[];l.push({key:"EMPTY",value:"EMPTY"});var o=U[n].mode;return c.createElement(K.default,{mode:o,value:t,style:{width:370},placeholder:"\u8bf7\u9009\u62e9",onChange:function(t){e.value=t,r()}},l&&l.map((function(e){return c.createElement(J,{value:e.value,key:e.key},"EMPTY"===e.value?"\u7a7a\u767d":e.value)})))};var ee=j.default.RangePicker;const te=function(e,t){var n=e.value,a=e.func,r=e.showTime,l=r?"YYYY/MM/DD HH:mm":"YYYY/MM/DD";return c.createElement(c.Fragment,null,c.createElement(ee,{style:{width:290},format:l,allowClear:!1,value:n?[y()(n[0],l),y()(n[1],l)]:[null,null],onChange:function(t,n){e.value=n,a()},showTime:r,placeholder:["\u8bf7\u9009\u62e9"+(r?"\u65f6\u95f4":"\u65e5\u671f"),"\u8bf7\u9009\u62e9"+(r?"\u65f6\u95f4":"\u65e5\u671f")]}))};var ne=n(52971),ae=n(83204),re=K.default.Option;const le={DatePicker:Q,InputNumber:z,Select:$,Input:G,RangePicker:te,CustomerSelect:function(e){var t=e.value,n=e.showValues,a=e.onChange,r=e.onDelTagItem,l=n||[],o=(0,ne.Z)({show:!1,popoverIndex:null,openSelect:!1}),s=o[0],i=o[1];(0,ae.Z)("click",(function(e){i({show:!1,popoverIndex:null}),i({openSelect:!1})}),{target:document.querySelector(".yt-search-more-popover")});var u=function(e,t){return c.createElement("div",{style:{maxWidth:140},onClick:function(e){return e.stopPropagation()}},c.createElement("p",null,"\u5220\u9664\u540e\uff0c\u6240\u6709\u5ba2\u6237\u90fd\u4e0d\u663e\u793a\u6b64\u6807\u7b7e"),c.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},c.createElement(m.default,{size:"small",onClick:function(e){i({show:!1}),e.stopPropagation()}},"\u53d6\u6d88"),c.createElement(m.default,{type:"primary",size:"small",onClick:function(n){!function(e,t,n){e.stopPropagation(),r(t,n),i({show:!1})}(n,e,t),n.stopPropagation()}},"\u786e\u5b9a")))},p=s.show,d=s.popoverIndex,f=s.openSelect;return c.createElement(K.default,{showSearch:!0,mode:"multiple",value:t,style:{width:370},placeholder:"\u8bf7\u9009\u62e9\u6216\u8f93\u5165\u6807\u7b7e",onChange:function(e){i({show:!1}),a(e)},allowClear:!0,optionFilterProp:"children",optionLabelProp:"label",open:f,onFocus:function(){return i({openSelect:!0,show:!1,popoverIndex:null})}},l&&l.map((function(e,t){return c.createElement(re,{label:e.name,value:e.id,key:e.id,className:"customer-options-item"},e.name,c.createElement(L.default,{overlayStyle:{zIndex:2e3},placement:"top",content:function(){return u(t,e)},mouseEnterDelay:.4,trigger:"click",visible:p&&d===t,overlayClassName:"del-content-box"},c.createElement("i",{className:"iconfont icon-cem_delete",onClick:function(e){e.stopPropagation(),i({show:!p,popoverIndex:t})}})))})))},RangeNumber:function(e,t){var n=e.value,a=e.func,r=function(t,r){var l=n||[null,null],c=1===r?[t,l[1]]:[l[0],t];e.value=c,a(),c[0]&&c[1]&&c[1]<c[0]&&p.default.warning("\u6570\u503c\u533a\u95f4\u6709\u8bef")};return c.createElement(c.Fragment,null,c.createElement(W.Z,{value:n?n[0]:null,style:{width:132},onChange:function(e){return r(e,1)},precision:4,stringMode:!0,formatter:function(e){return e},placeholder:"\u8bf7\u8f93\u5165\u6570\u5b57",max:n?n[1]:Number.MAX_SAFE_INTEGER}),c.createElement("span",{style:{margin:"0 6px"}},"\u81f3"),c.createElement(W.Z,{value:n?n[1]:null,style:{width:132},onChange:function(e){return r(e,2)},precision:4,stringMode:!0,formatter:function(e){return e},placeholder:"\u8bf7\u8f93\u5165\u6570\u5b57",min:n?n[0]:Number.MIN_SAFE_INTEGER}))},DateTimePicker:Q,RangeTimePicker:te};var ce=K.default.Option;const oe=function(e){var t=e.changeScreenVisible,n=e.tagObj,a=e.screensList,r=e.filtersList,l=e.handlefiltersList,o=e.handleScreenList,s=e.updatafiltersList,i=e.cleanfiltersList;return c.createElement("div",{className:"workorder_screen"},c.createElement("div",{className:"screen_header"},c.createElement("span",{className:"header_title"},"\u8bbe\u7f6e\u7b5b\u9009\u6761\u4ef6"),c.createElement("span",{className:"header_desc"},"\u7b26\u5408\u4ee5\u4e0b\u6240\u6709\u6761\u4ef6")),c.createElement("div",{className:"screen_content"},c.createElement("div",{className:"screen_content_item"},c.createElement("span",{style:{marginRight:96,paddingLeft:10}},"\u5ba2\u6237\u6807\u7b7e"),le.CustomerSelect(n)),r.map((function(e,t){return e.func=s,e.timeType=e.timeType?e.timeType:q.includes(e.type)?"LT":"",e.showTime=B.includes(e.type)?{format:"HH:mm"}:void 0,e.value=e.value||void 0,c.createElement("div",{key:t,className:"screen_content_item"},c.createElement(K.default,{value:e.name,placeholder:"\u8bf7\u9009\u62e9",style:{width:120,marginRight:42},onChange:function(e,n){!function(e,t,n){var c=V()(r),o=V()(a),s=c.findIndex((function(t){return t.id===e})),i=s>=0?c.splice(n,1,c[s]):c.splice(n,1,o[t.key]);s>=0&&c.splice(s,1,i[0]),l(c)}(e,n,t)}},a.map((function(e,t){return c.createElement(ce,{value:e.id,key:t,type:e.type},e.name)}))),q.includes(e.type)?c.createElement(K.default,{value:e.timeType,placeholder:"\u8bf7\u9009\u62e9",style:{width:"70px",marginRight:"10px"},onChange:function(e){!function(e,t){var n=V()(r);n[t].timeType=e,n[t].value=void 0,l(n)}(e,t)}},e.type&&U[e.type].enum.map((function(e,t){return c.createElement(ce,{value:e.value,key:t},e.name)}))):null,"BETWEEN"===e.timeType?"NUMERIC"===e.type?le.RangeNumber(e):le.RangePicker(e):le[U[e.type].type](e),c.createElement("i",{className:"icon-cem_cancel",style:{marginLeft:"10px",color:"#BEBEBE"},onClick:function(){!function(e){var t=V()(r);t.splice(e,1),l(t)}(t)}}))})),c.createElement("div",{className:"add-item"},c.createElement("i",{className:"icon-cem_add-to"}),c.createElement("span",{onClick:function(){var e=V()(r).concat([{type:"TEXT"}]);l(e)}},"\u6dfb\u52a0\u7b5b\u9009\u6761\u4ef6"))),c.createElement("div",{className:"screen_bottom"},c.createElement("span",{className:"screen_bottom_clean",onClick:i},"\u6e05\u7a7a\u9009\u9879"),c.createElement(m.default,{onClick:function(){t(!1)}},"\u53d6\u6d88"),c.createElement(m.default,{type:"primary",onClick:function(){o(),t(!1)}},"\u67e5\u8be2")))};const se=function(e){var t=e.screensList,n=e.cacheFiltersList,a=e.tagObj,r=e.onSearchMore,l=e.handleCleanTags,o=(e.fetchSchemaList,(0,c.useState)(!1)),s=o[0],i=o[1],u=(0,c.useState)(n),m=u[0],p=u[1],d=function(){var e=0;return m.length&&(e=m.filter((function(e){return e.value})).length),a.value&&a.value.length&&(e+=1),e};return(0,c.useEffect)((function(){}),[]),c.createElement("div",{className:"yt-search-more-selector-wrapper "+(s?"yt-search-more-selector-wrapper-show":"")},c.createElement(L.default,{overlayClassName:"yt-search-more-popover",getPopupContainer:function(){return document.querySelector(".yt_customerList_content_wrapper")||document.body},content:c.createElement(oe,{changeScreenVisible:function(){return i(!s)},screensList:t,filtersList:m,handleScreenList:function(){return r(m)},handlefiltersList:function(e){p(e.map((function(e){return e})))},updatafiltersList:function(e){p(m.map((function(e){return e})))},cleanfiltersList:function(){p([]),l()},tagObj:a}),trigger:"click",placement:"bottomLeft",visible:s,onVisibleChange:function(e){return i(e)},destroyTooltipOnHide:!0},c.createElement("div",{className:"ets-trigger",onClick:function(){return i(!s)}},c.createElement("span",{className:"ets-trigger-pre-title"},"\u66f4\u591a"),d()>0&&c.createElement("span",{className:"ets-selected-item "+(s?"ets-selected-item-active":"")},d()),c.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:s?"rotate(-180deg)":""}}))))};var ie=n(3061),ue=n(50707),me=(n(29809),n(97538)),pe=n(96651);const de=function(e){var t=e.visible,n=e.tags,a=e.onOK,r=e.onCancel,l=me.Z.useForm()[0],o=function(){var e=(0,d.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.validateFields();case 3:t=e.sent,a(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return c.createElement(I.Z,{className:"yt-customer-sendQue-dialog",title:"\u6279\u91cf\u6dfb\u52a0\u6807\u7b7e",visible:t,width:480,onOk:o,onCancel:r},c.createElement(me.Z,{labelCol:{span:3,offset:2},wrapperCol:{offset:1},form:l},c.createElement(me.Z.Item,{label:"\u6807\u7b7e",name:"newTags",colon:!1,rules:[{validator:function(){var e=(0,d.Z)(h().mark((function e(t,n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("\u8bf7\u9009\u62e9\u6216\u65b0\u589e\u6807\u7b7e")));case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]},c.createElement(pe.Z,{options:n,placeholder:"\u8bf7\u9009\u62e9",valueProps:"name"}))))};var fe=n(36260),he=K.default.Option;const ve=function(e){var t=e.visible,n=e.options,a=e.onOK,r=e.onCancel,l=me.Z.useForm()[0],o=function(){var e=(0,d.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.validateFields();case 3:t=e.sent,a({tagIds:t.id}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return c.createElement(I.Z,{className:"yt-customer-sendQue-dialog",title:"\u6279\u91cf\u5220\u9664\u6807\u7b7e",visible:t,width:480,onOk:o,onCancel:r},c.createElement(me.Z,{labelCol:{span:3,offset:2},wrapperCol:{offset:1},form:l},c.createElement(me.Z.Item,{label:"\u6807\u7b7e",name:"id",colon:!1,rules:[{validator:function(){var e=(0,d.Z)(h().mark((function e(t,n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("\u8bf7\u9009\u62e9\u6807\u7b7e")));case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]},c.createElement(K.default,{style:{width:320},placeholder:"\u8bf7\u9009\u62e9",mode:"multiple",allowClear:!0,optionFilterProp:"children"},n.length&&n.map((function(e,t){return c.createElement(he,{value:e.id,key:t},e.name)}))))))};var Ee=["loading","data","tags","contentWidth","fetchParams","selectedRow","questList","schemaFields","cacheFiltersList","delAvailableTags","onChangeRowSelect","addedTags","onTagChange","onSearch","onTableChange","onAllDelClick","onDeleteContact","onTagsChange","jumpSendQuePage","onSearchMore","fetchSchemaList","fetchQuestList","onRefreshData","onDelTagItem","fetchDeltags","batDeltagItem"],ge=["email","id","name","phoneNumber","remark","newTags","unique"];const ye=function(e){var t=e.loading,n=e.data,l=e.tags,o=(e.contentWidth,e.fetchParams),s=e.selectedRow,f=(e.questList,e.schemaFields),g=e.cacheFiltersList,w=e.delAvailableTags,k=e.onChangeRowSelect,S=(e.addedTags,e.onTagChange),b=e.onSearch,T=e.onTableChange,_=e.onAllDelClick,N=e.onDeleteContact,I=e.onTagsChange,x=(e.jumpSendQuePage,e.onSearchMore),D=e.fetchSchemaList,L=e.fetchQuestList,R=e.onRefreshData,O=e.onDelTagItem,M=e.fetchDeltags,A=e.batDeltagItem,F=(0,a.Z)(e,Ee),K=(0,c.useState)(!1),H=K[0],V=K[1],q=(0,c.useState)(""),B=q[0],U=q[1],j=(0,c.useState)(!1),Q=j[0],X=j[1],G=(0,c.useState)(!1),W=G[0],z=G[1],J=(0,c.useState)(!1),$=J[0],ee=J[1],te=(0,c.useState)(!1),ne=te[0],ae=te[1],re=(0,c.useState)(),le=re[0],ce=re[1],oe=(0,c.useRef)(),me=function(e){var t=s.currentKeys;if(s.isSelectAll||t.length>0)switch(e){case 1:return X(!0);case 2:return z(!0);case 3:return Se(1);case 4:return V(!0)}else switch(e){case 1:return U("\u53d1\u9001\u95ee\u5377");case 2:return U("\u6279\u91cf\u6dfb\u52a0\u6807\u7b7e");case 3:return U("\u6279\u91cf\u5220\u9664\u6807\u7b7e");case 4:return U("\u6279\u91cf\u5220\u9664")}},pe=function(){var e=(0,d.Z)(h().mark((function e(t){var n,a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:n=t,(a=t.mappingInfoList)&&a.length>0&&a.map((function(e){var t=e.schemaId,a=e.schemaValue,r=e.schemaType;return n[t]=a,["CHECKBOX","RADIO"].includes(r)&&(n[t]=a.split(",")),["DATE_TIME","TIME"].includes(r)&&(n[t]=y()(a)),e})),ce(n),ae(!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=f.filter((function(e){return!0===e.isDetailVisible})),ye=function(){var e=(0,d.Z)(h().mark((function e(t){var n,r,l,c,o,s,i,u,m,p,d,f,v,E;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(m in n=t.email,t.id,r=t.name,l=t.phoneNumber,c=t.remark,o=t.newTags,s=t.unique,i=(0,a.Z)(t,ge),u=[],i)i[m]&&(p="TIME"===i[m].type?"YYYY/MM/DD":"YYYY/MM/DD HH:mm",u.push({scemaId:m,schemaValue:i[m]instanceof y()?y()(i[m]).format(p):i[m]instanceof Array?i[m].join(","):i[m]}));if(d={contactMappingModels:u,email:n,id:null==le?void 0:le.id,name:r,phoneNumber:l,remark:c,newTags:o,unique:s},f=F.addContact,v=F.updateContact,!le){e.next=11;break}return e.next=8,v(d);case 8:E=e.sent,e.next=14;break;case 11:return e.next=13,f(d);case 13:E=e.sent;case 14:E&&ae(!1);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ce=function(){var e=(0,d.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_();case 2:e.sent&&V(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(){var e=(0,d.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t);case 2:e.sent&&z(!1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=function(){var e=(0,d.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:ae(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=function(){var e=(0,d.Z)(h().mark((function e(t,n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t){e.next=6;break}return e.next=3,M();case 3:ee(!0),e.next=10;break;case 6:return e.next=8,A(n);case 8:e.sent&&ee(!1);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return c.createElement("div",{className:"yt_customerList_warpper"},c.createElement("div",{className:"yt_customerList_content_wrapper"},c.createElement("div",{className:"filter_wrapper"},c.createElement("div",{className:"filter_block"},c.createElement(C.Z,{placeholder:"\u59d3\u540d\u3001\u90ae\u7bb1\u3001\u624b\u673a",defValue:o.keyword,onSearch:b,onClear:b,style:{width:160,height:28}}),c.createElement(se,{onSearchMore:x,handleCleanTags:function(){return S([])},fetchSchemaList:D,screensList:f,cacheFiltersList:g,tagObj:{value:o.tags,showValues:l,onChange:S,onDelTagItem:O}})),c.createElement("div",{className:"filter_block"},c.createElement(m.default,{type:"primary",onClick:function(){return me(1)}},"\u53d1\u9001\u95ee\u5377"),c.createElement(i.default,{overlay:c.createElement(u.default,{onClick:function(e){var t=e.key;return me(+t)}},c.createElement(u.default.Item,{key:"2"},"\u6279\u91cf\u6dfb\u52a0\u6807\u7b7e"),c.createElement(u.default.Item,{key:"3"},"\u6279\u91cf\u5220\u9664\u6807\u7b7e"))},c.createElement(m.default,null,"\u6807\u7b7e\u7ba1\u7406 ",c.createElement(E.Z,null))),c.createElement(m.default,{onClick:function(){return me(4)}},"\u6279\u91cf\u5220\u9664"),P.Z.hasAuthority("CUSTOMER_MANAGER_ADD")&&c.createElement(i.default,{overlay:c.createElement(u.default,{onClick:function(e){return"1"===e.key?ke():oe.current.show()}},c.createElement(u.default.Item,{key:"1"},"\u5355\u4e2a\u65b0\u589e"),c.createElement(u.default.Item,{key:"2"},"\u6279\u91cf\u5bfc\u5165")),className:"add_customer_btn"},c.createElement(m.default,null,"\u65b0\u589e\u5ba2\u6237 ",c.createElement(E.Z,null))))),c.createElement(Y,{dataSource:n.list,total:n.total,loading:t,selectedRow:s,onChangeRowSelect:k,onEditContact:pe,onDeleteContact:N,onTableChange:T,pagination:{pageSize:o.pageSize,total:n.total,current:o.pageIndex},schemaFields:f})),ne&&c.createElement(fe.Z,{visible:!0,formData:le,tags:l,onOK:ye,onCancel:function(){ae(!1),ce(void 0)},schemaFields:he}),c.createElement(Z,{title:"\u5220\u9664\u5ba2\u6237",content:"\u5220\u9664\u540e\uff0c\u8be5\u5ba2\u6237\u4fe1\u606f\u5c06\u5f7b\u5e95\u88ab\u5220\u9664\u3002",visible:H,onOK:Ce,onCancel:function(){V(!1)},width:424,closable:!1}),c.createElement(Z,{title:B,content:"\u9700\u81f3\u5c11\u52fe\u9009\u4e00\u4f4d\u5ba2\u6237\u3002",visible:!!B,onOK:function(){return U("")},onCancel:function(){return U("")},width:424,closable:!1}),Q&&c.createElement(ie.Z,{visible:!0,onOK:function(e){var t=s.currentRows;if(s.isSelectAll)return p.default.warning("\u5206\u53d1\u95ee\u5377\u6682\u4e0d\u652f\u6301\u5168\u9009\u6240\u6709\u53d1\u9001");var n={selectedContact:{list:t.map((function(e){return(0,r.Z)({},e,{checked:!0})})),validPhoneNum:t.filter((function(e){return e.phoneNumber})).length,validEmailNum:t.filter((function(e){return e.email})).length,currpageList:t.map((function(e){return(0,r.Z)({},e,{checked:!0})})),pageIndex:1,pageSize:10},step:3};v.t.set("customerPage",n);var a={questionnaireId:e.id,title:e.title,questionnaireType:e.questionnaireType,pageOrigin:"customer"};window.open("/research/manage/distribute/edit?"+encodeURIComponent(JSON.stringify(a))),X(!1)},onCancel:function(){return X(!1)},fetchQueList:L,options:[]}),W&&c.createElement(de,{visible:!0,onOK:we,tags:l,onCancel:function(){return z(!1)}}),$&&c.createElement(ve,{visible:!0,onOK:function(e){return Se(2,e)},options:w,onCancel:function(){return ee(!1)}}),c.createElement(ue.Z,{ref:oe,tags:l,onCancel:R}))};var Ce=["loading"],we=s.Z.customersFile.allCustomers,ke=function(e){function t(t){var n;return(n=e.call(this,t)||this)._initData=function(){n.props.fetchTagList(),n.props.fetchContactsList()},n._handleOnContactAddSuccess=function(){n.props.fetchContactsList({pageIndex:1}),n.props.fetchTagList()},n._handleOnSearch=function(e){var t=n.props,a=t.fetchParams,l=t.contactsData,c=(0,r.Z)({},l,{fetchParams:(0,r.Z)({},a,{keyword:e})});n.props.save({contactsData:c}),n.props.fetchContactsList()},n._handleOnTagChange=function(e){var t=n.props,a=t.fetchParams,l=t.contactsData,c=(0,r.Z)({},l,{fetchParams:(0,r.Z)({},a,{tags:e})});n.props.save({contactsData:c})},n._handleOnSearchMore=function(e){var t=[],a=n.props,l=a.fetchParams,c=a.contactsData;e.map((function(e){if(e.value){var n=function(e){var t=e.type,n=e.value,a=e.id,r=e.timeType,l={archivesSchemaId:a,type:t};return"RADIO"===t&&(l.radioValue=n),"CHECKBOX"===t&&(l.checkboxValues=n),"TEXT"===t&&(l.textkeywords=n),["NUMERIC","DATE_TIME","TIME"].includes(t)&&(l.symbol=r,"BETWEEN"===r?(l.fromValue=n[0],l.toValue=n[1]):l.value=n),l}(e);t.push(n)}return e}));var o=(0,r.Z)({},c,{fetchParams:(0,r.Z)({},l,{schemaFilterModels:t,pageIndex:1})});n.props.save({contactsData:o,cacheFiltersList:e}),n.props.fetchContactsList()},n._handleOnChangeRowSelect=function(e){var t=n.props.contactsData,a=(0,r.Z)({},t,{selectedRow:e});n.props.save({contactsData:a})},n._handleOnAllDelClick=function(){return n.props.deleteAllContact()},n._handleBitchSetTags=function(e){return n.props.bitchSetTags(e)},n._handleOnTableChange=function(e){var t=e.current,a=e.pageSize,l=n.props,c=l.fetchParams,o=l.contactsData;if(t===c.pageIndex){var s=(0,r.Z)({},o,{fetchParams:(0,r.Z)({},c,{pageSize:a,pageIndex:1})});n.props.save({contactsData:s})}else{var i=(0,r.Z)({},o,{fetchParams:(0,r.Z)({},c,{pageIndex:t})});n.props.save({contactsData:i})}n.props.fetchContactsList()},n._handleDeleteContact=function(e){return n.props.deleteContact({id:e})},n._handleOnDelTagItem=function(e,t){return n.props.deltagItem(t)},n.state={},n.event={onSearch:n._handleOnSearch,onSearchApp:n._handleOnSearchAppSelect,onTagChange:n._handleOnTagChange,onAllDelClick:n._handleOnAllDelClick,onTagsChange:n._handleBitchSetTags,onTableChange:n._handleOnTableChange,onDeleteContact:n._handleDeleteContact,onChangeRowSelect:n._handleOnChangeRowSelect,onSearchMore:n._handleOnSearchMore,onRefreshData:n._initData,onDelTagItem:n._handleOnDelTagItem},n}(0,l.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._initData(),this.props.fetchSchemaList()},n.componentWillUnmount=function(){var e=this.props.contactsData,t=(0,r.Z)({},e,{data:{list:[],total:0}});this.props.save({contactsData:t})},n.render=function(){return c.createElement(ye,(0,r.Z)({},this.props,this.state,this.event))},t}(c.PureComponent);const Se=(0,o.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,Ce);return(0,r.Z)({fetchParams:n[we].contactsData.fetchParams,tags:n[we].tagList,data:n[we].contactsData.data,selectedRow:n[we].contactsData.selectedRow,loading:t.effects[we+"/fetchContactsList"]||!1},n[we])}),(function(e){return{fetchTagList:function(t){return e({type:we+"/fetchTagList",payload:t})},fetchAppList:function(t){return e({type:we+"/fetchAppList",payload:t})},fetchContactsList:function(t){return e({type:we+"/fetchContactsList",payload:t})},addContact:function(t){return e({type:we+"/addContact",payload:t})},deleteContact:function(t){return e({type:we+"/deleteContact",payload:t})},updateContact:function(t){return e({type:we+"/updateContact",payload:t})},deleteAllContact:function(t){return e({type:we+"/deleteAllContact",payload:t})},clean:function(t){return e({type:we+"/clean",payload:t})},bitchSetTags:function(t){return e({type:we+"/bitchSetTags",payload:t})},fetchQuestList:function(t){return e({type:we+"/fetchQuestList",payload:t})},fetchSchemaList:function(t){return e({type:we+"/fetchSchemaList",payload:t})},deltagItem:function(t){return e({type:we+"/deltagItem",payload:t})},fetchDeltags:function(t){return e({type:we+"/fetchDeltags",payload:t})},batDeltagItem:function(t){return e({type:we+"/batDeltagItem",payload:t})},save:function(t){return e({type:we+"/save",payload:t})}}}))(ke)},61918:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),r=n(45697),l=n.n(r),c=function(e){var t=e.className,n=e.onClear,r=e.onSearch,l=e.placeholder,c=e.style,o=e.defValue,s=e.signal,i=a.useState(o),u=i[0],m=i[1];a.useEffect((function(){m(o)}),[o,s]);return a.createElement("div",{style:c,className:"yt_search_input_wrapper "+(t||"")},a.createElement("input",{placeholder:l,value:u,onKeyDown:function(e){13===e.keyCode&&r(u)},onChange:function(e){return m(e.target.value)},autoComplete:"off"}),u&&a.createElement("i",{className:"icon-cem_log-off",onClick:function(){m(""),n&&n("")}}),a.createElement("i",{className:"icon-cem_small-search",onClick:function(){return r(u)}}))};c.propTypes={className:l().string,onSearch:l().func.isRequired,placeholder:l().string,style:l().object,defValue:l().string,signal:l().any,onClear:l().func};const o=c},18614:(e,t,n)=>{e.exports=n.p+"img/5d7b073242753bb9c9c4.png"},25026:(e,t,n)=>{e.exports=n.p+"img/9a82c3ea753a1f86b24d.png"}}]);