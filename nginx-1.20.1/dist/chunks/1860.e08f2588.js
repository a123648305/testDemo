"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1860],{22281:(e,t,n)=>{n.d(t,{Z:()=>L});var r=n(87462),a=(n(15267),n(64713)),i=(n(54277),n(74048)),o=n(15861),l=n(87757),c=n.n(l),u=n(67294),d=n(634),s=n(43036),f=n(61918),p=n(39270),h=n(63262),m=n(38064),g=n(30381),v=n.n(g),k=n(96889),w=(0,n(53326).rO)(),E=w.reduce((function(e,t){return e[t.value]=t.label,e}),{}),I=[{title:"\u5168\u90e8",value:""}].concat(w.map((function(e){return{title:e.label,value:e.value}}))),y={READ:"\u5df2\u8bfb",UNREAD:"\u672a\u8bfb"},x=[{label:"\u5168\u90e8",value:""},{label:y.UNREAD,value:"UNREAD"},{label:y.READ,value:"READ"}],b=[{title:"\u5168\u90e8",value:""},{title:"\u9ad8",value:"HIGH"},{title:"\u4e2d",value:"MIDDLE"},{title:"\u4f4e",value:"LOW"}],S=n(49722),C=function(){var e=(0,o.Z)(c().mark((function e(t){var n,r,a,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.h.post("/filter/find",{projectId:t,filterTypes:["TEAM","USER"],type:"OVERVIEW"});case 3:if(n=e.sent,r=(n||{}).data,2e4===(r||{}).code){e.next=8;break}throw"";case 8:return a=r.result||{},i=a.user,e.abrupt("return",i.map((function(e){return{id:e.id,name:e.username}})));case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),Z=n(35239),_=n(61193),R=n(61409);const L=function(e){var t=e.isNeedFilter,n=void 0!==t&&t,l=e.workOrderInfo,g=e.isShowPushUser,w=void 0===g||g,S=e.table,L=e.search,N=e.logStatus,O=e.level,A=e.categoryId,D=e.userIds,j=e.openDetail,T=e.onStateChange,K=(0,u.useState)([]),P=K[0],V=K[1];(0,u.useEffect)((function(){var e=function(){var e=(0,o.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,C(Z.t.get(Z.V.curProject).id);case 4:t=e.sent,V(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[n]);var z=[{title:"\u9884\u8b66\u6807\u9898",width:"41%",dataIndex:"title",render:function(e,t,n,r){var a=t.remark,i=t.warningDesc,o=t.warningName,l=t.warningLogId;return u.createElement(s.Z,{overlay:function(){return u.createElement(p.Z,{title:o,description:i})},placement:"topLeft",overlayStyle:{maxWidth:"436px"}},u.createElement("span",{className:"warning-log",onClick:function(){return null==j?void 0:j.onClick({id:l,title:a})}},a))}},{title:"\u7d27\u6025\u7a0b\u5ea6",width:"10%",dataIndex:"level",render:function(e){return u.createElement(h.Z,{level:e})}},{title:"\u6570\u636e\u7c7b\u578b",width:"10%",dataIndex:"categoryId",render:function(e){return E[e]}},{title:"\u6d4f\u89c8\u72b6\u6001",width:"10%",dataIndex:"logStatus",render:function(e){return y[e]}},{title:"\u63a8\u9001\u65f6\u95f4",width:"12%",dataIndex:"pushDate",render:function(e){return v()(e).format("YYYY/MM/DD HH:mm")}},{title:"\u662f\u5426\u5173\u8054\u5de5\u5355",width:"10%",render:function(e){return u.createElement(i.default,{size:"middle"},u.createElement("span",{className:e.isRelationWorkOrder?"btn":"",onClick:function(){return e.isRelationWorkOrder&&T("open_related",e)}},e.isRelationWorkOrder?"\u662f":"\u5426"))}}].concat(_.Z.hasAuthority("ADD_WORK_ORDER")?[{title:"\u64cd\u4f5c",width:"7%",key:"action",render:function(e){return u.createElement(i.default,{size:"middle"},u.createElement("a",{className:"link",onClick:function(){return T("open_wkOrder",e)}},"\u521b\u5efa\u5de5\u5355"))}}]:[]);return u.createElement("div",{className:"event_warging_table_page_view"},u.createElement("div",{className:"container"},u.createElement("div",{className:"content"},function(){if(!n)return null;return u.createElement("div",{className:"table-top"},u.createElement("div",null,u.createElement(f.Z,{placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u6807\u9898",defValue:null==L?void 0:L.value,onSearch:(null==L?void 0:L.onSearch)||function(){},onClear:function(){return null==L?void 0:L.onSearch("")},style:{width:200}}),u.createElement(a.default.Group,{options:x,value:null==N?void 0:N.value,onChange:function(e){return null==N?void 0:N.onChange(e.target.value)},optionType:"button",style:{height:30,marginRight:"8px",marginBottom:16}}),u.createElement(d.Z,{options:I,onChange:function(e){return null==A?void 0:A.onChange(e)},preTitle:"\u6570\u636e\u7c7b\u578b",divider:"none",type:"button",activeObj:null==A?void 0:A.value,sufIcon:"icon-cem_pull-down-or-take-up",style:{marginBottom:16}}),u.createElement(d.Z,{options:b,onChange:function(e){return null==O?void 0:O.onChange(e)},preTitle:"\u7d27\u6025\u7a0b\u5ea6",divider:"none",type:"button",activeObj:null==O?void 0:O.value,sufIcon:"icon-cem_pull-down-or-take-up",style:{marginBottom:16}}),w?u.createElement("span",{style:{display:"inline-block",marginBottom:"10px"}},u.createElement(m.Z,{title:"\u63a8\u9001\u6210\u5458",showClearBtn:!0,options:P,value:null==D?void 0:D.value,onChange:function(e){return null==D?void 0:D.onChange(e)}})):null))}(),(null==l?void 0:l.title)&&u.createElement("div",{className:"related"},u.createElement("span",null,"\u5173\u8054\u5de5\u5355\uff1a"),u.createElement("span",null,null==l?void 0:l.code,u.createElement("span",{style:{marginLeft:"10px"}},null==l?void 0:l.title),u.createElement("i",{className:"icon-cem_close-window",onClick:function(){R.mW.push({pathname:"/workspace/warning"})}}))),u.createElement(k.ZP,{loading:S.loading,dataSource:S.data,columns:z,toolBarRender:!1,search:!1,pagination:S.pagination,rowKey:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[1];return r},onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t[0],i=t.slice(1),o=(0,r.Z)({},a);S.pagination.pageSize!==o.pageSize&&(o.current=1),S.onChange.apply(null,[o].concat(i))}}))))}},98482:(e,t,n)=>{n.d(t,{Z:()=>E});var r=n(87462),a=n(94578),i=n(5133),o=n(35239),l=n(67294),c=(n(53294),n(56697)),u=(n(89858),n(51024)),d=(n(54277),n(74048)),s=(n(1025),n(65400)),f=(n(69909),n(17669)),p=(n(15144),n(2307)),h=(n(54038),n(36671)),m=n(61409),g=n(61193);const v=function(e){var t=e.list,n=e.listLoading,a=e.isRelated,i=e.selectedRowKeys,o=e.onStateChange,c={PENDING:"#BFBFBF",PROCESSING:"#0090FF",FINISHED:"#27CDA1"},u=[{title:"\u7f16\u53f7",key:"code",width:"12%",render:function(e){return l.createElement("span",null,e.code)}},{title:"\u6807\u9898",key:"title",ellipsis:!0,render:function(e){return l.createElement("span",null,l.createElement(m.rU,{to:"/workOrderDetail?workOrderId="+e.workOrderId+(g.Z.hasAuthority("EDIT_WORK_ORDER")||e.assigneeId===g.Z.getUser().userId||e.creatorId===g.Z.getUser().userId?"":"&view=true")+(e.hasDeleted?"&hasDeleted="+e.hasDeleted:"")+(g.Z.hasAuthority("EDIT_WORK_ORDER")||e.assigneeId!==g.Z.getUser().userId||e.creatorId===g.Z.getUser().userId?"":"&normalAssignee=true"),target:"_blank"},e.title))}},{title:"\u72b6\u6001",key:"stateName",width:200,render:function(e,t){return l.createElement(l.Fragment,null,l.createElement("span",{className:"status_point",style:{backgroundColor:c[t.statusKind],marginRight:"8px"}}),l.createElement("span",null,t.stateName))}}].concat("related"===a?[{title:"\u64cd\u4f5c",key:"action",width:120,render:function(e){return l.createElement(d.default,{size:"middle"},l.createElement("a",{onClick:function(){return o("remove",e)}},"\u53d6\u6d88\u5173\u8054"))}}]:[]),s={rowSelection:{selectedRowKeys:i,onChange:function(e){return o("selected",e)},fixed:!0}};return l.createElement(p.Z,(0,r.Z)({columns:u,dataSource:t.map((function(e){return e.key=e.workOrderId,e})),scroll:{y:"calc(100vh - 385px)"},pagination:!1,loading:n},"related"===a?{locale:{emptyText:l.createElement(h.default,{image:h.default.PRESENTED_IMAGE_SIMPLE,description:"\u6682\u65e0\u5173\u8054\u7684\u5de5\u5355"})}}:s))};f.Z.Option;const k=function(e){var t=e.id,n=e.visible,r=e.setVisible,a=e.hideRelateBtn,i=e.list,o=e.relationKind,f=e.listLoading,p=e.onStateChange,h=(0,l.useState)("related"),m=h[0],g=h[1],k=(0,l.useState)(""),w=k[0],E=k[1],I=(0,l.useState)([]),y=I[0],x=I[1],b=function(e,n,r){if("selected"!==e){var a="remove"===e?{id:t,kind:o,workOrderId:n.workOrderId}:n;p(e,a,r)}else x(n)},S=function(e){g(e),p("isRelated","related"===e)};return l.createElement(c.Z,{title:"\u5173\u8054\u5de5\u5355",visible:n,wrapClassName:"relation-modal "+m+" "+(i.length<1?"no-data":""),width:960,centered:!0,destroyOnClose:!0,closeIcon:l.createElement("i",{className:"icon-cem_cancel"}),footer:a?l.createElement(d.default,null):"related"===m?l.createElement("div",{className:"existingBtn"},l.createElement(s.default,{type:"primary",onClick:function(){return S("unRelated")}},"\u5173\u8054\u5df2\u6709\u5de5\u5355")):l.createElement(d.default,null,l.createElement(s.default,{onClick:function(){return S("related")}},"\u53d6\u6d88"),l.createElement(s.default,{type:"primary",onClick:function(){y.length>0&&b("addRelated",y,(function(){return S("related")}))}},"\u5173\u8054")),afterClose:function(){g("related"),E(""),x([])},onCancel:function(){return r(!1)},onOk:function(){r(!1)}},"related"!==m&&l.createElement(l.Fragment,null,l.createElement(u.default,{allowClear:!0,style:{width:"100%"},placeholder:"\u8bf7\u641c\u7d22\u5de5\u5355\u7f16\u53f7\u6216\u5de5\u5355\u6807\u9898\u6765\u5173\u8054",onChange:function(e){e.target.value||(E(e.target.value),p("search-keyword",e.target.value))},onPressEnter:function(e){var t=e.target.value;E(t),p("search-keyword",t)}}),!w&&l.createElement("p",null,"\u6700\u8fd1\u64cd\u4f5c")),l.createElement(v,{list:i,listLoading:f,isRelated:m,selectedRowKeys:y,onStateChange:b}))};var w=n(12021);const E=function(e){function t(t){var n;return(n=e.call(this,t)||this).state=void 0,n.events=void 0,n._handleStateChange=function(e,t,a){var o=n.props.onStateChange;switch(e){case"remove":(0,w.VG)((0,r.Z)({},t,{projectId:n.state.projectId})).then((function(e){2e4===e.data.code&&(i.Z.success("\u53d6\u6d88\u5173\u8054\u6210\u529f"),n._handleFetchList(),o&&o("remove-relate"))}));break;case"isRelated":n._handleFetchList(t);break;case"addRelated":n._handleAddReleted(t,a);break;case"search":case"search-keyword":n._handleFetchList(!1,t)}},n._handleFetchList=function(e,t){void 0===e&&(e=!0),void 0===t&&(t="");var a=n.props,i=a.id,o=a.relationKind,l=n.state,c=l.projectId,u=l.pageIndex,d=l.pageSize;n.setState({listLoading:!0});var s={searchList:[]};i&&(0,w.qH)({id:i,projectId:c,relationKind:o,keyword:t,pageIndex:u,pageSize:d,isRelated:e}).then((function(e){return e.data.result.list&&n.setState((0,r.Z)({list:e.data.result.list,listLoading:!1},t?{}:s))})).catch((function(e){return console.error(e)}))},n._handleAddReleted=function(e,t){return n.props.relatedAdd(e,t)},n.state={projectId:o.t.get(o.V.curProject).id,list:[],searchList:[],keyword:"",pageIndex:0,pageSize:10,listLoading:!1},n.events={onStateChange:n._handleStateChange},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=this.props,n=t.visible,r=t.addedCount,a=t.id;!n||e.visible===n&&e.id===a||this._handleFetchList("string"!==typeof r)},n.render=function(){return l.createElement(k,(0,r.Z)({},this.props,this.state,this.events))},t}(l.Component)},12021:(e,t,n)=>{n.d(t,{qH:()=>a,Im:()=>i,VG:()=>o});var r=n(49722);function a(e){var t=e.id,n=e.projectId,a=e.relationKind,i=e.keyword,o=e.pageIndex,l=e.pageSize,c=e.isRelated;return r.h.get("/workorder/work-order/"+(c?"relation":"unRelation")+"/list",{params:{id:t,projectId:n,relationKind:a,keyword:i,pageIndex:o,pageSize:l}})}function i(e){var t=e.id,n=e.projectId,a=e.kind,i=e.workOrderIdList,o=e.workOrderParam;return r.h.post("/workorder/work-order/relation/add",{id:t,projectId:n,kind:a,workOrderIdList:i,workOrderParam:o})}function o(e){var t=e.id,n=e.kind,a=e.workOrderId,i=e.projectId;return r.h.delete("/workorder/work-order/relation/remove?projectId="+i+"&id="+t+"&kind="+n+"&workOrderId="+a)}},62521:(e,t,n)=>{n.r(t),n.d(t,{default:()=>fe});var r,a=n(87462),i=n(67294),o=n(5133),l=n(35239),c=n(12021),u=n(15861),d=(n(48980),n(20838)),s=n(87757),f=n.n(s);!function(e){e["\u672a\u8bfb"]="no_read",e["\u5f85\u5904\u7406"]="no_process"}(r||(r={}));var p=n(22281),h=n(44600),m=n(32624),g=n(98482),v=n(49722);var k=n(61193),w=n(23279),E=n.n(w);const I=function(){var e=l.t.get(l.V.menu),t=["disabled"];return e.reduce((function(e,n){var r="",a=function(e,n,a){var i="dark"===e.style,o=t.includes(e.style),l=[].concat(n,[i?r:void 0,o?void 0:e.name]).filter(Boolean).join("-");if(i||(r=e.name),a&&(r=""),e.path&&e.name)return{title:e.name,icon:e.icon,key:l,path:e.path}};if("DATA_DASHBOARD"===n.projectType){var i,o=null==(i=n.child)?void 0:i.find((function(e){return e.path&&!t.includes(e.style)}));o&&(delete n.child,n.path=o.path,e.push({title:n.name,icon:n.icon,path:o.path,key:n.name}))}else{var l=n.child.filter((function(e){return"hide"!==e.style})).map((function(e,t){var r;return null!=(r=e.child)&&r.length?{children:e.child.map((function(t,r){return a(t,[n.name,e.name],r===e.child.length-1)})).filter(Boolean),title:e.name,icon:e.icon,key:[n.name,e.name].join("-")}:a(e,[n.name],t===n.child.length-1)})).filter(Boolean);(n.path||l&&l.length)&&e.push({title:n.name,icon:n.icon,path:n.path,key:n.name,children:l})}return e}),[])};var y,x,b,S,C,Z,_,R=n(49101),L=(n(89858),n(51024)),N=n(81880),O=n(29163),A=O.ZP.div(y||(y=(0,N.Z)(["\n  font-weight: 600;\n  text-align: left;\n  color: #262626;\n  line-height: 18px;\n  font-size: 14px;\n"]))),D=O.ZP.div(x||(x=(0,N.Z)(["\n  .icon-box {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 36px;\n    height: 36px;\n    min-width: 36px;\n    background: ",";\n    border-radius: 4px;\n    color: #fff;\n    margin-right: 12px;\n  }\n"])),(function(e){return e.background})),j=(0,O.ZP)(D)(b||(b=(0,N.Z)(["\n  display: flex;\n  align-items: center;\n  height: 70px;\n  background: #fff;\n  width: calc(14.28% - 16px);\n  flex: 1;\n  padding: 16px;\n  margin-bottom: 12px;\n  cursor: pointer;\n  position: relative;\n  font-family: PingFangSC, PingFangSC-Medium;\n  font-weight: 500;\n  text-align: left;\n  color: #262626;\n  margin-right: 16px;\n  @media screen and (max-width: 1440px) {\n    width: 214px;\n    flex: unset;\n  }\n  .icon-cem_delete {\n    display: none;\n    position: absolute;\n    right: 10px;\n    top: 3px;\n    background: #fafafa;\n    border-radius: 4px;\n    color: #8c8c8c;\n    cursor: pointer;\n  }\n  &.unDraggable {\n    cursor: pointer;\n  }\n  &:hover {\n    .icon-cem_delete {\n      display: block;\n    }\n  }\n  > span {\n    max-height: 44px;\n    overflow: hidden;\n    word-break: break-all;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n  }\n  &:last-child {\n    > div {\n      background: ",";\n    }\n  }\n"])),(function(e){return e.background})),T=O.ZP.div(S||(S=(0,N.Z)(["\n  display: flex;\n  flex-direction: column;\n  width: 200px;\n  .quick-item {\n    width: 100%;\n    height: 36px;\n    font-weight: 400;\n    text-align: left;\n    color: #262626;\n    padding: 8px 16px;\n    cursor: pointer;\n    &.active {\n      color: #7262fd;\n      background: #f8f7ff;\n    }\n  }\n"]))),K=(0,O.ZP)(D)(C||(C=(0,N.Z)(["\n  display: flex;\n  align-items: center;\n  margin-bottom: 24px;\n  .update {\n    margin-left: auto;\n    &:not(:disabled) {\n      color: #626262;\n      border-color: #e5e5e5;\n    }\n    &.visible:not(:disabled) {\n      border-color: #7262fd;\n      color: #7262fd;\n    }\n  }\n"]))),P=O.ZP.div(Z||(Z=(0,N.Z)(["\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  padding-left: 36px;\n  overflow-y: auto;\n  padding-right: 10px;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  width: calc(100% - 200px);\n  min-height: 300px;\n"]))),V=(0,O.ZP)(L.default)(_||(_=(0,N.Z)(["\n  height: 32px;\n  line-height: 32px;\n  margin-bottom: 12px;\n"]))),z=n(16941),F=(n(53294),n(56697)),W=(n(1025),n(65400)),U=n(50361),B=n.n(U),H=n(99270),M="\u6700\u8fd1\u6dfb\u52a0",Y=function(e){var t=e.onUpdateList,n=e.projectId,r=e.flattenList,o=e.disable,l=(0,H.Z)({keywords:"",originList:[],groupList:[]}),c=(0,i.useMemo)((function(){return r.reduce((function(e,t){var n=t.key.split("-")[0],r=e.find((function(e){return e.title===n}));return r?(r.children.push(t),e):[].concat(e,[{title:n,children:[t],isActive:!1}])}),[])}),[r]);(0,i.useEffect)((function(){var e=l.groupList.find((function(e){return e.isActive})),t=[{title:M,children:(null==e?void 0:e.children)||[],isActive:!0}].concat(c);t=t.map((function(t){return(0,a.Z)({},t,{isActive:((null==e?void 0:e.title)||M)===t.title})}));var n=B()(t).filter((function(e){return e.title===M&&!e.children.length||(e.children=e.children.filter((function(e){return e.key.includes(l.keywords)})),e.children.length)}));l.groupList=n}),[c]);var d=(0,i.useCallback)(function(){var e=(0,u.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==M){e.next=3;break}return e.next=3,s();case 3:l.groupList.forEach((function(e){e.isActive=e.title===t}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r]),s=function(){var e=(0,u.Z)(f().mark((function e(){var t,a,i,o,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u={module:"SHORT_CUT",projectId:n},v.h.post("/menu/recent",u);case 2:t=e.sent,a=t.data,i=a.result.slice(0,10),o=r.reduce((function(e,t){return i.find((function(e){return e.id===t.path}))&&e.push(t),e}),[]),(c=l.groupList.find((function(e){return e.title===M})))&&(c.children=o.filter((function(e){return e.key.includes(l.keywords)})));case 9:case"end":return e.stop()}var u}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){(0,u.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:case"end":return e.stop()}}),e)})))()}),[]);var p=(0,i.useCallback)(E()((function(e){var t=B()(l.originList).filter((function(t){return t.children=t.children.filter((function(t){return t.key.includes(e)})),t.children.length}));t.forEach((function(e,t){e.isActive=0===t})),l.groupList=t}),500),[r]),h=(0,i.useCallback)((function(e){var t=e.target.value.trim();l.keywords=t,p(t)}),[]),m=l.groupList.find((function(e){return e.isActive})),g=(null==m?void 0:m.children)||[],k=(0,i.useCallback)((function(e){e.isVisible=!e.isVisible,t(e.path,e.isVisible)}),[]);return i.createElement(F.Z,(0,a.Z)({},e,{width:"50%",bodyStyle:{minHeight:380},footer:null}),i.createElement(V,{placeholder:"\u8bf7\u8f93\u5165\u5173\u952e\u8bcd",value:l.keywords,onFocus:function(){l.keywords||(l.originList=B()(l.groupList))},onChange:h,size:"small",suffix:i.createElement("span",null,i.createElement("i",{className:"icon-cem_small-search color-tip"})),allowClear:!0}),i.createElement("div",{className:"flex relative"},i.createElement(T,null,l.groupList.map((function(e){return i.createElement("div",{onClick:function(){return d(e.title)},className:"quick-item "+(e.isActive?"active":""),key:e.title},e.title)}))),i.createElement(P,null,g.map((function(e){return i.createElement(K,{key:e.path,background:e.background},i.createElement("div",{className:"icon-box"},i.createElement("i",{className:"icon-"+e.icon+" icon-cem_"+e.icon+" iconfont"})),e.key,i.createElement(W.default,{disabled:!e.isVisible&&o,onClick:function(){return k(e)},className:"update "+(e.isVisible?"":"visible")},e.isVisible?"\u79fb\u9664":"\u6dfb\u52a0"))})))))};const G=function(e){return e.visible?i.createElement(Y,e):null};var q=n(70715),Q=n(61409),J="WORKBENCH_QUICK_ENTRY",X=["/inbox/commont","/inbox/service","/inbox/questionnaire"],$=[{title:"\u6dfb\u52a0\u5feb\u6377\u5e94\u7528",icon:"addQuick",id:1e3,key:"\u6dfb\u52a0\u5feb\u6377\u5e94\u7528",path:"addQuick",disable:!0,isVisible:!0,background:"#f1f3f4",sortIndex:1e3}];const ee=function(){var e=I(),t=i.useState(!1),n=t[0],r=t[1],o=l.t.get(l.V.curProject).id,c=function e(t){return t.reduce((function(t,n){return t.concat(Array.isArray(n.children)?e(n.children):n)}),[])},d=(0,i.useCallback)((function(e){return e.map((function(e,t){return(0,a.Z)({},e,{background:e.background?e.background:q.OW[t%10],id:e.id||t,icon:"line"===e.icon?"template-combination":e.icon})}))}),[]),s=i.useState((function(){var t=c(e);return d(t).filter((function(e){return"/workspace/overview"!==e.path}))})),p=s[0],h=s[1],m=i.useState([]),g=m[0],k=m[1];(0,i.useEffect)((function(){var e=p.filter((function(e){return e.isVisible})).slice(0,6).sort((function(e,t){return e.sortIndex-t.sortIndex})).concat($);k(e)}),[p]);var w=(0,i.useCallback)(function(){var e=(0,u.Z)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h((function(e){var r=e.map((function(e,r){return(0,a.Z)({},e,{isVisible:t.includes(e.path)?n:e.isVisible})}));return b(r),r}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),y=function(){var e=(0,u.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n={projectId:o,module:"SHORT_CUT",keys:t},v.h.post("/menu/page/click",n);case 2:case"end":return e.stop()}var n}),e)})));return function(t){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){x()}),[]);var x=function(){var e=(0,u.Z)(f().mark((function e(){var t,n,r,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l={projectId:o,key:J},v.h.post("/default/value/find",l);case 2:if(t=e.sent,n=t.data,null!=(r=JSON.parse(n.result))&&r.length){e.next=12;break}return e.next=8,w(X,!0);case 8:return e.next=10,y(X);case 10:e.next=14;break;case 12:i=p.map((function(e,t){var n,i,o=r.find((function(t){return t.path===e.path})),l=null==(n=null==o?void 0:o.isVisible)||n,c=null!=(i=null==o?void 0:o.sortIndex)?i:t;return(0,a.Z)({},e,{isVisible:o?l:e.isVisible,sortIndex:o?c:t})})),h(i);case 14:case"end":return e.stop()}var l}),e)})));return function(){return e.apply(this,arguments)}}(),b=(0,i.useCallback)(E()(function(){var e=(0,u.Z)(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.filter((function(e){return e.isVisible})),e.next=3,r={projectId:o,key:J,value:JSON.stringify(n)},v.h.post("/default/value/update",r);case 3:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}(),100),[]),S=(0,i.useCallback)(function(){var e=(0,u.Z)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w([t],n);case 2:return e.next=4,y([t]);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[p]),C=(0,i.useCallback)((function(e,t){t&&h((function(t){var n=e.map((function(e,t){return(0,a.Z)({},e,{sortIndex:t+100})})),r=t.map((function(e){return n.find((function(t){return t.path===e.path}))||e}));return b(n),r}))}),[]),Z=(0,i.useCallback)((function(){r(!1)}),[]);return i.createElement(i.Fragment,null,i.createElement(A,null,"\u5feb\u6377\u5e94\u7528"),i.createElement("div",{className:"mt-15 mb-5 flex"},i.createElement(z._O,{className:"flex flex-wrap",list:g,delay:5,animation:150,style:{marginRight:"-16px"},draggable:".draggable",setList:C},g.map((function(e){var t="addQuick"===e.icon;return i.createElement(j,{onClick:function(){t?r(!0):Q.mW.push(e.path)},className:e.disable?"unDraggable":"draggable",background:e.background,key:e.path},!t&&i.createElement("i",{onClick:function(t){t.stopPropagation(),w([e.path],!1)},className:"icon-cem_delete iconfont"}),i.createElement("div",{className:"icon-box"},t?i.createElement(R.Z,{style:{fontSize:16,color:"#8c8c8c"}}):i.createElement("i",{className:"icon-"+e.icon+" icon-cem_"+e.icon+" iconfont"})),i.createElement("span",{title:e.key},e.key))})))),i.createElement(G,{visible:n,onUpdateList:S,projectId:o,flattenList:p,disable:7<=g.length,title:"\u6dfb\u52a0\u5feb\u6377\u5e94\u7528",onOk:Z,onCancel:Z}))};var te=n(97326),ne=n(94578),re=n(96889),ae=n(30381),ie=n.n(ae),oe=n(69042);const le=function(e){var t=e.owner,n=e.userList,r=e.dataList,a=e.loading,o=e.pagination,l=e.stateList,c=(e.isShow,e.editStateId,e.EditModalCallback,e.onFresh),u=(e.handleShowRemark,e.onStateChange,e.getPagination),d=(0,i.useState)(!1),s=d[0],f=d[1],p=(0,i.useState)(""),h=p[0],g=p[1],v=function(){null==c||c()},k=[{title:"\u7f16\u53f7",dataIndex:"code",key:"code",width:"100px",render:function(e,t){return i.createElement("a",{onClick:function(){g(t.workOrderId),f(!0)}},e)}},{title:"\u6807\u9898",dataIndex:"title",key:"title",width:"300px",render:function(e,t){return i.createElement("a",{onClick:function(){g(t.workOrderId),f(!0)}},e)}},{title:"\u4f18\u5148\u7ea7",dataIndex:"priorityName",key:"priorityName",width:"130px",render:function(e){return e},sorter:!0},{title:"\u521b\u5efa\u4eba",dataIndex:"creator",key:"creator",width:"130px"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"createdAt",key:"createdAt",render:function(e){return"-"!==e?ie()(e).format("YYYY/MM/DD HH:mm"):"--"},sorter:!0,width:"150px"},{title:"\u622a\u6b62\u65f6\u95f4",dataIndex:"dueAt",key:"dueAt",width:"150px",render:function(e){return"-"!==e?ie()(e).format("YYYY/MM/DD HH:mm"):"--"},sorter:!0},{title:"\u64cd\u4f5c",key:"action",width:"150px",render:function(e,r){return i.createElement(oe.Z,{userList:n,assignee:t,workOrderId:r.workOrderId,status:r.stateId,moveTypeName:"queue",statusOptions:l,showBtns:["tk-assign","tk-startHandle"],onStateChange:v})}}];return i.createElement(i.Fragment,null,i.createElement("div",{className:"to-do-list-table"},i.createElement(re.ZP,{search:!1,options:!1,columns:k,rowKey:function(e){return e.id},dataSource:r,pagination:o,loading:a,onChange:function(e,t,n){u(e,n)},scroll:{x:"auto"}})),i.createElement(m.Z,{visible:s,editType:"edit",workOrderId:h,stateList:l,setVisible:function(e,t){f(e),!e&&g(""),t&&c()}}))};var ce=localStorage.getItem("__user__");const ue=function(e){function t(t){var n;return(n=e.call(this,t)||this).events=void 0,n._handleStateChange=function(e,t){"closeRemarkModal"===e&&n.setState((0,a.Z)({},t))},n.state={projectId:l.t.get(l.V.curProject).id,dataList:[],loading:!1,stateId:"",userList:[],owner:encodeURIComponent(JSON.parse(ce).userId),orderKind:"CREATED_LATEST",pagination:{current:1,pageSize:10,total:0,showSizeChanger:!0,size:"small"},stateList:[],isShow:!1,editStateId:"",EditModalCallback:null},n.events={getPagination:n._getPagination.bind((0,te.Z)(n)),onStateChange:n._handleStateChange.bind((0,te.Z)(n)),onFresh:n._handleFresh.bind((0,te.Z)(n))},n}(0,ne.Z)(t,e);var n=t.prototype;return n._fetchWorkOrderTodoList=function(){var e=this,t=this.state,n=t.projectId,r=t.pagination,a=t.stateId,i=t.orderKind,o=B()(r);this.setState({loading:!0}),function(e){var t=e.stateId,n=e.projectId,r=e.pageIndex,a=e.pageSize,i=e.orderKind;return v.h.get("/workorder/work-order/list/"+t+"?workOrderSceneKind=LIST&projectId="+n+"&pageIndex="+r+"&pageSize="+a+"&orderKind="+i)}({projectId:n,pageIndex:r.current,pageSize:r.pageSize,stateId:a,orderKind:i}).then((function(t){if(2e4===t.data.code){var n=t.data.result.list;o.total=t.data.result.total,e.setState({dataList:n,pagination:o})}})).finally((function(){e.setState({loading:!1})}))},n._getStateList=function(){var e=this;return function(e){var t=e.projectId;return v.h.get("/workorder/work-order-status/list?projectId="+t,{})}({projectId:this.state.projectId}).then((function(t){if(2e4===t.data.code){var n=t.data.result;e.setState({stateId:n.filter((function(e){return"PENDING"===e.kind}))[0].id,stateList:n})}}))},n._getUserList=function(e){var t=this;void 0===e&&(e=""),function(e){var t=e.userName;return v.h.get("/workorder/user/list/?userName="+t)}({userName:e}).then((function(e){if(2e4===e.data.code){var n=e.data.result.filter((function(e){return 0!==e.status}));t.setState({userList:n})}}))},n._getPagination=function(e,t){var n=this;this.setState({pagination:e}),"priorityName"===t.columnKey&&"ascend"===t.order?this.setState({orderKind:"PRIORITY_LOWEST"}):"priorityName"===t.columnKey&&"descend"===t.order?this.setState({orderKind:"PRIORITY_HIGHEST"}):"createdAt"===t.columnKey&&"ascend"===t.order?this.setState({orderKind:"CREATED_EARLIEST"}):"createdAt"===t.columnKey&&"descend"===t.order?this.setState({orderKind:"CREATED_LATEST"}):"dueAt"===t.columnKey&&"ascend"===t.order?this.setState({orderKind:"DUE_ASC"}):"dueAt"===t.columnKey&&"descend"===t.order?this.setState({orderKind:"DUE_DESC"}):this.setState({orderKind:"CREATED_LATEST"}),setTimeout((function(){n._fetchWorkOrderTodoList()}),200)},n._handleFresh=function(){this._fetchWorkOrderTodoList(),this.props.getWorkeroderNum()},n.componentDidMount=function(){var e=this;this._getUserList(),this._getStateList().then((function(t){e._fetchWorkOrderTodoList()}))},n.componentWillUnmount=function(){},n.render=function(){return i.createElement(le,(0,a.Z)({},this.props,this.state,this.events))},t}(i.Component);var de=d.default.TabPane;const se=function(e){var t=i.useState(void 0),n=t[0],o=t[1],c=(0,i.useState)(r["\u672a\u8bfb"]),s=c[0],w=c[1],E=(0,i.useState)(!1),I=E[0],y=E[1],x=(0,i.useState)(!1),b=x[0],S=x[1],C=(0,i.useState)(0),Z=C[0],_=C[1],R=(0,i.useState)(void 0),L=R[0],N=R[1],O=i.useState(0),A=O[0],D=O[1],j=(0,i.useState)({list:[],total:void 0,pageIndex:1,pageSize:10,loading:!1}),T=j[0],K=j[1],P=function(){var e=(0,u.Z)(f().mark((function e(){var t,n,r,i,o,c,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,K((function(e){return(0,a.Z)({},e,{loading:!0})})),t=T.pageIndex,n=T.pageSize,e.next=5,s={pageIndex:t,pageSize:n,projectId:l.t.get(l.V.curProject).id},v.h.post("/warning/manage/notify/list",(0,a.Z)({},s,{searchType:"USER",logStatus:"UNREAD"}));case 5:r=e.sent,i=(r||{}).data,o=(i||{}).result,u=(c=o||{}).result,d=c.count,K((function(e){return(0,a.Z)({},e,{total:d,list:u})}));case 10:return e.prev=10,K((function(e){return(0,a.Z)({},e,{loading:!1})})),e.finish(10);case 13:case"end":return e.stop()}var s}),e,null,[[0,,10,13]])})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){V()}),[]);var V=function(){var e=l.t.get(l.V.curProject).id;(function(e){var t=e.projectId;return v.h.get("/workorder/work-order-status/list?projectId="+t,{})})({projectId:e}).then((function(t){2e4===t.data.code&&function(e){var t=e.stateId,n=e.projectId;return v.h.get("/workorder/work-order/list/"+t+"?workOrderSceneKind=LIST&projectId="+n+"&pageIndex=1&pageSize=10")}({stateId:t.data.result.filter((function(e){return"PENDING"===e.kind}))[0].id,projectId:e}).then((function(e){if(2e4===e.data.code){var t=e.data.result.total;D(t)}}))}))};(0,i.useEffect)((function(){P()}),[T.pageIndex,T.pageSize]);var z=function(e){y(!1),_(e?""+(Z+1):Z+1),!e&&P()},F=function(e,t){!e&&N(null),_(0),(t?S:y)(e)},W=function(e,t){if(e.indexOf("open")>-1)return("related"===e.split("_")[1]?S:y)(!0),void N(t)};return i.createElement(i.Fragment,null,i.createElement("div",{className:"event_workbench_page_view"},i.createElement(ee,null),i.createElement("div",{className:"content-wrapper"},i.createElement(d.default,{activeKey:s,onChange:function(e){w(e)}},k.Z.hasAuthority("WARNING_NOTIFY")&&function(){var e=T.loading,t=T.list,o=T.total,l=T.pageSize,c=T.pageIndex;return i.createElement(i.Fragment,null,i.createElement(de,{tab:"\u672a\u8bfb\u9884\u8b66   "+(T.total||0),key:r["\u672a\u8bfb"]},i.createElement(p.Z,{table:{loading:e,data:t,pagination:{total:o||0,current:c,pageSize:l},onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],i=r.pageSize,o=r.current;K((function(e){return(0,a.Z)({},e,{pageSize:i,pageIndex:o})}))}},openDetail:{onClick:function(e){n.wrappedInstance.ready(e,(function(){return P()}))}},onStateChange:W})))}(),["BOARD_WORK_ORDER","LIST_WORK_ORDER"].some((function(e){return k.Z.hasAuthority(e)}))&&i.createElement(de,{tab:"\u5f85\u5904\u7406\u5de5\u5355   "+A,key:r["\u5f85\u5904\u7406"]},i.createElement(ue,{getWorkeroderNum:V})))),i.createElement(h.Z,{ref:o}),i.createElement(m.Z,{visible:I,warningId:null==L?void 0:L.warningId,editType:"new",otherConfig:{hideSetting:!0,relatedAdd:function(t){return e.onRelated({id:null==L?void 0:L.warningLogId,params:t},z)}},setVisible:function(e,t){return F(e,!1)}}),i.createElement(g.Z,{id:null==L?void 0:L.warningLogId,addedCount:Z,visible:b,relationKind:"WARNING",relatedAdd:function(t){return e.onRelated({id:null==L?void 0:L.warningLogId,params:t},z,"list")},hideRelateBtn:!0,setVisible:function(e,t){return F(e,!0)}})))};const fe=function(e){var t={onRelated:function(e,t,n){var r=e.id,i=e.params,u=l.t.get(l.V.curProject).id;(0,c.Im)((0,a.Z)({id:r,projectId:u,kind:"WARNING"},n?{workOrderIdList:i}:{workOrderParam:(0,a.Z)({projectId:u},i)})).then((function(e){return 2e4===e.data.code&&o.Z.success(n?"\u5de5\u5355\u5173\u8054\u6210\u529f":"\u5de5\u5355\u521b\u5efa\u6210\u529f")&&t(n)})).catch((function(e){return console.error(e)}))}};return i.createElement(se,(0,a.Z)({},e,t))}}}]);