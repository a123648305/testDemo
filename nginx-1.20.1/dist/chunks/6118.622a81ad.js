"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6118],{86118:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var n=a(87462),i=a(97326),l=a(94578),r=a(67294),o=a(8833),s=a(87920),u=a(55363),c=a(35239),d=a(55609),f=a(64396).Z.public.menu,p=function(e){function t(t){var a;a=e.call(this,t)||this;var n=window.location.pathname;return a.state={boardId:n.substring(n.lastIndexOf("/")+1)},a.viewRef=void 0,a._handleOnFilterChange=a.handleOnFilterChange.bind((0,i.Z)(a)),a}(0,l.Z)(t,e);var a=t.prototype;return a.handleOnFilterChange=function(){var e=arguments,t=this;setTimeout((function(){t.viewRef&&t.viewRef.active({filterArgs:Array.from(e),questionnaireBoardId:t.state.boardId})}),500)},a.render=function(){var e=this,t=this.state.boardId,a=(this.props.boardList?this.props.boardList[c.t.get(c.V.curProject).id]:[]).find((function(e){return e.id===t}));return r.createElement(o.Z,{title:r.createElement(u.Z,{titles:[{title:"\u770b\u677f",url:""},{title:a?a.name:"",url:""}]}),expandInfo:{boardId:t},className:"yt_research_sat_boarder_wrapper",pageType:"RESEARCH_BOARD_SATISFACTION",onReady:this._handleOnFilterChange,onChange:this._handleOnFilterChange,noSavingFilterList:!0},r.createElement(s.Z,{ref:function(t){return e.viewRef=t&&t.wrappedInstance}}))},t}(r.Component);const m=(0,d.connect)((function(e){return{boardList:(0,n.Z)({},e)[f].menuList.questionnaireBoards}}))(p)},87920:(e,t,a)=>{a.d(t,{Z:()=>S});var n=a(63366),i=a(87462),l=a(94578),r=a(67294),o=a(64396),s=a(55609),u=a(35239),c=a(10291),d=a(79260),f=(a(61210),a(50976)),p=a(8201),m=a(60496),y=a(98191),h=a(43036),v=(a(18446),a(70715)),g=a(94644),I=a(39432),D={none:{image:"data:image/svg+xml;base64,PHN2ZyBpZD0i5Zu+5bGCXzEiIGRhdGEtbmFtZT0i5Zu+5bGCIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDY0IDY0Ij48dGl0bGU+Y2VtPC90aXRsZT48cG9seWdvbiBwb2ludHM9IjMyIDUwLjQ1IDEyLjg0IDYwLjI5IDE2LjUgMzkuNDYgMSAyNC43IDIyLjQyIDIxLjY3IDMyIDIuNzEgNDEuNTggMjEuNjcgNjMgMjQuNyA0Ny41IDM5LjQ2IDUxLjE2IDYwLjI5IDMyIDUwLjQ1IiBmaWxsPSIjZTVlNWU1IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4="},harf:{image:"data:image/svg+xml;base64,PHN2ZyBpZD0i5Zu+5bGCXzEiIGRhdGEtbmFtZT0i5Zu+5bGCIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDY0IDY0Ij48dGl0bGU+Y2VtPC90aXRsZT48cGF0aCBkPSJNNjMsMjQuN2wtMjEuNDItM0wzMiwyLjcxVjUwLjQ1bDE5LjE2LDkuODNMNDcuNSwzOS40NloiIGZpbGw9IiNlNWU1ZTUiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjxwYXRoIGQ9Ik0yMi40MiwyMS42NywxLDI0LjcsMTYuNSwzOS40NiwxMi44NCw2MC4yOSwzMiw1MC40NVYyLjcxWiIgZmlsbD0iI2QwN2I0OSIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+"},full:{image:"data:image/svg+xml;base64,PHN2ZyBpZD0i5Zu+5bGCXzEiIGRhdGEtbmFtZT0i5Zu+5bGCIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDY0IDY0Ij48dGl0bGU+Y2VtPC90aXRsZT48cG9seWdvbiBwb2ludHM9IjMyIDUwLjQ1IDEyLjg0IDYwLjI5IDE2LjUgMzkuNDYgMSAyNC43IDIyLjQyIDIxLjY3IDMyIDIuNzEgNDEuNTggMjEuNjcgNjMgMjQuNyA0Ny41IDM5LjQ2IDUxLjE2IDYwLjI5IDMyIDUwLjQ1IiBmaWxsPSIjZDA3YjQ5IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4="}},E=function(e,t){var a="";return a=e<=t?"full":"none",Math.floor(t)!==Number(t)&&Math.floor(t)+1===e&&(a="harf"),D[a].image};const b=function(e){var t=e.data,a=e.dateOptions,n=e.defaultDateType,i=e.setDefaultValue,l=e.flavorObj,o=e.className,s=e.fetchSatisAnalyzeData,u=r.useState(void 0),c=u[0],d=u[1],h=r.useState(void 0),D=h[0],b=h[1],w=r.useState(void 0),C=w[0],Z=w[1];return r.useEffect((function(){D&&c&&function(e,t){t.clear(),t.setOption(e)}(D,c)}),[D,c]),r.useEffect((function(){if(t){var e=function(e,t,a){if(0===e.list.length)return"empty";var n=e.list;return{axisPointer:{link:{xAxisIndex:"all"}},title:{text:t},tooltip:{formatter:function(e){return(e||[]).map((function(e){return'<span style="font-weight: bold;font-size: 12px">'+e.name+"</span><br/>"+e.marker+e.seriesName+"\uff1a"+(null===e.data?"-":e.data)})).join("<br/><br/>")}},xAxis:[{type:"category",data:n.map((function(e){return(0,I.yV)(a,e.time)})),boundaryGap:!1},{type:"category",data:n.map((function(e){return(0,I.yV)(a,e.time)})),gridIndex:1,show:!1,boundaryGap:!1}],yAxis:[{type:"value",name:"\u6ee1\u610f\u5ea6",nameTextStyle:{color:"#262626",padding:[0,0,10,0]},minInterval:1,splitNumber:3},{type:"value",axisLine:{show:!1},axisLabel:{show:!1},gridIndex:1,name:"\u7b54\u9898\u6570\u91cf",nameTextStyle:{color:"#262626"}}],dataZoom:[{type:"slider",show:!0,realtime:!0,xAxisIndex:[0,1],height:16,top:335}],grid:[{left:470,right:50,top:80,height:"32%",tooltip:{trigger:"axis"}},{left:470,right:50,top:265,gridIndex:1,height:"15%",tooltip:{trigger:"axis"}}],graphic:[{type:"text",left:"84",top:"104",silent:!0,style:{text:e.satisfactionValue,fill:"#262626",font:"60px "+v.I8}},{type:"text",left:"84",top:268,silent:!0,style:{text:"\u7b54\u9898\u5ba2\u6237\u6570",fill:"#8C8C8C",font:"14px "+v.I8}},{type:"text",left:"178",top:268,silent:!0,style:{text:e.total,fill:"#262626",font:"14px "+v.I8}}].concat(new Array(5).fill(0).map((function(t,a){return{type:"image",left:83+36*a,top:194,scale:[2,2],style:{image:E(a+1,e.satisfactionValue),width:"14"}}})),new Array(11).fill(0).map((function(e,t){return{type:"line",shape:{x1:84+16*t,y1:244,x2:90+16*t,y2:244},style:{fill:"#E5E5E5",stroke:"#E5E5E5"},cursor:"none"}}))),series:[{data:n.map((function(e){return e.satisfactionValue})),type:"line",smooth:!0,symbol:"circle",symbolSize:2.5,markLine:{symbolSize:0,data:[{type:"average",name:"\u5e73\u5747\u7ebf"}],lineStyle:{color:"#BFBFBF"},label:{show:!1,formatter:"\u5747\u503c"}},lineStyle:{color:"#0074B8"},name:"\u6ee1\u610f\u5ea6"},{data:n.map((function(e){return e.questionnaireTotal})),type:"line",smooth:!0,symbol:"circle",symbolSize:2,xAxisIndex:1,yAxisIndex:1,areaStyle:{color:"#E7F1F7"},itemStyle:{color:"#1574B3"},lineStyle:{color:"#1574B3"},name:"\u7b54\u9898\u6570\u91cf"}]}}(t,"\u6ee1\u610f\u5ea6",C);b(e)}}),[t]),r.useEffect((function(){l&&Z(a.some((function(e){return e.value===l.satisAnalyze}))?l.satisAnalyze:n)}),[l,n,a]),r.createElement(p.Z,{data:D,className:"yt_research_analyze_line_chart_wrap "+(o||""),renderTitle:r.createElement(y.Z,{data:D,onMoreClick:function(e){return function(e,t,a){var n=void 0;"image"===t?(n=e,(0,g._v)(e,"\u6ee1\u610f\u5ea6\u5206\u6790")):"data"===t&&((n=a.list.map((function(e){return[e.time,e.satisfactionValue||"",e.questionnaireTotal]}))).unshift(["\u65e5\u671f","\u6ee1\u610f\u5ea6","\u7b54\u9898\u6570\u91cf"]),n=[n],(0,g.aT)(n,"\u6ee1\u610f\u5ea6\u5206\u6790"))}(c,e,t)},title:"\u6ee1\u610f\u5ea6",titleOverlay:"\u6ee1\u610f\u5ea6\u5206\u503c\u7684\u5747\u503c"},r.createElement("div",null,r.createElement(m.Z,{onChange:function(e){Z(e),s({dateGroupType:e})},activeObj:C,options:a,flavor:(l||{}).satisAnalyze,onFlavorChange:function(e){return i({key:"satisAnalyze",value:e})}})))},r.createElement(f.Z,{theme:"yunting_multi_color",loadingOption:{text:"\u52a0\u8f7d\u4e2d",color:"#20a0ff"},option:{},opts:{devicePixelRatio:2},style:{width:"100%",height:"100%"},onChartReady:function(e){return d(e)}}))};var w=a(29383);a(98245);var C=[{title:"\u6ee1\u610f\u5ea6\u5bf9\u6bd4",value:0},{title:"\u7b54\u5377\u6570\u91cf\u5bf9\u6bd4",value:1}];function Z(e,t,a){e&&t&&new Promise((function(t){var n=function(e,t){var a=Math.max.apply(Math,e.map((function(e){return e[t?"questionnaireTotal":"satisfactionValue"]})));return{title:{text:"\u5404\u7701\u6ee1\u610f\u5ea6\u5bf9\u6bd4\u548c\u7b54\u9898\u6570"},tooltip:{formatter:function(e){var a=e.marker,n=e.data,i=n.name,l=n.value,r=n.other;return[a+'<span style="font-size: 16px; line-height: 30px">'+i+"</span>",(0===t?"\u6ee1\u610f\u5ea6\uff1a":"\u7b54\u5377\u6570\u91cf\uff1a")+(0===t&&.99===l?"\u65e0":l),(0===t?"\u7b54\u5377\u6570\u91cf\uff1a":"\u6ee1\u610f\u5ea6\uff1a")+(0===t?r:.99===r?"\u65e0":r)].join("<br/>")}},visualMap:{bottom:20,min:0===t?.99:0,max:0===t?5:0===a?1:a,text:0===t?["5\u5206","1\u5206"]:["\u9ad8","\u4f4e"],range:0===t?[1,5]:void 0,inRange:{color:0===t?["#D96969","#0074B8","#15B374"]:["white","#1474B3"]},outOfRange:{color:["white"]},itemWidth:10,itemHeight:80,top:350,left:40},series:[{left:70,type:"map",map:"china",label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{emphasis:{areaColor:"#CDB446"}},data:e.map((function(e){return{name:e.province.replace("\u7701",""),value:0===t?null===e.satisfactionValue?.99:e.satisfactionValue:e.questionnaireTotal,other:0===t?e.questionnaireTotal:null===e.satisfactionValue?.99:e.satisfactionValue}}))}]}}(e,a);t(n)})).then((function(e){t.clear(),t.setOption(e)}))}const x=function(e){var t=e.data,a=e.flavorObj,n=e.loading,i=e.setDefaultValue,l=r.useState(void 0),o=l[0],s=l[1],u=r.useState(0),c=u[0],d=u[1];return r.useEffect((function(){Z(t,o,c)}),[t,o,c]),r.useEffect((function(){d((a||{}).mapAnalyze||0)}),[a]),r.createElement(p.Z,{className:"research_analyze_map",renderTitle:r.createElement(y.Z,{data:t,onMoreClick:function(e){return function(e,t,a,n){var i=void 0;"image"===t?(i=e,(0,g._v)(e,n)):"data"===t&&((i=a.map((function(e){return[e.province,e.satisfactionValue?e.satisfactionValue:"\u65e0",e.questionnaireTotal]}))).unshift(["\u7701\u4efd","\u6ee1\u610f\u5ea6","\u7b54\u9898\u6570\u91cf"]),i=[i],(0,g.aT)(i,"\u5404\u7701\u6ee1\u610f\u5ea6\u5bf9\u6bd4\u548c\u7b54\u9898\u6570"))}(o,e,t,0===e?"\u6ee1\u610f\u5ea6\u5bf9\u6bd4":"\u7b54\u5377\u6570\u91cf\u5bf9\u6bd4")},title:"\u5404\u7701\u6ee1\u610f\u5ea6\u5bf9\u6bd4\u548c\u7b54\u9898\u6570",titleOverlay:r.createElement("div",null,r.createElement("div",null,"\u6536\u96c6\u5230\u6ee1\u610f\u5ea6\u7684\u5206\u503c\u9898\u5c31\u7b971\u4e2a\u7b54\u9898"),r.createElement("div",null,"\u5ba2\u6237\u7684\u57ce\u5e02\u662f\u4f9d\u636e\u7b54\u9898\u8bbf\u95ee\u95ee\u5377\u65f6\u83b7\u5f97\u7684IP"),r.createElement("div",null,"\u5730\u5740\u89e3\u6790\u5f97\u51fa"))},r.createElement(m.Z,{onChange:function(e){d(e)},activeObj:c,options:C,flavor:(a||{}).mapAnalyze||null,onFlavorChange:function(e){return i({key:"mapAnalyze",value:e})}})),data:t,defTitle:"\u5404\u7701NPS\u503c\u5bf9\u6bd4",loading:n},r.createElement("div",{className:"chart"},r.createElement(f.Z,{theme:"yunting_pos_neu_neg",option:{},style:{width:"100%",height:"100%"},onChartReady:function(e){return s(e)}})),r.createElement("div",{className:"table"},r.createElement(w.Z,{columns:[{label:"\u7701\u4efd",prop:"province"},{label:r.createElement("div",{style:{background:"white"}},"\u6ee1\u610f\u5ea6",r.createElement(h.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:"\u6ee1\u610f\u5ea6\u5206\u503c\u7684\u5747\u503c"},r.createElement("i",{className:"icon-cem_file1"}))),prop:"satisfactionValue",render:function(e){return r.createElement("div",null,e.satisfactionValue?e.satisfactionValue:"\u65e0")}},{label:"\u7b54\u9898\u6570\u91cf",prop:"questionnaireTotal"}],data:t,currentPage:1,total:34})))};a(54898);const N=function(e){var t=e.fetchingSatConcerns,a=e.doubleBarChartData,n=e.graphPieChartData,i=(e.wordChartData,e.fetchSatisAnalyzeData),l=e.satisAnalyzeData,o=e.fetchingSatisCustomerData,s=e.satisCustomerData,u=e.graphicData,f=e.custDataType,p=e.custTimeType,m=e.onFilterChange,y=e.mapData,h=e.dateOptions,v=e.defaultDateType,g=e.flavorObj,I=e.setDefaultValue;e.relativeData,e.relativeRefreshTime,e.relativeDataLoading;return r.createElement("div",{className:"yt_research_satisfaction_analysis_wrapper"},r.createElement(b,{data:l,dateOptions:h,defaultDateType:v,setDefaultValue:I,flavorObj:g,fetchSatisAnalyzeData:i}),r.createElement(c.Z,{loading:o,title:"\u6ee1\u610f\u5ea6\u5ba2\u6237\u5206\u7c7b",titleOverlay:r.createElement("div",null,r.createElement("div",null,"\u597d\u8bc4\uff1a4\u5206\u548c5\u5206"),r.createElement("div",null,"\u4e2d\u8bc4\uff1a3\u5206"),r.createElement("div",null,"\u5dee\u8bc4\uff1a1\u5206\u548c2\u5206")),type:"SATISFACTION",dateOptions:h,customerData:s,graphicData:u,dataType:f,timeType:p,defaultDateType:v,defaultDataType:g&&g.fCustDataType,setDefaultValue:I,flavorObj:g&&g,onFilterChange:m}),r.createElement(x,{setDefaultValue:I,flavorObj:g,data:y}),r.createElement(d.Z,{title:"\u597d\u8bc4\u5ba2\u6237\u548c\u5dee\u8bc4\u5ba2\u6237\u5173\u6ce8\u70b9\u5bf9\u6bd4",overlay:r.createElement("div",null,r.createElement("div",null,"\u597d\u8bc4\uff1a4\u5206\u548c5\u5206"),r.createElement("div",null,"\u4e2d\u8bc4\uff1a3\u5206"),r.createElement("div",null,"\u5dee\u8bc4\uff1a1\u5206\u548c2\u5206")),positiveTitle:"\u597d\u8bc4\u5ba2\u6237",negativeTitle:"\u5dee\u8bc4\u5ba2\u6237",doubleBarChartData:a,defaultDataType:g&&g.fBarCompareType,setDefaultValue:I,graphPieChartData:n,loading:t}))};var T=["loading"],j=o.Z.research.analyze.satisfaction,L=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleOnWsMessage=function(e){var t=e.data;if(t.type&&"ws"===t.type){var n=t.payload,i=n.type,l=n.result;"QUESTIONNAIRE_TEXT_RESULT"===i&&a.props.save({relativeData:l.data.length?l.data:"empty",relativeRefreshTime:l.createdAt,relativeDataLoading:!1})}},a._handleOnFilterChange=function(e){e.dateGroupType&&a.props.fetchSatisCustomerData({dateGroupType:e.dateGroupType})},a.state={},a.event={onFilterChange:a._handleOnFilterChange},a}(0,l.Z)(t,e);var a=t.prototype;return a.active=function(e){var t=e.filterArgs,a=(e.title,e.questionnaireId),n=e.questionnaireBoardId,i=t[0],l=(t[1],t[2]);this.props.fetchDatas({filterModel:i.filterValue,dateFilter:i.dateFilter,dateOptions:l.dateOptions,defaultDateType:l.defaultDateType,projectId:u.t.get(u.V.curProject).id,questionnaireId:a,questionnaireBoardId:n,pageType:"research_satis"})},a.componentDidMount=function(){window.addEventListener("message",this._handleOnWsMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage),this.props.clear()},a.render=function(){return r.createElement(N,(0,i.Z)({},this.props,this.state,this.event))},t}(r.PureComponent);const S=(0,s.connect)((function(e){var t=e.loading,a=(0,n.Z)(e,T);return(0,i.Z)({},a[j],{fetchingSatConcerns:t.effects[j+"/fetchSatConcerns"]||!1,fetchSatisCustomerData:t.effects[j+"/fetchSatisCustomerData"]||!1})}),(function(e){return{save:function(t){return e({type:j+"/save",payload:t})},fetchSatisAnalyzeData:function(t){return e({type:j+"/fetchSatisAnalyzeData",payload:t})},setDefaultValue:function(t){return e({type:j+"/setDefaultValue",payload:t})},fetchDatas:function(t){return e({type:j+"/fetchDatas",payload:t})},fetchSatisCustomerData:function(t){return e({type:j+"/fetchSatisCustomerData",payload:t})},clear:function(t){return e({type:j+"/clear",payload:t})}}}),null,{withRef:!0})(L)}}]);