(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6219],{16219:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>S});function a(e){return u().createElement("span",{style:{display:"block",width:"100%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e},e)}var i=n(85354),r=n.n(i),c=n(67154),l=n.n(c),t=n(37316),o=n.n(t),i=n(67294),u=n.n(i),p=n(92360),m=n(29383),h=n(19586),s=n(5133),c=n(55609),f=n(61193),d=n(36144),g=n(43036),k=n(35239),y=n(23942),b=n(6637),t=n(30381),w=n.n(t),E=n(64396).Z.price.historyPrice,v={"北京":"京","上海":"沪","广州":"穗","深圳":"深"},n=function(e){return u().createElement("div",{style:{maxWidth:300}},e)},C={"日期":{label:"日期",prop:"day",width:100,fixed:"left",sortable:"custom",render:function(e){return e.day?w()(e.day).format("YYYY-MM-DD"):""}},"品牌":{label:"品牌",minWidth:80,render:function(e,t){return a(e[t.prop])}},"型号":{label:"型号",minWidth:80,render:function(e,t){return a(e[t.prop])}},"商品标题":{label:"商品标题",prop:"title",minWidth:120,render:function(e,t){return u().createElement("a",{style:{color:"#0847A6",display:"block",width:"100%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},target:"_blank",rel:"noopener noreferrer",href:e.url,title:e.title,onClick:function(e){return e.stopPropagation()}},e.title)}},"单品到手价":{label:u().createElement("span",null,"单品到手价",u().createElement(g.Z,{overlay:n("只购买1件单品就能获得优惠对应的到手价，取当天最低。"),placement:"top"},u().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),prop:"takePrice",width:105,sortable:"custom"},"单品拼单价":{label:u().createElement("span",null,"单品拼单价",u().createElement(g.Z,{overlay:n("购买多件单品时能够获得的最大优惠对应的到手价，取当天最低。其中，最大优惠按单品的挂牌价分摊。"),placement:"top"},u().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),prop:"groupTakePrice",width:90},"完美拼单价":{label:u().createElement("span",null,"完美拼单价",u().createElement(g.Z,{overlay:n("在平台券和店铺券等基础上，与其他商品进行拼单时能够获得的最大优惠对应的到手价，取当天最低。其中，最大优惠按单品的挂牌价分摊。"),placement:"top"},u().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),prop:"perfectGroupTakePrice",width:90},"当天最低价":{label:u().createElement("span",null,"当天最低价",u().createElement(g.Z,{overlay:n("当天「单品到手价」、「单品拼单价」和「完美拼单价」三个中最低的价格。"),placement:"top"},u().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),prop:"minPrice",width:105,align:"center",sortable:"minPrice"},"下架/缺货":{label:"下架/缺货",prop:"takePrice",width:80,render:function(e){return a(0<e.takePrice?function(e){if(e.stock){var t=Object.keys(v),e=e.stock.cityStockModels.filter(function(e){return t.includes(e.city)&&"无货"===e.stockState});return e&&e.length?e.map(function(e){return v[e.city]+"无货"}).join(","):"_"}return"_"}(e):"下架")}},"单品优惠券":{label:"单品优惠券",prop:"skuQuan",width:84,align:"center",render:function(e){return u().createElement("div",{className:"ellipisis",style:{maxWidth:84}},e.skuQuan&&u().createElement(g.Z,{placement:"topLeft",overlay:JSON.parse(e.skuQuan).map(function(e,t){return u().createElement("span",{key:t},e,u().createElement("br",null))})},u().createElement("span",null,JSON.parse(e.skuQuan).map(function(e,t){return u().createElement("span",{key:t},e," ")}))))}},"店铺优惠券":{label:"店铺优惠券",prop:"storeQuan",width:84,align:"center",render:function(e){return u().createElement("div",{className:"ellipisis",style:{maxWidth:84}},e.storeQuan&&u().createElement(g.Z,{placement:"topLeft",overlay:JSON.parse(e.storeQuan).map(function(e,t){return u().createElement("span",{key:t},e,u().createElement("br",null))})},u().createElement("span",null,JSON.parse(e.storeQuan).map(function(e,t){return u().createElement("span",{key:t},e," ")}))))}},"行业优惠券":{label:"行业优惠券",prop:"industryQuan",width:84,align:"center",render:function(e){return u().createElement("div",{className:"ellipisis",style:{maxWidth:84}},e.industryQuan&&u().createElement(g.Z,{placement:"topLeft",overlay:JSON.parse(e.industryQuan).map(function(e,t){return u().createElement("span",{key:t},e,u().createElement("br",null))})},u().createElement("span",null,JSON.parse(e.industryQuan).map(function(e,t){return u().createElement("span",{key:t},e," ")}))))}},"满减":{label:"满减",prop:"trueReductionValue",width:80,align:"center"},"赠品":{label:"赠品",prop:"gift",width:90,render:function(e){return a(e.gift)}},"免息最长分期":{label:"免息最长分期",prop:"freeByStages",width:84,align:"center"},"定金":{label:"定金",prop:"deposit",width:70,align:"center",render:function(e){return a(e.deposit)}},"预定数量":{label:"预定数量",prop:"orderAmount",width:70,align:"center",render:function(e){return a(e.orderAmount)}},"平台":{label:"平台",prop:"source",width:70,align:"center",render:function(e){return a(e.source)}},"商品副标题":{label:"商品副标题",prop:"slogan",width:70,align:"center",render:function(e){return a(e.slogan)}},"挂牌价":{label:"挂牌价",prop:"listPrice",width:70,align:"center",render:function(e){return a(e.listPrice)}},"优惠合计":{label:"优惠合计",prop:"rateCount",width:70,align:"center",render:function(e){return a(e.rateCount)}},"优惠券金额":{label:"优惠券金额",prop:"trueCouponValue",width:70,align:"center",render:function(e){return a(e.trueCouponValue)}},sku:{label:"sku",prop:"sku",width:70,align:"center",render:function(e){return a(e.sku)}},"链接":{label:"链接",prop:"url",width:70,align:"center",render:function(e){return a(e.url)}},"采纳优惠策略":{label:"采纳优惠策略",prop:"trueRate",width:80,align:"center",render:function(e){return a(e.trueRate)}},"优惠政策":{label:"优惠政策",prop:"rate",width:70,align:"center",render:function(e){return a(e.rate)}}},i=function(t){function e(e){var o=t.call(this,e)||this;o.getTableHeight=function(){var e=document.documentElement.clientHeight-118-86;o.setState({maxHeight:e})},o.judgeTime=function(e){function t(e){return 31536e6<new Date-new Date(e)}return!t(e.dateFilter.from)&&!t(e.dateFilter.to)||(s.Z.warning("只能查看近1年的每日最低价"),!1)},o.getList=function(){var e,t,n,a,i=o.filter.getValue();o.judgeTime(i)&&(e=(a=o.state).pageIndex,t=a.pageSize,n=a.sortAttr,a=a.sortType,o.props.getHistoryList(l()({type:"ALL"},i,{pageIndex:e,pageSize:t,sortAttr:n,sortType:a})))},o.getSortList=function(){var e,t,n,a,i,r,c=o.filter.getValue();o.judgeTime(c)&&(e=o.state,t=e.pageIndex,n=e.pageSize,a=e.sortAttr,i=e.sortType,(r=k.t.get(k.V.curProject))&&o.setState({loading:!0},function(){d.h.post("/price/history/list",l()({id:r.id,type:"ALL"},c,{pageIndex:t,pageSize:n,sortAttr:a,sortType:i})).then(function(e){var t=e.data.result,e=t.result,t=t.count;o.props.save({columns:e[0]?e[0].configDetailVoList:[]}),o.setState({sortData:e,total:t,loading:!1},function(){var e=o.state.sortData;e&&e.length&&o.getStockInfo()})})}))},o.getStockInfo=function(){var e=k.t.get(k.V.curProject),t=o.state.sortData;e&&d.h.post("/stock/list",{projectId:e.id,userConnectionIds:t.map(function(e){return e.userConnectionId})})},o.handleSort=function(e){var t="ascending"===e.order?-1:"descending"===e.order?1:"";o.setState({sortAttr:e.prop,sortType:t},function(){return o.getSortList()})},o.handelPageSizeChange=function(e){o.setState({pageSize:e,pageIndex:1},function(){o.getSortList()})},o.handelPageChange=function(e){o.setState({pageIndex:e},function(){o.getSortList()})},o.filterChange=function(){o.setState({pageIndex:1},function(){o.getSortList()})},o.exportData=function(){(0,b.u)({options:o.state.rangedColumns.filter(function(e){return"趋势图"!==e}),value:o.state.rangedColumns.filter(function(e){return"趋势图"!==e}).filter(function(e){return e.checked}).map(function(e){return e.id})}).then(function(e){o.checkedList=e,o.setState({dialogVisible:!0})})},o.hanleDownload=function(e){var t,n=k.t.get(k.V.curProject).id;n&&(t=o.filter.getValue(),d.h.post("/data/export",l()({},t,{projectId:n,type:"HISTORY_PRICE",exportFields:e})).then(function(e){e=e.data;2e4===e.code?s.Z.success(e.msg+"，请到个人中心的下载列表或者点击右上角“小铃铛”下载"):s.Z.error(e.msg)}))},o._handleSortChange=function(e,t){k.t.set(k.V.historyPriceTableTitleList,e),o.setState({rangedColumns:e,baseColumns:e.reduce(function(e,t){return t.checked?[].concat(e,[C[t.name]]):e},[]).concat([{label:"",fixed:"right",width:"48"}])})};e=k.t.get(k.V.historyPriceTableTitleList)||[{name:"日期",checked:!0,disabled:!0,id:"day"},{name:"商品标题",checked:!0,disabled:!1,id:"title"},{name:"单品到手价",checked:!0,disabled:!1,id:"takePrice"},{name:"单品拼单价",checked:!0,disabled:!1,id:"groupTakePrice"},{name:"完美拼单价",checked:!0,disabled:!1,id:"perfectGroupTakePrice"},{name:"当天最低价",checked:!0,disabled:!1,id:"minPrice"},{name:"下架/缺货",checked:!0,disabled:!1,id:"stock"},{name:"单品优惠券",checked:!1,disabled:!1,id:"skuQuan"},{name:"店铺优惠券",checked:!1,disabled:!1,id:"storeQuan"},{name:"行业优惠券",checked:!1,disabled:!1,id:"industryQuan"},{name:"满减",checked:!0,disabled:!1,id:"trueReductionValue"},{name:"赠品",checked:!0,disabled:!1,id:"gift"},{name:"免息最长分期",checked:!0,disabled:!1,id:"freeByStages"},{name:"定金",checked:!0,disabled:!1,id:"deposit"},{name:"预定数量",checked:!0,disabled:!1,id:"orderAmount"},{name:"平台",checked:!0,disabled:!1,id:"source"},{name:"商品副标题",checked:!0,disabled:!1,id:"slogan"},{name:"挂牌价",checked:!0,disabled:!1,id:"listPrice"},{name:"优惠合计",checked:!0,disabled:!1,id:"rateCount"},{name:"优惠券金额",checked:!0,disabled:!1,id:"trueCouponValue"},{name:"sku",checked:!0,disabled:!1,id:"sku"},{name:"链接",checked:!0,disabled:!1,id:"url"},{name:"采纳优惠策略",checked:!0,disabled:!1,id:"trueRate"},{name:"优惠政策",checked:!0,disabled:!1,id:"rate"}];return o.state={baseColumns:[],rangedColumns:e,pageIndex:1,pageSize:20,sortAttr:"",sortType:"",maxHeight:"",sortData:[],total:0,loading:!1,dialogVisible:!1},o.checkedList=[],o}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.getTableHeight(),window.addEventListener("resize",this.getTableHeight)},n.componentWillUnmount=function(){window.removeEventListener("resize",this.getTableHeight),this.props.clearState()},n.componentDidUpdate=function(e,t){var n,a=e.columns,e=this.props.columns;JSON.stringify(a)!==JSON.stringify(e)&&(n=this.state.rangedColumns.slice(),e.push({topicTypeValue:"淘宝掌柜",topicTypeId:"sellerNick",id:"sellerNick"}),e.forEach(function(t){var e=C[t.topicTypeValue];e?e.prop=t.topicTypeId:C[t.topicTypeValue]={label:t.topicTypeValue,prop:t.topicTypeId,fixed:"",render:function(e,t){return u().createElement("div",{title:e[t.prop],style:{width:"100%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},"sellerNick"!==t.prop||""!==e[t.prop]?e[t.prop]:"-")}},n.find(function(e){return e.name===t.topicTypeValue})||(e=n.length,n.splice(e,0,{name:t.topicTypeValue,checked:!1,disabled:!1,id:"sellerNick"!==t.topicTypeId?"config:"+t.topicTypeId:t.topicTypeId}))}),this.setState({rangedColumns:n,baseColumns:n.reduce(function(e,t){return t.checked?[].concat(e,[C[t.name]]):e},[]).concat([{label:"",fixed:"right",width:"48"}])}))},n.handleClickPrice=function(e){window.windowPool=[];var t=window.open("/price/realTimePrice/priceDetail");window.windowPool.push({window:t,parameter:{source:2,data:e}})},n.render=function(){var t=this,e=this.state,n=e.loading,a=e.pageSize,i=e.maxHeight,r=e.baseColumns,c=e.rangedColumns,o=e.sortData,l=e.total,s=e.pageIndex,d=e.dialogVisible,e=u().createElement("div",{className:"history-price-title"},u().createElement("span",null,"每日最低价"),u().createElement(g.Z,{overlay:'该页面不包含当天的价格信息，当天的价格信息可前往"实时价格"查看',overlayClassName:"history-price-title-popover",placement:"right"},u().createElement("i",{className:"icon-cem_file1"})));return u().createElement("div",{className:"history_price"},u().createElement(h.Z,{ref:function(e){return t.filter=e},showList:["condition","time","save"],filterCondition:{filter:["CONN_CONFIG","SOURCE","TAG"]},model:"PRICE_HISTORY",timeDefaultValue:{quickChoice:"近7天",from:"",to:""},onChange:this.filterChange,onFilterReady:this.getSortList}),u().createElement("div",{className:"history_price_wrap"},e,u().createElement("div",{className:"table-zone"},u().createElement(y.Z,{title:"列",options:c,onChange:this._handleSortChange,leftFixedNum:1,rightFixedNum:0}),u().createElement(m.Z,{loading:n,data:o.map(function(t){return t.configDetailVoList&&t.configDetailVoList.length&&t.configDetailVoList.forEach(function(e){t[e.topicTypeId]=t.connectionConfig?t.connectionConfig[e.topicTypeId]:void 0}),t}),columns:r,total:l,pageSize:a,currentPage:s,onSortChange:this.handleSort,onPage:this.handelPageChange,onPageSizeChange:this.handelPageSizeChange,onRowClick:this.handleClickPrice,rowStyle:{cursor:"pointer"},pagePosition:"down",bottomElement:f.Z.hasAuthority("DATA_DOWNLOAD")&&0<o.length&&u().createElement("span",{className:"download",onClick:function(){return t.exportData()}},u().createElement("i",{className:"cem-icon icon-cem_download"}),"下载"),maxHeight:i,pageSizeSelectorShow:!0,notLimit:!0}))),u().createElement(p.Dialog,{title:u().createElement(u().Fragment,null,u().createElement("i",{className:"icon-cem_warning warn-tip"}),u().createElement("span",null,"提醒")),size:"tiny",visible:d,onCancel:function(){return t.setState({dialogVisible:!1})},lockScroll:!0},u().createElement(p.Dialog.Body,null,u().createElement("span",null,"需要下载",l,"条数据，预计需要",Math.ceil(l/389/60),"分钟导出完成。"),6e4<=l&&u().createElement("span",null,"因为数据量过大，需要导出多个Excel文件，打包导出。每个Excel文件可导出60000条数据，共导出",Math.ceil(l/6e4),"个Excel文件。")),u().createElement(p.Dialog.Footer,{className:"dialog-footer"},u().createElement(p.Button,{onClick:function(){t.setState({dialogVisible:!1})}},"取消"),u().createElement(p.Button,{type:"primary",onClick:function(){t.setState({dialogVisible:!1}),t.hanleDownload(t.checkedList)}},"确定"))))},e}(i.PureComponent);const S=(0,c.connect)(function(e){e.loading;e=o()(e,["loading"]);return l()({},e[E])},function(t){return{save:function(e){return t({type:E+"/save",payload:e})},getHistoryList:function(e){return t({type:E+"/getHistoryList",payload:e})},clearState:function(e){return t({type:E+"/clearState",payload:e})}}})(i)},6637:(e,t,n)=>{"use strict";n.d(t,{u:()=>function(i){return new Promise(function(e,t){var n=i.value||[],a=r()({},i,{titleText:"下载数据",className:"yt_modal_price_download_modal",content:d().createElement(c,r()({},i,{getValue:function(e){n=e}})),top:"50%"});a.onOk=function(){return e(n)},a.onCancel=t,(0,o.Z)(a)})}});var a=n(67154),r=n.n(a),t=n(67294),d=n.n(t),a=n(45697),t=n.n(a),u=n(92360),a=function(e){var t=e.value,a=e.options,n=e.getValue,i=a.length===t.length,r=d().useState(t),c=r[0],o=r[1],e=d().useState(i),r=e[0],l=e[1],e=d().useState(!i&&0<t.length),t=e[0],s=e[1];d().useEffect(function(){n(c)},[c]);return d().createElement("div",{className:"yt_modal_price_download_wrapper"},d().createElement("div",{className:"content"},d().createElement("span",null,"字段"),d().createElement(u.Checkbox,{checked:r,indeterminate:t,onChange:function(e){l(e),s(!1),o(e?a.map(function(e){return e.id}):[])}},"全选")),d().createElement("div",{className:"checkbox_group"},a.map(function(n,e){return d().createElement(u.Checkbox,{key:e,value:n.id,checked:c.includes(n.id),onChange:function(){return t=n.id,e=-1<(e=c).indexOf(t)?e.filter(function(e){return e!==t}):[].concat(c,[t]),o(e),l(c.length===a.length),void s(0<c.length&&!i&&c.length<a.length);var t,e}},n.name)})))};const c=a;a.propTypes={value:t().object,getValue:t().func};var o=n(57522)},23942:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var t=n(67154),l=n.n(t),t=n(85354),a=n.n(t),t=n(67294),s=n.n(t),d=n(92360),t=n(45697),n=n.n(t),t=function(n){function e(e){var s=n.call(this,e)||this;s._setPadShowFalse=function(){s.state.show&&s.setState({show:!1})},s._handleOnClick=function(e){var t=s.state.show;t&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){s.setState({show:!t})},0)},s._handleOnPanelClick=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},s._handleOnRangeClick=function(e,t,n){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();var a=s.state,e=a.checkedOpts,i=a.unCheckedOpts,a=s.props,r=a.onChange,c=a.leftFixedNum,o=e.slice(),l=o.findIndex(function(e){return e.name===n.name});switch(o.splice(l,1),t){case"top":o.splice(c,0,n);break;case"up":o.splice(l-1,0,n);break;case"down":o.splice(l+1,0,n)}s.setState({checkedOpts:o},function(){setTimeout(function(){var e=o.concat(i);r(e,"range")},0)})},s._handleOnItemChange=function(e,t){var n=s.props,a=n.onChange,i=n.rightFixedNum,r=s.state,n=r.checkedOpts,r=r.unCheckedOpts,c=n.slice(),o=r.slice();e?(c.splice(c.length-i,0,l()({},t,{checked:!0})),o=r.filter(function(e){return t.name!==e.name})):(c=n.filter(function(e){return t.name!==e.name}),o.splice(0,0,l()({},t,{checked:!1}))),s.setState({checkedOpts:c,unCheckedOpts:o},function(){setTimeout(function(){var e=c.concat(o);a(e,"check")},0)})};var t=e.options?e.options.filter(function(e){return e.checked}):[],e=e.options?e.options.filter(function(e){return!e.checked}):[];return s.state={show:!1,checkedOpts:t,unCheckedOpts:e},s}a()(e,n);var t=e.prototype;return t.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},t.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},t.componentDidUpdate=function(e,t){var n=e.options,e=this.props.options;JSON.stringify(e)!==JSON.stringify(n)&&this.setState({checkedOpts:e.filter(function(e){return e.checked}),unCheckedOpts:e.filter(function(e){return!e.checked})})},t.render=function(){var n=this,e=this.state,t=e.show,a=e.checkedOpts,i=e.unCheckedOpts,r=this.props,e=r.title,c=r.leftFixedNum,o=r.rightFixedNum;return s().createElement("div",{className:"sortable-checklist-button-wrapper",onClick:this._handleOnClick},s().createElement("span",{className:"scl-button-trigger "+(t?"sel":"")},e,s().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),s().createElement("div",{className:"scl-panel",id:"sorableList",style:{display:t?"block":"none"},onClick:this._handleOnPanelClick},a.map(function(t,e){return s().createElement("div",{key:t.name,className:"scl-panel-item"},s().createElement(d.Checkbox,{style:{width:"calc(100% - "+(5===e?14:a.length-2?34:48)+"px)"},checked:t.checked,disabled:t.disabled,onChange:function(e){return n._handleOnItemChange(e,t)}},t.name),!t.disabled&&s().createElement("span",{className:"range-button-zone"},e!==c&&s().createElement("i",{className:"icon-cem_roof-placement",onClick:function(e){return n._handleOnRangeClick(e,"top",t)}}),e!==c&&s().createElement("i",{className:"icon-cem_upper",onClick:function(e){return n._handleOnRangeClick(e,"up",t)}}),e!==a.length-1-o&&s().createElement("i",{className:"icon-cem_lower",onClick:function(e){return n._handleOnRangeClick(e,"down",t)}})))}),i.reduce(function(e,t){return[].concat(e,[s().createElement("div",{key:t.name,className:"scl-panel-item"},s().createElement(d.Checkbox,{style:{width:"100%"},checked:t.checked,disabled:t.disabled,onChange:function(e){return n._handleOnItemChange(e,t)}},t.name))])},[0===i.length?null:s().createElement("div",{key:"divider",className:"h-divider"})])))},e}(s().PureComponent);t.propTypes={options:n().array,onChange:n().func,leftFixedNum:n().number,rightFixedNum:n().number};const i=t}}]);