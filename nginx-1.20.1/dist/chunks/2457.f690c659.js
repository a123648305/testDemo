"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2457],{43775:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var a=n(87462),i=n(94578),r=n(67294),l=n(92360),o=n(5133),c=n(29383),s=n(59762),u=n(33097),p=n(55815),d=n(53754),m=n(43036),h=n(37841),g=n(61409),f=n(13713),E=n(49722),v=n(35239),C=[{label:"\u5168\u90e8",value:""},{label:"\u542f\u7528",value:"ENABLE"},{label:"\u505c\u7528",value:"DISABLE"}],S=function(e){function t(t){var n;return(n=e.call(this,t)||this).goEdit=function(){n.setState({visiblePopupConfirmIndex:-1});var e=n.state.targetAlert.id;g.mW.push({pathname:"/account/project/alert/edit",state:{id:e}})},n.resetPopupConfimIndex=function(){n.setState({visiblePopupConfirmIndex:-1})},n.fetchAlertList=function(){var e=n.state,t=e.projectId,a=e.searchText,i=e.team,r=e.user,l=e.status,o=e.sortType,c=e.alertObject,s=e.alertIndex,u=e.pageIndex,p=e.pageSize;n.setState({loading:!0},(function(){E.h.post("/warning/project/aspect/list",{projectId:t,title:a,warningStatusList:l?[l]:[],receiverTeamIdList:i,receiverUserIdList:r,filterModel:{analysis:c,aspect:s},sortModelList:[{sortName:"UPDATED_AT",sortType:o},{sortName:"TITLE",sortType:"ASC"}],pageIndex:u,pageSize:p}).then((function(e){var t=e.status,a=e.data.result;if((t>=200&&t<300||304===t)&&a){var i=a.total,r=a.list;n.setState({list:r,total:i})}})).finally((function(){n.setState({loading:!1})}))}))},n.fetchTeamOptions=function(){try{var e=n.state.projectId;E.h.post("filter/find",{projectId:e,filterTypes:["TEAM","USER"],type:"OVERVIEW"}).then((function(e){var t=e.data,a=t.code,i=t.result;if(2e4===a&&i){var r=i.team,l=i.user;n.setState({teamOptions:r.map((function(e){return{id:e.id,name:e.name}})),userOptions:l.map((function(e){return{id:e.id,name:e.username}}))})}}))}catch(t){console.error(t)}},n.handleChangeTeam=function(e){n.setState({team:e,pageIndex:1},(function(){return n.fetchAlertList()}))},n.handleChangeUser=function(e){n.setState({user:e,pageIndex:1},(function(){return n.fetchAlertList()}))},n.handleChangeStatus=function(e){n.setState({status:e,pageIndex:1},(function(){return n.fetchAlertList()}))},n.handleInputChange=function(e){n.setState({searchText:e})},n.handleKeyUp=function(e){e.stopPropagation(),13===e.keyCode&&n.setState({pageIndex:1},(function(){return n.fetchAlertList()}))},n.handleAlertObjChange=function(e){n.setState({alertObject:e,pageIndex:1},(function(){return n.fetchAlertList()}))},n.handleAlertIndexChange=function(e){n.setState({alertIndex:e,pageIndex:1},(function(){return n.fetchAlertList()}))},n.switchPage=function(e){n.setState({pageIndex:e},(function(){return n.fetchAlertList()}))},n.switchPageSize=function(e){n.setState({pageSize:e,pageIndex:1},(function(){return n.fetchAlertList()}))},n.handleSort=function(e){var t="ascending"===e.order?"ASC":"DESC";n.setState({sortType:t},(function(){return n.fetchAlertList()}))},n.handleTitleChange=function(e){var t=n.state.targetAlert;n.setState({targetAlert:(0,a.Z)({},t,{title:e})})},n.handleDescChange=function(e){var t=n.state.targetAlert;n.setState({targetAlert:(0,a.Z)({},t,{description:e})})},n.handleConfirm=function(){var e=n.state,t=e.dialogType,a=e.targetAlert,i=a.id,r=a.title,l=a.status,o=a.description;switch(t){case"toggle":n.handleEnableOrDisable(i,l);break;case"delete":n.handleDelete(i);break;case"rename":n.handleRename(i,r,o)}},n.handleCancel=function(){n.setState({dialogShow:!1,targetAlert:{id:"",title:"",description:"",status:""}})},n.handleEnableOrDisable=function(){var e=n.state.targetAlert,t=e.id,a=e.status;E.h.post("/warning/project/aspect/status/update",{id:t,status:"ENABLE"===a?"DISABLE":"ENABLE"}).then((function(e){var t=e.status;(t>=200&&t<300||304===t)&&o.Z.success("\u64cd\u4f5c\u6210\u529f")})).finally((function(){n.handleReset(),n.fetchAlertList()}))},n.handleDelete=function(e){E.h.post("/warning/project/aspect/delete",{id:e}).then((function(e){var t=e.status;(t>=200&&t<300||304===t)&&o.Z.success("\u5220\u9664\u6210\u529f")})).finally((function(){n.handleReset(),n.fetchAlertList()}))},n.handleRename=function(e,t,a){E.h.post("/warning/project/aspect/title/update",{id:e,title:t,description:a}).then((function(e){var t=e.status;(t>=200&&t<300||304===t)&&o.Z.success("\u64cd\u4f5c\u6210\u529f")})).finally((function(){n.handleReset(),n.fetchAlertList()}))},n.handleReset=function(){n.setState({dialogShow:!1,targetAlert:{id:"",title:"",description:"",status:""}})},n.state={projectId:v.t.get(v.V.backProjectConfig)&&v.t.get(v.V.backProjectConfig).id,alertObject:{},alertIndex:{aspect1:[],aspect2:[]},team:[],teamOptions:[],user:[],userOptions:[],status:"",searchText:"",pageIndex:1,pageSize:20,sortType:"DESC",list:[],total:0,loading:!1,targetAlert:{id:"",title:"",description:"",status:""},dialogShow:!1,dialogType:"",visiblePopupConfirmIndex:-1,columns:[{label:"",prop:"paddingLeft",width:48},{label:"\u9884\u8b66\u540d\u79f0",prop:"title",minWidth:210,render:function(e){return r.createElement(m.Z,{overlay:function(){return n.renderDetailPopup(e.title,e.description)},placement:"topLeft",overlayClassName:"alert-detail-popup"},r.createElement("div",{className:"alert-title"},e.title))}},{label:"\u63a8\u9001\u6210\u5458",prop:"user",render:function(e){var t=e.receiverTeamList,n=e.receiverUserList;return r.createElement(r.Fragment,null,r.createElement("div",{className:"teams"},r.createElement("span",null,"\u56e2\u961f | "),r.createElement("span",null,t.length>0?t.map((function(e){return e.name})).join("\uff0c"):"\u65e0")),r.createElement("div",{className:"teams"},r.createElement("span",null,"\u6210\u5458 | "),r.createElement("span",null,n.length>0?n.map((function(e){return e.name})).join("\uff0c"):"\u65e0")))},minWidth:240},{label:"\u9884\u8b66\u63d0\u9192\u6570",prop:"remindCount",render:function(e){return r.createElement(m.Z,{placement:"top",overlay:"\u67e5\u770b\u8fd17\u5929\u7684\u63a8\u9001\u65e5\u5fd7"},r.createElement("span",{className:"count",onClick:function(){return n.viewLog(e.title)}},e.remindCount))},minWidth:70},{label:"\u6700\u8fd1\u4fee\u6539\u65f6\u95f4",prop:"updatedAt",sortable:"custom",minWidth:120,render:function(e){return r.createElement("span",null,e.updatedAt.substring(0,16))}},{label:"\u64cd\u4f5c",prop:"operation",minWidth:210,render:function(e,t,a){var i=n.state.visiblePopupConfirmIndex,o=e.id,c=e.title,s=e.description,u=e.status;return r.createElement("div",{className:"handle"},r.createElement(m.Z,{overlay:"ENABLE"===u?"\u5df2\u542f\u7528":"\u5df2\u505c\u7528",placement:"top",trigger:"hover"},r.createElement("span",null,r.createElement(l.Switch,{value:"ENABLE"===u,onText:"",offText:"",onColor:"#0747A6",offColor:"#CCCCCC",onChange:function(){return n.setState({dialogShow:!0,dialogType:"toggle",targetAlert:{id:o,title:c,description:s,status:u}})}}))),r.createElement("span",{onClick:function(){return g.mW.push({pathname:"/account/project/alert/edit",state:{id:o,edit:!0}})}},"\u7f16\u8f91"),r.createElement("span",{onClick:function(){n.setState({dialogShow:!0,dialogType:"rename",targetAlert:{id:o,title:c,description:s,status:u}})}},"\u91cd\u547d\u540d"),r.createElement(m.Z,{trigger:"click",overlay:function(){return n.renderPopupConfirm()},placement:"top",overlayClassName:"alert-popup-confirm",visible:i===a},r.createElement("span",{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.setState({visiblePopupConfirmIndex:a,targetAlert:{id:o,title:c,description:s,status:u}})}},"\u590d\u5236")),r.createElement("span",{onClick:function(){n.setState({dialogShow:!0,dialogType:"delete",targetAlert:{id:o,title:c,description:s,status:u}})}},"\u5220\u9664"))}},{label:"",prop:"paddingRight",width:48}]},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.fetchTeamOptions(),this.fetchAlertList(),window.addEventListener("click",this.resetPopupConfimIndex)},n.componentWillUnmount=function(){window.removeEventListener("click",this.resetPopupConfimIndex)},n.renderDetailPopup=function(e,t){return r.createElement(r.Fragment,null,r.createElement("div",{className:"popup-title"},"\u9884\u8b66\u540d\u79f0"),r.createElement("div",{className:"popup-content",style:{marginBottom:"16px"}},e),r.createElement("div",{className:"popup-title"},"\u9884\u8b66\u8bf4\u660e"),r.createElement("div",{className:"popup-content"},t||"\u65e0"))},n.renderPopupConfirm=function(){return r.createElement("div",{onClick:function(e){return e.stopPropagation()}},r.createElement("div",null,r.createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),r.createElement("span",null,"\u786e\u5b9a\u521b\u5efa\u76f8\u4f3c\u6761\u4ef6\u9884\u8b66\uff1f")),r.createElement("div",null,r.createElement(l.Button,{type:"default",size:"mini",onClick:this.resetPopupConfimIndex},"\u53d6\u6d88"),r.createElement(l.Button,{type:"primary",size:"mini",onClick:this.goEdit},"\u786e\u5b9a")))},n.viewLog=function(e){g.mW.push({pathname:"/account/project/alert/log",state:{title:e}})},n.handleClickCreateBtn=function(){g.mW.push({pathname:"/account/project/alert/edit"})},n.render=function(){var e=this,t=this.state,n=t.projectId,a=t.teamOptions,i=t.userOptions,o=t.status,m=t.searchText,g=t.columns,E=t.loading,v=t.pageIndex,S=t.pageSize,y=t.list,A=t.total,I=t.dialogType,b=t.dialogShow,L=t.targetAlert,w=document.documentElement.clientHeight-46-78-24;return r.createElement("div",{className:"alert-rule"},r.createElement(p.Z,{title:(0,f.u)({title:"\u9884\u8b66\u7ba1\u7406"}),rightContent:r.createElement(l.Button,{type:"primary",onClick:this.handleClickCreateBtn},"\u65b0\u5efa\u9884\u8b66")}),r.createElement("div",null,r.createElement("div",{style:{minHeight:w,backgroundColor:"#fff"}},r.createElement("div",{className:"alert-rule-search"},r.createElement("div",null,r.createElement("div",{className:"search-input-wrapper"},r.createElement(l.Input,{value:m,onChange:this.handleInputChange,onKeyUp:this.handleKeyUp,icon:"search",placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u540d\u79f0",onIconClick:function(){return e.setState({pageIndex:1},(function(){return e.fetchAlertList()}))}})),r.createElement(s.Z,{projectId:n,type:"OVERVIEW",onChange:this.handleAlertObjChange}),r.createElement(u.Z,{projectId:n,onChange:this.handleAlertIndexChange}),r.createElement(d.Z,{title:"\u63a8\u9001\u7528\u6237\u7ec4",options:a,onChange:this.handleChangeTeam}),r.createElement(d.Z,{title:"\u63a8\u9001\u6210\u5458",options:i,onChange:this.handleChangeUser}),r.createElement(h.Z,{activeKey:o,options:C,onTabClick:this.handleChangeStatus}))),r.createElement(l.Loading,{loading:E,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},r.createElement(c.Z,{columns:g,data:y,total:A,pagePosition:"down",pageSize:S,currentPage:v,onPage:this.switchPage,onSortChange:this.handleSort,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,notLimit:!0})))),r.createElement(l.Dialog,{title:"rename"===I?"\u91cd\u547d\u540d\u9884\u8b66":"",size:"tiny",visible:b,onCancel:function(){return e.handleCancel()},lockScroll:!0,customClass:"rename"===I?"rename-modal":""},r.createElement(l.Dialog.Body,null,"delete"===I&&r.createElement(r.Fragment,null,r.createElement("div",{className:"dialog-title"},r.createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"\u786e\u5b9a\u5220\u9664\u8be5\u9884\u8b66\uff1f"),r.createElement("div",{className:"delete-tips"},"\u5220\u9664\u540e\uff0c\u6b64\u9884\u8b66\u65e0\u6cd5\u6062\u590d\u3002\u5982\u679c\u6b64\u9884\u8b66\u540e\u671f\u8fd8\u9700\u8981\u7ee7\u7eed\u4f7f\u7528\uff0c\u505c\u7528\u5373\u53ef")),"toggle"===I&&r.createElement(r.Fragment,null,r.createElement("div",{className:"dialog-title"},r.createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"\u786e\u5b9a","ENABLE"===L.status?"\u505c":"\u542f","\u7528\u8be5\u9884\u8b66\uff1f"),r.createElement("div",{className:"delete-tips"},"ENABLE"===L.status?"\u505c\u7528\u540e\uff0c\u6b64\u9884\u8b66\u4e2d\u7684\u89c4\u5219\u5c06\u4e0d\u518d\u751f\u6548":"\u542f\u7528\u540e\uff0c\u6ee1\u8db3\u8bbe\u7f6e\u7684\u76f8\u5173\u89c4\u5219\u540e\u76f8\u5173\u7528\u6237\u5c31\u4f1a\u6536\u5230\u63d0\u9192")),"rename"===I&&r.createElement(r.Fragment,null,r.createElement("div",{className:"form-item"},r.createElement("label",null,"\u9884\u8b66\u540d\u79f0"),r.createElement(l.Input,{value:L.title,placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u540d\u79f0",onChange:this.handleTitleChange})),r.createElement("div",{className:"form-item"},r.createElement("label",null,"\u9884\u8b66\u63cf\u8ff0"),r.createElement(l.Input,{type:"textarea",value:L.description,autosize:{minRows:4,maxRows:4},onChange:this.handleDescChange,placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u63cf\u8ff0"})))),r.createElement(l.Dialog.Footer,{className:"dialog-footer"},r.createElement(l.Button,{onClick:function(){return e.handleCancel()}},"\u53d6\u6d88"),r.createElement(l.Button,{type:"primary",onClick:function(){return e.handleConfirm()}},"\u786e\u5b9a"))))},t}(r.PureComponent)},13713:(e,t,n)=>{n.d(t,{u:()=>i});var a=n(35239),i=function(e){var t=e.title,n=e.url,i=a.t.get(a.V.backProjectConfig).name;return n&&-1!==n.indexOf("memberlist")?[{title:i,url:"/account/project/preview"},{title:"\u7528\u6237\u7ec4",url:"/account/project/usergroup"},{title:t,url:n}]:[{title:i,url:"/account/project/preview"},{title:t,url:n}]}},37841:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),i=n(45697),r=n.n(i),l=function(e){var t=e.activeKey,n=e.options,i=e.onTabClick;return a.createElement("div",{className:"tabs"},n.map((function(e,n){return a.createElement("div",{key:n,className:t===e.value?"active-tab":"",onClick:function(){return t!==e.value&&i(e.value,e)}},e.key||e.label)})))};l.propTypes={activeKey:r().oneOfType([r().string,r().number]),options:r().arrayOf(r().shape({key:r().string,value:r().oneOfType([r().string,r().number])})).isRequired,onTabClick:r().func.isRequired};const o=l}}]);