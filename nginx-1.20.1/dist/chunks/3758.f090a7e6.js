"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3758],{1374:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294);const r=function(e){var t=e.src,n=e.defaultImg,r=e.timeoutTime,o=void 0===r?1e3:r,u=(0,a.useState)(t),c=u[0],i=u[1];return(0,a.useEffect)((function(){var e=new Image;e.src=t;var a=setTimeout((function(){i(n),e.onerror=null}),o);return e.onload=function(n){e.onload=null,clearTimeout(a),i(t)},e.onerror=function(t){e.onerror=null,clearTimeout(a),i(n)},function(){clearTimeout(a)}}),[t]),a.createElement("img",{src:c,alt:""})}},70259:(e,t,n)=>{n.d(t,{Z:()=>o});n(77785);var a=n(59361),r=n(67294);const o=function(e){var t=e.memberList,n=e.setModalTitle,o=e.handleDeleteTag,u=e.memberValidate;return r.createElement("div",{className:"item member"},r.createElement("div",{className:u?"tag_content err":"tag_content",onClick:function(){n("\u9009\u62e9\u6210\u5458\u6216\u90e8\u95e8")}},null!=t&&t.length?t.map((function(e){return r.createElement(a.default,{onClick:function(e){e.stopPropagation()},closable:!0,key:e.id,onClose:function(t){return o(t,e)},icon:r.createElement("i",{className:"USER"===e.objType?"icon-cem_name":"icon-jiagou"})},e.name)})):r.createElement("span",{className:"tip"},"\u8bf7\u9009\u62e9\u6210\u5458/\u90e8\u95e8")))}},29889:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var a=n(87462),r=(n(75314),n(11187)),o=n(15861),u=n(94578),c=n(87757),i=n.n(c),l=n(67294),s=(n(1025),n(65400)),m=(n(89858),n(51024)),d=(n(53294),n(56697)),p=n(30381),f=n.n(p),h=n(68855),g=n(96889),b=n(61409),v=n(35239),y=n(20503),E=n(43036),k=(n(29809),n(97538)),I=n(76295),x=n(70259),w={labelCol:{span:5},wrapperCol:{span:19}};const C=function(e){var t=l.createRef(),n=(0,l.useState)(""),u=n[0],c=n[1],p=(0,l.useState)([]),f=p[0],h=p[1],g=(0,l.useState)(!1),b=g[0],E=g[1],C=e.userGroupData,S=e.isModalVisible,j=e.typeOfModal,V=e.handleCancel,Z=e.fetchUserGroupData,T=e.keyword,D=e.pageSize,N=e.setPageIndex,z=v.t.get(v.V.backProjectConfig).id,P=function(){V(),t.current.resetFields(),h([])},G=function(){var e=(0,o.Z)(i().mark((function e(n){var a,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("\u65b0\u589e"!==j||f.length){e.next=4;break}return E(!0),e.abrupt("return");case 4:if(a=n.description,n.members,o=n.name,"\u65b0\u589e"!==j){e.next=12;break}return e.next=8,(0,y.Vm)({description:a,members:f.map((function(e){return"DEPT"===e.objType?e.directlyUnder?{id:e.objId,type:"ExcludeSub"}:{id:e.objId,type:"IncludeSub"}:{id:e.objId,type:e.objType}})),name:o,projectId:z});case 8:2e4===e.sent.data.code&&(r.default.success("\u64cd\u4f5c\u6210\u529f"),V()),e.next=19;break;case 12:if(n.name!==C.team||n.description!==C.description){e.next=15;break}return V(),e.abrupt("return");case 15:return u=C.teamId,e.next=18,(0,y.oV)({description:a,name:o,id:u}).then((function(e){r.default.success("\u64cd\u4f5c\u6210\u529f")})).catch((function(e){}));case 18:e.sent;case 19:N(1),Z({pageIndex:1,pageSize:D,keyword:T,projectId:v.t.get(v.V.backProjectConfig).id}),V(),t.current.resetFields();case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return l.createElement(d.Z,{className:"edit",title:j+"\u7528\u6237\u7ec4",visible:S,onCancel:P,footer:null,width:480,wrapClassName:"userGroup_add_modal"},l.createElement("div",{className:"addUserGroup_body"},l.createElement(k.Z,(0,a.Z)({},w,{name:"userGroup-messages",onFinish:G,ref:t}),l.createElement(k.Z.Item,{key:"name",label:"\u7528\u6237\u7ec4\u540d\u79f0",colon:!1,name:"name",validateFirst:!0,validateTrigger:["onBlur","onChange"],rules:[{required:!0,whitespace:!0,message:"\u8bf7\u8f93\u5165\u540d\u79f0"},{max:20,message:"\u540d\u79f0\u6700\u591a\u53ef\u8f93\u516520\u4e2a\u5b57"},{validator:function(e,t,n){!function(e,t){"\u7f16\u8f91"!==j||e!==C.team?e&&(0,y.Dn)({name:e,projectId:z}).then((function(e){e.data.result?t("\u7528\u6237\u7ec4\u540d\u79f0\u91cd\u590d"):t()})):t()}(t,n)}}],initialValue:"\u7f16\u8f91"===j?C.team:""},l.createElement(m.default,{type:"text",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",autoComplete:"off"})),"\u65b0\u589e"===j?l.createElement(k.Z.Item,{className:"members",label:"\u6210\u5458/\u90e8\u95e8",colon:!1,name:"members",key:"members"},l.createElement(x.Z,{memberList:f,setModalTitle:c,handleDeleteTag:function(e,t){h(f.filter((function(e){return e.objId!==t.objId}))),e.preventDefault()},memberValidate:b}),b&&l.createElement("p",{style:{color:"#f08a8a",height:"0px"}},"\u8bf7\u8f93\u5165\u6210\u5458\u6216\u90e8\u95e8")):"",l.createElement(k.Z.Item,{name:"description",key:"description",label:"\u63cf\u8ff0",colon:!1,rules:[{max:100,message:"\u63cf\u8ff0\u6700\u591a\u53ef\u8f93\u5165100\u4e2a\u5b57"}],initialValue:"\u7f16\u8f91"===j?C.description:""},l.createElement(m.default.TextArea,{autoSize:{minRows:2,maxRows:5},placeholder:"\u8bf7\u8f93\u5165"})),l.createElement(k.Z.Item,{wrapperCol:{offset:16}},l.createElement(s.default,{key:"cancel",htmlType:"button",onClick:P},"\u53d6\u6d88"),l.createElement(s.default,{type:"primary",key:"comfirm",htmlType:"submit"},"\u786e\u5b9a")))),l.createElement(I.Z,{members:f,list:f,searchOptions:[{label:"\u641c\u7d22\u6210\u5458",value:"USER"},{label:"\u641c\u7d22\u90e8\u95e8",value:"DEPT"}],type:3,directControl:!0,subTitle:"\u4ec5\u9009\u62e9\u90e8\u95e8\u7684\u76f4\u5c5e\u6210\u5458",title:u,onOk:function(e){h(e.members),E(!1)},onCancel:function(){return c("")}}))};var S=n(55815),j=n(13713);const V=function(e){var t=e.loading,n=e.onFilterChange,u=e.fetchUserGroupData,c=e.teamCount,p=e.tableListDataSource,k=e.totalNumber;p.map((function(e){return c.forEach((function(t){e.teamId===t.id&&(e.membersCount=t.count)})),e}));var I=[{title:"\u7528\u6237\u7ec4",width:"25%",dataIndex:"team",render:function(e,t){return l.createElement("a",{onClick:function(){b.mW.push({pathname:"/account/project/usergroup/memberlist",state:{teamId:t.teamId,team:t.team}})}},e)}},{title:"\u63cf\u8ff0",width:"35%",dataIndex:"description",render:function(e,t,n,a){var r=t.description;return r?l.createElement(E.Z,{overlay:function(){return r},overlayStyle:{maxWidth:"436px"},placement:"topLeft"},l.createElement("span",null,r||"-")):l.createElement("span",null,"-")}},{title:"\u6210\u5458",width:"10%",dataIndex:"membersCount"},{title:"\u6700\u8fd1\u4fee\u6539\u65f6\u95f4",width:"20%",dataIndex:"updatedAt",render:function(e,t,n,a){var r=t.updaterName,o=t.lastModifyTime;return l.createElement(E.Z,{overlay:function(){return r||"--"},overlayStyle:{maxWidth:"436px"},placement:"top"},l.createElement("span",null,f()(o).format("YYYY/MM/DD HH:mm")))}},{title:"\u64cd\u4f5c",width:"10%",key:"option",valueType:"option",render:function(e,t){return[l.createElement("a",{key:"edit",onClick:function(){Q("\u7f16\u8f91",t)}},"\u7f16\u8f91"),l.createElement("a",{key:"delete",onClick:function(){X(t)}},"\u5220\u9664")]}}];(0,l.useEffect)((function(){u({pageIndex:1,pageSize:10,keyword:"",projectId:q})}),[]);var x=(0,l.useRef)(null),w=(0,l.useRef)(null),V=(0,l.useState)(void 0),Z=V[0],T=V[1],D=(0,l.useState)(void 0),N=D[0],z=D[1],P=(0,l.useState)(!1),G=P[0],U=P[1],_=(0,l.useState)(""),F=_[0],M=_[1],L=(0,l.useState)(""),O=L[0],R=L[1],K=(0,l.useState)(1),H=K[0],W=K[1],Y=(0,l.useState)(10),B=Y[0],A=Y[1],q=v.t.get(v.V.backProjectConfig).id,J=function(){var e=document.getElementsByClassName("container")[0];T((null==e?void 0:e.clientHeight)-79)};(0,l.useEffect)((function(){return window.addEventListener("resize",J),J(),function(){return window.removeEventListener("resize",J)}}),[]);var Q=function(e,t){"\u7f16\u8f91"===e&&z(t),M(e),U(!0)},X=function(e){var t=e.teamId,n=e.team,a=e.membersCount,c="\u7528\u6237\u7ec4\u201c"+n+"\u201d\u5185\u6709\u6210\u5458/\u90e8\u95e8\u5b58\u5728\uff0c\u662f\u5426\u786e\u8ba4\u5220\u9664\uff1f",s="\u662f\u5426\u786e\u8ba4\u5220\u9664\u7528\u6237\u7ec4\u201c"+n+"\u201d\uff1f";d.Z.confirm({title:"\u5220\u9664\u7528\u6237\u7ec4",autoFocusButton:null,icon:l.createElement(h.Z,{style:{color:"#FF7955"}}),content:l.createElement("p",null,a?c:s),className:"warn-modal",onOk:function(){var e=(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.eP)({id:t,name:n});case 2:2e4===e.sent.data.code?r.default.success("\u5220\u9664\u6210\u529f"):r.default.error("\u5220\u9664\u5931\u8d25"),u({pageIndex:1===p.length?H-1||1:H,pageSize:B,keyword:O,projectId:q}),$();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),onCancel:function(){}})},$=function(){U(!1)};return l.createElement("div",{className:"yt_project_usergroup_wrapper"},l.createElement(S.Z,{title:(0,j.u)({title:"\u7528\u6237\u7ec4\u7ba1\u7406",url:"/account/project/usergroup"})}),l.createElement("div",{className:"container"},l.createElement("div",{className:"content",ref:x},l.createElement(g.ZP,{loading:t,columns:I,tableLayout:"fixed",pagination:{defaultPageSize:10,current:H,total:k},onChange:function(e){var t=e.current,n=e.pageSize;W(t),A(n),u({pageIndex:t,pageSize:n,keyword:O,projectId:q})},scroll:{y:Z-131},style:{minHeight:Z},dataSource:p,toolbar:{search:l.createElement(m.default,{ref:w,style:{width:240,height:28},placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u7ec4",allowClear:!0,suffix:l.createElement("i",{className:"icon-cem_small-search",style:{color:"#bfbfbf"},onClick:function(){W(1),n({pageIndex:H,pageSize:B,inputValue:O})}}),onPressEnter:function(){W(1),n({pageIndex:H,pageSize:B,inputValue:O})},onKeyUp:function(e){R(w.current.state.value)},onChange:function(e){""===e.target.value&&(R(""),W(1),n({pageIndex:H,pageSize:B,inputValue:""}))}}),actions:[l.createElement(s.default,{key:"primary",type:"primary",onClick:function(){Q("\u65b0\u589e")}},"\u65b0\u589e\u7528\u6237\u7ec4")]},rowKey:"key",search:!1,options:!1}))),G&&l.createElement(C,(0,a.Z)({userGroupData:N,handleCancel:$,isModalVisible:G,typeOfModal:F,keyword:O,pageSize:B,setPageIndex:W},e)))};var Z=v.t.get(v.V.backProjectConfig).id,T=function(e){function t(t){var n;return(n=e.call(this,t)||this).event=void 0,n.fetchUserGroupData=function(){var e=(0,o.Z)(i().mark((function e(t){var a,o,u,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.pageIndex,o=t.pageSize,u=t.keyword,c=t.projectId,n.setState({loading:!0}),e.next=4,(0,y.Kh)({pageIndex:a||1,pageSize:o||10,keyword:u||"",projectId:c}).then((function(e){var t=e.data.result,a=t.list.map((function(e){return e.teamId}));return n.setState({tableListDataSource:t.list,totalNumber:t.total,teamId:a}),e.data.result}));case 4:return n.setState({loading:!1}),e.next=7,n.fetchUserGroupMembers().then((function(e){var t=e.data.result;n.setState({teamCount:t})})).catch((function(e){r.default.error("\u83b7\u53d6\u6210\u5458\u6570\u5931\u8d25")}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.fetchUserGroupMembers=(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.g1)({ids:n.state.teamId});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),n._handleOnFilterChange=function(e){void 0!==e.inputValue&&(n.setState({searchValue:e.inputValue}),n.fetchUserGroupData({pageIndex:1,pageSize:e.pageSize,keyword:e.inputValue,projectId:Z}))},n.event={onFilterChange:n._handleOnFilterChange,fetchUserGroupData:n.fetchUserGroupData},n.state={tableListDataSource:[],teamId:[],teamCount:[],totalNumber:1,searchValue:"",loading:!1},n}return(0,u.Z)(t,e),t.prototype.render=function(){return l.createElement(V,(0,a.Z)({},this.event,this.state))},t}(l.PureComponent);const D=T},20503:(e,t,n)=>{n.d(t,{eP:()=>r,Kh:()=>o,g1:()=>u,oV:()=>c,Vm:()=>i,rV:()=>l,WT:()=>s,Kp:()=>m,Dn:()=>d});var a=n(49722),r=function(e){return a.h.post("/upms/team/delete",e)},o=function(e){return a.h.post("/upms/team/list",e)},u=function(e){return a.h.post("/upms/team/member/count",e)},c=function(e){return a.h.post("/upms/team/update",e)},i=function(e){return a.h.post("/upms/team/add",e)},l=function(e){return a.h.post("/upms/team/detail",e)},s=function(e){return a.h.post("/upms/team/member/delete",e)},m=function(e){return a.h.post("/upms/team/member/add",e)},d=function(e){return a.h.post("/upms/team/validateName",e)}},13713:(e,t,n)=>{n.d(t,{u:()=>r});var a=n(35239),r=function(e){var t=e.title,n=e.url,r=a.t.get(a.V.backProjectConfig).name;return n&&-1!==n.indexOf("memberlist")?[{title:r,url:"/account/project/preview"},{title:"\u7528\u6237\u7ec4",url:"/account/project/usergroup"},{title:t,url:n}]:[{title:r,url:"/account/project/preview"},{title:t,url:n}]}}}]);