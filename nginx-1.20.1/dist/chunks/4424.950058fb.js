"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[4424],{31353:(e,t,a)=>{a.r(t),a.d(t,{default:()=>P});var n=a(63366),r=a(87462),i=a(94578),l=a(67294),o=a(55609),c=a(35103),s=a(67133),d=a(19731),f=a(89604),u=(a(43378),a(62443)),p=a(70715),h=a(39432),m=a(87300);const y=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=e.call.apply(e,[this].concat(n))||this).chartRef=void 0,t.source=void 0,t.dimensions=void 0,t.getChartRef=function(e){return t.chartRef=e},t.setValue=function(e){t.dimensions=["\u6027\u522b","\u6807\u7b7e\u6570\u91cf","\u5e74\u9f84\u6bb5","\u6807\u7b7e\u6570\u91cf"];try{var a=["\u6027\u522b","\u6807\u7b7e\u6570\u91cf"],n=e.gender.reduce((function(e,t){return e.push([t.name,t.count]),e}),[a]),r=["\u5e74\u9f84\u6bb5","\u6807\u7b7e\u6570\u91cf"],i=e.age.reduce((function(e,t){return e.push([t.name,t.count]),e}),[r]);t.dataset=[{dimensions:a,source:n},{dimensions:r,source:i}]}catch(l){}},t.getOption=function(e,a,n,i,l,o){return{title:{text:a},dataset:t.dataset.map((function(e){return(0,r.Z)({},e,{sourceHeader:!1})})),graphic:[{type:"text",top:52,left:20,style:{text:"\u6027\u522b\u5206\u5e03",font:"14px "+p.I8,fill:"#262626"},cursor:"default"},{type:"text",top:52,left:"50%",style:{text:"\u5e74\u9f84\u6bb5\u5206\u5e03",font:"14px "+p.I8,fill:"#262626"},cursor:"default"}],tooltip:{trigger:"item",showDelay:20,hideDelay:55,confine:!0,enterable:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n        box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",position:function(e,t,a,n,r){var i=r.contentSize,l=r.viewSize,o=e[0]<l[0]/2?0:-1,c=e[1]<l[1]/2?-.5:-1,s=e[0]<l[0]/2?20:-20;return[e[0]+o*i[0]+s,e[1]+c*i[1]]},formatter:function(e,t,n){var r=e.marker,i=e.name,l=e.value,c=e.percent;return setTimeout((function(){n(t,(0,m.r)(i+"</span>",["<div style='display: flex;justify-content: space-between;align-items: center;color: #8c8c8c;'><div><span style='vertical-align: bottom'>"+r+"</span>\u6807\u7b7e\u6570\u91cf</div><div style='color: #262626;margin-left: 12px;'>"+(0,h.hE)(l)+"\uff08"+c.toFixed(2)+"%\uff09</div></div>"],[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return o(e,a)}}],"yt_new_tooltip_wrapper"))}),0)}},series:[{name:"\u6027\u522b\u5206\u5e03",type:"pie",smooth:!0,datasetIndex:0,hoverOffset:0,minAngle:30,center:["25%","55%"],radius:["45%","135"],label:{show:n,position:"outside",color:"#262626",formatter:function(e){var t=e.name,a=e.value,n=e.percent;return[""+t,"{value|"+(0,h.hE)(a)+"\uff08"+n.toFixed(2)+"%\uff09}"].join("\n")},rich:{value:{fontSize:12,lineHeight:18,color:"#262626",align:"left"}}},labelLine:{show:n,smooth:!0,length:13},data:t.dataset[0].source.slice(1).map((function(e,t){return{value:e[1],name:e[0],itemStyle:{color:-1===i||i===t?p.OW[t]:"#bfbfbf"}}}))},{name:"\u5e74\u9f84\u6bb5\u5206\u5e03",type:"pie",smooth:!0,datasetIndex:1,hoverOffset:0,minAngle:30,center:["75%","55%"],radius:["45%","135"],label:{show:n,position:"outside",color:"#262626",formatter:function(e){var t=e.name,a=e.value,n=e.percent;return[""+t,"{value|"+(0,h.hE)(a)+"\uff08"+n.toFixed(2)+"%\uff09}"].join("\n")},rich:{value:{fontSize:12,lineHeight:18,color:"#262626",align:"left"}}},labelLine:{show:n,smooth:!0,length:13,length2:13},data:t.dataset[1].source.slice(1).map((function(e,t){return{value:e[1],name:e[0],itemStyle:{color:-1===l||l===t?p.OW[t]:"#bfbfbf"}}}))}]}},t}return(0,i.Z)(t,e),t.prototype.renderChart=function(e,t,a,n,r,i){this.setValue(e),this.chartRef.clear(),this.chartRef.setOption(this.getOption(e,t,a,n,r,i))},t}(l.PureComponent);var g=a(45697),v=a.n(g),D=a(8201),x=a(98191),C=a(50976),T=a(94644),E=a(81408),z=function(e){function t(t){var a;return(a=e.call(this,t)||this).resizeListener=function(){var e=document.querySelector(".yt_explore_scene_relation_pie_chart");e&&a.setState({width:e.offsetWidth})},a._handleOnJumpMsg=function(e,t){var n=a.props,r=n.projectId,i=n.dateFilter,l=n.headerFilterParamsNew,o=n.filterValues,c=e.name,s=e.seriesName,d=a.state,f=d.clickedAgeIndex,u=d.clickedGenderIndex,p=d.filter,h=f>-1||u>-1?p.headerFilterParamsNew:l,m=f>-1||u>-1?p.filterValues:o,y={filterValues:(0,E.gt)(m,s,c,!0),projectId:r,dateFilter:i,headerFilterParamsNew:(0,E.gt)(h,s,c),filterModel:{project:[r],messageCategory:["COMMENT"]},filterTip:null};window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(y)))},a.onChartClick=function(e){var t=e.componentType,n=e.name,r=e.seriesName,i=e.dataIndex,l=a.state,o=l.clickedGenderIndex,c=l.clickedAgeIndex,s=a.props,d=s.headerFilterParamsNew,f=s.fetchPieData,u=s.filterValues;if("series"===t)if("\u6027\u522b\u5206\u5e03"===r){var p={headerFilterParamsNew:i===o?d:(0,E.gt)(d,r,n),findKey:i===o?null:"gender",filterValues:i===o?u:(0,E.gt)(u,r,n)};a.setState({clickedGenderIndex:i===o?-1:i,filter:p},(function(){f(p)})),c>-1&&a.setState({clickedAgeIndex:-1})}else if("\u5e74\u9f84\u6bb5\u5206\u5e03"===r){var h={headerFilterParamsNew:i===c?d:(0,E.gt)(d,r,n),findKey:i===c?null:"age",filterValues:i===c?u:(0,E.gt)(u,r,n)};a.setState({clickedAgeIndex:i===c?-1:i,filter:h},(function(){f(h)})),o>-1&&a.setState({clickedGenderIndex:-1})}},a.onExportImage=function(){a.chartRef&&(0,T._v)(a.chartRef,a.props.title)},a.onExportExcel=function(){var e=a.props,t=e.title,n=e.data;if((0,D.P)(n)){var r=[].concat(a.dataset[0].source,[[""]],a.dataset[1].source);(0,T.aT)([r],t)}},a.state={showLabel:!0,clickedGenderIndex:-1,clickedAgeIndex:-1,filter:void 0,width:0},a}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this;this.renderChart(),this.internalId=setInterval((function(){if(e.chartRef){clearInterval(e.internalId),e.renderChart();var t=e.chartRef._dom.children,a=t[0],n=t[1];a.addEventListener("mouseleave",(function(t){e.chartLeaveTimeout=setTimeout((function(){e.chartLeaveTimeout&&(n.style.display="none")}),2e3)})),n&&n.addEventListener("mouseenter",(function(t){e.chartLeaveTimeout=void 0}))}}),200),window.addEventListener("resize",this.resizeListener)},a.componentDidUpdate=function(e,t){var a=e.data,n=this.props.data,r=t.showLabel,i=t.clickedGenderIndex,l=t.clickedAgeIndex,o=this.state,c=o.showLabel,s=o.clickedGenderIndex,d=o.clickedAgeIndex;if(JSON.stringify(a)!==JSON.stringify(n)&&(0,D.P)(n)){this.renderChart();var f=document.querySelector(".yt_explore_scene_relation_pie_chart");f&&this.setState({width:f.offsetWidth})}r===c&&i===s&&l===d||this.renderChart(),!(0,D.P)(n)&&this.chartRef&&(this.chartRef=void 0)},a.componentWillUnmount=function(){window.removeEventListener("resize",this.resizeListener)},a.renderChart=function(){var t=this.props,a=t.title,n=t.data,r=this.state,i=r.showLabel,l=r.clickedGenderIndex,o=r.clickedAgeIndex;(0,D.P)(n)&&this.chartRef&&e.prototype.renderChart.call(this,n,a,i,l,o,this._handleOnJumpMsg)},a.render=function(){var e=this,t=this.props,a=t.data,n=t.loading,r=t.title,i=this.state,o=i.showLabel,c=i.width;return l.createElement(D.Z,{className:"yt_explore_scene_relation_pie_chart",data:a,loading:n,renderTitle:l.createElement(x.Z,{title:r,data:a},l.createElement(u.default,{placement:"top",content:"\u663e\u793a\u56fe\u8868\u6807\u7b7e",mouseEnterDelay:.6},l.createElement("i",{className:"icon-tubiaobiaoqian "+(o?"active":""),onClick:function(){e.setState({showLabel:!o})}})),l.createElement(u.default,{placement:"top",content:"\u5bfc\u51fa\u6570\u636e",mouseEnterDelay:.6},l.createElement("i",{className:"icon-daochu",onClick:this.onExportExcel})),l.createElement(u.default,{placement:"top",content:"\u5bfc\u51fa\u56fe\u7247",mouseEnterDelay:.6},l.createElement("i",{className:"icon-xiazaitupian",onClick:this.onExportImage})))},(0,D.P)(a)&&this.chartRef&&l.createElement("span",{style:{position:"absolute",top:48,left:84,transition:"all 0.3s",zIndex:1,color:"#8c8c8c"}},l.createElement(u.default,{placement:"top",mouseEnterDelay:.3,content:l.createElement("div",{style:{maxWidth:362,fontSize:12}},"\u300c\u6027\u522b\u300d\u5373\u6d88\u606f\u4e2d\u63d0\u5230\u4f7f\u7528\u8005\u6027\u522b\u76f8\u5173\u7684\u4fe1\u606f\u3002\u4f8b\u5982\u300c\u6211\u4e70\u7ed9\u5973\u670b\u53cb\u7684\u300d\uff0c\u4f7f\u7528\u4eba\u662f\u300c\u5973\u670b\u53cb\u300d\uff0c\u6027\u522b\u4e3a\u300c\u5973\u300d\u3002")},l.createElement("i",{className:"icon-cem_file1"}))),(0,D.P)(a)&&this.chartRef&&l.createElement("span",{style:{position:"absolute",top:48,left:.5*c+70+8,transition:"all 0.3s",zIndex:1,color:"#8c8c8c"}},l.createElement(u.default,{placement:"top",mouseEnterDelay:.3,content:l.createElement("div",{style:{maxWidth:362,fontSize:12}},"\u300c\u5e74\u9f84\u6bb5\u300d\u5373\u6d88\u606f\u4e2d\u63d0\u5230\u4f7f\u7528\u8005\u5e74\u9f84\u6bb5\u76f8\u5173\u7684\u4fe1\u606f\u3002\u4f8b\u5982\u300c\u6211\u4e70\u7ed9\u5973\u670b\u53cb\u7684\u300d\uff0c\u4f7f\u7528\u4eba\u662f\u300c\u5973\u670b\u53cb\u300d\uff0c\u5e74\u9f84\u6bb5\u4e3a\u300c\u4e2d\u9752\u5e74\u300d\u3002")},l.createElement("i",{className:"icon-cem_file1"}))),l.createElement(C.Z,{onChartReady:this.getChartRef,theme:"yt_multi_color_10",option:{},style:{width:"100%",height:"100%"},onEvents:{click:this.onChartClick}}))},t}(y);z.propTypes={title:v().string,loading:v().bool,data:v().array};const b=z;const w=function(e){var t=e.pageType,a=e.dateOptions,n=e.trendData,r=e.timeType,i=e.fTimeType,o=e.fetchingTrendData,u=e.pieData,p=e.fetchingPieData,h=e.fetchPieData,m=e.barData,y=e.fetchingBarData,g=e.analyzeLineData,v=e.analyzeBarData,D=e.fetchingAnalyzeLineData,x=e.fetchingAnalyzeBarData,C=e.alzName,T=e.alzOptions,E=e.alzTimeType,z=e.alzFTimeType,w=e.projectId,F=e.dateFilter,_=e.filterValues,I=e.headerFilterParamsNew,k=e.filterReady,O=e.filterChange,N=e.onFilterChange,L=e.onFlavorChange,P=e.onMsgClick;return l.createElement("div",{className:"yt_explore_scene_relation_wrapper"},l.createElement(c.Z,{onReady:k,onChange:O,pageType:t,advanceAuthority:!1,touchData:["\u7535\u5546\u8bc4\u8bba"],selectValue:"\u7535\u5546\u8bc4\u8bba",valueConf:["fullInfo"],showList:["fullDate","screening","save","sourceSearch"],hasHour:!0},l.createElement("div",{className:"content"},l.createElement(d.Z,{title:"\u6807\u7b7e\u6570\u91cf",data:n,loading:o,timeType:r,fTimeType:i,timeOptions:a,onFilterChange:N,onFlavorChange:L,onMsgClick:P,titleOverlay:l.createElement("div",null,l.createElement("p",null,"\u573a\u666f\u6807\u7b7e\u63d0\u53ca\u7387 = \u63d0\u53ca\u4e86\u573a\u666f\u6807\u7b7e\u53bb\u91cd\u540e\u7684\u6d88\u606f\u6570\u91cf \xf7 \u6d88\u606f\u603b\u91cf"),l.createElement("p",null,"\u6807\u7b7e\u6570\u91cf\u8ba1\u7b97\u8bf4\u660e\uff1a\u5982\u679c\u4e00\u6761\u6d88\u606f\u4e2d\u51fa\u73b0\u4e00\u4e2a\u573a\u666f\u6807\u7b7e\u5c31\u8ba11\uff0c\u540c\u4e00\u4e2a\u573a\u666f\u6807\u7b7e\u5728\u4e00\u4e2a\u6d88\u606f\u4e2d\u4e0d\u91cd\u590d\u8ba1\u6570\u3002"))}),l.createElement(b,{data:u,projectId:w,dateFilter:F,headerFilterParamsNew:I,loading:p,fetchPieData:h,title:"\u4f7f\u7528\u4eba\u6027\u522b\u548c\u5e74\u9f84\u6bb5\u5206\u5e03",onMsgClick:P,filterValues:_}),l.createElement(s.Z,{title:"\u4f7f\u7528\u4eba\u7684\u89d2\u8272\u4e0e\u5173\u7cfb",tips:"\u300c\u89d2\u8272\u4e0e\u5173\u7cfb\u300d\u5373\u7ad9\u5728\u8d2d\u4e70\u4eba\u7684\u89d2\u5ea6\u63cf\u8ff0\u4f7f\u7528\u4eba\u7684\u89d2\u8272\u4e0e\u4f7f\u7528\u8005\u7684\u5173\u7cfb\u3002\u4f8b\u5982\u300c\u6211\u4e70\u7ed9\u5973\u670b\u53cb\u7684\u300d\uff0c\u4f7f\u7528\u4eba\u7684\u89d2\u8272\u4e0e\u5173\u7cfb\u662f\u300c\u5973\u670b\u53cb\u300d\u3002",data:m,loading:y,onMsgClick:P}),l.createElement(f.Z,{analyzeLineData:g,analyzeBarData:v,fetchingAnalyzeLineData:D,fetchingAnalyzeBarData:x,timeOptions:a,alzTimeType:E,alzFTimeType:z,alzOptions:T,alzName:C,onFilterChange:N,onFlavorChange:L,onMsgClick:P}))))};var F=a(35239),_=a(53113),I=a(2786),k=a(64396),O=["loading"],N=k.Z.explore.scene.relation,L=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleFilterReady=function(e,t){var n=(0,_.X)(e.dateFilter.numOfDays,!0),r=n.dateOptions,i=n.defaultDateType;a.props.fetchParams({projectId:F.t.get(F.V.curProject).id,headerFilterParamsNew:e.headerFilterParamsNew,dateFilter:e.dateFilter,dateOptions:r,defaultDateType:i,filterValues:t.fullInfo.filterValue})},a._handleFilterChange=function(e,t,n){var i=(0,_.X)(e.dateFilter.numOfDays,!0),l=i.dateOptions,o=i.defaultDateType;a.props.fetchDatas((0,r.Z)({},e,{dateOptions:l,defaultDateType:o,timeType:o,alzTimeType:o,filterValues:t.fullInfo.filterValue}))},a._handleOnFilterChange=function(e){var t=a.props,n=t.oLineData,i=t.oBarData,l=t.alzOptions;if(e.timeType&&a.props.fetchTrendData(e),e.alzName){var o=(0,E.dR)((0,r.Z)({oLineData:n,oBarData:i,alzOptions:l},e));a.props.save((0,r.Z)({},e,o))}e.alzTimeType&&a.props.fetchAnalyzeLineData(e)},a._handleOnFlavorChange=function(e){e.fTimeType||e.alzFTimeType,a.props.setDefaultValue(e)},a._handleOnMsgClick=function(e,t){var n=a.props,r=n.projectId,i=n.dateFilter,l=n.headerFilterParamsNew,o=n.filterValues,c=n.oLineData,s=n.alzTimeType,d=n.alzName,f=n.alzOptions,u={id:E.$x[E.$5[f.find((function(e){return e.name===d})).idKey]],label:E.$5[f.find((function(e){return e.name===d})).idKey],values:[d]},p=e.name,h=e.componentSubType,m=e.data,y={projectId:r,dateFilter:(0,I.X_)(h,i,p,c[0].data.map((function(e){return e.name})),s),headerFilterParamsNew:"bar"===h&&"\u4f7f\u7528\u4eba\u7684\u89d2\u8272\u4e0e\u5173\u7cfb"===t?(0,E.gt)(l,"\u5173\u7cfb",p):"line"===h?(0,E.gt)(l,E.$5[f.find((function(e){return e.name===d})).idKey],d):"bar"===h&&"\u5171\u540c\u63d0\u53ca\u7684\u5176\u4ed6\u573a\u666f\u6807\u7b7e"===t?(0,E.gt)(l,m[0],p.split(":")[1],"",u):l,filterModel:{project:[r],messageCategory:["COMMENT"]},filterTip:null,filterValues:"bar"===h&&"\u4f7f\u7528\u4eba\u7684\u89d2\u8272\u4e0e\u5173\u7cfb"===t?(0,E.gt)(o,"\u5173\u7cfb",p,!0):"line"===h?(0,E.gt)(o,E.$5[f.find((function(e){return e.name===d})).idKey],d,!0):"bar"===h&&"\u5171\u540c\u63d0\u53ca\u7684\u5176\u4ed6\u573a\u666f\u6807\u7b7e"===t?(0,E.gt)(o,m[0],p.split(":")[1],!0,u):o};window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(y)))},a.event={filterReady:a._handleFilterReady,filterChange:a._handleFilterChange,onFilterChange:a._handleOnFilterChange,onFlavorChange:a._handleOnFlavorChange,onMsgClick:a._handleOnMsgClick},a}(0,i.Z)(t,e);var a=t.prototype;return a.componentWillUnmount=function(){this.props.clean()},a.render=function(){return l.createElement(w,(0,r.Z)({},this.props,this.state,this.event))},t}(l.Component);const P=(0,o.connect)((function(e){var t=e.loading,a=(0,n.Z)(e,O);return(0,r.Z)({},a[N],{fetchingTrendData:t.effects[N+"/fetchTrendData"]||!1,fetchingPieData:t.effects[N+"/fetchPieData"]||!1,fetchingBarData:t.effects[N+"/fetchBarData"]||!1,fetchingAnalyzeLineData:t.effects[N+"/fetchAnalyzeLineData"]||!1,fetchingAnalyzeBarData:t.effects[N+"/fetchAnalyzeBarData"]||!1})}),(function(e){return{save:function(t){return e({type:N+"/save",payload:t})},clean:function(t){return e({type:N+"/clean",payload:t})},setDefaultValue:function(t){return e({type:N+"/setDefaultValue",payload:t})},fetchParams:function(t){return e({type:N+"/fetchParams",payload:t})},fetchDatas:function(t){return e({type:N+"/fetchDatas",payload:t})},fetchTrendData:function(t){return e({type:N+"/fetchTrendData",payload:t})},fetchPieData:function(t){return e({type:N+"/fetchPieData",payload:t})},fetchBarData:function(t){return e({type:N+"/fetchBarData",payload:t})},fetchAnalyzeLineData:function(t){return e({type:N+"/fetchAnalyzeLineData",payload:t})},fetchAnalyzeBarData:function(t){return e({type:N+"/fetchAnalyzeBarData",payload:t})}}}))(L)}}]);