"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6904],{86904:(e,t,a)=>{a.r(t),a.d(t,{default:()=>L});var n=a(63366),r=a(87462),i=a(94578),l=a(67294),o=a(55609),c=a(35239),s=a(26198),u=a(8201),p=a(98191),h=a(45697),d=a.n(h),v=a(50976),f=a(39432),m=a(70715),y=a(90126),g=["#D96969","#1574B3","#15B374","#E29494","#599BC7","#59C79B","#ECBFBF","#9DC3DD","#9DDDC3"],C={1:["negativeCount","positiveCount"],2:["negativeRate","positiveRate","voiceRate"],3:["negativeRate","positiveRate"]},_={1:["\u8d1f\u9762","\u6b63\u9762"],2:["\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4","\u6b63\u9762\u58f0\u91cf\u5360\u6bd4","\u603b\u76f8\u5bf9\u5360\u6bd4"],3:["\u5dee\u8bc4\u7387","\u597d\u8bc4\u7387"]};var O=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).getChartRef=function(e){var a,n=t.props,r=n.chartType,i=n.onChartReady;t.chartRef=e,i(((a={})[r]=e,a))},t._handleOnClick=function(e){var a=t.props,n=a.onClick,r=a.chartType,i=a.emotionType,l=e.componentType,o=(e.componentIndex,e.seriesIndex,e.seriesName),c=e.encode,s=e.value;if("series"===l){var u=o;1===r?u=o.substring(0,o.length-2):2===r?u=o.substring(0,o.length-("all"===i?5:6)):3===r&&(u=o.substring(0,o.length-3));var p=c.x[0];c.y[0];n&&n({type:l,chartType:r,name:u,aspect:s[0],value:s[p],aspectEmotion:1===p?3:2===p?8:""})}else"yAxis"===l&&n&&n({type:l,aspect:s,chartType:r})},t}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.renderChart()},a.componentDidUpdate=function(e){var t=e.data,a=e.emotionType,n=this.props,r=n.data,i=n.emotionType;((0,u.P)(r)&&JSON.stringify(t)!==JSON.stringify(r)||i!==a)&&this.renderChart(),!(0,u.P)(r)&&this.chartRef&&(this.chartRef=void 0)},a.renderChart=function(){var t=this.props,a=t.data,n=t.title,r=t.emotionType,i=t.chartType,l=t.onDataReady;(0,u.P)(a)&&this.chartRef&&e.prototype.renderChart.call(this,a,n,r,i,l)},a.render=function(){var e=this.props,t=e.data,a=e.title,n=e.titleOverlay,r=e.loading,i=e.className,o=e.emptyHint;return l.createElement(u.Z,{className:"yt_social_analysis_tap_bar_chart_wrapper "+i,data:t,loading:r,emptyHint:o,renderTitle:l.createElement(p.Z,{data:t,title:a,titleOverlay:n})},l.createElement(v.Z,{onChartReady:this.getChartRef,option:{},theme:"yunting_multi_color",style:{height:"100%"},onEvents:{click:this._handleOnClick}}))},t}(function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).chartRef=void 0,t.dataset=[],t.color=[],t.dataPos=[],t.barWidth=24,t.setValue=function(e,a,n){var r=[],i=[];1===n?"all"===a?(r=[1,2],i=g.reduce((function(e,t,a){return a%3!==1&&e.push(t),e}),[])):"8"===a?(r=[2],i=g.reduce((function(e,t,a){return a%3===2&&e.push(t),e}),[])):"3"===a&&(r=[1],i=g.reduce((function(e,t,a){return a%3===0&&e.push(t),e}),[])):2===n?"all"===a?(r=[3],i=g.reduce((function(e,t,a){return a%3===1&&e.push(t),e}),[])):"8"===a?(r=[2],i=g.reduce((function(e,t,a){return a%3===2&&e.push(t),e}),[])):"3"===a&&(r=[1],i=g.reduce((function(e,t,a){return a%3===0&&e.push(t),e}),[])):3===n&&("all"===a?(r=[1,2],i=g.reduce((function(e,t,a){return a%3!==1&&e.push(t),e}),[])):"8"===a?(r=[2],i=g.reduce((function(e,t,a){return a%3===2&&e.push(t),e}),[])):"3"===a&&(r=[1],i=g.reduce((function(e,t,a){return a%3===0&&e.push(t),e}),[])));var l=[],o=e.reduce((function(t,r,o){var c=y.fv[r.name.toLocaleLowerCase()];c&&("all"===a?2===n?i[o]=c[1]:(i[2*o]=c[0],i[2*o+1]=c[2]):"8"===a?i[o]=c[2]:"3"===a&&(i[o]=c[0])),l.push(["\u6307\u6807"].concat(_[n].map((function(e){return""+r.name+e}))));var s=e[0].values&&e[0].values instanceof Array&&e[0].values||[],u=s.map((function(e){return[e.name]}));return s.forEach((function(e,t){if(0===o)C[n].forEach((function(a){u[t].push(e[a])}));else{var a=r.values.find((function(t){return t.name===e.name}));a&&C[n].forEach((function(e){u[t].push(a[e])}))}})),t.push(u),t}),[]);t.dataPos=r,t.color=i,t.dataset=l.map((function(e,t){return{dimensions:e,source:o[t]}}))},t.getOption=function(e,a){return{title:{top:10,text:e},color:t.color,grid:{containLabel:!0,top:80,left:20,right:40,bottom:30},legend:{type:"scroll",top:40,left:20,right:20,itemWidth:10,itemHeight:10,pageIconSize:12,icon:m.W4.square,textStyle:{lineHeight:14}},dataset:t.dataset,tooltip:{formatter:function(e){var t=e.encode,n=e.marker,r=e.value,i=e.seriesName,l=r[t.x[0]];return[(0,m.Zi)(i),n+" "+r[0]+"\uff1a"+(1!==a?(100*l).toFixed(2)+"%":(0,f.uf)(l))].join("</br>")}},xAxis:{type:"value",splitNumber:2,axisLabel:{formatter:function(e){return 1!==a?100*e+"%":e}}},yAxis:{type:"category",inverse:!0,triggerEvent:!0,zlevel:1,axisLabel:{formatter:["{a|value}"],rich:{a:{}}}},series:t.dataset.reduce((function(e,a,n){var r=a.dimensions,i=t.dataPos.map((function(e){return{name:r[e],type:"bar",stack:n+1,datasetIndex:n,barWidth:t.barWidth,encode:{x:e,y:0},barGap:"2%",barCategoryGap:20,itemStyle:{borderWidth:2,borderColor:"#fff"}}}));return e.concat(i)}),[])}},t}return(0,i.Z)(t,e),t.prototype.renderChart=function(e,t,a,n,r){var i;this.setValue(e,a,n),r&&r(((i={})[n]=this.dataset,i)),this.chartRef.clear(),this.chartRef.resize(),this.chartRef.setOption(this.getOption(t,n))},t}(l.PureComponent));const E=O;O.propTypes={className:d().string,loading:d().bool,data:d().any,title:d().string,titleOverlay:d().string|d().node,onChartReady:d().func,emotionType:d().string,chartType:d().number,onClick:d().func,onDataReady:d().func,emptyHint:d().string};var T=a(24062),b=[{title:"\u5168\u90e8\u60c5\u611f",value:"all"},{title:"\u6b63\u9762\u60c5\u611f",value:"8"},{title:"\u8d1f\u9762\u60c5\u611f",value:"3"}],R=[{title:"\u4e00\u7ea7\u6807\u7b7e",value:"VOC_ASPECT_FIRST"},{title:"\u4e8c\u7ea7\u6807\u7b7e",value:"VOC_ASPECT_SECOND"},{title:"\u4e09\u7ea7\u6807\u7b7e",value:"VOC_ASPECT_THIRD"},{title:"\u56db\u7ea7\u6807\u7b7e",value:"VOC_ASPECT_FOURTH"}],D=[{title:"\u6309\u5de6\u56fe\u5347\u5e8f",value:"group_asc"},{title:"\u6309\u5de6\u56fe\u964d\u5e8f",value:"group_desc"},{title:"\u72ec\u7acb\u5347\u5e8f",value:"asc"},{title:"\u72ec\u7acb\u964d\u5e8f",value:"desc"}];function A(e){return e.length>1?{id:e[0].split("_")[0],value:A(e.slice(1))}:{id:e[0].split("_")[0]}}const P=function(e){var t=e.chart1Data,a=e.fetchingChart1Data,n=e.chart2Data,r=e.fetchingChart2Data,i=e.chart3Data,o=e.emotionType,c=e.flavorEmotionType,h=e.aspectLevel,d=e.flavorAspectLevel,v=e.rangeType,f=e.flavorRangeType,m=e.onFilterReady,y=e.onFilterChange,g=e.onMoreClick,C=e.onChartReady,_=e.onFlavorChange,O=e.onChartClick,A=e.onDataReady,P=e.pageType,N=e.analysisModel,k=0;try{var F=t instanceof Array?(24*.3*(t.length-1)+24*t.length+20)*t[0].values.length+160:0,S=n instanceof Array?(24*.3*(n.length-1)+24*n.length+20)*n[0].values.length+160:0;k=Math.max(F,S,500)}catch(j){k=500}return l.createElement("div",{className:"yt_social_analysis_tag_top_wrapper"},l.createElement(s.Z,{pageType:P.includes("brand")?"SOCIAL_TAG_BRAND_TOP_30":"SOCIAL_TAG_SERIES_TOP_30",values:[],onReady:m,onChange:y}),l.createElement("div",{className:"content"},l.createElement(u.Z,{className:"content_view",data:{},renderTitle:l.createElement(p.Z,{title:"\u6807\u7b7e\u5206\u6790",titleOverlay:l.createElement("div",null,l.createElement("div",null,"\u8d1f\u9762\u76f8\u5bf9\u5360\u6bd4 = \u673a\u578bA\u6307\u6807a\u8d1f\u9762 \xf7 \u673a\u578bA\u7684\u603b\u8d1f\u9762"),l.createElement("div",null,"\u6b63\u9762\u76f8\u5bf9\u5360\u6bd4 = \u673a\u578bA\u6307\u6807a\u6b63\u9762 \xf7 \u673a\u578bA\u7684\u603b\u6b63\u9762"),l.createElement("div",null,"\u603b\u76f8\u5bf9\u5360\u6bd4 = \u673a\u578bA\u6307\u6807a\u6b63\u8d1f\u9762 \xf7 \u673a\u578bA\u7684\u603b\u58f0\u91cf"),l.createElement("div",null,"\u597d\u8bc4\u7387 = \u673a\u578bA\u6307\u6807a\u6b63\u9762 \xf7 \u673a\u578bA\u6307\u6807a\u603b\u58f0\u91cf"),l.createElement("div",null,"\u5dee\u8bc4\u7387 = \u673a\u578bA\u6307\u6807a\u8d1f\u9762 \xf7 \u673a\u578bA\u6307\u6807a\u603b\u58f0\u91cf")),onMoreClick:g},l.createElement(T.Z,{options:b,activeObj:o,onChange:y,objName:"emotionType",flavor:c,onFlavorChange:_}),l.createElement(T.Z,{options:R,activeObj:h,onChange:y,objName:"aspectLevel",flavor:d,onFlavorChange:_}),l.createElement(T.Z,{options:D,onChange:y,activeObj:v,objName:"rangeType",flavor:f,onFlavorChange:_}))},l.createElement("div",{className:"chart_view",style:{height:k}},l.createElement(E,{className:"chart",title:"\u6307\u6807\u58f0\u91cf",chartType:1,emotionType:o,onChartReady:C,titleOverlay:l.createElement("div",null,"\u57fa\u4e8eNLP\u7b97\u6cd5\uff0c\u6bcf\u4e00\u4e2a\u6307\u6807\u7684\u60c5\u611f\u5747\u6709\u4e24\u79cd\uff1a\u6b63\u9762\u60c5\u611f\u548c\u8d1f\u9762\u60c5\u611f\u3002"),key:"\u6307\u6807\u58f0\u91cf",data:t,loading:a,onClick:O,onDataReady:A,emptyHint:N&&N.length>0&&"\u3010"+N[0].values[0].values[0].split("_")[1]+"\u3011\u6682\u65e0\u6570\u636e"}),l.createElement(E,{className:"chart",title:"all"===o?"\u603b\u76f8\u5bf9\u5360\u6bd4":"\u76f8\u5bf9\u5360\u6bd4",chartType:2,emotionType:o,onChartReady:C,titleOverlay:l.createElement("div",null,l.createElement("div",null,"\u8d1f\u9762\u76f8\u5bf9\u5360\u6bd4 = \u673a\u578bA\u6307\u6807a\u8d1f\u9762 \xf7 \u673a\u578bA\u7684\u603b\u8d1f\u9762"),l.createElement("div",null,"\u6b63\u9762\u76f8\u5bf9\u5360\u6bd4 = \u673a\u578bA\u6307\u6807a\u6b63\u9762 \xf7 \u673a\u578bA\u7684\u603b\u6b63\u9762"),l.createElement("div",null,"\u603b\u76f8\u5bf9\u5360\u6bd4 = \u673a\u578bA\u6307\u6807a\u6b63\u8d1f\u9762 \xf7 \u673a\u578bA\u7684\u603b\u58f0\u91cf")),key:"\u603b\u76f8\u5bf9\u5360\u6bd4",data:n,loading:a||r,onClick:O,onDataReady:A,emptyHint:N&&N.length>0&&"\u3010"+N[0].values[0].values[0].split("_")[1]+"\u3011\u6682\u65e0\u6570\u636e"}),l.createElement(E,{className:"chart",title:"\u597d\u8bc4\u7387&\u5dee\u8bc4\u7387",chartType:3,emotionType:o,onChartReady:C,titleOverlay:l.createElement("div",null,l.createElement("div",null,"\u597d\u8bc4\u7387 = \u673a\u578bA\u6307\u6807a\u6b63\u9762 \xf7 \u673a\u578bA\u6307\u6807a\u603b\u58f0\u91cf"),l.createElement("div",null,"\u5dee\u8bc4\u7387 = \u673a\u578bA\u6307\u6807a\u8d1f\u9762 \xf7 \u673a\u578bA\u6307\u6807a\u603b\u58f0\u91cf")),key:"\u597d\u8bc4\u7387&\u5dee\u8bc4\u7387",data:i,loading:a,onClick:O,onDataReady:A,emptyHint:N&&N.length>0&&"\u3010"+N[0].values[0].values[0].split("_")[1]+"\u3011\u6682\u65e0\u6570\u636e"})))))};var N=a(94644),k=a(64396),F=a(87219),S=["loading"],j=k.Z.social.tag.top30,w=["VOC_ASPECT_FIRST","VOC_ASPECT_SECOND","VOC_ASPECT_THIRD","VOC_ASPECT_FOURTH"],Z=function(e){function t(t){var a;(a=e.call(this,t)||this)._handleOnChartReady=function(e){a.chartRefObj=(0,r.Z)({},a.chartRefObj,e)},a._handleOnDataReady=function(e){a.chartDataObj=(0,r.Z)({},a.chartDataObj,e)},a._handleOnFilterReady=function(e){var t=a.state.pageType,n=e.analysisModel;("BRAND"===n[0].values[0].id&&"brand_top"===t||"SERIES"===n[0].values[0].id&&"models_top"===t)&&(a.props.save({projectId:c.t.get(c.V.curProject).id}),a.props.fetchParams((0,r.Z)({},e,{filterModel:e.filterValue,pageType:a.state.pageType,projectId:c.t.get(c.V.curProject).id})))},a._handleOnFilterChange=function(e){if(e.filterValue){var t=JSON.stringify(e.dateFilter)!==JSON.stringify(a.props.dateFilter);a.props.fetchChartsData((0,r.Z)({},e,{filterModel:e.filterValue,filtedObjs:t?void 0:(0,y.ZT)(a.props,e),projectId:c.t.get(c.V.curProject).id}))}else if(e.aspectLevel){var n=w.indexOf(e.aspectLevel);a.chartLevel=n,a.props.fetchChartsData((0,r.Z)({},e,{projectId:c.t.get(c.V.curProject).id}))}else(e.rangeType||e.emotionType)&&a.props.fetchChartsData((0,r.Z)({},e,{projectId:c.t.get(c.V.curProject).id}))},a._handleOnFlavorChange=function(e){a.props.updateFlavors(e)},a._handleOnMoreClick=function(e){var t="\u6807\u7b7eTop30\uff08"+("brand_top"===a.state.pageType?"\u54c1\u724c":"\u673a\u578b")+"\uff09";if("image"===e)(0,N.OH)(Object.values(a.chartRefObj),t,["\u6307\u6807\u58f0\u91cf","\u603b\u76f8\u5bf9\u5360\u6bd4","\u597d\u8bc4\u7387&\u5dee\u8bc4\u7387"]);else if("data"===e){var n=[].concat(Object.values(a.chartDataObj).map((function(e){return e.reduce((function(e,t){return e.push(t.dimensions),t.source.forEach((function(t){var a=t.map((function(e,t){return 0!==t&&e<1?(100*e).toFixed(2)+"%":e}));e.push(a)})),e.push([""]),e}),[])})));(0,N.aT)(n,t,["\u6307\u6807\u58f0\u91cf","\u603b\u76f8\u5bf9\u5360\u6bd4","\u597d\u8bc4\u7387&\u5dee\u8bc4\u7387"])}},a._handleOnChartClick=function(e){var t=e.type,n=e.aspectEmotion,r=e.name,i=e.aspect,l=e.chartType,o=a.props,c=o.filterModel,s=o.dateFilter,u=o.analysisModel,p=o.aspectLevel,h=o.cachedOrigin1,d=o.cachedOrigin2,v=(2===l?d:h)[0].tagCountVOs.find((function(e){return e.aspect===i})),f=v.id,m=v.relation;if("series"===t){var y;y=A(m.slice(0,a.chartLevel+1));var g=u[0].id,C=u[0].values[0].id,_={name:r,label:y,aspect:i,pageType:a.state.pageType,aspectEmotion:n,filterModel:(0,F.ZP)(c,(function(e){var t=e.find((function(e){return e.id===g}));if(t){var a=t.values.find((function(e){return e.id===C}));a&&(a.values=a.values.filter((function(e){return e.includes(r)})))}})),dateFilter:s,analysisModel:(0,F.ZP)(u,(function(e){var t=e[0].values[0].values;e[0].values[0].values=t.filter((function(e){return e.includes(r)}))}))};window.open("/social/tag/brand/detail?"+JSON.stringify(_),"_blank")}else if("yAxis"===t&&"VOC_ASPECT_FOURTH"!==p){var O=w.indexOf(p);a.chartLevel=O+1,a.props.fetchChartsData({aspect:f,lastAspectLevel:p,aspectLevel:w[a.chartLevel]})}};var n=t.location.pathname.split("/");return a.state={pageType:n[3]+"_"+n[4]},a.event={onFilterReady:a._handleOnFilterReady,onFilterChange:a._handleOnFilterChange,onFlavorChange:a._handleOnFlavorChange,onMoreClick:a._handleOnMoreClick,onChartReady:a._handleOnChartReady,onChartClick:a._handleOnChartClick,onDataReady:a._handleOnDataReady},a.chartRefObj={},a.chartDataObj={},a.chartLevel=0,a}(0,i.Z)(t,e);var a=t.prototype;return a.componentWillUnmount=function(){this.props.clean()},a.render=function(){return l.createElement(P,(0,r.Z)({},this.props,this.state,this.event))},t}(l.PureComponent);const L=(0,o.connect)((function(e){var t=e.loading,a=(0,n.Z)(e,S);return(0,r.Z)({},a[j],{fetchingChart1Data:t.effects[j+"/fetchChart1Data"]||!1,fetchingChart2Data:t.effects[j+"/fetchChart2Data"]||!1,fetchingChart3Data:t.effects[j+"/fetchChart3Data"]||!1})}),(function(e){return{save:function(t){return e({type:j+"/save",payload:t})},clean:function(t){return e({type:j+"/clean",payload:t})},fetchParams:function(t){return e({type:j+"/fetchParams",payload:t})},fetchChartsData:function(t){return e({type:j+"/fetchChartsData",payload:t})},updateFlavors:function(t){return e({type:j+"/updateFlavors",payload:t})}}}))(Z)},24062:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(94578),r=a(67294),i=a(45697),l=a.n(i),o=a(39432),c=a(43036),s=function(e){function t(t){var a;return(a=e.call(this,t)||this).getPanelWidth=function(){var e=a.props,t=e.flavor,n=e.options,r=Math.max.apply(null,n.map((function(e){return(0,o.jD)(e.title,14)})))+2+10+32;return(r+=void 0!==t?24:0)>100?r:100},a._setPadShowFalse=function(){a.state.show&&a.setState({show:!1})},a._handleParentClick=function(e){a.state.show&&a.props.showFlavor&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},a._handleTriggerOnClick=function(){var e=a.state.show;setTimeout((function(){a.setState({show:!e})}),0)},a.state={show:!1,firstLiHover:!1,panelWidth:a.getPanelWidth()},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},a.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},a.componentDidUpdate=function(e){var t=e.options,a=this.props.options;JSON.stringify(t)!==JSON.stringify(a)&&this.setState({panelWidth:this.getPanelWidth()})},a.render=function(){var e=this.state,t=e.show,a=e.panelWidth,n=this.props,i=n.activeObj,l=void 0===i?"":i,o=n.onChange,s=n.options,u=n.objName,p=n.preTitle,h=n.sufTitle,d=void 0===h?"":h,v=n.showTitle,f=void 0===v||v,m=n.overlay,y=n.divider,g=void 0===y?"right":y,C=n.flavor,_=n.onFlavorChange,O=s.find((function(e){return e.value===l})),E=""===l?d:O&&O.title;return r.createElement("div",{className:"single_select_button_wrapper single_select_diviver_"+g,onClick:this._handleParentClick},r.createElement("div",{className:"button_content"},r.createElement("span",{onClick:this._handleTriggerOnClick},r.createElement("span",{className:"button-trigger "+(t?"sel":"")},f&&r.createElement(r.Fragment,null,p&&r.createElement("span",{className:"pre-title"},p,"\uff1a"),r.createElement("span",{className:"button-title"},E)),r.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),m&&r.createElement("span",{style:{marginLeft:4}},r.createElement(c.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:m},r.createElement("i",{className:"icon-cem_file1"})))),r.createElement("div",{className:"button-panel "+(t?"active":""),style:{minWidth:a}},s.map((function(e,t){return r.createElement("div",{className:"panel-item "+(e.value===l?"sel":"")+" "+(e.disabled?"disabled":""),key:e.value,onClick:function(){var t;!e.disabled&&o(u?((t={})[u]=e.value,t):e.value)}},e.title,r.createElement("i",{className:C===e.value?"icon-cem_star":"icon-cem_star-filling star_hide",onClick:function(t){var a,n;t.stopPropagation(),_(C===e.value?((a={})[u]="",a):((n={})[u]=e.value,n))}}))})))))},t}(r.PureComponent);s.propTypes={activeObj:l().any,onChange:l().func.isRequired,options:l().array.isRequired,objName:l().any,preTitle:l().string,sufTitle:l().string,showTitle:l().bool,overlay:l().string,divider:l().oneOf(["both","left","right"]),flavor:l().string,onFlavorChange:l().func};const u=s}}]);