"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2614],{59132:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(67294),r=a(43036),i=a(25713),o=a(39432),s=a(45697),l=a.n(s),c=a(8201),u=function(e){var t=e.title,a=void 0===t?"":t,s=e.data,l=e.titleOverlay,u=e.titleSelector,p=e.children,d=e.onMoreClick,h=e.moreOptions,f=e.className,m=e.status,g=(e.id,!(0,c.P)(s));return n.createElement("div",{className:"yt_dashboard_chart_title_wrapper "+(f||"")},n.createElement("span",{className:"chart_title"},g&&n.createElement("span",{className:"chart_title_name"},a),(u||l)&&n.createElement("span",{className:"chart_title_suffix",style:{marginLeft:g?0:(0,o.jD)(a)+14+(u?14:0)}},!!u&&u,l&&n.createElement(r.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:l},n.createElement("i",{className:"icon-cem_file1"})))),n.createElement("span",{className:"chart_title_buttons"},p,d&&n.createElement(i.Z,{disabled:m||!1,disableType:["copy","edit"],panelOverlay:"\u51fa\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u5982\u76f8\u5173\u8d1f\u8d23\u4eba\u8981\u6c42\r\u4e0b\u67b6\uff0c\u8be5\u56fe\u8868\u6a21\u677f\u5df2\u4e0b\u67b6\uff0c\u4f60\u53ef\u4ee5\r\u53bb\u6dfb\u52a0\u80fd\u591f\u6ee1\u8db3\u76f8\u540c\u5206\u6790\u610f\u56fe\u7684\u56fe\r\u8868\u3002\u5982\u679c\u4f60\u4ecd\u9700\u8981\u8be5\u56fe\u8868\uff0c\u8bf7\u8054\u7cfb\r\u7cfb\u7edf\u7ba1\u7406\u5458\u3002",onClick:d,options:h})))};const p=u;u.propTypes={data:l().any,title:l().string,titleOverlay:l().string,titleSelector:l().node,onMoreClick:l().func,moreOptions:l().array}},72982:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ba});var n=a(94578),r=a(67294),i=a(13047),o=a(52314),s=a(49722),l=a(53281),c=a(87462),u=a(92360),p=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={value:""},t.getValue=function(){return t.state.value},t.change=function(e){t.setState({value:e})},t}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){},a.render=function(){var e=this.props.title,t=this.state.value;return r.createElement(u.Form.Item,{label:"\u6807\u9898",className:"tool-title"},r.createElement(u.Input,{onChange:this.change,placeholder:"\u8bf7\u8f93\u5165\u6807\u9898\uff082-20\u5b57\u7b26\uff09",value:t||e}))},t}(r.Component),d=a(80157),h=(a(66161),function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).width=4,t.height=4,t.isSingle=!1,t.type=null,t.state={projectId:null,projects:[]},t.apply=function(){var e=t.refs.filter.getParams(),a=t.refs.title.props.title;return""!==t.refs.title.state.value&&(a=t.refs.title.state.value),e.project=e.project?e.project:[t.state.projectId],{type:t.type,title:a,filter:e}},t}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this;s.h.post("/projects/list").then((function(t){var a=t.data.result.list;e.setState({projects:a,projectId:e.state.projectId||a&&a[0]&&a[0].id})}))},a.componentWillReceiveProps=function(e){var t=this.state.projectId,a=this.props.config.config;a&&a.widget&&a.widget.projectId&&(t=a.widget.projectId,this.setState({projectId:t}))},a.render=function(){var e=this.props.config,t=e.filter,a=e.config,n=a?a.widget.projectId:"",i={filter:t.filter((function(e){return"project"!==e})),type:"dialog",model:"WIDGET",projectId:n,aspect:t.indexOf("aspect")>=0,selectConfig:a&&a.widget?a.widget.filterModel:{}};return r.createElement("div",{className:"tool-wrap"},r.createElement(p,{ref:"title",title:a?a.title:""}),r.createElement(d.Z,(0,c.Z)({ref:"filter"},i)))},t}(r.Component)),f=a(84948),m=a(29531),g=a.n(m),v=a(78436);const y={widget:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=e.call.apply(e,[this].concat(n))||this).getChartData=function(){var e=t.state,a=[[e.total,e.today,e.avg]];t.downloadExcel({titles:["\u6570\u636e\u603b\u91cf","\u4eca\u65e5\u6570\u636e\u91cf","\u5e73\u5747\u6bcf\u5929\u6570\u636e\u91cf"],data:a})},t.buildBody=function(){var e=t.state.json;return e&&"string"!==typeof e?r.createElement("div",{className:"widget-body num-chart",ref:"numChart"},r.createElement("div",null,r.createElement(f.Z,{col:"md-12"},r.createElement("div",{className:"num-body",ref:"total"},t.buildNum(t.state.total,2)))),r.createElement("div",null,r.createElement(f.Z,{col:"md-6"},r.createElement("div",{className:"num-sub-title"},"\u4eca\u65e5\u6570\u636e\u91cf"),r.createElement("div",{className:"num-sub-body",ref:"today"},t.buildNum(t.state.today,2))),r.createElement(f.Z,{col:"md-6"},r.createElement("div",{className:"num-sub-title"},"\u5e73\u5747\u6bcf\u5929\u6570\u636e\u91cf"),r.createElement("div",{className:"num-sub-body",ref:"avg"},t.buildNum(t.state.avg,2))))):r.createElement("div",{className:"widget-body"},r.createElement(v.Z,{ref:"chart",className:"widget-chart"}))},t.buildChart=function(){var e=t.state.json;if(e)if("string"!==typeof e){var a=t.state,n=a.total,r=a.today,i=a.avg,o=e.total||0,s=e.avgDay||0,l=e.today||0;if(n!==o||r!==l||i!==s){var c=t.refs.numChart.offsetWidth/5,u=t.refs.numChart.offsetHeight/3,p=c<=24?24:c>=u?u:c;document.documentElement.style.fontSize=p+"px",document.body.style.fontSize="14px",t.setState({total:o,today:l,avg:s})}}else t.refs.chart.setEmptyOption(e);else t.refs.chart.loading()},t}(0,n.Z)(t,e);var a=t.prototype;return a.setHost=function(e){this.host=e},a.componentWillMount=function(){this.setState({title:"\u6570\u636e\u91cf",color:"#B0D3BF",subColor:"#333"})},a.downloadChart=function(e){var t=this;g()(this.refs.widget,{background:"#fff",onrendered:function(a){var n=a.toDataURL("png");t.downloadFile(e,n)}})},t}(l.Z),tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).type="COUNTER_NUM",t}return(0,n.Z)(t,e),t}(h)};var E=a(97326),C=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).change=function(e){t.props.changeProject(e)},t}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.value,a=e.selectAll;return r.createElement(u.Form.Item,{label:"\u9879\u76ee"},r.createElement(u.Select,{value:t,onChange:this.change,placeholder:""},a&&a.map((function(e,t){return r.createElement(u.Select.Option,{key:t,label:e.name,value:e.id},e.name)}))))},t}(r.Component),b=a(38425),S=a(24473),O=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).clickTopic=function(e){var a=t.props.value,n=[];a.indexOf(e)<0?(a.map((function(e){return n.push(e)})),n.push(e)):a.filter((function(t){return t!==e})).map((function(e){return n.push(e)})),t.props.changeTopics(n)},t}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.selectAll,n=t.value,i=t.projectId,o=a?i?a.filter((function(e){return e.id===i}))[0]:a[0]:null;return r.createElement(u.Form.Item,{label:"\u4e3b\u9898"},a&&o&&o.topics.map((function(t,a){return r.createElement(S.Z,{key:a,onChange:function(){e.clickTopic(t.id)},value:t.id,checked:n.indexOf(t.id)>=0},t.name)})))},t}(r.Component),w=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).selectSource=function(e){var a=t.props.value,n=[];a.indexOf(e)<0?(a.map((function(e){return n.push(e)})),n.push(e)):a.filter((function(t){return t!==e})).map((function(e){return n.push(e)})),t.props.changeSources(n)},t}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.selectAll,n=t.value,i=t.projectId,o=a?i?a.filter((function(e){return e.id===i}))[0]:a[0]:null;return r.createElement(u.Form.Item,{label:"\u6570\u636e\u6765\u6e90"},o&&o.sources.map((function(t,a){return r.createElement(S.Z,{key:a,onChange:function(){e.selectSource(t.id)},value:t.id,checked:n.indexOf(t.id)>=0},t.name)})))},t}(r.Component),T=(r.Component,a(61409),function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).getChartData=function(){if(t.refs.chart&&t.refs.chart.myChart){var e=t.refs.chart.myChart.getOption().series,a=[];e.map((function(e){return e.data.map((function(e){return a.push(e)}))})),t.downloadExcel({titles:["\u65e5\u671f","\u6570\u91cf","\u7c7b\u522b"],data:a})}},t.buildChart=function(){var e=t.state,a=e.colors,n=e.json;if(n)if("string"===typeof n||0!==n.length&&0!==n[0].buckets.length||(n="\u6ca1\u6709\u6570\u636e\u53ef\u7528"),"string"!==typeof n){t.jsonStr===JSON.stringify(n)?t.refs.chart.myChart.resize():t.jsonStr=JSON.stringify(n);var r=n[0].buckets.map((function(e){return e.date})),i=(0,E.Z)(t),o={},s=n.map((function(e){return o[e.name]=o[e.name]||0,{name:e.name,data:e.buckets.map((function(t){return o[e.name]+=t.count||0,[t.date,t.count,e.name,e.id]})),type:"line",smooth:.4,smoothMonotone:"none",stack:"line",areaStyle:{opacity:1}}}));s.sort((function(e,t){return o[e.name]-o[t.name]}));var l=8*(2*Math.max.apply(Math,Object.keys(o).map((function(e){return e.length})))),c=8*Math.max.apply(Math,Object.keys(o).map((function(e){return(""+o[e]).length}))),u={orient:"vertical",width:180,right:10,data:s.map((function(e){return e.name})).reverse(),formatter:function(e){return"{a|"+e+"}{b|"+i.buildNum(o[e],2)+"}"},textStyle:{rich:{a:{fontSize:14,width:l+20},b:{fontSize:14,width:c,align:"right"}}},type:"scroll"},p=[];u.data.map((function(e,t){p.push(a[t%a.length])}));var d={tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross",label:{margin:10,formatter:function(e){return"number"===typeof e.value?e.value.toFixed(0):e.value}}},formatter:function(e){if(e&&e.length)return e[0].name+e.map((function(e){return"<br/>"+e.marker+e.seriesName+"\uff1a"+e.value[1]})).reverse().join("")}},legend:u,series:s,color:p.reverse(),grid:{containLabel:!0,left:30,right:l+c+100,bottom:10,top:25},yAxis:[{type:"value",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{formatter:function(e){return i.buildNum(e,1)}},splitLine:{show:!0,lineStyle:{type:"dashed"}}}],xAxis:[{type:"category",boundaryGap:!1,data:r,axisTick:{lineStyle:{color:"#999"}},axisLine:{show:!1},axisLabel:{color:"#333",margin:15}}]};t.refs.chart.setOption(d,!0)}else t.refs.chart.setEmptyOption(n);else t.refs.chart.loading()},t.myChartClick=function(e){if(e){var a=t.getParams(e);e.data[0],e.data[2];-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(a)))}},t.getParams=function(e){var n=t.props.getParams();if(n.id=t.props.id,n.type=t.type,n.projectId=t.projectId,e){var r=e.data[0],i=e.data[3],o=r,s=r;if("MONTH"==n.dateFilter.dateGroupType){var l=a(30381)(r,"YYYY-MM");o=(o=l.format("YYYY-MM-DD"))<n.dateFilter.from?n.dateFilter.from:o,s=(s=l.add(1,"M").add(-1,"d").format("YYYY-MM-DD"))>n.dateFilter.to?n.dateFilter.to:s}n.dateFilter.from=o,n.dateFilter.to=s,n.filterModel.source=[i]}return n},t}return(0,n.Z)(t,e),t.prototype.componentWillMount=function(){this.setState({colors:this.colors.normal})},t}(l.Z));const N={widget:T,tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).type="COUNTER_TIME_STACK_AREA_LINE",t}return(0,n.Z)(t,e),t}(h)};var x=a(29030),D=a(43036);a(26470);const k={widget:function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).getImgFileObj=function(e){try{return a(17431)("./source_"+x.z[e]+".png")}catch(t){return a(23123)}},t.buildChart=function(){var e=t.state.json,a=t.state.colors;if(e)if("string"!==typeof e&&0===e.length&&(e="\u6ca1\u6709\u6570\u636e\u53ef\u7528"),"string"!==typeof e){t.jsonStr===JSON.stringify(e)?t.refs.chart.myChart.resize():t.jsonStr=JSON.stringify(e);for(var n=0,r=e.slice(0,10).map((function(e){return n+=e.doc_count,{name:e.sourceName,value:e.doc_count,key:e.key}})),i=t.refs.chart.myChart,o=i.getWidth(),s=i.getHeight(),l=1,c=s/l,u=c>80,p=u?c-24:c,d=Math.round(o/p);r.length>l*d;)l++,p=(u=(c=s/l)>80)?c-24:c,d=Math.round(o/p),r.length<=(l-1)*d&&(l--,u=(c=s/l)>80);p=o/(1===l?r.length:d);var h=Math.min(p,u?c-24:c),f=Math.max(c-p,0),m=(Math.max(p-c,0),(0,E.Z)(t)),g=r.filter((function(e,t){return t<=d*l})).filter((function(e){return!["53","54","55","56"].includes(e.key)})).map((function(e,r){var i=t.colors.normal[r%t.colors.normal.length];return{type:"pie",radius:[.55*h/2,.6*h/2],center:[h*((r+1)%(d+1)-.5),(h+f)*(Math.ceil((r+2)/(d+1))-.5)],clockwise:!1,tooltip:{formatter:function(t){return t.marker.replace(a[0],i)+" "+e.name+"\uff1a"+e.value}},data:[{value:n-e.value,name:"",sourceName:e.name,source:e.key,label:{normal:{show:!0,position:"center",backgroundColor:{image:x.z[e.name]?t.getImgFileObj(e.name):null},padding:h/8,formatter:function(){return""}}},itemStyle:{normal:{color:a[0]},emphasis:{color:a[0]}}},{name:e.name,sourceName:e.name,source:e.key,value:e.value,label:{normal:{show:u,padding:[6,0,0,0],position:"center",formatter:function(){return"{a|\n}{b|"+m.buildNum(e.value,2)+"}"},rich:{a:{height:h},b:{fontSize:20,color:"#333",fontWeight:"bold"}}}},itemStyle:{normal:{color:i},emphasis:{color:i}}}],startAngle:270,labelLine:{normal:{show:!1},emphasis:{show:!1}},legendHoverLink:!1,hoverAnimation:!1}}));t.refs.chart.setOption({tooltip:{confine:!0},series:g},!0)}else t.refs.chart.setEmptyOption(e);else t.refs.chart.loading()},t.getChartData=function(){var e=t.state.data;t.downloadExcel({titles:["\u8d44\u6e90","\u6570\u91cf"],data:e.map((function(e){return[e.name,e.value]}))})},t.myChartClick=function(e){if(e){var a=e.data.source,n=t.getParams(a);-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(n)))}},t.getParams=function(e){var a=t.props.getParams();return a.id=t.props.id,a.type=t.type,a.projectId=t.projectId,e&&(a.filterModel=a.filterModel||{},a.filterModel.source=[e]),a},t.buildTop=function(){var e=t.state.showTitle,a=t.props.name;return r.createElement("div",{className:"widget-top"},r.createElement("div",{className:"widget-title",style:{height:24,lineHeight:"24px"}},r.createElement("span",{style:{marginRight:8}},e?a:""),r.createElement(D.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:r.createElement("div",null,"\u5982\u679c\u201c\u65e0\u6548\u6570\u636e\u201d\u6a21\u5757\u4e3a\u5f00\u542f\u201c\u663e\u793a\u65e0\u6548\u6570\u636e\u201d\uff0c\u5219\u4e0d\u5305\u542b\u88ab\u6807\u8bb0\u4e3a\u65e0\u6548\u6570\u636e\u7684\u6570\u636e\u3002",r.createElement("br",null),"\u6ce8\uff1a\u7531\u4e8e\u5404\u5e73\u53f0\u5141\u8bb8\u67e5\u770b\u7684\u8bc4\u8bba\u6570\u636e\u4e0d\u4f1a\u8d85\u8fc7\u4e00\u5b9a\u7684\u9875\u6570\uff0c\u4f1a\u5bfc\u81f4\u90e8\u5206\u8f83\u65e9\u7684\u6570\u636e\u65e0\u6cd5\u63d0\u53d6\u3002")},r.createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative"}}))),t.buildTool())},t}return(0,n.Z)(t,e),t.prototype.componentWillMount=function(){this.setState({colors:["#F0F2F5",this.colors.normal[0]],data:[],count:0,showMore:!1})},t}(l.Z),tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).type="COUNTER_PIES_BY_SOURCE",t}return(0,n.Z)(t,e),t}(h)};a(89777);const _={CountNum:y,CountTimeStackAreaLine:N,CountPiesBySource:k,CounterWord:{widget:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).getChartData=function(){if(t.refs.chart&&t.refs.chart.myChart){var e=t.refs.chart.myChart.getOption().series[0].data.map((function(e){return[e.name,e.value]}));t.downloadExcel({titles:["\u8bcd\u8bed","\u6570\u91cf"],data:e})}},t.buildChart=function(){var e=t.state,a=e.colors,n=e.json;if(n)if("string"!==typeof n&&0===n.length&&(n="\u6ca1\u6709\u6570\u636e\u53ef\u7528"),"string"!==typeof n){var r=t.refs.chart.myChart;t.jsonStr===JSON.stringify(n)?r.resize():t.jsonStr=JSON.stringify(n);var i=r.getHeight(),o=r.getWidth(),s=12,l=0,c=Math.min(4,Math.max.apply(Math,n.map((function(e){return e.count}))));n.map((function(e){return l+=e.name.length*s*s*e.count*e.count}));var u=Math.floor(n[0].count*s*Math.sqrt(c*s*(i*o)/l));u=.9*Math.min(i,o/c,u,112);var p={type:"wordCloud",sizeRange:[s,u],rotationRange:[0,0],gridSize:12,textPadding:10,width:"100%",height:"100%",drawOutOfBound:!1,textStyle:{normal:{color:function(e){return a[e.dataIndex%a.length]}}}};p.data=n.map((function(e){return{name:e.name,value:e.count}}));var d=(0,E.Z)(t),h={tooltip:{formatter:function(e){return e.marker+e.name+"\uff1a"+d.buildNum(e.value,2)}},series:[p]};t.refs.chart.setOption(h,!0)}else t.refs.chart.setEmptyOption(n);else t.refs.chart.loading()},t.myChartClick=function(e){if(e){var a=e.name,n=t.getParams(a);-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(n)))}},t.getParams=function(e){var a=t.props.getParams();return a.id=t.props.id,a.type="COUNTER_WORD",a.projectId=t.projectId,e&&(a.filterModel=a.filterModel||{},a.filterModel.content=[{contain:[e]}]),a},t}return(0,n.Z)(t,e),t.prototype.componentWillMount=function(){this.setState({colors:this.colors.normal})},t}(l.Z),tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).type="COUNTER_WORD",t}return(0,n.Z)(t,e),t}(h)}};const A={widget:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).getChartData=function(){var e=t.refs.chart.myChart.getOption(),a=[];e.series.map((function(e){return e.data.map((function(e){return a.push([e.name,e.value])}))})),t.downloadExcel({titles:["\u60c5\u611f","\u6570\u91cf"],data:a})},t.buildChart=function(e){var a=t.state.json;if(a)if("string"!==typeof a){t.jsonStr===JSON.stringify(a)?t.refs.chart.myChart.resize():t.jsonStr=JSON.stringify(a);var n=0,r=0,i=0;a.aggregations.score.buckets.map((function(e){1===e.key?n=e.doc_count:-1===e.key?r=e.doc_count:i=e.doc_count}));var o,s=[{name:"\u6b63\u9762",value:n},{name:"\u4e2d\u6027",value:i},{name:"\u8d1f\u9762",value:r}],l=t.refs.chart.myChart.getHeight(),c=t.refs.chart.myChart.getWidth(),u=[.8*(o=l>c?c/2-10:Math.min(l,c)/2-52),o],p={data:s.map((function(e){return e.name})),top:10},d={color:t.state.colors,legend:p,tooltip:{formatter:function(e){return e.marker+" "+e.name+"\uff1a"+e.value}},series:[{name:"",type:"pie",radius:u,center:["50%","50%"],data:s,label:{normal:{show:!1}},labelLine:{normal:{show:!1}}}]};t.refs.chart.setOption(d,!0)}else t.refs.chart.setEmptyOption(a);else t.refs.chart.loading()},t.myChartClick=function(e){if(e&&"series"===e.componentType){var a=e.name,n=t.getParams(a);t.refs.dataModal.onShow(n,"aspect",a)}},t.getParams=function(e){var a=t.props.getParams();return a.id=t.props.id,a.type=t.type,a.projectId=t.projectId,e&&(a.filterModel.escore=["\u6b63\u9762"===e?1:"\u8d1f\u9762"===e?-1:0]),a},t}return(0,n.Z)(t,e),t.prototype.componentWillMount=function(){this.setState({colors:this.colors.emotion})},t}(l.Z),tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).type="EMOTION_PIE",t}return(0,n.Z)(t,e),t}(h)};const M={widget:function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).myChartClick=function(e){if(e&&"series"===e.componentType){var a=e.name,n=e.seriesName,r=t.getParams(a,n);t.refs.dataModal.onShow(r,"aspect",n+" / "+a)}},t.getParams=function(e,n){var r=t.props.getParams();if(r.id=t.props.id,r.type=t.type,r.projectId=t.projectId,e){var i=e,o=e;if("MONTH"===r.dateFilter.dateGroupType){var s=a(30381)(e,"YYYY-MM");i=(i=s.format("YYYY-MM-DD"))<r.dateFilter.from?r.dateFilter.from:i,o=(o=s.add(1,"M").add(-1,"d").format("YYYY-MM-DD"))>r.dateFilter.to?r.dateFilter.to:o}r.dateFilter.from=i,r.dateFilter.to=o}return n&&(r.filterModel.escore=["\u6b63\u9762"===n?1:"\u8d1f\u9762"===n?-1:0]),r},t.getChartData=function(){if(t.refs.chart&&t.refs.chart.myChart){var e=t.refs.chart.myChart.getOption(),a=[];e.series.map((function(e){return e.data.map((function(t){return a.push([e.name,t[1],t[0]])}))})),t.downloadExcel({titles:["\u60c5\u611f","\u6570\u503c","\u65e5\u671f"],data:a})}},t.buildChart=function(){var e=t.state.json;if(e)if("string"!==typeof e)if(t.jsonStr!==JSON.stringify(e)){t.jsonStr=JSON.stringify(e);var a=e.aggregations.score.buckets||[],n=a.length>0?a[0].aggs.dateAgg.buckets.map((function(e){return e.key_as_string})):[],r=[{name:"\u8d1f\u9762",data:[]},{name:"\u4e2d\u6027",data:[]},{name:"\u6b63\u9762",data:[]}],i={};a.map((function(e){e.aggs.dateAgg.buckets.map((function(t){i[t.key_as_string]=i[t.key_as_string]||{},i[t.key_as_string][e.key]=t.doc_count}))})),n.map((function(e){var t=i[e][1]||0,a=i[e][0]||0,n=i[e][-1]||0;r[2].data.push([e,(t/(t+a+n||1)*100).toFixed(2),"\u6b63\u9762"]),r[1].data.push([e,(a/(t+a+n||1)*100).toFixed(2),"\u4e2d\u6027"]),r[0].data.push([e,(n/(t+a+n||1)*100).toFixed(2),"\u8d1f\u9762"])}));var o=[],s={data:["\u6b63\u9762","\u4e2d\u6027","\u8d1f\u9762"],top:12};r.map((function(e){o.push({type:"bar",stack:"bar",name:e.name,data:e.data,barMaxWidth:40})}));var l={tooltip:{trigger:"axis",confine:!0,formatter:function(e){return e[0].name+e.map((function(e){return"<br/>"+e.marker+e.seriesName+"\uff1a"+e.value[1]+"%"})).reverse().join("")}},series:o,color:t.state.colors,grid:{containLabel:!0,left:30,right:50,bottom:0,top:55},legend:s,yAxis:[{type:"value",axisLine:{show:!0,lineStyle:{color:"#999"}},splitLine:{show:!1},min:0,max:100,axisLabel:{color:"#999",formatter:function(e){return e>100?"":e+"%"}},axisTick:{show:!1}}],xAxis:[{type:"category",data:n}]};t.refs.chart.setOption(l,!0)}else t.refs.chart.myChart.resize();else t.refs.chart.setEmptyOption(e);else t.refs.chart.loading()},t}return(0,n.Z)(t,e),t.prototype.componentWillMount=function(){this.setState({colors:this.colors.emotion.reverse()})},t}(l.Z),tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).type="EMOTION_TIME_STACK_BAR",t}return(0,n.Z)(t,e),t}(h)};var L=a(40086),P=a(49975),I=a(31705),R=a(94184),j=a.n(R),F=a(30381),Z=a.n(F);Z().locale("zh-cn");var V=[{name:"\u6bd4\u4f8b",id:1},{name:"\u6570\u91cf",id:2}],z=function(e){function t(t){var a;return(a=e.call(this,t)||this).myChartClick=function(e){var t=a.state.queryTimeType;if(e&&"series"===e.componentType)if("bar"===e.componentSubType){var n=e.name,r=e.seriesName,i=a.getParams(n,r);-1!==location.pathname.indexOf("overview")?(i.dateFilter.from=i.dateFilter.from.substring(0,10),i.dateFilter.to=i.dateFilter.to.substring(0,10),i.dateFilter.dateGroupType=t,i.dateFilter.quickChoice=i.dateFilter.from.replace("-",".").replace("-",".")+" - "+i.dateFilter.to.replace("-",".").replace("-","."),delete i.headerFilterParamsNew,window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(i)))):a.dataModal.onShow(i,"aspect",r+" / "+n)}else{var o=e.name,s=a.getParams(null,o);-1!==location.pathname.indexOf("overview")?(s.dateFilter.from=s.dateFilter.from.substring(0,10),s.dateFilter.to=s.dateFilter.to.substring(0,10),s.dateFilter.dateGroupType=t,window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(s)))):a.dataModal.onShow(s,"aspect",o)}},a.getParams=function(e,t){var n=a.props.getParams(),r=a.state.queryTimeType;if(n.id=a.props.id,n.projectId=a.projectId,n.dateFilter.dateGroupType=r,e){var i=e,o=e;if("MONTH"===n.dateFilter.dateGroupType){var s=Z()(e);i=s.startOf("month").format("YYYY-MM-DD"),o=s.endOf("month").format("YYYY-MM-DD")}else if("WEEK"===n.dateFilter.dateGroupType){var l=e.split("-"),c=Z()(l[0]).week(l[1]);i=c.startOf("week").format("YYYY-MM-DD"),o=c.endOf("week").format("YYYY-MM-DD")}n.dateFilter.from=i,n.dateFilter.to=o}if(t){n.filterModel.escore=["\u6b63\u9762"===t?"1":"\u8d1f\u9762"===t?"-1":"0"];var u=u="\u6b63\u9762"===t?"positive":"\u8d1f\u9762"===t?"negative":"neutral";n.headerFilterParamsNew=[{id:"DEFAULT",values:[{id:"CATEGORY_TYPE",values:["COMMENT"]},{id:"MESSAGE_TYPE",values:["COMMENT_APPEND","MESSAGE_COMMENT"]},{id:"EFFECTIVENESS_TYPE",values:["useful"]},{id:"EMOTION_TYPE",values:[u]}]}]}return n},a.getChartData=function(){var e=a.state,t=e.fxValue,n=e.dateDimensionReady;if(a.chart&&n&&a.chart.myChart){var r=a.chart.myChart.getOption(),i={},o=[],s="\u60c5\u611f"+t.name+"\u6570\u636e";for(var l in r.series.filter((function(e){return""!==e.name})).map((function(e){return e.data.forEach((function(e){i[e[0]]=i[e[0]]||{},i[e[0]][e[2]]=1===a.state.fxValue.id?e[1]+"%":e[1]}))})),i)o.push([l,i[l]["\u6b63\u9762"],i[l]["\u4e2d\u6027"],i[l]["\u8d1f\u9762"]]);a.downloadExcel({titles:["\u65e5\u671f","\u6b63\u9762","\u4e2d\u6027","\u8d1f\u9762"],data:o,name:s})}},a.buildChart=function(){var e=a.state.json,t=a.state.fxValue.id;if(e)if("string"!==typeof e&&0===e.length&&(e="\u6ca1\u6709\u6570\u636e\u53ef\u7528"),"string"!==typeof e){a.jsonStr===JSON.stringify(e)?a.chart.myChart.resize():a.jsonStr=JSON.stringify(e);var n=e||[],r=n.length>0?n[0].dataList.map((function(e){return e.time})):[],i=[{name:"\u8d1f\u9762",data:[]},{name:"\u4e2d\u6027",data:[]},{name:"\u6b63\u9762",data:[]}],o=[{name:"\u8d1f\u9762",value:0},{name:"\u4e2d\u6027",value:0},{name:"\u6b63\u9762",value:0}],s={};n.forEach((function(e){e.dataList.forEach((function(t){s[t.time]=s[t.time]||{},s[t.time][e.key]=t.total})),"-1"===String(e.key)&&(o[0].value=e.total),"0"===String(e.key)&&(o[1].value=e.total),"1"===String(e.key)&&(o[2].value=e.total)})),r.forEach((function(e){var a=s[e][1]||0,n=s[e][0]||0,r=s[e][-1]||0;i[2].data.push([e,1===t?(a/(a+n+r||1)*100).toFixed(2):a,"\u6b63\u9762"]),i[1].data.push([e,1===t?(n/(a+n+r||1)*100).toFixed(2):n,"\u4e2d\u6027"]),i[0].data.push([e,1===t?(r/(a+n+r||1)*100).toFixed(2):r,"\u8d1f\u9762"])}));var l=[],c=["50%","55%"],u=["68%","80%"],p={data:["\u6b63\u9762","\u4e2d\u6027","\u8d1f\u9762"],type:"scroll"},d=a.chart.myChart.getWidth(),h=a.chart.myChart.getHeight(),f=d<400?.3*d:120;c[0]=h/2,u[0]=.4*h/2,u[1]=.65*h/2,p.left=Number(h)+20,p.orient="vertical",p.top=40,p.width=f;var m=o[2].value,g=o[1].value,v=o[0].value,y=p.width+p.left;p.formatter=function(e){var a="\u6b63\u9762"===e?m:"\u8d1f\u9762"===e?v:g;return"{a|"+e+"}{b|"+(1===t?(a/(m+v+g||1)*100).toFixed(2)+"%":a)+"}"};var E=f<100?12:20;p.textStyle={padding:[h/10-E/2,0],rich:{a:{width:.4*f},b:{width:.5*f,fontSize:E,align:"right"}}},i.forEach((function(e){l.push({type:"bar",stack:"bar",name:e.name,data:e.data,legendHoverLink:!1,barMaxWidth:40})})),l.push({name:"",type:"pie",radius:u,center:c,data:o,label:{normal:{show:!1}},labelLine:!1,hoverAnimation:!1});var C={axisPointer:{type:"none"},formatter:function(e){if(e instanceof Array){var a=e;return a[0].name+a.map((function(e){return"<br/>"+e.marker+e.seriesName+"\uff1a"+e.value[1]+(1===t?"%":"")})).reverse().join("")}return e.marker+" "+e.name+"\uff1a"+(1===t?(m+g+v===0?"0.00":(e.value/(m+g+v)*100).toFixed(2))+"%":e.value)}},b={tooltip:C,title:[{text:"\u901a\u7528\u60c5\u611f",textStyle:{fontSize:14}},{text:"\u901a\u7528\u60c5\u611f\u8d8b\u52bf",textStyle:{fontSize:14},x:y+70}],series:l,color:a.state.colors,legend:p,grid:{tooltip:{trigger:"axis"},containLabel:!0,left:h+f+100,right:40,bottom:10,top:40},yAxis:[{type:"value",axisLine:{show:!0,lineStyle:{color:"#999"}},splitLine:{show:!1},min:0,max:1===t?100:null,axisLabel:{color:"#999",formatter:function(e){return 1===t?e>100?"":e+"%":e}},axisTick:{show:!1}}],xAxis:[{type:"category",data:r,axisLine:{show:!0,lineStyle:{color:"#999"}},axisLabel:{color:"#999"},axisTick:{show:!1}}]};a.chart.setOption(b,!0)}else a.chart.setEmptyOption(e);else a.chart.loading()},a.switchDateDimension=function(e){a.setState({queryTimeType:e,dateDimensionReady:!0},(function(){a.refreshChart()}))},a.switchFx=function(e){a.setState({fxValue:e,loading:!0},(function(){return a.setState({loading:!1})}))},a.buildTop=function(){var e=a.state,t=e.queryTimeType,n=e.fxValue;return r.createElement("div",{className:"widget-top widget-top-extra",style:{width:"100%",zIndex:1}},r.createElement(D.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:r.createElement("div",null,r.createElement("span",{style:{display:"block"}},"\u6b63\u5411\uff1a\u4ec5\u8868\u8fbe\u4e86\u6b63\u5411\u60c5\u7eea\u7684\u8bc4\u8bba\u3002"),r.createElement("span",{style:{display:"block"}},"\u8d1f\u5411\uff1a\u8bc4\u8bba\u4e2d\u53ea\u8981\u5305\u542b\u8d1f\u5411\u60c5\u7eea\uff0c\u4fbf\u88ab\u5224\u5b9a\u4e3a\u8d1f\u5411\u8bc4\u8bba\u3002"),r.createElement("span",{style:{display:"block"}},"\u4e2d\u6027\uff1a\u4e0d\u5305\u542b\u6b63\u5411\u6216\u8d1f\u5411\u60c5\u611f\u7684\u8bc4\u8bba\u3002"))},r.createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative",left:96}})),r.createElement(I.Z,{style:{float:"right",marginRight:"16px"},onDownChartClick:function(){return a.downloadChart("\u60c5\u611f"+n.name+"\u56fe")},onDownExcelClick:function(){return a.getChartData()}}),r.createElement(P.Z,{uniqueId:"overview-emotion-saved-date-dimension",defaultValue:t,onChange:a.switchDateDimension,style:{float:"right"}}),r.createElement(L.Z,{style:{float:"right"},list:V,onChange:a.switchFx,value:n,placeholder:r.createElement("i",{className:"icon-cem_fx",style:{fontSize:"18px",fontWeight:"bold"}}),partingLine:!0}))},a.buildBody=function(){return r.createElement("div",{className:"widget-body",style:{minHeight:"216px"}},r.createElement(v.Z,{ref:function(e){return a.chart=e},className:"widget-chart",myChartClick:a.myChartClick}))},a.state={queryTimeType:"DAY",fxValue:V[0],dateDimensionReady:!1},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentWillMount=function(){this.setState({colors:this.colors.emotion.reverse()})},a.render=function(){return r.createElement("div",{ref:"widget",className:j()((this.isCanSetting?"widget-container with-aspect-bar":"widget-container")+" emotion-pie-time-bar-extra")},this.buildTop(),this.buildBody())},t}(l.Z);const B={EmotionPie:A,EmotionTimeStackBar:M,EmotionPieAndTimeStackBar:{widget:z,tool:null}};var W=a(85151),Y=function(e){function t(){return e.apply(this,arguments)||this}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.labelOff,n=t.labelOn,i=t.type,o=t.disabled;return r.createElement("div",{className:"label-button"},r.createElement("span",{className:(i?"active":"")+(o?"disabled":""),onClick:function(){return o||e.props.onChange(!0)}},n),r.createElement("span",{className:(i?"":"active")+(o?"disabled":""),onClick:function(){return o||e.props.onChange(!1)}},a))},t}(r.Component),J=a(12234),H=function(e){function t(){return e.apply(this,arguments)||this}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.editTemp,n=t.handleRemove,i=t.id,o=t.isPercent,s=t.emotion,l=t.showLabel,c=t.showLabelPosition,u=t.sort,p=t.decimal,d=t.avg,h=t.singleEmotion,f=this.props,m=f.changePercent,g=f.changeEmotion,v=f.changeSingleEmotion,y=f.changeLabel,E=f.changeLabelPosition,C=f.changeSort,b=f.changeDecimal,S=f.changeAvg;return r.createElement("div",{className:"aspect-config"},r.createElement("div",{className:"aspect-top"},r.createElement("div",{className:"setting"},r.createElement("div",{className:"chart-opt-more"},r.createElement(J.l,{name:"more"}),r.createElement("ul",{className:"widget-overlay"},r.createElement("li",{onClick:function(){return e.props.downloadChart()}},"\u5bfc\u51fa\u56fe\u7247"),r.createElement("li",{onClick:function(){return e.props.getChartData()}},"\u5bfc\u51fa\u6570\u636e"),a&&r.createElement("li",{onClick:function(){return a(i)}},"\u7f16\u8f91"),n&&r.createElement("li",{onClick:function(){return n(i)}},"\u5220\u9664"))),r.createElement("div",{className:"chart-opt-menu"},r.createElement(J.l,{name:"top-setting"}),r.createElement("ul",{className:"widget-overlay"},m&&r.createElement("li",null,r.createElement("label",null,"\u5c55\u793a\u65b9\u5f0f"),r.createElement(Y,{type:o,labelOn:"\u767e\u5206\u6bd4",labelOff:"\u6570\u503c",onChange:m})),g&&r.createElement("li",{className:"emotion-label"},r.createElement("label",null,"\u6b63\u8d1f\u9762"),r.createElement(W.Jg,{value:0,checked:s[0],onChange:function(e){var t=e.target.checked;s[0]=t,s[1]=!t&&!s[1]||s[1],g(s)}},"\u6b63\u9762"),r.createElement(W.Jg,{value:1,checked:s[1],onChange:function(e){var t=e.target.checked;s[1]=t,s[0]=!t&&!s[0]||s[0],g(s)}},"\u8d1f\u9762")),S&&r.createElement("li",null,r.createElement("label",null,"\u5e73\u5747\u503c"),r.createElement(Y,{type:d,labelOn:"\u5c55\u793a",labelOff:"\u4e0d\u5c55\u793a",onChange:S})),y&&r.createElement("li",null,r.createElement("label",null,"\u6807\u7b7e"),r.createElement(Y,{type:l,labelOn:"\u5c55\u793a",labelOff:"\u4e0d\u5c55\u793a",onChange:y})),E&&l&&r.createElement("li",null,r.createElement("label",null,"\u6807\u7b7e\u4f4d\u7f6e"),r.createElement(Y,{type:c,labelOn:"\u5185\u4fa7",labelOff:"\u5916\u4fa7",onChange:E})),C&&r.createElement("li",null,r.createElement("label",null,"\u6392\u5e8f"),r.createElement(Y,{type:u,labelOn:"\u5347\u5e8f",labelOff:"\u964d\u5e8f",onChange:C})),C&&v&&s[0]&&s[1]&&r.createElement("li",null,r.createElement("label",null,"\u6392\u5e8f"),r.createElement(Y,{type:h,labelOn:"\u6b63\u9762",labelOff:"\u8d1f\u9762",onChange:v})),!C&&v&&r.createElement("li",null,r.createElement("label",null,h?"\u597d\u8bc4\u7387":"\u5dee\u8bc4\u7387"),r.createElement(Y,{type:h,labelOn:"\u597d\u8bc4\u7387",labelOff:"\u5dee\u8bc4\u7387",onChange:v})),b&&r.createElement("li",null,r.createElement("label",null,"\u663e\u793a\u5c0f\u6570"),r.createElement(Y,{type:p,labelOn:"\u663e\u793a",labelOff:"\u4e0d\u663e\u793a",onChange:b})))))))},t}(r.Component),U=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).isCanSetting=!0,t.getChartData=function(){if(t.refs.chart&&t.refs.chart.myChart){var e=t.refs.chart.myChart.getOption().series,a=[];e.map((function(e){return e.data.map((function(e){e[1]=e[1]?e[1].toFixed(3)+"%":"-",a.push(e)}))})),t.downloadExcel({titles:["\u65e5\u671f","\u6b63\u9762\u5360\u6bd4","\u7c7b\u522b","\u6b63\u9762\u6570","\u8d1f\u9762\u6570"],data:a})}},t.buildTop=function(){var e=t.props,a=e.editTemp,n=e.handleRemove,i=e.id,o=e.model,s=e.index,l=(e.store,t.state),u={editTemp:a,handleRemove:n,id:i,model:o,index:s,singleEmotion:l.singleEmotion,avg:l.avg,decimal:l.decimal},p={changeSingleEmotion:function(e){t.setState({singleEmotion:e})},changeAvg:function(e){t.setState({avg:e})},changeDecimal:function(e){t.setState({decimal:e})},refreshChart:t.refreshChart,getChartData:t.getChartData,downloadChart:function(){t.downloadChart("\u4ea7\u54c1\u8d8b\u52bf")}};return r.createElement("div",{className:"widget-top"},r.createElement(H,(0,c.Z)({key:t.time,ref:"selectBar"},u,p)))},t.myChartClick=function(e){var a=t.props.name;if(e&&"series"===e.componentType){var n=e.data[0],r=[e.seriesId],i=t.getParams(n,r);i.leftName=a,i.aspectTotal=e.data[3]+e.data[4],t.refs.dataModal.onShow(i,"aspect",e.seriesName+" / "+n)}},t.getParams=function(e,n){var r=t.props.getParams();if(!r)return null;if(r.id=t.props.id,r.type=t.type,r.projectId=t.projectId,r.filters=r.filters||[],n&&(r.filterModel=r.filterModel||{},r.filterModel.analysis=r.filterModel.analysis||{},r.filterModel.analysis.values=n),e){var i=e,o=e;if("MONTH"===r.dateFilter.dateGroupType){var s=a(30381)(e,"YYYY-MM");i=(i=s.format("YYYY-MM-DD"))<r.dateFilter.from?r.dateFilter.from:i,o=(o=s.add(1,"M").add(-1,"d").format("YYYY-MM-DD"))>r.dateFilter.to?r.dateFilter.to:o}r.dateFilter.from=i,r.dateFilter.to=o}return r},t.buildChart=function(){var e=t.state,a=e.json,n=e.singleEmotion,r=e.avg,i=e.decimal;if(a)if("string"!==typeof a){t.jsonStr===JSON.stringify(a)?t.refs.chart.myChart.resize():t.jsonStr=JSON.stringify(a);for(var o={text:a.dataSummary&&Object.keys(a.dataSummary).map((function(e){var t=a.dataSummary[e];return"{a|}{b|   "+e+"}    {st|\u8bc4\u8bba\uff1a}{sv|"+t.total+"}{st| - \u6b63\u9762\uff1a}{sv|"+t.positive+"}{st|\uff0c\u8d1f\u9762\uff1a}{sv|"+t.negative+"}"})).join(" "),textStyle:{rich:{a:{borderColor:"#000",borderWidth:1,height:9},b:{fontSize:14,fontWeight:"bold",color:"#000"},st:{color:"#999"},sv:{fontWeight:500,color:"#000"}}},left:16,top:16},s=[],l=a.dateList,c=a.data.map((function(e){return{id:e.id,connectNulls:!0,name:e.title,data:e.emotions.map((function(t){var a=t.docCount?(n?t.positive:t.negative)/t.docCount*100:null;return(a||0===a)&&s.push(a),[t.strDate,a,e.title,t.positive,t.negative]})),markLine:r?{data:[{type:"average",name:"\u5e73\u5747\u5360\u6bd4",label:{formatter:function(e){return e.value?e.value.toFixed(i?2:0)+"%":""}}}]}:null,type:"line",smooth:.4,smoothMonotone:"none"}})),u=c.map((function(e){return e.name})),p=s.length?Math.max.apply(Math,s):100,d=s.length?Math.min.apply(Math,s):0,h=p-d>50?20:10,f=100,m=0;p+2*h<f;)f-=h;for(;d-2*h>m;)m+=h;var g={title:o,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross",label:{formatter:function(e){return"number"===typeof e.value?e.value.toFixed(i?2:0)+"%":e.value}}},formatter:function(e){return e&&e.length?e[0].axisValueLabel+e.map((function(e){var t=e.value&&(e.value[1]||0===e.value[1])?Number(e.value[1]).toFixed(i?2:0)+"%":"\uff08\u65e0\uff09";return"<br/>"+e.marker+e.seriesName+"\uff1a"+t+" \uff08\u6b63\u9762\uff1a"+e.value[3]+"\uff0c\u8d1f\u9762\uff1a"+e.value[4]+"\uff09"})).join(""):null}},legend:{data:u,type:"scroll",top:44},series:c,color:t.state.colors,grid:{containLabel:!0,left:50,right:100,bottom:20,top:100},yAxis:[{type:"value",min:m,max:f,interval:h,axisLine:{show:!1},splitLine:{show:!1},scale:!0,axisLabel:{showMaxLabel:f<=100}}],xAxis:[{type:"category",boundaryGap:!1,data:l}]};t.refs.chart.setOption(g,!0)}else t.refs.chart.setEmptyOption(a);else t.refs.chart&&t.refs.chart.loading()},t}return(0,n.Z)(t,e),t.prototype.componentWillMount=function(){this.setState({colors:["#61a1f8","#f5dc80","#75c9cb","#e26f7e","#7bc77c","#a677fe"],singleEmotion:!0,avg:!1,decimal:!0})},t}(l.Z);const G={widget:U,tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).width=12,t.height=8,t.isSingle=!1,t.type="EMOTION_ASPECT_TIME_LINE",t}return(0,n.Z)(t,e),t}(h)};var q=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=e.call.apply(e,[this].concat(n))||this).isCanSetting=!0,t.getChartData=function(){var e=t.state,a=e.json,n=e.decimal;if(a){var r=[];a.map((function(e,a){var i=t.refs["chart-"+a];if(i&&i.myChart){var o=t.refs["chart-"+a].myChart.getOption().series,s=o[0].data,l=o[1].data;s.map((function(e,t){var a=l[t];r.push([e.type,e.name,a.count,a.percent.toFixed(n?2:0)+"%",e.count,e.percent.toFixed(n?2:0)+"%"])}))}})),t.downloadExcel({titles:["\u5206\u6790\u5bf9\u8c61","\u5206\u6790\u6307\u6807","\u6b63\u9762\u6570\u91cf","\u6b63\u9762\u5360\u6bd4","\u8d1f\u9762\u6570\u91cf","\u8d1f\u9762\u5360\u6bd4"],data:r})}},t.downloadChart=function(){t.state.json.map((function(e,a){var n=t.refs["chart-"+a].myChart.getDataURL({pixelRatio:2,backgroundColor:"#fff"});t.downloadFile(e.title,n)}))},t.buildTop=function(){var e=t.props,a=e.editTemp,n=e.handleRemove,i=e.id,o=e.model,s=e.index,l=t.state,u={editTemp:a,handleRemove:n,id:i,model:o,index:s,isPercent:l.isPercent,emotion:l.emotion,showLabel:l.showLabel,showLabelPosition:l.showLabelPosition,sort:l.sort,decimal:l.decimal,singleEmotion:l.singleEmotion},p={changePercent:function(e){t.setState({isPercent:e})},changeEmotion:function(e){var a=t.state.singleEmotion;e[0]&&!e[1]?a=!0:!e[0]&&e[1]&&(a=!1),t.setState({emotion:e,singleEmotion:a})},changeSingleEmotion:function(e){t.setState({singleEmotion:e})},changeLabel:function(e){t.setState({showLabel:e})},changeLabelPosition:function(e){t.setState({showLabelPosition:e})},changeSort:function(e){t.setState({sort:e})},changeDecimal:function(e){t.setState({decimal:e})},refreshChart:t.refreshChart,getChartData:t.getChartData,downloadChart:t.downloadChart};return r.createElement("div",{className:"widget-top"},r.createElement(H,(0,c.Z)({key:t.time,ref:"selectBar"},u,p)))},t.getParams=function(e,a,n){var r=t.props.getParams();if(!r)return null;if(r.id=t.props.id,r.type=t.type,r.projectId=t.projectId,t.props.getAspect){var i=t.props.getAspect().aspectType;e&&(r.filterModel.aspect[i?"aspect1":"aspect2"]=[e])}return r.filterModel=r.filterModel||{},a&&(r.filterModel.aspect=r.filterModel.aspect||{},r.filterModel.aspect.emotion=["\u6b63\u9762"===a?"positive":"negative"]),n&&(r.filterModel.analysis=r.filterModel.analysis||{},r.filterModel.analysis.values=[n]),r},t.myChartClick=function(e){var a=t.props.name;if(e)switch(e.componentType){case"series":var n=e.name,r=e.seriesName,i=e.data,o=i.id,s=i.count,l=i.type,c=(i.sourceName,t.getParams(n,r,o));c.leftName=a,c.aspect=e.data.name,c.aspectTotal=s,c.seriesName=r,c.analyseName=l,window.open("/tab/detail?"+encodeURIComponent(JSON.stringify(c)));break;case"yAxis":var u=e.value,p=t.props.getAspect(),d=p.aspectList;if(p.aspectType){var h=[];d.filter((function(e){return e.name===u}))[0].contain.map((function(e){return h.push(e)})),t.props.setAspectType(!1,h)}}},t.resize=function(){var e=t.state.json;e&&e.map((function(e,a){t.refs["chart-"+a].myChart.resize()}))},t.buildBody=function(){var e=t.state.json;if(!e||"string"===typeof e)return r.createElement("div",{className:"widget-body"},r.createElement(v.Z,{ref:"chart-0",className:"widget-chart"}));var a=e.map((function(e){return e.data&&e.data.length})),n=Math.max.apply(Math,a),i=a.length>1?"50%":"100%",o=window.innerHeight-200,s=30*n+200,l=0;return l=a.length>2?s<o/2?"50%":s+"px":s<o?"100%":s+"px",r.createElement("div",{className:"widget-body"},a.map((function(e,a){var n="chart-"+a,o=+new Date+a,s="d"+(t.time||+new Date)+a;return r.createElement("div",{key:s,style:{width:i,height:l,float:"left"}},r.createElement(v.Z,{myChartClick:t.myChartClick,ref:n,key:o}))})))},t}(0,n.Z)(t,e);var a=t.prototype;return a.componentWillMount=function(){this.setState({color:this.colors.aspect.reverse(),isPercent:!0,emotion:[!0,!0],singleEmotion:!0,showLabel:!1,showLabelPosition:!0,sort:!1,decimal:!0})},a.buildChart=function(){var e=this,t=this.state.json;if(t)if("string"!==typeof t){this.jsonStr===JSON.stringify(t)?this.refs["chart-0"].myChart.resize():this.jsonStr=JSON.stringify(t);var a=this.state,n=a.color,r=a.isPercent,i=a.emotion,o=a.showLabel,s=a.showLabelPosition,l=a.sort,c=a.decimal,u=a.singleEmotion,p=[];t.length>0&&t.forEach((function(e){var t={};if(e.data&&e.data.length>0){var a=0;e.data.map((function(e){a+=e.doc_count,t[e.key]=e})),e.sum=a,p.push(t)}}));var d=p.length>0?Object.keys(p[0]).sort((function(e,a){var n=u?p[0][e].positive:p[0][e].negative,i=u?p[0][a].positive:p[0][a].negative;return n/=r?t[0].sum:1,i/=r?t[0].sum:1,(l?1:-1)*(n-i)})):[],h=p.map((function(e,a){var n=[],r=[],i=0;Object.keys(e).map((function(t){i+=Number(e[t].doc_count)}));var o=0,s=0;return d.map((function(l){var c=e[l],u=c.negative,p=c.positive;o+=u,s+=p,n.push({name:l,id:t[a].id,count:u,percent:u/i*100,type:t[a].title}),r.push({name:l,id:t[a].id,count:p,percent:p/i*100,type:t[a].title})})),{id:t[a].id,type:t[a].title,total:i,positive:s,negative:o,negativeList:n,positiveList:r}})),f=d.map((function(e){return e})),m=r&&c,g={normal:{show:o,formatter:function(e){return Math.abs(e.value).toFixed(m?2:0)+(r?"%":"")}}},v={negativeCount:0,positiveCount:0,negativePercent:0,positivePercent:0};h.map((function(e){v.negativeCount=Math.max.apply(Math,[v.negativeCount].concat(e.negativeList.map((function(e){return e.count||0})))),v.positiveCount=Math.max.apply(Math,[v.positiveCount].concat(e.positiveList.map((function(e){return e.count||0})))),v.negativePercent=Math.max.apply(Math,[v.negativePercent].concat(e.negativeList.map((function(e){return e.percent||0})))),v.positivePercent=Math.max.apply(Math,[v.positivePercent].concat(e.positiveList.map((function(e){return e.percent||0}))))}));var y=this.refs["chart-0"].myChart.getWidth(),E=0,C=0;o&&(r?(E+=m?8:5,i[0]&&i[1]&&(C+=m?8:5)):(E+=(""+(i[0]?v.positiveCount:v.negativeCount)).length,i[0]&&i[1]&&(C+=(""+v.negativeCount).length)));var b=y-40-6*(2*Math.max.apply(Math,d.map((function(e){return e.length})))),S=r?i[0]?v.positivePercent:v.negativePercent:i[0]?v.positiveCount:v.negativeCount,O=i[0]&&i[1]?r?v.negativePercent:v.negativeCount:0,w=(S+O)/(b-(E+C)*(s?0:6)),T=S+(o&&!s?E:0)*w,N=O+(o&&!s?C:0)*w,x=T+N,D=100;if(r)D=S+O<100?10:20;else{for(;x/D>10;)x/(D*=2)>10&&(D*=2.5),x/D>10&&(D*=2);for(;x/D<6;)x/(D/=2)<6&&(D/=2.5),x/D<6&&(D/=2)}var k=Math.ceil(T/D)*D,_=Math.ceil(N/D)*D;h.map((function(t,a){var o=e.refs["chart-"+a].myChart,l=o.getHeight()/10,c=Math.min((o.getHeight()-100)/d.length*.8,l);h[a].negativeList.forEach((function(e){e.value=(r?e.percent:e.count)*(i[0]?-1:1);var t=Math.abs(e.value)/w<6*((i[0]?C:E)+1),a=null;a=i[0]?s?t?"insideRight":"insideLeft":"left":s?t?"insideLeft":"insideRight":"right",e.label={normal:{position:a}}})),h[a].positiveList.forEach((function(e){e.value=r?e.percent:e.count;var t=e.value/w<6*((i[0]?C:E)+1);e.label={normal:{position:s?t?"insideLeft":"insideRight":"right"}}}));var u=[],p=[],v=[],y=h[a].negativeList.map((function(e){return e})),b=h[a].positiveList.map((function(e){return e}));i[0]?(p.push("\u6b63\u9762"),i[1]&&(p.push("\u8d1f\u9762"),v.push(n[0]),u.push({label:g,barGap:"-100%",name:"\u8d1f\u9762",type:"bar",data:y,barWidth:c})),v.push(n[1]),u.push({label:g,name:"\u6b63\u9762",type:"bar",data:b,barWidth:c})):(p.push("\u8d1f\u9762"),v.push(n[0]),u.push({label:g,name:"\u8d1f\u9762",type:"bar",data:y,barWidth:c}));var S={title:{text:"{a|}{b|   "+t.type+"}    {st|\u8bc4\u8bba\uff1a}{sv|"+t.total+"}{st| - \u6b63\u9762\uff1a}{sv|"+t.positive+"}{st|\uff0c\u8d1f\u9762\uff1a}{sv|"+t.negative+"}",textStyle:{rich:{a:{borderColor:"#000",borderWidth:1,height:9},b:{fontSize:14,fontWeight:"bold",color:"#000"},st:{color:"#999"},sv:{fontWeight:500,color:"#000"}}},left:16,top:16},tooltip:{formatter:function(e){var t=e.data;return r?e.name+"</br>"+e.marker+e.seriesName+" : "+t.percent.toFixed(m?2:0)+"% ("+t.count+")":e.name+"</br>"+e.marker+e.seriesName+" : "+t.count+" ("+t.percent.toFixed(m?2:0)+"%)"}},grid:{containLabel:!0,left:20,right:20,bottom:20,top:94},color:v,legend:{data:p,top:54,left:"center",itemWidth:10,itemHeight:10},xAxis:[{type:"value",min:-_,max:k,interval:D,axisLabel:{formatter:function(e){return Math.abs(e)+(r?"%":"")}}}],yAxis:[{type:"category",axisLine:{lineStyle:{width:3}},zlevel:2,inverse:!0,data:f,triggerEvent:!0}],series:u,animation:!1};e.refs["chart-"+a].setOption(S,!0),e.refs["chart-"+a].group("levelBar")}))}else this.refs["chart-0"].setEmptyOption(t);else this.refs["chart-0"]&&this.refs["chart-0"].loading()},t}(l.Z);const K={COUNTER_NUM:_.CountNum,COUNTER_PIES_BY_SOURCE:_.CountPiesBySource,COUNTER_TIME_STACK_AREA_LINE:_.CountTimeStackAreaLine,COUNTER_WORD:_.CounterWord,CONTENT_TABLE:_.ContentTable,EMOTION_ASPECT_LEVEL_BAR:{widget:q,tool:function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).width=12,t.height=8,t.isSingle=!1,t.type="EMOTION_ASPECT_LEVEL_BAR",t}return(0,n.Z)(t,e),t}(h)},EMOTION_ASPECT_TIME_LINE:G,EMOTION_PIE:B.EmotionPie,EMOTION_TIME_STACK_BAR:B.EmotionTimeStackBar,EMOTION_PIE_AND_TIME_STACK_BAR:B.EmotionPieAndTimeStackBar};var Q=a(19586),X=a(20899),$=a(82817),ee=a(35239),te=a(94644),ae=[{name:"\u6bd4\u4f8b",id:1},{name:"\u6570\u91cf",id:2}],ne=function(e){function t(t){var a;return(a=e.call(this,t)||this).resizeFontSize=function(){var e=.03*a.flexWrapper.offsetWidth;document.getElementById("flexSpan").style.fontSize=e+"px";var t=document.documentElement.clientWidth;a.divider.style.margin=t<1593?"0 4px":"0 16px";for(var n=document.getElementsByClassName("category"),r=0;r<n.length;r++)n[r].style.marginRight="4px"},a.resize=function(){a.flexWrapper&&(a.resizeFontSize(),a.bar.resize())},a.switchDateDimension=function(e){a.setState({queryTimeType:e,dateDimensionReady:!0},(function(){a.fetchData()}))},a.switchFx=function(e){a.setState({fxValue:e,loading:!0},(function(){return a.setState({loading:!1})}))},a._handleChartDownload=function(e){(0,te._v)(a.bar.chart,e)},a._handleExcelDownload=function(e){var t=a.state.fxValue.id,n=a.state.data.map((function(e){var a=1===t?e.percentageOfPositive+"%":e.positive,n=1===t?e.percentageOfNegative+"%":e.negative;return[e.time,a,n]}));n.splice(0,0,["\u65e5\u671f","\u6b63\u9762","\u8d1f\u9762"]),(0,te.aT)([n],e)},a.state={queryParams:null,queryTimeType:{},data:[],sum:0,positive:0,negative:0,projectId:"",model:"",aspect:{aspect1:[],aspect2:[]},fxValue:ae[0],loading:!0,dateDimensionReady:!1},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidUpdate=function(e,t){this.flexWrapper&&this.resizeFontSize()},a.formatNum=function(e){return 0<=e&&e<1e3?e:e<1e4?(e/1e3).toFixed(2)+"\u5343":(e/1e4).toFixed(2)+"\u4e07"},a.fetchAspects=function(e,t){var a=this;e&&t&&s.h.post("filter/find",{filterTypes:["ASPECT"],projectId:e,type:t}).then((function(n){var r=n.data.result;if(r.aspect&&r.aspect.length>0){var i=JSON.parse(r.aspect);ee.t.set(ee.V.aspect,r.aspect[0]);var o=a.state.aspect,s=o.aspect1,l=o.aspect2;Object.keys(i).map((function(e){return s.push(e)})),r.treeAspect&&r.treeAspect[0]&&r.treeAspect[0].treeId&&(a.treeId=r.treeAspect[0].treeId),a.setState({model:t,projectId:e,aspect:{aspect1:s,aspect2:l}},(function(){return a.fetchData()}))}}))},a.fetchData=function(){var e=this,t=this.state,a=t.queryParams,n=t.aspect,r=t.queryTimeType,i=t.dateDimensionReady;a&&a.filterModel&&a.dateFilter&&n.aspect1.length>0&&i&&(a.filterModel.aspect=n,a.filterModel.treeId=this.treeId,a.dateFilter.dateGroupType=r,this.setState({loading:!0},(function(){return s.h.post("/widget/data/find/ASPECT_DATE_COUNT_BAR",(0,c.Z)({},a)).then((function(t){var a=t.data.result,n=e.caculatePercentage(a.aspectCounts),r=a.aspectTotal||0,i=a.positiveTotal||0,o=a.negativeTotal||0;e.setState({data:n,sum:r,positive:i,negative:o,loading:!1})}))})))},a.refreshChart=function(){var e=this,t=ee.t.get(ee.V.curProject).id;this.setState({queryParams:(0,c.Z)({},this.props.getParams(),{projectId:t})},(function(){if(e.state.aspect.aspect1.length>0)e.fetchData();else{var t=e.props,a=t.projectId,n=t.model;e.fetchAspects(a,n)}}))},a.caculatePercentage=function(e){for(var t=e.length-1;t>=0;t--){var a=e[t].total;e[t].percentageOfNegative=a>0?(100*e[t].negative/e[t].total).toFixed(2):0,e[t].percentageOfPositive=a>0?(100*e[t].positive/e[t].total).toFixed(2):0}return e},a.getChartOption=function(){var e=this.state,t=e.data,a=e.fxValue,n=["\u6b63\u9762","\u8d1f\u9762"];return{title:{text:"\u58f0\u91cf\u8d8b\u52bf",textStyle:{fontSize:14}},barMaxWidth:40,barGap:"30%",legend:(0,c.Z)({},$.I.legend,{top:30,data:n.map((function(e){return{name:""+e,icon:"rect"}}))}),grid:(0,c.Z)({},$.I.grid,{top:36,left:40}),xAxis:(0,c.Z)({},$.I.xAxis,{data:t.map((function(e){return e.time}))}),yAxis:(0,c.Z)({},$.I.yAxis,{max:1===a.id?100:null}),tooltip:(0,c.Z)({},$.I.tooltip,{formatter:function(e){return e[0].name+e.map((function(e){return"<br/>"+e.marker+e.seriesName+"\uff1a"+e.value+(1===a.id?"%":"")})).reverse().join("")}}),series:n.map((function(e){return{name:e,data:t.map((function(t){return 1===a.id?"\u6b63\u9762"===e?t.percentageOfPositive:t.percentageOfNegative:"\u6b63\u9762"===e?t.positive:t.negative})),stack:"\u8bc4\u4ef7",cursor:"default",type:"bar",itemStyle:{normal:{color:"\u6b63\u9762"===e?"#15B374":"#D96969"}}}})).reverse()}},a.render=function(){var e=this,t=this.state,a=t.sum,n=t.positive,i=t.negative,o=t.queryTimeType,s=t.queryParams,l=t.fxValue,c=t.loading,p=location.pathname.split("/")[1]+"-saved-date-dimension";return r.createElement("div",{className:"overviewChartWrapper"},r.createElement(u.Loading,{loading:c,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},r.createElement("div",null,r.createElement("div",{className:"title"},s&&s.analyseName),r.createElement("div",{className:"detailChart-top",ref:function(t){return e.flexWrapper=t}},r.createElement("div",null,r.createElement("div",null,r.createElement("span",null,"\u58f0\u91cf"),r.createElement(D.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:"\u58f0\u91cf\u662f\u6307\u4e00\u5b9a\u7b5b\u9009\u6761\u4ef6\u548c\u65f6\u95f4\u8303\u56f4\u5185\u8bc4\u8bba\u6570\u636e\u4e2d\u63d0\u53d6\u5230\u4e0e\u4ea7\u54c1/\u670d\u52a1/\u5e02\u573a\u76f8\u5173\u7684\u6307\u6807\u7d2f\u52a0\uff0c\u5305\u62ec\u8868\u8fbe\u6b63\u9762\u60c5\u7eea\u548c\u8d1f\u9762\u60c5\u7eea\u7684\u6307\u6807"},r.createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative"}}))),r.createElement("div",{style:{height:"62px"}},r.createElement(D.Z,{placement:"top",overlay:a},r.createElement("span",{id:"flexSpan",style:{fontSize:"50px"}},this.formatNum(a))),r.createElement("span",{style:{color:"#8C8C8C"}},"/ \u603b\u91cf")),r.createElement("div",null,r.createElement("div",null,r.createElement("span",{className:"category"},"\u6b63\u9762"),r.createElement(D.Z,{placement:"top",overlay:n},r.createElement("span",null,this.formatNum(n)))),r.createElement("div",{ref:function(t){return e.divider=t}},"|"),r.createElement("div",null,r.createElement("span",{className:"category"},"\u8d1f\u9762"),r.createElement(D.Z,{placement:"top",overlay:i},r.createElement("span",null,this.formatNum(i)))))),r.createElement("div",{className:"chart-top-wrapper"},r.createElement("div",{className:"time-btn-wrapper"},r.createElement(I.Z,{onDownChartClick:function(){return e._handleChartDownload("\u58f0\u91cf\u8d8b\u52bf")},onDownExcelClick:function(){return e._handleExcelDownload("\u58f0\u91cf\u8d8b\u52bf")}}),r.createElement(P.Z,{uniqueId:p,defaultValue:o,onChange:this.switchDateDimension,style:{float:"right"}}),r.createElement(L.Z,{style:{float:"right"},list:ae,onChange:this.switchFx,value:l,placeholder:r.createElement("i",{className:"icon-cem_fx",style:{fontSize:"18px",fontWeight:"bold"}}),partingLine:!0})),r.createElement(X.Z,{ref:function(t){return e.bar=t},uniqueId:"insight",option:this.getChartOption(),height:167}))))))},t}(r.Component),re=a(45697),ie=a.n(re),oe=function(e){function t(t){var a;return(a=e.call(this,t)||this)._setEvent=function(e){return 0===e?{onMouseEnter:function(){a.setState({firstLiHover:!0})},onMouseLeave:function(){a.setState({firstLiHover:!1})}}:{}},a.setDefaultValue=function(){var e=a.getValue();s.h.post("/default/value/update",{projectId:ee.t.get(ee.V.curProject).id,key:"PRODUCT_ANALYSIS_OBJ",value:JSON.stringify(e)}).then((function(t){a.setState({defaultSelectValue:e,shouldUpdataDefaultSelectValue:!1})}))},a.state={options:[{}],sel:[{name:""},{name:""}],defaultSelectValue:a.props.defaultSelectValue,shouldUpdataDefaultSelectValue:!0,value:{},firstLiHover:!1},a}(0,n.Z)(t,e);var a=t.prototype;return a.onSel=function(e,t){var a=this,n=this.state.options;n.forEach((function(e){return e.sel=!1})),n[t].sel=!0,this.setState({options:n},(function(e){return a.props.onChange&&a.props.onChange(a.getValue())}))},a.getValue=function(){return JSON.parse(JSON.stringify(this.state.options)).filter((function(e){return e.sel}))[0]},a.UNSAFE_componentWillReceiveProps=function(e){if(e.options||e.value){var t=JSON.parse(JSON.stringify(e.options)),a=JSON.parse(JSON.stringify(e.value));t.forEach((function(e){e.id===a.id&&(e.sel=!0)})),this.setState({options:t,value:a}),this.state.shouldUpdataDefaultSelectValue&&this.setState({defaultSelectValue:e.defaultSelectValue})}},a.UNSAFE_componentWillMount=function(){var e=this.props.options,t=this.props.value?this.props.value:{};e.forEach((function(e){e.id===t.id&&(e.sel=!0)})),this.setState({options:e,value:t})},a.componentWillUnmount=function(){},a.render=function(){var e=this,t=this.state,a=t.options,n=t.defaultSelectValue,i=a[0]&&a[0].sel;return r.createElement("div",{className:"selItem "+(this.props.triangle?"triangle":"")+" "+(this.state.firstLiHover||i?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},r.createElement("div",{className:"wrap"},r.createElement("ul",null,a.length>0?a.map((function(t,a){return r.createElement("li",(0,c.Z)({className:(t.sel?"sel":"")+(t.disable?" disable":""),key:a,onClick:function(t){return e.onSel(t,a)}},e._setEvent(a)),r.createElement("span",null,t.name),!e.props.noCollect&&t.sel&&r.createElement("i",{className:"default icon-cem_star",style:{color:n.id===t.id?"#D5B437":"#8C8C8C",opacity:n.id===t.id?"1":""},onClick:n.id===t.id?null:e.setDefaultValue}),r.createElement("i",{className:"check cem-icon icon-cem_arrow-thick"}))})):r.createElement("div",{className:"noData"},"\u65e0\u6570\u636e"))))},t}(r.Component);oe.propTypes={noCollect:ie().bool,options:ie().array,value:ie().object,onChange:ie().func};var se=a(5133),le=function(e){function t(){var t;return(t=e.call(this)||this).sortList=function(e,a,n){n.stopPropagation(),n.nativeEvent.stopImmediatePropagation();var r=JSON.parse(JSON.stringify(t.state.value)),i=r.splice(e,1)[0];switch(a){case"top":r.unshift(i);break;case"up":r.splice(e-1,0,i);break;case"down":r.splice(e+1,0,i)}t.setState({value:r},(function(e){return t.props.onChange&&t.props.onChange(t.getValue())}))},t._setEvent=function(e){return 0===e?{onMouseEnter:function(){t.setState({firstLiHover:!0})},onMouseLeave:function(){t.setState({firstLiHover:!1})}}:{}},t.state={options:[],value:[],showSel:!1,firstLiHover:!1,searchWord:""},t}(0,n.Z)(t,e);var a=t.prototype;return a.onSel=function(e,t){var a=this,n=this.state.options,r=this.state.value;!t.sel&&this.props.limit&&r.length>=this.props.limit?se.Z.warning("\u6700\u591a\u9009\u62e9"+this.props.limit+"\u4e2a\u5bf9\u8c61\uff01"):(n.forEach((function(e){e.id===t.id&&(a.props.singelSel?(e.sel=!0,r=[e]):(e.sel=!e.sel,e.sel?r.push(e):r.some((function(e,a){return(e.id?e.id:e)===t.id&&(r.splice(a,1),!0)}))))})),this.setState({options:n,value:r},(function(e){return a.props.onChange&&a.props.onChange(a.getValue())})))},a.getValue=function(){return this.state.value},a.UNSAFE_componentWillReceiveProps=function(e){if(e.options||e.value){var t=JSON.parse(JSON.stringify(e.options)),a=e.value?JSON.parse(JSON.stringify(e.value)):[];t.forEach((function(e){a&&a.map((function(t){return t.id?t.id:e})).includes(e.id)?e.sel=!0:e.sel=!1})),this.setState({options:t,value:a})}},a.UNSAFE_componentWillMount=function(){var e=this.props,t=e.options,a=e.value,n=void 0===a?[]:a;t.forEach((function(e){n.map((function(t){return t.id?t.id:e})).includes(e.id)&&(e.sel=!0)})),this.setState({options:t,value:n})},a.componentWillUnmount=function(){},a.render=function(){var e=this,t=this.state,a=t.options,n=t.value,i=t.searchWord,o=[];return null!=n&&n.length&&null!=a&&a.length&&(o=n.map((function(e){var t,n=e.id?e.id:e;return{id:n,name:null==(t=a.find((function(e){return e.id===n})))?void 0:t.name,sel:!0}}))),r.createElement("div",{className:"analyze-object-sort-select"},r.createElement("div",{className:"selItem "+(this.props.triangle?"triangle":"")+" "+(this.state.firstLiHover?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},r.createElement("div",{className:"wrap"},r.createElement("div",null,r.createElement(u.Input,{value:i,placeholder:"\u8f93\u5165\u641c\u7d22\u5173\u952e\u8bcd",className:"search",icon:"close",onChange:function(t){return e.setState({searchWord:t})},onIconClick:function(){return e.setState({searchWord:""})}})),r.createElement("ul",null,o.length>0&&o.filter((function(e){return!i||-1!==e.name.toLocaleLowerCase().indexOf(i.trim().toLocaleLowerCase())})).map((function(t,a){return r.createElement("li",(0,c.Z)({className:(t.sel?"sel":"")+(t.disable?" disable":""),key:a,onClick:function(a){return e.props.singelSel?"":e.onSel(a,t)}},e._setEvent(a)),!e.props.singelSel&&r.createElement(W.Jg,{className:"check-all",checked:t.sel,onChange:function(e){}}),r.createElement("span",null,t.name),!e.props.singelSel&&r.createElement("div",{className:"handle"},0!==a&&r.createElement("i",{title:"\u7f6e\u9876",onClick:function(t){e.sortList(a,"top",t)},className:"icon-cem_roof-placement"}),0!==a&&r.createElement("i",{title:"\u4e0a\u4e00\u4f4d",onClick:function(t){e.sortList(a,"up",t)},className:"icon-cem_upper"}),a!==o.length-1&&r.createElement("i",{title:"\u4e0b\u4e00\u4f4d",onClick:function(t){e.sortList(a,"down",t)},className:"icon-cem_lower"})))})),o.length>0&&a.filter((function(e){return!e.sel})).length>0&&r.createElement("div",{className:"line"}),a.filter((function(e){return!e.sel})).length>0&&a.filter((function(e){return!e.sel})).filter((function(e){return!i||-1!==e.name.toLocaleLowerCase().indexOf(i.trim().toLocaleLowerCase())})).map((function(t,a){return r.createElement("li",{className:(t.sel?"sel":"")+(t.disable?" disable":""),key:a,onClick:function(a){return e.onSel(a,t)}},!e.props.singelSel&&r.createElement(W.Jg,{className:"check-all",checked:t.sel,onChange:function(e){}}),r.createElement("span",{className:"dark"},t.name))})),0===a.length&&r.createElement("div",{className:"noData"},"\u65e0\u6570\u636e")))))},t}(r.Component);le.propTypes={options:ie().array,value:ie().array,onChange:ie().func,singelSel:ie().bool};var ce={trend:"1\u4e2a\u5bf9\u8c61\u591a\u4e2a\u6307\u6807\uff0c1\u4e2a\u6307\u6807\u591a\u4e2a\u5bf9\u8c61",emotion:"10\u4e2a\u5206\u6790\u5bf9\u8c61\uff0c10\u4e2a\u5206\u6790\u6307\u6807"},ue=function(e){function t(t){var a;return(a=e.call(this,t)||this).stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},a.setShowSelFalse=function(){a.state.show&&a.cancel(),a.state.show&&a.setState({show:!1})},a.cancel=function(){a.setState({show:!1})},a.getList=function(e){e&&"filter-list"!==e.key||a.setState({list:ee.t.get(ee.V.filterList)?JSON.parse(ee.t.get(ee.V.filterList)).list.filter((function(e){return e.values.length>0&&"escore"!==e.id&&"messageType"!==e.id})):[],allFilterValue:ee.t.get(ee.V.filterList)?JSON.parse(ee.t.get(ee.V.filterList)).value:[]},(function(){ee.t.get(ee.V.filterList)&&JSON.parse(ee.t.get(ee.V.filterList)).list.filter((function(e){return 0===e.values.length})).map((function(e){return e.id})).includes(a.state.selectValue&&a.state.selectValue.id)?a.setDefaultValue():a.state.selectValue&&a.state.selectValue.id&&a.competeSortSelectValue(a.props.onChange)}))},a.competeSortSelectValue=function(e){var t=a.state,n=t.selectValue,r=t.allFilterValue,i=t.sortSelectValue,o=t.list,s=t.defaultSelectValue,l=[],c=a.props.getParams().filterModel.connConfig,u=ee.t.get(ee.V.productFilterList,"session")||[];if(Array.isArray(r)&&r.some((function(e){return e.id===n.id}))){var p=(null!=c&&c.every((function(e){return e.id===n.id}))||!c||null==c||!c.length?r.filter((function(e){return e.id===n.id}))[0]:n||(null==u?void 0:u.find((function(e){return e.id===n.id})))||{}).values;l=p?p.slice(0,a.props.limit?a.props.limit>10?10:a.props.limit:10).map((function(e){return{id:e.id?e.id:e}})):[]}else{var d,h,f;if(Array.isArray&&o.some((function(e){return e.id===n.id})))l=s&&n.id===s.id?(null==(d=s.values)?void 0:d.slice(0,a.props.limit?a.props.limit>10?10:a.props.limit:10))||i:null!=u&&u.some((function(e){return e.id===n.id}))?null!=c&&c.every((function(e){return e.id===n.id}))||!c||null==c||!c.length?(null==u?void 0:u.filter((function(e){return e.id===n.id}))[0].values.slice(0,a.props.limit?a.props.limit>10?10:a.props.limit:10))||[]:(null==(h=n.values)?void 0:h.slice(0,a.props.limit?a.props.limit>10?10:a.props.limit:10))||(null==u||null==(f=u.find((function(e){return e.id===n.id})).values)?void 0:f.slice(0,a.props.limit?a.props.limit>10?10:a.props.limit:10))||[]:[]}a.setState({sortSelectValue:l},(function(){return e&&e(a.getValue())}))},a.onSelChange=function(e,t){var n;a.setState(((n={})[e]=t,n),(function(){"sortSelectValue"===e||"selectValue"===e&&a.competeSortSelectValue(),a.getSecondLevelList()}))},a.getSecondLevelList=function(){var e=a.getValue(),t=a.state.list.filter((function(t){return t.id===e.id}))[0]?a.state.list.filter((function(t){return t.id===e.id}))[0].values:[],n=t.filter((function(t){return 0===e.values.length||e.values.includes(t.id)}));return{list:t,valueList:n,id:e.id,name:e.name}},a.state={list:[],allFilterValue:[],defaultSelectValue:{},selectValue:{},sortSelectValue:[],show:!1,triangle:"select"},a}(0,n.Z)(t,e);var a=t.prototype;return a.UNSAFE_componentWillMount=function(){this.props.left&&this.props.left<-200&&this.setState({triangle:"sortSelect"})},a.componentDidMount=function(){var e=this;this.getList(),setTimeout((function(){return e.getDefault()}),300),window.addEventListener("setItemEvent",this.getList),window.addEventListener("click",this.setShowSelFalse),this.props.left&&document.querySelectorAll(".filter-link-analyze-object").forEach((function(t){return t.style.setProperty("--x",e.props.left+"px")}))},a.componentWillUnmount=function(){window.removeEventListener("setItemEvent",this.getList),window.removeEventListener("click",this.setShowSelFalse)},a.setDefaultValue=function(){var e,t,a=this,n=this.state,r=n.defaultSelectValue,i=n.list,o=void 0===i?[]:i;if(r&&o.some((function(e){return e.id===r.id})))e=r,r.values&&r.values.length&&(t=r.values);else{if(this.props.defaultSelValue&&o.some((function(e){return e.id===a.props.defaultSelValue.id}))){var s=o.filter((function(e){return e.id===a.props.defaultSelValue.id}));e=s[0]}else e=o[0];t=o.some((function(t){return t.id===e.id}))?o.filter((function(t){return t.id===e.id}))[0].values.slice(0,1):[]}this.setState({selectValue:e,sortSelectValue:t},(function(){a.competeSortSelectValue(a.props.onChange)}))},a.getDefault=function(){var e=this;s.h.post("/default/value/find",{projectId:ee.t.get(ee.V.curProject).id,key:"PRODUCT_ANALYSIS_OBJ_"+this.props.model}).then((function(t){t.data.result?e.setState({defaultSelectValue:JSON.parse(t.data.result)},(function(){return e.setDefaultValue()})):e.setDefaultValue()}))},a.setDefault=function(){var e=this,t=JSON.parse(ee.t.get(ee.V.filterList)).list.filter((function(t){return t.id===e.state.selectValue.id}))[0];t=t?t.values.map((function(e){return e.id})):[],s.h.post("/default/value/update",{projectId:ee.t.get(ee.V.curProject).id,key:"PRODUCT_ANALYSIS_OBJ_"+this.props.model,value:JSON.stringify((0,c.Z)({},this.getValue(),{special:this.getValue().type}))})},a.saveValue=function(){var e=this,t=ee.t.get(ee.V.filterList),a=t?JSON.parse(t):{};Array.isArray(a.value)&&a.value.length>0&&a.value.some((function(t){return t.id===e.state.selectValue.id}))?a.value.forEach((function(t){t.id===e.state.selectValue.id&&(t.values=e.state.sortSelectValue.map((function(e){return e.id})))})):(Array.isArray(a.value)||(a.value=[]),a.value.push({id:this.state.selectValue.id,special:a.list.filter((function(t){return t.id===e.state.selectValue.id}))[0].special,values:this.state.sortSelectValue.map((function(e){return e.id}))})),ee.t.set(ee.V.filterList,JSON.stringify(a));var n=new Event("setItemEvent");n.key="save-value",window.dispatchEvent(n)},a.getValue=function(){var e=this.state,t=e.sortSelectValue,a=e.selectValue;if(this.state.selectValue&&this.state.selectValue.id){var n=JSON.parse(ee.t.get(ee.V.filterList)).list.filter((function(e){return e.id===a.id}))[0],r=this.props.getParams().filterModel.connConfig,i=n?n.values.map((function(e){return e.id})):[],o=t&&t.length?n.id===a.id&&(r&&r.every((function(e){return e.id===a.id}))||!r||null==r||!r.length)?null==t?void 0:t.filter((function(e){return i.includes(e.id?e.id:e)})).map((function(e){return e.id?e.id:e})):t?t.map((function(e){return e.id?e.id:e})):[]:i;return{id:a.id,values:o||[],name:a.name,type:a.special}}return{}},a.changeShow=function(e){var t=this;this.state.show&&this.stop(e),setTimeout((function(){t.setState({show:!t.state.show})}),0)},a.render=function(){var e=this,t=this.state,a=t.list,n=t.selectValue,i=t.sortSelectValue,o=t.defaultSelectValue,s=t.show,l=t.triangle,c=this.props.getParams().filterModel.connConfig,p=a.map((function(e){return{id:e.id,name:e.name,special:e.special}})),d=ee.t.get(ee.V.productFilterList,"session")||[],h=null!=a&&a.find((function(e){return n&&"undefined"!==n.id&&e.id===n.id}))?null!=c&&c.every((function(e){return e.id===n.id}))||!c||null==c||!c.length?a.find((function(e){return e.id===n.id})).values.map((function(e){return delete e.sel,e})):(null==d?void 0:d.find((function(e){return e.id===n.id})).values.map((function(e){return{id:e.id,name:e.name}})))||[]:[];return r.createElement("div",{className:"filter-link-analyze-object",style:this.props.style?this.props.style:{}},r.createElement("div",{className:"analyze-object-select",onClick:function(t){return e.changeShow(t)}},r.createElement("div",{className:"infor "+(s?"sel":"")},r.createElement("span",null,"\u5206\u6790\u5bf9\u8c61"),r.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:s?"rotate(-180deg)":""}})),s&&r.createElement(oe,{options:p,defaultSelectValue:o,value:n,onChange:function(t){return e.onSelChange("selectValue",t)},triangle:"select"===l,type:this.props.type})),s&&r.createElement(le,{options:h,limit:this.props.limit,value:i,onChange:function(t){return e.onSelChange("sortSelectValue",t)},triangle:"sortSelect"===l,type:this.props.type}),s&&r.createElement("div",{className:"footer",onClick:function(t){return e.stop(t)}},this.props.type&&r.createElement("p",{className:"tips"},r.createElement("span",null,"\u56fe\u8868\u652f\u6301\uff1a"),ce[this.props.type]),p.length>0&&r.createElement("div",{className:"control"},r.createElement(u.Button,{type:"primary",disabled:!p.length||!h.length||!n.id||!i||!i.length,onClick:function(){e.cancel(),e.props.onChange&&e.props.onChange(e.getValue()),e.setDefault()}},"\u786e\u5b9a"),r.createElement("span",{className:"cancel",onClick:function(){return e.cancel()}},"\u53d6\u6d88"))))},t}(r.Component),pe=function(e){var t=[];return e.topics&&e.topics.titles&&e.topics.titles.length>0&&t.push.apply(t,e.topics.titles.filter((function(e){return e.special="connConfig",e.values.length>1}))),e.source&&e.source.length>0&&t.push({id:"source",name:"\u6570\u636e\u6765\u6e90",special:"source",values:e.source}),e.tag&&e.tag.length>0&&e.tag.forEach((function(e){e.special="tag",t.push(e)})),e.expandTopics&&t.push({id:"expandTopic",name:"\u7ec4\u5408\u5206\u6790",special:"expandTopic",values:e.expandTopics}),JSON.parse(JSON.stringify(t))};r.Component;const de=ue;var he=a(61193),fe=a(97911),me=a(40845),ge=a(97189),ve=function(e){function t(t){var a;return(a=e.call(this,t)||this).setDefault=function(){var e=a.props,t=e.projectId,n=e.model,r=a.state,i=r.aspectType,o=r.aspect1,s=r.aspect2,l=r.ready;(0,me.s)({projectId:t,key:"PRODUCT_ANALYSIS_ASPECT_"+n,value:JSON.stringify({aspect:{aspectType:i,aspect1:i&&l?o:[],aspect2:i&&l?[]:s}})})},a.getDefault=function(){var e=a.props,t=e.projectId,n=e.model;(0,me.o)({projectId:t,key:"PRODUCT_ANALYSIS_ASPECT_"+n}).then((function(e){if(e.data.result){var t=JSON.parse(e.data.result),n=t.aspect,r=n.aspectType,i=n.aspect1,o=n.aspect2;t.type;a.setState({aspectType:r,aspect1:i,aspect2:o})}}))},a.changeState=function(e){a.setState(e,(function(){a.updateFilter()}))},a.clickCheckbox=function(e){var t=e.aspect1,n=e.aspect2,r=a.state.limit;r&&(t&&t.length>r||n&&n.length>r)?se.Z.warning("\u5f53\u524d\u6761\u4ef6\u4e0b\u6700\u591a\u652f\u6301\u9009\u62e9"+r+"\u4e2a\u5206\u6790\u6307\u6807"):a.setState(e)},a.updateFilter=function(){var e=a.state.aspectType,t=a.state,n=t.aspect1,r=t.aspect2;e&&n&&n.length>0?r=[]:r.length>0&&(n=[]),a.setState({aspect1:n,aspect2:r})},a.fetchAspects=function(e,t){var n=a.state.fetching;e&&t&&!n&&a.setState({fetching:!0},(function(){s.h.post("filter/find",{filterTypes:["ASPECT"],projectId:e,type:t}).then((function(n){var r=n.data.result;r.aspect&&(r.treeAspect&&r.treeAspect[0]&&r.treeAspect[0].treeId&&(a.treeId=r.treeAspect[0].treeId),a.setState({projectId:e,model:t,rawAspectList:r.aspect},(function(){return a.formatData()})))})).finally((function(){return a.setState({fetching:!1})}))}))},a.clickCancelBtn=function(){a.state.aspectShow&&a.props.closePanel()},a.orderAspect=function(e){for(var t=a.state.aspectList,n=[],r=[],i=0;i<t.length;i++){for(var o=!1,s=0;s<e.length;s++)if(t[i].name===e[s]){o=!0,n[s]=t[i];break}o||r.push(t[i])}a.setState({aspectList:n.concat(r)})},a.state={aspectShow:!1,aspectType:!0,aspect1:[],aspect2:[],rawAspectList:[],aspectList:[],projectId:t.projectId,model:t.model,ready:!1,fetching:!1,limit:t.limit},a}(0,n.Z)(t,e);var a=t.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){var t=e.aspectShow,a=e.limit;this.setState({aspectShow:t,limit:a})},a.componentDidMount=function(){window.addEventListener("click",this.clickCancelBtn)},a.componentDidUpdate=function(){this.setLeftBlockHeight()},a.componentWillUnmount=function(){window.removeEventListener("click",this.clickCancelBtn)},a.setLeftBlockHeight=function(){var e=document.querySelectorAll(".analyse-aspect-panel-body .left .new-checkbox-panel .wt-checkbox-group .wt-checkbox"),t=document.querySelectorAll(".analyse-aspect-panel-body .right .new-checkbox-panel");if(e.forEach((function(e){return e.style.marginBottom="0"})),t.length>0)for(var a=t.length-1;a>=0;a--){var n=t[a].offsetHeight;n>36&&(e[a].style.marginBottom=n-36+"px")}},a.getValue=function(){var e=this.state,t=e.aspectType,a=e.aspect1,n=e.aspect2;if(e.ready)return{aspect1:t?a:[],aspect2:t?[]:n};var r=this.props,i=r.projectId,o=r.model;this.fetchAspects(i,o)},a.getSndIndex=function(e){var t=this.state.aspects[e];return t&&t.length>0&&this.setState({aspectType:!1,aspect1:[],aspect2:t}),t},a.setAspectFromOutside=function(e){this.setState((0,c.Z)({aspectType:e.aspect1.length>0},e))},a.formatData=function(){var e=this,t=this.state,a=t.model,n=t.aspect1,r=t.aspect2,i=t.rawAspectList,o=t.limit,s=this.state,l=s.aspectShow,c=s.aspectType,u=i,p={};if("BRAND"===a){var d=u.map((function(e){return e&&JSON.parse(e)})),h=0,f=he.Z.getAuthority();if(f.indexOf("ANALYZE_PRODUCT")>=0&&h++,f.indexOf("ANALYZE_SERVER")>=0&&h++,f.indexOf("ANALYZE_MARKETING")>=0&&h++,0===h)d.forEach((function(e){Object.keys(e).forEach((function(e,t){return p[t]=e}))}));else if(1===h)["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].forEach((function(e,t){f.indexOf(e)>=0&&Object.keys(d[t]).map((function(e,t){return p[t]=e}))}));else if(h>1){if(f.indexOf("ANALYZE_PRODUCT")>=0){var m=Object.keys(d[0]);1===m.length?p["\u4ea7\u54c1"]=d[0][m[0]]:m.length>1&&(p["\u4ea7\u54c1"]=d[0])}if(f.indexOf("ANALYZE_SERVER")>=0){var g=Object.keys(d[1]);1===g.length?p["\u670d\u52a1"]=d[1][g[0]]:g.length>1&&(p["\u670d\u52a1"]=d[1])}if(f.indexOf("ANALYZE_MARKETING")>=0){var v=Object.keys(d[2]);1===v.length?p["\u5e02\u573a"]=d[2][v[0]]:v.length>1&&(p["\u5e02\u573a"]=d[2])}}}else u&&u[0]&&(p=JSON.parse(u[0]));var y=Object.keys(p).map((function(e,t){var a=p[e];return{id:t,name:e,contain:a.length?a:Object.keys(a).map((function(e,t){var n=a[e];return{id:t,name:e,contain:n.length?n:Object.keys(n)}}))}}));y.length<=1&&(l=!1,c=!1),c&&!n.length?null!==o?y.forEach((function(e,t){t<o&&n.push(e.name)})):y.forEach((function(e){return n.push(e.name)})):c||r.length||y&&y[0]&&y[0].contain.forEach((function(e){"object"===typeof e?r.push(e.name):r.push(e)})),this.setState({aspectList:y,aspectShow:l,aspects:p,aspectType:c,aspect1:n,aspect2:r,ready:!0},(function(){e.props.onChange(),e.updateFilter()}))},a.handleClickBlock=function(e,t){var a=this.state,n=a.aspectType;if(a.aspectShow&&n!==e){var r=document.querySelectorAll(".analyse-aspect-panel-body div"),i="disabled";e?this.hanldeClass("remove",r[1],i):this.hanldeClass("remove",r[0],i),e?this.setState({aspectType:e,aspect2:[]}):this.setState({aspectType:e,aspect1:[]})}},a.hanldeClass=function(e,t,a){if("add"===e)(0,ge.addClass)(t,a);else(0,ge.removeClass)(t,a)},a.clickConfirmBtn=function(){this.props.onChange(),this.setDefault(),this.props.closePanel()},a.clearOptions=function(){this.setState({aspect1:[],aspect2:[]})},a.render=function(){var e=this,t=this.state,a=t.aspectList,n=t.aspectType,i=t.aspect1,o=t.aspect2,s=t.aspectShow,l=t.limit;return r.createElement("div",{className:"analyse-aspect-panel-wrapper",style:{display:s?"block":"none"},onClick:function(e){return e.stopPropagation()}},r.createElement("div",{className:"analyse-aspect-panel-body"},r.createElement("div",{className:n?"left":"left disabled",onClick:function(t){return e.handleClickBlock(!0,t)}},r.createElement(fe.Z,{changeState:function(t){return e.clickCheckbox({aspect1:t})},checkedList:i,ITEMS:a.map((function(e){return e.name||e})),categoryTitle:"\u4e00\u7ea7\u6307\u6807",type:"vertical",limit:l})),r.createElement("div",{className:n?"right disabled":"right",onClick:function(t){return e.handleClickBlock(!1,t)}},r.createElement("div",null,"\u4e8c\u7ea7\u6307\u6807"),a.length>0&&a.map((function(t,a){return r.createElement(fe.Z,{changeState:function(t){return e.clickCheckbox({aspect2:t})},checkedList:JSON.parse(JSON.stringify(o)),key:"aspect1-"+a,categoryTitle:t.name,ITEMS:t.contain.map((function(e){return e.name||e})),type:"horizontal",limit:l})})))),r.createElement("div",{className:"analyse-aspect-panel-footer"},r.createElement("span",{onClick:function(){return e.clearOptions()}},"\u6e05\u7a7a\u5168\u90e8\u9009\u9879"),r.createElement("div",null,r.createElement(u.Button,{type:"primary",disabled:n&&(0===i.length||null!==l&&i.length>l)||!n&&0===o.length||null!==l&&o.length>l,onClick:function(){return e.clickConfirmBtn()}},"\u786e\u5b9a"),r.createElement("span",{className:"cancelBtn",onClick:function(){return e.clickCancelBtn()}},"\u53d6\u6d88"))))},t}(r.Component),ye=function(e){function t(t){var a;return(a=e.call(this,t)||this).closePanel=function(){a.setState({showPanel:!1})},a.state={showPanel:!1},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.panel&&this.panel.getDefault()},a.togglePanel=function(e){var t=this,a=this.state.showPanel;a&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){return t.setState({showPanel:!a})}),0)},a.getValue=function(){if(this.panel)return this.panel.getValue()},a.getSndIndex=function(e){return this.panel.getSndIndex(e)},a.setAspectFromOutside=function(e){return this.panel.setAspectFromOutside(e)},a.orderAspect=function(e){this.panel.orderAspect(e)},a.render=function(){var e=this,t=this.state.showPanel;return r.createElement("div",{className:"analyse-aspect-wrapper"},r.createElement("div",{className:"analyse-aspect-trigger",style:{backgroundColor:t?"rgb(97,121,155)":"",color:t?"white":"#8C8C8C"},onClick:function(t){return e.togglePanel(t)}},r.createElement("span",null,"\u5206\u6790\u6307\u6807"),r.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":"",color:t?"white":"#8C8C8C"}})),r.createElement(ve,(0,c.Z)({ref:function(t){e.panel=t},aspectShow:t,closePanel:this.closePanel},this.props)))},t}(r.Component),Ee=function(e){function t(t){var a;return(a=e.call(this,t)||this).emit=function(){a.props.type&&a.competeRules(),a.props.onChange&&a.props.onChange(a.getValue())},a.getValue=function(){var e=a.refs.AnalyzeObject.getValue();return e.type&&(e.type=e.type.toUpperCase()),{analysis:e,aspect:a.refs.AnalyzeIndex.getValue()?a.refs.AnalyzeIndex.getValue():{aspect1:[],aspect2:[]},treeId:a.refs.AnalyzeIndex.panel?a.refs.AnalyzeIndex.panel.treeId:""}},a.competeRules=function(){var e=a.state.rules;"trend"===a.props.type&&(e.trend=function(){var e=a.getValue(),t=e.analysis,n=e.aspect,r=n.aspect1,i=n.aspect2;if(t.values)return t.values.length>1?[null,1]:r.length>1||i.length>1?[1,null]:t.values.length<=1&&(r.length<=1||i.length<=1)?[null,null]:void 0}(),a.setState({rules:e}))},a.state={rules:{emotion:[10,10],trend:[1,null]}},a}(0,n.Z)(t,e);var a=t.prototype;return a.getFilterList=function(){},a.componentDidMount=function(){this.getFilterList()},a.render=function(){var e=this.props,t=e.projectId,a=e.model,n=e.type,i=e.getParams,o=this.state.rules;return r.createElement("div",{className:"analyze-filter"},r.createElement(de,{ref:"AnalyzeObject",left:-58,onChange:this.emit,limit:n&&o[n]?o[n][0]:null,type:n,model:a,getParams:i}),r.createElement(ye,{ref:"AnalyzeIndex",onChange:this.emit,projectId:t,model:a,limit:n&&o[n]?o[n][1]:null}))},t}(r.Component);Ee.propTypes={onChange:ie().func,type:ie().string};var Ce={c10:["cem_radar-gray","cem_radar","\u96f7\u8fbe\u56fe"],c0:["cem_multi-graph-withcolor1","cem_multi-graph","\u5e73\u94fa\u56fe"],c1:["cem_red-negative-dee","cem_red-negative-wit","\u8d1f\u9762\u60c5\u611f\u56fe"],c2:["cem_red-negative-noc","cem_green-front-with","\u6b63\u9762\u60c5\u611f\u56fe"],c3:["cem_twocolor-separat","cem_twocolor-separat1","\u60c5\u611f\u5bf9\u6bd4\u56fe"],c4:["cem_twocolor-oneway-","cem_twocolor-oneway-1","\u60c5\u611f\u5806\u53e0\u56fe"]},be={c0:["cem_line-chart","cem_line-chart-color","\u8d8b\u52bf\u56fe"]},Se=[{type:"s1",img:"#icon-cem_user-voice1",title:"\u7528\u6237\u58f0\u91cf",hint:"\u8ba1\u6570",desc:"\u5bf9\u5177\u4f53\u5206\u6790\u6307\u6807\u7684\u6570\u91cf\u8ba1\u6570\u7d2f\u52a0\uff0c\u5bf9\u7528\u6237\u7684\u610f\u89c1\u8fdb\u884c\u5ba2\u89c2\u7684\u6570\u91cf\u7edf\u8ba1\uff0c\u8868\u793a\u7528\u6237\u53d1\u51fa\u7684\u201c\u58f0\u97f3\u91cf\u201d\u3002"},{type:"s3",img:"#icon-cem_index",title:"\u6307\u6807\u6ee1\u610f\u5ea6",hint:"\u6bd4\u4f8b",desc:'\u5bf9\u5177\u4f53\u6307\u6807\u7684A\u7684\u6b63\u9762\u60c5\u611fA1\u548c\u8d1f\u9762\u60c5\u611fA2\u6570\u91cf\u8fdb\u884c\u7edf\u8ba1\u540e\uff0c\u8ba1\u7b97\u8be5\u6307\u6807A\u7684"\u597d\u8bc4\u7387\uff1dA1\xf7(A1+A2)"\u548c"\u574f\u8bc4\u7387\uff1dA2\xf7(A1+A2)"\u3002'},{type:"s4",img:"#icon-cem_special-emotions",title:"\u7279\u5b9a\u60c5\u611f\u5360\u6bd4",hint:"\u6bd4\u4f8b",desc:"\u5bf9\u56fe\u8868\u4e2d\u5c55\u793a\u7684\u6240\u6709\u6307\u6807\uff0c\u5982A\u3001B\u3001C\u3001D...\u7b49\u6307\u6807\u7684\u6b63\u5411\u60c5\u611fA1\u3001B1\u3001C1\u3001D1...\u7b49\u6570\u91cf\u7d2f\u52a0\u548c\u8d1f\u9762\u60c5\u611fA2\u3001B2\u3001C2\u3001D2...\u7b49\u6570\u91cf\u7d2f\u52a0\uff0c\u4ee5\u6b64\u8ba1\u7b97A1\xf7(A1+B1+C1+D1+...)\u548cA2\xf7(A2+B2+C2+D2+..)\u7684\u503c\u3002\u901a\u8fc7\u8be5\u516c\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u7684\u6bd4\u8f83\u5177\u4f53\u6307\u6807A\u7684\u6b63\u9762\u60c5\u611fA1\u5728\u5168\u90e8\u6b63\u9762\u60c5\u611f\u4e2d\u7684\u5360\u6bd4\uff0cA\u7684\u8d1f\u9762\u60c5\u611f\u4e5f\u5982\u6b64\u3002\u8ba9\u6211\u4eec\u66f4\u76f4\u89c2\u7684\u4e86\u89e3\u5f71\u54cd\u6b63\u9762\u60c5\u611f\u7684\u4e3b\u8981\u6307\u6807\u6216\u8005\u5f71\u54cd\u8d1f\u9762\u60c5\u611f\u7684\u4e3b\u8981\u6307\u6807\u3002"},{type:"s5",img:"#icon-cem_total-proportion",title:"\u603b\u5360\u6bd4",hint:"\u6bd4\u4f8b",desc:'\u8ba1\u7b97\u5177\u4f53\u6307\u6807\u7684A\u7684\u6b63\u9762\u60c5\u611f\u91cf"A1\xf7\u7528\u6237\u58f0\u91cf\u201d\u548c\u201cA2\xf7\u7528\u6237\u58f0\u91cf"\uff0c\u5176\u4ed6\u6307\u6807B\u3001C\u3001D...\u7b49\u4e5f\u5982\u6b64\u8ba1\u7b97\u3002\u8be5\u516c\u5f0f\u5728\u591a\u4e2a\u5206\u6790\u5bf9\u8c61\u5bf9\u6bd4\u65f6\u5c24\u5176\u6709\u7528\uff0c\u53ef\u4ee5\u8ba9\u4e0d\u540c\u58f0\u91cf\u7b49\u7ea7\u7684\u5206\u6790\u5bf9\u8c61\u8fdb\u884c\u6709\u6548\u6bd4\u8f83\uff0c\u5982\u521a\u63a8\u51fa\u7684\u65b0\u54c1\u548c\u5df2\u63a8\u5411\u5e02\u573a\u7684\u6210\u719f\u4ea7\u54c1\u7684\u6307\u6807\u6bd4\u8f83\u3002'},{type:"s2",img:"#icon-cem_geometry",title:"\u51e0\u4f55\u5e73\u5747",hint:"\u6307\u6570",desc:"\u5bf9\u5355\u4e2a\u6307\u6807A\u7684\u6b63\u5411\u60c5\u611fA1\u6216A2\u7684\u6307\u6807\u6ee1\u610f\u5ea6\u3001\u7279\u5b9a\u60c5\u611f\u5360\u6bd4\u548c\u603b\u5360\u6bd4\u4e09\u4e2a\u516c\u5f0f\u8ba1\u7b97\u5f97\u51fa\u7684\u6bd4\u4f8b\u503c\u8fdb\u884c\u51e0\u4f55\u5e73\u5747\u5904\u7406\uff08\u5373\u8fde\u4e58\u540e\u5f00\u6839\u53f7\uff09\uff0c\u5c06\u5f97\u5230\u4e00\u4e2a\u65b0\u7684\u6bd4\u4f8b\u6570\u503c\uff0c\u8be5\u6307\u6807\u53ef\u4ee5\u7efc\u5408\u63cf\u8ff0\u6307\u6807A\u4e2dA1\uff08\u6216A2\uff09\u7684\u91cd\u8981\u7a0b\u5ea6\u3002\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u201d\u590d\u5229\u4e0b\u7684\u5e73\u5747\u5e74\u5229\u7387\u201c\u548c\u201d\u8fde\u7eed\u4f5c\u4e1a\u7684\u8f66\u95f4\u6c42\u4ea7\u54c1\u7684\u5e73\u5747\u5408\u683c\u7387\u201c\u90fd\u662f\u57fa\u4e8e\u51e0\u4f55\u5e73\u5747\u8ba1\u7b97\u516c\u5f0f\u5f97\u51fa\u7684\u3002"}],Oe={s1:"COUNT",s2:"WEIGHT",s3:"A",s4:"B",s5:"C"},we=[{title:"\u6307\u6807\u6392\u5e8f",type:"rangeObject",options:[{key:"positive",value:"\u6b63\u9762\u9ad8\u5230\u4f4e"},{key:"negative",value:"\u8d1f\u9762\u9ad8\u5230\u4f4e"}]},{title:"\u6570\u636e\u5c55\u793a",type:"showValue",options:[{key:"yes",value:"\u5c55\u793a"},{key:"no",value:"\u4e0d\u5c55\u793a"}]}],Te=[{title:"\u8d1f\u9762\u60c5\u611f",value:"negative"},{title:"\u6b63\u9762\u60c5\u611f",value:"positive"}],Ne=[{title:"\u6309\u65e5\u5206\u6790",value:"DAY"},{title:"\u6309\u5468\u5206\u6790",value:"WEEK"},{title:"\u6309\u6708\u5206\u6790",value:"MONTH"},{title:"\u6309\u5e74\u5206\u6790",value:"YEAR"}],xe=[{title:"\u5bfc\u51fa\u56fe\u7247",type:"image"},{title:"\u5bfc\u51fa\u6570\u636e",type:"excel"}],De={time:"DAY",chartType:"c0",rangeType:"desc",statisticType:"s1",rangeObject:"positive",showValue:"no"};const ke=function(e){function t(t){var a;return(a=e.call(this,t)||this)._setPadShowFalse=function(){a.state.isPadShow&&a.setState({isPadShow:!1})},a._setEvent=function(e){return 0===e?{onMouseEnter:function(){a.setState({firstLiHover:!0})},onMouseLeave:function(){a.setState({firstLiHover:!1})}}:{}},a._handleLiClick=function(e,t){e.stopPropagation(),a.setState({type:t.type,isPadShow:!1}),a.props.onStatisticChange({type:t.type,title:t.title,desc:t.desc})},a._handleOnFxClick=function(e){a.state.isPadShow&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){a.setState({isPadShow:!a.state.isPadShow})}),0)},a.state={type:De.statisticType,firstLiHover:!1,isPadShow:!1},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},a.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},a.render=function(){var e=this,t=this.state.isPadShow;return r.createElement("div",{className:"statistic-button-wrapper",onClick:this._handleOnFxClick},r.createElement("div",{className:"button-icon "+(t?"click":""),style:t?{color:"#262626",backgroundColor:"#F7F8FA",fontWeight:"bold"}:{}},r.createElement("span",null,r.createElement("i",{className:"icon-cem_fx fx-icon"}),r.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}}))),r.createElement("div",{className:"selPad "+(this.state.firstLiHover||"s1"===this.state.type?"selPadHover":""),style:{display:this.state.isPadShow?"block":"none"}},r.createElement("ul",null,Se.map((function(t,a){return r.createElement("li",(0,c.Z)({className:e.state.type===t.type?"liSel":"",key:a},e._setEvent(a),{onClick:function(a){return e._handleLiClick(a,t)}}),r.createElement("div",{className:"sta-image"},r.createElement("svg",{className:"icon-svg"},r.createElement("use",{xlinkHref:t.img}))),r.createElement("div",{className:"sta-content"},r.createElement("div",null,r.createElement("span",{className:"sta-content-hint"},t.hint," - "),r.createElement("span",{className:"sta-content-title"},t.title)),r.createElement("div",{className:"sta-content-desc"},t.desc)))})))))},t}(r.Component);const _e=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._handleOptionClick=function(e,a){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();var n,r=t.props,i=r.data,o=r.onMoreOptionChange;r.chosenKey!==a&&o(((n={})[i.type]=a,n))},t}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this,t=document.getElementsByClassName("option");t&&t instanceof Array&&t.forEach((function(t){t.addEventListener("click",e._handleOptionClick)}))},a.componentWillUnmount=function(){var e=this,t=document.getElementsByClassName("option");t&&t instanceof Array&&t.forEach((function(t){t.removeEventListener("click",e._handleOptionClick)}))},a.render=function(){var e=this,t=this.props,a=t.data,n=t.chosenKey;return r.createElement("div",{className:"analysis-chart-radio-select-wrapper"},r.createElement("div",{className:"title"},a.title),r.createElement("ul",null,a.options.map((function(t){return r.createElement("li",{key:t.key,className:"option "+(t.key===n?"chosen":"")},r.createElement("span",{onClick:function(a){return e._handleOptionClick(a,t.key)}},t.value))}))))},t}(r.Component);var Ae=a(33798),Me=function(e){function t(t){var a;return(a=e.call(this,t)||this)._setPadShowFalse=function(){a.state.showPanel&&a.setState({showPanel:!1})},a._handleBtnClick=function(e){a.state.showPanel&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){a.setState({showPanel:!a.state.showPanel})}),0)},a.state={showPanel:!1},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},a.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},a.render=function(){var e=this.state.showPanel,t=this.props,a=t.chosenOptions,n=t.onChange,i=t.options;return r.createElement("div",{className:"analysis-chart-header-setting-wrapper"},r.createElement(Ae.Z,{defaultIcon:"cem_more-two",activeIcon:"cem_chart-setting",onClick:this._handleBtnClick}),r.createElement("div",{className:"more-panel",style:{display:e?"block":"none"}},i.map((function(e,t){return r.createElement(_e,{key:t,chosenKey:a[e.type],data:e,onMoreOptionChange:n})}))))},t}(r.Component);Me.propTypes={chosenOptions:ie().object.isRequired,onChange:ie().func.isRequired,options:ie().array.isRequired};const Le=Me;var Pe=a(60496),Ie=a(35303),Re=a(91751),je=a(59108),Fe=a.n(je),Ze=a(82784),Ve=a.n(Ze);a(83839);Z().locale("zh-cn");var ze="YYYY-MM-DD";function Be(e){return e?e.format(ze):""}function We(e){var t=Z()();return e.isAfter(t)}var Ye=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).onStandaloneSelect=function(e){"calendar"===t.props.type?t.props.getDateRange(Be(e)):e[0]&&e[1]&&t.props.getDateRange([Be(e[0]),Be(e[1])])},t}(0,n.Z)(t,e);var a=t.prototype;return a.stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},a.render=function(){var e=this,t=this.props.type,a={showDateInput:!1,locale:Ve(),showOk:!1,showToday:!1,format:ze,onSelect:this.onStandaloneSelect,disabledDate:We,renderFooter:function(){return null}};return r.createElement("div",{className:"fixed-datepicker-wrapper",onClick:function(t){return e.stop(t)}},"calendar"===t?r.createElement(Re.Z,(0,c.Z)({},a,this.props)):r.createElement(Fe(),(0,c.Z)({},a,this.props)))},t}(r.PureComponent);Ye.propTypes={type:ie().string.isRequired,getDateRange:ie().func.isRequired};var Je=a(126),He=function(e){function t(t){var a;return(a=e.call(this,t)||this).openPanel=function(e){a.state.panelShow&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){return a.setState({panelShow:!0})}),0)},a.closePanel=function(){a.setState({panelShow:!1})},a.getDateRange=function(e){var t=a.props.index;a.closePanel(),a.props.getDateRange(e,t)},a.state={panelShow:!1,value:t.value||[],index:t.index,type:t.type,disabledDate:t.disabledDate},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){window.addEventListener("click",this.closePanel)},a.UNSAFE_componentWillReceiveProps=function(e){this.setState((0,c.Z)({},e))},a.componentWillUnmount=function(){window.removeEventListener("click",this.closePanel)},a.render=function(){var e=this,t=this.state,a=t.value,n=t.type,i=t.disabledDate,o=t.panelShow,s=[];return a&&2===a.length&&(s=a.map((function(e){return Z()(e,"YYYY-MM-DD")}))),r.createElement(Je.Z,{ref:function(t){return e.trigger=t},action:["click"],popupAlign:{points:["tl","bl"],offset:[0,4]},popup:r.createElement(Ye,{type:n,getDateRange:this.getDateRange,defaultSelectedValue:"calendar"===n?s[0]:s,disabledDate:i}),popupVisible:o},r.createElement(u.Input,{value:a&&2===a.length&&a.join("~")||"",placeholder:"\u8bf7\u9009\u62e9\u65e5\u671f",onClick:this.openPanel}))},t}(r.Component);He.propTypes={type:ie().string.isRequired,value:ie().array,getDateRange:ie().func.isRequired,index:ie().number,disabledDate:ie().func};var Ue="YYYY-MM-DD",Ge=[{label:"\u5e73\u5747\u503c\u5bf9\u6bd4",value:"AVG"},{label:"\u4e0d\u53e6\u8bbe\u5bf9\u6bd4\u5bf9\u8c61",value:"NONE"},{label:"\u5177\u4f53\u5206\u6790\u5bf9\u8c61",value:"SELECT"}],qe=["\u4ec5\u6240\u9009\u4e3b\u9898"],Ke=["\u4e0d\u53e6\u8bbe\u5bf9\u6bd4\u65f6\u95f4","\u540c\u6bd4","\u73af\u6bd4","\u5bf9\u6bd4\u76f8\u5bf9\u65e5\u671f\uff08\u504f\u79fb\uff09"],Qe=["\u53bb\u5e74","\u4e0a\u6708","\u4e0a\u5468"],Xe={multiple:!1,tags:!1,optionFilterProp:"label",optionLabelProp:"label",showSearch:!1},$e={multiple:!0,tags:!1},et=function(e){function t(t){var a;return(a=e.call(this,t)||this).handleChangeCompareObj=function(e){var t=a.state,n=t.currDate,r=t.selectedObj,i=t.selectedObjList,o=t.dateParamsList;if("NONE"===e&&r.length&&a.setState({selectedObj:[]}),"NONE"!==e&&"SELECT"!==e||0!==o.length)a.setState({compareObj:e});else{for(var s=0;s<i.length;s++)o.push(n);a.setState({compareObj:e,dateParamsList:o})}},a.handleChangeAnalyseObj=function(e){var t=a.state,n=t.selectedObjList,r=t.compareTime,i=t.dateParamsList,o=t.currDate;if(3!==r)a.setState({selectedObjList:e,selectedObj:e});else{if(n.length>e.length){for(var s=-1,l=0;l<n.length;l++)e.includes(n[l])||(s=l);i.splice(s,1)}else i.push(o);a.setState({selectedObjList:e,selectedObj:e,dateParamsList:i})}},a.handleChangeAvgCompareType=function(e){a.setState({avgCompareType:e})},a.handleChangeCompareTime=function(e){var t=a.state,n=t.currDate,r=t.dateRangeType,i=t.selectedObjList,o=t.dateParamsList,s=t.compareObj,l=a.state.compareDate;if(2===e){var c=n[0],u=n[1],p=Z()(u,Ue).diff(Z()(c,Ue),"days");l=[Z()(c,Ue).subtract(p+1,"days").format(Ue),Z()(c,Ue).subtract(1,"days").format(Ue)],a.setState({compareTime:e,compareDate:l})}else if(3===e){if("AVG"===s)a.setState({compareDate:n});else if(0===o.length){for(var d=0;d<i.length;d++)o.push(n);a.setState({compareTime:e,dateParamsList:o})}else if(o.length<i.length)for(var h=i.length-o.length,f=0;f<h;f++)o.push(n)}else 1===e&&a.handleChangeDateRangeType(r);a.setState({compareTime:e})},a.handleChangeDateRangeType=function(e){var t=a.state.currDate,n=t[0],r=t[1],i=[];switch(e){case 0:i=[Z()(n,Ue).subtract(1,"years").format(Ue),Z()(r,Ue).subtract(1,"years").format(Ue)];break;case 1:i=[Z()(n,Ue).subtract(1,"months").format(Ue),Z()(r,Ue).subtract(1,"months").format(Ue)];break;default:i=[Z()(n,Ue).subtract(1,"weeks").format(Ue),Z()(r,Ue).subtract(1,"weeks").format(Ue)]}a.setState({dateRangeType:e,compareDate:i})},a.handleSetDateParamsList=function(e,t){var n=a.state,r=n.currDate,i=n.dateParamsList,o=r[0],s=r[1],l=Z()(s,Ue).diff(Z()(o,Ue),"days"),c=[e,Z()(e,Ue).add(l,"days").format(Ue)];i[t]=c,a.setState({dateParamsList:i})},a.handleSetCompareDate=function(e){var t=a.state.currDate,n=t[0],r=t[1],i=Z()(r,Ue).diff(Z()(n,Ue),"days"),o=[e,Z()(e,Ue).add(i,"days").format(Ue)];a.setState({compareDate:o})},a.getFormatedAnylyseObjList=function(){for(var e=a.state,t=e.selectedObjList,n=e.analyseObjList,r=[],i=0;i<n.length;i++){var o=n[i],s=o.id,l=o.name;t.includes(l)&&r.push(s)}return r},a.onConfirm=function(){var e=a.state,t=e.compareTime,n=e.compareObj,r=e.selectedObjList,i=e.selectedObj,o=e.dateParamsList,s=e.currDate,l=e.compareDate,c=e.dateRangeType,u=e.avgCompareType;if("SELECT"!==n||0!==i.length){var p={type:"",dateFilters:[],values:[],compareTime:t,dateRangeType:c,compareDate:l,avgCompareType:u,selectedObj:i};p.type=n;var d=a.getFormatedAnylyseObjList();switch(t){case 0:for(var h=0;h<r.length;h++)p.dateFilters.push({from:s[0],to:s[1],dateGroupType:"DAY"});break;case 1:case 2:for(var f=0;f<r.length;f++)p.dateFilters.push({from:l[0],to:l[1],dateGroupType:"DAY"});break;case 3:if("AVG"===n)for(var m=0;m<r.length;m++)p.dateFilters.push({from:l[0],to:l[1],dateGroupType:"DAY"});else for(var g=0;g<o.length;g++){var v=o[g],y=v[0],E=v[1];p.dateFilters.push({from:y,to:E,dateGroupType:"DAY"})}}p.values=d,a.props.getParams(p),a.onCancel()}else se.Z.warning("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5206\u6790\u5bf9\u8c61")},a.onCancel=function(){var e=a.props,t=e.selectedObjList,n=e.compareTime,r=e.dateRangeType,i=e.compareDate,o=e.avgCompareType,s=e.selectedObj;a.setState({show:!1,compareObj:t.length>1?"AVG":s.length?"SELECT":"NONE",avgCompareType:o,compareTime:n,dateRangeType:r,compareDate:i,selectedObj:s})},a.openSettingDialog=function(){a.setState({show:!0})},a.state={show:!1,compareObj:t.selectedObjList.length>1?"AVG":t.selectedObj.length?"SELECT":"NONE",avgCompareType:0,compareTime:t.compareTime||0,dateRangeType:0,currDate:t.currDate||[],compareDate:t.compareDate||[],analyseObjList:t.analyseObjList||[],selectedObjList:t.selectedObjList||[],selectedObj:void 0,dateParamsList:[]},a}(0,n.Z)(t,e);var a=t.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){this.setState((0,c.Z)({},e,{compareObj:e.selectedObjList.length>1?"AVG":e.selectedObj.length?"SELECT":"NONE"}))},a.render=function(){var e=this,t=this.state,a=t.show,n=t.compareObj,i=t.avgCompareType,o=t.compareTime,s=t.dateRangeType,l=t.currDate,p=t.compareDate,d=t.analyseObjList,h=t.selectedObjList,f=t.dateParamsList,m=t.selectedObj,g=this.props.selectedObjList,v=l[0],y=Z()(v,Ue).add(1,"days").format(Ue),E=function(e){return e.isAfter(Z()(y,Ue))};return r.createElement(u.Dialog,{title:"\u540c\u6bd4\u73af\u6bd4\u8bbe\u7f6e",visible:a,customClass:"setting-dialog-wrapper",onCancel:this.onCancel},r.createElement(u.Dialog.Body,null,r.createElement("div",{className:"form-item"},r.createElement("label",null,"\u5bf9\u6bd4\u5bf9\u8c61"),r.createElement(Ie.RS,(0,c.Z)({value:n,onChange:this.handleChangeCompareObj},Xe),Ge.slice(1===g.length?1:0,3).map((function(e,t){return r.createElement(Ie.Wx,{key:t,label:e.label,value:e.value},e.label)})))),"AVG"===n&&r.createElement("div",{className:"form-item"},r.createElement("label",null),r.createElement(Ie.RS,(0,c.Z)({value:i,onChange:this.handleChangeAvgCompareType},Xe),qe.map((function(e,t){return r.createElement(Ie.Wx,{key:t,label:e+"\u7684\u5e73\u5747\u503c",value:t},e+"\u7684\u5e73\u5747\u503c")})))),"SELECT"===n&&r.createElement("div",{className:"form-item"},r.createElement("label",null),r.createElement(Ie.RS,(0,c.Z)({value:m||[],onChange:this.handleChangeAnalyseObj},$e),d&&d.length>0&&d.map((function(e,t){return r.createElement(Ie.Wx,{key:t,label:e.name,value:e.name},e.name)})))),r.createElement("div",{className:"form-item"},r.createElement("label",null,"\u5bf9\u6bd4\u65f6\u95f4"),r.createElement(Ie.RS,(0,c.Z)({value:o,onChange:this.handleChangeCompareTime},Xe),Ke.map((function(e,t){return r.createElement(Ie.Wx,{key:t,label:e,value:t},e)})))),1===o&&r.createElement("div",{className:"form-item"},r.createElement("label",null),r.createElement(Ie.RS,(0,c.Z)({value:s,onChange:this.handleChangeDateRangeType},Xe),Qe.map((function(e,t){return r.createElement(Ie.Wx,{key:t,label:e+"\u540c\u671f",value:t},e+"\u540c\u671f")})))),0!==o&&r.createElement("div",{className:"form-item"},r.createElement("label",null,"\u5f53\u524d"),r.createElement(u.Input,{value:l.join("~"),disabled:!0})),(1===o||2===o)&&r.createElement("div",{className:"form-item"},r.createElement("label",null,"\u5bf9\u6bd4"),r.createElement(u.Input,{value:p.join("~"),disabled:!0})),3===o&&"AVG"===n&&r.createElement("div",{className:"form-item"},r.createElement("label",{title:"\u5bf9\u6bd4"},"\u5bf9\u6bd4"),r.createElement(He,{type:"calendar",value:p,getDateRange:this.handleSetCompareDate,disabledDate:E})),h&&h.length>0&&"AVG"!==n&&h.map((function(t,a){return f[a]?r.createElement("div",{key:a,className:"form-item",style:{display:3===o?"block":"none"}},r.createElement("label",{title:t},t),r.createElement(He,{type:"calendar",value:f[a],getDateRange:e.handleSetDateParamsList,index:a,disabledDate:E})):null})),r.createElement("div",null,r.createElement(u.Button,{type:"primary",onClick:this.onConfirm},"\u786e\u8ba4"),r.createElement(u.Button,{type:"default",onClick:this.onCancel},"\u53d6\u6d88"))))},t}(r.Component);et.propTypes={currDate:ie().array.isRequired,selectedObjList:ie().array,analyseObjList:ie().array,getParams:ie().func.isRequired};var tt=a(25713);const at=function(e){function t(t){var a;(a=e.call(this,t)||this)._handleChartTypeChange=function(e){var t=a.state,n=t.filterParams,r=t.statisticType;if(a.state.chartType!==e){var i={};"c1"===e?(i.rangeClicked="r1",i.rangeObject="negative",i.rangeType=a.state.isR1Desc?"desc":"asc"):"c2"===e?(i.rangeClicked="r2",i.rangeObject="positive",i.rangeType=a.state.isR2Desc?"desc":"asc"):(i.rangeClicked=a.state.rangeClicked,i.rangeObject="r1"===a.state.rangeClicked?"negative":"positive",i.rangeType="negative"===i.rangeObject?a.state.isR1Desc?"desc":"asc":a.state.isR2Desc?"desc":"asc"),a.setState((0,c.Z)({},a._updateTitleValue(n,i.rangeObject,e,r),{chartType:e},i),(function(){return a._updateRefreshData()}))}},a._handleOnRangeClick=function(e){var t={rangeClicked:e};t["is"+e.toUpperCase()+"Desc"]=!a.state["is"+e.toUpperCase()+"Desc"],a.setState((0,c.Z)({rangeType:t["is"+e.toUpperCase()+"Desc"]?"desc":"asc",rangeObject:"r1"===e?"negative":"positive"},t),(function(){return a._updateRefreshData()}))},a._handleOnStatisticChange=function(e){var t=a.state,n=t.filterParams,r=t.rangeObject,i=t.chartType,o=e.type;a.setState((0,c.Z)({},a._updateTitleValue(n,r,i,o),{statisticType:o}),(function(){return a._updateRefreshData()}))},a._updateTitleValue=function(e,t,n,r){var i=a.props.chartType;return{title:""+e.filterModel.analysis.name+(e.filterModel.aspect.aspect1.length>0?"\u4e00\u7ea7\u6307\u6807":"\u4e8c\u7ea7\u6307\u6807")+("emotion"===i&&("c0"===n||"c3"===n||"c4"===n)?"\u60c5\u611f":"positive"===t?"\u6b63\u9762\u60c5\u611f":"\u8d1f\u9762\u60c5\u611f")+"\u5206\u6790-"+Se.find((function(e){return e.type===r})).title}},a._updateRefreshData=function(){var e=a.props.onChange,t=a.state,n=t.chartType,r=t.rangeObject,i=t.rangeType,o=t.statisticType,s=t.showValue,l=t.filterParams,c=t.compareData,u=t.time;e({filterParams:l,compareData:c,controlState:{title:t.title,time:u,chartType:n,rangeObject:r,rangeType:i,statisticType:o,showValue:s}})},a._handleOnFilterChange=function(e){var t=a.props.getParams,n=a.state,r=n.filterParams,i=n.rangeObject,o=n.statisticType,s=n.chartType,l=t(),u=l.dateFilter,p=l.filterModel;if(!e&&r)a.setState({filterParams:{filterModel:(0,c.Z)({},r.filterModel,JSON.parse(JSON.stringify(p))),dateFilter:u},currDate:[u.from,u.to]},(function(){return a._updateRefreshData()}));else if(e){if(!e.analysis||e.analysis.values&&0===e.analysis.values.length)return;if(!e.aspect||0===e.aspect.aspect1.length&&0===e.aspect.aspect2.length)return;if(!e.treeId)return;e.analysis&&"CONNCONFIG"===e.analysis.type&&(e.analysis.type="CONN_CONFIG"),e.analysis&&"EXPANDTOPIC"===e.analysis.type&&(e.analysis.type="EXPAND_TOPIC");var d=a.refs.AnalyzeFilter&&a.refs.AnalyzeFilter.refs.AnalyzeObject.getSecondLevelList();p.connConfig&&(p.connConfig=p.connConfig.map((function(t){return e.analysis.id===t.id&&(t.values=e.analysis.values),t})));var h={dateFilter:u,filterModel:(0,c.Z)({},JSON.parse(JSON.stringify(p)),JSON.parse(JSON.stringify(e)))};a.setState((0,c.Z)({},a._updateTitleValue(h,i,s,o),{objList:d,isMutiObject:h.filterModel.analysis.values&&h.filterModel.analysis.values.length>1,filterParams:h,currDate:[u.from,u.to]}),(function(){return a._updateRefreshData()}))}},a._handleOnMoreClick=function(e){var t=a.props.parentRef;"image"===e?t.refs.chart.refs.bar.downloadImage():"excel"===e?t.refs.chart.refs.bar.downloadExcel():"compare"===e?a.refs.SettingDialog.openSettingDialog():"alert"===e&&a.alertRef.current.wrappedInstance.visibleToggle()},a._handleOnCompareChange=function(e){a.setState({compareData:e},(function(){return a._updateRefreshData()}))},a._handleCommonOptionChange=function(e){var t=(0,c.Z)({},e);if("rangeObject"===Object.keys(e)[0]){var n=a.state,r=n.filterParams,i=n.chartType,o=n.statisticType;t.title=a._updateTitleValue(r,e.rangeObject,i,o).title}a.setState((0,c.Z)({},t),(function(){return a._updateRefreshData()}))},a._handleOnAlertSettingOk=function(){var e=a.state.filterParams;a.setState({filterParams:(0,c.Z)({},e,{dirty:!e.dirty})},(function(){return a._updateRefreshData()}))};var n=t.type.includes("trend")?be:Ce;return a.alertRef=r.createRef(),a.state=(0,c.Z)({},De,{chartTypeOptions:n,title:"...",isMutiObject:!1,filterData:void 0,compareData:void 0,filterParams:void 0,currDate:[],objList:void 0,isR1Desc:!0,isR2Desc:!0,rangeClicked:"r1"}),a}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.model,n=t.projectId,i=t.type,o=t.chartType,s=t.getParams,l=this.state,c=l.chartType,u=l.rangeObject,p=l.showValue,d=l.chartTypeOptions,h=l.time,f=l.title,m=l.objList,g=l.currDate,v=(l.filterParams,l.compareData),y="c0"===c,E="c1"===c,C="c2"===c,b="c10"===c,S=JSON.parse(JSON.stringify(we));"emotion"===o?(E?S[0].options=[{key:"negative",value:"\u8d1f\u9762\u9ad8\u5230\u4f4e"}]:C&&(S[0].options=[{key:"positive",value:"\u6b63\u9762\u9ad8\u5230\u4f4e"}]),y||b||(S=S.filter((function(e){return"showValue"!==e.type}))),b&&(S=S.filter((function(e){return"rangeObject"!==e.type})))):"trend"===o&&(S=S.filter((function(e){return"rangeObject"!==e.type})));var O="emotion"===o&&b||"trend"===o,w=O?xe:xe.filter((function(e){return"compare"!==e.type})),T=i.includes("time");return r.createElement("div",{className:"analysis-haeder-container"},r.createElement("div",{className:"title-zone"},r.createElement("span",{className:"title"},f)),r.createElement("div",{className:"control-pad"},r.createElement(Ee,{ref:"AnalyzeFilter",onChange:this._handleOnFilterChange,model:a,projectId:n,type:"trend"===o?o:void 0,getParams:s}),r.createElement(ke,{onStatisticChange:this._handleOnStatisticChange}),O&&r.createElement(Pe.Z,{objName:"rangeObject",activeObj:u,onChange:this._handleCommonOptionChange,options:Te}),T&&r.createElement(Pe.Z,{objName:"time",activeObj:h,onChange:this._handleCommonOptionChange,options:Ne}),r.createElement("span",{className:"chart-type-btns-wrapper"},Object.keys(d).map((function(t){return r.createElement(D.Z,{key:t,placement:"top",overlay:d[t][2]},r.createElement("span",{style:{paddingTop:10}},r.createElement(Ae.Z,{onClick:function(){return e._handleChartTypeChange(t)},isActive:c===t,defaultIcon:d[t][0],activeIcon:d[t][1]})))}))),r.createElement("span",{className:"chart-type-btns-no-divider-wrapper"},r.createElement(D.Z,{placement:"top",overlay:"\u8bbe\u7f6e"},r.createElement("span",{style:{paddingTop:10}},r.createElement(Le,{options:S,onChange:this._handleCommonOptionChange,chosenOptions:{rangeObject:u,showValue:p}})))),r.createElement("span",{className:"chart-type-btns-no-divider-wrapper"},r.createElement(D.Z,{placement:"top",overlay:"\u66f4\u591a"},r.createElement("span",{style:{paddingTop:10}},r.createElement(tt.Z,{options:w,onClick:this._handleOnMoreClick})))),r.createElement(et,{ref:"SettingDialog",selectedObj:v&&v.selectedObj?v.selectedObj:[],selectedObjList:m?m.valueList.map((function(e){return e.name})):[],analyseObjList:m?m.list:[],currDate:g,compareTime:v?v.compareTime:0,dateRangeType:v?v.dateRangeType:0,compareDate:v?v.compareDate:[],avgCompareType:v?v.avgCompareType:0,getParams:this._handleOnCompareChange})))},t}(r.PureComponent);var nt=a(70596),rt=a.n(nt),it=a(33905),ot=a(93776),st=function(e,t,a){var n={borderRadius:"11px",color:"#8c8c8c"};return 0===a?(n.backgroundColor="#D96969",n.color="#ffffff"):1===a?(n.backgroundColor="#D3A615",n.color="#ffffff"):2===a&&(n.backgroundColor="#1574B3",n.color="#ffffff"),r.createElement("div",{style:(0,c.Z)({},n,{display:"inline-block",width:20,height:20})},a+1)},lt=function(e,t,a){return function(n,i,o){var s="normal"===e?i.prop:e||i.prop,l=n[s]||a[o][s],c=0;return l>0&&(c="s1"===t?(0,it.ao)(l):((c=new ot.Decimal(100*l))>.01?c.toFixed(2):c.toExponential(2))+"%"),r.createElement("span",{style:{color:"#8C8C8C"}},c)}},ct=function(e,t){var a=t.chartType,n=t.statisticType,r=t.isMultiple;return t.aspects.map((function(t){var i;return(0,c.Z)(((i={})["\u6307\u6807"]=t,i),e.reduce((function(e,i){var o,s,l,u=i.data.find((function(e){return e.title===t})),p=r?"c1"===a||"c2"===a?((o={})[i.title]=u[(0,it.yc)(n,"c1"===a?"negative":"positive")],o):((s={})[i.title+" \u8d1f\u9762"]=u[(0,it.yc)(n,"negative")],s[i.title+" \u6b63\u9762"]=u[(0,it.yc)(n,"positive")],s):((l={})["\u8d1f\u9762"]=u[(0,it.yc)(n,"negative")],l["\u6b63\u9762"]=u[(0,it.yc)(n,"positive")],l);return(0,c.Z)({},e,p)}),{}))}))},ut=function(e,t,a,n){a.chartType;var i=a.statisticType,o=e[0],s=Object.keys(o).filter((function(e){return"\u6307\u6807"!==e})),l=s.slice(0,3),c=(n?s.slice(2).filter((function(e){return e!==n})):s.slice(3)).map((function(e){return{text:e,value:e}}));return l.reduce((function(a,n,o){var s=o<2?{label:n,prop:n,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return r.createElement("span",{className:"cell-title"},e.label)},render:lt("normal",i,e)}:{label:t||n,prop:n,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return r.createElement("span",{className:"cell-title-more",title:e.label},e.label)},render:lt(t,i,e),filters:c,filterMultiple:!1,className:"other-columns",filterMethod:function(){return!0}};return 2===o&&0===c.length&&delete s.filters,[].concat(a,[s])}),[{label:"\u6392\u5e8f",headerAlign:"center",align:"center",width:50,render:st},{label:"\u6307\u6807",prop:"\u6307\u6807",headerAlign:"center",align:"center",width:100}])},pt=function(e,t,a){var n=a.statisticType,i=e[0],o=Object.keys(i).filter((function(e){return"\u5206\u6790\u5bf9\u8c61"!==e})),s=o.slice(0,3),l=o.slice(3).map((function(e){return{text:e,value:e}}));return s.reduce((function(a,i,s){var c=s<2?{label:i,prop:i,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return r.createElement("span",{className:"cell-title"},e.label)},render:lt("normal",n,e)}:o.length>3?{label:t||i,prop:i,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return r.createElement("span",{className:"cell-title-more",title:e.label},e.label)},render:lt(t,n,e),filters:l,filterMultiple:!1,className:"other-columns",filterMethod:function(){return!0}}:{label:t||i,prop:i,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return r.createElement("span",null,e.label)},render:lt(t,n,e)};return[].concat(a,[c])}),[{label:"\u6392\u5e8f",headerAlign:"center",align:"center",width:50,render:st},{label:"\u5206\u6790\u5bf9\u8c61",prop:"\u5206\u6790\u5bf9\u8c61",headerAlign:"center",align:"center",width:100}])},dt=function(e,t,a){var n=a.statisticType,i=e[0],o=Object.keys(i).filter((function(e){return"\u65e5\u671f"!==e})),s=o.slice(0,3),l=o.slice(2).map((function(e){return{text:e,value:e}}));return l=t?l.filter((function(e){return e.text!==t})):l.slice(1),s.reduce((function(a,i,s){var c=o.length<=3||s<2?{label:i,prop:i,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return r.createElement("span",{className:"cell-title"},e.label)},render:lt("normal",n,e)}:{label:t||i,prop:i,headerAlign:"center",align:"center",width:100,renderHeader:function(e){return r.createElement("span",{className:"cell-title-more",title:e.label},e.label)},render:lt(t,n,e),filters:l,filterMultiple:!1,className:"other-columns",filterMethod:function(){return!0}};return[].concat(a,[c])}),[{label:"\u65e5\u671f",prop:"\u65e5\u671f",headerAlign:"center",align:"center",width:100}])};const ht=function(e){function t(t){var a;return(a=e.call(this,t)||this).refreshTable=function(e,t){var n,r,i=t.chartType,o=a.props.type,s=i!==a.state.chartType||JSON.stringify(n)!==JSON.stringify(a.state.tableDatas)?void 0:a.state.tableDTDefaultFilter;"emotion"===o?"c10"!==i?(n=ct(e,t),r=ut(n,s,t)):(n=function(e,t){var a=t.rangeObject,n=t.statisticType;return e.map((function(e){var t;return e.data.reduce((function(e,t){var r;return(0,c.Z)({},e,((r={})[t.title]=t[(0,it.yc)(n,a)],r))}),((t={})["\u5206\u6790\u5bf9\u8c61"]=e.title,t))}))}(e,t),r=pt(n,s,t)):"trend"===o&&(n=function(e,t){var a=t.statisticType,n=t.rangeObject,r=e.filter((function(e){return"solid"===e.type}));return r[0].data.map((function(e){return e.title})).map((function(e){var t;return(0,c.Z)(((t={})["\u65e5\u671f"]=e,t),r.reduce((function(t,r){var i,o=r.data.find((function(t){return t.title===e}));if(!o)return(0,c.Z)({},t);var s=((i={})[r.title]=o[(0,it.yc)(a,n)],i);return(0,c.Z)({},t,s)}),{}))}))}(e,t),r=dt(n,s,t)),a.setState({chartData:e,mOption:t,tableDatas:n,columns:r})},a._handleOnFilterChange=function(e){var t,n=a.state,r=n.tableDatas,i=n.mOption,o=i.chartType,s=a.props.type,l=Object.values(e)[0];"emotion"===s?t="c10"!==o?ut(r,l,i,l):pt(r,l,i):"trend"===s&&(t=dt(r,l,i)),a.setState({columns:t})},a.state={tableDTDefaultFilter:void 0,tableDatas:[],option:{},columns:[],chartData:[]},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidUpdate=function(){},a.render=function(){var e=this.state,t=e.columns,a=e.tableDatas,n=e.mOption;return 0!==a.length?r.createElement(u.Table,{className:"analysis-table-style",id:"table",border:!1,onFilterChange:this._handleOnFilterChange,maxHeight:n.chartHeight,columns:t,data:a}):null},t}(r.PureComponent);var ft="negative",mt="positive",gt={c1:"NEGATIVE",c2:"POSITIVE"},vt=function(e){return{symbol:["none","none"],label:{position:"start",formatter:function(t){return"s1"===e?Math.abs(t.value):100*Math.abs(t.value)+"%"}}}},yt={color:"#262626",fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"},Et={textStyle:yt,grid:{left:80,right:40,bottom:it.kQ.marginBottom,top:it.kQ.marginTop,splitLine:{show:!1}},legend:{type:"scroll",data:[],show:!0,itemWidth:11,itemHeight:11,pageIconSize:12},tooltip:{trigger:"axis",padding:10,axisPointer:{type:"none"},textStyle:yt,backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);"},xAxis:{type:"value",axisTick:!1,axisLine:{lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1},axisLabel:{interval:0}},yAxis:{inverse:!0,triggerEvent:!0,type:"category",axisTick:!1,axisLine:{lineStyle:{color:"#EBEBEB"}},axisLabel:{interval:0}},series:[]},Ct=function(e,t,a){return e?"c1"===t?it.t7[a]:it.rf[a]:it.ch["c1"===t?0:1]},bt=function(e,t,a,n,r,i,o){var s=r.length>1,l=JSON.parse(JSON.stringify(Et));l.tooltip.formatter=function(e,t,a){return function(n){var r=Array(n.length);return n.forEach((function(a,n){if(a.seriesName.includes("not_show"))r.splice(r.length-1,1);else{var i;if("s2"===t||"s3"===t||"s4"===t||"s5"===t){var o=new ot.Decimal(Math.abs(100*a.data));i=0===a.data?0:(o>.01?o.toFixed(2):o.toExponential(2))+"%"}else"s1"===t&&(i=Math.abs(a.data));var s=""+a.marker+a.seriesName+": "+i;"c0"===e||"c3"===e||"c4"===e||"c5"===e?n%2===0?r[n+1]=s:r[n-1]=s:"c1"!==e&&"c2"!==e||(r[n]=s)}})),(a?a[n[0].axisValue]+"-":"")+n[0].axisValue+"<br/>"+r.join("<br/>")}}(e,n,r[0].aspectRel);var u=0;l.yAxis.data=r[0].data.map((function(e){var t=e.title;return u=u-t.length>0?u:t.length,t})),r.map((function(e){return e.newData=l.yAxis.data.map((function(t,a){return e.data.filter((function(e){return e.title===t}))[0]})),e}));var p=12*u+10;p=p<50?50:p,l.grid.left=p,(s||"c5"===e)&&(l.yAxis.axisTick={show:!0,inside:!0,length:1e4,lineStyle:{color:"#EBEBEB",type:"dashed"}}),"c0"===e&&(l.title={text:r[0].title,textStyle:{fontSize:16,fontWeight:"bold"}}),l.xAxis.axisLabel.formatter="s1"!==n?function(e){return 0===e?0:Math.abs(100*e)+"%"}:function(e){return Math.abs(e)},l.legend.formatter=function(t){var a=t.lastIndexOf(" ");return s?"c1"===e||"c2"===e?t.substring(0,a):t:t.substring(a+1)};var d=function(e,t,a){var n=JSON.parse(JSON.stringify(it.kQ)),r=n.barWidth,i=n.height,o=n.barCategoryGap,s=n.barGap,l=n.marginBottom,u=n.marginTop,p=.9*document.getElementsByClassName("analysis-index-container")[0].clientHeight,d=parseFloat(s)/100,h=(t*(r=(r="c5"===e?Math.floor((p-o*a)/(a*(2+d))):Math.floor((p/a-o)/(t+(t-1)*d)))<5?5:r>21?21:r)+(t-1)*d*r+o)*a+l+u;return i=h<i?i:h,(0,c.Z)({},n,{barWidth:r,height:i})}(e,r.length,l.yAxis.data.length);l.mOption={rangeObject:t,chartType:e,statisticType:n,isMultiple:s,chartHeight:d.height,aspects:l.yAxis.data};var h=(0,c.Z)({label:{show:"c0"===e&&"yes"===i,position:"right",formatter:function(e){if("s1"===n)return Math.abs(e.data);var t=Math.abs(100*e.data);return 0===e.data?0:(t>.01?t.toFixed(2):t.toExponential(2))+"%"}},type:"bar"},d);if("c1"===e||"c2"===e)l.series=r.map((function(t,a,r){var i=t.title+" "+("c1"===e?"\u8d1f\u9762":"\u6b63\u9762");return l.legend.data.push({name:i,icon:"rect"}),(0,c.Z)({},h,{id:t.id+"-"+("c1"===e?ft:mt),name:i,itemStyle:{color:Ct(s,s?"c2":e,a)},data:t.newData.map((function(t){return t[(0,it.yc)(n,"c1"===e?ft:mt)]}))})})),l.series[0].markLine=(0,c.Z)({},vt(n),{data:o[gt[e]].map((function(t){return{xAxis:t,lineStyle:{normal:{color:"c2"===e?it.ch[1]:it.ch[0],type:"dashed"}}}}))});else{var f,m;"c0"===e||"c3"===e?(f=r.map((function(e,t,a){var r=e.newData.map((function(e){return e[(0,it.yc)(n,mt)]}));return(0,c.Z)({},h,{id:e.id+"-"+mt,name:e.title+" \u6b63\u9762",stack:e.title,itemStyle:{color:Ct(s,"c2",t)},data:r,maxData:Math.max.apply(Math,r)})})),m=r.map((function(e,t){var a=e.newData.map((function(e){return-1*e[(0,it.yc)(n,ft)]}));return(0,c.Z)({},h,{label:(0,c.Z)({},h.label,{position:"left"}),id:e.id+"-"+ft,name:e.title+" \u8d1f\u9762",stack:e.title,itemStyle:{color:Ct(s,"c1",t)},data:a,minData:Math.min.apply(Math,a)})}))):"c4"===e?(f=r.map((function(e,t){return(0,c.Z)({},h,{id:e.id+"-"+mt,name:e.title+" \u6b63\u9762",stack:e.title,itemStyle:{color:Ct(s,"c2",t)},data:e.newData.map((function(e){return e[(0,it.yc)(n,mt)]}))})})),m=r.map((function(e,t){return(0,c.Z)({},h,{id:e.id+"-"+ft,name:e.title+" \u8d1f\u9762",stack:e.title,itemStyle:{color:Ct(s,"c1",t)},data:e.newData.map((function(e){return e[(0,it.yc)(n,ft)]}))})}))):"c5"===e&&(f=r.map((function(e,t){return(0,c.Z)({},h,{id:e.id+"-"+mt,name:e.title+" \u6b63\u9762",itemStyle:{color:Ct(s,"c2",t)},data:e.newData.map((function(e){return e[(0,it.yc)(n,mt)]}))})})),m=r.map((function(e,t){return(0,c.Z)({},h,{id:e.id+"-"+ft,name:e.title+" \u8d1f\u9762",itemStyle:{color:Ct(s,"c1",t)},data:e.newData.map((function(e){return e[(0,it.yc)(n,ft)]}))})})));for(var g=0;g<f.length;g++)l.legend.data.push({name:m[g].name,icon:"rect"}),l.legend.data.push({name:f[g].name,icon:"rect"}),"c0"===e||"c3"===e||"c4"===e?(l.series.push(m[g]),l.series.push(f[g])):"c5"===e&&(l.series.push(f[g]),l.series.push(m[g]));if("c0"===e){var v,y=Math.max.apply(Math,f.map((function(e){return e.maxData}))),E=Math.abs(Math.min.apply(Math,m.map((function(e){return e.minData}))));v=0===y&&0===E?"s1"===n?2:1:y===E||E>y?1.1*E:"s1"===n&&1===y?2:y,l.series.push((0,c.Z)({},h,{itemStyle:{normal:{color:"rgba(0,0,0,0)"}},name:"not_show_neg",silent:!0,barGap:"-100%",label:{show:!1},data:l.yAxis.data.map((function(e){return-v}))})),l.series.push((0,c.Z)({},h,{itemStyle:{normal:{color:"rgba(0,0,0,0)"}},name:"not_show_pos",silent:!0,barGap:"-100%",label:{show:!1},data:l.yAxis.data.map((function(e){return v}))}))}l.series[0].markLine=(0,c.Z)({},vt(n),{data:["POSITIVE","NEGATIVE"].reduce((function(e,t){return[].concat(e,o[t].map((function(e){return{xAxis:"s1"===n?e:parseFloat(e.substring(0,e.length-1))/100*("POSITIVE"===t?1:-1),label:{normal:{show:"yes"===i}},lineStyle:{normal:{color:"POSITIVE"===t?it.ch[1]:it.ch[0],type:"dashed"}}}})))}),[])})}return l},St=function(e,t,a,n,r,i,o,s){var l=n[0],c=l.maxList,u=(0,it.yc)(a,t),p=l.data.map((function(e){return e.title})),d="s1"===a?"positive"===t?l.maxPositive:l.maxNegative:1;d=0===d?1:d>1?Math.ceil(1.2*d):1.2*d;var h=i[t.toUpperCase()],f=""+it.ch["negative"===t?0:1],m={color:it.rf,grid:{left:80,right:40,bottom:it.kQ.marginBottom,top:it.kQ.marginTop},tooltip:{textStyle:yt,padding:10,backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",enterable:!0,extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);max-height:530px;overflow-y:auto;",position:function(e,t,a,n,r){return p.length>15?[e[0]+10,"1%"]:[e[0]+10,e[1]]},formatter:function(e){return p.reduce((function(t,n,r){var i=e.value[r];if("s1"!==a){var o=new ot.Decimal(100*i);i=0===i?0:(o>.01?o.toFixed(2):o.toExponential(2))+"%"}return[].concat(t,['<span style="display: inline-block; min-width: 100px;">'+n+"\uff1a"+i+"</span>"])}),""+e.marker+e.name).join("<br/>")}},legend:{data:n.map((function(e){return{name:e.title,icon:"solid"===e.type?"roundRect":"pin"}})),type:"scroll",show:!0,left:0,right:45,itemWidth:11,itemHeight:3},radar:{splitArea:{show:!0},center:["50%","55%"],splitLine:{lineStyle:{color:"#C1C1C1"}},axisLine:{lineStyle:{color:"#C1C1C1"}},indicator:p.map((function(e){return{name:e,max:c[u][e]}}))},series:[{id:"-"+t,type:"radar",data:[].concat(n.map((function(e,t){return{value:p.map((function(t){return e.data.filter((function(e){return e.title===t}))[0][u]})),name:e.title,label:{show:t===o&&t!==s},lineStyle:{normal:{type:e.type,opacity:.7},emphasis:{type:e.type,opacity:1}},areaStyle:{normal:{opacity:0===t?.1:0}}}})),h.map((function(e){return e<d?{value:p.map((function(t){return e})),silent:!0,name:("negative"===t?"\u8d1f\u9762\u60c5\u611f":"\u6b63\u9762\u60c5\u611f")+"\u9884\u8b66\u7ebf",symbol:"yes"===r?"pin":"none",label:{normal:{fontSize:10,show:"yes"===r,color:f+"aa",formatter:function(e){return 0===e.value?0:e.value>1?e.value:100*e.value+"%"}}},lineStyle:{normal:{color:f,type:"dotted",opacity:.5}}}:{}})))}],mOption:{chartHeight:.6*document.getElementsByClassName("analysis-index-container")[0].clientHeight,statisticType:a,chartType:e,isMultiple:!0,rangeObject:t,aspects:p}};return m},Ot=function(e){function t(t){var n;return(n=e.call(this,t)||this).downloadImage=function(){var e=n.props.refreshState,t=e.chartType,a=e.title;setTimeout((function(){if("c0"===t){if(0===n.charts.length)return;if(n.charts.length>1){var e=n.charts.map((function(e){return e.getOption().title[0].text}));(0,te.OH)(n.charts,a,e)}else{var r=n.charts[0];(0,te._v)(r,r.getOption().title[0].text)}}else(0,te._v)(n.chart,a)}),0)},n.downloadExcel=function(){var e,t=n.props.refreshState,a=t.title,r=t.chartType,i=t.chartData;e="c0"===r?ct(i,(0,c.Z)({},n.mOption,{isMultiple:!0})):n.refs.analysisTable.state.tableDatas;var o=[""].concat(e).map((function(e,t,a){return 0===t?Object.keys(a[1]):Object.values(a[t])}));(0,te.aT)([o],a)},n._renderMutilChart=function(){var e=n.props.refreshState.chartData;return r.createElement("ul",null,e.map((function(e,t,a){return r.createElement("li",{key:t,className:"divided-chart half-width"},r.createElement("div",{className:"divided-analysis-chart"},r.createElement("div",{id:""+n.state.barId+t,style:{width:"100%",minHeight:it.kQ.height}})))})))},n._renderSigleChart=function(){return r.createElement("div",{className:"analysis-chart"},r.createElement("div",{className:"analysis-bar"},r.createElement("div",{id:n.state.barId,style:{width:"100%",minHeight:it.kQ.height}})),r.createElement("div",{className:"analysis-table"},r.createElement(ht,{ref:"analysisTable",type:"emotion"})))},n._renderEmpty=function(){return r.createElement("div",{className:"no-data"},r.createElement("img",{src:a(3381)}),r.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e"))},n.mOption=void 0,n.state={barId:t.model+"-"+t.type+"-"+t.refreshState.chartType+"-chart",lastIndex:void 0},n.chart=void 0,n.charts=[],n}(0,n.Z)(t,e);var i=t.prototype;return i._refreshChart=function(){var e=this,t=this.props.refreshState,a=t.chartType,n=t.rangeObject,r=(t.rangeType,t.statisticType),i=t.chartData,o=t.showValue,s=t.warningList;if(i)if("c0"===a)this.charts=this.charts.slice(0,i.length),i.forEach((function(t,i){var l=bt(a,n,0,r,[t],o,s),c=e.charts[i];c&&(c.clear(),c.dispose()),(c=rt().init(document.getElementById(""+e.state.barId+i))).on("click",(function(t){return e.props.onChartClick(t)})),c.setOption(l),c.resize({width:"auto",height:l.mOption.chartHeight}),e.mOption=l.mOption,e.charts[i]=c}));else{var l="c10"===a?St(a,n,r,i,o,s):bt(a,n,0,r,i,o,s);this.chart&&(this.chart.clear(),this.chart.dispose()),this.chart=rt().init(document.getElementById(this.state.barId)),"c10"!==a&&this.chart.on("click",(function(t){return e.props.onChartClick(t)})),this.chart.on("click",(function(t){var l=t.dataIndex,c=e.state.lastIndex,u="c10"===a&&St(a,n,r,i,o,s,l,c);u&&e.chart.setOption(u),l===e.state.lastIndex?e.setState({lastIndex:void 0}):e.setState({lastIndex:l})})),this.chart.setOption(l),this.chart.resize({width:"auto",height:l.mOption.chartHeight}),this.mOption=l.mOption,this.refs.analysisTable.refreshTable(i,l.mOption)}},i.componentDidUpdate=function(e){JSON.stringify(e.refreshState)!==JSON.stringify(this.props.refreshState)&&this._refreshChart()},i.resize=function(){this.chart&&this.chart.resize(),this.charts&&this.charts instanceof Array&&this.charts.forEach((function(e){return e.resize()}))},i.render=function(){var e=this.props.refreshState,t=e.chartData,a=e.chartType;return r.createElement("div",{className:"analysis-bar-container"},t?t.length>0?"c0"===a?this._renderMutilChart():this._renderSigleChart():this._renderEmpty():null)},t}(r.Component),wt=["\u65e0\u65f6\u95f4\u6bd4","\u540c\u6bd4","\u73af\u6bd4","\u76f8\u5bf9\u65f6\u95f4"],Tt=function(e){function t(t){var a;return(a=e.call(this,t)||this).setMaxList=function(e){var t=e[0],a=Object.keys(t.data[0]).filter((function(e){return"title"!==e})),n=t.data.map((function(e){return e.title})),r=a.reduce((function(t,a){var r;return(0,c.Z)({},t,((r={})[a]=n.reduce((function(t,n){var r;return(0,c.Z)({},t,((r={})[n]=Math.max.apply(Math,e.map((function(e){return e.data.find((function(e){return e.title===n}))[a]}))),r))}),{}),r))}),{});t.maxList=r},a.setAspectList=function(e,t){var n=JSON.parse(JSON.stringify(e)),r=a.props.headerRef;if(n.filterModel.aspect.aspect2.length>0){var i=n.filterModel.aspect.aspect2,o=JSON.parse(ee.t.get(ee.V.aspect)),s=Object.keys(o).reverse(),l=Object.values(o).reverse(),u=-1,p=i.reduce((function(e,t){var a,n;return-1!==u&&l[u].includes(t)?(0,c.Z)({},e,((n={})[t]=s[u],n)):(u=l.findIndex((function(e){return e.includes(t)})),(0,c.Z)({},e,((a={})[t]=s[u],a)))}),{});t.forEach((function(e){e.aspectRel=p}))}else{var d=t[0].data.map((function(e){return e.title}));r&&r.refs.AnalyzeFilter.refs.AnalyzeIndex.orderAspect(d)}},a.refresh=function(e){var t=a.props,n=t.projectId,r=t.refreshData,i=t.onLoading,o=t.model,l=r.controlState,u=l.rangeObject,p=l.rangeType,d=l.statisticType,h=(0,c.Z)({projectId:n,name:o,otherInfo:Object.keys(Ce).map((function(e){return"emotion-"+e}))},e,{type:"RADAR_CHART"});i(!0),s.h.post("/analysis/data",h).then((function(e){var t=e.data,n=[];2e4===t.code&&(n=t.result.list.map((function(e){return(0,c.Z)({},e,{type:"solid"})})),n=(0,it.KT)(u,p,d,n),a.setMaxList(n),a.setAspectList(h,n)),a.setState({filterModel:JSON.parse(JSON.stringify(h.filterModel)),dateFilter:JSON.parse(JSON.stringify(h.dateFilter)),chartData:n,warningData:t.result.warningTypeData,cChartData:n.slice()},(function(){return i(!1)}))}))},a.fetchCompareData=function(e){var t=e.dateFilters,n=e.values,r=e.type,i=e.compareTime,o="AVG"!==r?"-"+wt[i]:"",l=a.props,u=l.projectId,p=l.refreshData,d=l.onLoading,h=a.state,f=h.filterModel,m=h.chartData,g=p.controlState,v={projectId:u,dateFilters:t,filterModel:(0,c.Z)({},f,{analysis:(0,c.Z)({},f.analysis,{values:n})}),type:"RADAR_CHART",compareType:r};d(!0),s.h.post("/widget/data/compare/find/RADAR_CHART",v).then((function(e){var t=e.data,n=[].concat(m);2e4===t.code&&(n=[].concat(n,t.result.list.map((function(e){return(0,c.Z)({},e,{title:""+e.title+o,type:"dashed"})}))),n=(0,it.KT)(g.rangeObject,g.rangeType,g.statisticType,n),a.setMaxList(n),a.setAspectList(v,n)),a.setState({cChartData:n,cFilterModel:v.filterModel,cDateFilter:v.dateFilters},(function(){return d(!1)}))}))},a._handleOnChartClick=function(e){var t=e.componentType;"yAxis"===t?a._handleYAxisClick(e):"series"===t&&a._handleBarClick(e)},a._handleYAxisClick=function(e){var t=e.value,n=a.props.headerRef,r=a.state,i=r.filterModel,o=r.dateFilter;if(t)if(a.lastAspectObj)n&&n.refs.AnalyzeFilter.refs.AnalyzeIndex.setAspectFromOutside(a.lastAspectObj),a.refresh({filterModel:(0,c.Z)({},i,{aspect:(0,c.Z)({},a.lastAspectObj)}),dateFilter:o}),a.lastAspectObj=void 0;else{var s=n.refs.AnalyzeFilter.refs.AnalyzeIndex.getSndIndex(t);s&&s.length>0&&(a.lastAspectObj=i.aspect,a.refresh({filterModel:(0,c.Z)({},i,{aspect:{aspect1:[],aspect2:JSON.parse(JSON.stringify(s))}}),dateFilter:o}))}},a._handleBarClick=function(e){var t=e.seriesId,n=e.seriesName,r=e.data,i=e.name,o=e.dataIndex,s=a.state,l=s.filterModel,u=s.dateFilter,p=s.chartData,d=a.props,h=d.name,f=d.projectId,m=t.split("-"),g=m[0],v=m[1],y=n.lastIndexOf(" "),E={projectId:f,leftName:h,analyseName:-1!==y?n.substring(0,y):n,type:"EMOTION_ASPECT_LEVEL_BAR",aspect:i,aspectTotal:r,seriesName:"positive"===v?"\u6b63\u9762":"\u8d1f\u9762",dateFilter:(0,c.Z)({},u),analysisObjs:p.map((function(e){return e.id})),filterModel:(0,c.Z)({},l,{analysis:(0,c.Z)({},l.analysis,{values:[void 0!==g?g:p[o].id]}),aspect:{aspect1:l.aspect.aspect1.filter((function(e){return e===i})),aspect2:l.aspect.aspect2.filter((function(e){return e===i})),emotion:[v]}})};window.open("/tab/detail?"+encodeURIComponent(JSON.stringify(E)))},a.state={filterModel:void 0,dateFilter:void 0,chartData:void 0,diffData:void 0,cChartData:void 0,warningData:void 0,loading:!0},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this.props.refreshData.filterParams;this.refresh(e)},a.componentDidUpdate=function(e,t){var a=this.props,n=a.refreshData,r=(a.onLoading,e.refreshData),i=e.headerRef,o=t.filterModel,s=n.controlState,l=n.filterParams,c=n.compareData,u=r.controlState,p=r.filterParams,d=r.compareData,h=this.state,f=h.filterModel,m=h.chartData;if(s.rangeObject!==u.rangeObject||s.rangeType!==u.rangeType||s.statisticType!==u.statisticType){var g=(0,it.KT)(s.rangeObject,s.rangeType,s.statisticType,m);if(f.aspect.aspect1.length>0){var v=g[0].data.map((function(e){return e.title}));i&&i.refs.AnalyzeFilter.refs.AnalyzeIndex.orderAspect(v)}this.setState({chartData:g})}JSON.stringify(l)!==JSON.stringify(p)&&(l.filterModel.aspect.aspect1.length>0&&o&&o.aspect.aspect2.length>0&&(this.lastAspectObj=void 0),this.refresh(l)),JSON.stringify(c)!==JSON.stringify(d)&&this.fetchCompareData(c)},a.render=function(){var e=this.props,t=e.model,a=e.refreshData.controlState,n=this.state,i=n.chartData,o=n.cChartData,s=n.warningData,l="c10"===a.chartType?o:i,u=s?s["emotion-"+a.chartType][Oe[a.statisticType]]:{POSITIVE:[],NEGATIVE:[]};return r.createElement(Ot,{type:"emotion",onChartClick:this._handleOnChartClick,model:t,refreshState:(0,c.Z)({},a,{chartData:l,warningList:u}),ref:"bar"})},t}(r.Component);const Nt=Tt;const xt=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleOnChange=function(e){a.setState({refreshData:e})},a._handleOnLoading=function(e){a.setState({loading:e})},a.state={refreshData:void 0,loading:!1},a}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this.state,t=e.refreshData,a=e.loading,n=this.props.headerReady;return r.createElement(u.Loading,{loading:!n||a,className:"analysis-bar-chart-loading",text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},r.createElement("div",{className:"analysis-container"},n&&r.createElement(at,(0,c.Z)({key:"1"},this.props,{type:["emotion"],chartType:"emotion",ref:"Header",parentRef:this,onChange:this._handleOnChange})),t&&r.createElement("div",{style:{display:n&&t?"block":"none"}},r.createElement(Nt,(0,c.Z)({},this.props,{refreshData:t,onLoading:this._handleOnLoading,headerRef:this.refs.Header,ref:"chart"})))))},t}(r.Component);var Dt={color:"#262626",fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"},kt=function(e){function t(t){var n;return(n=e.call(this,t)||this)._renderEmpty=function(){return r.createElement("div",{className:"no-data"},r.createElement("img",{src:a(3381)}),r.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e"))},n.downloadImage=function(){var e=n.props.refreshState.title;(0,te._v)(n.chart,e)},n.downloadExcel=function(){var e=n.props.refreshState.title,t=n.refs.analysisTrendTable.state.tableDatas,a=[""].concat(t).map((function(e,t,a){return 0===t?Object.keys(a[1]):Object.values(a[t])}));(0,te.aT)([a],e)},n._renderChart=function(){return r.createElement("div",{className:"analysis-chart"},r.createElement("div",{className:"analysis-bar"},r.createElement("div",{id:n.state.barId,style:{width:"100%",minHeight:it.kQ.height}})),r.createElement("div",{className:"analysis-table"},r.createElement(ht,{ref:"analysisTrendTable",type:"trend"})))},n.state={barId:t.model+"-"+t.type+"-"+t.refreshState.chartType+"-chart"},n.chart=void 0,n}(0,n.Z)(t,e);var i=t.prototype;return i._refreshChart=function(){var e=this,t=this.props.refreshState,a=t.chartType,n=t.rangeObject,r=(t.rangeType,t.statisticType),i=t.chartData,o=t.showValue;if(i){var s=function(e,t,a,n,r){var i=(0,it.yc)(a,t),o=n[0].data.map((function(e){return e.title})),s={textStyle:Dt,color:it.rf,grid:{left:80,right:40,bottom:it.kQ.marginBottom+50,top:it.kQ.marginTop+20},tooltip:{textStyle:Dt,trigger:"axis",padding:10,backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);",formatter:function(e){return e.reduce((function(e,t){var n=t.value;return n=0===n?0:"s1"===a||0===n?n:(100*n).toFixed(2)+"%",[].concat(e,['<span style="display: inline-block; min-width: 100px;">'+t.marker+t.seriesName+"\uff1a"+n+"</span>"])}),e[0].axisValueLabel).join("<br/>")}},legend:{data:n.map((function(e){return{name:e.title,icon:"solid"===e.type?"roundRect":"pin"}})),type:"scroll",show:!0,left:0,right:45,itemWidth:11,itemHeight:3},xAxis:{type:"category",boundaryGap:!1,data:o},yAxis:{type:"value",splitLine:{show:!1},axisLabel:{interval:0}},dataZoom:[{type:"inside"},{type:"slider"}],series:[].concat(n.map((function(e,t){return{type:"line",symbol:"yes"===r?"circle":"none",name:e.title,label:{normal:{show:"yes"===r,position:"top",formatter:function(e){return 0===e.value?0:e.value>1?e.value:(100*e.value).toFixed(2)+"%"}}},data:e.data.map((function(e){return Number.isInteger(e[i])?e[i]:Math.round(1e4*e[i])/1e4})),lineStyle:{normal:{type:e.type}}}}))),mOption:{chartHeight:.6*document.getElementsByClassName("analysis-index-container")[0].clientHeight,statisticType:a,rangeObject:t,chartType:e,isMultiple:!0,titles:o}};return"s1"!==a&&(s.yAxis.axisLabel.formatter=function(e){return 0===e?0:(Number.isInteger(100*e)?100*e:(100*e).toFixed(2))+"%"}),s}(a,n,r,i,o);this.chart&&(this.chart.clear(),this.chart.dispose()),this.chart=rt().init(document.getElementById(this.state.barId)),this.chart.on("click",(function(t){return e.props.onChartClick(t)})),this.chart.setOption(s),this.chart.resize({width:"auto",height:s.mOption.chartHeight}),this.refs.analysisTrendTable.refreshTable(i,s.mOption)}},i.componentDidUpdate=function(e){JSON.stringify(e.refreshState)!==JSON.stringify(this.props.refreshState)&&this._refreshChart()},i.resize=function(){this.chart&&this.chart.resize(),this.charts&&this.charts instanceof Array&&this.charts.forEach((function(e){return e.resize()}))},i.render=function(){var e=this.props.refreshState.chartData;return r.createElement("div",{className:" analysis-trend-container "},e?e.length>0?this._renderChart():this._renderEmpty():null)},t}(r.PureComponent);const _t=kt;var At=["\u65e0\u65f6\u95f4\u6bd4","\u540c\u6bd4","\u73af\u6bd4","\u76f8\u5bf9\u65f6\u95f4"];const Mt=function(e){function t(t){var a;return(a=e.call(this,t)||this).activeRefresh=function(){var e=a.props.refreshData.filterParams;a.refresh(e)},a.refresh=function(e){var t=a.props,n=t.projectId,r=t.refreshData,i=t.onLoading;t.model;if(r){var o=r.controlState,l=(0,c.Z)({projectId:n},e,{dateFilter:(0,c.Z)({},e.dateFilter,{dateGroupType:o.time}),type:"ASPECT_TREND_LINE"});i(!0),s.h.post("/widget/data/find/ASPECT_TREND_LINE",l).then((function(e){var t=e.data,n=[];2e4===t.code&&(n=t.result.list.map((function(e){return(0,c.Z)({},e,{type:"solid"})}))),a.setState({filterModel:l.filterModel,dateFilter:l.dateFilter,chartData:n},(function(){return i(!1)}))}))}},a.fetchCompareData=function(e){var t=e.dateFilters,n=e.values,r=e.type,i=e.compareTime,o="AVG"!==r?"-"+At[i]:"",l=a.props,u=l.projectId,p=l.onLoading,d=a.state,h=d.filterModel,f=d.chartData,m={projectId:u,filterModel:(0,c.Z)({},h,{analysis:(0,c.Z)({},h.analysis,{values:n})}),dateFilters:t,type:"ASPECT_TREND_LINE",compareType:r};p(!0),s.h.post("/widget/data/compare/find/ASPECT_TREND_LINE",m).then((function(e){var t=e.data,n=[].concat(f.filter((function(e){return"solid"===e.type})));2e4===t.code&&"NONE"!==r&&(n=[].concat(f,t.result.list.map((function(e){return(0,c.Z)({},e,{title:""+e.title+o,type:"dashed"})})))),a.setState({chartData:n},(function(){return p(!1)}))}))},a.state={filterModel:void 0,dateFilter:void 0,chartData:void 0,loading:!0},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidUpdate=function(e){var t=this.props.refreshData,a=e.refreshData,n=t.controlState,r=t.filterParams,i=t.compareData,o=a.controlState,s=a.filterParams,l=a.compareData;JSON.stringify(r)===JSON.stringify(s)&&n.time===o.time||this.refresh(r),JSON.stringify(i)!==JSON.stringify(l)&&this.fetchCompareData(l)},a.render=function(){var e=this.props,t=e.model,a=e.refreshData.controlState,n=this.state.chartData;return r.createElement(_t,{ref:"bar",type:"trend",model:t,refreshState:(0,c.Z)({},a,{chartData:n})})},t}(r.PureComponent);const Lt=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleOnChange=function(e){a.setState({refreshData:e})},a._handleOnLoading=function(e){a.setState({loading:e})},a.state={refreshData:void 0,loading:!1},a}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this.state,t=e.refreshData,a=e.loading,n=this.props.headerReady;return r.createElement(u.Loading,{loading:!n||a,className:"analysis-trend-chart-loading",text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},r.createElement("div",{className:"analysis-container"},n&&r.createElement(at,(0,c.Z)({},this.props,{ref:"Header",key:"2",type:["emotion","time","trend"],chartType:"trend",parentRef:this,onChange:this._handleOnChange})),t&&r.createElement("div",{style:{display:n&&t?"block":"none"}},r.createElement(Mt,(0,c.Z)({},this.props,{refreshData:t,onLoading:this._handleOnLoading,headerRef:this.refs.Header,ref:"chart"})))))},t}(r.PureComponent);const Pt=function(e){function t(t){var a;return(a=e.call(this,t)||this).refreshChart=function(e){a.refs.overViewChart.refreshChart(e),a.props.headerReady&&(a.refs.analysisChart&&a.refs.analysisChart.refs.Header&&a.refs.analysisChart.refs.Header._handleOnFilterChange(),a.refs.analysisTrendChart&&a.refs.analysisTrendChart.refs.Header&&a.refs.analysisTrendChart.refs.Header._handleOnFilterChange())},a.resize=function(){a.refs.overViewChart&&a.refs.overViewChart.resize(),a.refs.analysisChart&&a.refs.analysisChart.refs.chart&&a.refs.analysisChart.refs.chart.refs.bar.resize(),a.refs.analysisTrendChart&&a.refs.analysisTrendChart.refs.chart&&a.refs.analysisTrendChart.refs.chart.refs.bar.resize()},a._handleOnTabClick=function(e){"2"!==e.props.name||a.tab2Inited||(a.tab2Inited=!0,a.refs.analysisTrendChart&&a.refs.analysisTrendChart.refs.chart&&a.refs.analysisTrendChart.refs.chart.activeRefresh()),a.resize()},a.tab2Inited=!1,a}return(0,n.Z)(t,e),t.prototype.render=function(){return r.createElement("div",{className:"analysis-index-container",style:{overflow:"scroll",height:"100%"}},r.createElement(ne,(0,c.Z)({},this.props,{ref:"overViewChart"})),r.createElement("div",{className:"divider"}),r.createElement(u.Tabs,{className:"analysis-chart-tab-wrapper",onTabClick:this._handleOnTabClick},r.createElement(u.Tabs.Pane,{label:"\u6b63\u8d1f\u9762\u60c5\u611f\u5bf9\u6bd4",name:"1"},r.createElement(xt,(0,c.Z)({},this.props,{ref:"analysisChart"}))),r.createElement(u.Tabs.Pane,{label:"\u6307\u6807\u8d70\u52bf\u5bf9\u6bd4",name:"2"},r.createElement(Lt,(0,c.Z)({},this.props,{ref:"analysisTrendChart"})))))},t}(r.Component);var It=a(39432);Z().locale("zh-cn");var Rt=["COUNTER_NUM","COUNTER_TIME_STACK_AREA_LINE"],jt=function(e){function t(t){var a;return(a=e.call(this,t)||this).resizeFontSize=function(){var e=.03*a.flexWrapper.offsetWidth;document.getElementById("flexSpan").style.fontSize=e+"px";var t=document.documentElement.clientWidth;a.divider.style.margin=t<1593?"0 4px":"0 16px";for(var n=document.getElementsByClassName("category"),r=0;r<n.length;r++)n[r].style.marginRight="4px"},a.resize=function(){a.flexWrapper&&(a.resizeFontSize(),a.chart&&a.chart.resize())},a.getOption=function(){var e=a.state,t=e.data,n=e.CATEGORY_TITLES,r=function(e){var t=[];return e.forEach((function(e){var a=document.createElement("canvas"),n=a.getContext("2d");document.body.appendChild(a),n.font="14px Arial",document.body.removeChild(a);var r=n.measureText(e);t.push(r.width)})),Math.max.apply(Math,t)},i=r(n.map((function(e){return e.name}))),o=r(n.map((function(e){return It.ZP.formatNumber(e.count)}))),s=i+o;return{title:{padding:[0,0,0,20],text:"\u6570\u636e\u91cf\u8be6\u60c5",textStyle:{fontSize:14}},legend:(0,c.Z)({},$.I.legend,{right:0,top:34,type:"scroll",pageIconSize:12,data:n.map((function(e){return{name:""+e.name,icon:"circle"}})),formatter:function(e){return"{a|"+e+"}{b|"+It.ZP.formatNumber(n.filter((function(t){return t.name===e}))[0].count)+"}"},textStyle:{rich:{a:{width:i},b:{width:o,align:"right"}}}}),grid:(0,c.Z)({},$.I.grid,{right:s+25+32,top:35}),xAxis:(0,c.Z)({},$.I.xAxis,{boundaryGap:!1,axisPointer:{show:!0},data:t[0].list.map((function(e){return e.time}))}),yAxis:(0,c.Z)({},$.I.yAxis,{axisLabel:{show:!0,color:"#999"}}),tooltip:(0,c.Z)({},$.I.tooltip,{trigger:"axis",confine:!0,axisPointer:{type:"cross",label:{backgroundColor:"rgb(0, 0, 0)",margin:10,formatter:function(e){return"number"===typeof e.value?e.value.toFixed(0):e.value}}},formatter:function(e){return e[0].name+e.map((function(e){return"<br/>"+e.marker+e.seriesName+"\uff1a"+e.value})).reverse().join("")}}),series:n.map((function(e,t){return{name:e.name,showSymbol:!1,type:"line",stack:"\u6570\u636e\u6765\u6e90",areaStyle:{color:$.o[t],opacity:1},itemStyle:{normal:{color:$.o[t]}},smooth:.4,smoothMonotone:"none",data:e.data}})).reverse()}},a.clickChart=function(e){if("expandTopic"!==a.state.analyzeObject.type){if(e){var t=a.getParams(e);-1!==location.pathname.indexOf("overview")&&window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(t)))}}else se.Z.warning("\u5f53\u524d\u5206\u6790\u5bf9\u8c61\u4e3a\u7ec4\u5408\u5206\u6790\uff0c\u4e0d\u53ef\u8df3\u8f6c")},a.switchDateDimension=function(e){a.setState({queryTimeType:e,dateDimensionReady:!0},(function(){a.fetchData()}))},a.analyzeObjectChange=function(){!a.analysis||JSON.stringify(a.state.analyzeObject)===JSON.stringify(a.analysis.getValue())&&a.state.analysisObjReady||a.setState({analyzeObject:a.analysis.getValue(),analysisObjReady:!0},(function(){return a.fetchData()}))},a.downloadChart=function(){(0,te._v)(a.chart.chart,"\u6570\u636e\u91cf\u8be6\u60c5\u56fe")},a.getChartData=function(){var e=a.state.data,t=e.map((function(e){return e.name})),n={};e.forEach((function(e){e.list.forEach((function(t){n[t.time]=n[t.time]||{},n[t.time][e.name]=t.total}))}));var r=[],i=function(e){var a=[e];t.forEach((function(t){return a.push(n[e][t])})),r.push(a)};for(var o in n)i(o);t.unshift("\u65e5\u671f"),r.splice(0,0,t),(0,te.aT)([r],"\u6570\u636e\u91cf\u8be6\u60c5\u56fe")},a.state={total:0,today:0,average:0,data:[{}],loading:!0,queryTimeType:{},analyzeObject:{},analysisObjReady:!1,dateDimensionReady:!1},a}(0,n.Z)(t,e);var i=t.prototype;return i.componentDidUpdate=function(e,t){this.flexWrapper&&this.resizeFontSize()},i.formatNum=function(e){return 0<=e&&e<1e3?e:e<1e4?(e/1e3).toFixed(2)+"\u5343":(e/1e4).toFixed(2)+"\u4e07"},i.fetchTotalData=function(){var e=this,t=this.props.getParams();t.filterModel&&(t.filterModel.messageCategory=["COMMENT"]),s.h.post("/widget/data/find",(0,c.Z)({},t,{projectId:ee.t.get(ee.V.curProject).id,type:"COUNTER_NUM"})).then((function(t){var a=JSON.parse(t.data.result);if(a){var n=a.total,r=a.today,i=a.avgDay;e.setState({total:n,today:r,average:i})}}))},i.fetchData=function(){var e=this,t=this.props.getParams(),a=JSON.parse(JSON.stringify(this.state)).analyzeObject;t.dateFilter.dateGroupType=this.state.queryTimeType,this.state.analysisObjReady&&this.state.dateDimensionReady&&t.dateFilter.from&&(a.id&&("connConfig"===a.type?a.type="CONN_CONFIG":"expandTopic"===a.type?a.type="EXPAND_TOPIC":a.type=a.type.toUpperCase(),t.filterModel.analysis=a),this.setState({loading:!0},(function(){return s.h.post("/widget/data/find/COUNTER_TIME_STACK_AREA_LINE",(0,c.Z)({},t,{projectId:ee.t.get(ee.V.curProject).id})).then((function(t){var a=t.data.result.list,n=[];a&&a.length>0&&a.map((function(e){return n.push({id:e.id,name:e.name,count:e.list.map((function(e){return e.total})).reduce((function(e,t){return e+t})),data:e.list.map((function(e){return e.total}))})})),e.setState({data:a,CATEGORY_TITLES:n,loading:!1})}))})))},i.refreshChart=function(){this.fetchTotalData(),this.fetchData()},i.getParams=function(e){var t=this,a=this.state,n=a.CATEGORY_TITLES,r=a.queryTimeType,i=this.props.getParams();if(i.type=Rt[1],i.projectId=ee.t.get(ee.V.curProject).id,e){var o=e.seriesName,s=e.name;if(s){var l=s,c=s;if("MONTH"===r){var u=Z()(s);l=u.startOf("month").format("YYYY-MM-DD"),c=u.endOf("month").format("YYYY-MM-DD")}else if("WEEK"===r){var p=s.split("-"),d=Z()(p[0]).week(p[1]);l=d.startOf("week").format("YYYY-MM-DD"),c=d.endOf("week").format("YYYY-MM-DD")}i.dateFilter.from=l,i.dateFilter.to=c}i.dateFilter.dateGroupType=r,n.forEach((function(e){if(e.name===o)switch(t.state.analyzeObject.type){case"source":i.filterModel.source=[e.id];break;case"connConfig":i.filterModel.connConfig=[{id:t.state.analyzeObject.id,special:"connConfig",values:[e.id]}]}}))}return i},i.render=function(){var e=this,t=this.state,n=t.data,i=t.total,o=t.today,s=t.average,l=t.loading,c=t.queryTimeType;return r.createElement("div",{className:"overviewTopWrapper"},r.createElement(u.Loading,{loading:l,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d",style:{zIndex:10}},n.length>0?r.createElement("div",null,r.createElement("div",{className:"detailChart-top",ref:function(t){return e.flexWrapper=t}},r.createElement("div",null,r.createElement("div",null,r.createElement("span",null,"\u6570\u636e\u91cf"),r.createElement(D.Z,{overlayClassName:"popover-type",placement:"bottomLeft",overlay:"\u6570\u636e\u91cf\u4e3a\u4e00\u5b9a\u7b5b\u9009\u6761\u4ef6\u548c\u65f6\u95f4\u8303\u56f4\u5185\u63d0\u53d6\u5230\u7684\u6709\u6548\u8bc4\u8bba\u6570\uff0c\u4e0d\u5305\u542b\u5df2\u88ab\u201c\u65e0\u6548\u6d88\u606f\u201d\u529f\u80fd\u6807\u8bb0\u7684\u65e0\u6548\u6d88\u606f\u3002"},r.createElement("i",{className:"cem-icon icon-cem_problem",style:{fontSize:20,top:2,position:"relative"}}))),r.createElement("div",{style:{height:"62px"}},r.createElement(D.Z,{placement:"top",overlay:i},r.createElement("span",{id:"flexSpan",style:{fontSize:"50px"}},this.formatNum(i))),r.createElement("span",{style:{color:"#8C8C8C"}},"/ \u603b\u91cf")),r.createElement("div",null,r.createElement("div",null,r.createElement("span",{className:"category"},"\u4eca\u65e5"),r.createElement(D.Z,{placement:"top",overlay:o},r.createElement("span",null,this.formatNum(o)))),r.createElement("div",{ref:function(t){return e.divider=t}},"|"),r.createElement("div",null,r.createElement("span",{className:"category"},"\u65e5\u5747"),r.createElement(D.Z,{placement:"top",overlay:s},r.createElement("span",null,this.formatNum(s)))))),r.createElement("div",{className:"chart-wrapper"},r.createElement("div",{className:"time-btn-wrapper"},r.createElement(I.Z,{style:{float:"right"},onDownChartClick:this.downloadChart,onDownExcelClick:this.getChartData}),r.createElement(P.Z,{defaultValue:c,uniqueId:"overview-top-saved-date-dimension",onChange:this.switchDateDimension,style:{float:"right"}}),r.createElement(de,{ref:function(t){return e.analysis=t},style:{float:"right",marginRight:"12px"},onChange:this.analyzeObjectChange,defaultSelValue:{id:"source"},getParams:this.props.getParams,left:-276})),!l&&r.createElement(X.Z,{ref:function(t){return e.chart=t},uniqueId:"overviewTop",option:this.getOption(),height:166,clickChart:this.clickChart})))):r.createElement("div",{className:"noDataTips"},r.createElement("img",{src:a(3381)}),r.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e"))),r.createElement("div",{className:"dashed-divider"}))},t}(r.Component),Ft=a(63366),Zt=a(55609),Vt=a(8201),zt=a(70715),Bt=a(87300),Wt={n:"\u540d\u8bcd",a:"\u5f62\u5bb9\u8bcd",un:"\u5176\u4ed6"},Yt=[{title:"\u6bd4\u4f8b",value:"rate"},{title:"\u6570\u91cf",value:"count"}],Jt=[{type:"image",title:"\u5bfc\u51fa\u56fe\u7247"},{type:"data",title:"\u5bfc\u51fa\u6570\u636e"},{type:"config",title:"\u504f\u597d\u8bbe\u7f6e"}],Ht=a(18077),Ut=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).chartRef=void 0,t.barDatas=void 0,t.getChartRef=function(e){return t.chartRef=e},t}(0,n.Z)(t,e);var a=t.prototype;return a.renderChart=function(e,t,a){this.setValue(e,a),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,a))},a.setValue=function(e,t){this.barDatas={positiveData:"count"===t?e.sort((function(e,t){return t.positiveCount-e.positiveCount})).slice(0,10):e.sort((function(e,t){return t.posRate-e.posRate})).slice(0,10),negativeData:"count"===t?e.sort((function(e,t){return t.negativeCount-e.negativeCount})).slice(0,10):e.sort((function(e,t){return t.negRate-e.negRate})).slice(0,10)}},a.getOption=function(e,t){var a=this,n={title:{top:20,text:e},grid:[{x:"3%",y:"20%",width:"92%",height:"25%"},{x:"3%",y2:"8%",width:"92%",height:"25%"}],tooltip:{trigger:"axis",showDelay:200,hideDelay:500,enterable:!0,padding:0,position:function(e,t,a,n,r){var i=r.contentSize,o=r.viewSize,s=e[0]<o[0]/2?0:-1,l=e[1]<o[1]/2?-.5:-1;return[e[0]+s*i[0]+(s?-10:10),e[1]+l*i[1]]},formatter:function(e,t,n){return setTimeout((function(){var r=e[0],i=r.marker,o=r.name,s=r.data,l=r.seriesName,c=[("positive"===l?"\u6b63\u9762":"\u8d1f\u9762")+"\u58f0\u91cf\uff1a"+(0,It.hE)(s[l+"Count"]),"\u58f0\u91cf\u5360\u6bd4\uff1a"+(100*s[l.substring(0,3)+"Rate"]).toFixed(2)+"%"];s.pos&&c.push("\u8bcd\u6027\uff1a"+Wt[s.pos]);var u=(0,Ht.v)({onOk:function(){return a.props.onWordModalView(o)}});n(t,(0,Bt.r)(i+" "+o+" "+u,c,[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return a.handleOnMsgClick(r)}}]))}),0)}},graphic:[{type:"group",top:"13%",silent:!0,children:[{type:"text",left:15,style:{text:"TOP 10 \u70ed\u8bcd",font:"bolder 12px "+zt.I8,fill:"#262626"}},{type:"text",left:100,style:{text:"(\u6b63\u9762\u6d88\u606f"+("count"===t?"\u6570\u91cf":"\u6bd4\u4f8b")+")",font:"normal 12px "+zt.I8,fill:"#8C8C8C"}}]},{type:"group",top:"58%",silent:!0,children:[{type:"text",left:15,style:{text:"TOP 10 \u70ed\u8bcd",font:"bolder 12px "+zt.I8,fill:"#262626"}},{type:"text",left:100,style:{text:"(\u8d1f\u9762\u6d88\u606f"+("count"===t?"\u6570\u91cf":"\u6bd4\u4f8b")+")",font:"normal 12px "+zt.I8,fill:"#8C8C8C"}}]}],xAxis:["positive","negative"].map((function(e,t){return{gridIndex:t,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{interval:0,formatter:function(t,n){var r=a.barDatas[e+"Data"][n].pos;return r?"{"+r+"|"+t+"}":t},rich:{n:{color:"#61799b"},a:{color:"#d07b49"},un:{color:"#626262"}}},data:a.barDatas[e+"Data"].map((function(e){return e.name}))}})),yAxis:["positive","negative"].map((function(e,t){return{gridIndex:t,axisLabel:{show:!1},axisLine:{show:!1},splitLine:{show:!0,lineStyle:{color:"#E8E8E8",type:"dashed"}}}})),series:["positive","negative"].map((function(e,n){return{type:"bar",name:e,barWidth:30,xAxisIndex:n,yAxisIndex:n,data:a.barDatas[e+"Data"].map((function(a){return(0,c.Z)({},a,{value:"count"===t?a[e+"Count"]:a[e.substring(0,3)+"Rate"],escore:["positive"===e?1:-1]})}))}}))};return n},t}(r.Component);const Gt=Ut;var qt=a(50976),Kt=a(59132),Qt=function(e){function t(t){var a;return(a=e.call(this,t)||this).renderChart=function(){var t=a.props,n=t.data,r=t.title,i=a.state.formulaType;(0,Vt.P)(n)&&a.chartRef&&e.prototype.renderChart.call((0,E.Z)(a),n,r,i)},a._handleOnMoreClick=function(e){var t=a.props,n=t.data,r=t.onConfig,i=t.title,o=a.state.formulaType;if(a.chartRef&&"image"===e)(0,te._v)(a.chartRef,i);else if((0,Vt.P)(n)&&"data"===e){var s,l,c,u;"rate"===o?(s="posRate",l="negRate",c="\u6b63\u9762\u6bd4\u4f8b",u="\u8d1f\u9762\u6bd4\u4f8b"):"count"===o&&(s="positiveCount",l="negativeCount",c="\u6b63\u9762\u58f0\u91cf",u="\u8d1f\u9762\u58f0\u91cf");var p=a.barDatas.positiveData.reduce((function(e,t,a){0===a&&t.pos&&e[0].push("\u8bcd\u6027");var n=t[s],r=[t.name,"rate"===o?(100*n).toFixed(2)+"%":n];return t.pos&&r.push(Wt[t.pos]),e.push(r),e}),[["\u70ed\u8bcd",c]]),d=a.barDatas.negativeData.reduce((function(e,t,a){0===a&&t.pos&&e[0].push("\u8bcd\u6027");var n=t[l],r=[t.name,"rate"===o?(100*n).toFixed(2)+"%":n];return t.pos&&r.push(Wt[t.pos]),e.push(r),e}),[["\u70ed\u8bcd",u]]);(0,te.aT)([[].concat(p,[""],d)],i)}else"config"===e&&r&&r()},a._handleOnStatChange=function(e){a.setState({formulaType:e},(function(){return a.renderChart()}))},a._handleOnMouseover=function(e){var t=e.componentType,a=e.componentSubType,n=e.name,r=e.data;"series"===t&&"bar"===a&&window.postMessage({from:"product_overview_double_bar_chart",action:"mouseover",pos:r.pos,param:{name:n,componentType:t,componentSubType:"wordCloud"}})},a._handleOnMouseout=function(e){var t=e.componentType,a=e.componentSubType;"series"===t&&"bar"===a&&window.postMessage({from:"product_overview_double_bar_chart",action:"mouseout",param:{componentType:t,componentSubType:"wordCloud"}})},a.handleOnMsgClick=function(e){var t=a.props,n=t.title;(0,t.onChartClick)(e,n)},a.dialogRef=void 0,a.state={formulaType:"rate"},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this;this.internalId=setInterval((function(){if(e.chartRef){clearInterval(e.internalId),e.renderChart();var t=e.chartRef._dom.children,a=t[0],n=t[1];a.addEventListener("mouseleave",(function(t){e.chartLeaveTimeout=setTimeout((function(){e.chartLeaveTimeout&&(n.style.display="none")}),2e3)})),n&&n.addEventListener("mouseenter",(function(t){e.chartLeaveTimeout=void 0}))}}),200)},a.componentDidUpdate=function(e,t){var a=e.data,n=this.props.data;JSON.stringify(a)!==JSON.stringify(n)&&this.renderChart(),!(0,Vt.P)(n)&&this.chartRef&&(this.chartRef=void 0)},a.render=function(){var e=this.state.formulaType,t=this.props,a=t.data,n=t.title,i=t.loading,o=t.className,s=void 0===o?"":o;return!t.enableConfig&&Jt.splice(2,1),r.createElement(r.Fragment,null,r.createElement(Vt.Z,{className:"yt_product_overview_double_bar_chart_wrapper "+s,loading:i,data:a,renderTitle:r.createElement(Kt.Z,{title:n,data:a,onMoreClick:this._handleOnMoreClick,moreOptions:Jt},r.createElement(Pe.Z,{options:Yt,activeObj:e,onChange:this._handleOnStatChange}))},r.createElement(qt.Z,{theme:"yunting_pos_neg",option:{},style:{height:"100%",width:"100%"},onChartReady:this.getChartRef,onEvents:{mouseover:this._handleOnMouseover,mouseout:this._handleOnMouseout}})))},t}(Gt),Xt=a(23279),$t=a.n(Xt),ea={n:"#61799b",a:"#d07b49",un:"#626262"},ta={n:"\u540d\u8bcd",a:"\u5f62\u5bb9\u8bcd",un:"\u5176\u4ed6"};const aa=function(e){var t=e.data,a=e.style,n=e.getRef,i=r.useState(1),o=i[0],s=i[1],l=t.slice(20*(o-1),20*o);return r.createElement("div",{className:"wordlist-wrapper",style:a,ref:n},r.createElement("div",{className:"title"},"\u8bcd\u9891\u8868"),r.createElement("div",{className:"list"},l.map((function(e,t){var a,n=t+1+20*(o-1),i=e.pos?ea[e.pos]:n<11?zt.Fq[t%zt.Fq.length]:"#8c8c8c";return r.createElement(D.Z,{key:e.name+"_"+t,placement:"top",overlay:r.createElement(r.Fragment,null,r.createElement("div",{dangerouslySetInnerHTML:{__html:(a=i,'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+a+';"></span> '+e.name)}}),e.pos&&r.createElement("div",null,"\u8bcd\u6027\uff1a"+ta[e.pos]))},r.createElement("div",{className:"item"},r.createElement("span",{className:"index",style:{background:i}},n),r.createElement("span",{className:"name"},e.name),r.createElement("span",{className:"total"},function(e,t){return e?e/1e4<1?e:e/1e8<1?(e/1e4).toFixed(t||0)+"\u4e07":(e/1e8).toFixed(t||0)+"\u4ebf":0}(e.total)),r.createElement("span",{className:"precent"},"("+(100*e.precent).toFixed(2)+"%)")))}))),r.createElement("div",{className:"pagination"},r.createElement(u.Pagination,{layout:"prev, pager, next",small:!0,total:t.length,pageSize:20,currentPage:o,onCurrentChange:function(e){return s(e)}})))};var na={n:"#61799b",a:"#d07b49",un:"#626262",pos:"#00B76E",neu:"#0074B8",neg:"#D96969"},ra={n:"\u540d\u8bcd",a:"\u5f62\u5bb9\u8bcd",un:"\u5176\u4ed6"},ia=[{type:"image",title:"\u5bfc\u51fa\u56fe\u7247"},{type:"data",title:"\u5bfc\u51fa\u6570\u636e"},{type:"config",title:"\u504f\u597d\u8bbe\u7f6e"}],oa=[{title:"TOP 10 ",value:10},{title:"TOP 20 ",value:20},{title:"TOP 40 ",value:40},{title:"TOP 100 ",value:100}],sa=function(e){return'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+e+';"></span>'},la=function(e){return'<span style="color: #8c8c8c">('+(100*e).toFixed(2)+"%)</span>"},ca=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).chartRef=void 0,t.tableRef=void 0,t.graphPieData=void 0,t.wordData=void 0,t.getChartRef=function(e){return t.chartRef=e},t.getTableRef=function(e){return t.tableRef=e},t}(0,n.Z)(t,e);var a=t.prototype;return a.renderChart=function(e,t){this.setValue(e),this.updateChart(t)},a.setValue=function(e){this.wordData=e.map((function(e){return(0,c.Z)({},e,{value:Math.sqrt(e.total),escore:[-1,0,1]})}));var t=Math.sqrt(e[0].total);this.graphPieData=e.slice(0,10).map((function(e){return(0,c.Z)({},e,{rate:Math.sqrt(e.total)/t})}))},a.updateChart=function(e){this.chartRef&&(this.chartRef.clear(),0===e?(this.chartRef.setOption(this.getGraphOption()),this.chartRef.setOption(this.getPieOption())):1===e&&this.chartRef.setOption(this.getWordCloudOption()))},a.getGraphOption=function(){var e=this.chartRef.getHeight()-60,t=this.chartRef.getWidth()-60,a=t>e?e:t;return{series:[{type:"graph",layout:"force",silent:!0,animation:!1,legendHoverLink:!1,force:{repulsion:[.4*a,.8*a],gravity:.11,layoutAnimation:!1},data:this.graphPieData.map((function(e){return{symbolSize:e.rate*a/3}}))}]}},a.getPieOption=function(){var e=this,t=this.chartRef.getHeight(),a=this.chartRef.getWidth(),n=a>t?t:a;return{color:zt.Rt,tooltip:{showDelay:200,hideDelay:500,enterable:!0,padding:0,position:function(e,t,a,n,r){var i=r.contentSize,o=r.viewSize,s=e[0]<o[0]/2?0:-1,l=e[1]<o[1]/2?-.5:-1;return[e[0]+s*i[0]+(s?-10:10),e[1]+l*i[1]]},formatter:function(t,a,n){return setTimeout((function(){var r,i,o=t.marker,s=t.data,l=s.value,c=s.name,u=s.total;if("label"!==c)r=o+" "+c,i=["\u58f0\u91cf\uff1a"+l,"\u5360\u6bd4\uff1a"+(l/u*100).toFixed(2)+"%"],u.pos&&i.push("\u8bcd\u6027\uff1a"+ra[u.pos]);else{var p=(0,Ht.v)({onOk:function(){return e.props.onWordModalView(u.name)}});r=u.name+"\uff1a"+u.total+" "+p,i=[sa(na.neg)+" \u8d1f\u9762\uff1a"+(0,It.hE)(u.negativeCount)+" "+la(u.negativeCount/u.total),sa(na.neu)+" \u4e2d\u6027\uff1a"+(0,It.hE)(u.neutralCount)+" "+la(u.neutralCount/u.total),sa(na.pos)+" \u6b63\u9762\uff1a"+(0,It.hE)(u.positiveCount)+" "+la(u.positiveCount/u.total)],u.pos&&i.push(sa(na[u.pos])+" \u8bcd\u6027\uff1a"+ra[u.pos])}n(a,(0,Bt.r)(r,i,[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return e._handleOnMsgClick(t)}}]))}),0)}},graphic:[{type:"group",top:24,left:20,silent:!0,children:[{type:"text",left:10,style:{text:"TOP 10 \u70ed\u8bcd",font:"bolder 14px "+zt.I8,lineWidth:4,fill:"#262626"}},{type:"text",left:100,style:{text:"(\u6765\u81ea\u5168\u90e8\u6d88\u606f)",font:"normal 14px "+zt.I8,fill:"#8C8C8C"}}]}],series:this.chartRef._zr.storage._displayList.map((function(t,a){var r=e.graphPieData[a],i=r.rate*n/3*.35,o=e.chartRef.convertToPixel({seriesIndex:0},[t.transform[4]+30,t.transform[5]+30]),s=26*r.rate,l=s*r.name.length>2*(i-10)?2*(i-10)/r.name.length:s;return{type:"pie",name:r.name,center:o,hoverOffset:4,radius:[i-5,i],label:{normal:{show:!0,position:"center",formatter:"{a|"+r.name+"}",rich:{a:{color:r.pos?na[r.pos]:"#262626",fontSize:l,fontFamily:zt.I8}}}},itemStyle:{shadowBlur:10,shadowColor:"rgba(155,155,155,0.5)",borderColor:"#ffffff",borderWidth:.5},data:[{value:r.positiveCount,name:"\u6b63\u9762",realName:r.name,total:r.total,escore:[1]},{value:r.neutralCount,name:"\u4e2d\u6027",realName:r.name,total:r.total,escore:[0]},{value:r.negativeCount,name:"\u8d1f\u9762",realName:r.name,total:r.total,escore:[-1]},{value:0,name:"label",total:r,realName:r.name,escore:[-1,0,1]}]}}))}},a.getWordCloudOption=function(){var e=this;return{graphic:[{type:"group",top:24,left:20,silent:!0,children:[{type:"text",left:10,style:{text:"\u70ed\u8bcd",font:"bolder 14px "+zt.I8,fill:"#262626"}},{type:"text",left:45,style:{text:"(\u6765\u81ea\u5168\u90e8\u6d88\u606f)",font:"normal 14px "+zt.I8,fill:"#8C8C8C"}}]}],tooltip:{showDelay:200,hideDelay:500,enterable:!0,padding:0,position:function(e,t,a,n,r){var i=r.contentSize,o=r.viewSize,s=e[0]<o[0]/2?0:-1,l=e[1]<o[1]/2?-.5:-1;return[e[0]+s*i[0]+(s?-10:10),e[1]+l*i[1]]},formatter:function(t,a,n){return setTimeout((function(){var r=t.marker,i=t.data,o=i.name,s=i.total,l=i.pos,c=i.positiveCount,u=i.posRate,p=i.negativeCount,d=i.negRate,h=i.neutralCount,f=i.neuRate,m=["\u8d1f\u9762\uff1a"+p+" "+la(d),"\u4e2d\u6027\uff1a"+h+" "+la(f),"\u6b63\u9762\uff1a"+c+" "+la(u)];l&&m.push("\u8bcd\u6027\uff1a"+ra[l]),n(a,(0,Bt.r)(r+' <span style="font-weight: bold">'+o+": "+s+"</span>",m,[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return e._handleOnMsgClick(t)}}]))}),0)}},series:[{type:"wordCloud",name:"overview-wordcloud",gridSize:8,sizeRange:[12,60],rotationRange:[0,0],width:"95%",height:"85%",data:this.wordData,textStyle:{normal:{color:function(e){var t=e.dataIndex,a=e.data.pos;return a?na[a]:zt.Fq[t%it.rf.length]}},emphasis:{color:"#D8D8D8"}}}]}},t}(r.PureComponent),ua=function(e,t,a,n){setTimeout((function(){var r={type:t,seriesIndex:0,seriesName:"overview-wordcloud"};n?r.dataIndex=n:a&&(r.name=a),e.dispatchAction(r)}),0)},pa=function(e){function t(t){var a;return(a=e.call(this,t)||this).renderChart=function(){var t=a.props.data,n=a.state.type;(0,Vt.P)(t)&&a.chartRef&&e.prototype.renderChart.call((0,E.Z)(a),t,n)},a._handleOnMessageReceive=function(e){var t=e.data;if(a.chartRef&&"product_overview_double_bar_chart"===t.from)if("mouseover"===t.action){var n=a.wordData.findIndex((function(e){return e.name===t.param.name&&e.pos===t.pos}));n>-1&&(t.param.dataIndex=n),a._handleOnMouseOver(t.param)}else"mouseout"===t.action&&a._handleOnMouseOut(t.param)},a._handleOnTopChange=function(e){var t=a.props.data,n=void 0;if(100!==e){n=[];for(var r=t.length-1;r>=e;r--)n.push(t[r].name)}a.setState({top:e,hightlightNames:n},(function(){1===a.state.type&&(ua(a.chartRef,"downplay",void 0),n&&ua(a.chartRef,"highlight",n))}))},a._handleOnMoreClick=function(e){var t=a.props,n=t.data,r=t.onConfig,i=a.state.type,o=0===i?"TOP10\u70ed\u8bcd":1===i?"\u70ed\u8bcd":"\u8bcd\u9891\u8868";if("image"===e)2===i&&a.tableRef?(0,te.Mx)(a.tableRef,o):a.chartRef&&(0,te._v)(a.chartRef,o);else if((0,Vt.P)(n)&&"data"===e){var s=(0===i?a.graphPieData:a.wordData).reduce((function(e,t,a){0===a&&t.pos&&e[0].splice(1,0,"\u8bcd\u6027");var n=[t.name,t.total,t.positiveCount,(100*t.posRate).toFixed(2)+"%",t.neutralCount,(100*t.neuRate).toFixed(2)+"%",t.negativeCount,(100*t.negRate).toFixed(2)+"%"];return t.pos&&n.splice(1,0,ra[t.pos]),e.push(n),e}),[["\u70ed\u8bcd","\u603b\u58f0\u91cf","\u6b63\u9762\u58f0\u91cf","\u6b63\u9762\u6bd4\u4f8b","\u4e2d\u6027\u58f0\u91cf","\u4e2d\u6027\u6bd4\u4f8b","\u8d1f\u9762\u58f0\u91cf","\u8d1f\u9762\u6bd4\u4f8b"]]);(0,te.aT)([s],o)}else"config"===e&&r&&r()},a._handleOnTypeChange=function(e){a.state.type!==e&&a.setState({type:e},(function(){2!==e&&setTimeout((function(){a.updateChart(e)}),100)}))},a._resetChart=function(){var e=a.state.type;0===e&&a.updateChart(e),a.shouldNotCallOutside=!1},a._handleOnMouseOver=function(e){var t=e.componentType,n=e.componentSubType,r=e.name,i=e.dataIndex;1===a.state.type&&(a.shouldNotCallOutside=!0,"series"===t&&"wordCloud"===n&&(ua(a.chartRef,"downplay",r),ua(a.chartRef,"showTip",r,i)))},a._handleOnMouseOut=function(e){var t=e.componentType,n=e.componentSubType;if(1===a.state.type){a.shouldNotCallOutside=!0;var r=a.state.hightlightNames;"series"===t&&"wordCloud"===n&&(ua(a.chartRef,"downplay",void 0),r&&ua(a.chartRef,"highlight",r),ua(a.chartRef,"hideTip",void 0))}},a._handleFinished=function(){if(1===a.state.type&&!a.shouldNotCallOutside){var e=a.state.hightlightNames;!a.lastFinishTimeoutId&&a.setState({wcReady:!1}),a.lastFinishTimeoutId&&clearTimeout(a.lastFinishTimeoutId),a.lastFinishTimeoutId=setTimeout((function(){a.setState({wcReady:!0},(function(){e&&(ua(a.chartRef,"downplay",void 0),ua(a.chartRef,"highlight",e))})),a.lastFinishTimeoutId=void 0}),100)}},a._handleOnMsgClick=function(e){var t=a.state.type;a.props.onChartClick(e,0===t?"TOP10\u70ed\u8bcd\uff08\u6765\u81ea\u5168\u90e8\u6d88\u606f\uff09":1===t?"\u70ed\u8bcd\uff08\u6765\u81ea\u5168\u90e8\u6d88\u606f\uff09":"")},a.lastFinishTimeoutId=void 0,a.shouldNotCallOutside=!1,a.state={type:0,top:100,wcReady:!1,hightlightNames:void 0},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this;this.internalId=setInterval((function(){if(e.chartRef){clearInterval(e.internalId),e.renderChart();var t=e.chartRef._dom.children,a=t[0],n=t[1];a.addEventListener("mouseleave",(function(t){e.chartLeaveTimeout=setTimeout((function(){e.chartLeaveTimeout&&(n.style.display="none")}),2e3)})),n&&n.addEventListener("mouseenter",(function(t){e.chartLeaveTimeout=void 0}))}}),200),window.addEventListener("resize",$t()(this._resetChart,200)),window.addEventListener("message",this._handleOnMessageReceive)},a.componentWillUnmount=function(){window.removeEventListener("resize",this._resetChart),window.removeEventListener("message",this._handleOnMessageReceive)},a.componentDidUpdate=function(e,t){var a=e.data,n=this.props.data;JSON.stringify(a)!==JSON.stringify(n)&&this.renderChart(),!(0,Vt.P)(n)&&this.chartRef&&(this.chartRef=void 0)},a.render=function(){var e=this,t=this.props,a=t.data,n=t.loading,i=t.className,o=void 0===i?"":i,s=t.enableConfig,l=this.state,c=l.type,u=l.wcReady,p=l.top;return!s&&ia.splice(2,1),r.createElement(r.Fragment,null,r.createElement(Vt.Z,{className:"yt_graph_pie_word_chart_wrapper "+o,data:a,loading:n,renderTitle:r.createElement(Kt.Z,{data:a,title:"",onMoreClick:this._handleOnMoreClick,moreOptions:ia},1===c&&r.createElement(Pe.Z,{enable:u,options:oa,activeObj:p,onChange:this._handleOnTopChange}),r.createElement("span",{className:"buttons"},r.createElement("i",{className:"icon-cem_hotspot icon "+(0===c?"icon-selected":""),onClick:function(){return e._handleOnTypeChange(0)}}),r.createElement("i",{className:"icon-cem_cloud-new icon "+(1===c?"icon-selected":""),onClick:function(){return e._handleOnTypeChange(1)}}),r.createElement("i",{className:"icon-cem_form icon "+(2===c?"icon-selected":""),onClick:function(){return e._handleOnTypeChange(2)}})))},r.createElement(qt.Z,{theme:"yunting_multi_color",option:{},onChartReady:this.getChartRef,style:{width:"100%",height:"100%",display:2!==c?"block":"none"},onEvents:{finished:this._handleFinished,mouseover:this._handleOnMouseOver,mouseout:this._handleOnMouseOut}}),(0,Vt.P)(a)&&r.createElement(aa,{getRef:this.getTableRef,data:a,style:{display:2===c?"block":"none"}})))},t}(ca),da={callback:void 0,visible:!1,enable:!1,wordTypes:[]};const ha=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleOnConfirm=function(){var e=a.state,t=e.callback,n=e.enable,r=e.wordTypes;t&&t({enable:n,wordTypes:r}),a._handleOnCancel()},a._handleOnCancel=function(){a.setState(JSON.parse(JSON.stringify(da)))},a._handleOnEnableChange=function(e){a.setState({enable:e,wordTypes:e?["n","a","un"]:[]})},a._handleOnWordTypeChange=function(e){a.setState({wordTypes:e})},a.state=JSON.parse(JSON.stringify(da)),a}(0,n.Z)(t,e);var a=t.prototype;return a.show=function(e){this.setState((0,c.Z)({visible:!0},e))},a.render=function(){var e=this.state,t=e.visible,a=e.enable,n=e.wordTypes;return r.createElement(u.Dialog,{title:"\u504f\u597d\u8bbe\u7f6e",className:"yt_product_overview_config_wrapper",size:"tiny",visible:t,onCancel:this._handleOnCancel},r.createElement(u.Dialog.Body,null,r.createElement("div",{className:"item"},r.createElement("span",null,"\u533a\u5206\u70ed\u8bcd\u8bcd\u6027"),r.createElement(u.Radio.Group,{value:a,onChange:this._handleOnEnableChange},r.createElement(u.Radio,{value:!0},"\u662f"),r.createElement(u.Radio,{value:!1},"\u5426"))),r.createElement("div",{className:"item"},r.createElement("span",null,"\u8bcd\u6027\u5c55\u793a"),r.createElement(u.Checkbox.Group,{value:n,onChange:this._handleOnWordTypeChange},r.createElement(u.Checkbox,{label:"n",disabled:!a},"\u540d\u8bcd"),r.createElement(u.Checkbox,{label:"a",disabled:!a},"\u5f62\u5bb9\u8bcd"),r.createElement(u.Checkbox,{label:"un",disabled:!a},"\u5176\u4ed6")))),r.createElement(u.Dialog.Footer,null,r.createElement(u.Button,{type:"default",onClick:this._handleOnCancel},"\u53d6\u6d88"),r.createElement(u.Button,{type:"primary",onClick:this._handleOnConfirm},"\u786e\u5b9a")))},t}(r.PureComponent);const fa=function(e){var t=e.doublebarDatas,a=e.wordCloudDatas,n=e.loading,i=e.posList,o=e.propEnable,s=e.onChartClick,l=e.onFilterChange,c=e.fetchWordCloudDatas,u=he.Z.hasAuthority("HOT_WORD_SETTING"),p=r.useRef(void 0),d=function(){p.current.show({enable:o,wordTypes:i,callback:function(e){var t=e.enable,a=e.wordTypes;l&&l({propEnable:t,posList:a})}})},h=r.useState({visible:!1,word:""}),f=h[0],m=h[1],g=(0,r.useCallback)((function(e){m({visible:!0,word:e})}),[]),v=(0,r.useCallback)((function(e){m({visible:e,word:""}),c({})}),[]);return r.createElement("div",{className:"overview-obttom-wrapper"},r.createElement(Qt,{className:"left",enableConfig:u,title:"\u53cd\u9988\u7126\u70b9",data:t,loading:n,onFilterChange:l,onChartClick:s,onConfig:d,onWordModalView:g}),r.createElement(pa,{className:"right",enableConfig:u,data:a,loading:n,onFilterChange:l,onChartClick:s,onConfig:d,onWordModalView:g}),u&&r.createElement(ha,{ref:p}),r.createElement(Ht.Z,{visible:f.visible,word:f.word,onClose:v}))};var ma=a(64396),ga=["loading"],va=ma.Z.product.overview,ya=function(e){function t(t){var a;return(a=e.call(this,t)||this).refreshChart=function(){var e=a.props,t=e.getParams,n=e.fetchWordCloudDatas,r=t();n({filterModel:r.filterModel,dateFilter:r.dateFilter,projectId:ee.t.get(ee.V.curProject).id})},a._handleOnFilterChange=function(e){void 0!==e.propEnable&&a.props.fetchWordCloudDatas(e)},a._handleOnMoreClick=function(e){var t=a.props.wordCloudDatas;if("image"===e.funType)switch(e.chartType){case-1:(0,te._v)(a.barChartIns,"\u53cd\u9988\u7126\u70b9-\u67f1\u72b6\u56fe");break;case 0:(0,te._v)(a.graphPieChartIns,"TOP10\u70ed\u8bcd-\u6c14\u6ce1\u56fe");break;case 1:(0,te._v)(a.wordcloudChartIns,"\u70ed\u8bcd-\u8bcd\u4e91\u56fe")}else{var n=t.reduce((function(e,t){return[].concat(e,[[t.name,t.positiveCount,t.neutralCount,t.negativeCount,t.total]])}),[["\u8bcd\u540d","\u6b63\u9762","\u4e2d\u6027","\u8d1f\u9762","\u603b\u6570"]]);(0,te.aT)([n],"\u70ed\u8bcd")}},a._handleOnChartClick=function(e,t){var n=e.data,r=n.realName,i=n.name,o=n.escore,s=n.pos,l=(0,a.props.getParams)();l.projectId=ee.t.get(ee.V.curProject).id,l.filterModel=(0,c.Z)({},l.filterModel,{escore:o}),l.textRankWord=r||i,l.textRankWordPos=s||"",l.filterTip="\u4ea7\u54c1\u6d1e\u5bdf/\u6982\u89c8/"+t,window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(l)))},a.event={onFilterChange:a._handleOnFilterChange,onChartClick:a._handleOnChartClick},a.state={},a}return(0,n.Z)(t,e),t.prototype.render=function(){return r.createElement(fa,(0,c.Z)({},this.state,this.props,this.event))},t}(r.PureComponent);const Ea=(0,Zt.connect)((function(e){var t=e.loading,a=(0,Ft.Z)(e,ga)[va];return{doublebarDatas:a.doublebarDatas,wordCloudDatas:a.wordCloudDatas,propEnable:a.propEnable,posList:a.posList,loading:t.effects[va+"/fetchWordCloudDatas"]||!1}}),(function(e){return{fetchWordCloudDatas:function(t){return e({type:va+"/fetchWordCloudDatas",payload:t})}}}),null,{withRef:!0})(ya);var Ca={overview:["COUNTER_OVERVIEW","COUNTER_PIES_BY_SOURCE","EMOTION_TIME_STACK_BAR","COUNTER_WORD"],product:"EMOTION_ASPECT_LEVEL_BAR",service:"EMOTION_ASPECT_LEVEL_BAR",marketing:"EMOTION_ASPECT_LEVEL_BAR",price:"CONTENT_TABLE"},ba=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={index:ee.t.get(ee.V.curProject).id,type:t.props.type||"product",model:t.props.type||"product",filter:{},headerReady:!1},t.getParams=function(){return t.refs.filter.getValue()},t.getAspect=function(){return t.refs.filter.getValue().filterModel.aspect||{}},t.setAspectType=function(){},t.onWindowResize=function(){t.waiter||(t.waiter=!0,setTimeout((function(){t.waiter=!1,t.resize()}),300))},t.refreshOverview=function(){var e=t.state,a=e.index,n=e.type;if(a)if("overview"===n)Ca[n].forEach((function(e){(t.refs[e].wrappedInstance?t.refs[e].wrappedInstance:t.refs[e]).refreshChart({projectId:a,type:e})}));else t.refs[Ca[n]]&&t.refs[Ca[n]].refreshChart({projectId:a,type:Ca[n]});else t.setState({index:ee.t.get(ee.V.curProject).id},(function(){return t.refreshOverview()}))},t.resize=function(){var e=t.state.type;if("overview"===e)Ca[e].forEach((function(e){var a=t.refs[e].wrappedInstance?t.refs[e].wrappedInstance:t.refs[e];null==a||a.resize()}));else t.refs[Ca[e]].resize()},t.onFilterChange=function(){t.state.headerReady&&t.refreshOverview()},t.handleOnFilterReady=function(){t.setState({headerReady:!0},(function(){return t.refreshOverview()}))},t}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){window.addEventListener("resize",this.onWindowResize)},a.componentWillUnmount=function(){window.removeEventListener("resize",this.onWindowResize)},a.render=function(){var e=this.state,t=e.type,a=e.model,n=(e.index,e.headerReady),s={overview:"\u6570\u636e\u9884\u89c8",product:"\u4ea7\u54c1\u5206\u6790",brand:"\u54c1\u724c\u5206\u6790",service:"\u670d\u52a1\u5206\u6790",marketing:"\u5e02\u573a\u5206\u6790",price:"\u4ef7\u683c\u5206\u6790"},l=j()("overview-container",{"analyze-container":"overview"!==t});return r.createElement("div",{className:l},r.createElement(Q.Z,{ref:"filter",model:a.toUpperCase(),title:s[t],showList:["condition","time","save"],filterCondition:Object.assign({filter:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"]},{filterConfig:"overview"===this.props.type?["MESSAGE_TYPE","ESCORE"]:["ESCORE"]}),onChange:this.onFilterChange,onFilterReady:this.handleOnFilterReady,saveFilterListShow:ee.V.overviewFilterListSave}),"overview"===t?r.createElement("div",{className:"overview-body data-overview",style:{padding:"0 16px"}},r.createElement("div",null,n&&r.createElement(jt,{getParams:this.getParams,ref:"COUNTER_OVERVIEW"})),r.createElement("div",{className:"block"},r.createElement(K.COUNTER_PIES_BY_SOURCE.widget,{getParams:this.getParams,name:"\u6570\u636e\u6765\u6e90",ref:"COUNTER_PIES_BY_SOURCE"})),r.createElement("div",{className:"block"},r.createElement(K.EMOTION_PIE_AND_TIME_STACK_BAR.widget,{name:"\u60c5\u611f",getParams:this.getParams,ref:"EMOTION_TIME_STACK_BAR"})),r.createElement("div",{className:"block"},r.createElement(Ea,{getParams:this.getParams,ref:"COUNTER_WORD",projectId:this.state.index}))):r.createElement("div",{className:"overview-body data-overview"},r.createElement(o.X,{row:"md-12",style:{paddingTop:0}},r.createElement(o.J,{col:"md-12"},r.createElement(Pt,{type:t,getParams:this.getParams,ref:Ca[t],name:s[t],projectId:this.state.index,headerReady:n,model:a.toUpperCase()})))),r.createElement(i.Z,{ref:"dataModal"}))},t}(r.Component)},33905:(e,t,a)=>{a.d(t,{kQ:()=>o,ao:()=>c,yc:()=>s,ch:()=>i,rf:()=>n,t7:()=>r,KT:()=>l});var n=["#1550B3","#CC6A77","#119073","#CDB446","#D969BF","#2684FF","#C8662B","#9369D9","#0E97AD","#1BBF69","#D07B49","#61799B","#1EA082","#A9A557","#D8727F"],r=["#3D85FF","#FFA7B2","#15D4A9","#F7D956","#FF9FE9","#75B1FF","#FF9E63","#C7A6FF","#1AC9E5","#47F79B","#FFA875","#4D6282","#2EE0B7","#D2CE77","#FF9FAC"],i=["#D96969","#15B374"],o={barWidth:21,barGap:"30%",barCategoryGap:20,height:300,marginTop:40,marginBottom:40},s=function(e,t){switch(e){case"s1":return t;case"s2":return"positive"===t?"positiveWeight1":"negativeWeight1";case"s3":return"positive"===t?"positiveA":"negativeA";case"s4":return"positive"===t?"positiveB":"negativeB";case"s5":return"positive"===t?"positiveC":"negativeC"}},l=function(e,t,a,n){if(n.length<1)return n;var r=s(a,e),i=JSON.parse(JSON.stringify(n)).map((function(e){return e.data=[],e}));return i.forEach((function(e,a){e.data=JSON.parse(JSON.stringify(n[a])).data.sort((function(e,a){return"asc"===t?e[r]-a[r]:"desc"===t?a[r]-e[r]:null}))})),i},c=function(e){return 0<=e&&e<1e3?e:e<1e4?(e/1e3).toFixed(2)+"\u5343":(e/1e4).toFixed(2)+"\u4e07"}},20899:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(94578),r=a(67294),i=a(45697),o=a.n(i),s=a(70596),l=a.n(s),c=a(67592),u=function(e){function t(t){var a;return(a=e.call(this,t)||this).setChartOption=function(e){a.chart&&a.chart.setOption(e)},a.chart="",a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this,t=this.props.uniqueId;this.chart=l().init(document.getElementById(t)),this.chart.on("click",(function(t){e.props.clickChart&&e.props.clickChart(t)})),this.setChartOption(this.props.option)},a.UNSAFE_componentWillReceiveProps=function(e){(0,c.d)(this.props.option,e.option)||this.setChartOption(e.option)},a.resize=function(){this.chart.resize()},a.render=function(){var e=this.props,t=e.uniqueId,a=e.height;return r.createElement("div",{className:"barchart-wrapper"},r.createElement("div",{id:t,className:"baseChart",style:{width:"100%",height:a}}))},t}(r.PureComponent);u.propTypes={uniqueId:o().string.isRequired,option:o().object,height:o().number.isRequired,clickChart:o().func}},82817:(e,t,a)=>{a.d(t,{I:()=>n,o:()=>r});var n={legend:{data:[],itemWidth:13,itemHeight:13,itemGap:12,right:10,top:0,orient:"vertical"},textStyle:{color:"#262626",fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"},grid:{tooltip:{trigger:"axis"},containLabel:!0,left:30,right:80,bottom:5,top:5,splitLine:{show:!0}},xAxis:{type:"category",axisTick:{show:!1},axisLine:{show:!0,lineStyle:{type:"solid",color:"#E5E5E5"}},axisLabel:{show:!0,color:"#999"},axisPointer:!1,data:[]},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dotted",color:"#E8E8E8"}},axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},tooltip:{trigger:"axis",backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",padding:10,textStyle:{color:"#262626"},extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);",confine:!0}},r=["#1550B3","#CC6A77","#119073","#CDB446","#D969BF","#2684FF","#C8662B","#9369D9","#0E97AD","#1BBF69","#D07B49","#61799B","#1EA082","#A9A557","#D8727F"]},97911:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(94578),r=a(67294),i=a(85151),o=a(5133),s=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleCheckedAll=function(e){var a=t.props,n=a.ITEMS,r=a.changeState,i=a.checkedList,o=[];e.target.checked?(i.map((function(e){return o.push(e)})),n.filter((function(e){return o.indexOf(e)<0})).map((function(e){return o.push(e)}))):i.filter((function(e){return n.indexOf(e)<0})).map((function(e){return o.push(e)})),r&&r(o)},t.handleChange=function(e){var a=t.props,n=a.changeState,r=a.checkedList,i=a.limit;Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},i?-1===r.indexOf(e)?r.length<i?r.push(e):o.Z.warning("\u5f53\u524d\u6761\u4ef6\u4e0b\u6700\u591a\u652f\u6301\u9009\u62e9"+i+"\u4e2a\u5206\u6790\u6307\u6807"):r.remove(e):-1===r.indexOf(e)?r.push(e):r.remove(e),n&&n(r)},t}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.ITEMS,n=t.categoryTitle,o=t.titles,s=t.checkedList,l=t.type,c=(t.limit,s.filter((function(e){return a.indexOf(e)>=0}))),u=!!c.length&&c.length===a.length,p=!!c.length&&c.length!==a.length;return r.createElement("div",{className:"vertical"===l?"new-checkbox-panel new-checkbox-panel-vertical":"new-checkbox-panel"},r.createElement(i.Jg,{checked:u,indeterminate:p,onChange:this.handleCheckedAll},n||"\u5168\u9009"),r.createElement(i.CS,{checkedList:s,onChange:function(t){return e.handleChange(t)}},a&&a.map((function(e,t){return r.createElement(i.Jg,{key:t,value:e},o?o[e]:e)}))))},t}(r.Component)},23123:(e,t,a)=>{e.exports=a.p+"img/79e5bc4b9d23b7e0acc2.png"}}]);