"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[4400],{24400:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var n=a(87462),l=a(94578),r=a(67294),i=a(92360),c=a(55815),s=a(30381),o=a.n(s),u=a(55609),m=a(49722),p=a(35239),d=a(60742),h=a(50976),E={thresholds:"\u9608\u503c",values:"\u5b9e\u9645\u503c"},f=function(e){function t(t){var a;(a=e.call(this,t)||this)._handleFetchUserStateList=function(){a.props.dispatch({type:"userStateMessage/fetchUserStateList",payload:{pageIndex:1,pageSize:10,timestamp:"",PROGRESS:!1,isNotConcat:!0}})},a.fetchAlertDetail=function(e){a.setState({loading:!0},(function(){m.h.post("/warning/log/user/project/aspect/find",{id:e}).then((function(e){var t=e.status,l=e.data.result;if(t>=200&&t<300||304===t){a.props.location.state.isRefreshUserState&&a._handleFetchUserStateList();var r=l.analysisName,i=l.aspectName,c=l.aspectNameList,s=l.aspectValueList,o=l.calType,u=l.createdAt,m=l.dateRangeType,p=l.description,h=l.title,E=l.threshold,f=l.warningData,g=l.filterModel,v=l.content,y=JSON.parse(v).aspectList;if(a.setState({analysisName:r,aspectName:i,aspectNameList:c,aspectValueList:s,calType:o,createdAt:u,dateRangeType:m,description:p,title:h,threshold:E,currValue:f,filterModel:g,combined:y&&y.length>0}),y&&y.length>0){var b=d.B.filter((function(e){return e.value===m})).length>0&&d.B.filter((function(e){return e.value===m}))[0].label,N={title:r?""+r+b+(o?"PERCENT"===o?"\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4":"\u8d1f\u9762\u58f0\u91cf":""):"",list:s.map((function(e){return{aspect:e.aspectName,value:e.warningValue.includes("%")?parseFloat(e.warningValue,2):Number(e.warningValue),threshold:e.warningBeyondValue.includes("%")?parseFloat(e.warningBeyondValue,2):Number(e.warningBeyondValue)}}))},T=(0,n.Z)({title:N.title},N.list.reduce((function(e,t){return e.aspects.push(t.aspect),e.values.push(t.value),e.thresholds.push(t.threshold),e.beyonds.push(((t.value-t.threshold)/t.threshold*100).toFixed(2)+"%"),e.right=Math.max(e.right,function(e,t){var a=document.createElement("canvas").getContext("2d");return a.font=t+"px 'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif",a.measureText(e).width}(t.value,12)),e}),{aspects:[],values:[],thresholds:[],beyonds:[],right:0}));s.length>0&&a.setState({isInterger:!s[0].warningValue.includes("%")},(function(){return a.getOption(T)}))}}})).finally((function(){a.setState({loading:!1})}))}))},a.getMore=function(e){var t=a.state,n=t.createdAt,l=t.dateRangeType,r=t.analysisName,i=t.aspectName,c=t.filterModel,s=function(e,t){var a="YYYY-MM-DD",n=e.substring(0,10),l=o()(n,a),r=l.format(a),i="";switch(t){case"LAST_THREE_DAYS":i=l.subtract(2,"days");break;case"LAST_SENVEN_DAYS":i=l.subtract(6,"days");break;case"LAST_THIRTY_DAYS":i=l.subtract(29,"days");break;case"CURRENT_DAY":i=l;break;case"CURRENT_WEEK":i=l.startOf("week");break;case"CURRENT_MONTH":i=l.startOf("month")}var c=i.format(a);return{dateGroupType:"DAY",from:c,to:r,remoteName:"cTime",numOfDays:o()(r).diff(o()(c),"days")+1,quickChoice:c.replace(/-/g,".")+" - "+r.replace(/-/g,".")}}(n,l),u="/account/project/alert/detail"===location.pathname?p.t.get(p.V.backProjectConfig).id:p.t.get(p.V.curProject).id,m=JSON.parse(JSON.stringify(c));e&&(m.aspect.aspect1.length>0?m.aspect.aspect1=[e]:m.aspect.aspect2=[e]);var d={analyseName:r,aspect:e||i,filterModel:m,dateFilter:s,leftName:"",projectId:u,seriesName:"\u8d1f\u9762",type:"EMOTION_ASPECT_LEVEL_BAR"};window.open("/tab/detail?"+encodeURIComponent(JSON.stringify(d)))},a.getOption=function(e){var t=a.state.isInterger,n=Math.max.apply(Math,e.values),l={title:{text:e.title},grid:[0,1].map((function(){return{show:!1,left:16,top:80,bottom:0,containLabel:!0,right:e.right+16+24}})),legend:{top:40,left:12,itemWidth:14,itemHeight:14,data:["thresholds","values"].map((function(e,t){return{name:E[e]}}))},xAxis:[0,1].map((function(e){return{max:n,show:!1,gridIndex:e}})),yAxis:[0,1].map((function(t){return{gridIndex:t,inverse:!0,data:e.aspects,show:0===t,axisLabel:{interval:0}}})),series:["thresholds","values"].map((function(a,n){return{type:"bar",xAxisIndex:n,yAxisIndex:n,name:E[a],barWidth:0===n?40:20,barGap:"5",barCategoryGap:"5",label:{show:!!n,position:"right",color:"#262626",formatter:function(e){var a=e.data.value;return t?a:a+"%"}},data:e[a].map((function(e){return{value:e,itemStyle:{normal:{color:0===n?"#FFEBE9":"#E96165"},emphasis:{color:0===n?"#FFEBE988":"#E9616588"}}}}))}})),tooltip:{trigger:"item",backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",padding:10,textStyle:{color:"#262626"},extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);",confine:!0,formatter:function(e){var a=e.marker,n=e.name,l=e.seriesName,r=e.value;return n+"<br><div>"+a+l+"\uff1a"+(t?r:r+"%")+"</div>"}}};a.setState({option:l})};var l=t.location.state.id;return a.state={id:l,combined:!1,loading:!1,createdAt:"",currValue:"",threshold:"",title:"",analysisName:"",aspectName:[],aspectNameList:[],aspectValueList:[],dateRangeType:"",calType:"",description:"",collapsed:!0,option:{},isInterger:!1},a}(0,l.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this.state.id;this.fetchAlertDetail(e)},a.componentDidUpdate=function(e){var t=e.location.state.id,a=this.props.location.state.id;t&&a&&a!==t&&this.fetchAlertDetail(a)},a.render=function(){var e=this,t=this.state,a=t.loading,n=t.createdAt,l=t.currValue,s=t.threshold,o=t.title,u=t.description,m=t.analysisName,E=t.aspectName,f=t.aspectNameList,g=t.aspectValueList,v=t.calType,y=t.dateRangeType,b=t.collapsed,N=t.option,T=t.combined,S=d.B.filter((function(e){return e.value===y})).length>0&&d.B.filter((function(e){return e.value===y}))[0].label,A=v?"PERCENT"===v?"\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4":"\u8d1f\u9762\u58f0\u91cf":"",C=m?""+m+S+E+A:"",_=40*(g.length+1)+100;return r.createElement("div",{className:"alert-detail"},r.createElement(c.Z,{title:"/account/project/alert/detail"===location.pathname?[{title:p.t.get(p.V.backProjectConfig).name,url:"/account/project/preview"},{title:"\u9884\u8b66\u7ba1\u7406",url:"/account/project/alert"},{title:"\u63a8\u9001\u65e5\u5fd7",url:"/account/project/alert/log"},{title:"\u63a8\u9001\u8be6\u60c5",url:"/account/project/alert/detail"}]:[{title:"\u6307\u6807\u9884\u8b66",url:"/aspectWarning"},{title:"\u9884\u8b66\u8be6\u60c5",url:""}]}),r.createElement(i.Loading,{loading:a,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},r.createElement("div",{className:"alert-detail-bottom"},r.createElement("div",{className:"alert-detail-card"},r.createElement("div",{className:T?"alert-detail-card-header combined":"alert-detail-card-header",style:{height:T?b?"198px":"315px":"auto"}},T?r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u57fa\u7840\u4fe1\u606f"),r.createElement("span",{onClick:function(){return e.setState({collapsed:!b})}},r.createElement("span",null,"\u5c55\u5f00\u66f4\u591a"),r.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:b?"rotate(0)":"rotate(180deg)"}}))),r.createElement("div",{className:"alert-detail"},r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u540d\u79f0"),r.createElement("span",null,o)),r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u5bf9\u8c61"),r.createElement("span",null,m)),r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u6307\u6807"),r.createElement("span",{title:f.join("\u3001")},f.join("\u3001"))),r.createElement("div",{style:{display:b?"none":"block"}},r.createElement("span",null,"\u8ba1\u7b97\u516c\u5f0f"),r.createElement("span",null,A)),r.createElement("div",{style:{display:b?"none":"block"}},r.createElement("span",null,"\u65f6\u95f4\u8303\u56f4"),r.createElement("span",null,S)),r.createElement("div",{style:{display:b?"none":"block"}},r.createElement("span",null,"\u9884\u8b66\u8bf4\u660e"),r.createElement("span",null,u)))):r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement("span",null,C),r.createElement("span",null,n)),r.createElement("div",null,r.createElement("span",null,l),r.createElement("span",null,"\u9608\u503c"),r.createElement("span",null,"\uff08",s,"\uff09")))),r.createElement("div",{className:T?"alert-detail-card-body combined":"alert-detail-card-body"},T?r.createElement("div",null,r.createElement("span",{className:"created-time"},n),r.createElement(h.Z,{theme:"yunting_h5_warning",option:N,style:{height:_,width:"100%"},onEvents:{click:function(t){var a=t.name;return e.getMore(a)}}})):r.createElement("div",{className:"alert-info"},r.createElement("div",null,"\u9884\u8b66\u57fa\u7840\u4fe1\u606f"),r.createElement("div",{className:"alert-detail"},r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u540d\u79f0"),r.createElement("span",null,o)),r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u5bf9\u8c61"),r.createElement("span",null,m)),r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u6307\u6807"),r.createElement("span",{title:f.join("\u3001")},f.join("\u3001"))),r.createElement("div",null,r.createElement("span",null,"\u8ba1\u7b97\u516c\u5f0f"),r.createElement("span",null,A)),r.createElement("div",null,r.createElement("span",null,"\u65f6\u95f4\u8303\u56f4"),r.createElement("span",null,S)),r.createElement("div",null,r.createElement("span",null,"\u9884\u8b66\u8bf4\u660e"),r.createElement("span",null,u)))),!T&&r.createElement(i.Button,{type:"primary",onClick:function(){return e.getMore()}},"\u6d1e\u5bdf\u66f4\u591a"))))))},t}(r.Component);const g=(0,u.connect)()(f)},60742:(e,t,a)=>{a.d(t,{B:()=>n});var n=[{label:"\u8fd13\u5929",value:"LAST_THREE_DAYS"},{label:"\u8fd17\u5929",value:"LAST_SENVEN_DAYS"},{label:"\u8fd130\u5929",value:"LAST_THIRTY_DAYS"},{label:"\u5f53\u5929",value:"CURRENT_DAY"},{label:"\u5f53\u5468",value:"CURRENT_WEEK"},{label:"\u5f53\u6708",value:"CURRENT_MONTH"}]},55815:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(94578),l=a(67294),r=a(45697),i=a.n(r),c=a(43036),s=a(61409),o=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),l=0;l<a;l++)n[l]=arguments[l];return(t=e.call.apply(e,[this].concat(n))||this)._handleBreadcrumbClick=function(e){var a=t.props,n=a.title,l=a.beforeJump;e!==n.length-1&&(l?new Promise((function(e,t){return l(e,t)})).then((function(){s.mW.push({pathname:n[e].url,state:n[e].state})})):s.mW.push({pathname:n[e].url,state:n[e].state}))},t}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.title,n=t.mainTitle,r=t.rightContent,i=t.className,s=t.overlay;return l.createElement("div",{className:"breadcumb-wrapper "+i},a instanceof Array?l.createElement("div",{className:"breadcrumb-left"},l.createElement("div",null,a.map((function(t,n){return l.createElement("span",{className:t.url?"":"not_clickable",key:n,onClick:function(){return t.url&&n!==a.length-1&&e._handleBreadcrumbClick(n)}},t.title,n!==a.length-1&&" / ")}))),l.createElement("span",null,n||a[a.length-1].title,s&&l.createElement(c.Z,{placement:"top",overlay:s},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):l.createElement("div",{className:"normal-title"},a,s&&l.createElement(c.Z,{placement:"top",overlay:s},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),r||"")},t}(l.Component);o.propTypes={className:i().string,title:i().oneOfType([i().string,i().arrayOf(i().shape({title:i().string,url:i().string,state:i().object}))]).isRequired,overlay:i().oneOfType([i().string,i().node]),mainTitle:i().oneOfType([i().string,i().node]),beforeJump:i().func,rightContent:i().node};const u=o}}]);