"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5422],{22281:(e,t,n)=>{n.d(t,{Z:()=>A});var a=n(87462),r=(n(15267),n(64713)),i=(n(54277),n(74048)),l=n(15861),o=n(87757),d=n.n(o),c=n(67294),u=n(634),s=n(43036),g=n(61918),f=n(39270),p=n(63262),v=n(38064),m=n(30381),h=n.n(m),E=n(96889),w=(0,n(53326).rO)(),I=w.reduce((function(e,t){return e[t.value]=t.label,e}),{}),y=[{title:"\u5168\u90e8",value:""}].concat(w.map((function(e){return{title:e.label,value:e.value}}))),k={READ:"\u5df2\u8bfb",UNREAD:"\u672a\u8bfb"},S=[{label:"\u5168\u90e8",value:""},{label:k.UNREAD,value:"UNREAD"},{label:k.READ,value:"READ"}],C=[{title:"\u5168\u90e8",value:""},{title:"\u9ad8",value:"HIGH"},{title:"\u4e2d",value:"MIDDLE"},{title:"\u4f4e",value:"LOW"}],R=n(49722),N=function(){var e=(0,l.Z)(d().mark((function e(t){var n,a,r,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.h.post("/filter/find",{projectId:t,filterTypes:["TEAM","USER"],type:"OVERVIEW"});case 3:if(n=e.sent,a=(n||{}).data,2e4===(a||{}).code){e.next=8;break}throw"";case 8:return r=a.result||{},i=r.user,e.abrupt("return",i.map((function(e){return{id:e.id,name:e.username}})));case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),b=n(35239),O=n(61193),Z=n(61409);const A=function(e){var t=e.isNeedFilter,n=void 0!==t&&t,o=e.workOrderInfo,m=e.isShowPushUser,w=void 0===m||m,R=e.table,A=e.search,_=e.logStatus,F=e.level,T=e.categoryId,x=e.userIds,D=e.openDetail,L=e.onStateChange,P=(0,c.useState)([]),U=P[0],M=P[1];(0,c.useEffect)((function(){var e=function(){var e=(0,l.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,N(b.t.get(b.V.curProject).id);case 4:t=e.sent,M(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[n]);var W=[{title:"\u9884\u8b66\u6807\u9898",width:"41%",dataIndex:"title",render:function(e,t,n,a){var r=t.remark,i=t.warningDesc,l=t.warningName,o=t.warningLogId;return c.createElement(s.Z,{overlay:function(){return c.createElement(f.Z,{title:l,description:i})},placement:"topLeft",overlayStyle:{maxWidth:"436px"}},c.createElement("span",{className:"warning-log",onClick:function(){return null==D?void 0:D.onClick({id:o,title:r})}},r))}},{title:"\u7d27\u6025\u7a0b\u5ea6",width:"10%",dataIndex:"level",render:function(e){return c.createElement(p.Z,{level:e})}},{title:"\u6570\u636e\u7c7b\u578b",width:"10%",dataIndex:"categoryId",render:function(e){return I[e]}},{title:"\u6d4f\u89c8\u72b6\u6001",width:"10%",dataIndex:"logStatus",render:function(e){return k[e]}},{title:"\u63a8\u9001\u65f6\u95f4",width:"12%",dataIndex:"pushDate",render:function(e){return h()(e).format("YYYY/MM/DD HH:mm")}},{title:"\u662f\u5426\u5173\u8054\u5de5\u5355",width:"10%",render:function(e){return c.createElement(i.default,{size:"middle"},c.createElement("span",{className:e.isRelationWorkOrder?"btn":"",onClick:function(){return e.isRelationWorkOrder&&L("open_related",e)}},e.isRelationWorkOrder?"\u662f":"\u5426"))}}].concat(O.Z.hasAuthority("ADD_WORK_ORDER")?[{title:"\u64cd\u4f5c",width:"7%",key:"action",render:function(e){return c.createElement(i.default,{size:"middle"},c.createElement("a",{className:"link",onClick:function(){return L("open_wkOrder",e)}},"\u521b\u5efa\u5de5\u5355"))}}]:[]);return c.createElement("div",{className:"event_warging_table_page_view"},c.createElement("div",{className:"container"},c.createElement("div",{className:"content"},function(){if(!n)return null;return c.createElement("div",{className:"table-top"},c.createElement("div",null,c.createElement(g.Z,{placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u6807\u9898",defValue:null==A?void 0:A.value,onSearch:(null==A?void 0:A.onSearch)||function(){},onClear:function(){return null==A?void 0:A.onSearch("")},style:{width:200}}),c.createElement(r.default.Group,{options:S,value:null==_?void 0:_.value,onChange:function(e){return null==_?void 0:_.onChange(e.target.value)},optionType:"button",style:{height:30,marginRight:"8px",marginBottom:16}}),c.createElement(u.Z,{options:y,onChange:function(e){return null==T?void 0:T.onChange(e)},preTitle:"\u6570\u636e\u7c7b\u578b",divider:"none",type:"button",activeObj:null==T?void 0:T.value,sufIcon:"icon-cem_pull-down-or-take-up",style:{marginBottom:16}}),c.createElement(u.Z,{options:C,onChange:function(e){return null==F?void 0:F.onChange(e)},preTitle:"\u7d27\u6025\u7a0b\u5ea6",divider:"none",type:"button",activeObj:null==F?void 0:F.value,sufIcon:"icon-cem_pull-down-or-take-up",style:{marginBottom:16}}),w?c.createElement("span",{style:{display:"inline-block",marginBottom:"10px"}},c.createElement(v.Z,{title:"\u63a8\u9001\u6210\u5458",showClearBtn:!0,options:U,value:null==x?void 0:x.value,onChange:function(e){return null==x?void 0:x.onChange(e)}})):null))}(),(null==o?void 0:o.title)&&c.createElement("div",{className:"related"},c.createElement("span",null,"\u5173\u8054\u5de5\u5355\uff1a"),c.createElement("span",null,null==o?void 0:o.code,c.createElement("span",{style:{marginLeft:"10px"}},null==o?void 0:o.title),c.createElement("i",{className:"icon-cem_close-window",onClick:function(){Z.mW.push({pathname:"/workspace/warning"})}}))),c.createElement(E.ZP,{loading:R.loading,dataSource:R.data,columns:W,toolBarRender:!1,search:!1,pagination:R.pagination,rowKey:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t[1];return a},onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],i=t.slice(1),l=(0,a.Z)({},r);R.pagination.pageSize!==l.pageSize&&(l.current=1),R.onChange.apply(null,[l].concat(i))}}))))}},58856:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var a=n(63366),r=(n(75314),n(11187)),i=n(87462),l=n(67294),o=n(55609),d=(n(48980),n(20838)),c=n(22281),u=n(44600),s=n(67770),g=n(61193),f=n(32624),p=n(98482),v=d.default.TabPane;const m=function(e){var t=l.useState(void 0),n=t[0],a=t[1],r=(0,l.useState)(!1),i=r[0],o=r[1],m=(0,l.useState)(!1),h=m[0],E=m[1],w=(0,l.useState)(!1),I=w[0],y=w[1],k=(0,l.useState)(0),S=k[0],C=k[1],R=(0,l.useState)(void 0),N=R[0],b=R[1],O=(0,l.useState)(null),Z=O[0],A=O[1],_=(0,l.useMemo)((function(){return g.Z.hasAuthority("WARNING_MANAGE_RULE")}),[]);(0,l.useEffect)((function(){var t,n=null==(t=JSON.parse(decodeURIComponent(window.location.search).split("?")[1]||"{}"))?void 0:t.workOrderId;e.save(n);var a=JSON.parse(decodeURIComponent(window.location.search).split("?")[1]||"{}");a&&A({title:null==a?void 0:a.title,code:null==a?void 0:a.code}),e.getWarningNotify({activeTab:s.Sc.MY,workOrderId:n}),_&&e.getWarningNotify({activeTab:s.Sc.TEAM,workOrderId:n})}),[e.location]);var F=function(t){o(!1),y(!1),C(t?""+(S+1):S+1),!t&&e.getWarningNotify({activeTab:e.activeTab,workOrderId:e.workOrderId})},T=function(e,t){!e&&b(null),C(0),(t?E:o)(e)},x=function(t,n){if(t.indexOf("open")>-1)return("related"===t.split("_")[1]?E:o)(!0),void b(n);e.onStateChange(t,n)};return l.createElement("div",{className:"event_warging_page_view"},l.createElement("div",{className:"top"},"\u9884\u8b66"),l.createElement("div",{className:"container"},l.createElement("div",{className:"content"},l.createElement(d.default,{activeKey:e.activeTab,onChange:function(t){e.save({activeTab:t})}},l.createElement(v,{tab:"\u6211\u7684\u9884\u8b66\u901a\u77e5",key:s.Sc.MY},l.createElement(c.Z,{isNeedFilter:!0,workOrderInfo:Z,isShowPushUser:!1,table:{loading:e.loadingForList,data:e.USER.data.list,pagination:{total:e.USER.data.total,current:e.USER.filter.pageIndex,pageSize:e.USER.filter.pageSize},onChange:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var r=n[0],i=r.pageSize,l=r.current;e.setFilterParams({pageSize:i,pageIndex:l})}},search:{value:e.USER.filter.searchCondition,onSearch:function(t){e.setFilterParams({searchCondition:t})}},logStatus:{value:e.USER.filter.logStatus,onChange:function(t){e.setFilterParams({logStatus:t})}},level:{value:e.USER.filter.level,onChange:function(t){e.setFilterParams({level:t})}},categoryId:{value:e.USER.filter.categoryType,onChange:function(t){e.setFilterParams({categoryType:t})}},openDetail:{onClick:function(t){n.wrappedInstance.ready(t,e.getWarningNotify)}},onStateChange:x})),_?l.createElement(v,{tab:"\u56e2\u961f\u9884\u8b66\u901a\u77e5",key:s.Sc.TEAM},l.createElement(c.Z,{isNeedFilter:!0,workOrderInfo:Z,table:{loading:e.loadingForList,data:e.TEAM.data.list,pagination:{total:e.TEAM.data.total,current:e.TEAM.filter.pageIndex,pageSize:e.TEAM.filter.pageSize},onChange:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var r=n[0],i=r.pageSize,l=r.current;e.setFilterParams({pageSize:i,pageIndex:l})}},search:{value:e.TEAM.filter.searchCondition,onSearch:function(t){e.setFilterParams({searchCondition:t})}},logStatus:{value:e.TEAM.filter.logStatus,onChange:function(t){e.setFilterParams({logStatus:t})}},level:{value:e.TEAM.filter.level,onChange:function(t){e.setFilterParams({level:t})}},categoryId:{value:e.TEAM.filter.categoryType,onChange:function(t){e.setFilterParams({categoryType:t})}},userIds:{value:e.TEAM.filter.userIds,onChange:function(t){e.setFilterParams({userIds:t})}},openDetail:{onClick:function(t){n.wrappedInstance.ready(t,e.getWarningNotify)}},onStateChange:x})):null))),l.createElement(u.Z,{ref:a}),l.createElement(f.Z,{visible:i,warningId:null==N?void 0:N.warningId,editType:"new",otherConfig:{hideSetting:!0,relatedAdd:function(t,n){e.onRelated({id:null==N?void 0:N.warningLogId,params:t},(function(e){F(e),n&&n()}))}},setVisible:function(e,t){return T(e,!1)}}),l.createElement(p.Z,{id:null==N?void 0:N.warningLogId,addedCount:S,visible:h,relationKind:"WARNING",relatedAdd:function(t){I||(y(!0),e.onRelated({id:null==N?void 0:N.warningLogId,params:t},F,"list"))},hideRelateBtn:!0,setVisible:function(e,t){return T(e,!0)}}))};var h=n(64396),E=n(35239),w=n(12021),I=n(5133),y=["loading"],k=h.Z.workspace.warning;const S=(0,o.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,y);return(0,i.Z)({},n[k],{loadingForList:t.effects[k+"/getWarningNotify"]||!1})}),(function(e){return{save:function(t){return e({type:k+"/save",payload:t})},getWarningNotify:function(t){return e({type:k+"/getWarningNotify",payload:t})},setFilterParams:function(t){return e({type:k+"/setFilterParams",payload:t})}}}))((function(e){var t={onRelated:function(e,t,n){var a=e.id,l=e.params,o=E.t.get(E.V.curProject).id;(0,w.Im)((0,i.Z)({id:a,projectId:o,kind:"WARNING"},n?{workOrderIdList:l}:{workOrderParam:(0,i.Z)({projectId:o},l)})).then((function(e){return 2e4===e.data.code&&I.Z.success(n?"\u5de5\u5355\u5173\u8054\u6210\u529f":"\u5de5\u5355\u521b\u5efa\u6210\u529f")&&t(n)})).catch((function(e){40009===(null==e?void 0:e.data.code)&&(r.default.destroy(),I.Z.error(/[0-9a-f]{32}/.test(e.data.msg)?"\u90e8\u5206\u5b57\u6bb5\u6216\u9009\u9879\u88ab\u7ba1\u7406\u5458\u4fee\u6539\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u9875\u9762\u540e\u64cd\u4f5c":e.data.msg))}))},onStateChange:function(){}};return l.createElement(m,(0,i.Z)({},e,t))}))},98482:(e,t,n)=>{n.d(t,{Z:()=>I});var a=n(87462),r=n(94578),i=n(5133),l=n(35239),o=n(67294),d=(n(53294),n(56697)),c=(n(89858),n(51024)),u=(n(54277),n(74048)),s=(n(1025),n(65400)),g=(n(69909),n(17669)),f=(n(15144),n(2307)),p=(n(54038),n(36671)),v=n(61409),m=n(61193);const h=function(e){var t=e.list,n=e.listLoading,r=e.isRelated,i=e.selectedRowKeys,l=e.onStateChange,d={PENDING:"#BFBFBF",PROCESSING:"#0090FF",FINISHED:"#27CDA1"},c=[{title:"\u7f16\u53f7",key:"code",width:"12%",render:function(e){return o.createElement("span",null,e.code)}},{title:"\u6807\u9898",key:"title",ellipsis:!0,render:function(e){return o.createElement("span",null,o.createElement(v.rU,{to:"/workOrderDetail?workOrderId="+e.workOrderId+(m.Z.hasAuthority("EDIT_WORK_ORDER")||e.assigneeId===m.Z.getUser().userId||e.creatorId===m.Z.getUser().userId?"":"&view=true")+(e.hasDeleted?"&hasDeleted="+e.hasDeleted:"")+(m.Z.hasAuthority("EDIT_WORK_ORDER")||e.assigneeId!==m.Z.getUser().userId||e.creatorId===m.Z.getUser().userId?"":"&normalAssignee=true"),target:"_blank"},e.title))}},{title:"\u72b6\u6001",key:"stateName",width:200,render:function(e,t){return o.createElement(o.Fragment,null,o.createElement("span",{className:"status_point",style:{backgroundColor:d[t.statusKind],marginRight:"8px"}}),o.createElement("span",null,t.stateName))}}].concat("related"===r?[{title:"\u64cd\u4f5c",key:"action",width:120,render:function(e){return o.createElement(u.default,{size:"middle"},o.createElement("a",{onClick:function(){return l("remove",e)}},"\u53d6\u6d88\u5173\u8054"))}}]:[]),s={rowSelection:{selectedRowKeys:i,onChange:function(e){return l("selected",e)},fixed:!0}};return o.createElement(f.Z,(0,a.Z)({columns:c,dataSource:t.map((function(e){return e.key=e.workOrderId,e})),scroll:{y:"calc(100vh - 385px)"},pagination:!1,loading:n},"related"===r?{locale:{emptyText:o.createElement(p.default,{image:p.default.PRESENTED_IMAGE_SIMPLE,description:"\u6682\u65e0\u5173\u8054\u7684\u5de5\u5355"})}}:s))};g.Z.Option;const E=function(e){var t=e.id,n=e.visible,a=e.setVisible,r=e.hideRelateBtn,i=e.list,l=e.relationKind,g=e.listLoading,f=e.onStateChange,p=(0,o.useState)("related"),v=p[0],m=p[1],E=(0,o.useState)(""),w=E[0],I=E[1],y=(0,o.useState)([]),k=y[0],S=y[1],C=function(e,n,a){if("selected"!==e){var r="remove"===e?{id:t,kind:l,workOrderId:n.workOrderId}:n;f(e,r,a)}else S(n)},R=function(e){m(e),f("isRelated","related"===e)};return o.createElement(d.Z,{title:"\u5173\u8054\u5de5\u5355",visible:n,wrapClassName:"relation-modal "+v+" "+(i.length<1?"no-data":""),width:960,centered:!0,destroyOnClose:!0,closeIcon:o.createElement("i",{className:"icon-cem_cancel"}),footer:r?o.createElement(u.default,null):"related"===v?o.createElement("div",{className:"existingBtn"},o.createElement(s.default,{type:"primary",onClick:function(){return R("unRelated")}},"\u5173\u8054\u5df2\u6709\u5de5\u5355")):o.createElement(u.default,null,o.createElement(s.default,{onClick:function(){return R("related")}},"\u53d6\u6d88"),o.createElement(s.default,{type:"primary",onClick:function(){k.length>0&&C("addRelated",k,(function(){return R("related")}))}},"\u5173\u8054")),afterClose:function(){m("related"),I(""),S([])},onCancel:function(){return a(!1)},onOk:function(){a(!1)}},"related"!==v&&o.createElement(o.Fragment,null,o.createElement(c.default,{allowClear:!0,style:{width:"100%"},placeholder:"\u8bf7\u641c\u7d22\u5de5\u5355\u7f16\u53f7\u6216\u5de5\u5355\u6807\u9898\u6765\u5173\u8054",onChange:function(e){e.target.value||(I(e.target.value),f("search-keyword",e.target.value))},onPressEnter:function(e){var t=e.target.value;I(t),f("search-keyword",t)}}),!w&&o.createElement("p",null,"\u6700\u8fd1\u64cd\u4f5c")),o.createElement(h,{list:i,listLoading:g,isRelated:v,selectedRowKeys:k,onStateChange:C}))};var w=n(12021);const I=function(e){function t(t){var n;return(n=e.call(this,t)||this).state=void 0,n.events=void 0,n._handleStateChange=function(e,t,r){var l=n.props.onStateChange;switch(e){case"remove":(0,w.VG)((0,a.Z)({},t,{projectId:n.state.projectId})).then((function(e){2e4===e.data.code&&(i.Z.success("\u53d6\u6d88\u5173\u8054\u6210\u529f"),n._handleFetchList(),l&&l("remove-relate"))}));break;case"isRelated":n._handleFetchList(t);break;case"addRelated":n._handleAddReleted(t,r);break;case"search":case"search-keyword":n._handleFetchList(!1,t)}},n._handleFetchList=function(e,t){void 0===e&&(e=!0),void 0===t&&(t="");var r=n.props,i=r.id,l=r.relationKind,o=n.state,d=o.projectId,c=o.pageIndex,u=o.pageSize;n.setState({listLoading:!0});var s={searchList:[]};i&&(0,w.qH)({id:i,projectId:d,relationKind:l,keyword:t,pageIndex:c,pageSize:u,isRelated:e}).then((function(e){return e.data.result.list&&n.setState((0,a.Z)({list:e.data.result.list,listLoading:!1},t?{}:s))})).catch((function(e){return console.error(e)}))},n._handleAddReleted=function(e,t){return n.props.relatedAdd(e,t)},n.state={projectId:l.t.get(l.V.curProject).id,list:[],searchList:[],keyword:"",pageIndex:0,pageSize:10,listLoading:!1},n.events={onStateChange:n._handleStateChange},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=this.props,n=t.visible,a=t.addedCount,r=t.id;!n||e.visible===n&&e.id===r||this._handleFetchList("string"!==typeof a)},n.render=function(){return o.createElement(E,(0,a.Z)({},this.props,this.state,this.events))},t}(o.Component)},12021:(e,t,n)=>{n.d(t,{qH:()=>r,Im:()=>i,VG:()=>l});var a=n(49722);function r(e){var t=e.id,n=e.projectId,r=e.relationKind,i=e.keyword,l=e.pageIndex,o=e.pageSize,d=e.isRelated;return a.h.get("/workorder/work-order/"+(d?"relation":"unRelation")+"/list",{params:{id:t,projectId:n,relationKind:r,keyword:i,pageIndex:l,pageSize:o}})}function i(e){var t=e.id,n=e.projectId,r=e.kind,i=e.workOrderIdList,l=e.workOrderParam;return a.h.post("/workorder/work-order/relation/add",{id:t,projectId:n,kind:r,workOrderIdList:i,workOrderParam:l})}function l(e){var t=e.id,n=e.kind,r=e.workOrderId,i=e.projectId;return a.h.delete("/workorder/work-order/relation/remove?projectId="+i+"&id="+t+"&kind="+n+"&workOrderId="+r)}}}]);