"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2747],{78436:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(94578),r=a(67294),i=a(94644),o=function(e){function t(){var t;return(t=e.call(this)||this).isEmpty=!0,t.group=function(e){t.myChart.group=e,t.echarts.connect(e)},t.refreshChart=function(e){t.setState(e)},t.setWidth=function(e){t.refs.chart.style.width=e,t.init()},t.loading=function(){t.myChart.clear(),t.myChart.showLoading({text:"\u62fc\u547d\u52a0\u8f7d\u4e2d",color:"#20a0ff",maskColor:"rgba(255, 255, 255, 0.9)",zlevel:0})},t.setOption=function(e){if(e.textStyle={fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"},e.legend&&(e.legend.data=e.legend.data.map((function(e){return{name:e,icon:"circle"}})),e.legend.itemWidth=10,e.legend.itemHeight=10),e.tooltip&&!e.tooltip.extraCssText?(e.tooltip.backgroundColor="rgba(255,255,255,0.9)",e.tooltip.textStyle={color:"#262626"},e.tooltip.extraCssText="box-shadow: 0 0 7px rgba(0, 0, 0, 0.3);"):e.tooltip&&(e.tooltip=e.tooltip),e.series.forEach((function(e){"line"===e.type&&(e.showAllSymbol=!0,e.symbol="circle",e.symbolSize=2,e.itemStyle={normal:{borderColor:"rgba(255,255,255,0)",borderWidth:5}})})),e.hoverLayerThreshold=500,e.progressiveThreshold=500,e.animationThreshold=500,t.myChart){var a;t.myChart.clear(),t.myChart.hideLoading();for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(a=t.myChart).setOption.apply(a,[e].concat(r)),t.isEmpty=!1}},t.setEmptyOption=function(e){var n=t.myChart.getHeight(),r=t.myChart.getWidth(),i=Math.min(n/2,r/2,20),o={type:"pie",radius:[0,0],center:["50%","50%"],silent:!0,data:[{value:0,name:"",label:{normal:{show:!0,position:"center",backgroundColor:{image:a(3381)},padding:i,formatter:function(){return""}}}},{value:0,name:"",label:{normal:{show:!0,position:"center",formatter:function(){return"{a|\n}{b|"+e+"}"},rich:{a:{height:i+60},b:{fontSize:20,color:"#999"}}}}}]};t.myChart&&(t.myChart.clear(),t.myChart.hideLoading(),t.myChart.setOption({series:o,animation:!1},!0),t.isEmpty=!0)},t.init=function(){t.echarts.getInstanceByDom(t.refs.chart)&&t.echarts.dispose(t.refs.chart);var e=t.echarts.init(t.refs.chart);t.myChart=e,t.props.myChartClick&&e.on("click",(function(e){t.isEmpty||t.props.myChartClick(e)})),t.props.dataZoomChange&&e.on("dataZoom",(function(e){t.isEmpty||t.props.dataZoomChange(e)}))},t.downloadExcel=function(e,t){(0,i.aT)([[t].concat(e)],"")},t.echarts=a(70596),t}(0,n.Z)(t,e);var o=t.prototype;return o.componentDidMount=function(){this.init()},o.componentWillUnmount=function(){this.myChart.dispose()},o.render=function(){var e=this.props.minHeight,t=Object.assign({},e?{minHeight:e}:{});return r.createElement("div",{ref:"chart",className:"widget-chart",style:t})},t}(r.Component)},92747:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_e});var n=a(63366),r=(a(30467),a(55673)),i=(a(58136),a(5789)),o=(a(89626),a(70302)),s=(a(45673),a(8448)),l=a(87462),c=a(94578),d=(a(23461),a(53740)),p=a(50361),u=a.n(p),m=a(67294),h=a(43036),f=(a(9405),a(89552)),g=a(43144),y=a(97326),v=a(49722);const C=function(e,t){v.h.post("/widget/data/find",e).then((function(e){t&&t(e.data.result)}),(function(e){t&&t(e.data.result)}))};var E=a(78436),O=a(70715),T=a(49357),N=(a(89777),function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).colors={normal:["#5B8FF9","#60DDA9","#F6BD15","#F08A8A","#78D3F8","#65789B","#F6903D","#028685","#7262FD","#9661BC"],emotion:["#15B374","#1574B3","#D96969"],aspect:["#15B374","#D96969"]},t.state={title:t.props.name||"",canEdit:t.props.canEdit||!1,showTitle:!1!==t.props.showTitle,toolbox:["image","data"],json:null},t.resetState=function(){-1!==t.state.selectIndex&&t.setState({selectIndex:-1},(function(){t.buildChart()}))},t.getChartData=function(){if(t.refs.chart&&t.refs.chart.myChart){var e=t.refs.chart.myChart.getOption().series[0].data.map((function(e){return[e.name,e.value]}));t.downloadExcel({titles:["\u8bcd\u8bed","\u6570\u91cf"],data:e})}},t.buildChart=function(){var e=t.props.index,a=document.getElementsByClassName("widget-chart")[e];if(a&&a.childElementCount>2)for(var n=document.createElement("span"),r=1;r<a.childElementCount;r++)a.childNodes[r].replaceWith(n);var i=t.state,o=i.colors,s=i.selectIndex,l=t.props.json;if(l){if(!t.props.loading)if("string"!==typeof l&&0===l.length&&(l="\u6ca1\u6709\u6570\u636e\u53ef\u7528"),"string"!==typeof l){var c=t.refs.chart.myChart;t.jsonStr===JSON.stringify(l)?c.resize():t.jsonStr=JSON.stringify(l);var d=c.getHeight(),p=c.getWidth(),u=0;l=l.filter((function(e){return e}));var m=Math.min(4,Math.max.apply(Math,l.map((function(e){return e.value}))));l&&l.map((function(e){return u+=14*e.name.length*14*e.value*e.value}));var h=Math.floor(14*l[0].count*Math.sqrt(14*m*(d*p)/u));h=.9*Math.min(d,p/m,h,114);var f={type:"wordCloud",sizeRange:[14,80],rotationRange:[0,0],gridSize:12,textPadding:10,width:"80%",height:"80%",textStyle:{normal:{color:function(e){var t=o[e.dataIndex%o.length];return-1===s||s===e.dataIndex?t:"#D2D2D2"}}}};f.data=l.map((function(e){return{name:e.name,value:Math.sqrt(e.value),originValue:e.value}}));(0,y.Z)(t);var g={title:{text:"\u5178\u578b\u610f\u89c1",top:16,left:24,textStyle:{color:"#262626",fontSize:14,fontFamily:""+O.I8,fontWeight:"bold"}},tooltip:{padding:[16,12],backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",textStyle:{fontSize:12,color:"#262626"},extraCssText:"border-radius: 2px;\n        box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",formatter:function(e){var t=e.marker,a=e.name,n=e.data;return"<span>"+t+" "+a+'<span style="padding-left:46px">'+(0,T.rD)(n.originValue,2)+"</span></span>"}},grid:{top:0,bottom:0,left:0,right:0},series:[f]};t.refs.chart.setOption(g,!0)}else t.refs.chart.setEmptyOption(l)}else t.refs.chart.loading()},t.myChartClick=function(e){var a=e.dataIndex===t.state.selectIndex?void 0:e,n=e.dataIndex===t.state.selectIndex?-1:e.dataIndex;t.setState({selectIndex:n},(function(){t.buildChart()})),t.props.myChartClick(a,n)},t.getParams=function(){},t.buildBody=function(){return m.createElement(E.Z,{ref:"chart",className:"widget-chart",myChartClick:t.myChartClick})},t.refreshChart=function(e){e&&(t.projectId=e.projectId,t.type=e.type,t.time=e.time);var a=t.getParams();if(a){var n=(0,l.Z)({},a);n.projectId=t.projectId,n.type=t.type;var r=t.props.id;(r||t.projectId)&&(t.setState({json:null}),C((0,l.Z)({id:r},n),(function(e){var a;e?e.indexOf("{")<0&&e.indexOf("[")<0?a=e:(a=JSON.parse(e)).forEach&&0===a.length&&(a="\u6ca1\u6709\u53ef\u7528\u6570\u636e"):a="\u6ca1\u6709\u53ef\u7528\u6570\u636e",t.setState({json:a,time:+new Date})})))}else t.setState({json:"\u6ca1\u6709\u53ef\u7528\u6570\u636e",time:+new Date})},t}(0,c.Z)(t,e);var a=t.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){var t=e.json,a=e.activeOpinionIndex;this.setState({json:t,selectIndex:a})},a.UNSAFE_componentWillMount=function(){this.setState({colors:this.colors.normal,selectIndex:this.props.activeOpinionIndex})},a.componentDidUpdate=function(){this.buildChart()},a.componentDidMount=function(){this.width=this.refs.widget.offsetWidth,this.height=this.refs.widget.offsetHeight,window.addEventListener("resize",this.buildChart),this.state.json?this.buildChart():this.refreshChart()},a.componentWillUnmount=function(){window.removeEventListener("resize",this.buildChart)},a.render=function(){return m.createElement("div",{ref:"widget",className:this.isCanSetting?"widget-container with-aspect-bar":"widget-container"},this.buildBody())},t}(m.Component)),w=(a(43378),a(62443)),k=a(92360);const I=function(e){var t=e.getRef,n=e.title,r=e.list,i=e.loading,o=e.optionPage,s=e.activeOpinionIndex,l=e.multiColorsPositive,c=e.isAllColors,d=e.buildNum,p=e.renderWordOverlay,u=e.handleMyWordChartClick,h=e.handleOnOptionWordListPageChange;return m.createElement(m.Fragment,null,m.createElement("div",{className:"oppion-word",ref:t},m.createElement("div",{className:"word-title"},n),m.createElement("div",{className:"list"},0!==r.length||i?r.slice(40*(o-1),40*o).map((function(e,t,a){var n=40*(o-1)+t+1,r=n<=10?c?l[e.pos]:l[n%l.length]:c?l[e.pos]:"#8c8c8c",i=/(^[1-9]\d*$)/.test(a.length/10)?10:a.length-10*(a.length/10|0);return m.createElement("div",{key:n,className:a.length-t<=i?"back":"",style:{width:"calc("+(a.length<=30?a.length>20?33:50:25)+"% - 48px)"}},e?m.createElement(w.default,{overlayClassName:"popover-detail-wrodcloud-list-wrapper",placement:"top",content:p(e.name,r)},m.createElement("span",{className:"option-item "+(!1===s||s<0||n-1===s?"":"inactive-option-item"),onClick:function(){u(e,n-1)}},m.createElement("span",null,m.createElement("span",{style:{backgroundColor:""+r}},n)),m.createElement("span",null,e.name),m.createElement("span",null,d(e.value||e.hotWordFix,2)),e.ratio&&m.createElement("span",null,"("+e.ratio+")"))):null)})):m.createElement("div",{className:"no-data"},m.createElement("img",{src:a(3381)}),m.createElement("span",null,"\u6ca1\u6709\u6570\u636e\u53ef\u7528"))),r.length>40?m.createElement(k.Pagination,{className:"oppion-word-pagination",layout:"prev, pager, next",total:r.length,pageSize:40,currentPage:o,small:!0,onCurrentChange:h}):null))};var b=a(94644),S=a(60496),x=a(30381),_=a.n(x);const W=function(e){var t=e.time,a=(e.updateTime,e.descriptions),n=e.stop,r=e.handleOverTime,i=(0,m.useState)(_()()),o=i[0],s=i[1],l=(0,m.useState)(o&&o.diff(_()(t),"minutes")),c=l[0],d=l[1];return(0,m.useEffect)((function(){!0===n&&clearInterval(e);var e=window.setInterval((function(){return s(_()())}),1e3);return function(){clearInterval(e)}}),[n,c]),(0,m.useEffect)((function(){d(o.diff(_()(t),"minutes")),r(o.diff(_()(t),"minutes")||1)}),[o]),m.createElement(m.Fragment,null,a(c>0||_()(t).diff(o,"seconds")>=-60&&_()(t).diff(o,"seconds")<0,c,c<0?_()(t).diff(o,"minutes"):_()(t).diff(o,"seconds"),c>=0&&c<1?"\u79d2":"\u5206\u949f"))};var M=a(55609),D=a(68096),F=a(64396),L=["loading"],P=F.Z.opinion.opinionChart,R=F.Z.opinion.detail,Z=D.O9.normal,j={DAY:"\u5929",WEEK:"\u5468",MONTH:"\u6708"},H=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleOnWsMessage=function(e){var t=e.data;if(t.type&&"ws"===t.type){var n=a.props,r=n.resetData,i=n.handleMessageTotal,o=n.params,s=t.payload,l=s.type,c=s.result;"OPINION_TASK_RESULT"===l&&(c&&c.data&&o.messageTotal<5e3&&a.setState({status:"FINISH"}),c.taskId===o.taskId&&o.messageTotal>=5e3&&(r(c.taskId),a.setState({status:"FINISH"})),a.props.dispatch({type:P+"/handleOpinion",payload:c})),"OPINION_TASK_RESULT_FINAL"===l&&c.taskId===o.taskId&&i({messageTotal:c.messageTotal,opinionTotal:c.opinionTotal})}},a.changeChart=function(e){var t=e.clusterType;(0,a.props.dispatch)({type:P+"/save",payload:{wordCloud:"0"===t}}),a.setState({chartType:t})},a.myChartClick=function(e){var t=a.props,n=(t.json_bar,t.clusterType),r=t.queryParams.dateFilter,i=r.from,o=r.to,s=a.state.dateType,l=null;e&&e.name?l={time:e.name,type:s,sideType:e.sideType,sideTime:"first"===e.sideType?i:"last"===e.sideType?o:""}:e&&e.analysis&&(l={analysis:e.analysis}),l.clusterType=n,a.clickTimeId&&clearTimeout(a.clickTimeId),a.clickTimeId=setTimeout((function(){a.props.refreshMessage(l),a.refs.wordCloud&&a.refs.wordCloud.resetState(),a.clickTimeId=void 0}),1e3)},a.resetWordcloudState=function(){setTimeout((function(){a.refs.wordCloud&&a.refs.wordCloud.resetState(),a.setState({activeOpinionIndex:-1,activeOpinionName:""})}),0)},a.resetBarchartState=function(){setTimeout((function(){a.refs.bar&&a.refs.bar.resetChartRender()}),0)},a.handleMyWordChartClick=function(e,t){var n=a.props,r=n.queryTimeType,i=n.clusterType,o=n.dispatch,s=n.params,l=(n.textRankWord,n.baseType),c=n.refreshOtherChart,d=a.state.activeOpinionIndex;a.setState({activeOpinionIndex:d===t||-1===t?-1:t,activeOpinionName:d===t||-1===t?"":e.name},(function(){var n=e?{opinion:d===t?{}:e.name,type:r,clusterType:i}:null,p=n&&n.opinion?l||"typicalOpinion":"textRankWord"===l?l:"";("typicalOpinion"===p||!p)&&o({type:R+"/fetchWordData",payload:{projectId:s.projectId,enablePos:!0,headerFilterParamsNew:s.headerFilterParamsNew,messageCategory:s.messageCategory||s.queryType,topSize:100,dateFilter:s.dateFilter,filterModel:s.filterModel,typicalOpinion:d===t||-1===t?"":e.name}}).then((function(e){e&&("typicalOpinion"===p||!p)&&c()})),a.props.refreshMessage(n||{opinion:{}}),o({type:R+"/save",payload:{typicalOpinion:d===t||-1===t?"":e.name,optionPage:1}}),o({type:P+"/save",payload:{baseType:p}}),a.clickTimeId&&clearTimeout(a.clickTimeId),a.clickTimeId=setTimeout((function(){a.refs.bar&&a.refs.bar.resetState(),a.clickTimeId=void 0}),100)}))},a.onWindowResize=function(){setTimeout((function(){a.resize()}),300)},a.resize=function(){if(a.flexWrapper){var e=a.flexWrapper.offsetWidth*a.rate;a.flexSpan.style.fontSize=e+"px"}a.refs.bar&&a.refs.bar.refs.chart.myChart.resize()},a.changeQueryTime=function(e){e.name;var t=e.id,n=a.props,r=n.queryParams,i=n.dispatch,o=JSON.parse(JSON.stringify(r));o.dateFilter.dateGroupType=t,a.setState({dateType:t}),i({type:P+"/save",payload:{queryTimeType:t,queryParams:o}})},a.renderOpinionOverlay=function(){return m.createElement("div",null,"\u9488\u5bf9\u6d88\u606f\u6587\u672c\u4e2d\u7684\u89c2\u70b9\u505a\u805a\u7c7b\u5f62\u6210\u5178\u578b\u610f\u89c1\uff0c\u805a\u7c7b\u9897\u7c92\u5ea6\u7684\u7c97\u7ec6\u4f1a\u5f71\u54cd\u5178\u578b\u610f\u89c1\u7684\u5c55\u793a\u6570\u91cf\uff0c\u9897\u7c92\u5ea6\u8d8a\u7ec6\u5c55\u793a\u7684\u6570\u91cf\u8d8a\u591a\u5ea6\u6765\u67e5\u770b\u66f4\u591a\u5178\u578b\u610f\u89c1\u3002\u5178\u578b\u610f\u89c1\u5f62\u6210\u6b65\u9aa4\uff1a\u2460\u4ece\u6d88\u606f\u4e2d\u62bd\u53d6\u89c2\u70b9\u2192\u2461\u5bf9\u89c2\u70b9\u805a\u7c7b\u2192\u2462\u62bd\u53d6\u4e2d\u5fc3\u89c2\u70b9\u3002")},a._handleMoreClick=function(e){var t=a.props,n=t.json_word,r=t.json_bar,i=t.queryTimeType,o=t.wordCloud;if("wImage"===e)o?(0,b._v)(a.refs.wordCloud.refs.chart.myChart,"\u5178\u578b\u610f\u89c1"):(0,b.Mx)(a.state.wordTable,"\u5178\u578b\u610f\u89c1");else if("bImage"===e)(0,b._v)(a.refs.bar.refs.chart.myChart,"\u6570\u636e\u8d8b\u52bf");else if("bExcel"===e){var s=r.reduce((function(e,t){return[].concat(e,[[t.time,t.count]])}),[["\u65e5\u671f/\u6309"+j[i],"\u8bcd\u9891"]]);(0,b.aT)([s],"\u6570\u636e\u8d8b\u52bf")}else if("wExcel"===e){var l=n.reduce((function(e,t){return t?[].concat(e,[[t.name,t.value,t.percent+"%"]]):e}),[["\u5178\u578b\u610f\u89c1","\u89c2\u70b9\u6570","\u5360\u6bd4"]]);(0,b.aT)([l],"\u5178\u578b\u610f\u89c1")}},a._handleCommonChange=function(e){var t=a.props,n=t.dispatch,r=t.refreshing,i=t.reloaded,o=t.allData,s=t.type,l=(t.hasRecord,e.clusterType);if(r&&3!==s&&!i||4===s){var c=o[l];n({type:P+"/save",payload:{clusterType:l,json_word:c,optionPage:1}})}else n({type:P+"/save",payload:{clusterType:l,optionPage:1}}),n({type:P+"/getWordCloudList"});a.setState({optionPage:1})},a.renderWordOverlay=function(e){return m.createElement("div",{className:"opinion-tooltip",onClick:function(e){e.stopPropagation()}},m.createElement("span",null,e),m.createElement("span",{className:"hide",onClick:function(t){a._handleWordHideClick(e)}},"\u9690\u85cf"))},a._handleWordHideClick=function(e){var t=a.props,n=t.json_word,r=t.dispatch,i=n.filter((function(t){return t&&t.name!==e}));Math.ceil(n.length/40);i=[].concat(i),V(i),r({type:P+"/save",payload:{json_word:i}})},a._handleOnOptionWordListPageChange=function(e){a.props.dispatch({type:P+"/save",payload:{optionPage:e}})},a._handleUpdateClick=function(e){var t=a.props,n=t.dispatch,r=t.params,i=t.resetData;n({type:P+"/taskUpdate",payload:{id:e}}).then((function(e){e&&i(r.taskId)}))},a._handleResetSelected=function(){a.setState({activeOpinionIndex:-1,activeOpinionName:""})},a.state={activeOpinionName:"",activeOpinionIndex:-1,dateType:"DAY",chartType:void 0,wordTable:void 0,predictTime:void 0,status:void 0},a}(0,c.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props,t=e.type,a=e.dispatch,n=e.opinion,r=(e.hasRecord,e.taskId),i=e.params;if(location.search.length>0&&"/tab/detail"===location.pathname){var o=JSON.parse(decodeURIComponent(location.search).split("?")[1]);a({type:P+"/save",payload:{queryParams:o,queryTimeType:o.dateFilter.dateGroupType,type:t,currTaskId:r,otherTaskId:i.otherTaskId}})}if(n&&(2===t||3===t)&&a({type:P+"/getWordCloudList"}),this.flexWrapper){var s=this.flexWrapper.offsetWidth;this.rate=.03,this.flexSpan.style.fontSize=s*this.rate+"px"}},n.UNSAFE_componentWillReceiveProps=function(e,t){var a=this.props,n=a.dispatch,r=(a.opinion,this.props.taskId),i=e.taskId,o=this.props.params.otherTaskId,s=e.params.otherTaskId;r===i&&o===s||n({type:P+"/save",payload:{currTaskId:i,otherTaskId:s}}),this.props.type!==e.type&&n({type:P+"/save",payload:{type:e.type}}),JSON.stringify(this.props.params)!==JSON.stringify(e.params)&&n({type:P+"/save",payload:{queryParams:e.params,queryTimeType:e.params.dateFilter&&e.params.dateFilter.dateGroupType||"DAY"}})},n.componentWillMount=function(){(0,this.props.dispatch)({type:P+"/save",payload:{count:0,average:0,json_bar:"\u6ca1\u6709\u6570\u636e\u53ef\u7528",json_word:[]}}),window.addEventListener("message",this._handleOnWsMessage)},n.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage)},n.shouldComponentUpdate=function(e,t){var a=this.props,n=a.clusterType,r=a.json_word,i=a.json_bar,o=a.opinionTaskValid,s=a.queryTimeType,l=a.refreshing,c=a.wordCloud,d=a.allData,p=a.loading,u=a.defaultValues,m=a.params,h=a.optionPage,f=e.clusterType,g=e.json_word,y=e.json_bar,v=e.opinionTaskValid,C=e.queryTimeType,E=e.refreshing,O=e.wordCloud,N=e.allData,w=e.loading,k=e.defaultValues,I=e.params,b=e.optionPage;if(n!==f||o!==v||s!==C||l!==E||c!==O||p!==w||h!==b||!(0,T.dm)(r,g)||!(0,T.dm)(i,y)||!(0,T.dm)(d,N)||!(0,T.dm)(u,k)||!(0,T.dm)(m,I))return!0;var S=this.state,x=S.activeOpinionIndex,_=S.activeOpinionName,W=S.predictTime,M=S.status;return x!==t.activeOpinionIndex||_!==t.activeOpinionName||W!==t.predictTime||M!==t.status},n.componentDidUpdate=function(e){var t=this.props.json_word,a=e.json_word,n=this.state.activeOpinionName;!(0,T.dm)(t,a)&&n&&this.setState({activeOpinionIndex:t.map((function(e){return e&&e.name})).indexOf(n)})},n.render=function(){var e=this,t=this.props,n=t.type,r=t.wordCloud,i=(t.json_bar,t.average,t.queryTimeType,t.json_word),o=(t.queryParams,t.opinion),s=t.clusterType,l=t.refreshing,c=(t.allData,t.opinionTaskValid),d=t.invalidReason,p=(t.hasRecord,t.clusterTypeOptions),u=t.wordSelectOpts,g=t.loading,y=t.params,v=t.handleDefaultValue,C=t.defaultValues,E=t.optionPage,O=C.clusterType,w=this.state,k=w.activeOpinionIndex,b=w.chartType,x=w.status;return m.createElement("div",{className:"detailChart"},o&&m.createElement("div",{className:"detailChart-bottom"},m.createElement(f.default,{wrapperClassName:"chart-table",spinning:g,tip:"\u6b63\u5728\u52a0\u8f7d\u4e2d",size:"large"},i?c?i.length>0?r?m.createElement(N,{index:4===n?1:0,ref:"wordCloud",json:i,activeOpinionIndex:k,myChartClick:this.handleMyWordChartClick}):m.createElement(I,{getRef:function(t){return e.setState({wordTable:t})},title:"\u5178\u578b\u610f\u89c1",list:i.filter((function(e){return e})),optionPage:E,activeOpinionIndex:k,multiColorsPositive:Z,buildNum:T.rD,renderWordOverlay:this.renderWordOverlay,handleMyWordChartClick:this.handleMyWordChartClick,handleOnOptionWordListPageChange:this._handleOnOptionWordListPageChange}):m.createElement("div",{className:"no-data"},m.createElement("img",{src:a(3381)}),m.createElement("span",null,"\u6682\u65e0\u6570\u636e")):m.createElement("div",{className:"no-data"},0!==d&&m.createElement(m.Fragment,null,m.createElement("img",{src:a(6714),style:{width:"80px"}}),m.createElement("span",null,"\u5f53\u524d",1===d?"\u6d88\u606f\u4e2d\u5c11\u4e8e20\u4e2a\u89c2\u70b9":2===d?"\u5c0f\u4e8e50\u6761\u6d88\u606f":"\u5927\u4e8e50\u4e07\u89c2\u70b9\u6570","\uff0c\u5df2\u8d85\u4e0a\u9650\uff0c\u65e0\u6cd5\u8ba1\u7b97\u5178\u578b\u610f\u89c1"))):null),i&&m.createElement(m.Fragment,null,(0===i.length||g)&&m.createElement("div",{className:"t-title"},"\u5178\u578b\u610f\u89c1"),m.createElement(h.Z,{placement:"top",overlayStyle:{maxWidth:236},overlay:this.renderOpinionOverlay()},m.createElement("div",{className:"tip"},m.createElement("i",{className:"icon-cem_file1"}))),m.createElement("div",{className:"buttons"},m.createElement("span",{className:"clustering"},m.createElement("span",{className:l?"":"disapper"},"\u805a\u7c7b\u9897\u7c92\uff1a"),m.createElement(S.Z,{activeObj:s,onChange:this._handleCommonChange,options:p,objName:"clusterType",rightHook:!0})),m.createElement(S.Z,{className:"chartType "+(b?"set_Top_active":""),activeObj:b||(O||"0"),flavor:O||"0",onFlavorChange:v,onChange:this.changeChart,options:u,objName:"clusterType",rightHook:!0}),m.createElement(h.Z,{overlay:"\u5bfc\u51fa\u6570\u636e",placement:"top",mouseEnterDelay:.6},m.createElement("i",{className:"icon-daochu",onClick:function(){return e._handleMoreClick("wExcel")}})),m.createElement(h.Z,{overlay:"\u5bfc\u51fa\u56fe\u7247",placement:"top",mouseEnterDelay:.6},m.createElement("i",{className:"icon-xiazaitupian",onClick:function(){return e._handleMoreClick("wImage")}})))),c&&m.createElement(m.Fragment,null,y.status&&y.status.indexOf("CALCULATING")>-1&&!x&&m.createElement("div",{className:"chartTip"},m.createElement(W,{time:y.predictTime,descriptions:function(e,t,a,n){return e?m.createElement("span",{className:"timeTip"},y.messageTotal>5e3?"\u5f53\u524d\u5c55\u793a\u7684\u662f\u6700\u65b05000\u6761\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1\u7ed3\u679c\uff0c\u8ba1\u7b97\u6240\u6709\u6d88\u606f\u7684\u7ed3\u679c":"","\u5df2\u8d85\u65f6",t||1,"\u5206\u949f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85"):m.createElement("span",{className:"timeTip"},y.messageTotal>5e3?"\u5148\u8ba1\u7b97\u6700\u65b0\u76845000\u6761\u6d88\u606f\uff0c":"","\u9884\u8ba1",a,n,"\u540e\u53ef\u67e5\u770b",y.messageTotal>5e3?"\u6240\u6709\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1":"","\u7ed3\u679c")},handleOverTime:function(t){return t>60&&e.setState({status:"FAILURE"})}}),m.createElement("i",{className:"icon-cem_auto-refresh refresh-animation",style:{color:"#7262FD"}})),(y.status&&y.status.indexOf("FAILURE")>-1||"FAILURE"===x)&&m.createElement("p",{className:"chartTip"},"\u5f53\u524d\u5c55\u793a\u7684\u662f\u6700\u65b05000\u6761\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1\u7ed3\u679c\uff0c\u7cfb\u7edf\u8ba1\u7b97\u5168\u90e8\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1\u7ed3\u679c\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u8ba1\u7b97",m.createElement("i",{className:"icon-cem_auto-refresh",style:{color:"#7262FD",marginLeft:4,cursor:"pointer"},onClick:function(){return e._handleUpdateClick(y.taskId)}})))))},(0,g.Z)(t,[{key:"formatterData",get:function(){var e=this.props.count,t=String(e);if(t.length>3){var a=t.split(""),n="",r=a.length,i=r-(3+(r%3===0?3:r%3));i>=3&&i<6&&r>6?n="K":i>=6&&(n="M");for(var o=0,s=r;s>0;s--)0!==o&&o%3===0&&a.splice(s,0,","),o++;return a.slice(0,a.indexOf(",")+4).join("")+n}return e}}]),t}(m.Component);const A=(0,M.connect)((function(e){e.loading;var t=(0,n.Z)(e,L);return(0,l.Z)({},t[P],{defaultValues:t[R].defaultValues})}),null,null,{withRef:!0})(H);var V=function(e){var t=e.reduce((function(e,t){return t?e+t.value:e}),0);e.forEach((function(e){e&&(e.ratio=(e.value/t*100).toFixed(2)+"%")}))},J=(a(75314),a(11187)),z=(a(89858),a(51024)),G=a(5133),B=a(38425),U=(a(12234),a(94184),a(61193)),q="COMMENT",Y="SELF";const K=function(e){var t=e.data,a=t.content,n=t.messageId,i=t.highLight,o=e.tagHoverInfo,s=e.currentHighLight,l=e.sourceEmotion,c=e.renderContent;return m.createElement(r.default,{className:"blog-body",dangerouslySetInnerHTML:{__html:c(a,o.id===n&&(null==s?void 0:s.length)>0?[].concat(i,s):i,o.id===n?o:l)}})};var Q=a(52314),$=a(21554);const X=function(e){var t=e.renderContent,a=e.data,n=a.title,r=a.content,i=a.messageId,o=a.highLight,s=void 0===o?[]:o,c=a.pictures,d=a.vimg,p=a.video,u=a.messageCategory,h=a.sourceId,f=e.tagHoverInfo,g=e.currentHighLight,y=e.sourceEmotion,v=m.useState(null),C=v[0],E=v[1],O=(0,m.useState)(!0),T=O[0],N=O[1],w=m.useState(!1),k=w[0],I=w[1],b=(0,m.useState)({isShowPreview:!1,sourcePicArr:[],startIndex:0}),S=b[0],x=b[1];return(0,m.useEffect)((function(){C&&function(){if(C.getElementsByTagName("img").length>0)var e=2,t=setInterval((function(){e>0?C&&C.scrollHeight>48?(I(!0),clearInterval(t)):e--:clearInterval(t)}),200);else C&&C.scrollHeight>48&&I(!0)}()}),[C]),m.createElement(m.Fragment,null,n&&m.createElement("h5",{className:"content_title"},n),m.createElement("div",{ref:function(e){return E(e)},className:"blog-body self "+(T?"content_text":""),style:{maxHeight:T?48:"unset"},dangerouslySetInnerHTML:{__html:t(r,f.id===i&&(null==g?void 0:g.length)>0?[].concat(s,g):s,f.id===i?f:y)}}),m.createElement(Q.X,{className:"blog-footer"},(c||d)&&function(e){var t=e.pictures,a=e.vimg,n=e.video,r=(e.messageCategory,e.sourceId),i=[];try{i=JSON.parse(t),"1"===r&&i.forEach((function(e,t){return i[t]=e.replace(/s\d{2,3}x\d{2,3}/,"s960x960")})),"51"===r&&i.forEach((function(e,t){return i[t]=e.replace(/US\d{2,3}/,"US960")}))}catch(o){}return(a||i.length>0)&&m.createElement("div",{className:"picture_weibo"},a&&m.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},m.createElement("span",{className:"video_cover",style:{backgroundImage:"url("+a+")"}},m.createElement("i",{className:"icon-shipinbofang"}))),i.length>0&&i.reduce((function(e,t,a){return a<9?[].concat(e,[m.createElement("img",{className:"pic_cover "+(i.length>9&&8===a?"pic_end":""),key:a,src:t,onClick:function(e){!function(e,t,a){var n=a.map((function(e){return{thumbnail:e,original:e}}));x({isShowPreview:!0,sourcePicArr:n,startIndex:t})}(0,a,i)}})]):e}),[]),m.createElement($.Z,{startIndex:S.startIndex,images:S.sourcePicArr,closeDialog:function(){x((0,l.Z)({},S,{isShowPreview:!1}))},isShow:S.isShowPreview}))}({pictures:c,vimg:d,video:p,messageCategory:u,sourceId:h}),k&&m.createElement("div",{className:"content_search",onClick:function(){return N(!T)}},T?"\u663e\u793a\u5168\u6587":"\u6536\u8d77\u5168\u6587")))};var ee;const te=((ee={})[q]=K,ee[Y]=X,ee);var ae=a(66746);const ne=function(e){var t=e.data,a=e.handleHighLight;return m.createElement(r.default,{className:"blog-foot detail-footer"},m.createElement(i.default,{className:"asp asp-name",flex:"0 1 40px"},"\u6307\u6807"),m.createElement(i.default,{className:"asp",flex:"1"},t.aspects.sort((function(e,t){return t.escore-e.escore})).map((function(e,t){return m.createElement(h.Z,{key:"aspects_"+t,mouseEnterDelay:.6,overlay:m.createElement("div",{className:"aspects_tip"},m.createElement("p",null,m.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),m.createElement("span",null,e.aspect1)),m.createElement("p",null,m.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),m.createElement("span",null,e.aspect2)),m.createElement("p",null,m.createElement("span",null,"\u6307\u6807\u60c5\u611f"),m.createElement("span",null,8===e.escore?"\u6b63\u9762":"\u8d1f\u9762"))),placement:"bottom"},m.createElement("span",{className:8===e.escore?"asp-positive":"asp-negative",onMouseEnter:function(){return a(e)},onMouseLeave:function(){return a()}},e.aspect2))}))))};const re=function(e){var t=e.data,a=(e.maxWidth,e.handleHighLight),n=e.handleOnFeedback,r=e.handleFeedBack;return m.createElement("div",{className:"self-footer"},m.createElement("div",{className:"asp-wrapper"},t.aspects&&t.aspects.filter((function(e){return"\u672a\u5206\u7c7b"!==e.aspect2})).length>0&&m.createElement(ne,{data:t,handleHighLight:a})),m.createElement("div",{className:"blog-body message-detail"},m.createElement("span",{className:"source ellipsis"},"\u6765\u6e90\uff1a",t.sourceName),m.createElement("a",{href:t.url,target:"_blank",className:"line ellipsis icon-cem_data-source",rel:"noreferrer"},"\u6570\u636e\u6e90"),m.createElement("span",{className:"feedback",onClick:function(){return n(t)}},"\u53cd\u9988"),m.createElement(ae.Z,{ref:r})))};var ie;const oe=((ie={})[q]=function(e){var t=e.data,a=e.maxWidth,n=e.handleHighLight,r=e.handleOnFeedback,i=e.handleFeedBack;return m.createElement(m.Fragment,null,t.aspects&&t.aspects.filter((function(e){return"\u672a\u5206\u7c7b"!==e.aspect2})).length>0&&m.createElement(ne,{data:t,handleHighLight:n}),m.createElement("div",{className:"blog-body message-detail"},m.createElement("span",{className:"title line ellipsis",style:{maxWidth:a},title:t.title?t.title:""},"- "+(t.title?t.title:"")),m.createElement("div",null,m.createElement("span",{className:"source line ellipsis"},"\u6765\u6e90\uff1a",t.sourceName),m.createElement("span",{className:"connect line ellipsis",style:{maxWidth:a},title:t.title},"\u94fe\u63a5\uff1a",t.connectionName),m.createElement("a",{href:t.url,target:"_blank",className:"line ellipsis",rel:"noreferrer"},"\u6570\u636e\u6e90"),m.createElement("span",{className:"feedback",onClick:function(){return r(t)}},"\u53cd\u9988"),m.createElement(ae.Z,{ref:i}))))},ie[Y]=re,ie);const se=function(e){var t=e.queryType,n=e.loadingId,o=e.v,s=e.k,l=e.item,c=e.tagHoverInfo,d=e.currentHighLight,p=e.sourceEmotion,u=e.maxWidth,h=e.renderContent,g=e.handleOnFeedback,y=e.handleHighLight,v=e.handleFeedBack,C=te[t],E=oe[t];return m.createElement(f.default,{spinning:n===o.commentId,key:l.commentId+s},m.createElement("div",{className:"blog-container "+t},m.createElement(r.default,{className:"blog-title"},m.createElement(i.default,{className:"base-info source"},m.createElement("span",{className:"source-img"},m.createElement("img",{src:l.userImage?l.userImage.startsWith("http")?l.userImage:location.protocol+"//"+l.userImage:a(88958),"data-url":l.userImage,alt:"\u5934\u50cf"}))),m.createElement(i.default,{className:"base-info product"},l.username),m.createElement(i.default,{className:"base-info  pull-right"},null!=o.score&&0!==o.score&&m.createElement(k.Rate,{className:"rate",disabled:!0,key:o.score+s,value:o.score,colors:["#FF8373","#FF8373","#FF8373"],showText:!1}),m.createElement("span",{className:"time"},_()(l.createTime).format("YYYY/MM/DD HH:mm")))),m.createElement(C,{renderContent:h,data:l,tagHoverInfo:c,currentHighLight:d,sourceEmotion:p}),m.createElement(E,{data:l,maxWidth:u,handleHighLight:y,handleOnFeedback:g,handleFeedBack:v})))};var le=a(39432);_().locale("zh-cn");var ce=z.default.Search,de=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageTable=function(e){var t=n.state,a=(t.info,t.isInitial);if(n.setState({isLoading:!0,pageIndex:e},(function(){return n.searchTable(null)})),!a)if(location.pathname.includes("opinion")){var r=document.getElementsByClassName("content-sidebar")&&document.getElementsByClassName("content-sidebar")[0];r&&(r.scrollTop=760)}else{var i=document.getElementsByClassName("content")&&document.getElementsByClassName("content")[0];i&&(i.scrollTop=620)}},n.searchTable=function(e){var t=n.state,a=t.params,r=t.pageSize,i=t.pageIndex,o=t.searchValue,s=(t.data,n.props),c=s.initParams,d=s.clusterType,p=s.baseType,u={},m=n.state.info,h=m.textRankWord,f=m.typicalOpinion;if(a.filterModel||a.dateFilter){var g={projectId:a.projectId,dateFilter:a.dateFilter,headerFilterParamsNew:a.headerFilterParamsNew,messageCategory:a.messageCategory||a.queryType,filterModel:Object.assign(a.filterModel?a.filterModel:{},{clusterLevel:d||20,taskId:n.props.params.taskId})},y=e?e.opinion?"opinion":"hot":null,C=f.opinion,E=h.content;switch(y){case"hot":h=e,g.textRankWord=e.content,g.typicalOpinion="typicalOpinion"===p?C:"",f="typicalOpinion"===p?f:{};break;case"opinion":"{}"!==JSON.stringify(e.opinion)?(f=e,g.typicalOpinion=e.opinion):f={},h="textRankWord"===p?h:{},g.textRankWord="textRankWord"===p?E:"";break;default:C&&(g.typicalOpinion=C),E&&(g.textRankWord=E)}g.filterModel.content?o?g.filterModel.content=[{contain:[].concat(o.trim().split(" "))}]:a.filterModel.content&&c.filterModel.content?g.filterModel.content=c.filterModel.content:delete g.filterModel.content:a.filterModel&&!a.filterModel.content&&o&&(g.filterModel.content=[{contain:[].concat(o.trim().split(" "))}]),g.pageSize=r,g.pageIndex=e?0:i,n.setState({listLoading:!0},(function(){return v.h.post("/opinion/message/find",(0,l.Z)({},g,{pageIndex:g.pageIndex>0?20*(g.pageIndex-1):0})).then((function(e){var t=e.data.result;if(t.result){g.typicalOpinion&&"{}"!==JSON.stringify(g.typicalOpinion)&&t.result.length>0?c.opinionTotal>=60?n.props.handleOpinionHighlight({projectId:g.projectId,messageIds:t.result.map((function(e){return e.messageId})),taskId:n.props.params.taskId,typicalOpinion:g.typicalOpinion,clusterLevel:g.filterModel.clusterLevel}).then((function(e){e&&(u=e.dataMap,n.setState({data:t.result.map((function(e){return e.highLight=u&&u[e.messageId],e}))}))})):n.setState({data:t.result.map((function(e){return e.highLight=g.typicalOpinion,e}))}):n.setState({data:t.result.map((function(e){return e.highLight=null,e}))});var r=(0,l.Z)({},a,g);delete r.messageCategory,n.setState({pageIndex:g.pageIndex?g.pageIndex:0,listLoading:!1,isLoading:!1,searchValue:o,info:{textRankWord:h,typicalOpinion:f},data:t.result,params:r,count:{total:t.count>5e4?5e4:t.count,aspectTotal:t.aspectTotal},isInitial:!1})}else n.setState({listLoading:!1,isLoading:!1,searchValue:o,info:{textRankWord:h,typicalOpinion:f},data:t.result,params:(0,l.Z)({},g,{aspect:g.filterModel.opinion}),pageIndex:g.pageIndex?g.pageIndex:0,count:{total:t.count>5e4?5e4:t.count,aspectTotal:0},isInitial:!1})}))}))}},n.selectChange=function(e){n.setState({selectedIndex:e})},n.renderAllMessage=function(e){var t=n.state,r=t.sourceEmotion,i=t.params,o=t.loadingId,s=(t.seriesName,t.listLoading),l=t.currentHighLight,c=t.tagHoverInfo;n.state.lock;U.Z.hasAuthority("REVIEW_MESSAGE_LOCK");var d=(document.documentElement.clientWidth-64-36-76-68-24-32-200)/2;return m.createElement("div",{ref:"blogs",className:"message-list"},m.createElement(f.default,{spinning:s},e.length>0?e.map((function(e,t){var a=e;return m.createElement(se,{key:t,queryType:i.queryType||i.messageCategory,loadingId:o,v:e,k:t,item:a,tagHoverInfo:c,currentHighLight:l,sourceEmotion:r,maxWidth:d,renderContent:function(){var e;return(e=n).renderContent.apply(e,arguments)},handleOnFeedback:function(){var e;return(e=n)._handleOnFeedback.apply(e,arguments)},handleHighLight:function(e){var t;return e?(null==(t=e.highLightInfoList)?void 0:t.length)>0&&n.setState({currentHighLight:[].concat(e.highLightInfoList),tagHoverInfo:{id:e.msgId,type:e.escore}}):n.setState({currentHighLight:[],tagHoverInfo:{}})},handleFeedBack:function(e){return n.drawerRef=e}})})):m.createElement("div",{className:"no-data"},m.createElement("img",{src:a(3381)}),m.createElement("span",null,"\u6682\u65e0\u6570\u636e"))))},n.exportData=function(e){var t=JSON.parse(JSON.stringify(e));t.name=t.leftName,t.leftName="",B.Z.exportData((0,l.Z)({},t,{type:"COMMENT"}),(function(e){var t=e;2e4===t.code?G.Z.success(t.msg+"\uff0c\u8bf7\u5230\u4e2a\u4eba\u4e2d\u5fc3\u7684\u4e0b\u8f7d\u5217\u8868\u6216\u8005\u70b9\u51fb\u53f3\u4e0a\u89d2\u201c\u5c0f\u94c3\u94db\u201d\u4e0b\u8f7d\u3002"):G.Z.error(t.msg)}))},n._handleSearchButtonClick=function(e){var t=n.state,a=(t.params,t.info);a&&void 0!==a.hide&&delete a.hide,n.setState({hasSearched:!0,searchValue:e},(function(){return n.searchTable(null)}))},n._handleOnFeedback=function(e){var t=n.props.params,r=JSON.parse(JSON.stringify(t));n.drawerRef.show({aspectList:e.aspects,callback:function(t){v.h.post("/data_feedback/save",{feedbackDetails:t,messageId:e.commentId,projectId:r.projectId,messageContent:e.content,historyTag:JSON.stringify(e.aspects.filter((function(e){return e.escore})).map((function(e){return{aspect:e.aspect2,escore:e.escore}})))}).then((function(e){2e4===e.data.code&&J.default.success({style:{marginTop:"85px"},className:"feedback_success_message",content:m.createElement("div",{className:"feedback_success_tip"},m.createElement("img",{src:a(43134)}),m.createElement("p",null,"\u6307\u6807\u53cd\u9988\u6210\u529f\uff0c\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01"))})}))}})},n.state={data:null,isLoading:!0,loadingId:null,info:{textRankWord:{},typicalOpinion:{}},searchValue:"",params:{},pageIndex:1,pageSize:20,count:{},sourceEmotion:null,emotion:"",lock:!0,listLoading:!1,aspects:null,selectedIndex:null,lastClickedTime:0,lastClickedMsgId:0,seriesName:[],hasSearched:!1,isInitial:!0,mParams:void 0,currentHighLight:[],tagHoverInfo:{}},n}(0,c.Z)(t,e);var n=t.prototype;return n.renderContent=function(e,t,a){var n=this.state,r=n.params,i=n.info,o=i.textRankWord,s=(i.typicalOpinion,r.filterModel&&r.filterModel.content&&r.filterModel.content[0]&&r.filterModel.content[0].contain),l=(0,le.Lh)(e||""),c=8===(null==a?void 0:a.type)||(null==a||!a.type)&&a?'<a class="highlight-green">':'<a class="highlight-red">',d=[].concat([].concat(s,[o.content])).filter((function(e){return e}));if(Array.isArray(t)&&t.length>0){var p=t.filter((function(e){return"string"===typeof e&&e.indexOf("-")<0})),u=t.filter((function(e){return!p.includes(e)})).map((function(e){return e&&"string"===typeof e&&((e=e.split("-"))[1]=Number(e[0])+Number(e[1])),e})),m=l.split("");if(u.forEach((function(e){(0,T.W5)(m,e,c)})),l=m.join(""),p.length>0){var h=new RegExp(p[0],"g"),f='<span class="highlight-blue">'+p[0]+"</span>";l=l.replace(h,f)}}else if(t&&"string"===typeof t){var g=new RegExp(t,"g"),y='<span class="highlight-blue">'+t+"</span>";l=l.replace(g,y)}return d&&d.length>0&&d.forEach((function(e){var t=new RegExp(e,"g"),a='<span class="highlight-yellow">'+e+"</span>";l=l.replace(t,a)})),l},n.componentWillMount=function(){var e=this.props.params,t=this.state.seriesName;e?this.setState({params:e,seriesName:t}):this.setState({params:{},sourceEmotion:"",seriesName:""})},n.componentDidMount=function(){this.props.params&&this.searchTable(this.state.info)},n.UNSAFE_componentWillReceiveProps=function(e){var t=e.params,a=this.state.seriesName;t&&this.setState({params:t,seriesName:a})},n.render=function(){var e=this,t=this.state,a=t.params,n=t.data,r=t.isLoading,i=t.pageIndex,o=t.count,s=t.pageSize,l=t.info,c=t.searchValue,d=t.mParams;this.props.type,this.state.lock;U.Z.hasAuthority("REVIEW_MESSAGE_LOCK");!l||!l.opinion&&l.hide;if(d)d.from+" ~ "+d.to;else if(l){if(l.opinion)l.opinion;else if(l.content)l.content.contain[0];else if(l.time){var p=(0,le.LV)(l.time,"WEEK");"WEEK"===l.type?p.from+" ~ "+p.to:a.dateFilter.from+" ~ "+a.dateFilter.to}}else a.dateFilter&&a.dateFilter.from+" ~ "+a.dateFilter.to;return m.createElement("div",{className:"message-detail-wrapper"},m.createElement("div",{className:"message-top"},m.createElement("div",{className:"left-title"},m.createElement("span",null,"\u6d88\u606f\u8be6\u60c5",m.createElement(h.Z,{overlay:"\u6839\u636e\u7b5b\u9009\u6761\u4ef6\u5b9e\u65f6\u67e5\u8be2\u6d88\u606f\uff0c\u56e0\u4e3a\u9879\u76ee\u4e2d\u7684\u6570\u636e\u5b9e\u65f6\u66f4\u65b0\uff0c\u6709\u65f6\u4f1a\u8ddf\u4e0a\u9762\u5448\u73b0\u7684\u6d88\u606f\u6570\u4e0d\u4e00\u81f4\uff0c\u5c5e\u4e8e\u6b63\u5e38\u8303\u56f4\u3002\u5f53\u6d88\u606f\u6570\u5f88\u591a\u65f6\uff0c\u53ea\u5c55\u793a\u6700\u65b0\u76845\u4e07\u6761\u6d88\u606f\u3002",placement:"top",align:{offset:[4,-4]},overlayStyle:{maxWidth:216},mouseEnterDelay:.2},m.createElement("i",{className:"icon-cem_file1"})))),m.createElement("div",{className:"right"},m.createElement(ce,{placeholder:"\u8bf7\u8f93\u5165\u5173\u952e\u8bcd",size:"small",style:{width:180},allowClear:!0,suffix:m.createElement("span",{onClick:function(t){return e._handleSearchButtonClick(c)}},m.createElement("i",{className:"icon-cem_small-search",style:{color:"#8c8c8c"}})),onChange:function(t){return e.setState({searchValue:t.target.value})},onSearch:function(t){return e._handleSearchButtonClick(t)}}),m.createElement(h.Z,{overlay:"\u5bfc\u51fa\u6570\u636e",placement:"top",mouseEnterDelay:.6},m.createElement("i",{className:"icon-daochu",onClick:function(){return e.exportData(a)}})))),n&&this.renderAllMessage(n),!!o.total&&m.createElement("div",{className:"pager-container"},m.createElement(k.Pagination,{pageSize:s,className:"pagination",small:!0,total:o.total,layout:"prev, pager, next",currentPage:i,onCurrentChange:this.getPageTable})),r&&!n&&m.createElement("div",{className:"loadingWrapper"},m.createElement(f.default,{spinning:{loadState:r}})))},t}(m.Component),pe=a(50976);a(25713);const ue=function(e){var t=e.getWordcloudTableRef,n=e.getWordcloudChartRef,r=e.onChartClick,i=e.onMoreClick,o=e.onChartMouseOut,s=e.onChartMouseOver,l=e.loading,c=e.onWordcloudChartFinish,d=e.selectedGraphicName,p=e.wordSelectOpts,u=e.chartType,g=e.defaultValues.clusterHotType,y=e.changeChart,v=e.wordCloud,C=e.optionPage,E=e.activeOpinionIndex,O=e.handleMyWordChartClick,N=e.handleOnOptionWordListPageChange,w=e.handleDefaultValue,k=e.data,b=(k.sOption,k.wOption),x=k.chartData;return m.createElement("div",{className:"opinion-chart-wrapper"},m.createElement("div",{className:"wordcloud"},m.createElement(f.default,{spinning:l,tip:"\u6b63\u5728\u52a0\u8f7d\u4e2d",wrapperClassName:"opinion-chart",size:"large"},x&&x.length>0?m.createElement(m.Fragment,null,v?m.createElement(pe.Z,{option:b,theme:"yt_multi_color_10",onChartReady:n,onEvents:{click:r,mouseout:o,mouseover:s,finished:c},style:{width:"100%",height:"100%"}}):m.createElement(I,{getRef:function(e){return t(e)},title:b.title.text,list:x&&x.filter((function(e){return e})),loading:l,optionPage:C,activeOpinionIndex:E,multiColorsPositive:d?D.FG.reduce((function(e,t){return e[t.id]=t.color,e}),{}):D.O9.normal,isAllColors:d,buildNum:T.rD,renderWordOverlay:function(e,t){return m.createElement("span",{className:"opinion-tooltip"},m.createElement("i",{style:{background:t}}),e)},handleMyWordChartClick:O,handleOnOptionWordListPageChange:N})):m.createElement("div",{className:"no-data"},m.createElement("img",{src:a(3381)}),m.createElement("span",null,"\u6682\u65e0\u6570\u636e"))),(!x||0===x.length||l)&&m.createElement("div",{className:"t-title"},"\u70ed\u8bcd"),m.createElement(h.Z,{overlay:"\u70ed\u8bcd\u662f\u6839\u636e\u5173\u952e\u8bcd\u70ed\u5ea6\u800c\u5f97\u51fa\uff0c\u5173\u952e\u8bcd\u70ed\u5ea6\u8ddf\u8bcd\u9891\u548c\u91cd\u8981\u7a0b\u5ea6\u6709\u5173\u3002\u5173\u952e\u8bcd\u70ed\u5ea6\u503c\u57281-100\u4e4b\u95f4\u3002",placement:"top",mouseEnterDelay:.2,overlayStyle:{maxWidth:166}},m.createElement("div",{className:"tip"},m.createElement("i",{className:"icon-cem_file1"}))),m.createElement("div",{className:"buttons"},m.createElement(S.Z,{className:"chartType "+(u?"set_Top_active":""),activeObj:u||(g||"0"),flavor:g||"0",onFlavorChange:w,onChange:y,options:p,objName:"clusterHotType",rightHook:!0}),m.createElement(h.Z,{overlay:"\u8bcd\u6027\u533a\u5206",placement:"top",mouseEnterDelay:.6},m.createElement("i",{className:"icon-cixingqufen "+(d?"active":""),onClick:function(){return i("wdiff")}})),m.createElement(h.Z,{overlay:"\u5bfc\u51fa\u6570\u636e",placement:"top",mouseEnterDelay:.6},m.createElement("i",{className:"icon-daochu",onClick:function(){return i("wExcel")}})),m.createElement(h.Z,{overlay:"\u5bfc\u51fa\u56fe\u7247",placement:"top",mouseEnterDelay:.6},m.createElement("i",{className:"icon-xiazaitupian",onClick:function(){return i("wImage")}})))))};var me=a(18077),he=["loading"],fe=F.Z.opinion.detail,ge=F.Z.opinion.opinionChart,ye=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleOnWsMessage=function(e){var t=e.data;if(t.type&&"ws"===t.type){var n=a.props,r=n.handleResult,i=n.params,o=t.payload,s=o.type,l=o.result;"HOT_WORDS"===s&&l.taskId===i.taskId&&(a.setState({loading:!1}),r({data:l.list}))}},a._resize=function(){a.wordcloudChartRef&&a.wordcloudChartRef.resize()},a._fetchData=function(){var e=a.props,t=e.detail,n=e.params;t&&t.projectId&&a.props.fetchWordData({projectId:t.projectId,enablePos:!0,headerFilterParamsNew:n.headerFilterParamsNew,messageCategory:n.messageCategory||n.queryType,topSize:100,dateFilter:n.dateFilter,filterModel:n.filterModel,onWordModalView:a.onWordModalView}).then((function(e){return e&&a.setState({loading:!1})}))},a._handleOnMoreClick=function(e){var t=a.props,n=t.data.chartData,r=t.wordCloud,i=a.state,o=i.selectedGraphicName,s=i.selectedWordName,l=a.state.allGraphicOptions;if("wImage"===e)r?(0,b._v)(a.wordcloudChartRef,"\u70ed\u8bcd"):(0,b.Mx)(a.wordcloudTableRef,"\u70ed\u8bcd");else if("wExcel"===e){var c=o?n.reduce((function(e,t){return[].concat(e,[[t.name,"n"===t.pos?"\u540d\u8bcd":"a"===t.pos?"\u5f62\u5bb9\u8bcd":"\u5176\u4ed6",t.hotWordFix]])}),[["\u70ed\u8bcd","\u8bcd\u6027","\u70ed\u5ea6"]]):n.reduce((function(e,t){return[].concat(e,[[t.name,t.hotWordFix]])}),[["\u70ed\u8bcd","\u70ed\u5ea6"]]);(0,b.aT)([c],"\u70ed\u8bcd\u5206\u6790")}else if("wdiff"===e){if(o)l=JSON.parse(JSON.stringify(D.FG)),a._resetOptions(n,void 0,s);else{var d=n.map((function(e){return e.pos}));l.filter((function(e){return d.includes(e.id)})),a._resetOptions(n,l,s)}a.setState({allGraphicOptions:l,selectedGraphicName:!o})}},a._handleOnChartClick=function(e){var t=e.componentType,n=e.componentSubType,r=e.data,i=a.state,o=i.selectedWordName;i.activeOpinionIndex;if("series"===t&&"wordCloud"===n){var s=r.name,l=r.index,c=void 0;o&&o===s||(c=s),a._handleMyWordChartClick({name:c},l)}},a._handleOnChartMouseOut=function(e){var t=e.componentType,n=e.componentSubType,r=e.name,i=a.state.selectedWordName;"series"===t&&"wordCloud"===n?i&&i!==r&&a.dispatchEchartsAction(a.wordcloudChartRef,"highlight",r):"series"===t&&"scatter"===n&&a.dispatchTooltipAction(a.wordcloudChartRef,"hideTip",r)},a._handleOnChartMouseOver=function(e){var t=e.componentType,n=e.componentSubType,r=e.name;"series"===t&&"wordCloud"===n?(a.dispatchEchartsAction(a.wordcloudChartRef,"downplay",r),a.dispatchEchartsAction(a.wordcloudChartRef,"downplay",r)):"series"===t&&"scatter"===n&&a.dispatchTooltipAction(a.wordcloudChartRef,"showTip",r)},a._resetOptions=function(e,t,n){var r=a.props,i=r.resetData,o=r.data.chartData,s=a.state,l=(s.selectedGraphicName,s.allGraphicOptions,t?(0,D.WN)(e||o,t,a._handleGraphicClick,n,a.onWordModalView):(0,D.WN)(e||o,void 0,void 0,n,a.onWordModalView));return i({topChartData:{chartData:o,wOption:l,wSection:{gOptions:t||void 0,_handleGraphicClick:t?a._handleGraphicClick:void 0,onWordModalView:t?a.onWordModalView:void 0}},selectedWordName:n}),l},a.dispatchEchartsAction=function(e,t,a){setTimeout((function(){var n={type:t,seriesName:"opinionWordCloud"};a&&(n.name=a),e.dispatchAction(n)}),0)},a.dispatchTooltipAction=function(e,t,a){setTimeout((function(){e.dispatchAction({type:t,name:a,seriesIndex:0})}),0)},a.changeChart=function(e){var t=e.clusterHotType,n=a.props.save;a.setState({chartType:t}),n({wordCloud:"0"===t})},a._handleOnWordcloudChartFinish=function(){a.wcTimeoutId&&clearTimeout(a.wcTimeoutId),a.wcTimeoutId=setTimeout((function(){a.setState({wcLoading:!1}),a.wcTimeoutId=void 0}),100)},a._handleGraphicClick=function(e){void 0===e&&(e="");var t=a.props.data.chartData,n=a.state,r=n.allGraphicOptions,i=n.selectedWordName,o=[].concat(t),s={};r.map((function(t){return t.id===e&&(t.unSelected=!t.unSelected),s[t.id]=t.unSelected,t})),a._resetOptions(o.filter((function(e){return!s[e.pos]})),r,i),a.setState({allGraphicOptions:r})},a._handleMyWordChartClick=function(e,t){var n=a.state,r=n.selectedGraphicName,i=n.allGraphicOptions,o=n.activeOpinionIndex,s=a.props,l=s.refreshMessage,c=s.saveOpinion,d=s.getOpinionWordCloudList,p=s.data.chartData,u=s.opinionTaskValid,m=s.baseType,h=s.refreshOtherChart,f=o===t?-1:t,g=o===t?"":e.name;a.setState({selectedWordName:g,activeOpinionIndex:g?f:-1},(function(){var e=g?m||"textRankWord":"typicalOpinion"===m?m:"";"textRankWord"!==e&&e||(h(),u&&c({loading:!0,optionPage:1,textRankWord:g}),u&&d({textRankWord:g})),c({textRankWord:g,baseType:e}),a.clickTimeId=setTimeout((function(){l(g&&-1!==f?{hide:!!g,content:g}:{}),a.clickTimeId=void 0}),100)})),a._resetOptions(p,r?i:void 0,g)},a._handleOnOptionWordListPageChange=function(e){a.props.save({optionPage:e})},a._handleResetSelected=function(){var e=a.state,t=e.selectedGraphicName,n=e.allGraphicOptions;a.setState({activeOpinionIndex:-1,selectedWordName:""}),a._resetOptions(void 0,t&&n)},a.onWordModalView=function(e){a.setState({wordModalInfo:{visible:!0,word:e}})},a.onWordModalClose=function(e){a.setState({wordModalInfo:{visible:e,word:""}}),a._fetchData()},a.wordcloudChartRef=void 0,a.wordcloudTableRef=void 0,a.wcTimeoutId=void 0,a.event={onMoreClick:a._handleOnMoreClick,onChartClick:a._handleOnChartClick,onChartMouseOut:a._handleOnChartMouseOut,onChartMouseOver:a._handleOnChartMouseOver,onChartReady:a._handleOnChartReady,onWordcloudChartFinish:a._handleOnWordcloudChartFinish,getWordcloudChartRef:function(e){return a.wordcloudChartRef=e},getWordcloudTableRef:function(e){return a.wordcloudTableRef=e},changeChart:a.changeChart,handleMyWordChartClick:a._handleMyWordChartClick,handleOnOptionWordListPageChange:a._handleOnOptionWordListPageChange},a.state={selectedGraphicName:!1,selectedWordName:void 0,chartType:void 0,wcLoading:!0,loading:!0,activeOpinionIndex:-1,allGraphicOptions:JSON.parse(JSON.stringify(D.FG)),wordModalInfo:{visible:!1,word:""}},a}(0,c.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this._fetchData(),window.addEventListener("resize",this._resize),window.addEventListener("message",this._handleOnWsMessage)},a.componentWillUnmount=function(){var e=this.props.resetData;window.removeEventListener("resize",this._resize),e({topChartData:{chartData:[],sOption:{},wOption:{},wSection:{gOptions:void 0,_handleGraphicClick:void 0,onWordModalView:void 0}}}),window.addEventListener("message",this._handleOnWsMessage)},a.componentDidUpdate=function(e){JSON.stringify(e.detail)!==JSON.stringify(this.props.detail)&&this._fetchData()},a.render=function(){var e,t;return m.createElement(m.Fragment,null,m.createElement(ue,(0,l.Z)({},this.state,this.props,this.event,this.ref,{loading:this.state.loading||this.props.fetchWordDataEffecting})),m.createElement(me.Z,{visible:null==(e=this.state.wordModalInfo)?void 0:e.visible,word:null==(t=this.state.wordModalInfo)?void 0:t.word,onClose:this.onWordModalClose}))},t}(m.PureComponent);const ve=(0,M.connect)((function(e){var t=e.loading,a=(0,n.Z)(e,he);return{defaultValues:a[fe].defaultValues,wordCloud:a[fe].wordCloud,data:a[fe].topChartData,typicalOpinion:a[fe].typicalOpinion,optionPage:a[fe].optionPage,fetchWordDataEffecting:t.effects[fe+"/fetchWordData"]||!1,wordSelectOpts:a[ge].wordSelectOpts,opinionTaskValid:a[ge].opinionTaskValid,baseType:a[ge].baseType}}),(function(e){return{save:function(t){return e({type:fe+"/save",payload:t})},fetchWordData:function(t){return e({type:fe+"/fetchWordData",payload:t})},handleResult:function(t){return e({type:fe+"/handleResult",payload:t})},resetData:function(t){return e({type:fe+"/save",payload:t})},getOpinionWordCloudList:function(t){return e({type:ge+"/getWordCloudList",payload:t})},saveOpinion:function(t){return e({type:ge+"/save",payload:t})}}}),null,{withRef:!0})(ye);var Ce=a(35239),Ee=a(92044),Oe=a(59934),Te=["loading"],Ne=F.Z.opinion.detail,we=F.Z.IDBHeaderScreening,ke=we.headerScreening,Ie=we.screening,be=F.Z.opinion.opinionChart,Se=d.Z.Paragraph,xe=function(e){function t(t){var a;(a=e.call(this,t)||this).fetchOpinionDetail=function(e){var t=e.id,n=a.props.dispatch;n({type:be+"/reset"}),v.h.post("/opinion/task/find",{id:t}).then((function(e){var t=e.data;if(2e4===t.code&&t.result){var r=t.result,i=r.id,o=r.name,s=r.filterParam,c=r.projectId,d=r.updateTime,p=r.predictTime,m=r.messageTotal,h=r.opinionTotal,f=r.status,g=r.otherTaskId,y=JSON.parse(s),C=(0,l.Z)({projectId:c,taskId:i,opinionTotal:h,messageTotal:m,status:f,filterModel:y.content?{content:[y.content]}:{clusterLevel:20,taskId:i}},y,{name:o,updateTime:d,predictTime:p,otherTaskId:g});v.h.post("/default/value/find",{key:"OPINION_HOT_OBJ",projectId:c}).then((function(e){var t=a.props.defaultValues;if(e.data.result){var r=JSON.parse(e.data.result);n({type:Ne+"/save",payload:{wordCloud:!(r.clusterHotType&&"1"===r.clusterHotType)||!r.clusterHotType,defaultValues:(0,l.Z)({},t,r)}}),n({type:be+"/save",payload:{wordCloud:!(r.clusterType&&"1"===r.clusterType)||!r.clusterType}})}})),y&&y.headerFilterParamsNew.length>0&&n({type:ke+"/init",payload:{type:Ee.Q[y.queryType],screening:{value:[],noSavingFilterList:[]}}}).then((function(){var e=a.props.screeningMap;e&&n({type:Ne+"/refilterList",payload:{screeningMap:e,screeningValues:y.headerFilterParamsNew||[]}})})),a.setState({type:2,params:C,initParams:u()(C),detail:{projectId:c,taskId:i,taskName:o},currOpinonObj:{id:i,name:o,opinionTotal:h,messageTotal:m,status:f,mode:i&&!o?"save":"rename"}},(function(){var e=h<=5e5&&!0,t=0;h<20?t=1:h<50?t=2:h>5e5&&(t=3),n({type:be+"/save",payload:{opinionTaskValid:e,invalidReason:t,refreshing:e&&"FINISH"!==f,messageTotal:m,reloaded:e,loading:e}}),e&&n({type:be+"/resetClusterOptions"}),a.refreshData()}))}}))},a.handleOnFilterReady=function(){},a.refreshData=function(e){var t=a.state,n=(t.detail,t.params),r=(n.dateFilter,n.filterModel,t.type),i=a.props.dispatch;4!==r&&!e&&i({type:be+"/getWordCloudList"}),a.message.searchTable()},a.refreshMenuList=function(){return(0,a.props.dispatch)({type:"menu/fetchMenuList"})},a.updateCurrOpinonObj=function(e){var t=a.state.currOpinonObj;e?a.setState({currOpinonObj:e}):(t.mode="update",a.setState({currOpinonObj:t}))},a._handleEditClick=function(e,t){if(e)if(e&&e.length>40)G.Z.error("\u8f93\u5165\u9519\u8bef\uff0c\u7ed3\u679c\u540d\u79f0\u6700\u591a\u53ef\u8f93\u516540\u4e2a\u5b57");else{var n=a.state.params;v.h.post("/opinion/task/rename",{projectid:Ce.t.get(Ce.V.curProject).id,newName:e,id:t}).then((function(t){2e4===t.data.code&&(n.name=e,a.setState({params:(0,l.Z)({},n)}))}))}else G.Z.error("\u8f93\u5165\u9519\u8bef\uff0c\u7ed3\u679c\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a")},a._handleKeyWord=function(e){if(e){var t="FUZZY_SEARCH"===e[0].queryType?"\u6216":"\u4e14";return e[0].contain.map((function(e){return'"'+e+'"'})).join(t)}},a._setDefaultValue=function(e,t){var n=a.props,r=n.defaultValues,i=n.dispatch,o=(0,l.Z)({},r,t),s=JSON.stringify(o);v.h.post("/default/value/update",{projectId:a.state.params.projectId||Ce.t.get(Ce.V.curProject).id,key:e,value:s}).then((function(e){2e4===e.data.code&&(i({type:Ne+"/save",payload:{wordCloud:!(o.clusterHotType&&"1"===o.clusterHotType)||!o.clusterHotType,defaultValues:(0,l.Z)({},o)}}),i({type:be+"/save",payload:{wordCloud:!(o.clusterType&&"1"===o.clusterType)||!o.clusterType}}))}))};var n=4,r=location.pathname;return r.startsWith("/opinion")&&(n=3===r.split("/").length?2:location.search?3:1),a.state={params:{},detail:{projectId:"",taskId:"",taskName:""},type:n,currOpinonObj:{id:"",name:"",status:status,filter:{filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},messageTotal:0,opinionTotal:0,changed:!1,mode:"update"},filterRef:{}},a}(0,c.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this,t=Ce.t.get(Ce.V.curProject).id,a=decodeURIComponent(window.location.search).substr(1),n=location.pathname;if(n.startsWith("/opinion"))if(3===n.split("/").length){var r=n.split("/")[2];this.fetchOpinionDetail({id:r})}else{location.search;if(location.search){var i=JSON.parse(decodeURIComponent(window.location.search.split("?")[1]));this.fetchOpinionDetail(i)}else this.fetchOpinionDetail({projectId:t})}else{var o=this.props.dispatch,s=JSON.parse(a),l=(s.filterModel,s.dateFilter,!1),c=Ce.t.get(Ce.V.opinionDetail);if(c&&c.uri&&c.uri===a){l=!0;var d=Ce.t.get(Ce.V.opinionDetail),p=d.data[20];s.taskId=d.taskId||this.state.params.taskId,o({type:be+"/save",payload:{hasRecord:!0,allData:d.data,json_word:p}})}this.setState({params:s,type:4},(function(){l?e.message.searchTable():o({type:be+"/save",payload:{loading:!0}})}))}},a._handleFilterShow=function(e,t){var a=this.state.filterRef;a[e]?a[e]=Object.assign(a[e],t):a[e]=t,this.setState({filterRef:(0,l.Z)({},a)})},a.render=function(){var e=this,t=this.state,a=t.params,n=t.initParams,c=t.detail,d=t.currOpinonObj,p=t.currOpinonObj,u=p.messageTotal,f=p.opinionTotal,g=t.type,y=t.filterRef,v=this.props,C=v.screeningValues,E=v.clusterType,O=v.baseType,T=a&&a.filterModel||{},N=a&&a.dateFilter||null;return m.createElement("div",{className:"opinion-detail-wrapper"},m.createElement(s.default,{column:1,className:"detail-descriptions"},m.createElement(s.default.Item,{label:"\u7ed3\u679c\u540d\u79f0"},a.name&&m.createElement(Se,{editable:{icon:m.createElement("i",{className:"icon-cem_edit"}),tooltip:!1,onChange:function(t){e._handleEditClick(t,a.taskId)}}},a.name)),m.createElement(s.default.Item,{label:"\u7b5b\u9009\u65f6\u95f4"},N?N.from.replace(/-/g,"/")+" ~ "+N.to.replace(/-/g,"/"):""),m.createElement(s.default.Item,{label:"\u7b5b\u9009\u6761\u4ef6",className:"screening"},a.queryType&&m.createElement("p",null,"\u6570\u636e\u7c7b\u578b\uff1a",Oe.U[a.queryType]),C&&C.length>0&&C.map((function(t){return m.createElement("dl",{key:t.id},m.createElement("dt",null,t.label,"\uff1a"),m.createElement("dd",{ref:function(a){return!y[t.id]&&e._handleFilterShow(t.id,{ref:a,clientHeight:a.clientHeight,class:a.clientHeight>22?"collaspe":"",isShow:!1})},className:y[t.id]&&y[t.id].class?"showItem "+(y[t.id].isShow?"":y[t.id].class):""},m.createElement("span",null,t.values.join(", ")),y[t.id]&&y[t.id].class?m.createElement("span",{onClick:function(){return e._handleFilterShow(t.id,{isShow:!y[t.id].isShow})}},y[t.id].isShow?"\u6536\u8d77":"\u5c55\u5f00"):""))})),T.content&&T.content[0].contain&&T.content[0].contain.length>0&&m.createElement("p",null,"\u5173\u952e\u8bcd\uff1a",this._handleKeyWord(T.content)))),m.createElement(r.default,{gutter:24,className:"detail-rows"},m.createElement(i.default,{span:12},m.createElement(o.Z,null,m.createElement("p",null,m.createElement("span",null,"\u6d88\u606f\u6570\uff1a "),m.createElement("span",null,u&&new String(u).replace(/(?=(\B)(\d{3})+$)/g,",")),m.createElement(h.Z,{overlay:"\u7edf\u8ba1\u4e86\u6ee1\u8db3\u7b5b\u9009\u6761\u4ef6\u7684\u6709\u6548\u6d88\u606f\u6570\u91cf",placement:"top",mouseEnterDelay:.2},m.createElement("i",{className:"icon-cem_file1"}))))),m.createElement(i.default,{span:12},m.createElement(o.Z,null,m.createElement("p",null,m.createElement("span",null,"\u89c2\u70b9\u6570\uff1a "),m.createElement("span",null,f&&new String(f).replace(/(?=(\B)(\d{3})+$)/g,",")),m.createElement(h.Z,{overlay:"\u89c2\u70b9\u662f\u6307\u5bf9\u4e8b\u7269\u6216\u95ee\u9898\u7684\u4e3b\u89c2\u770b\u6cd5\u3002\u5728\u4e00\u4e2a\u8bc4\u8bba\u4e2d\uff0c\u7528\u6237\u4f1a\u8868\u8fbe\u81f3\u5c111\u4e2a\u89c2\u70b9\u3002\u5982\u8bc4\u8bba\u5185\u5bb9\u4e3a\u3010\u670d\u52a1\u597d\uff0c\u8d28\u91cf\u597d\uff0c\u8bb2\u89e3\u5230\u4f4d\u3011\uff0c\u90a3\u4e48\u7528\u6237\u5728\u8be5\u5185\u5bb9\u4e2d\u8868\u8ff0\u4e863\u4e2a\u89c2\u70b9\u3002",placement:"top",mouseEnterDelay:.2,overlayStyle:{maxWidth:446}},m.createElement("i",{className:"icon-cem_file1"})))))),m.createElement("div",{className:4!==g?"content-sidebar":"content"},4!==g&&m.createElement(ve,{ref:function(t){return e.opinionChart=t},detail:c,params:a,handleDefaultValue:function(t){return e._setDefaultValue("OPINION_HOT_OBJ",t)},handleMessageTotal:function(t){var a=t.messageTotal,n=t.opinionTotal;e.setState({currOpinonObj:(0,l.Z)({},d,{messageTotal:a,opinionTotal:n})})},refreshOtherChart:function(){return e.detailChart.wrappedInstance._handleResetSelected()},refreshMessage:function(t){e.message&&e.message.searchTable(t)}}),m.createElement(A,{params:a,taskId:d.id&&d.id||a.taskId,ref:function(t){return e.detailChart=t},type:g,handleMessageTotal:function(t){var a=t.messageTotal,n=t.opinionTotal;e.setState({currOpinonObj:(0,l.Z)({},d,{messageTotal:a,opinionTotal:n})})},handleDefaultValue:function(t){return e._setDefaultValue("OPINION_HOT_OBJ",t)},refreshOtherChart:function(){return e.opinionChart.wrappedInstance._handleResetSelected()},resetData:function(t){return e.fetchOpinionDetail({id:t})},refreshMessage:function(t){e.message&&e.message.searchTable(t)}}),m.createElement(de,{params:a,initParams:n,baseType:O,ref:function(t){return e.message=t},resetMessage:function(){e.detailChart&&e.detailChart.getWrappedInstance().resetWordcloudState(),e.detailChart&&e.detailChart.getWrappedInstance().resetBarchartState(),e.opinionChart&&e.opinionChart.getWrappedInstance().reset()},handleOpinionHighlight:function(t){return(0,e.props.dispatch)({type:Ne+"/fetchOpinionHighlightList",payload:(0,l.Z)({},t)})},type:g,clusterType:E})))},t}(m.Component);const _e=(0,M.connect)((function(e){e.loading;var t=(0,n.Z)(e,Te);return{screeningValues:t[Ne].screeningValues,defaultValues:t[Ne].defaultValues,clusterType:t[be].clusterType,baseType:t[be].baseType,screeningMap:t[Ie].curScreeningMap}}))(xe)},49357:(e,t,a)=>{a.d(t,{rD:()=>n,dm:()=>r,W5:()=>i});var n=function(e,t){return e?e/1e4<1?e:e/1e8<1?(e/1e4).toFixed(t||0)+"\u4e07":(e/1e8).toFixed(t||0)+"\u4ebf":0};function r(e,t){var a,n,r,i;function o(e,t){var a;if(isNaN(e)&&isNaN(t)&&"number"===typeof e&&"number"===typeof t)return!0;if(e===t)return!0;if("function"===typeof e&&"function"===typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;if(r.indexOf(e)>-1||i.indexOf(t)>-1)return!1;for(a in t){if(t.hasOwnProperty(a)!==e.hasOwnProperty(a))return!1;if(typeof t[a]!==typeof e[a])return!1}for(a in e){if(t.hasOwnProperty(a)!==e.hasOwnProperty(a))return!1;if(typeof t[a]!==typeof e[a])return!1;switch(typeof e[a]){case"object":case"function":if(r.push(e),i.push(t),!o(e[a],t[a]))return!1;r.pop(),i.pop();break;default:if(e[a]!==t[a])return!1}}return!0}if(arguments.length<1)return!0;for(a=1,n=arguments.length;a<n;a++)if(r=[],i=[],!o(arguments[0],arguments[a]))return!1;return!0}var i=function(e,t,a){if(Array.isArray(t))e.splice(t[0],0,'<a class="highlight-blue">'),e.splice(t[1]+1,0,"</a>");else if(t){var n=Number(t.start)+Number(t.size)+1,r=Number(t.start),i=e.slice(0,r).filter((function(e){return/<.*?a.*?>/gi.test(e)})).length,o=r+i,s=n+i,l=e.slice(o,s);if(l.filter((function(e){return/<.*?a.*?>/gi.test(e)})).length){var c=l.filter((function(e){return/<.*?a.*?>/gi.test(e)})),d=l.filter((function(e){return!/<.*?a.*?>/gi.test(e)}));e.splice.apply(e,[o,l.length].concat(c[0]&&/<\/a>/gi.test(c[0])?["</a>"]:[],[a],d,["</a>"],c[c.length-1]&&/<a class="highlight-blue">/gi.test(c[c.length-1])?['<a class="highlight-blue">']:[]))}else e.splice(o,0,a),e.splice(s,0,"</a>")}}},92044:(e,t,a)=>{a.d(t,{Q:()=>n});var n={COMMENT:"OPINION_MSG_COMMENT",SELF:"OPINION_MSG_SELF",SERVICE:"OPINION_MSG_SERVICE"}},38425:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(49722);const r={fetchWidgetList:function(e,t){n.h.post("/widget/list",e).then((function(e){t&&t(e.data.result)}))},fetchWidgetTemp:function(e,t){n.h.get("/widget/temp/find?type="+e).then((function(e){t&&t(e.data.result)}))},fetchWidgetTempById:function(e,t){n.h.get("/widget/edit_temp/find?id="+e).then((function(e){t&&t(e.data.result)}))},addWidget:function(e,t){n.h.post("dashboard/widget/add",e).then((function(e){t&&t(e.data.result)}))},searchData:function(e,t){n.h.post("/widget/data/find",e).then((function(e){t&&t(e.data.result)}),(function(e){t&&t(e.data.result)}))},fetchProjectTopics:function(e,t){n.h.post("/widget/project_topics/find",e).then((function(e){t&&t(e.data.result)}))},editWidget:function(e,t){n.h.post("/widget/edit",e).then((function(e){t&&t(e.data.result)}))},findModel:function(e,t){n.h.get("/widget/model/list?project="+e.project).then((function(e){t&&t(e.data.result)}))},exportData:function(e,t){n.h.post("/data/export",e).then((function(e){t&&t(e.data)}))},findMessage:function(e,t){n.h.post("/widget/aspect/find",e).then((function(e){t&&t(e.data.result)}))},findAspectLabel:function(e,t){n.h.post("/widget/aspectLabel",e).then((function(e){t&&t(e.data.result)}))},downloadPrice:function(e,t){n.h.post("/data/price/export",e).then((function(e){t&&t(e.data)}))}}},12234:(e,t,a)=>{a.d(t,{l:()=>d});var n=a(87462),r=a(63366),i=a(94578),o=a(67294),s=a(94184),l=a.n(s),c=["className","name"],d=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,a=e.name,i=(0,r.Z)(e,c),s=l()("icon",["cem-"+a],t);return o.createElement("svg",(0,n.Z)({className:s},i),o.createElement("use",{xlinkHref:"#icon-cem-"+a}))},t}(o.Component)},84948:(e,t,a)=>{a.d(t,{Z:()=>h});var n=a(87462),r=a(63366),i=a(94578),o=a(67294),s=a(45697),l=a.n(s),c=a(94184),d=a.n(c),p=["children","className","prefixCls","col","fr"],u={prefixCls:l().string,col:l().string,fr:l().bool},m=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){var e,t=this.props,a=t.children,i=t.className,s=t.prefixCls,l=t.col,c=t.fr,u=(0,r.Z)(t,p),m=d()(s,l&&l.split(" ").map((function(e){return s+"-"+e})),((e={})[s+"-fr"]=c,e),i);return o.createElement("div",(0,n.Z)({className:m},u),a)},t}(o.Component);m.propTypes=u,m.defaultProps={prefixCls:"wt-col",fr:!1};const h=m},52314:(e,t,a)=>{a.d(t,{J:()=>n.Z,X:()=>f});var n=a(84948),r=a(87462),i=a(63366),o=a(94578),s=a(67294),l=a(45697),c=a.n(l),d=a(94184),p=a.n(d),u=["children","className","prefixCls","row","gutther","fluid"],m={prefixCls:c().string,row:c().string,fluid:c().bool},h=function(e){function t(){return e.apply(this,arguments)||this}return(0,o.Z)(t,e),t.prototype.render=function(){var e,t=this.props,a=t.children,n=t.className,o=t.prefixCls,l=t.row,c=t.gutther,d=t.fluid,m=(0,i.Z)(t,u),h=p()(o,l&&l.split(" ").map((function(e){return o+"-"+e})),((e={})[o+"-gutther"]=c,e[o+"-fluid"]=d,e),n);return s.createElement("div",(0,r.Z)({className:h},m),a)},t}(s.Component);h.propTypes=m,h.defaultProps={prefixCls:"wt-row",fluid:!1};const f=h},66746:(e,t,a)=>{a.d(t,{Z:()=>p});a(16049);var n=a(1825),r=(a(89858),a(51024)),i=(a(7940),a(31059)),o=(a(1025),a(65400)),s=(a(75314),a(11187)),l=a(94578),c=a(67294),d=a(87219);const p=function(e){function t(t){var a;return(a=e.call(this,t)||this).show=function(e){var t=e.aspectList,n=e.isAspect,r=e.callback;a.setState({visible:!0,aspectList:t,isAspect:n}),a.callback=r},a._handleOnClose=function(){a.setState({visible:!1,aspectList:void 0,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:"",isAspect:!1},(function(){a.callback=void 0}))},a._handleOnConfigConfirm=function(){var e=a.state,t=e.moreChecked,n=e.moreContent,r=e.errorChecked,i=e.errorContent,o=e.lessChecked,s=e.lessContent,l=e.isAspect,c=[],d=l?"FOCUS_TOO_MANY":"ASPECT_TOO_MANY",p=l?"FOCUS_NOT_ENOUGH":"ASPECT_NOT_ENOUGH";t&&n.length?c.push({feedbackType:d,feedbackContent:l?JSON.stringify(n):JSON.stringify(n.filter((function(e){return e.escore})))}):c.filter((function(e){return e.feedbackType!==d})),r&&i.length?c.push({feedbackType:"EMOTION_WRONG",feedbackContent:l?JSON.stringify(n):JSON.stringify(i.filter((function(e){return e.escore})))}):c.filter((function(e){return"EMOTION_WRONG"!==e.feedbackType})),o?c.push({feedbackType:p,feedbackContent:s}):c.filter((function(e){return e.feedbackType!==p})),a.callback&&a.callback(c),a._handleOnClose()},a._handleOnChange=function(e,t){var n,r;(a.setState(((n={})[t+"Checked"]=e,n)),t.includes("more")&&!e||t.includes("error")&&!e)&&(a.state[t+"Content"]&&a.state[t+"Content"].length&&a.setState(((r={})[t+"Content"]=[],r)))},a._handleOnInputChange=function(e){1e3===e.target.value.trim().length&&a.setState({lessTips:"\u6700\u591a\u8f93\u51651000\u5b57"}),a.setState({lessContent:e.target.value.trim().substring(0,1e3)})},a._handleOnClickAspect=function(e,t,n){var r,i=a.state,o=i.moreContent,l=i.errorContent,c="more"===n?o:l,p=(0,d.ZP)(c,(function(a){if(c.find((function(a){return JSON.stringify(a)===JSON.stringify({aspect:e,escore:t})})))return 1===c.length&&s.default.warning("\u81f3\u5c11\u4fdd\u7559\u4e00\u4e2a\u6307\u6807\u9009\u9879"),a.filter((function(a){return JSON.stringify(a)!==JSON.stringify({aspect:e,escore:t})}));a.push({aspect:e,escore:t})}));a.setState(((r={})[n+"Content"]=p,r))},a.callback=void 0,a.state={visible:!1,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:"",aspectList:void 0,isAspect:!1},a}return(0,l.Z)(t,e),t.prototype.render=function(){var e=this,t=this.state,a=t.visible,s=t.moreChecked,l=t.moreContent,d=t.errorChecked,p=t.errorContent,u=t.lessChecked,m=t.aspectList,h=t.lessContent,f=t.lessTips,g=t.isAspect;return c.createElement(n.Z,{title:"\u6211\u8981\u53cd\u9988",placement:"right",width:372,onClose:this._handleOnClose,visible:a,footer:c.createElement("div",{style:{float:"right"}},c.createElement(o.default,{onClick:this._handleOnClose},"\u53d6\u6d88"),c.createElement(o.default,{disabled:s&&d&&!u&&!l.length&&!p.length||s&&!d&&!u&&!l.length||d&&!s&&!u&&!p.length||!s&&!d&&!u,type:"primary",onClick:this._handleOnConfigConfirm},"\u786e\u5b9a"))},c.createElement("div",{className:"yt_aspect_feedback_drawer"},m&&m.length?c.createElement("div",{className:"item"},c.createElement(i.default,{checked:s,onChange:function(t){return e._handleOnChange(t.target.checked,"more")}},"\u591a\u4e86",g?"\u5173\u6ce8\u70b9":"\u6307\u6807"),c.createElement("div",{className:"feedback_content"},s&&m.map((function(t,a){return c.createElement("span",{key:a,className:8===t.escore?"positive":"negative",onClick:function(){return e._handleOnClickAspect(t.aspect2,t.escore,"more")}},c.createElement("i",{className:"icon-cem_big-gou",style:{display:l.find((function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})}))?"inline":"none"}}),t.aspect2)})))):null,!g&&m&&m.length?c.createElement("div",{className:"item"},c.createElement(i.default,{checked:d,onChange:function(t){return e._handleOnChange(t.target.checked,"error")}},"\u60c5\u611f\u6709\u8bef"),c.createElement("div",{className:"feedback_content"},d&&m.map((function(t,a){return c.createElement("span",{key:a,className:8===t.escore?"positive":"negative",onClick:function(){return e._handleOnClickAspect(t.aspect2,t.escore,"error")}},c.createElement("i",{className:"icon-cem_big-gou",style:{display:p.find((function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})}))?"inline":"none"}}),t.aspect2)})))):null,c.createElement(i.default,{checked:u,onChange:function(t){return e._handleOnChange(t.target.checked,"less")}},"\u5c11\u4e86",g?"\u5173\u6ce8\u70b9":"\u6307\u6807"),u&&c.createElement("div",{className:"item"},c.createElement("p",null,g?"\u5bf9\u5e94\u7684\u6587\u672c\u53ca\u8bf4\u660e":"\u5bf9\u5e94\u7684\u6587\u672c\u6216\u7f3a\u5931\u6307\u6807\u8bf4\u660e"),c.createElement(r.default.TextArea,{className:f?"border_err":"",autoSize:{minRows:3,maxRows:13},placeholder:"\u8bf7\u8f93\u5165",onFocus:function(t){f&&e.setState({lessTips:""})},onBlur:function(t){f&&e.setState({lessTips:""})},maxLength:1e3,value:h,onChange:this._handleOnInputChange}),f&&c.createElement("div",{className:"tips"},f))))},t}(c.PureComponent)},21554:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(94578),r=a(67294),i=a(45697),o=a.n(i),s=a(92360),l=a(66982),c=a.n(l),d=function(e){function t(t){return e.call(this,t)||this}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){},a.render=function(){var e=this.props,t=e.images,a=e.isShow,n=e.startIndex,i=e.closeDialog;return r.createElement(s.Dialog,{visible:a,className:"imgpreview-dialog",onCancel:i,lockScroll:!1},r.createElement(s.Dialog.Body,null,r.createElement(c(),{items:t,startIndex:n})))},t}(r.Component);d.propTypes={images:o().array.isRequired,isShow:o().bool.isRequired,closeDialog:o().func.isRequired,startIndex:o().number.isRequired}},6714:(e,t,a)=>{e.exports=a.p+"img/b9e36b4a6a0ede23c11b.png"},43134:(e,t,a)=>{e.exports=a.p+"img/c6a1e87945c5211f102e.png"},3381:(e,t,a)=>{e.exports=a.p+"img/459a43effdbcbdd83095.png"},88958:(e,t,a)=>{e.exports=a.p+"img/aa245f8de9f2aa549c26.png"}}]);