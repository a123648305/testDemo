"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6735],{55882:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),echarts_for_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(50976),element_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(92360),element_react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(element_react__WEBPACK_IMPORTED_MODULE_2__),getOption=function getOption(op){if(null===op||"error"===op)return{};var option={},source;try{eval(op)}catch(err){return console.error("op\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u8fd4\u56de\uff0c "+err),{option:null}}return{option:option,source:source}},Enlarge=function(e){var t=e.name,n=e.shrink,a=e.option,r={},o=getOption(a),l=o.option,i=o.source;a&&null!==l&&(r=a.includes("table")?i:l);var s;return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"edit_elarge_wrap"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"elarge_header"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"chart_name"},t||"\u9884\u89c8"),react__WEBPACK_IMPORTED_MODULE_0__.createElement("i",{className:"icon-cem_cancel",onClick:n})),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"elarge_chart_wrap"},(s=r)instanceof Array?react__WEBPACK_IMPORTED_MODULE_0__.createElement(element_react__WEBPACK_IMPORTED_MODULE_2__.Table,{className:"hover_table",columns:s[0].map((function(e,t){return{label:e,render:function(e){return e[t]}}})),data:s.slice(1)}):react__WEBPACK_IMPORTED_MODULE_0__.createElement(echarts_for_react__WEBPACK_IMPORTED_MODULE_1__.Z,{theme:"yunting_dashboard_theme",loadingOption:{text:"\u52a0\u8f7d\u4e2d",color:"#20a0ff"},option:s,style:{width:"100%",height:"100%"}})))};const __WEBPACK_DEFAULT_EXPORT__=Enlarge},46735:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F});var a=n(63366),r=n(87462),o=n(94578),l=n(67294),i=n(92360),s=n(43036),c=n(45697),u=n.n(c),p=30,d=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnBlur=function(e){var t=e.target.value;""===t.trim()?(n.setState({tipText:"\u8f93\u5165\u6846\u4e0d\u80fd\u4e3a\u7a7a"}),n.input.style.border="1px solid #D96969"):t.length===p&&(n.setState({tipText:""}),n.input.style.border="1px solid #e5e5e5")},n._handleOnChange=function(e){var t=e.target;if(!n.isCompositionHandling){var a=t.value;n.setState({name:a,hasChanged:n.state.originName!==a}),""===a.trim()?(n.setState({tipText:"\u8f93\u5165\u6846\u4e0d\u80fd\u4e3a\u7a7a"}),n.input.style.border="1px solid #D96969"):a.length===p?(n.setState({tipText:"\u6700\u591a\u53ea\u80fd\u8f93\u516530\u4e2a\u5b57\u7b26"}),n.input.style.border="1px solid #D96969"):(n.setState({tipText:""}),n.input.style.border="1px solid #e5e5e5")}},n._handlingOnComposition=function(){n.isCompositionHandling=!0},n._handleOnComposition=function(e){var t=e.target;n.isCompositionHandling=!1,n._handleOnChange({target:t})},n.getValue=function(){var e=n.state;return{name:e.name,description:e.description}},n.hasChanged=function(){return n.state.hasChanged},n.resetChanged=function(){n.setState({hasChanged:!1})},n.test=function(){return""===n.state.tipText||n.state.name.length===p},n.state={tipText:"",hasChanged:!1,description:"",sequenceId:"",name:"",originName:""},n.isCompositionHandling=!1,n}(0,o.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e,t){var n=e.value,a=this.props,r=a.value,o=a.isCopy;if(JSON.stringify(n)!==JSON.stringify(r)){var l=r.name,i=r.sequenceId,s=r.description,c="\u526f\u672c-"+l,u=o?c.substring(0,p):l.substring(0,p);this.setState({name:u,tipText:u.length>p?"\u6700\u591a\u8f93\u516530\u4e2a\u5b57":"",originName:o?c.substring(0,p):l.substring(0,p),sequenceId:i,description:s})}},n.render=function(){var e=this,t=this.state,n=t.tipText,a=t.name,r=t.sequenceId,o=t.description;return l.createElement("div",{className:"dash_edit_info_wrapper"},l.createElement("div",{className:"title"},"\u56fe\u8868\u4fe1\u606f"),l.createElement("div",null,l.createElement("span",{className:"name"},"\u56fe\u8868\u540d\u79f0"),l.createElement("input",{className:"edit_input_normal "+(""!==n&&"edit_input_error"),placeholder:"\u8bf7\u8f93\u5165\u56fe\u8868\u540d\u79f0\uff08\u6700\u591a30\u4e2a\u5b57)",defaultValue:a.substring(0,p),ref:function(t){return e.input=t},maxLength:p,onBlur:this._handleOnBlur,onChange:this._handleOnChange,onCompositionStart:this._handlingOnComposition,onCompositionUpdate:this._handlingOnComposition,onCompositionEnd:this._handleOnComposition})),l.createElement("p",{className:"tip_text"},n),l.createElement("div",{style:{marginTop:8}},l.createElement("span",{className:"id_name"},"\u6a21\u677fID"),l.createElement(s.Z,{overlay:"\u6a21\u677fID\u5c06\u88ab\u7528\u4e8e\u8fdc\u7a0b\u6c9f\u901a\u65f6\u9488\u5bf9\u6709\u95ee\u9898\u7684\u56fe\u8868\u7684\u5b9a\u4f4d",placement:"top"},l.createElement("i",{className:"icon-cem_file1"})),l.createElement("span",null,r)),l.createElement("div",{style:{marginTop:"30px",display:"flex"}},l.createElement("span",{className:"summary_name"},"\u56fe\u8868\u8bf4\u660e"),l.createElement("span",{className:"summary_description",dangerouslySetInnerHTML:{__html:o.replace(/\n\n/g,"<br/>")}})))},t}(l.Component);d.propTypes={value:u().shape({name:u().string,sequenceId:u().string,description:u().string})};var h=n(83425),m=n(38263),f=n(7660),g={like:"\u5305\u542b",notlike:"\u4e0d\u5305\u542b",in:"\u5176\u4e2d\u4e00\u4e2a",notin:"\u4e0d\u4e3a\u5176\u4e2d\u4efb\u4e00\u4e2a"},_=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnAddTag=function(e){var t=e.name,a=n.props,r=a.onChange,o=a.index,l=a.data.contents,i=t.trim();i&&l.length<5&&r(o,{type:"contents",value:l.concat([i])})},n._handleOnTagDelete=function(e,t,a){var r=n.props;(0,r.onChange)(r.index,{type:"contents",value:a.map((function(e){return e.name}))})},n._handleOnTagBlur=function(e){var t=e.target;n.tagInputRef&&t.value&&(n._handleOnAddTag({name:t.value}),n.tagInputRef.setState({tagName:""}))},n._handleOnObjectSelect=function(e){var t=n.props,a=t.index;(0,t.onChange)(a,{type:"name",value:e})},n._handleOnConditionSelect=function(e){var t=n.props,a=t.index;(0,t.onChange)(a,{type:"type",value:e})},n._handleOnContentsSelect=function(e){var t=n.props,a=t.index;(0,t.onChange)(a,{type:"contents",value:[e]})},n._handleOnDelete=function(){var e=n.props,t=e.index;(0,e.onDelete)(t)},n._handleInputKeyDown=function(e){if(8===e.keyCode&&n.tagInputElm&&!n.tagInputElm.value){var t=n.props,a=t.onChange,r=t.index,o=t.data.contents;a(r,{type:"contents",value:o.slice(0,o.length-1)})}},n.tagInputRef=void 0,n.tagInputElm=void 0,n}(0,o.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(){var e=this.props.data.contents;e&&5===e.length&&this.tagInputElm&&this.tagInputElm.setAttribute("disabled",!0),e&&e.length<5&&this.tagInputElm&&this.tagInputElm.removeAttribute("disabled")},n.componentWillUnmount=function(){this.tagInputElm&&this.tagInputElm.removeEventListener("keydown",this._handleInputKeyDown)},n.render=function(){var e=this,t=this.props,n=t.index,a=t.data,r=t.objOptions,o=t.conOptions,i=t.plaOptions,s=t.test,c=1===n,u=c?"rule_first":5===n?"rule_last":"",p=a.name,d=a.type,h=a.contents,_=h.map((function(e){return{name:e}}));return l.createElement("div",{className:"yt_link_rule_wrapper"},l.createElement("span",{className:"rule_index "+u},l.createElement("span",null,n)),l.createElement("span",{className:"rule_object "+(c?"rule_object_first":"")},l.createElement(m.ZP,{value:p,className:"rule_select",tags:!1,showSearch:!1,inputIcon:l.createElement("i",{className:"icon-cem_pull-down-or-take-up"}),onSelect:this._handleOnObjectSelect},r.map((function(e){return l.createElement(m.Wx,{key:e,value:e,disabled:1===n&&"\u5e73\u53f0"===e},e)})))),l.createElement(m.ZP,{value:g[d],className:"rule_select",style:{width:140,minWidth:140},tags:!1,showSearch:!1,inputIcon:l.createElement("i",{className:"icon-cem_pull-down-or-take-up"}),onSelect:this._handleOnConditionSelect},o.map((function(e){return l.createElement(m.Wx,{key:e,value:e},g[e])}))),"\u5e73\u53f0"===p?l.createElement(m.ZP,{className:"rule_content_select",value:i.find((function(e){return e.id===h[0]})).name,tags:!1,showSearch:!1,inputIcon:l.createElement("i",{className:"icon-cem_pull-down-or-take-up"}),onSelect:this._handleOnContentsSelect},i.map((function(e){return l.createElement(m.Wx,{key:e.id,value:e.id},e.name)}))):l.createElement(f.EG,{ref:function(t){if(t){e.tagInputRef=t;var n=t.refs.tagInput.getElementsByTagName("input")[0];e.tagInputElm=n,e.tagInputElm.addEventListener("keydown",e._handleInputKeyDown)}},className:"rule_content "+(!s&&"rule_content_error")+" "+(5===h.length?"rule_content_input_hide":"rule_content_input_show"),tags:_,onAdd:this._handleOnAddTag,createTagOnKeys:[13],placeholder:"\u8fd8\u53ef\u8f93\u5165"+(5-h.length)+"\u4e2a\u5173\u952e\u8bcd",onDelete:this._handleOnTagDelete,onBlur:this._handleOnTagBlur}),l.createElement("i",{onClick:this._handleOnDelete,className:"icon-cem_delete rule_delete_icon"}))},t}(l.PureComponent);const v=_;_.propTypes={index:u().number,data:u().shape({id:u().string,key:u().string,name:u().string,type:u().string,content:u().arrayOf(u().string)}).isRequired,objOptions:u().arrayOf(u().string).isRequired,conOptions:u().arrayOf(u().string).isRequired,plaOptions:u().array,onDelete:u().func.isRequired,onChange:u().func.isRequired,test:u().bool};var C=n(58992),E=n(61409),y=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleConpositing=function(){n.compositing=!0},n._handleCompositionEnd=function(e){var t=e.currentTarget,a=n.props.onChange;n.compositing=!1,a(t.value)},n._handleOnChange=function(e){var t=e.target,a=n.props.onChange;!n.compositing&&a(t.value)},n.compositing=!1,n}return(0,o.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,a=t.value,r=void 0===a?"":a,o=t.test,i=void 0===o||o,s=t.placeHolder;return l.createElement("div",{className:"yt_content_input_wrapper"},n,l.createElement("input",{className:i?"":"error",placeholder:s,value:r,onChange:function(t){var n=t.target;return e.props.onChange(n.value)}}))},t}(l.PureComponent);const O=y;y.propTypes={onChange:u().func.isRequired,title:u().string.isRequired,value:u().string,placeHolder:u().string,test:u().bool};var N={14:{title:"\u8d34\u5427\u540d",placeHolder:'\u8f93\u5165\u8d34\u5427\u540d\u79f0\uff0c\u4e0d\u8981\u5e26"\u5427"\u5b57'}},b=function(e){function t(t){var n;return(n=e.call(this,t)||this).setQueAnsState=function(e){var t=e.preConData,a=e.nowConData,r=e.value;JSON.stringify(t)!==JSON.stringify(a)&&n.setState({content:r})},n.setBBSState=function(e){var t=e.preConData,a=e.nowConData,r=e.preValue,o=void 0===r?"":r,l=e.nowValue;JSON.stringify(t)===JSON.stringify(a)&&JSON.stringify(o)===JSON.stringify(l)||n.setState({contentStr:l})},n.setSocialState=function(e){var t=e.preConData,a=e.nowConData,o=e.preValue,l=e.nowValue;if(JSON.stringify(t)!==JSON.stringify(a)||JSON.stringify(o)!==JSON.stringify(l)){a.list[0];var i=[],s={},c={};a.list.forEach((function(e){var t=e.name,n=e.key,a=e.type;i.push(t),s[t]=n,c[t]=[a,"not"+a]}));var u={objOptions:i,keyDict:s,conDict:c};l&&l.length>0&&a?u.rules=l.map((function(e){return(0,r.Z)({},e,{contents:e.contents||e[e.type]||[],type:e.type})})):u.rules=[],n.setState(u)}},n.getValue=function(){var e=n.state,t=e.rules,a=e.content,r=e.contentStr;return t?{rules:t.map((function(e){var t;return(t={key:e.key})[e.type]=e.contents,t}))}:a?{content:n.contentRuleRef.getValue()}:r?{contentStr:r}:void 0},n.hasChanged=function(){return n.contentRuleRef?n.contentRuleRef.hasChanged():n.state.hasChanged},n.resetChanged=function(){return n.setState({hasChanged:!1})},n.test=function(){var e=n.state,t=e.rules,a=e.content,r=e.contentStr,o=!0;if(t.length>0){var l=t.map((function(e){var t=e.contents.length>0;return o=t&&o,t}));n.setState({testRules:l})}else a||void 0!==r&&(o=!!r,n.setState({testRules:o}));return o},n._handleOnLinkRuleChange=function(e,t){var a=n.state,r=a.rules,o=a.conDict,l=a.keyDict,i=a.testRules,s=n.props,c=s.plaData,u=s.onChange,p=r[e-1];p[t.type]=t.value,"name"===t.type&&(p.type=o[t.value][0],p.key=l[t.value],"\u5e73\u53f0"===t.value?p.contents=[c[0].id]:p.contents=[]),n.setState({rules:JSON.parse(JSON.stringify(r)),testRules:"contents"===t.type?void 0:i,hasChanged:!0},(function(){u&&u(n.state.rules)}))},n._handleOnLinkRuleDelete=function(e){var t=n.state.rules,a=n.props.onChange;t.splice(e-1,1),n.setState({hasChanged:!0,rules:JSON.parse(JSON.stringify(t))},(function(){a&&a(n.state.rules)}))},n._handleOnLinkRuleAdd=function(){var e,t=n.props,a=t.conData,r=t.onChange,o=n.state.rules,l=a.list[0];n.setState({hasChanged:!0,rules:o.concat([(e=l,{key:e.key,name:e.name,type:e.type,contents:[]})])},(function(){r&&r(n.state.rules)}))},n._handleOnContentInputChange=function(e){n.setState({hasChanged:!0,contentStr:e,testRules:void 0})},n.state={rules:void 0,content:void 0,contentStr:void 0,objOptions:[],conDict:{},keyDict:{},testRules:void 0,hasChanged:!1},n}(0,o.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props,t=e.conData,n=e.value;e.messageCategory;this.setSocialState({preConData:void 0,nowConData:t,value:n})},n.componentDidUpdate=function(e,t){var n=e.conData,a=e.value,r=this.props,o=r.conData,l=r.value,i=r.messageCategory;"BBS"===i?this.setBBSState({preConData:n,nowConData:o,preValue:a,nowValue:l}):"SOCIAL"!==i&&"NEWS"!==i&&"QUE_ANS"!==i||this.setSocialState({preConData:n,nowConData:o,preValue:a,nowValue:l})},n.render=function(){var e=this,t=this.state,n=t.rules,a=t.content,r=t.contentStr,o=t.objOptions,s=t.conDict,c=t.testRules,u=this.props,p=u.conData,d=u.loading,h=u.plaData,m=p&&N[Number(p.sourceId)];return l.createElement("div",{className:"yt_dashboard_rule_com_wrapper "+(this.props.className||"")},l.createElement("div",{className:"dashboard_rule_title"},"\u5185\u5bb9\uff08\u4ee5\u4e0b\u89c4\u5219\u5c06\u9010\u5c42\u751f\u6548\u8fc7\u6ee4\u8981\u83b7\u53d6\u7684\u6570\u636e\uff0c\u5173\u952e\u8bcd\u4e0d\u533a\u5206\u82f1\u6587\u5927\u5c0f\u5199\uff09"),l.createElement(i.Loading,{loading:d,className:"dashboard_rule_content"},n?l.createElement(l.Fragment,null,n.map((function(t,n){return l.createElement(v,{data:t,objOptions:o,conOptions:s[t.name],plaOptions:h,key:"rule_"+n,index:n+1,conData:p.list,test:!c||c[n],onDelete:e._handleOnLinkRuleDelete,onChange:e._handleOnLinkRuleChange})})),n.length<5?l.createElement("div",{className:"dashboard_rule_more "+(0===n.length?"dashboard_rule_more_empty":"")},l.createElement("span",{onClick:this._handleOnLinkRuleAdd},l.createElement("i",{className:"icon-cem_add-to"})),(0===n.length?"":"\u8fd8")+"\u53ef\u6dfb\u52a0"+(5-n.length)+"\u6761\u89c4\u5219"):l.createElement("div",{className:"dashboard_rule_no_more"},"\u6700\u591a\u53ef\u6dfb\u52a05\u6761\u89c4\u5219")):a?l.createElement("div",{className:"dashboard_content_rule"},l.createElement(C.Z,{value:a,ref:function(t){return e.contentRuleRef=t}})):void 0!==r?l.createElement(O,{title:m?m.title:"\u4e13\u680f",placeHolder:m?m.placeHolder:"\u8bf7\u8f93\u5165\u89c4\u5219\u5185\u5bb9",test:c,onChange:this._handleOnContentInputChange,value:r}):""))},t}(l.PureComponent);const R=b;b.propTypes={className:u().string,conData:u().object,plaData:u().array.isRequired,loading:u().bool,value:u().any,messageCategory:u().string,onChange:u().func};var k=n(19586),S=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleGetFilterRef=function(e){return n.filterRef=e},n._handleGetRuleRef=function(e){return n.ruleRef=e},n._handleOnFilterChange=function(e){n.changed=!0,n.setState({filter:(0,k.C)(e)})},n._handleOnRuleChange=function(e){n.setState({rules:e}),n.changed=!0},n.getValue=function(){return{filterModel:n.filterRef.getReFormatValue(),rules:n.ruleRef.getValue().rules}},n.hasChanged=function(){return n.changed},n.resetChanged=function(){n.changed=!1},n.test=function(){return n.ruleRef.test()},n._handleOnFilterReady=function(){n.props.onFilterReady(!0),n.setState({ready:!0})},n._handelClear=function(){n.filterRef.clearData(),n.setState({rules:[]})},n.state={filter:[],rules:[],ruleConData:void 0,ready:!1,filterValue:{}},n.changed=!1,n}(0,o.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=e.value,n=this.props.value;if(JSON.stringify(t)!==JSON.stringify(n)){var a=n.rules?n.rules.map((function(e){return(0,r.Z)({},e,{contents:e[e.type]||[]})})):[],o=n.filterModel?Object.keys(n.filterModel).reduce((function(e,t){var a;return t?(0,r.Z)({},e,((a={})[t]=n.filterModel[t],a)):e}),{}):{};this.setState({filter:(0,k.C)(o),rules:a,ruleConData:{sourceId:"11",list:[{name:"\u5546\u54c1\u8be6\u60c5\u9875\u6807\u9898",type:"like",key:"title"},{name:"\u8bc4\u8bba/\u8ffd\u8bc4",type:"like",key:"content"}]}})}},n.render=function(){var e=this.state,t=e.filter,n=e.rules,a=e.ruleConData,r=e.ready,o=this.props.dimensionModelId;return l.createElement("div",{className:"yt_dashboard_template_filter_wrapper"},l.createElement("div",{className:"filter_header"},l.createElement("span",null,"\u6570\u636e\u8fc7\u6ee4"),l.createElement(s.Z,{placement:"top",overlay:"\u56fe\u5916\u7b5b\u9009\uff1a\u53ef\u8fc7\u6ee4\u56fe\u8868\u5c55\u793a\u7684\u6570\u636e",overlayClassName:"title_desc_popup"},l.createElement("i",{className:"icon-cem_file1"})),(t.length>0||n.length>0)&&l.createElement("span",{onClick:this._handelClear},"\u6e05\u7a7a\u9009\u9879")),o&&l.createElement(h.Z,{ref:this._handleGetFilterRef,style:{display:"block"},type:"PRICE_WARNING",value:r?t:[],noFresh:r,filter:["MESSAGE_RELATION","CONN_CONFIG","DS001"===o?"ALL_ASPECT":"VOC_ASPECT","TAG","BRAND_SERIES"],filterConfig:["ESCORE","messageType","KEY_WORD","USEFUL_DATA"],noBottom:!0,moreFilterPosition:"top",onFilterChange:this._handleOnFilterChange,onFilterReady:this._handleOnFilterReady,hideAdvanced:!0}),l.createElement("div",{className:"filter_rule"},l.createElement(R,{value:n,ref:this._handleGetRuleRef,messageCategory:"QUE_ANS",conData:a,onChange:this._handleOnRuleChange,plaData:[{id:"11",name:"\u77e5\u4e4e"}],loading:!1})))},t}(l.Component);S.propTypes={value:u().shape({filter:u().array,rules:u().array}),dimensionModelId:u().string,onFilterReady:u().func};const D=function(e){function t(t){var n;return(n=e.call(this,t)||this).showDialog=function(e){n.state.visible?n.setState({visible:!1,callback:void 0},(function(){n.setState((0,r.Z)({visible:!0},e))})):n.setState((0,r.Z)({visible:!0},e))},n._handleOnCancel=function(){n.setState({visible:!1,data:void 0,callback:void 0})},n._handleOnConfrim=function(){var e=n.state,t=e.callback,a=e.data;t&&t(a),n.setState({visible:!1,data:void 0,callback:void 0})},n.state={visible:!1,data:void 0,callback:void 0},n}return(0,o.Z)(t,e),t.prototype.render=function(){var e=this.state.visible;return l.createElement(i.Dialog,{className:"yt-nps-template-delete-dialog-wrapper",size:"tiny",visible:e,title:"\u786e\u5b9a\u79bb\u5f00\u6b64\u9875\u9762\uff1f",closeOnClickModal:!1,onCancel:this._handleOnCancel},l.createElement(i.Dialog.Body,null,"\u4f60\u4fee\u6539\u7684\u4fe1\u606f\u5c06\u4e0d\u4f1a\u88ab\u4fdd\u5b58"),l.createElement(i.Dialog.Footer,null,l.createElement(i.Button,{onClick:this._handleOnCancel},"\u53d6\u6d88"),l.createElement(i.Button,{type:"primary",onClick:this._handleOnConfrim},"\u786e\u5b9a")))},t}(l.PureComponent);var I=n(55815),P=n(55882);const T=function(e){var t=l.useState(!1),n=t[0],a=t[1],r=e.title,o=e.loading,s=e.onSave,c=e.onCancel,u=e.onChartPreview,p=e.onBeforeJump,h=e.getExitDialogRef,m=e.isCopy,f=e.templateData,g=e.getNameRef,_=e.getFilterRef,v=e.dimensionModelId,C=e.dashId,E=e.previewLoading,y=e.option,O=e.closePreview,N=[{title:r,url:"/dashboard/"+C},{title:"\u9009\u62e9\u6a21\u677f",url:"/dashboard/"+C+"/list"},{title:"\u8bbe\u7f6e\u56fe\u8868",url:""}];return l.createElement("div",{className:"yt_dashboard_template_edit_wrapper"},l.createElement(i.Loading,{loading:o||!n||E,style:{height:"100%"}},l.createElement(I.Z,{title:N,beforeJump:p}),l.createElement("div",{className:"edit_content"},l.createElement(d,{isCopy:m,value:f,ref:g}),l.createElement(S,{ref:_,value:f,dimensionModelId:v,onFilterReady:a})),l.createElement("div",{className:"button_zone"},l.createElement(i.Button,{type:"primary",onClick:function(){s("back")}},"\u4fdd\u5b58\u5e76\u8fd4\u56de"),l.createElement(i.Button,{onClick:function(){s("noback")}},"\u4fdd\u5b58"),l.createElement(i.Button,{onClick:c},"\u53d6\u6d88"),l.createElement(i.Button,{onClick:u},"\u9884\u89c8"))),l.createElement(D,{ref:h}),y&&l.createElement(P.Z,{option:y,shrink:O}))};var w=n(55609),L=n(35239),x=n(5133),A=n(64396),Z=["loading"],B=A.Z.dashboard.template.edit,M=A.Z.public.menu,J=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleOnBeforeJump=function(e,t){n.getNameRef.hasChanged()||n.filterRef.hasChanged()?n.exitDialogRef.showDialog({callback:function(){n.props.router.setRouteLeaveHook(n.props.route,n.routerCancleConfirm),e()}}):e()},n._handleOnCancel=function(){n.getNameRef.hasChanged()||n.filterRef.hasChanged()?n.exitDialogRef.showDialog({callback:function(){n.props.router.setRouteLeaveHook(n.props.route,n.routerCancleConfirm),E.mW.replace("/dashboard/"+n.state.dashId)}}):E.mW.replace("/dashboard/"+n.state.dashId)},n._handleOnSave=function(e){n.getNameRef.test()&&(n.filterRef.test()?n.saveLock||(n.saveLock=!0,n.props.commitChart((0,r.Z)({isCopy:n.state.isCopy},n.getNameRef.getValue(),n.filterRef.getValue(),{callback:function(){x.Z.success("\u4fdd\u5b58\u6210\u529f"),n.getNameRef.resetChanged(),n.filterRef.resetChanged(),"back"===e&&E.mW.replace("/dashboard/"+n.state.dashId)}})).then((function(e){n.saveLock=!1}))):x.Z.error("\u5185\u5bb9\u89c4\u5219\u5b58\u5728\u975e\u6cd5\u503c"))},n._handelChartPreview=function(){n.getNameRef.test()?n.filterRef.test()?n.props.fetchPreviewChart((0,r.Z)({},n.getNameRef.getValue(),n.filterRef.getValue())):x.Z.error("\u5185\u5bb9\u89c4\u5219\u5b58\u5728\u975e\u6cd5\u503c"):x.Z.error("\u56fe\u8868\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a")},n._jumpToList=function(){E.mW.push("/dashboard/"+n.state.dashId+"/list")},n.routerWillLeave=function(){return!n.getNameRef.hasChanged()&&!n.filterRef.hasChanged()||"\u4f60\u4fee\u6539\u7684\u4fe1\u606f\u5c06\u4e0d\u4f1a\u88ab\u4fdd\u5b58\uff0c\u786e\u5b9a\u79bb\u5f00\u6b64\u9875\u9762\uff1f"},n.routerCancleConfirm=function(){if(n.getNameRef.hasChanged()||n.filterRef.hasChanged())return!0};var a=t.params,o=t.location.state;return n.state={projectId:L.t.get(L.V.curProject).id,dashId:a.id||location.pathname.split("/")[2],chartId:o&&o.chartId||"",temId:o&&o.temId||"",isCopy:o&&o.isCopy||!1,title:"",loading:!0},n.saveLock=!1,n.event={onBeforeJump:n._handleOnBeforeJump,onCancel:n._handleOnCancel,onSave:n._handleOnSave,onChartPreview:n._handelChartPreview,getNameRef:function(e){return n.getNameRef=e},getFilterRef:function(e){return n.filterRef=e},getExitDialogRef:function(e){return n.exitDialogRef=e},onFilterReady:n._handleOnFilterReady},n}(0,o.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave);var e=this.state,t=e.projectId,n=e.dashId,a=e.chartId,r=e.temId;this.props.fetchTemplateData({projectId:t,dashId:n,chartId:a,temId:r})},n.componentDidUpdate=function(e){var t=this;(this.props.titleList.dashboards||e.menuLoading&&!this.props.menuLoading)&&this.props.titleList.dashboards.map((function(e){return e.dataDashboardVOList})).forEach((function(e){if(e){var n=e.find((function(e){return e.id===t.state.dashId}));if(n)return void t.setState({title:n.name})}}));e.dataLoading&&!this.props.dataLoading&&this.setState({loading:!1})},n.componentWillUnmount=function(){this.props.clean(),this.getNameRef.resetChanged(),this.filterRef.resetChanged()},n.render=function(){return l.createElement(T,(0,r.Z)({},this.props,this.state,this.event))},t}(l.PureComponent);const F=(0,w.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,Z);return(0,r.Z)({},n[B],{titleList:n[M].menuList,dataLoading:t.effects[B+"/fetchTemplateData"]||!1,previewLoading:t.effects[B+"/fetchPreviewChart"]||!1,menuLoading:t.effects[M+"/fetchMenuList"]||!1})}),(function(e){return{fetchTemplateData:function(t){return e({type:B+"/fetchTemplateData",payload:t})},commitChart:function(t){return e({type:B+"/commitChart",payload:t})},fetchPreviewChart:function(t){return e({type:B+"/fetchPreviewChart",payload:t})},closePreview:function(){return e({type:B+"/closePreview"})},clean:function(t){return e({type:B+"/clean",payload:t})}}}))(J)},24473:(e,t,n)=>{n.d(t,{Z:()=>h});var a=n(87462),r=n(63366),o=n(94578),l=n(67294),i=n(45697),s=n.n(i),c=n(94184),u=n.n(c),p=["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"],d=function(e){function t(){return e.apply(this,arguments)||this}return(0,o.Z)(t,e),t.prototype.render=function(){var e,t=this.props,n=t.prefixCls,o=t.children,i=t.className,s=t.block,c=t.indeterminate,d=t.value,h=t.checked,m=t.defaultChecked,f=t.onChange,g=t.disabled,_=(0,r.Z)(t,p),v={value:d,checked:h,defaultChecked:m,onChange:f,disabled:g},C=u()(n,((e={})[n+"-disabled"]=v.disabled,e[n+"-block"]=s,e[n+"-indeterminate"]=c,e),i);return l.createElement("label",(0,a.Z)({tabIndex:v.disabled?-1:0,className:C},_),l.createElement("input",(0,a.Z)({type:"checkbox",className:n+"-input"},v)),l.createElement("span",{className:n+"-status"}),o&&l.createElement("span",{className:n+"-text",title:o},o))},t}(l.Component);d.propTypes={prefixCls:s().string,value:s().oneOfType([s().string,s().number]),checked:s().bool,defaultChecked:s().bool,onChange:s().func,indeterminate:s().bool,disabled:s().bool,block:s().bool},d.defaultProps={prefixCls:"wt-checkbox"};const h=d},85151:(e,t,n)=>{n.d(t,{Jg:()=>a.Z,CS:()=>m});var a=n(24473),r=n(87462),o=n(63366),l=n(94578),i=n(67294),s=n(45697),c=n.n(s),u=n(94184),p=n.n(u),d=["prefixCls","children","className","onChange","values","checkedList","block"],h=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this).handleCheckBoxChange=function(e){var n=t.props.onChange;n&&n(e)},t}return(0,l.Z)(t,e),t.prototype.render=function(){var e,t=this,n=this.props,a=n.prefixCls,l=n.children,s=n.className,c=(n.onChange,n.values),u=n.checkedList,h=n.block,m=(0,o.Z)(n,d);return e=c?c.map((function(e,n){var a=0!==u.length&&-1!==u.indexOf(e);return i.createElement(Checkbox,{key:n,value:e,checked:a,onChange:function(e){return t.handleCheckBoxChange(e)},block:h},e)})):i.Children.map(l,(function(e,n){if(e){var a=e.props,r=a.value,o=0!==u.length&&-1!==u.indexOf(r);return i.cloneElement(e,{checked:o,key:n,block:a.block||h,onChange:function(){var e=a.value;t.handleCheckBoxChange(e)}})}})),i.createElement("div",(0,r.Z)({className:p()(a,s)},m),e)},t}(i.Component);h.defaultProps={prefixCls:"wt-checkbox-group"},h.propTypes={onChange:c().func,values:c().array,block:c().bool};const m=h;var f=function(e){var t={};return Object.keys(e).forEach((function(n){/^data\-.+$/.test(n)&&(t[n]=e[n])})),t},g=function(e){function t(){return e.apply(this,arguments)||this}return(0,l.Z)(t,e),t.prototype.render=function(){var e=this.props,t=f(e);return i.createElement("label",{className:e.className,title:e.children},i.createElement("div",{className:"checkbox"},i.createElement("input",(0,r.Z)({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),i.createElement("div",{className:"checkbox-body"})),"\xa0",i.createElement("span",null,e.children))},t}(i.Component);g.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},55815:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),r=n(67294),o=n(45697),l=n.n(o),i=n(43036),s=n(61409),c=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this)._handleBreadcrumbClick=function(e){var n=t.props,a=n.title,r=n.beforeJump;e!==a.length-1&&(r?new Promise((function(e,t){return r(e,t)})).then((function(){s.mW.push({pathname:a[e].url,state:a[e].state})})):s.mW.push({pathname:a[e].url,state:a[e].state}))},t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,a=t.mainTitle,o=t.rightContent,l=t.className,s=t.overlay;return r.createElement("div",{className:"breadcumb-wrapper "+l},n instanceof Array?r.createElement("div",{className:"breadcrumb-left"},r.createElement("div",null,n.map((function(t,a){return r.createElement("span",{className:t.url?"":"not_clickable",key:a,onClick:function(){return t.url&&a!==n.length-1&&e._handleBreadcrumbClick(a)}},t.title,a!==n.length-1&&" / ")}))),r.createElement("span",null,a||n[n.length-1].title,s&&r.createElement(i.Z,{placement:"top",overlay:s},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):r.createElement("div",{className:"normal-title"},n,s&&r.createElement(i.Z,{placement:"top",overlay:s},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),o||"")},t}(r.Component);c.propTypes={className:l().string,title:l().oneOfType([l().string,l().arrayOf(l().shape({title:l().string,url:l().string,state:l().object}))]).isRequired,overlay:l().oneOfType([l().string,l().node]),mainTitle:l().oneOfType([l().string,l().node]),beforeJump:l().func,rightContent:l().node};const u=c},58992:(e,t,n)=>{n.d(t,{Z:()=>f});var a=n(87462),r=n(94578),o=n(67294),l=n(92360),i=n(45697),s=n.n(i),c=n(38263),u=n(85151),p=[{label:"\u5305\u542b",value:"contain"},{label:"\u4e0d\u5305\u542b",value:"notContain"}];const d=function(e){var t=e.ruleGroup,n=e.formRef,a=e.groupIdx,r=e.editable,i=e.onSelectChange,s=e.onInputChange,d=e.onRuleItemDelete,h=e.onRuleGroupDelete,m=e.onRuleItemAdd,f=e.onActiveRuleCheckChange,g=(0===t.contain.length||""===t.contain[0])&&0===t.notContain.length,_=o.useState(g),v=_[0],C=_[1],E=o.useState(""),y=E[0],O=E[1];o.useEffect((function(){!v&&O(function(e,t){return(e?"\u4e00\u53e5\u8bdd\u4e2d":"\u5168\u6587\u4e2d")+"\uff1a"+["contain","notContain"].reduce((function(e,n){return t[n]&&t[n].length>0?[].concat(e,[("contain"===n?"\u5305\u542b":"\u4e0d\u5305\u542b")+t[n].map((function(e){return'<span style="color: #262626;">\u201c'+e+"\u201d</span>"})).join("\uff0c")]):e}),[]).join("\uff0c\u4e14")}(t.sentence,t))}),[v]);var N=t.contain.length+t.notContain.length,b=42*N+30+10;return o.createElement("div",{className:"content-rule-group"},o.createElement("div",{className:"content-rule-group-top"},o.createElement("span",{className:"show-icon",onClick:function(){v?function(e,t,n){var a=["contain","notContain"].reduce((function(n,a){return[].concat(n,e[a].map((function(e,n){return"rule-"+t+"-"+a+"-"+n})))}),[]),r=n[0],o=a.map((function(e){return new Promise((function(t,n){r?r.validateField(e,(function(e){null===e?t():n()})):n()}))}));return Promise.all(o)}(t,a,n).then((function(){C(!1)})):C(!0)}},o.createElement("i",{className:"icon-cem_pull-or-take-up",style:{transform:"rotate("+(v?-180:0)+"deg)"}})),o.createElement("span",{className:"content-rule-group-title"},v?o.createElement("span",{className:"group-title-check"},o.createElement(u.Jg,{checked:t.sentence,onChange:function(e){var t=e.currentTarget.checked;return f(a,t)}}),o.createElement("span",{style:{marginLeft:8}},"\u4ee5\u4e0b\u5173\u952e\u8bcd\u51fa\u73b0\u5728",o.createElement("span",{style:{color:"#262626"}},"\u201c\u4e00\u53e5\u8bdd\u201d"),"\u4e2d\u6761\u4ef6\u624d\u751f\u6548?")):o.createElement("span",{dangerouslySetInnerHTML:{__html:y}})),o.createElement("span",{className:"group-delete",onClick:function(){return h(a)}},o.createElement("i",{className:"icon-cem_delete"}))),o.createElement("div",{className:"content-rule-group-list",style:{height:v?b:0,paddingTop:v?10:0}},o.createElement("div",{className:"group-list "+(N>1?"mulit-group-list":"")},o.createElement("span",{className:"list-left"},o.createElement("span",{style:{fontSize:14}},"\u4e14")),o.createElement("span",{className:"list-right"},["contain","notContain"].map((function(e){return t[e]&&t[e].map((function(t,n){var u="rule-"+a+"-"+e+"-"+n;return o.createElement("div",{key:u,className:"content-rule-group-item"},o.createElement("span",null,o.createElement(c.ZP,{disabled:!r,value:p.find((function(t){return t.value===e})).label,onChange:function(e){return i(u,e)}},p.map((function(e){return o.createElement(c.Wx,{key:e.value,title:e.label},e.label)})))),o.createElement("span",{style:{height:42}},o.createElement(l.Form.Item,{prop:u},o.createElement(l.Input,{disabled:!r,value:t,onChange:function(e){return s(u,e)}}))),r&&o.createElement("span",{onClick:function(){return d(u)}},o.createElement("i",{className:"icon-cem_delete"})))}))})))),r&&o.createElement(o.Fragment,null,o.createElement("span",{className:"add-icon",onClick:function(){return m(a)}},o.createElement("i",{className:"icon-cem_add-to"})),o.createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"\u6dfb\u52a0\u65b0\u7684\u5173\u952e\u8bcd"))))};var h={contain:[""],notContain:[],sentence:!0,id:Math.round(1e4*Math.random())},m=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleOnRuleGroupAdd=function(){var e=n.state.content,t=[].concat(e,[JSON.parse(JSON.stringify(h))]);n.setState({content:t,formProps:n.getFormProps(t),hasChanged:!0})},n._handleOnRuleItemAdd=function(e){var t=n.state.content,a=n.props.onChange;if(t[e]){var r=JSON.parse(JSON.stringify(t));!r[e].contain&&(r[e].contain=[]),r[e].contain.push(""),n.setState({content:r,formProps:n.getFormProps(r),hasChanged:!0},(function(){return a&&a(r)}))}},n._handleOnRuleItemDelete=function(e){if(e){var t=n.state.content,a=n.props.onChange,r=e.split("-"),o=(r[0],r[1]),l=r[2],i=r[3];if(t[o]&&t[o][l]&&void 0!==t[o][l][i]){var s=JSON.parse(JSON.stringify(t));s[o][l].splice(i,1),0===s[o].contain.length&&0===s[o].notContain.length&&s.splice(o,1),n.setState({content:s,formProps:n.getFormProps(s),hasChanged:!0},(function(){return a&&a(s)}))}}},n._handleOnSelecChange=function(e,t){if(e&&t){var a=n.state.content,r=n.props.onChange,o=e.split("-"),l=(o[0],o[1]),i=o[2],s=o[3];if(a[l]&&a[l][i]&&void 0!==a[l][i][s]){var c=JSON.parse(JSON.stringify(a)),u=c[l][i].splice(s,1);c[l][t].push(u[0]),n.setState({content:c,formProps:n.getFormProps(c),hasChanged:!0},(function(){return r&&r(c)}))}}},n._handleOnInputChange=function(e,t){if(e){var a=n.state.content,r=n.props.onChange,o=e.split("-"),l=(o[0],o[1]),i=o[2],s=o[3];if(a[l]&&a[l][i]&&void 0!==a[l][i][s]){var c=JSON.parse(JSON.stringify(a));c[l][i][s]=t,n.setState({content:c,formProps:n.getFormProps(c),hasChanged:!0},(function(){return r&&r(c)}))}}},n._handleOnActiveRuleCheckChange=function(e,t){var a=n.state.content,r=n.props.onChange;if(a[e]){var o=JSON.parse(JSON.stringify(a));o[e].sentence=t,n.setState({content:o,hasChanged:!0},(function(){return r&&r(o)}))}},n._handleOnRuleGroupDelete=function(e){var t=n.state.content,a=n.props.onChange;if(t[e]){var r=JSON.parse(JSON.stringify(t));r.splice(e,1)&&n.setState({content:r,hasChanged:!0,formProps:n.getFormProps(r)},(function(){return a&&a(r)}))}},n.getValue=function(){return n.state.content},n.hasChanged=function(){return n.state.hasChanged},n.getFormProps=function(e){var t={model:{},rules:{}};return e&&e.length>0&&e.forEach((function(e,n){e&&["contain","notContain"].forEach((function(a){e[a]&&e[a].forEach((function(e,r){var o="rule-"+n+"-"+a+"-"+r;t.model[o]=e,t.rules[o]=[{required:!0,message:" ",trigger:"blur"}]}))}))})),t},n.mRefs=[],n.formRef=void 0;var r=(t.value||[h]).map((function(e){return(0,a.Z)({},e,{id:Math.round(1e4*Math.random())})}));return n.state={content:r,formProps:n.getFormProps(r),hasChanged:!1},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=e.value,n=this.props.value;JSON.stringify(t)!==JSON.stringify(n)&&this.setState({content:n,formProps:this.getFormProps(n)})},n.render=function(){var e=this,t=this.state,n=t.content,r=t.formProps,i=this.props,s=i.editable,c=void 0===s||s,u=i.className,p=void 0===u?"":u;return o.createElement("div",{className:"content-rule-wrapper "+p},o.createElement("span",{className:"content-rule-title"},"\u5185\u5bb9"),o.createElement("div",{className:"content-rule"},o.createElement(l.Form,(0,a.Z)({},r,{ref:function(t){e.formRef=t,e.mRefs.splice(0,e.mRefs.length),e.mRefs.push(t)}}),n.length>0&&o.createElement("span",{className:"content-rule-hint"},"\u6ee1\u8db3\u4efb\u610f\u4e00\u7ec4\u6761\u4ef6\uff0c\u8be5\u89c4\u5219\u5373\u751f\u6548"),n.map((function(t,n){return o.createElement(d,{key:t.id,formRef:e.mRefs,ruleGroup:t,groupIdx:n,editable:c,onSelectChange:e._handleOnSelecChange,onRuleGroupDelete:e._handleOnRuleGroupDelete,onInputChange:e._handleOnInputChange,onRuleItemDelete:e._handleOnRuleItemDelete,onRuleItemAdd:e._handleOnRuleItemAdd,onActiveRuleCheckChange:e._handleOnActiveRuleCheckChange})}))),c&&o.createElement(o.Fragment,null,o.createElement("span",{className:"add-icon",onClick:this._handleOnRuleGroupAdd},o.createElement("i",{className:"icon-cem_add-to"})),o.createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"\u6dfb\u52a0\u65b0\u7684\u6761\u4ef6"))))},t}(o.PureComponent);const f=m;m.propTypes={value:s().array,editable:s().bool,onChange:s().func,className:s().string}}}]);