"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1450],{61450:(e,n,t)=>{t.r(n),t.d(n,{default:()=>S});var a=t(63366),r=t(87462),l=t(94578),i=t(67294),o=t(55815),c=t(35239),s=t(2271),u=t(61918),p=t(92360),d=t(30381),m=t.n(d),h=t(39432),f=t(61409),g={visible:!1,id:"",callback:void 0};const v=function(e){function n(n){var t;return(t=e.call(this,n)||this).showDialog=function(e){t.setState((0,r.Z)({visible:!0},e))},t._handleOnCancel=function(){t.setState(JSON.parse(JSON.stringify(g)))},t._handleOnConfrim=function(){var e=t.state,n=e.callback,a=e.id;n&&n(a),t._handleOnCancel()},t.state=JSON.parse(JSON.stringify(g)),t}return(0,l.Z)(n,e),n.prototype.render=function(){var e=this.state.visible;return i.createElement(p.Dialog,{className:"yt-nps-template-delete-dialog-wrapper",size:"tiny",visible:e,title:"\u786e\u5b9a\u5220\u9664\u6b64\u89c4\u5219",closeOnClickModal:!1,onCancel:this._handleOnCancel},i.createElement(p.Dialog.Body,null,"\u5220\u9664\u6b64\u8ba2\u9605\u89c4\u5219\uff0c\u4e0e\u4e4b\u76f8\u5173\u7684\u5546\u54c1\u94fe\u63a5\u548c\u6d88\u606f\u4e5f\u5c06\u4e00\u5e76\u79fb\u51fa\u9879\u76ee\uff0c\u5305\u62ec\u5728\u5546\u54c1\u94fe\u63a5\u4e2d\u7ef4\u62a4\u7684\u4e3b\u9898\u503c"),i.createElement(p.Dialog.Footer,null,i.createElement(p.Button,{onClick:this._handleOnCancel},"\u53d6\u6d88"),i.createElement(p.Button,{type:"primary",onClick:this._handleOnConfrim},"\u786e\u5b9a")))},n}(i.PureComponent);var y=t(43036);const C=function(e){function n(n){var t;return(t=e.call(this,n)||this)._handleOnSearch=function(e){var n=t.props.onFilterChange;n&&n({keyword:e})},t._handleOnEditClick=function(e){var n={};if(e){var a=e.id,r=e.idValuesModels;n.id=a,n.rules=r.map((function(e){var n="price"===e.id?e.values:e.values?e.values.map((function(n,t){return{id:n,name:e.names[t]}})):null;return{id:e.id,values:n}})),n.rules.push({id:"autoAdd",values:[e.autoAdd]})}f.mW.push({pathname:"/account/project/"+t.props.route+"/subscribe/rules/edit",state:n})},t._handleOnDeleteClick=function(e){var n=t.props.onDelete;t.dialogRef.current.showDialog({id:e,callback:function(e){n&&n({id:e})}})},t._handleOnPageSizeChange=function(e){var n=t.props.onFilterChange;n&&n({pageIndex:1,pageSize:e})},t._handleOnPageChange=function(e){var n=t.props.onFilterChange;n&&n({pageIndex:e})},t._renderOverlay=function(e){return i.createElement(i.Fragment,null,e.reduce((function(e,n){return n.values&&n.values.length&&e.push(i.createElement("div",{className:"rule_item",key:n.id},i.createElement("span",null,n.name),i.createElement("span",null,n.names.join("price"===n.id?" - ":"\uff0c")))),e}),[]))},t.dialogRef=i.createRef(),t.columns=[{label:"ID",prop:"number",width:180,fixed:"",checked:!0},{label:"\u8ba2\u9605\u89c4\u5219",prop:"rule",width:320,fixed:"",checked:!0},{label:"\u65b0\u53d1\u73b0\u5546\u54c1\u94fe\u63a5\u6570",prop:"linkCount",width:100,fixed:"",checked:!0},{label:"\u521b\u5efa\u65f6\u95f4",prop:"createdAt",width:160,fixed:"",checked:!0},{label:"\u6700\u8fd1\u4fee\u6539\u65f6\u95f4",prop:"updatedAt",width:100,fixed:"",checked:!0},{label:"\u72b6\u6001",prop:"status",width:100,fixed:"",checked:!0},{label:"\u64cd\u4f5c",prop:"control",width:100,fixed:"",checked:!0}],t.prefixColumns=[{label:"",width:16,fixed:"left"}],t.columnRenders={rule:function(e){var n=e.idValuesModels;return i.createElement("div",{className:"rule_wrapper"},i.createElement("div",null,i.createElement("div",{className:"rule_title"},"\u5185\u5bb9"),i.createElement("div",{className:"rule_content"},n.reduce((function(e,n){return n.values&&n.values.length&&e.push(i.createElement("div",{className:"rule_item",key:n.id},i.createElement("span",null,n.name),i.createElement("span",null,n.names.join("price"===n.id?" - ":"\uff0c")))),e}),[]))),i.createElement(y.Z,{placement:"top",overlayClassName:"popover-detail-tips",overlay:t._renderOverlay(n)},i.createElement("span",{className:"rule_detail"},"\u8be6\u60c5")))},linkCount:function(e){return e.syncTime&&"null"!==e.syncTime?i.createElement(y.Z,{placement:"top",overlay:e.syncTime?m()(e.syncTime).format("YYYY\u5e74MM\u6708DD\u65e5 HH:mm \u66f4\u65b0"):""},i.createElement("span",null,e.linkCount||0)):i.createElement("span",null,e.linkCount||0)},createdAt:function(e){return m()(e.createAt).format("YYYY-MM-DD HH:mm")},updatedAt:function(e){return(0,h.Go)(e.updateAt)},status:function(e){switch(e.status){case"Enable":return"\u6392\u961f\u4e2d";case"Sync":return"\u540c\u6b65\u4e2d";case"Sync_Finish":return"\u540c\u6b65\u5b8c\u6210"}},control:function(e){return i.createElement("div",{className:"item-control "+e.status},i.createElement("span",{onClick:function(){return"Sync"!==e.status&&t._handleOnEditClick(e)}},"\u7f16\u8f91"),i.createElement("span",{onClick:function(){return"Sync"!==e.status&&t._handleOnDeleteClick(e.id)}},"\u5220\u9664"))}},t}return(0,l.Z)(n,e),n.prototype.render=function(){var e=this,n=this.props,t=n.data,a=n.loading,r=n.pageSize,l=n.pageIndex,o=n.total;return i.createElement("div",{className:"yt_product_setting_rule_listview_wrapper"},i.createElement("div",{className:"header_title"},i.createElement(u.Z,{onSearch:this._handleOnSearch,onClear:this._handleOnSearch,placeholder:"\u641c\u7d22ID"}),i.createElement(p.Button,{onClick:function(){return e._handleOnEditClick()},type:"primary"},"\u65b0\u5efa\u89c4\u5219")),i.createElement(s.Z,{savedKey:"product_setting_subscribe_rule",rowKeyProp:"id",total:o,pageIndex:l,pageSize:r,onPageChange:this._handleOnPageChange,onPageSizeChange:this._handleOnPageSizeChange,data:t,loading:a,columns:this.columns,columnRenders:this.columnRenders,prefixColumns:this.prefixColumns}),i.createElement(v,{ref:this.dialogRef}))},n}(i.PureComponent);var _=function(e){var n=e.title;return[{title:c.t.get(c.V.backProjectConfig).name,url:"/account/project/preview"},{title:n,url:"/account/project/"+location.pathname.split("/")[3]+"/subscribe"},{title:"\u667a\u80fd\u8ba2\u9605",url:"/account/project/"+location.pathname.split("/")[3]+"/subscribe",state:{type:"SubscribeOverview"}},{title:"\u8ba2\u9605\u89c4\u5219",url:"/account/project/"+location.pathname.split("/")[3]+"/subscribe/rules"}]};const E=function(e){var n=e.ruleList,t=e.total,a=e.pageIndex,r=e.pageSize,l=e.loading,c=e.onDelete,s=e.onFilterChange,u=e.connectCount,p=e.location.pathname.split("/")[3];return i.createElement("div",{className:"yt_product_setting_subscribe_rules_wrapper"},i.createElement(o.Z,{title:_({title:"comment"===p?"\u7535\u5546\u8bc4\u8bba":"\u7535\u5546\u76d1\u63a7"})}),u[0]/u[1]>=.95&&i.createElement("div",{className:"warning_tip"},i.createElement("i",{className:"icon-cem_warning"}),"\u63d0\u793a\uff1a\u9879\u76ee\u4e2d\u94fe\u63a5\u6743\u76ca\u4e3a"+u[0]+"\uff0c\u5df2\u4f7f\u7528"+u[1]+",\u5df2\u8d85\u8fc7"+(u[0]/u[1]*100).toFixed(1)+"%\uff1b\u7cfb\u7edf\u5df2\u505c\u6b62\u81ea\u52a8\u540c\u6b65\uff0c\u4f46\u4f60\u53ef\u4ee5\u624b\u52a8\u6dfb\u52a0\uff0c\u5982\u6709\u7591\u95ee\uff0c\u8bf7\u8054\u7cfb\u5ba2\u6237\u6210\u529f"),i.createElement("div",{className:"content"},i.createElement(C,{data:n,total:t,pageSize:r,pageIndex:a,loading:l,onFilterChange:s,onDelete:c,route:p})))};var b=t(64396),k=t(55609),O=["loading"],w=b.Z.product.setting.subscribe.rule,N=function(e){function n(n){var t;return(t=e.call(this,n)||this)._handleOnWsMessage=function(e){var n=e.data;if(n.type&&"ws"===n.type){var a=n.payload,l=a.type,i=a.result;if("SUBSCRIBE_RULE_PRODUCT_NUM"===l){var o=(t.props.ruleList||[]).map((function(e){var n=i.idLog.find((function(n){return String(n.id)===String(e.id)}));return(0,r.Z)({},e,{linkCount:n?n.number:0,finishTime:n?n.time:""})}));t.props.save({ruleList:o})}}},t._handleOnFilterChange=function(e){(void 0!==e.keyword||e.pageIndex)&&t.props.fetchRuleList((0,r.Z)({},e,{type:t.props.location.pathname.includes("/price")?"PRICE":"DEFAULT"}))},t._handleOnDelete=function(e){t.props.deleteRule(e)},t.state={},t.event={onFilterChange:t._handleOnFilterChange,onDelete:t._handleOnDelete},n.location.pathname.includes("/price")?n.save({type:"PRICE"}):n.save({type:"DEFAULT"}),t}(0,l.Z)(n,e);var t=n.prototype;return t.componentDidMount=function(){this.props.fetchRuleList({projectId:c.t.get(c.V.curProject).id,type:this.props.location.pathname.includes("/price")?"PRICE":"DEFAULT"}),this.props.fetchConnectCount(),window.addEventListener("message",this._handleOnWsMessage)},t.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage),this.props.clean()},t.render=function(){return i.createElement(E,(0,r.Z)({},this.props,this.state,this.event))},n}(i.PureComponent);const S=(0,k.connect)((function(e){var n=e.loading,t=(0,a.Z)(e,O);return(0,r.Z)({},t[w],{loading:n.effects[w+"/fetchRuleList"]||!1})}),(function(e){return{fetchRuleList:function(n){return e({type:w+"/fetchRuleList",payload:n})},deleteRule:function(n){return e({type:w+"/deleteRule",payload:n})},fetchConnectCount:function(){return e({type:w+"/fetchConnectCount"})},save:function(n){return e({type:w+"/save",payload:n})},clean:function(n){return e({type:w+"/clean",payload:n})}}}))(N)},55815:(e,n,t)=>{t.d(n,{Z:()=>u});var a=t(94578),r=t(67294),l=t(45697),i=t.n(l),o=t(43036),c=t(61409),s=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(n=e.call.apply(e,[this].concat(a))||this)._handleBreadcrumbClick=function(e){var t=n.props,a=t.title,r=t.beforeJump;e!==a.length-1&&(r?new Promise((function(e,n){return r(e,n)})).then((function(){c.mW.push({pathname:a[e].url,state:a[e].state})})):c.mW.push({pathname:a[e].url,state:a[e].state}))},n}return(0,a.Z)(n,e),n.prototype.render=function(){var e=this,n=this.props,t=n.title,a=n.mainTitle,l=n.rightContent,i=n.className,c=n.overlay;return r.createElement("div",{className:"breadcumb-wrapper "+i},t instanceof Array?r.createElement("div",{className:"breadcrumb-left"},r.createElement("div",null,t.map((function(n,a){return r.createElement("span",{className:n.url?"":"not_clickable",key:a,onClick:function(){return n.url&&a!==t.length-1&&e._handleBreadcrumbClick(a)}},n.title,a!==t.length-1&&" / ")}))),r.createElement("span",null,a||t[t.length-1].title,c&&r.createElement(o.Z,{placement:"top",overlay:c},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):r.createElement("div",{className:"normal-title"},t,c&&r.createElement(o.Z,{placement:"top",overlay:c},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),l||"")},n}(r.Component);s.propTypes={className:i().string,title:i().oneOfType([i().string,i().arrayOf(i().shape({title:i().string,url:i().string,state:i().object}))]).isRequired,overlay:i().oneOfType([i().string,i().node]),mainTitle:i().oneOfType([i().string,i().node]),beforeJump:i().func,rightContent:i().node};const u=s},61918:(e,n,t)=>{t.d(n,{Z:()=>o});var a=t(67294),r=t(45697),l=t.n(r),i=function(e){var n=e.className,t=e.onClear,r=e.onSearch,l=e.placeholder,i=e.style,o=e.defValue,c=e.signal,s=a.useState(o),u=s[0],p=s[1];a.useEffect((function(){p(o)}),[o,c]);return a.createElement("div",{style:i,className:"yt_search_input_wrapper "+(n||"")},a.createElement("input",{placeholder:l,value:u,onKeyDown:function(e){13===e.keyCode&&r(u)},onChange:function(e){return p(e.target.value)},autoComplete:"off"}),u&&a.createElement("i",{className:"icon-cem_log-off",onClick:function(){p(""),t&&t("")}}),a.createElement("i",{className:"icon-cem_small-search",onClick:function(){return r(u)}}))};i.propTypes={className:l().string,onSearch:l().func.isRequired,placeholder:l().string,style:l().object,defValue:l().string,signal:l().any,onClear:l().func};const o=i},2271:(e,n,t)=>{t.d(n,{Z:()=>L});var a=t(63366),r=t(87462),l=t(43144),i=t(94578),o=t(23279),c=t.n(o),s=t(67294),u=t(92360),p=t(35303),d=t(45697),m=t.n(d),h=[{label:"10\u9879/\u9875",value:10},{label:"20\u9879/\u9875",value:20},{label:"40\u9879/\u9875",value:40},{label:"100\u9879/\u9875",value:100}];const f=function(e){var n=e.onPageChange,t=e.onSizeChange,a=e.total,r=void 0===a?0:a,l=e.pageIndex,i=e.pageSize,o=e.currLength,c=e.layout,d=e.className,m=0===r?0:(l-1)*i+1,f=0===r?0:m+o-1;return 0===r?null:s.createElement("div",{className:"yt-awp-pagination "+(d||"")},s.createElement("span",{className:"total_num"},s.createElement("span",null,m+" - "+f+" "),"\u9879\uff0c\u5171",s.createElement("span",null," "+r+" "),"\u9879"),s.createElement("div",{style:{textAlign:"right",float:"right"},className:"new_pagination"},s.createElement(u.Pagination,{small:!0,pageSize:i,currentPage:l,pageCount:Math.ceil(r/i),layout:0===r?"":"prev, pager, next",onCurrentChange:n}),void 0===c||c.includes("sizes")?s.createElement(p.RS,{multiple:!1,tags:!1,showSearch:!1,optionFilterProp:"label",optionLabelProp:"label",animation:"slide-up",dropdownClassName:"custom-pagination-dropdown",value:i||10,onChange:t},h.map((function(e,n){return s.createElement(p.Wx,{key:n,label:e.label,value:e.value},e.label)}))):null))};m().propTypes={onPageChange:m().func,onSizeChange:m().func,total:m().number,pageIndex:m().number,pageSize:m().number,currLength:m().number,layout:m().string,className:m().string};var g=t(8201),v=t(15861),y=t(87757),C=t.n(y),_=t(49722);function E(){return(E=(0,v.Z)(C().mark((function e(n){var t,a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectId,a=n.key,e.abrupt("return",_.h.post("/default/value/find",{projectId:t,key:a}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=(0,v.Z)(C().mark((function e(n){var t,a,r;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectId,a=n.value,r=n.key,e.abrupt("return",_.h.post("/default/value/update",{projectId:t,key:r,value:a}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=t(39432),O=t(43036),w=t(51474),N=t(87219),S=function(e){function n(n){var t;return(t=e.call(this,n)||this)._setShowFalse=function(){t.setState({show:!1})},t._handleParentClick=function(e){t.state.show&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},t._handleOnTriggerClick=function(){setTimeout((function(){t.setState({show:!t.state.show})}),0)},t._renderOptionItem=function(e,n,a,r,l,i){var o=t.state.maxLabelWidth,c=t.props,u=c.value,p=c.savedKey,d=u.find((function(n){return n.prop===e.prop}));return s.createElement("div",{className:"opt_item "+(n?"draggable":""),key:e.prop},n&&s.createElement("i",{className:"icon-cem_move my_handle"}),s.createElement("div",{className:"opt_content",style:{width:o,marginLeft:n?0:12}},s.createElement("div",{className:"item_label",onClick:function(n){n.stopPropagation(),t._handleOnItemClick(e.prop)}},s.createElement("span",{className:"icon_checkbox "+(d&&d.checked?"checkbox_checked":"")}),s.createElement("span",null,e.label)),s.createElement("div",{className:"item_control",style:{display:"product_setting_link"===p?"none":"block"}},s.createElement(O.Z,{placement:"top",overlay:a},s.createElement("span",{onClick:function(n){return r(n,e.prop)}},s.createElement("i",{className:(n?"icon-cem_up":"icon-cem_up-and-down")+" fun_icon_a"}))),s.createElement(O.Z,{placement:"top",overlay:l},s.createElement("span",{onClick:function(n){return i(n,e.prop)},style:{marginLeft:4}},s.createElement("i",{className:"icon-cem_down fun_icon_b"}))))))},t._handleOnItemClick=function(e){var n=t.props,a=n.value,r=n.onChange;r&&r((0,N.ZP)(a,(function(n){var t=n.find((function(n){return n.prop===e}));t&&(t.checked=!t.checked)})))},t._handleOnFilxedLeftClick=function(e,n){e.stopPropagation(),t._handleOnFixedChange(n,"left")},t._handleOnCancelFixedClick=function(e,n){e.stopPropagation(),t._handleOnFixedChange(n,"")},t._handleOnFixedRightClick=function(e,n){e.stopPropagation(),t._handleOnFixedChange(n,"right")},t._handleOnFixedChange=function(e,n){var a=t.props,r=a.value,l=a.onChange;l&&l((0,N.ZP)(r,(function(t){var a=t.find((function(n){return n.prop===e}));a&&(a.fixed=n)})))},t.state={show:!1,value:[],leftOpts:[],normalOpts:[],rightOpts:[],maxLabelWidth:n.value.reduce((function(e,n){return Math.max((0,k.jD)(n.label,14)+56+16+16,e)}),0)},t}(0,i.Z)(n,e),n.getDerivedStateFromProps=function(e,n){if(JSON.stringify(e.value)!==JSON.stringify(n.value)){var t=e.value.reduce((function(n,t){var a=1;return"left"===t.fixed&&(a=0),"right"===t.fixed&&(a=2),n[a].push(e.value.find((function(e){return e.prop===t.prop}))),n}),[[],[],[]]),a=t[0],r=t[1],l=t[2];return{value:e.value,leftOpts:a,normalOpts:r,rightOpts:l,maxLabelWidth:e.value.reduce((function(e,n){return Math.max((0,k.jD)(n.label,14)+56+16+16,e)}),0)}}return null};var t=n.prototype;return t.componentDidMount=function(){var e=this;window.addEventListener("click",this._setShowFalse);var n=document.querySelectorAll("#draggable_zone");n.length&&n.forEach((function(n){w.default.create(n,{group:"draggable_zone",animation:150,filter:".undraggable",draggable:".draggable",handle:".my_handle",onEnd:function(n){var t=e.props,a=t.value,r=t.onChange,l=n.newIndex,i=n.oldIndex;if(l!==i){var o=a.filter((function(e){return"left"===e.fixed})),c=a.filter((function(e){return"right"===e.fixed})),s=(0,N.ZP)(a.filter((function(e){return!e.fixed})),(function(e){var n=e.splice(i,1)[0];e.splice(l,0,n)}));r&&r([].concat(o,s,c))}}})}))},t.componentWillUnmount=function(){window.removeEventListener("click",this._setShowFalse)},t.render=function(){var e=this,n=this.state,t=n.show,a=n.leftOpts,r=n.normalOpts,l=n.rightOpts,i=this.props,o=i.className,c=i.title;return s.createElement("div",{className:"yt_columns_selector_wrapper "+(o||""),onClick:this._handleParentClick},s.createElement("div",{className:"trigger "+(t?"sel":""),onClick:this._handleOnTriggerClick},c||"\u5217",s.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),s.createElement("div",{className:"options "+(t?"active":"")},a.length>0&&s.createElement(s.Fragment,null,s.createElement("div",{className:"opt_label"},"\u56fa\u5b9a\u5728\u5de6\u4fa7"),a.map((function(n){return e._renderOptionItem(n,!1,"\u4e0d\u56fa\u5b9a",e._handleOnCancelFixedClick,"\u56fa\u5b9a\u5728\u5217\u5c3e",e._handleOnFixedRightClick)}))),(a.length>0||l.length>0)&&s.createElement("div",{className:"opt_label"},"\u4e0d\u56fa\u5b9a"),s.createElement("div",{id:"draggable_zone",style:{visibility:r.length>0}},r.map((function(n){return e._renderOptionItem(n,!0,"\u56fa\u5b9a\u5728\u5217\u5934",e._handleOnFilxedLeftClick,"\u56fa\u5b9a\u5728\u5217\u5c3e",e._handleOnFixedRightClick)}))),l.length>0&&s.createElement(s.Fragment,null,s.createElement("div",{className:"opt_label"},"\u56fa\u5b9a\u5728\u53f3\u4fa7"),l.map((function(n){return e._renderOptionItem(n,!1,"\u4e0d\u56fa\u5b9a",e._handleOnCancelFixedClick,"\u56fa\u5b9a\u5728\u5217\u5934",e._handleOnFilxedLeftClick)})))))},n}(s.PureComponent);const x=S;S.propTypes={className:m().string,title:m().string,value:m().arrayOf(m().shape({label:m().string,prop:m().string,fixed:m().string,checked:m().bool})),onChange:m().func};var P,R,F=t(35239),I=["data","total","loading","savedKey","pageIndex","pageSize","onPageChange","onPageSizeChange","className"],Z=function(e){function n(n){var t;return(t=e.call(this,n)||this)._handleOnResize=function(){var e=document.querySelector(".yt-listview-wrapper");e&&t.setState({tableWidth:e.clientWidth-5})},t._handleOnColumnsChange=function(e){t.setState({columns:e},(function(){t.props.savedKey&&function(e){return b.apply(this,arguments)}({projectId:F.t.get(F.V.curProject).id,key:t.props.savedKey,value:JSON.stringify(e.map((function(e){return{prop:e.prop,checked:e.checked,fixed:e.fixed}})))}).then((function(e){e.data}))}))},t.handleRoKey=function(e){var n=t.props.rowKeyProp;return n&&e&&e[n]?e[n]:JSON.stringify(e)},t.state={talbeWidth:0,columns:n.columns||[],loadingSave:!0},t}(0,i.Z)(n,e),n.getDerivedStateFromProps=function(e,n){};var t=n.prototype;return t.componentDidMount=function(){var e=this;window.addEventListener("resize",c()(this._handleOnResize,150)),this._handleOnResize();var n=this.props,t=n.savedKey,a=n.columns;t&&function(e){return E.apply(this,arguments)}({projectId:F.t.get(F.V.curProject).id,key:t}).then((function(n){var t,l=n.data;if(2e4===l.code)try{t=a.map((function(e,n){var t=JSON.parse(l.result).filter((function(n){var t=n.prop;return e.prop===t}));return t&&t.length>0?(0,r.Z)({},e,t[0]):e})).filter((function(e){return e}))}catch(i){}finally{e.setState({columns:t||e.state.columns,loadingSave:!1})}}))},t.componentWillUnmount=function(){window.removeEventListener("resize",this._handleOnResize)},t.componentDidUpdate=function(e,n){var t=this;JSON.stringify(e.columns)!==JSON.stringify(this.props.columns)&&this.props.columns.length>0&&this.setState({columns:this.props.columns.reduce((function(e,n,a){var l=t.state.columns.findIndex((function(e){var t=e.prop;return n.prop===t}));return e.splice(l>-1?l:a,0,(0,r.Z)({},n,t.state.columns[l])),e}),[]).filter((function(e){return e}))})},t.render=function(){var e=this.props,n=e.data,t=e.total,l=void 0===t?0:t,i=e.loading,o=e.savedKey,c=e.pageIndex,p=e.pageSize,d=e.onPageChange,m=e.onPageSizeChange,h=e.className,v=void 0===h?"":h,y=(0,a.Z)(e,I),C=this.state,_=C.columns,E=C.loadingSave;return s.createElement(g.Z,{data:n,className:"yt-listview-wrapper "+v,loading:o&&E||i},(0,g.P)(n)&&s.createElement(s.Fragment,null,s.createElement(u.Table,(0,r.Z)({},y,{columns:o?this.columns:this.props.columns,data:n,rowKey:this.handleRoKey})),d&&s.createElement(f,{onPageChange:d,onSizeChange:m,total:l,currLength:n.length,pageIndex:c,pageSize:p}),o&&s.createElement(x,{className:"column_selector",value:_,savedKey:o,onChange:this._handleOnColumnsChange})))},(0,l.Z)(n,[{key:"columns",get:function(){var e=this.state,n=e.tableWidth,t=e.columns,a=this.props,r=a.columnRenders,l=void 0===r?{}:r,i=a.headerRenders,o=void 0===i?{}:i,c=a.prefixColumns,s=0,u=0,p=0,d=[].concat(void 0===c?[]:c,JSON.parse(JSON.stringify(t.filter((function(e){var n=e.checked;return void 0===n||n})))));if(d.forEach((function(e){p+=e.width,e.fixed?s+=e.width:u+=e.width;var n=l[e.prop];n&&(e.render=n);var t=o[e.prop];t&&(e.renderHeader=t)})),n>p){var m=n-s;d.forEach((function(e){void 0!==e.checked&&!e.checked||e.fixed||(e.width=e.width/u*m)}))}return d}}]),n}(s.PureComponent);Z.propTypes={className:m().string,savedKey:m().string.isRequired,rowKeyProp:m().string,data:m().any.isRequired,total:m().number,fixedHeight:m().bool,loading:m().bool,pageIndex:m().number,pageSize:m().number,onPageChange:m().func,onPageSizeChange:m().func,columnRenders:m().shape((P={},P[m().string]=m().func,P)),headerRenders:m().shape((R={},R[m().string]=m().func,R)),prefixColumns:m().arrayOf(m().shape({label:m().string,prop:m().string,fixed:m().oneOf(["","left","right"]),width:m().number,checked:m().bool})),columns:m().arrayOf(m().shape({label:m().string,prop:m().string,fixed:m().oneOf(["","left","right"]),width:m().number,checked:m().bool})).isRequired};const L=Z}}]);