"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[7986],{87986:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var a=n(87462),l=n(94578),r=n(67294),c=n(61409),s=n(92360),i=n(5133),o=n(43036),u=n(49722),d=(n(55815),n(46701),n(39432)),p="template",m="taskMessage",f="handleResult",E="failLog",h=function(e){function t(t){var l;(l=e.call(this,t)||this).dragInit=function(){var e=l.state.timer,t=l.refs.drag;document.ondragover=function(n){clearTimeout(e),e=setTimeout((function(){t.style.display="none"}),200),l.setState({timer:e}),t.style.display="block"},t.ondragenter=function(e){l.setState({dragenter:!0})},t.ondragover=function(){return!1},t.ondragleave=function(){l.setState({dragenter:!1})},t.ondrop=function(e){var t=e.dataTransfer.files[0];return"xlsx"!==t.name.slice(t.name.lastIndexOf(".")+1)?(i.Z.warning("\u53ea\u652f\u6301 xlsx \u683c\u5f0f,\u8bf7\u91cd\u65b0\u4e0a\u4f20"),l.setState({fileTest:!1,dragenter:!1}),!1):(l.setState({file:t,fileTest:!0,dragenter:!1},(function(e){l.upLoadFile()})),!1)}},l.readFile=function(e){var t=e.target.files[0];"xlsx"!==t.name.slice(t.name.lastIndexOf(".")+1)?(i.Z.warning("\u53ea\u652f\u6301 xlsx \u683c\u5f0f,\u8bf7\u91cd\u65b0\u4e0a\u4f20"),l.setState({fileTest:!1})):l.setState({file:t,fileTest:!0},(function(e){l.upLoadFile()}))},l.upLoadFile=function(){l.setState({updateStatue:2});var e=l.xhr=new XMLHttpRequest;e.open("POST","/api/"+(0,d.AV)()+"/connection/preprocess/batch/url"),e.onreadystatechange=function(t){if(4===e.readyState)if(200===e.status){var n=JSON.parse(e.responseText);2e4===n.code&&l.setState({updateStatue:3,fileResult:(0,a.Z)({},n.result)}),i.Z[2e4===n.code?"success":"error"](n.msg)}else i.Z.error("\u4e0a\u4f20\u51fa\u9519")},e.upload.onprogress=function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);l.setState({percent:t})}},e.onabort=function(e){i.Z.error("\u4e0a\u4f20\u5df2\u4e2d\u65ad")};var t=new FormData;t.append("file",l.state.file),t.append("projectId",l.state.projectId),t.append("connectionType",l.state.connectionType),e.send(t)},l.downLoadFile=function(e){var t,n=l.state,a=n.projectId,r={connectionType:n.connectionType,projectId:a};switch(e){case p:t="/excel/template/download";break;case m:t="/excel/all/url/connection/download";break;case f:t="/excel/preprocess/download",r.excelId=l.state.fileResult.excelId;break;case E:t="/excel/failure/download",r.excelId=l.state.upLoadResult.excelId;break;default:t=null}t&&(l.setState({loading:!0}),u.h.post(t,r).then((function(e){var t=e.data;if(l.setState({loading:!1}),2e4===t.code&&t.result){var n=document.createElement("a");n.href=t.result,n.click()}else i.Z.error("\u64cd\u4f5c\u5931\u8d25")})).catch((function(e){l.setState({loading:!1})})))},l.renderUpload=function(){var e=l.state.fileTest;return r.createElement("div",{className:"upload"},r.createElement("input",{ref:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",type:"file",onChange:function(e){return l.readFile(e)}}),r.createElement("div",{className:"add",onClick:function(e){return l.refs.file.click()}},r.createElement("div",null)),r.createElement("b",null,r.createElement("span",{className:"dark-blue",onClick:function(e){return l.refs.file.click()}},"\u70b9\u51fb\u4e0a\u4f20\u6587\u4ef6\xa0"),"\u6216\u8005 \u62d6\u62fd\u4e0a\u4f20"),r.createElement("div",{className:"accept",style:{color:e?"":"#D96969"}},"\uff08\u53ea\u652f\u6301 xlsx \u683c\u5f0f\uff09"),r.createElement("p",null,r.createElement("span",{className:"dark-blue",onClick:function(e){return l.downLoadFile(p)}},"\u4e0b\u8f7d\u6807\u51c6\u6a21\u677f\xa0"),"\u586b\u5199\u5546\u54c1\u94fe\u63a5\u4fe1\u606f\u6279\u91cf\u65b0\u589e"))},l.renderUploading=function(){return l.refs.loading&&l.refs.loading.style.setProperty("--x",l.state.percent+"%"),r.createElement("div",{className:"uploading"},r.createElement("b",null,"\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7b49\u5f85..."),r.createElement("div",{ref:"loading"},r.createElement("block",null)),r.createElement("span",{className:"dark-blue"}))},l.renderUploadFinish=function(){var e=l.state.file;return r.createElement("div",{className:"upload-Finish"},r.createElement("img",{src:n(5455),alt:""}),r.createElement("b",null,e.name),r.createElement("p",null,r.createElement("span",{className:"dark-blue",onClick:function(e){return l.downLoadFile(p)}},"\u4e0b\u8f7d\u6807\u51c6\u6a21\u677f\xa0"),"\u586b\u5199\u5546\u54c1\u94fe\u63a5\u4fe1\u606f\u6279\u91cf\u65b0\u589e"))},l.renderUpdateType=function(){var e=l.state,t=e.updateType,n=e.fileResult;return r.createElement("div",{className:"update-type"},r.createElement("b",null,"\u9884\u5904\u7406\u7ed3\u679c"),r.createElement(o.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:r.createElement("a",{style:{color:"#7262FD"},href:"https://skieer.feishu.cn/docs/doccnbH85LqIFQPZEKoqYWW61Rh?from=from_copylink",target:"_blank",rel:"noopener noreferrer"},"\u4e86\u89e3\u66f4\u591a")},r.createElement("i",{className:"icon-cem_file1",style:{marginLeft:4}})),r.createElement("p",{className:"result-detail"},r.createElement("span",null,"\u65b0\u589e\uff1a",r.createElement("a",null," ",n.canAdd,"\u6761")),r.createElement("span",null,"\u66f4\u65b0\uff1a",r.createElement("a",null," ",n.updateable,"\u6761"),r.createElement("div",{className:0===t?"sel":"",onClick:function(e){return l.setState({updateType:0})}},"\u6682\u4e0d\u5904\u7406"),r.createElement("div",{className:1===t?"sel":"",onClick:function(e){return l.setState({updateType:1})}},"\u7acb\u5373\u66f4\u65b0")),r.createElement("span",null,"\u5f85\u7ef4\u62a4\uff1a",r.createElement("a",null," ",n.toBeMaintained,"\u6761")),r.createElement("span",null,"\u4e0d\u7b26\u5408\u6a21\u7248\u683c\u5f0f\uff1a",r.createElement("a",null," ",n.unqualified,"\u6761"))),r.createElement("p",{className:"pre-result"},r.createElement("span",{className:"dark-blue",onClick:function(e){return l.downLoadFile(f)}},"\u67e5\u770b\u9884\u5904\u7406\u8be6\u7ec6\u7ed3\u679c")))},l.pre=function(){var e=l.state,t=e.stepNow,n=e.updateStatue;1===t&&1===n?c.mW.go(-1):1===t&&n>1?(2===n&&l.xhr.abort(),l.setState({updateStatue:1,file:null})):t>1&&l.setState({stepNow:--t})},l.next=function(){var e=l.state.stepNow;2===e&&l.upLoad(),e++,l.setState({stepNow:e})},l.upLoad=function(){var e=l.state,t=e.fileResult,n=e.updateType,r=e.projectId;u.h.post("connection/batch/add/url",{excelId:t.excelId,update:Boolean(n),projectId:r}).then((function(e){2e4===e.data.code?(l.setState({upLoadResult:(0,a.Z)({},e.data.result)}),i.Z.success(e.data.msg)):i.Z.error(e.data.msg)}))};var s=t.location.state;return l.state={title:[].concat(s.title,["\u6279\u91cf\u4e0a\u4f20\u4efb\u52a1"]),projectId:s.projectId,file:null,updateType:0,fileTest:!0,loading:!1,updateStatue:1,stepNow:1,percent:100,dragEnter:!1,timer:0,fileResult:{canAdd:"",updateable:"",unqualified:"",excelId:""},upLoadResult:{success:"",failure:"",notUpdate:"",excelId:""},connectionType:t.location.pathname.includes("/price")?"PRICE":"DEFAULT"},l}(0,l.Z)(t,e);var h=t.prototype;return h.componentDidMount=function(){this.dragInit()},h.renderContent=function(){var e=this.state,t=e.updateStatue,n=e.stepNow;if(1!==n)return 2===n?this.renderUpdateType():null;switch(t){case 1:return this.renderUpload();case 2:return this.renderUploading();case 3:return this.renderUploadFinish()}},h.render=function(){var e=this,t=this.state,a=t.dragenter,l=t.updateStatue,i=t.stepNow,o=t.upLoadResult,u=t.loading,d=t.fileResult,p=location.pathname.split("/")[3];return r.createElement("div",{className:"batch-add"},r.createElement(s.Loading,{loading:u,style:{height:"100%"}},i<3?r.createElement("div",{className:"step-wrap"},r.createElement("header",null,r.createElement("div",{className:1===i?"sel":""},r.createElement("span",null,"1"),r.createElement("p",null,"\u4e0a\u4f20\u6587\u4ef6")),r.createElement("div",{className:2===i?"sel":""},r.createElement("span",null,"2"),r.createElement("p",null,"\u5bfc\u5165\u5217\u8868"))),r.createElement("section",{className:a?"is-drag":""},this.renderContent(),r.createElement("div",{ref:"drag",className:"drag",style:{zIndex:1===i&&1===l?"":"-1"}})),r.createElement("footer",null,r.createElement(s.Button,{onClick:function(t){return e.pre()}},"\u53d6\u6d88"),r.createElement(s.Button,{type:"primary",disabled:l<3,onClick:function(t){return e.next()}},2===i?"\u786e\u8ba4\u5bfc\u5165":"\u4e0b\u4e00\u6b65"))):r.createElement("div",{className:"finish"},r.createElement("div",{className:"step-wrap"},r.createElement("header",null,r.createElement("div",{className:1===i?"sel":""},r.createElement("span",null,"1"),r.createElement("p",null,"\u4e0a\u4f20\u6587\u4ef6")),r.createElement("div",{className:3===i?"sel":""},r.createElement("span",null,"2"),r.createElement("p",null,"\u9009\u62e9\u66f4\u65b0\u65b9\u5f0f")))),r.createElement("div",{className:"finish-content"},r.createElement("img",{src:n(67758),alt:""}),r.createElement("b",null,"\u63d0\u4ea4\u6210\u529f"),r.createElement("p",{className:"result-detail"},r.createElement("span",null,"\u4e0a\u4f20\u6210\u529f\uff1a",r.createElement("a",null,o.success," \u6761")),r.createElement("span",null,"\u4e0a\u4f20\u5931\u8d25\uff1a ",r.createElement("a",null,o.failure," \u6761")),r.createElement("span",null,"\u6682\u4e0d\u66f4\u65b0\uff1a ",r.createElement("a",null,o.notUpdate," \u6761"))),r.createElement("p",{className:"pre-result"},r.createElement("span",{className:"dark-blue",onClick:function(t){return e.downLoadFile(E)}},"\u67e5\u770b\u5931\u8d25\u65e5\u5fd7")),r.createElement("p",{className:"success_link_num"},"\u4e0a\u4f20\u6210\u529f\u7684 ",o.success," \u6761\u5546\u54c1\u94fe\u63a5\u4e2d"),r.createElement("p",{className:"result-detail"},r.createElement("span",null,"\u5df2\u6dfb\u52a0\u5230\u9879\u76ee\uff1a",r.createElement("a",null,o.success," \u6761")),r.createElement("span",null,"\u9700\u8981\u7ef4\u62a4\u7684\u94fe\u63a5\uff1a ",r.createElement("a",null,d.toBeMaintained," \u6761"))),Number(d.toBeMaintained)>0&&r.createElement(s.Button,{type:"primary",onClick:function(){return c.mW.push({pathname:"/account/project/"+p+"/link/linkMaintenance",state:{batchNo:d.batchNo}})}},"\u7acb\u5373\u7ef4\u62a4")))))},t}(r.Component)},46701:(e,t,n)=>{n.d(t,{u:()=>l});var a=n(35239),l=function(e){var t=e.title,n=e.url;return[{title:a.t.get(a.V.backProjectConfig).name,url:"/account/project/preview"},{title:"comment"===n.split("/")[3]?"\u7535\u5546\u8bc4\u8bba":"price"===n.split("/")[3]?"\u7535\u5546\u76d1\u63a7":"\u6570\u636e\u94fe\u63a5",url:"/account/project/"+n.split("/")[3]},{title:t,url:n}]}},55815:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),l=n(67294),r=n(45697),c=n.n(r),s=n(43036),i=n(61409),o=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return(t=e.call.apply(e,[this].concat(a))||this)._handleBreadcrumbClick=function(e){var n=t.props,a=n.title,l=n.beforeJump;e!==a.length-1&&(l?new Promise((function(e,t){return l(e,t)})).then((function(){i.mW.push({pathname:a[e].url,state:a[e].state})})):i.mW.push({pathname:a[e].url,state:a[e].state}))},t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,a=t.mainTitle,r=t.rightContent,c=t.className,i=t.overlay;return l.createElement("div",{className:"breadcumb-wrapper "+c},n instanceof Array?l.createElement("div",{className:"breadcrumb-left"},l.createElement("div",null,n.map((function(t,a){return l.createElement("span",{className:t.url?"":"not_clickable",key:a,onClick:function(){return t.url&&a!==n.length-1&&e._handleBreadcrumbClick(a)}},t.title,a!==n.length-1&&" / ")}))),l.createElement("span",null,a||n[n.length-1].title,i&&l.createElement(s.Z,{placement:"top",overlay:i},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):l.createElement("div",{className:"normal-title"},n,i&&l.createElement(s.Z,{placement:"top",overlay:i},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),r||"")},t}(l.Component);o.propTypes={className:c().string,title:c().oneOfType([c().string,c().arrayOf(c().shape({title:c().string,url:c().string,state:c().object}))]).isRequired,overlay:c().oneOfType([c().string,c().node]),mainTitle:c().oneOfType([c().string,c().node]),beforeJump:c().func,rightContent:c().node};const u=o},67758:(e,t,n)=>{e.exports=n.p+"img/4cab336912dd4f2192bd.png"},5455:(e,t,n)=>{e.exports=n.p+"img/db25b245f52ccee28ed9.png"}}]);