"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[73],{28184:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Tt});var a=n(87462),i=n(94578),r=n(50576),s=n(49221),o=n(67294),l=n(43144),c=n(45697),u=n.n(c),d=n(92360),p=n(5133),m=n(29383),f=n(49722),h=n(95814),g=function(e){function t(t){var n;return(n=e.call(this,t)||this).inputChange=function(e){n.setState({inputVal:e.target.value})},n.keywordChange=function(e){var t=n.state,a=t.inputVal,i=t.inputValMap;"keydown"===e.type&&13===e.keyCode||"keydown"===e.type&&32===e.keyCode||"blur"===e.type?a.trim()&&(i.push(a.trim()),n.setState({inputValMap:i,inputVal:""}),n.onChange()):"keydown"===e.type&&8===e.keyCode||e.type},n.delKeyWords=function(e){var t=n.state.inputValMap;t.splice(e,1),n.setState({inputValMap:t},(function(e){return n.onChange()}))},n.onChange=function(){n.props.onChange&&n.props.onChange(n.state.inputValMap)},n.state={inputValMap:t.values?t.values:[],inputVal:""},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillReceiveProps=function(e,t){e.values&&this.setState({inputValMap:e.values})},n.render=function(){var e=this,t=this.state,n=t.inputValMap,a=t.inputVal,i=this.props,r=i.style,s=i.close;return o.createElement("div",{className:"word-segmentation",style:r||{}},s&&o.createElement("i",{className:"close",onClick:s},"\xd7"),o.createElement("div",{className:"input-wrap"},o.createElement("input",{type:"text",className:"keyword-setting",value:a,placeholder:"\u5173\u952e\u8bcd(\u8f93\u5165\u7a7a\u683c\u952e\u6216\u56de\u8f66\u4ee5\u5206\u8bcd)",onChange:this.inputChange,onBlur:this.keywordChange,onKeyDown:this.keywordChange})),n.map((function(t,n){return o.createElement("span",{className:"word",key:t+n},t,o.createElement("i",{onClick:function(){return e.delKeyWords(n)}},"\xd7"))})))},t}(o.Component);const v=g;var y=n(43036),E=n(35239),C=function(e,t,n,a,i,r){return f.h.post("/filter/expand/add",{name:e,copy:t,id:n,model:a,projectId:i,filter:r})};const S=function(e){function t(t){var n;return(n=e.call(this,t)||this).editTopic=function(e){n.editing=e,n.refs.changeNameInput.refs.input.value=e.name,n.setState({dialogVisible:!0})},n.delTopic=function(e){d.MessageBox.confirm("\u786e\u8ba4\u5220\u9664\u8be5\u7ec4\u5408\u5206\u6790, \u662f\u5426\u7ee7\u7eed?","\u63d0\u793a",{type:"warning"}).then((function(){f.h.post("/filter/delete",{id:e.id}).then((function(t){n.props.onChange(null,{id:e.id}),2e4===t.data.code?p.Z.success("\u5220\u9664\u6210\u529f"):p.Z.error("\u5220\u9664\u5931\u8d25")}))})).catch((function(){}))},n.getExpandTopicValue=function(e){return f.h.post("/filter/expand/findFilter",{id:e})},n.competeOpen=function(){n.refs.topics.offsetHeight>45?n.setState({showOpen:!0}):n.setState({showOpen:!1})},n._handleChangeName=function(){var e=n.refs.changeNameInput.refs.input.value;n.getExpandTopicValue(n.editing.id).then((function(t){var a=t.data.result;C(e,!1,a.id,n.props.model,E.t.get(E.V.curProject).id,JSON.parse(a.filter)).then((function(e){var t=e.data;2e4===t.code&&(p.Z.success("\u7ec4\u5408\u5206\u6790\u540d\u79f0\u4fee\u6539\u6210\u529f"),n.refs.changeNameInput.refs.input.value="",n.setState({dialogVisible:!1},(function(){return n.props.fresh(a.id,{name:t.result.name,id:t.result.id})})))}))}))},n.renderDialog=function(){return o.createElement(d.Dialog,{title:"\u4fee\u6539\u540d\u79f0",className:"change-name-dialog",size:"tiny",modal:!1,visible:n.state.dialogVisible,onCancel:function(e){return n.setState({dialogVisible:!1})}},o.createElement(d.Dialog.Body,null,o.createElement(d.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",ref:"changeNameInput"})),o.createElement(d.Dialog.Footer,null,o.createElement(d.Button,{type:"primary",onClick:n._handleChangeName},"\u786e\u5b9a"),o.createElement(d.Button,{type:"default",onClick:function(e){return n.setState({dialogVisible:!1})}},"\u53d6\u6d88")))},n.state={list:t.list?t.list:[],value:t.value?t.value:{},showOpen:!1,open:!1,dialogVisible:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillReceiveProps=function(e,t){(e.value||e.list)&&(this.setState({value:e.value,list:e.list}),this.competeOpen())},n.componentDidMount=function(){this.competeOpen()},n.render=function(){var e=this,t=this.state,n=t.list,a=t.showOpen,i=t.open,r=t.value,s=this.props,l=s.close,c=s.onChange;return o.createElement("div",{className:"expand-topic",style:{height:i?"":"38px"}},o.createElement("p",{className:"name"},"\u7ec4\u5408\u5206\u6790",o.createElement(y.Z,{overlay:o.createElement("div",{style:{width:"220px"}},"\u4f60\u53ef\u4ee5\u57fa\u4e8e\u7b5b\u9009\u6761\u4ef6\u751f\u6210\u4e00\u4e2a\u7ec4\u5408\u7684\u5206\u6790\u5bf9\u8c61\u3002\u5728\u5207\u6362\u5206\u6790\u5bf9\u8c61\u65f6\u4f60\u53ef\u4ee5\u4ece\u201c\u7ec4\u5408\u5206\u6790\u201d\u4e2d\u4f7f\u7528\u4f60\u521b\u5efa\u7684\u7ec4\u5408\u5206\u6790\u5bf9\u8c61\u3002"),placement:"top"},o.createElement("i",{className:"icon-cem_file1 hide",style:{color:"#8c8c8c"}}))),o.createElement("div",{className:"topics",ref:"topics"},o.createElement("div",{className:"more"},a&&o.createElement("i",{className:"open",onClick:function(t){return e.setState({open:!i})}},i?"\u6536\u8d77":"\u66f4\u591a",o.createElement("i",{className:i?"icon-cem_pull-or-take-up":"icon-cem_pull-down-or-take-up"})),l&&o.createElement("i",{className:"closeAll",onClick:l},"\xd7")),o.createElement("div",{className:"topic-wrap"},n.length>0?n.map((function(t,n){return o.createElement("span",{className:"topic "+(r.id===t.id?"sel":""),key:t+n},o.createElement(y.Z,{placement:"top",overlay:"\u5355\u51fb\u7f16\u8f91"},o.createElement("span",{onClick:function(e){return c&&c({id:t.id,name:t.name})}},t.name)),o.createElement(y.Z,{placement:"top",overlay:"\u91cd\u547d\u540d"},o.createElement("i",{onClick:function(n){return e.editTopic(t)},className:"icon-cem_screening-editor"})),o.createElement(y.Z,{placement:"top",overlay:"\u5220\u9664"},o.createElement("i",{onClick:function(){return e.delTopic(t)},className:"icon-cem icon-cem_delete"})))})):o.createElement("div",{style:{color:"#262626",lineHeight:"38px"}},"\u6682\u65e0\u4e3b\u9898\u503c"))),this.renderDialog())},t}(o.Component);var N=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={defaultChecked:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.setState((0,a.Z)({},this.props))},n.componentWillReceiveProps=function(e){this.setState((0,a.Z)({},e))},n.handleClick=function(e){var t=this.state,n=t.type,a=t.defaultChecked,i=t.selectedList,r=t.totalList;if("checkAll"===n)a?this.props.onChange([]):this.props.onChange(r);else{var s=i.indexOf(e);s>-1?i.splice(s,1):i.push(e),this.props.onChange(i)}this.setState({defaultChecked:!a})},n.render=function(){var e=this,t=this.state,n=t.type,a=t.defaultChecked,i=t.indeterminate,r=t.uniqueId,s="customized-checkobx";return a?s="customized-checkobx checked":"checkAll"===n&&i&&(s="customized-checkobx indeterminate"),o.createElement("div",{className:"customized-checkobx-wrapper"},o.createElement("div",{className:s,onClick:function(t){t.stopPropagation(),e.handleClick(r)}}))},t}(o.PureComponent);function k(e,t){var n,a,i,r;function s(e,t){var n;if(isNaN(e)&&isNaN(t)&&"number"===typeof e&&"number"===typeof t)return!0;if(e===t)return!0;if("function"===typeof e&&"function"===typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;if(i.indexOf(e)>-1||r.indexOf(t)>-1)return!1;for(n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!==typeof e[n])return!1}for(n in e){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!==typeof e[n])return!1;switch(typeof e[n]){case"object":case"function":if(i.push(e),r.push(t),!s(e[n],t[n]))return!1;i.pop(),r.pop();break;default:if(e[n]!==t[n])return!1}}return!0}if(arguments.length<1)return!0;for(n=1,a=arguments.length;n<a;n++)if(i=[],r=[],!s(arguments[0],arguments[n]))return!1;return!0}var O=n(39432),I=!0,b=function(e){function t(t){var n;return(n=e.call(this,t)||this).init=function(){n.setState((0,a.Z)({},n.props),(function(){n.state.show&&n.fetchData()}))},n.switchPage=function(e){n.setState({pageNum:e},(function(){return n.fetchData()}))},n.switchPageSize=function(e){n.setState({pageSize:e,pageIndex:1},(function(){return n.fetchData()}))},n.handleCheck=function(e){for(var t=n.state,a=t.currPageList,i=t.selectedList,r=e.length-1;r>=0;r--)-1===i.indexOf(e[r])&&i.push(e[r]);for(var s=a.length-1;s>=0;s--)if(-1===e.indexOf(a[s].id)){var o=i.indexOf(a[s].id);o>-1&&i.splice(o,1)}n.setState({currPageSelectedList:e,selectedList:i},(function(){return n.handleCheckboxStyle()}))},n.handleCheckboxStyle=function(){var e=n.state,t=e.currPageSelectedList,a=e.currPageList,i=e.checkAllStatus;if(t.length===a.length&&a.length>0)i.checked=!0,a.forEach((function(e){e.checked=!0;var t=document.getElementById(e.id);t&&t.classList.add("item-active")}));else{0===t.length?(i.indeterminate=!1,a.map((function(e){e.checked=!1;var t=document.getElementById(e.id);return t&&t.classList.remove("item-active"),e}))):i.indeterminate=!0,i.checked=!1;for(var r=a.length-1;r>=0;r--){for(var s=!1,o=t.length-1;o>=0;o--)if(t[o]===a[r].id){s=!0,a[r].checked=!0;var l=document.getElementById(a[r].id);l&&l.addClass("item-active");break}if(!s){a[r].checked=!1;var c=document.getElementById(a[r].id);c&&c.classList.remove("item-active")}}}n.setState({currPageList:a,checkAllStatus:i})},n.handleChange=function(e){n.setState({keywords:e})},n.handleKeyUp=function(e){13===e.keyCode&&n.setState({selectedList:[],pageNum:1},(function(){return n.fetchData()}))},n.handleSort=function(e){var t=e.prop,a=e.order;n.setState({sortName:t||"createdAt",sortType:a||"descending",selectedList:[],pageNum:1},(function(){return n.fetchData()}))},n.state={show:!1,queryParams:null,keywords:"",sortName:"createdAt",sortType:"descending",currPageList:[],currPageSelectedList:[],selectedList:[],pageNum:1,pageSize:20,data:[],totalRecords:0,checkAllStatus:{checked:!1,indeterminate:!1},loading:!1,columns:[{label:"",width:16,prop:"paddingLeft"},{label:"",width:56,renderHeader:function(){return o.createElement(N,{type:"checkAll",defaultChecked:n.state.checkAllStatus.checked,indeterminate:n.state.checkAllStatus.indeterminate,onChange:n.handleCheck,selectedList:n.state.currPageSelectedList,totalList:n.state.currPageList.map((function(e){return e.id}))})},render:function(e){return o.createElement(N,{type:"checkOne",defaultChecked:e.checked||!1,onChange:n.handleCheck,selectedList:n.state.currPageSelectedList,totalList:n.state.currPageList.map((function(e){return e.id})),uniqueId:e.id})}},{label:"\u94fe\u63a5\u540d\u79f0",render:function(e){var t=e.name,n=e.url;return o.createElement("div",{className:"ellipsis",title:t,onClick:function(e){e.stopPropagation(),n.startsWith("http")&&window.open(n)}},t)}},{label:"\u603b\u6570\u636e\u91cf",prop:"total",render:function(e){var t=e.total;return o.createElement("div",null,O.ZP.formatNumber(t))}},{label:"\u521b\u5efa\u65f6\u95f4",sortable:"custom",prop:"createdAt",render:function(e){var t=e.createdAt;return o.createElement("div",null,t&&t.replace("T"," "))}},{label:"",width:16,prop:"paddingRight"}]},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.init()},n.UNSAFE_componentWillReceiveProps=function(e){var t=this,n=e.queryParams&&e.queryParams.filterModel,i=this.state.queryParams&&this.state.queryParams.filterModel;k((0,a.Z)({},i,{connections:[]}),(0,a.Z)({},n,{connections:[]}))||function(){var n=t.props.show;t.setState((0,a.Z)({},e,{pageNum:1}),(function(){n?t.setState({pageNum:1,selectedList:[]},(function(){return t.fetchData()})):t.setState({pageNum:1},(function(){return t.fetchData()}))}))}(),e.show!==this.state.show&&this.setState({show:e.show})},n.fetchData=function(){var e=this,t=this.state,n=t.keywords,i=t.queryParams,r=t.sortName,s=t.sortType,o=t.pageNum,l=t.pageSize,c=t.defaultValue,u=this.state,d=u.currPageList,p=u.currPageSelectedList,m=u.selectedList,h=u.totalRecords;I&&c[0]&&c[0].values.length>0&&(i.filterModel.connections=c[0].values);var g=void 0,v=window.location.pathname;/^\/price/.test(v)&&(g="PRICE"),this.setState({loading:!0},(function(){f.h.post("/filter/connection/search",(0,a.Z)({projectId:E.t.get(E.V.curProject).id},i,{name:n,sortName:r,sort:s,pageIndex:o,pageSize:l,queryType:g})).then((function(t){if(200===t.status||304===t.status){var n=t.data.result;d=n.list,p=[];for(var a=d.length-1;a>=0;a--)m.indexOf(d[a].id)>-1?(d[a].checked=!0,p.push(d[a].id)):d[a].checked=!1;h=n.count,I&&c[0]&&c[0].values.length>0&&(p=c[0].values,m=c[0].values,I=!1),e.setState({currPageList:d,currPageSelectedList:p,selectedList:m,totalRecords:h,data:n},(function(){return e.handleCheckboxStyle()}))}})).finally((function(){e.setState({loading:!1})}))}))},n.getValue=function(){return this.state.selectedList},n.render=function(){var e=this,t=this.state,n=t.show,a=t.currPageList,i=t.currPageSelectedList,r=t.pageNum,s=t.pageSize,l=t.totalRecords,c=t.loading,u=t.columns;return o.createElement("div",{className:"advanced-filter-wrapper",style:{display:n?"block":"none"}},o.createElement("div",{className:"advanced-filter-body"},o.createElement(d.Input,{ref:function(t){return e.searchInput=t},placeholder:"\u8bf7\u8f93\u5165\u94fe\u63a5\u540d\u79f0",onChange:this.handleChange,onKeyUp:this.handleKeyUp,icon:"search"}),o.createElement(d.Loading,{loading:c},o.createElement(m.Z,{className:"connection-table",maxHeight:306,columns:u,data:a,total:l,currentPage:r,pageSize:s,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,onPage:this.switchPage,onSortChange:this.handleSort,rowClassName:function(e){return i.includes(e.id)?"item-active":""},notLimit:!1}))))},t}(o.Component),T=n(61193),w=n(61409),x=n(97189),L=function(e){function t(t){var n;return(n=e.call(this,t)||this).getFilter=function(){var e=n.state,t=e.filterListShow,a=e.filterListHide,i=n.props,r=i.type,s=i.filter,o=i.getTitles,l=[];return f.h.post("/filter/find",{type:r||"INBOX",filterTypes:s,projectId:n.state.projectId}).then((function(e){return l=n.formatData(e.data.result),o&&o(JSON.parse(JSON.stringify(l))),t=JSON.parse(JSON.stringify(l.slice(0,4))),a=JSON.parse(JSON.stringify(l.slice(4))),n.setState({allList:l,filterListShow:t,filterListHide:a},(function(e){return n.reFilterList(n.state.value,(function(e){n.sortList(n.saveList)}))})),e}))},n.handleChangeSel=function(e,t,a){var i=n.state.value;if(!i.some((function(n){return n.id===e.id&&(n.values=t,a&&a.length>0&&(n.secondValue=a.map((function(t){return{fatherId:e.child.id,id:t.id,values:t.values}}))),!0)}))){var r={id:e.id,special:e.special,values:t};a&&a.length>0&&(r.secondValue=a.map((function(t){return{fatherId:e.child.id,id:t.id,values:t.values}}))),i.push(r)}n.reFilterList(i,(function(e){n.onChange()}))},n.keyWordChange=function(e,t){var a=n.state.value;0===e.length?a.splice(a.findIndex((function(e){return e.id===t.id})),1):a.some((function(n){if(n.id===t.id)return n.values=e,!0}))||a.push({id:t.id,special:t.special,values:e}),n.setState({value:a},(function(e){return n.onChange()}))},n.expandTopicChange=function(e,t,a){if(t)n.updateExpandTopic(t.id,t.value);else{if(e.id===n.state.expandTopic.id&&!a)return void n.reFilterList([],(function(e){return n.setState({expandTopic:{id:"",name:"",value:[]}},(function(e){n.sortList(),n.props.onExpandTopicChange&&n.props.onExpandTopicChange(n.state.expandTopic)}))}));n.refs.expandTopic.getExpandTopicValue(e.id).then((function(t){var a=D(JSON.parse(t.data.result.filter));n.reFilterList(a,(function(t){return n.setState({expandTopic:{id:e.id,name:e.name,value:a}},(function(e){n.sortList(),n.props.onExpandTopicChange&&n.props.onExpandTopicChange(n.state.expandTopic)}))}))}))}},n.getExpandTopicData=function(){return n.state.expandTopic.id?n.state.expandTopic:null},n.isExpandTopicChanged=function(){return!k(n.state.value.filter((function(e){return"connections"!==e.special})),n.state.expandTopic.value.filter((function(e){return"connections"!==e.special})))},n.updateExpandTopic=function(e,t){var a=n.state.allList;a.some((function(n){if("expandTopic"===n.special)return e?(n.values.splice(n.values.findIndex((function(t){return t.id===e})),1),t&&n.values.unshift(t)):n.values.unshift(t),!0})),n.setState({allList:a},(function(e){return n.reFilterList(n.state.value,n.saveList)}))},n.saveList=function(){if(-1===location.pathname.indexOf("inbox")){var e=n.getFilterList(),t=n.getValue(),i=[],r=[];e.forEach((function(e){e.child&&e.child.values.length>0&&i.push((0,a.Z)({},e.child,{special:"connConfig"}))})),t.forEach((function(e){e.secondValue&&e.secondValue.length>0&&r.push({id:e.secondValue[0].fatherId,values:e.secondValue.reduce((function(e,t){return e.concat(t.values)}),[])})})),e=(e=e.filter((function(e){return!["KEY_WORD"].includes(e.special)}))).concat(e.splice(e.findIndex((function(e){return"expandTopic"===e.special})),1)),E.t.set(E.V.filterList,JSON.stringify({list:e.concat(i),value:t.concat(r)}));var s=new Event("setItemEvent");s.key="filter-list",window.dispatchEvent(s)}},n.onChange=function(){n.props.onFilterChange&&n.props.onFilterChange(n.getReFormatValue())},n.renderCheckBox=function(e,t){var a=n.state,i=a.searchInfo,r=a.value,s=r.filter((function(t){return t.id===e.id}))[0]?r.filter((function(t){return t.id===e.id}))[0].values:[],l=r.filter((function(t){return t.id===e.id}))[0]&&r.filter((function(t){return t.id===e.id}))[0].secondValue?r.filter((function(t){return t.id===e.id}))[0].secondValue:[],c=i.id===e.id?e.values.filter((function(e){return-1!==e.name.toLowerCase().indexOf(i.keyword.toLowerCase())})):e.values;return e.values.length>0?o.createElement(h.Z,{key:t,checkedList:s,secondInfo:e.child,secondValue:l,data:c,allListLength:e.values.length,changeState:function(t,a){return n.handleChangeSel(e,t,a)},onSearch:function(t){return n.setState({searchInfo:{isSearching:!0,id:e.id,name:e.name,keyword:""}})},title:e.name,close:function(e){return n.delFilter(t)}}):null},n.toggleAdvancedFilter=function(){n.setState({advancedFilterShow:!n.state.advancedFilterShow})},n.closeAdvancedFilter=function(){n.setState({advancedFilterShow:!1})},n.state={value:n.props.value||[],allList:[],reFilterData:[],filterListShow:[],filterListHide:[],searchInfo:{isSearching:!1,name:"",id:"",keyword:""},expandTopic:{id:"",name:"",value:[]},loading:!1,projectId:E.t.get(E.V.curProject).id,advancedFilterShow:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.formatData=function(e){var t=[];e.topics&&e.topics.titles&&e.topics.titles.length>0&&(this.setState({reFilterData:e.topics.data}),t.push.apply(t,e.topics.titles.filter((function(e){return e.special="connConfig",e.values.length>1})))),e.source&&e.source.length>0&&t.push({id:"source",name:"\u6570\u636e\u6765\u6e90",special:"source",values:e.source}),e.tag&&e.tag.length>0&&e.tag.forEach((function(e){e.special="tag",t.push(e)})),this.props.filterConfig&&this.props.filterConfig.forEach((function(e){switch(e){case"ESCORE":t.push({id:"escore",special:"escore",name:"\u60c5\u611f",values:[{id:"1",name:"\u6b63\u9762"},{id:"0",name:"\u4e2d\u6027"},{id:"-1",name:"\u8d1f\u9762"}]});break;case"MESSAGE_TYPE":t.push({id:"messageType",special:"messageType",name:"\u6d88\u606f\u7c7b\u578b",values:[{id:"PL",name:"\u8bc4\u8bba"},{id:"ZP",name:"\u8ffd\u8bc4"},{id:"TW",name:"\u63d0\u95ee"},{id:"HD",name:"\u56de\u7b54"},{id:"SX",name:"\u79c1\u4fe1"},{id:"YW",name:"\u539f\u6587"},{id:"HF",name:"\u56de\u590d"},{id:"KH",name:"\u5ba2\u670d\u56de\u590d"},{id:"DSWT",name:"\u7535\u5546\u95ee\u9898"},{id:"DSDA",name:"\u7535\u5546\u7b54\u6848"}]});break;case"KEY_WORD":t.push({id:"KEY_WORD",special:"content",name:"\u5173\u952e\u8bcd",values:[]})}})),e.expandTopics&&t.push({id:"expandTopic",name:"\u7ec4\u5408\u5206\u6790",special:"expandTopic",values:e.expandTopics});var n=t.map((function(e){return(0,a.Z)({},e,{values:e.values.length>0?(0,O.QM)(e.values):e.values})}));return JSON.parse(JSON.stringify(n))},n.sortList=function(e){for(var t=JSON.parse(JSON.stringify(this.state)),n=t.value,a=t.filterListHide,i=t.filterListShow,r=i.length;r--;)i[r]&&!n.some((function(e){return e.id===i[r].id}))&&"expandTopic"!==i[r].special&&a.unshift(i.splice(r,1)[0]);n.forEach((function(e){a.forEach((function(t,n){e.id===t.id&&i.push(a.splice(n,1)[0])}))})),i.length<4&&(i=i.concat(a.splice(0,4-i.length))),this.setState({filterListHide:a,filterListShow:i},(function(t){return e&&e()}))},n.addMoreFilter=function(e){var t=this,n=this.state,a=n.filterListShow,i=n.filterListHide;a.push.apply(a,i.splice(e,1)),this.setState({filterListShow:a,filterListHide:i},(function(){t.reFilterList(t.state.value)}))},n.delFilter=function(e){var t=this,n=this.state,a=n.filterListShow,i=n.filterListHide,r=n.value;r=r.filter((function(t){return t.id!==a[e].id})),i.push.apply(i,a.splice(e,1)),this.setState({filterListShow:a,filterListHide:i},(function(e){return t.reFilterList(r,t.onChange)}))},n.closeExpandTopic=function(e){var t=this.state,n=t.filterListShow,a=t.filterListHide;a.push.apply(a,n.splice(n.findIndex((function(e){return"expandTopic"===e.id})),1)),this.setState({filterListShow:n,filterListHide:a})},n.reFilterList=function(e,t){var n=this.state,a=n.reFilterData,i=n.allList,r=n.filterListShow,s=n.filterListHide;if(0!==i.length){i=JSON.parse(JSON.stringify(i)),e=JSON.parse(JSON.stringify(e.filter((function(e){return e.values.length>0})))).map((function(e,t){return e.index=t,e}));var o=JSON.parse(JSON.stringify(e));i.forEach((function(t){e.forEach((function(e){t.id===e.id&&(t.index=e.index)}))}));for(var l=function(){var e=[],t=o.shift(),n=i.filter((function(e){return e.id===t.id}));"connConfig"===t.special&&t.values.length!==(n.length>0?n[0].values.length:0)&&function(){for(var n=[],s=function(e){t.values.forEach((function(t){a[e].map((function(e){return e.id})).includes(t)&&(n=n.concat(a[e]))}))},o=0;o<a.length;o++)s(o);var l=(0,x.uniqueArray)(n.map((function(e){return e.id})));i.forEach((function(n){var a={name:n.name,values:[],id:n.id,special:n.special};void 0!==n.index&&(a.index=n.index);(new Date).getTime();t.id===n.id||void 0!==n.index&&t.index>n.index||"connConfig"!==n.special||!r.map((function(e){return e.id})).includes(n.id)?a.values=n.values:function(){for(var e=l.slice(),t=function(t){e.some((function(a,i){return a===n.values[t].id&&(e.splice(i,1),!0)}))&&a.values.push(n.values[t])},i=0;i<n.values.length;i++)t(i)}(),e.push(a)})),i=JSON.parse(JSON.stringify(e))}()};o.length;)l();i.forEach((function(t){e.forEach((function(e){t.id===e.id&&"connConfig"===e.special&&(e.values=e.values.filter((function(e){return-1!==t.values.map((function(e){return e.id})).indexOf(e)})))}))})),i.forEach((function(e){r.forEach((function(t){e.id===t.id&&(t.values=e.values)})),s.forEach((function(t){e.id===t.id&&(t.values=e.values)}))})),e.forEach((function(e){return delete e.index})),this.setState({filterListShow:r,filterListHide:s,value:e},(function(e){return t&&t()}))}},n.getValue=function(){return this.state.value},n.getReFormatValue=function(){var e=this.state.value,t={},n=function(e){e.secondValue&&e.secondValue.length>0&&e.secondValue.forEach((function(n){t[e.special].some((function(e){var t;return e.id===n.fatherId&&((t=e.values).push.apply(t,n.values),e.values=Array.from(new Set(e.values)),!0)}))||t[e.special].push({id:n.fatherId,values:n.values,special:e.special})}))};return JSON.parse(JSON.stringify(e)).forEach((function(e){t[e.special]?(t[e.special].push({id:e.id,values:e.values,special:e.special}),n(e)):(t[e.special]=[{id:e.id,values:e.values,special:e.special}],n(e))})),t.source&&(t.source=t.source[0].values),t.content&&(t.content=[{contain:t.content[0].values}]),t.escore&&(t.escore=t.escore[0].values),t.messageType&&(t.messageType=t.messageType[0].values),this.refs.advancedFilter&&this.refs.advancedFilter.getValue().length>0&&(t.connections=this.refs.advancedFilter.getValue()),t},n.getFullValue=function(){var e=this.state,t=e.filterListShow,n=e.value,a=[];return t.forEach((function(e){n.forEach((function(t){if(e.id===t.id&&t.values.length>0&&"KEY_WORD"!==t.id){var n=[];e.values.forEach((function(e){t.values.forEach((function(t){e.id===t&&n.push(e)}))})),a.push({id:e.id,name:e.name,values:n})}else if("KEY_WORD"===t.id&&!a.some((function(e){return"KEY_WORD"===e.id}))){var i=[];t.values.forEach((function(e){return i.push({name:e})})),a.push({id:t.id,name:"\u5173\u952e\u8bcd",values:i})}}))})),a},n.getFilterList=function(){return JSON.parse(JSON.stringify(this.state.filterListShow.concat(this.state.filterListHide)))},n.componentWillReceiveProps=function(e){var t=this;this.state.expandTopic.id||(JSON.stringify(e.value)===JSON.stringify(this.state.value)?this.setState({value:e.value}):this.reFilterList(e.value,(function(){t.sortList(t.saveList)})))},n.componentDidMount=function(){this.props.noBottom&&this.getFilter()},n.componentWillUnmount=function(){},n.render=function(){var e=this,t=this.state,n=t.filterListShow,a=t.filterListHide,i=t.searchInfo,r=t.advancedFilterShow,s=t.expandTopic,l=t.value,c=this.props.style,u={filterModel:this.getReFormatValue()};return a.forEach((function(e,t){"KEY_WORD"===e.id&&n.push(a.splice(t,1)[0]),"expandTopic"===e.id&&a.push(a.splice(t,1)[0])})),n.forEach((function(e,t){"KEY_WORD"===e.id&&n.push(n.splice(t,1)[0]),"expandTopic"===e.id&&n.unshift(n.splice(t,1)[0])})),o.createElement("div",{className:"filter-condition-wrap",style:c||{}},i.isSearching&&o.createElement("div",{className:"filter-search-wrap"},o.createElement("div",{className:"search"},o.createElement("span",null,o.createElement("i",{className:"icon-cem_search"}),o.createElement("span",null,i.name+":")),o.createElement("input",{placeholder:"\u8bf7\u8f93\u5165\u641c\u7d22\u8bcd",autoFocus:!0,value:i.keyword,onInput:function(t){e.setState({searchInfo:{isSearching:!0,id:i.id,name:i.name,keyword:t.target.value}})}})),o.createElement("i",{className:"icon-cem_delete del",onClick:function(t){return e.setState({searchInfo:{isSearching:!1,id:"",name:"",keyword:""}})}})),o.createElement(d.Loading,{loading:this.state.loading},o.createElement("div",{className:"filter-condition"},n.map((function(t,n){switch(t.id){case"KEY_WORD":return o.createElement("div",{className:"key-word-wrap",key:n},o.createElement("span",{className:"key-word-title"},"\u5173\u952e\u8bcd"),o.createElement(v,{style:{width:"calc(100% - 108px)"},values:l.filter((function(e){return e.id===t.id}))[0]?l.filter((function(e){return e.id===t.id}))[0].values:[],onChange:function(n){return e.keyWordChange(n,t)}}));case"expandTopic":return o.createElement(S,{ref:"expandTopic",close:function(t){return e.closeExpandTopic(n)},onChange:e.expandTopicChange,value:s,key:n,list:t.values,fresh:e.updateExpandTopic,model:e.props.model});default:return e.renderCheckBox(t,n)}})),a.length>0&&o.createElement("div",{className:"more-filter bottom-line"},o.createElement("span",{className:"title"},"\u6dfb\u52a0\u7b5b\u9009"),o.createElement("div",null,a.filter((function(e){return"connConfig"!==e.special||e.values.length>0})).map((function(t,n){return o.createElement("span",{key:n,className:"filter-card",onClick:function(t){return e.addMoreFilter(n)}},t.name+" +")})))))),T.Z.hasAuthority("CONNECTION_SEARCH")&&o.createElement(b,{ref:"advancedFilter",show:r,queryParams:u,defaultValue:l.filter((function(e){return"connections"===e.special}))}),!this.props.noBottom&&o.createElement("div",{className:"bottom"},o.createElement("ul",{className:"handle"},o.createElement("li",null,o.createElement("span",{className:"filter"},this.props.count," \u4e2a\u94fe\u63a5\u7b26\u5408\u6761\u4ef6")),l.length>0&&o.createElement("li",null,o.createElement("span",{className:"clear",onClick:function(t){return e.setState({value:[]},(function(t){return e.reFilterList(e.state.value,(function(t){e.onChange()}))}))}},"\u6e05\u7a7a\u9009\u9879"))),T.Z.hasAuthority("CONNECTION_SEARCH")&&o.createElement("span",{className:"advancedFilter",onClick:function(){return e.toggleAdvancedFilter()}},o.createElement("span",null,"\u9ad8\u7ea7\u7b5b\u9009"),o.createElement("i",{className:"icon-cem_screening-for-more",style:{transform:r?"":"rotate(-180deg)",top:r?"3px":""}})),o.createElement(d.Button,{type:"primary",onClick:function(t){e.saveList(),e.closeAdvancedFilter(),s.id&&e.expandTopicChange(s,null,!0),setTimeout((function(t){return e.props.onConfirm&&e.props.onConfirm()}),0)}},"\u786e\u5b9a"),o.createElement(d.Button,{onClick:function(t){s.id&&e.expandTopicChange(s),e.props.onCancel&&e.props.onCancel()}},"\u53d6\u6d88")))},t}(o.Component),D=function(e){var t=[];return Object.keys(e).forEach((function(n){"connConfig"===n||"tag"===n?e[n]&&e[n].forEach((function(e){t.push((0,a.Z)({},e,{special:n}))})):"source"===n||"escore"===n||"messageType"===n||"content"===n?e[n]&&t.push({id:"content"!==n?n:"KEY_WORD",special:n,values:"content"!==n?e[n]:e[n][0].contain}):"connections"===n&&e[n]&&t.push({id:n,special:n,values:e[n]})})),t};L.propTypes={style:u().object,value:u().array,filter:u().array,filterConfig:u().array,onFilterChange:u().func,onExpandTopicChange:u().func,onConfirm:u().func,onCancel:u().func,count:u().oneOfType([u().number,u().string]),type:u().string,noBottom:u().bool};var _=n(30381),F=n.n(_),A=n(58341),j=["\u5feb\u6377\u65f6\u95f4\u7b5b\u9009\u5668","\u56fa\u5b9a\u65f6\u95f4\u7b5b\u9009\u5668"],R=["\u4eca\u5929","\u6628\u5929","\u524d\u5929","\u8fd1365\u5929","\u672c\u5468","\u4e0a\u5468","\u8fd17\u5929","","\u672c\u6708","\u4e0a\u4e2a\u6708","\u8fd130\u5929","","\u672c\u5b63","\u4e0a\u4e2a\u5b63\u5ea6","\u8fd190\u5929","","\u4eca\u5e74","\u53bb\u5e74","\u8fd1180\u5929"],M="YYYY-MM-DD",P=["overview","product","service","marketing"],V="",Z=function(e){var t=[];switch(e){case 0:t=[F()().format(M),F()().format(M)];break;case 1:t=[F()().subtract(1,"days").format(M),F()().subtract(1,"days").format(M)];break;case 2:t=[F()().subtract(2,"days").format(M),F()().subtract(2,"days").format(M)];break;case 3:t=[F()().subtract(364,"days").format(M),F()().format(M)];break;case 4:t=[F()().startOf("week").format(M),F()().format(M)];break;case 5:t=[F()().subtract(1,"weeks").startOf("week").format(M),F()().subtract(1,"weeks").endOf("week").format(M)];break;case 6:t=[F()().subtract(6,"days").format(M),F()().format(M)];break;case 8:t=[F()().startOf("month").format(M),F()().format(M)];break;case 9:t=[F()().subtract(1,"months").startOf("month").format(M),F()().subtract(1,"months").endOf("month").format(M)];break;case 10:t=[F()().subtract(29,"days").format(M),F()().format(M)];break;case 12:t=[F()().startOf("quarter").format(M),F()().format(M)];break;case 13:t=[F()().subtract(1,"quarters").startOf("quarter").format(M),F()().subtract(1,"quarters").endOf("quarter").format(M)];break;case 14:t=[F()().subtract(89,"days").format(M),F()().startOf("day").format(M)];break;case 16:t=[F()().startOf("year").format(M),F()().format(M)];break;case 17:t=[F()().subtract(1,"years").startOf("year").format(M),F()().subtract(1,"years").endOf("year").format(M)];break;case 18:t=[F()().subtract(179,"days").format(M),F()().format(M)]}return t},W=function(e){function t(t){var n;return(n=e.call(this,t)||this).getDateRange=function(e){n.setState({selectedDateRange:e})},n.handleClickQuickTime=function(e){var t=n.state,a=t.currSelector,i=t.staredQuickTimeChoice,r=Z(e);n.setState({selectedQuickTimeChoice:e,selectedDateRange:r});var s={module:"ecommerceMonitor",currSelector:a,selectedQuickTimeChoice:e,staredQuickTimeChoice:i,value:[]};n.setDefaultValue(JSON.stringify(s))},n.state={show:!1,currSelector:0,selectedDateRange:[],selectedQuickTimeChoice:10,staredQuickTimeChoice:-1,params:t.params},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;document.querySelectorAll(".right ul li").forEach((function(t,n){7!==n&&11!==t&&15!==t&&(t.addEventListener("mouseover",(function(){return e.displayStar(t)})),t.addEventListener("mouseout",(function(){return e.hideStar(t)})))}))},n.UNSAFE_componentWillReceiveProps=function(e){var t=e.show,n=e.params;this.setState({show:t,params:n})},n.componentWillUnmount=function(){var e=this;document.querySelectorAll(".right ul li").forEach((function(t,n){7!==n&&11!==t&&15!==t&&(t.removeEventListener("mouseover",(function(){return e.displayStar(t)})),t.removeEventListener("mouseout",(function(){return e.hideStar(t)})))}))},n.displayStar=function(e){(0,x.hasClass)(e.children[0],"active")&&(e.children[1].getElementsByTagName("span")[0].style.display="inline-block")},n.hideStar=function(e){var t=e.children[1].getElementsByTagName("span")[0];(0,x.hasClass)(t,"star")||(t.style.display="none")},n.switchSlector=function(e){this.setState({currSelector:e})},n.getCurrDate=function(){var e=this.state,t=e.currSelector,n=e.selectedDateRange,a=e.selectedQuickTimeChoice,i=e.params,r=this.formatDate(2),s=n[0],o=n[1],l=F()(o,M).diff(F()(s,M),"days")+1;return{from:n[0],to:n[1],quickChoice:0===t?i&&i.quickChoice.indexOf("-")>-1?i.quickChoice:R[a]:r,dateGroupType:"DAY",numOfDays:l,remoteName:"cTime"}},n.clickStarIcon=function(e,t){e.stopPropagation();var n=this.state.staredQuickTimeChoice,a=this.state.selectedQuickTimeChoice;if(n!==t){if(-1!==n){var i=document.querySelectorAll(".right ul li")[n].children[1];(0,x.removeClass)(i,"star"),i.style.display="none"}n=t,(0,x.addClass)(e.target.parentNode,"star")}else n=-1,(0,x.removeClass)(e.target.parentNode,"star");this.setState({staredQuickTimeChoice:n});var r={module:"ecommerceMonitor",currSelector:0,selectedQuickTimeChoice:a,staredQuickTimeChoice:n,value:[]};this.setDefaultValue(JSON.stringify(r))},n.fetchDefaultValue=function(){var e=this,t=window.location.pathname.split("/")[1],n=P.indexOf(t)>-1?"insight":t;V="default-time-"+n;var a=[F()().subtract(29,"days").format(M),F()().format(M)];return f.h.post("/default/value/find",{key:V,projectId:E.t.get(E.V.curProject).id}).then((function(t){var n=JSON.parse(t.data.result),i=e.state.params;if(!n){var r=i?[i.from,i.to]:a;return e.setState({selectedDateRange:r}),{from:r[0],to:r[1],quickChoice:i?i.quickChoice:R[10],dateGroupType:"DAY",remoteName:"cTime"}}var s=n.currSelector,o=n.selectedQuickTimeChoice,l=n.staredQuickTimeChoice,c=(n.value,i&&-1===i.quickChoice.indexOf("-")?R.indexOf(i.quickChoice):l>-1?l:o),u=i?-1===i.quickChoice.indexOf("-")?Z(c):[i.from,i.to]:Z(l>-1?l:o);if(0===s)return e.setState({selectedQuickTimeChoice:c,staredQuickTimeChoice:l,selectedDateRange:u}),{from:u[0],to:u[1],quickChoice:i&&i.quickChoice.indexOf("-")>-1?i.quickChoice:R[c],dateGroupType:"DAY",remoteName:"cTime"}}))},n.setDefaultValue=function(e){f.h.post("/default/value/update",{key:V,projectId:E.t.get(E.V.curProject).id,value:e}).then((function(e){}))},n.clickConfirmBtn=function(){var e=this;this.state.selectedDateRange.length>0?this.setState({params:null,show:!1},(function(){return e.props.onChange(e.getCurrDate())})):p.Z.error("\u8bf7\u9009\u62e9\u65f6\u95f4\u8303\u56f4")},n.clickCancelBtn=function(){this.props.onCancel()},n.formatDate=function(e){for(var t=this.state.selectedDateRange,n="",a=0;a<t.length;a++){for(var i=t[a].split("-"),r=0;r<i.length;r++){if(0===r&&(n+=i[r]+(1===e?"\u5e74":".")),1===r){parseInt(i[r],10);n+=i[r]+(1===e?"\u6708":".")}if(2===r){parseInt(i[r],10);n+=i[r]+(1===e?"\u65e5":"")}}0===a&&(n+=" - ")}return n},n.render=function(){var e=this,t=this.state,n=t.show,a=t.currSelector,i=t.selectedDateRange,r=t.selectedQuickTimeChoice,s=t.staredQuickTimeChoice,l=this.formatDate(1);return o.createElement("div",{className:"time-picker-wrapper",style:{display:n?"block":"none"}},o.createElement("div",{className:"time-picker-body"},o.createElement("div",{className:"left"},o.createElement("ul",null,j.map((function(t,n){return o.createElement("li",{key:n,className:a===n?"active":"",onClick:function(){return e.switchSlector(n)}},t)})))),o.createElement("div",{className:"right"},o.createElement("ul",{style:{display:0===a?"block":"none"}},R.map((function(t,n){return o.createElement("li",{key:n,onClick:function(){return e.handleClickQuickTime(n)},style:{pointerEvents:[7,11,15].includes(n)?"none":"auto"}},o.createElement("span",{className:r===n?"active":""},t),o.createElement(d.Popover,{className:"time-picker-star-tooltip",trigger:"hover",placement:"top",width:"50",content:s===n?"\u53d6\u6d88\u9ed8\u8ba4":"\u8bbe\u4e3a\u9ed8\u8ba4"},o.createElement("span",{className:s===n?"star":"",onClick:function(t){return e.clickStarIcon(t,n)}},o.createElement("i",{className:"icon-cem icon-cem_star"}))))}))),o.createElement(A.Z,{getDateRange:this.getDateRange,style:{display:1===a?"block":"none"}}))),o.createElement("div",{className:"time-picker-footer"},o.createElement("span",null,"\u5f53\u524d\u9009\u62e9\u65f6\u95f4\uff1a"),i.length>0?o.createElement("span",null,l):null,o.createElement("div",null,o.createElement(d.Button,{type:"primary",onClick:function(){return e.clickConfirmBtn()}},"\u786e\u5b9a"),o.createElement(d.Button,{type:"default",onClick:function(){return e.clickCancelBtn()}},"\u53d6\u6d88"))))},t}(o.PureComponent);W.propTypes={show:u().bool,onChange:u().func};var H=n(85151);function B(e){return f.h.post("/filter/find/save",{id:e})}function J(e,t,n){return f.h.post("/default/value/update",{key:e,projectId:t,value:n})}function Y(e,t,n,a,i,r){return f.h.post("/filter/add",{name:e,copy:t,type:a,id:n,projectId:i,filter:r})}function q(e){return f.h.post("user/opinion/add",(0,a.Z)({},e))}var z="empty";const U=function(e){function t(t){var n;return(n=e.call(this,t)||this).getSelectedFilterObj=function(){return n.state.selFilterObj},n._handleListSelect=function(e,t){e.stopPropagation(),n.props.onFilterChange(t),n.setState({selFilterObj:t})},n._handleListStar=function(e,t,a){e.stopPropagation(),n.lastStaredSaveId=t;var i=n.state,r=i.staredFilterId,s=i.savedKey,o=i.projectId,l=i.staredFilterIndex;if(r!==t){if(-1!==l){var c=document.querySelectorAll(".saved-condition-list .left .star")[l].children[1];(0,x.removeClass)(c,"star-active")}(0,x.addClass)(e.target.parentNode,"star-active")}else(0,x.removeClass)(e.target.parentNode,"star-active");n.setState({staredFilterIndex:a,staredFilterId:r===t?z:t},(function(){J(s,o,n.state.staredFilterId).then((function(e){2e4!==e.data.code&&n.setState({staredFilterId:n.lastStaredSaveId})}))}))},n._handleOnEditClick=function(e,t){e.stopPropagation(),n.refs.saveNameInput.refs.input.value=t.name,n.setState({targetFilterObj:t,editDialogVisible:!0})},n._handleConfitionSaveConfirm=function(){var e=n.state,t=e.selFilterObj,a=e.projectId,i=e.targetFilterObj,r=n.props,s=r.model,o=r.onFilterRename;B(i.id).then((function(e){var r=e.data;if(2e4===r.code){var l=n.refs.saveNameInput.refs.input.value;o(t.name),Y(l,!1,i.id,s,a,r.result.filter).then((function(e){2e4===e.data.code&&(p.Z.success("\u4fee\u6539\u6210\u529f"),n.setState({editDialogVisible:!1}),n.refresh(t.id))}))}}))},n._handleOnDeleteClick=function(e,t){e.stopPropagation(),n.setState({targetFilterObj:t,delDialogVisible:!0})},n._handleOnDeleteConfirm=function(e){e.stopPropagation();var t,a=n.state,i=a.targetFilterObj,r=a.savedKey,s=a.projectId,o=a.staredFilterId,l=a.filterList,c=a.selFilterObj,u=[(t=i.id,f.h.post("/filter/delete",{id:t,menuModel:{}}))];o===i.id&&u.push(J(r,s,z)),Promise.all(u).then((function(e){2e4===e[0].data.code&&n.refresh(i.id===c.id?void 0:c.id)})),n.props.onFilterChange(i.id===c.id?l[0]:c)},n.renderDeleteDialog=function(){var e=n.state,t=e.selFilterObj,a=e.targetFilterObj;return o.createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},o.createElement(d.Dialog,{title:"\u5220\u9664",className:"delete-saved-confition-dialog",size:"tiny",modal:!1,visible:n.state.delDialogVisible,onMouseLeave:function(e){return e.stopPropagation()},onCancel:function(e){return n.setState({delDialogVisible:!1})}},o.createElement(d.Dialog.Body,null,o.createElement("span",null,a&&t&&t.id===a.id?"\u5220\u9664\u8be5\u7b5b\u9009\u5668\u540e\uff0c\u5f53\u524d\u9875\u9762\u7684\u7b5b\u9009\u5668\u5c06\u81ea\u52a8\u5207\u6362\u4e3a\u201d\u5168\u90e8\u6570\u636e\uff08\u9ed8\u8ba4\uff09\u201d\u7b5b\u9009\u5668\uff0c\u662f\u5426\u5220\u9664\uff1f":'\u662f\u5426\u5220\u9664"'+a.name+'"\u7b5b\u9009\u5668\uff1f')),o.createElement(d.Dialog.Footer,null,o.createElement(d.Button,{type:"primary",onClick:n._handleOnDeleteConfirm},"\u786e\u5b9a"),o.createElement(d.Button,{type:"default",onClick:function(e){return n.setState({delDialogVisible:!1})}},"\u53d6\u6d88"))))},n.renderEditDialog=function(){return o.createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},o.createElement(d.Dialog,{title:"\u4fee\u6539\u540d\u79f0",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:n.state.editDialogVisible,onCancel:function(e){return n.setState({editDialogVisible:!1})}},o.createElement(d.Dialog.Body,null,o.createElement(d.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",ref:"saveNameInput"})),o.createElement(d.Dialog.Footer,null,o.createElement(d.Button,{type:"primary",onClick:n._handleConfitionSaveConfirm},"\u786e\u5b9a"),o.createElement(d.Button,{type:"default",onClick:function(e){return n.setState({editDialogVisible:!1})}},"\u53d6\u6d88"))))},n.state={projectId:E.t.get(E.V.curProject).id,savedKey:t.model+"_SAVED_OBJ",filterList:void 0,selFilterObj:void 0,targetFilterObj:{},staredFilterId:z,staredFilterIndex:-1,isEditing:!1,delDialogVisible:!1,editDialogVisible:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.componentDidUpdate=function(e,t){this.state.filterList;this.props.show===e.show||this.props.show||this.setState({isEditing:!1,fullListShow:!1})},n.componentWillUnmount=function(){},n.refresh=function(e){var t=this,n=this.state,a=n.savedKey,i=n.projectId,r=(n.staredFilterId,this.props),s=r.model,o=(r.onFilterChange,r.shouldShowDefault),l=void 0,c=function(e,t){return f.h.post("/filter/list",{type:e,projectId:t})}(s,i),u=function(e,t){return f.h.post("/default/value/find",{key:e,projectId:t})}(a,i);return Promise.all([c,u]).then((function(n){var a,i,r,s,c=n[0].data;2e4===c.code&&(a=c.result.all).unshift({id:"default",name:"\u5168\u90e8\u6570\u636e\uff08\u9ed8\u8ba4\uff09"});var u=n[1].data;return 2e4===u.code&&(i=u.result||z,r=o?-1:a.findIndex((function(e){return e.id===i})),e&&(s=a.findIndex((function(t){return t.id===e}))),l=s?a[s]:-1===r?a[0]:a[r]),t.setState({delDialogVisible:!1,selFilterObj:l,staredFilterIndex:r,filterList:a,staredFilterId:i,fullListShow:a.length>15&&t.state.fullListShow}),l}))},n.render=function(){var e=this.state,t=e.filterList,n=(e.selFilterObj,e.staredFilterId,e.isEditing,this.props);n.onFilterChange,n.show,t&&JSON.parse(JSON.stringify(t));return null},t}(o.Component);var K=n(36025),G=function(e){function t(t){var n;(n=e.call(this,t)||this).changeFilter=function(e){n.setState({selFilterId:e===n.state.selFilterId?null:e})},n.onConditionChange=function(e){var t=[];Object.keys(e).forEach((function(n){"tag"===n||"connConfig"===n?t=t.concat(e[n]):"source"!==n&&"escore"!==n&&"messageType"!==n&&"content"!==n||t.push({id:"content"!==n?n:"KEY_WORD",special:n,values:"content"!==n?e[n]:e[n][0].contain})}));var a=n.state.defFilterValue,i=!k(t.filter((function(e){return"connections"!==e.special})),a.filter((function(e){return"connections"!==e.special})));n.setState({isDefFilterChanged:i,filterConditionValue:n.refs.FilterCondition.getValue()},(function(e){n.getListCount()}))},n.onTimeChange=function(e){n.setState({time:n.refs.timePicker.getCurrDate()},(function(e){n.getListCount(),n.handleChange()}))},n.handleChange=function(){n.state.filterConditionValue;n.props.onChange&&n.props.onChange(n.getValue()),n.setState({selFilterId:null,detail:n.refs.FilterCondition.getFullValue()},(function(e){return n.competeInfoWidth()}))},n.competeInfoWidth=function(){if(n.refs.info){n.refs.info.style.whiteSpace="nowrap";var e=[];Array.from(n.refs.info.getElementsByClassName("detail-info")).forEach((function(t){t.style.width="unset",e.push(t.clientWidth),t.style.width="calc(100% - 88px)"}));var t=Math.max.apply(null,e),a=122;a+=t>700?700:t,n.refs.info.style.whiteSpace="normal",n.refs.info.style.width=a+"px"}},n.init=function(){var e=function(){var e=[n.refs.FilterCondition.getFilter()];n.state.showList.includes("time")&&e.push(n.refs.timePicker.fetchDefaultValue()),Promise.all(e).then((function(e){var t=n.state.filterConditionValue,a=n.refs.FilterCondition.state.allList.map((function(e){return e.values})).flat(1).map((function(e){return String(e.id)}));if(t.filter((function(e){return!["KEY_WORD"].includes(e.id)})).map((function(e){return e.values})).flat(1).some((function(e){return!a.includes(String(e))}))&&n.setState({showWarning:!0,filterConditionValue:[],detail:[]}),n.refs.timePicker){var i=e.filter((function(e){return e.dateGroupType}))[0];n.setState({time:i},(function(){n.getListCount()}))}else n.getListCount();e[2]&&n._handleOnFilterChange(e[2]),setTimeout((function(){return n.props.onFilterReady&&n.props.onFilterReady()}),0)}))};n.state.projectId?e():n.id=setInterval((function(){E.t.get(E.V.curProject).id&&(clearInterval(n.id),n.setState({projectId:E.t.get(E.V.curProject).id},(function(){e()})))}),50)},n._handleConfitionSave=function(e){n.setState({dialogType:e,saveNameDialogVisible:!0})},n._handleConfitionSaveAs=function(e){e.stopPropagation(),n.setState({dialogType:"saveAs",saveNameDialogVisible:!0})},n.handleSaveOpinion=function(){var e=n.state,t=e.dialogType,i=e.nameInputVal,r=n.props.currOpinonObj.id,s=i;n.setState({inputName:s});var o,l=E.t.get(E.V.curProject).id;if("save"===t)q({opinionTaskId:r,name:s,projectId:l}).then((function(e){if(2e4===e.data.code){var t=e.data.result;if(1===t.length){var a=t[0].id;p.Z.success("\u4fdd\u5b58\u6210\u529f"),n.props.refreshMenuList().then((function(e){window.location.href="/opinion/"+a})),n.setState({saveNameDialogVisible:!1,savedId:a}),n.props.updateCurrOpinonObj(),n.setState({nameInputVal:""})}else{for(var i="",r=n.state.savedOpinionName,o=0;o<t.length;o++)t[o].name===r&&(i=t[o].id);n.setState({savedId:i,opinionTaskList:t,deleteOpinionModalShow:!0,tempInputName:s,showWarning:!1})}}}));else if("rename"===t){var c=n.state.savedId,u="";u=3===location.pathname.split("/").length?location.pathname.split("/")[2]:c,(o={id:u,name:s},f.h.post("user/opinion/update",(0,a.Z)({},o))).then((function(e){2e4===e.data.code&&(p.Z.success("\u64cd\u4f5c\u6210\u529f"),n.props.refreshMenuList(),n.setState({savedOpinionName:s,saveNameDialogVisible:!1})),n.setState({nameInputVal:""})}))}},n.handleUpdate=function(){var e=n.props,t=e.currOpinonObj,i=e.currOpinonObj.id,r=n.state.savedOpinionName,s="";location.pathname.startsWith("/opinion/")&&(s=location.pathname.split("/")[2]);var o;(o={opinionTaskId:i,id:s},f.h.post("user/opinion/filter/update",(0,a.Z)({},o))).then((function(e){if(2e4===e.data.code){p.Z.success("\u66f4\u65b0\u6210\u529f");var a=JSON.parse(JSON.stringify(t));a.changed=!1,a.mode="rename",a.name=r,n.props.updateCurrOpinonObj(a),n.setState({showWarning:!1})}}))},n.handleClickOpinion=function(e){var t=n.state.selectedOpinionIds,a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),n.setState({selectedOpinionIds:t})},n.handleDeleteOpinion=function(){var e,t=n.state,i=t.selectedOpinionIds,r=t.inputName,s=n.props.currOpinonObj.id;(e={ids:i},f.h.post("user/opinion/delete",(0,a.Z)({},e))).then((function(e){if(2e4===e.data.code){n.setState({deleteOpinionModalShow:!1,selectedOpinionIds:[]});var t=E.t.get(E.V.curProject).id;q({opinionTaskId:s,name:r,projectId:t}).then((function(e){if(2e4===e.data.code){var t=e.data.result;if(1===t.length){var a=t[0].id;p.Z.success("\u64cd\u4f5c\u6210\u529f"),n.setState({saveNameDialogVisible:!1,savedOpinionName:"",savedId:a}),n.props.refreshMenuList().then((function(e){window.location.href="/opinion/"+a})),n.props.updateCurrOpinonObj(),n.setState({nameInputVal:""})}}}))}}))},n._handleOnFilterChange=function(e){if(n.setState({isDefFilterChanged:!1}),n.state.hasOutsideFilterValues){var t=Q(n.props.values.filterModel);n.setState({filterObj:e,defFilterValue:t,filterConditionValue:JSON.parse(JSON.stringify(t))},(function(){n.handleChange()}))}else"default"!==e.id?B(e.id).then((function(t){var a=t.data,i=Q(a.result.filter);2e4===a.code&&n.setState({filterObj:e,defFilterValue:i,filterConditionValue:JSON.parse(JSON.stringify(i)),detail:JSON.parse(JSON.stringify(i))},(function(){return n.handleChange()}))})):n.setState({filterObj:e,defFilterValue:[],detail:[],filterConditionValue:[]},(function(e){return n.handleChange()}))},n.handleRename=function(e){var t=n.state.filterObj;t.name=e,n.setState({filterObj:t})},n.onExpandTopicChange=function(e){n.setState({expandTopicData:e}),""===e.id&&n.setState({filterConditionValue:[],isDefFilterChanged:!1})},n._handleSaveExpandTopic=function(e){if(n.state.expandTopicData.id){var t=n.state.expandTopicData.name,a=n.state.expandTopicData.id,i=n.props.model,r=n.getValue();C(t,!1,a,i,n.state.projectId,r.filterModel).then((function(e){var t=e.data;2e4===t.code&&(p.Z.success("\u7ec4\u5408\u5206\u6790\u4fdd\u5b58\u6210\u529f"),n.refs.FilterCondition.updateExpandTopic(a,{name:t.result.name,id:t.result.id}),n.setState({dialogType:"save",expandTopicDialogVisible:!1}))}))}else n.setState({dialogType:"save",expandTopicDialogVisible:!0})},n._handleSaveAsExpandTopic=function(e){n.setState({dialogType:"saveAs",expandTopicDialogVisible:!0})},n._handleExpandTopicSaveConfirm=function(){var e=n.refs.saveExpandTopic.refs.input.value,t="saveAs"===n.state.dialogType,a=t?n.state.expandTopicData.id?n.state.expandTopicData.id:n.state.filterObj.id:null,i=n.props.model,r=n.getValue();C(e,t,a,i,n.state.projectId,r.filterModel).then((function(e){var t=e.data;2e4===t.code&&(p.Z.success("\u7ec4\u5408\u5206\u6790\u4fdd\u5b58\u6210\u529f"),n.refs.saveExpandTopic.refs.input.value="",n.refs.FilterCondition.updateExpandTopic(null,{name:t.result.name,id:t.result.id}),n.setState({dialogType:"save",expandTopicDialogVisible:!1}))}))},n._handlingOnComposition=function(){n.isCompositionHandling=!0},n._handleOnComposition=function(e){n.isCompositionHandling=!1,n.setState({nameInputVal:e.target.value.substring(0,14)})},n.renderDialog=function(){var e=n.state,t=e.savedOpinionName,a=e.nameInputVal,i=e.check;return o.createElement(d.Dialog,{title:"save"===n.state.dialogType?"\u4fdd\u5b58\u5178\u578b\u610f\u89c1":"\u91cd\u547d\u540d",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:n.state.saveNameDialogVisible,onCancel:function(e){return n.setState({saveNameDialogVisible:!1})}},o.createElement(d.Dialog.Body,null,o.createElement("div",{className:"form-item"},o.createElement("label",null,"\u540d\u79f0"),o.createElement(d.Input,{className:i&&a.length>=14?"error":"",placeholder:"\u8bf7\u8f93\u5165\u5178\u578b\u610f\u89c1\u540d\u79f0",defaultValue:t,maxLength:14,autoFocus:!0,onFocus:function(){return n.setState({check:!0})},onBlur:function(){return n.setState({check:!1})},onChange:function(e){!n.isCompositionHandling&&n.setState({nameInputVal:e.substring(0,14)})},onCompositionStart:n._handlingOnComposition,onCompositionUpdate:n._handlingOnComposition,onCompositionEnd:n._handleOnComposition}),i&&a.length>=14&&o.createElement("div",{className:"tip"},"\u63d0\u793a\uff1a\u6700\u591a\u53ea\u80fd\u8f93\u516514\u4e2a\u5b57\u7b26"))),o.createElement(d.Dialog.Footer,null,o.createElement("span",{className:"tips"},"*\u53ef\u4ee5\u4fdd\u5b585\u4e2a\u5178\u578b\u610f\u89c1\u8ba1\u7b97\u7ed3\u679c"),o.createElement(d.Button,{type:"primary",onClick:n.handleSaveOpinion},"\u786e\u5b9a"),o.createElement(d.Button,{type:"default",onClick:function(e){return n.setState({saveNameDialogVisible:!1})}},"\u53d6\u6d88")))},n.renderDeleteOpinionDialog=function(){var e="";if(location.pathname.startsWith("/opinion/")){var t=location.pathname.split("/")[2];e=t}var a=n.state,i=a.opinionTaskList,r=a.deleteOpinionModalShow,s=a.selectedOpinionIds,l=[{label:"\u8bf7\u9009\u62e9\u5220\u9664\u7684\u5bf9\u8c61",prop:"",align:"center",render:function(t){return o.createElement(H.Jg,{value:t.id,disabled:!!e&&e===t.id,checked:s.includes(t.id),onChange:function(){return n.handleClickOpinion(t.id)}})}},{label:"\u540d\u79f0",prop:"name"},{label:"\u4fdd\u5b58\u65f6\u95f4",prop:"createdAt"}];return o.createElement(d.Dialog,{title:"\u63d0\u9192",className:"opinion-delete-dialog",size:"tiny",modal:!1,visible:r,onCancel:function(e){return n.setState({deleteOpinionModalShow:!1})}},o.createElement(d.Dialog.Body,null,o.createElement("div",{className:"delete-tips"},"\u6700\u591a\u4fdd\u5b585\u4e2a\u5178\u578b\u610f\u89c1\uff0c\u5982\u679c\u60f3\u8981\u4fdd\u5b58\u5f53\u524d\u5178\u578b\u610f\u89c1\uff0c\u8bf7\u4ece\u4ee5\u4e0b\u5217\u8868\u4e2d\u5148\u5220\u9664\u90e8\u5206\u5178\u578b\u610f\u89c1"),o.createElement(m.Z,{columns:l,data:i})),o.createElement(d.Dialog.Footer,null,o.createElement(d.Button,{type:"primary",onClick:n.handleDeleteOpinion},"\u786e\u5b9a"),o.createElement(d.Button,{type:"default",onClick:function(e){return n.setState({deleteOpinionModalShow:!1})}},"\u53d6\u6d88")))},n.renderExpandTopicDialog=function(){return o.createElement(d.Dialog,{title:"save"===n.state.dialogType?"\u4fdd\u5b58\u4e3a\u7ec4\u5408\u5206\u6790":"\u7ec4\u5408\u5206\u6790\u53e6\u5b58\u4e3a",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:n.state.expandTopicDialogVisible,onCancel:function(e){return n.setState({expandTopicDialogVisible:!1})}},o.createElement(d.Dialog.Body,null,o.createElement(d.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",ref:"saveExpandTopic"})),o.createElement(d.Dialog.Footer,null,o.createElement(d.Button,{type:"primary",onClick:n._handleExpandTopicSaveConfirm},"\u786e\u5b9a"),o.createElement(d.Button,{type:"default",onClick:function(e){return n.setState({expandTopicDialogVisible:!1})}},"\u53d6\u6d88")))};var i=t.values,r=i&&i.filterModel,s=r?Q(i.filterModel):[];return n.state={hasOutsideFilterValues:r,showList:n.props.showList,selFilterId:n.props.defaultShow?n.props.defaultShow:null,filterConditionValue:s,expandTopicData:{},time:{},detail:r?(0,K.Nm)(i.filterModel):[],projectId:E.t.get(E.V.curProject).id,count:"",saveFilterVisible:!1,saveNameDialogVisible:!1,filterObj:void 0,defFilterValue:[],isDefFilterChanged:!1,dialogType:"save",deleteOpinionModalShow:!1,opinionTaskList:[],selectedOpinionIds:[],savedId:"",savedOpinionName:t.currOpinonObj.name,inputName:"",showWarning:!1,nameInputVal:""},n}(0,i.Z)(t,e);var n=t.prototype;return n.getListCount=function(){var e=this,t=this.getValue();if(t.dateFilter)t.dateFilter.dateGroupType=null;else{t.dateFilter={};var n=window.location.pathname;/^\/price/.test(n)&&(t.queryType="PRICE")}t.projectId=E.t.get(E.V.curProject).id,f.h.post("/filter/connection/find",t).then((function(t){e.setState({count:t.data.result.total})}))},n.getValue=function(){var e=this.props.showList,t={};return e.includes("condition")&&Object.assign(t,{filterModel:this.refs.FilterCondition?this.refs.FilterCondition.getReFormatValue():{}}),e.includes("time")&&(t.dateFilter=JSON.parse(JSON.stringify(this.state.time))),t},n.componentDidMount=function(){this.init()},n.UNSAFE_componentWillReceiveProps=function(e){var t=this,n=e.values,a=this.props.values;if(n&&n.filterModel&&!k(n,a)){var i=Q(n.filterModel)||[];this.setState({filterConditionValue:i}),setTimeout((function(){t.refs.FilterCondition&&t.setState({detail:t.refs.FilterCondition.getFullValue()},(function(){return t.competeInfoWidth()}))}),2500),this.refs.timePicker&&this.refs.timePicker.fetchDefaultValue().then((function(e){setTimeout((function(){t.setState({time:e},(function(){t.getListCount()}))}),1e3)}))}if(!k(this.props.currOpinonObj,e.currOpinonObj)){e.currOpinonObj.name;if(this.hasUpdateName||!e.currOpinonObj.name)return;this.setState({savedOpinionName:e.currOpinonObj.name}),this.hasUpdateName=!0}},n._saveConfition=function(e,t,n){var i=this,r=this.state.filterObj,s=this.getValue(),o=this.props.model,l=this.state.projectId;Y(e,t,n,o,l,(0,a.Z)({},s.filterModel)).then((function(t){var n=t.data;2e4===n.code&&(p.Z.success("\u7b5b\u9009\u6761\u4ef6\u4fdd\u5b58\u6210\u529f"),r.name=e,r.id=n.result.id,i.setState({dialogType:"save",saveNameDialogVisible:!1,filterObj:r},(function(){return i.refs.SavedConfition.refresh(n.result.id)})))})).catch((function(e){return console.log(e)}))},n.render=function(){var e=this,t=this.state,n=t.selFilterId,a=t.showList,i=t.filterConditionValue,r=t.expandTopicData,s=t.detail,l=t.count,c=(t.isDefFilterChanged,t.filterObj),u=t.saveFilterVisible,d=t.hasOutsideFilterValues,p=t.projectId,m=t.savedOpinionName,f=(t.dialogType,t.showWarning),h=this.list,g=this.props,v=g.filterCondition,y=g.title,E=g.model,C=g.values,S=g.currOpinonObj,N=(r.id?r.name:c&&c.name,C&&C.dateFilter?C.dateFilter:void 0);!!this.refs.FilterCondition&&this.refs.FilterCondition.isExpandTopicChanged();return p?o.createElement("div",{className:"filter-new"},o.createElement("div",{className:"wrap"},a.includes("opinion")&&o.createElement("div",{ref:"save-filter",className:"save-filter"},o.createElement("span",null,r.id?"\u7ec4\u5408\u5206\u6790\uff1a":this.hasOpinionId?"\u5178\u578b\u610f\u89c1\uff1a":"\u5178\u578b\u610f\u89c1"),o.createElement("div",{className:"save-filter-wrap"},o.createElement("span",{style:{cursor:"default"}},m),o.createElement(U,{shouldShowDefault:d,ref:"SavedConfition",show:u,model:E,onFilterChange:this._handleOnFilterChange,onFilterRename:this.handleRename}))),o.createElement("div",{className:"button-zone"},a.includes("opinion")&&!r.id&&o.createElement("div",null,S.changed&&o.createElement("span",{className:"modified"},"\u5df2\u4fee\u6539"),!this.hasOpinionId&&o.createElement("a",null,o.createElement("span",{className:"save",onClick:function(t){return e._handleConfitionSave("save")}},"\u4fdd\u5b58\u5178\u578b\u610f\u89c1")),this.hasOpinionId&&o.createElement("span",{className:"save",onClick:function(t){return e._handleConfitionSave("rename")},style:{marginLeft:"10px"}},"\u91cd\u547d\u540d"),this.hasOpinionId&&"update"===S.mode&&o.createElement("span",{className:"save",onClick:function(t){return e.handleUpdate()},style:{marginLeft:"10px"}},"\u66f4\u65b0"))),!r.id&&o.createElement("div",{className:"info"},o.createElement("span",{className:"detail"},"\u8be6\u60c5"),o.createElement("div",{className:"info-wrap"},o.createElement("div",null,"\u5f53\u524d\u9875\u9762\u7b5b\u9009\u6761\u4ef6"),s&&s.length>0?o.createElement("ul",{ref:"info"},s.map((function(e,t){return o.createElement("li",{key:t},o.createElement("div",{className:"name"},e.name),o.createElement("div",{className:"detail-info"},e.values&&e.values.slice(0,100).map((function(t,n){return o.createElement("span",{key:n},t.name+(n===e.values.length-1?"":"\uff0c"))}))))}))):o.createElement("div",{className:"noData"},"\u6682\u65e0\u7b5b\u9009\u5185\u5bb9"))),r.id&&o.createElement("div",{className:"info"},o.createElement("span",{className:"detail",onClick:function(){return e.refs.FilterCondition.expandTopicChange(e.state.expandTopicData)}},"\u5173\u95ed\u7f16\u8f91")),o.createElement("ul",{className:"all-filter-name-wrap"},h.filter((function(e){return a.includes(e.id)})).map((function(t){return o.createElement("li",{key:t.id,className:n===t.id?"sel":"",onClick:function(n){return e.changeFilter(t.id)}},o.createElement("i",{className:t.icon}),o.createElement("span",null,t.name),o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:n===t.id?"rotate(180deg) translateY(-1px)":""}}))})))),f&&"condition"===n&&o.createElement("div",{className:"msg_filter_tip"},o.createElement("i",{className:"icon-cem_warning"}),"\u7b5b\u9009\u5668\u4f7f\u7528\u7684\u67d0\u4e9b\u7b5b\u9009\u6761\u4ef6\u88ab\u5220\u9664\uff0c\u5df2\u4e0d\u53ef\u7528\uff0c\u9700\u8981\u4f60\u66f4\u65b0\u7b5b\u9009\u6761\u4ef6"),o.createElement(L,{style:{display:"condition"===n?"block":"none"},ref:"FilterCondition",value:i,type:E||"PRICE_WARNING",filter:v&&v.filter?v.filter:["CONN_CONFIG"],filterConfig:v&&v.filterConfig?v.filterConfig:[],onFilterChange:this.onConditionChange,onExpandTopicChange:this.onExpandTopicChange,onConfirm:this.handleChange,onCancel:function(t){return e.setState({selFilterId:null})},count:l}),a.includes("time")&&o.createElement("div",{className:"date"},o.createElement(W,{ref:"timePicker",show:"time"===n,onChange:this.onTimeChange,onCancel:function(t){return e.setState({selFilterId:null})},params:N})),this.renderDialog(),this.renderExpandTopicDialog(),this.renderDeleteOpinionDialog()):o.createElement("div",null)},(0,l.Z)(t,[{key:"list",get:function(){var e="\u65f6\u95f4";return this.state&&this.state.time.from&&(e=this.state.time.quickChoice?this.state.time.quickChoice:this.state.time.from.replace(/-/g,"/")+"-"+this.state.time.to.replace(/-/g,"/")),[{name:"\u7b5b\u9009",id:"condition",icon:"icon-cem_screen"},{name:e,id:"time",icon:"icon-cem_time-controller"}]}},{key:"hasOpinionId",get:function(){return location.pathname.match(/^\/opinion\/[0-9a-z]+/)}}]),t}(o.Component),Q=function(e){var t=[];return Object.keys(e).forEach((function(n){"connConfig"===n||"tag"===n?e[n]&&e[n].forEach((function(e){t.push((0,a.Z)({},e,{special:n}))})):"source"===n||"escore"===n||"messageType"===n||"content"===n?e[n]&&t.push({id:"content"!==n?n:"KEY_WORD",special:n,values:"content"!==n?e[n]:e[n][0].contain}):"connections"===n&&e[n]&&t.push({id:n,special:n,values:e[n]})})),t};G.propTypes={title:u().oneOfType([u().string,u().node]),showList:u().array,defaultShow:u().string,filterCondition:u().shape({filter:u().array,filterConfig:u().array}),onChange:u().func,onFilterReady:u().func,model:u().string,values:u().object};var X=n(63366),$=n(78327),ee=n(25713),te=n(94644),ne=n(60496),ae=n(55609),ie=n(15861),re=n(87757),se=n.n(re);function oe(e){var t=e.projectId,n=e.filterModel,a=e.dateFilter,i=e.headerFilterParamsNew;return f.h.post("/widget/data/find/ASPECT_TREND_LINE",{projectId:t,filterModel:n,dateFilter:a,headerFilterParamsNew:i})}function le(e){var t=e.projectId,n=e.dateFilter,a=e.filterModel,i=e.analysisObject,r=e.headerFilterParamsNew;return f.h.post("/analysis/data",{projectId:t,dateFilter:n,filterModel:a,analysisObject:i,headerFilterParamsNew:r})}var ce=n(87219);function ue(e){switch(e){case"connConfig":default:return"TARGET_ANALYSIS";case"source":return"TARGET_SOURCE_ANALYSIS";case"tag":return"TARGET_TAG_ANALYSIS";case"expandTopic":return"TARGET_EXPAND_TOPIC_ANALYSIS"}}const de=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).lineChartRef=o.createRef(),t.barChartRef=o.createRef(),t.fetchAspectLineData=function(e){var n=t.state,i=n.dateType,r=n.filterModel,s=n.dateFilter,o=n.projectId,l=n.compareObj,c=n.emotion,u=n.headerFilterParamsNew,d=e.dateType||i,p=void 0!==e.compareObj?e.compareObj:l,m={projectId:o,dateFilter:(0,ce.ZP)(s,(function(e){e.dateGroupType=d})),filterModel:(0,ce.ZP)(r,(function(e){p&&e.analysis.values.push(p)})),headerFilterParamsNew:u};t.setState({fetchingAspectLineData:!0},(function(){oe(m).then((function(n){var i=n.data,r=2e4===i.code&&i.result&&i.result.list&&i.result.list.length>0,s=0;r&&(s=i.result.list[0].data.reduce((function(e,t){return e+t[c]}),0),s=O.ZP.getApproximateNum(s)),t.setState((0,a.Z)({},e,{fetchingAspectLineData:!1,aspectLineData:r?i.result.list:"empty",msgTotal:s}))})).catch((function(){t.setState({fetchingAspectLineData:!1,aspectLineData:"error"})}))}))},t.fetchAspectBarData=function(e){var n=t.state,i=n.projectId,r=n.dateFilter,s=n.topicObj,o=n.topicOpts,l=n.filterModel,c=n.headerFilterParamsNew,u=e.topicObj||s,d="BRAND_SERIES"!==u&&o.find((function(e){return e.value===u})),p="";d&&(p=d.type);var m={projectId:i,dateFilter:r,filterModel:(0,ce.ZP)(l,(function(e){e.analysis.type="BRAND_SERIES"===u?u:ue(p)})),analysisObject:u,headerFilterParamsNew:c};t.setState({fetchingAspectBarData:!0},(function(){le(m).then((function(n){var i=n.data;2e4===i.code&&t.setState((0,a.Z)({},e,{fetchingAspectBarData:!1,aspectBarData:i.result?i.result.list:"empty"}))})).catch((function(){t.setState({fetchingAspectLineData:!1,aspectLineData:"error"})}))}))},t.handleOnFilterChange=function(e){void 0!==e.dateType||void 0!==e.compareObj?t.fetchAspectLineData(e):void 0!==e.topicObj&&t.fetchAspectBarData(e)},t.handleOnChartClick=function(e,n){var a=t.props.onChartClick;"bar"===e?t.lineChartRef.current.resetChartRender():"line"===e&&t.barChartRef.current.resetChartRender(),a&&a(n)},t}return(0,i.Z)(t,e),t.prototype.resetChartRender=function(){this.lineChartRef.current.resetChartRender(),this.barChartRef.current.resetChartRender()},t}(o.Component);var pe=n(70715);const me=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).dimensions=void 0,t.source=void 0,t.chartRef=void 0,t.mColor=void 0,t.margin=0,t.chartLength=0,t.dateType="DAY",t.getChartRef=function(e){return t.chartRef=e},t.setValue=function(e,n){t.chartLength=e.length;var a=60;t.dimensions=["\u65e5\u671f"],t.source=e.reduce((function(e,i,r){return t.dimensions.push(i.title+("positive"===n?"\u6b63\u9762":"\u8d1f\u9762")+"\u58f0\u91cf",i.title+"\u6307\u6807"+("positive"===n?"\u6ee1\u610f\u5ea6":"\u5dee\u8bc4\u7387")),i.data.forEach((function(t,i){var s=t[n],o=t.positive+t.negative===0?0:t[n]/(t.positive+t.negative);a=Math.max(a,(0,O.jD)(s,12)+40),0===r?e.push([t.title,s,o]):e[i].push(s,o)})),e}),[]),t.margin=a,t.mColor=1===t.chartLength?"positive"===n?["#15B374","#108657"]:["#D96969","#C44A4A"]:"positive"===n?["#15B374","#108657","#cdb446","#a89230"]:["#D96969","#c44a4a","#cdb446","#a89230"]},t.getOption=function(e,n,a,i){var r=Array.from({length:t.chartLength}).map((function(e,n){return[{type:"bar",barMaxWidth:24,name:t.dimensions[2*n+1],data:t.source.map((function(e,i){return{value:e[2*n+1],itemStyle:{color:0!==n&&1!==n&&2!==n&&3!==n||-1===a||a===i?t.mColor[2*n%t.mColor.length]:"#d8d8d8"}}}))},{type:"line",yAxisIndex:1,name:t.dimensions[2*n+2],data:t.source.map((function(e,i){return{value:e[2*n+2],symbolSize:a>-1&&a===n?8:4,itemStyle:{color:0!==n&&1!==n&&2!==n&&3!==n||-1===a||a===i?t.mColor[(2*n+1)%t.mColor.length]:"#d8d8d8"}}})),lineStyle:{color:n<4&&a>-1?"#d8d8d8":t.mColor[(2*n+1)%t.mColor.length]}}]}));return{color:t.mColor,title:{text:e,subtext:n,subtextStyle:{lineHeight:32,color:"#262626",fontSize:24}},grid:{top:140,left:20,right:t.margin,bottom:40,containLabel:!0},dataset:[{source:t.source,dimensions:t.dimensions}],legend:{top:70,left:20,itemWidth:10,itemHeight:10,textStyle:{lineHeight:12},data:t.dimensions.slice(1).map((function(e,t){return{name:e,icon:t%2===0?pe.W4.square:pe.W4.lineRing}}))},dataZoom:{show:"slider",bottom:16,xAxisIndex:0,height:16,handleSize:"100%",showDetail:!1},tooltip:{trigger:"axis",formatter:function(e){var n=e[0],a=e.map((function(e,t){var n=t%2===0?e.data.value:(100*e.data.value).toFixed(2)+"%";return e.marker+" "+e.seriesName+"\uff1a"+n}));return(0,pe.Zi)((0,O.yV)(t.dateType,n.axisValue))+"</br>"+a.join("</br>")}},xAxis:{type:"category",axisLabel:{formatter:function(e){return(0,O.yV)(t.dateType,e)}},data:t.source.map((function(e){return e[0]}))},yAxis:[{type:"value",name:"\u6570\u91cf",splitNumber:3,nameTextStyle:{color:"#262626"}},{type:"value",name:"\u6bd4\u4f8b",splitNumber:3,nameTextStyle:{color:"#262626"},axisLabel:{formatter:function(e){return(100*e).toFixed(2)+"%"}}}],series:2===t.chartLength?[].concat(r[0],r[1]):[].concat(r[0])}},t}return(0,i.Z)(t,e),t.prototype.renderChart=function(e,t,n,a,i){this.setValue(e,n,i),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,a,i,n))},t}(o.PureComponent);var fe=n(8201),he=n(98191),ge=n(50976),ve=n(49975),ye=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleOnDateChange=function(e){n.dateType=e,n.props.onFilterChange({dateType:e}),n.props.onDateTypeChange({id:e})},n.handleOnChartClick=function(e){var t=e.componentType,a=(e.componentSubType,e.name),i=e.dataIndex,r=e.seriesIndex;"series"===t&&n.setState({clickedDataIndex:n.state.clickedDataIndex===i?-1:i,seriesIndex:r},(function(){var e=0===n.state.clickedDataIndex?"first":n.state.clickedDataIndex===n.source.length-1?"last":"",t=-1===n.state.clickedDataIndex?null:{name:a,sideType:e};n.props.onChartClick("line",t)}))},n.handleOnMoreClick=function(e){var t=n.props,a=t.title,i=t.value;"image"===e&&n.chartRef?(0,te._v)(n.chartRef,a):"data"===e&&(0,fe.P)(i)&&(0,te.aT)([[n.dimensions].concat(n.source)],a)},n.state={clickedDataIndex:-1,seriesIndex:-1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e,t){var n=this,a=e.value,i=this.props.value,r=t.clickedDataIndex,s=this.state,o=s.clickedDataIndex,l=s.seriesIndex;if((0,fe.P)(i)&&JSON.stringify(a)!==JSON.stringify(i)&&this.renderChart(),!(0,fe.P)(i)&&this.chartRef&&(this.chartRef=void 0),r!==o&&this.chartRef){var c=this.chartRef.getOption().series.map((function(e,t){var a=t<=0?0:t;return{data:e.data.map((function(e,i){return{value:e.value,symbolSize:o>-1&&o===i?8:4,itemStyle:{color:0!==t&&1!==t&&2!==t&&3!==t||-1===o||o===i&&l===t?n.mColor[a]:"#d8d8d8"}}})),lineStyle:{color:t%2!==0&&o>-1?"#d8d8d8":n.mColor[a]}}}));this.chartRef.setOption({series:c})}},n.componentDidMount=function(){this.renderChart()},n.renderChart=function(){var t=this.props,n=t.value,a=t.title,i=t.emotion,r=t.total,s=this.state.clickedDataIndex;(0,fe.P)(n)&&this.chartRef&&e.prototype.renderChart.call(this,n,a,i,r,s)},n.resetChartRender=function(){this.setState({clickedDataIndex:-1,seriesIndex:-1})},n.render=function(){var e=this.props,t=e.value,n=e.loading,a=e.title,i=e.filterObjOpts,r=e.onFilterChange,s=e.compareObj,l=e.dateRange,c=e.dateType;return o.createElement(fe.Z,{className:"yt_overview_aspect_line_chart_wrapper",data:t,loading:n,renderTitle:o.createElement(he.Z,{title:a,data:t,onMoreClick:this.handleOnMoreClick},o.createElement(ne.Z,{preTitle:"\u5bf9\u6bd4\u5bf9\u8c61",options:i,objName:"compareObj",activeObj:s,sufTitle:"\u65e0",onChange:r}),o.createElement(ve.Z,{defaultValue:c,noHour:!0,dateRange:l,onChange:this.handleOnDateChange}))},o.createElement(ge.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{click:this.handleOnChartClick}}))},t}(me);const Ee=ye;ye.propTypes={title:u().string,value:u().any,onFilterChange:u().func,emotion:u().string,compareObj:u().string,dateRange:u().number,dateType:u().dateType,filterObjOpts:u().array,onChartClick:u().func,onDateTypeChange:u().func};var Ce=n(97326),Se=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).dimensions=void 0,t.source=void 0,t.chartRef=void 0,t.margin=0,t.mColor=pe.Fq,t.getChartRef=function(e){return t.chartRef=e},t.setValue=function(e){t.dimensions=["\u6307\u6807","\u58f0\u91cf","\u7d2f\u8ba1\u58f0\u91cf\u5360\u6bd4"];var n=(0,O.jD)("100%",12)+30;t.source=e.reduce((function(e,t,a){return e[a].push(t.count),n=Math.max(n,(0,O.jD)(t.count,12)+30),e[a].push(t.percentage),e}),e.map((function(e){return[e.title]}))),t.margin=n},t.getOption=function(e,n){return{title:{text:e},tooltip:{trigger:"axis",formatter:function(e){return e.reduce((function(e,t,n){var a=t.marker,i=t.value,r=t.name;return 0===n?(e.push((0,pe.Zi)(r)),e.push(a+" \u58f0\u91cf\uff1a"+i)):e.push(a+" \u7d2f\u8ba1\u5360\u6bd4\uff1a"+(100*i).toFixed(2)+"%"),e}),[]).join("</br>")}},legend:{left:20,top:50,itemWidth:10,itemHeight:10,data:[{name:"\u58f0\u91cf",icon:pe.W4.square},{name:"\u7d2f\u8ba1\u58f0\u91cf\u5360\u6bd4",icon:pe.W4.lineRing}]},grid:{bottom:70,left:t.margin,right:t.margin,top:110},dataZoom:[{show:"slider",bottom:20,xAxisIndex:[0,1],height:15,handleSize:"100%",showDetail:!1}],dataset:[{source:t.source,dimensions:t.dimensions}],xAxis:[0,1].map((function(e){return{type:"category",data:t.source.map((function(e){return e[0]})),position:"bottom",show:!e}})),yAxis:[0,1].map((function(e){return{type:"value",name:e?"":"\u5404"+("12"===n?"\u578b\u53f7":"\u5546\u54c1")+"\u6307\u6807\u6392\u884c",nameTextStyle:{color:"#262626"},axisLabel:{formatter:function(t){return e?(100*t).toFixed(0)+"%":t}}}})),series:[{type:"bar",yAxisIndex:0,barMaxWidth:40,data:t.source.map((function(e){return{value:e[1],itemStyle:{color:"#1574B3"}}})),markLine:{symbolSize:0,data:[{name:"\u5747\u503c",type:"average",label:{backgroundColor:"rgba(140, 140, 140, 0.3)",textShadowColor:"#1574b3",textShadowBlur:2,padding:[2,4],color:"#fff"}}]}},{type:"line",yAxisIndex:1,data:t.source.map((function(e){return{value:e[2],itemStyle:{color:"#CDB446"}}}))}]}},t}return(0,i.Z)(t,e),t.prototype.renderChart=function(e,t,n){this.setValue(e),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,n))},t}(o.PureComponent);var Ne=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleOnMoreClick=function(e){var t=n.props,a=t.title,i=t.value;"image"===e&&n.chartRef?(0,te._v)(n.chartRef,a):"data"===e&&(0,fe.P)(i)&&(0,te.aT)([[n.dimensions].concat(n.source.map((function(e){return[e[0],e[1],(100*e[2]).toFixed(2)+"%"]})))],a)},n.handleOnChartClick=function(e){var t=e.componentSubType,a=e.componentType,i=e.dataIndex;"series"===a&&"bar"===t&&n.setState({clickedDataIndex:n.state.clickedDataIndex===i?-1:i},(function(){var e=n.props,t=e.onChartClick,a=e.value,r=e.topicObj;t&&t("bar",-1===n.state.clickedDataIndex?null:{analysis:{id:r,values:[a[i].id],type:a[i].type}})}))},n.handleOnSwitch=function(t){n.setState({showZero:t},(function(){var a=n.props,i=a.value,r=a.title;e.prototype.renderChart.call((0,Ce.Z)(n),t?i:i.filter((function(e){return e.count})),r)}))},n.state={showZero:!1,clickedDataIndex:-1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.renderChart()},n.componentDidUpdate=function(e,t){var n=this,a=e.value,i=this.props.value,r=t.clickedDataIndex,s=this.state.clickedDataIndex;if((0,fe.P)(i)&&JSON.stringify(a)!==JSON.stringify(i)&&this.renderChart(),!(0,fe.P)(i)&&this.chartRef&&(this.chartRef=void 0),r!==s&&this.chartRef){var o=this.chartRef.getOption().series.map((function(e,t){return{data:e.data.map((function(e,a){return{value:e.value,itemStyle:{color:-1===s||s===a?n.mColor[t%n.mColor.length]:"#d8d8d8"}}}))}}));this.chartRef.setOption({series:o})}},n.renderChart=function(){var t=this.props,n=t.value,a=t.title,i=t.categoryId,r=this.state.showZero;(0,fe.P)(n)&&this.chartRef&&e.prototype.renderChart.call(this,r?n:n.filter((function(e){return e.count})),a,i)},n.resetChartRender=function(){this.setState({clickedDataIndex:-1})},n.render=function(){var e=this.state.showZero,t=this.props,n=t.value,a=t.loading,i=t.title,r=t.topicOpts,s=t.topicObj,l=t.onFilterChange;return o.createElement(fe.Z,{className:"yt_overview_aspect_bar_chart_wrapper",data:n,loading:a,renderTitle:o.createElement(he.Z,{title:i,data:n,onMoreClick:this.handleOnMoreClick,titleOverlay:o.createElement("span",null,"\u6b64\u56fe\u7684\u5206\u6790\u65b9\u6cd5\u662f\u7edf\u8ba1\u5206\u6790\u4e2d\u5e38\u7528\u7684\u67cf\u62c9\u56fe\uff0c",o.createElement("a",{style:{color:"#0747a6"},href:"https://www.yuque.com/docs/share/5cc9676c-e68a-4304-8f36-f2bcdd347edb?#",target:"_blank"},"\u4e86\u89e3\u66f4\u591a"))},o.createElement(ne.Z,{options:r,objName:"topicObj",preTitle:"\u5206\u6790\u5bf9\u8c61",sufTitle:"\u65e0",activeObj:s,onChange:l}),o.createElement(d.Checkbox,{checked:e,onChange:this.handleOnSwitch,className:"zero_switch"},"\u663e\u793a'0'"))},o.createElement(ge.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{click:this.handleOnChartClick}}))},t}(Se);const ke=Ne;Ne.propTypes={value:u().any,topicOpts:u().array,topicObj:u().string,loading:u().bool,title:u().string,onFilterChange:u().func,onChartClick:u().func};var Oe=function(e){function t(t){var n;(n=e.call(this,t)||this).getFilterListShowAndHide=function(e){var t=JSON.parse(JSON.stringify(e));n.props.messageRelationConfig&&n.props.messageRelationConfig.unshow&&n.props.messageRelationConfig.unshow.forEach((function(e){t.some((function(n){return n.id===e&&(t.splice(t.findIndex((function(t){return t.id===e})),1),!0)}))}));var a=[],i=[];if(n.props.saveFilterListShow&&E.t.get(n.props.saveFilterListShow)&&E.t.get(n.props.saveFilterListShow).some((function(e){return e.projectId===n.state.projectId}))){var r=E.t.get(n.props.saveFilterListShow).filter((function(e){return e.projectId===n.state.projectId}))[0];t.forEach((function(e){r.filterListShow.some((function(t){return t.id===e.id}))?a.push(e):i.push(e)}))}else a=JSON.parse(JSON.stringify(t.slice(0,4))),i=JSON.parse(JSON.stringify(t.slice(4)));return{filterListShow:a,filterListHide:i}};var a=t.params,i=a.projectId,r=a.filterModel,s=a.dateFilter,o=a.analysisObjs,l=a.headerFilterParamsNew,c=a.categoryId,u=r&&r.aspect&&r.aspect.emotion&&r.aspect.emotion[0]||"positive",d=[],p="12"!==c?[]:[{title:(0,K.hj)("\u578b\u53f7"),value:"BRAND_SERIES",type:"BRAND_SERIES"}];try{if("12"!==c){var m=JSON.parse(E.t.get(E.V.filterList)||localStorage.getItem("filter-list")),f=r.analysis.values[0],h=r.analysis.id;m.list.find((function(e){return e.id===h}))&&(d=m.list.find((function(e){return e.id===h})).values.reduce((function(e,t){return t.id!==f&&o.includes(t.id)&&e.push({title:t.name,value:t.id}),e}),[{title:"\u65e0",value:""}])),p=m.list.reduce((function(e,t){return"escore"!==t.id&&t.id!==h&&e.push({title:t.name,value:t.id,type:t.special}),e}),[])}}catch(g){}return n.state={aspectLineData:void 0,fetchingAspectLineData:!1,compareObj:"",dateType:s.dateGroupType,msgTotal:0,dateRange:s.numOfDays,aspectBarData:void 0,fetchingAspectBarData:!1,topicObj:p.length>0?p[0].value:"",emotion:u,filterObjOpts:d,topicOpts:p,filterModel:r,headerFilterParamsNew:l,dateFilter:s,projectId:i},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.fetchAspectBarData({});var t=this.state,n=t.projectId,i=t.filterObjOpts,r=this.props.params.categoryId;(!i||i.length<=0)&&"12"!==r&&(0,ie.Z)(se().mark((function t(){return se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.h.post("/filter/find",{type:"OVERVIEW",filterTypes:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"],projectId:n}).then((function(t){var n,i,r;r=e.formatData(t.data.result);var s=e.getFilterListShowAndHide(r);n=s.filterListShow,i=s.filterListHide;var o=JSON.parse(JSON.stringify(n.concat(i))),l=[];o.forEach((function(e){e.child&&e.child.values.length>0&&l.push((0,a.Z)({},e.child,{special:"connConfig"}))})),(o=(o=o.filter((function(e){return!["input"].includes(e.type)}))).concat(o.splice(o.findIndex((function(e){return"expandTopic"===e.special})),1))).length>0&&E.t.set(E.V.filterList,JSON.stringify({list:o.concat(l),value:[]}));var c=e.props.params,u=c.filterModel,d=c.analysisObjs,p=u.analysis.values[0],m=u.analysis.id;e.setState({filterObjOpts:o.concat(l).find((function(e){return e.id===m}))?o.concat(l).find((function(e){return e.id===m})).values.reduce((function(e,t){return t.id!==p&&d.includes(t.id)&&e.push({title:t.name,value:t.id}),e}),[{title:"\u65e0",value:""}]):o.concat(l),topicOpts:o.concat(l).reduce((function(e,t){return"escore"!==t.id&&t.id!==m&&e.push({title:t.name,value:t.id,type:t.special}),e}),[])})}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},n.shouldComponentUpdate=function(e,t){var n=this;if(this.props.params.aspectEscoreType!==e.params.aspectEscoreType){var a=e.params,i=a.filterModel,r=a.headerFilterParamsNew,s=a.aspectEscoreType;this.setState({filterModel:i,headerFilterParamsNew:r,emotion:s},(function(){n.fetchAspectLineData({}),n.fetchAspectBarData({})}))}return!0},n.formatData=function(e){var t=this,n=[],i={};e.topics&&e.topics.titles&&e.topics.titles.length>0&&(i.connConfig=e.topics.data,n.push.apply(n,e.topics.titles.filter((function(t){return t.special="connConfig",t.filterType=e.topics.data?"connConfig":void 0,t.values.length>1})))),e.aspects&&e.aspects.titles&&e.aspects.titles.length>0&&(i.aspects=e.aspects.data,n.push.apply(n,e.aspects.titles.filter((function(t){return t.special="vocAspect",t.filterType=e.aspects.data?"aspects":void 0,t.values.length>1})))),e.brandsSeries&&e.brandsSeries.titles&&e.brandsSeries.titles.length>0&&(i.brandsSeries=e.brandsSeries.data,n.push.apply(n,e.brandsSeries.titles.filter((function(t){return t.special="brandsSeries",t.filterType=e.brandsSeries.data?"brandsSeries":void 0,t.values.length>1})))),this.setState({reFilterData:i}),e.dimension&&n.push.apply(n,e.dimension.filter((function(e){return e.special="dimension",e.type=-1!==["BRAND_INTERACTION_ANALYSIS","BRAND_CONTENT_ANALYSIS","BRAND_CHANNEL_ANALYSIS"].indexOf(t.props.type)?"radio":"",e.values.length>1}))),e.source&&e.source.length>0&&n.push({id:"source",name:"\u6570\u636e\u6765\u6e90",special:"source",values:e.source}),e.tag&&e.tag.length>0&&e.tag.forEach((function(e){e.special="tag",n.push(e)})),e.userFilter&&n.push({id:"userFilter",special:"userFilter",name:"\u7528\u6237",type:"associateInput",values:e.userFilter}),this.props.filterConfig&&this.props.filterConfig.forEach((function(e){switch(e){case"ESCORE":n.push({id:"escore",special:"escore",name:"\u901a\u7528\u60c5\u611f",values:[{id:"1",name:"\u6b63\u9762"},{id:"0",name:"\u4e2d\u6027"},{id:"-1",name:"\u8d1f\u9762"}]});break;case"MULTI_KEY_WORD":n.push({id:"MULTI_KEY_WORD",special:"content",name:"\u5173\u952e\u8bcd",type:"multi_input",values:[]});break;case"KEY_WORD":n.push({id:"KEY_WORD",special:"content",name:"\u5173\u952e\u8bcd",type:"input",values:[]});break;case"USEFUL_DATA":n.push({id:"usefulData",special:"usefulData",name:"\u6570\u636e\u6709\u6548\u6027",values:[{id:"USEFUL",name:"\u6709\u6548\u6570\u636e"},{id:"UNUSEFULL",name:"\u65e0\u6548\u6570\u636e"}]});break;case"ASPECT_ESCORE":n.push({id:"aspectEscore",special:"aspectEscore",name:"\u6307\u6807\u60c5\u611f",values:[{id:"1",name:"\u6b63\u9762"},{id:"0",name:"\u4e2d\u6027"},{id:"-1",name:"\u8d1f\u9762"}]});break;case"IS_BUSINESS":n.push({id:"isBusiness",special:"isBusiness",name:"\u4e1a\u52a1\u6570\u636e",values:[{id:"BUSINESS",name:"\u662f"},{id:"UN_BUSINESS",name:"\u5426"}]});break;case"IS_MARKETING":n.push({id:"isMarketing",special:"isMarketing",name:"\u8425\u9500\u6570\u636e",values:[{id:"MARKETING",name:"\u662f"},{id:"UN_MARKETING",name:"\u5426"},{id:"NULL_MARKETING",name:"\uff08\u7a7a\uff09"}]})}})),e.expandTopics&&n.push({id:"expandTopic",name:"\u7ec4\u5408\u5206\u6790",special:"expandTopic",values:e.expandTopics,type:"expandTopic"});var r=n.map((function(e){return(0,a.Z)({},e,{values:e.values.length>0?(0,O.QM)(e.values):e.values})}));return JSON.parse(JSON.stringify(r))},n.render=function(){var e=this.state,t=e.aspectLineData,n=e.fetchingAspectLineData,a=e.compareObj,i=e.dateType,r=e.emotion,s=e.filterObjOpts,l=e.dateRange,c=e.msgTotal,u=e.aspectBarData,d=e.fetchingAspectBarData,p=e.topicOpts,m=e.topicObj,f=this.props,h=f.onLineDateTypeChange,g=f.params.categoryId;return o.createElement("div",{className:"yt_detail_chart_view_wrapper"},o.createElement(Ee,{ref:this.lineChartRef,title:"\u6307\u6807\u58f0\u91cf\u53ca\u8d70\u52bf",emotion:r,total:c,value:t,loading:n,filterObjOpts:s,compareObj:a,dateType:i,dateRange:l,onChartClick:this.handleOnChartClick,onDateTypeChange:h,onFilterChange:this.handleOnFilterChange}),o.createElement(ke,{ref:this.barChartRef,categoryId:g,value:u,title:"\u6307\u6807\u5206\u5e03",loading:d,topicOpts:p,onChartClick:this.handleOnChartClick,topicObj:m,onFilterChange:this.handleOnFilterChange}))},t}(de);const Ie=Oe;Oe.propTypes={params:u().any,onChartClick:u().func,onLineDateTypeChange:u().func};var be=n(64396),Te=["loading"],we=(be.Z.aspectDetail.detail,be.Z.aspectDetail.opinionChart),xe=["#1550B3","#CC6A77","#119073","#CDB446","#D969BF","#2684FF","#C8662B","#9369D9","#0E97AD","#1BBF69","#D07B49","#61799B","#1EA082","#A9A557","#D8727F"],Le=[{title:"\u5bfc\u51fa\u56fe\u7247",type:"wImage"},{title:"\u5bfc\u51fa\u6570\u636e",type:"wExcel"}],De={DAY:"\u5929",WEEK:"\u5468",MONTH:"\u6708"},_e=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnWsMessage=function(e){var t=e.data;if(t.type&&"ws"===t.type){var i=t.payload,r=i.type,s=i.result,o=n.props.params.aspectEscoreType;"OPINION_TASK_RESULT"===r&&n.props.dispatch({type:we+"/handleOpinion",payload:(0,a.Z)({},s,{aspectEscoreType:o})})}},n.changeChart=function(e){(0,n.props.dispatch)({type:we+"/save",payload:{wordCloud:e}})},n.myChartClick=function(e){var t=n.props.opinionChart,a=(t.json_bar,t.queryParams.dateFilter),i=a.from,r=a.to,s=n.state.dateType,o=null;e&&e.name?o={time:e.name,type:s,sideType:e.sideType,sideTime:"first"===e.sideType?i:"last"===e.sideType?r:""}:e&&e.analysis&&(o={analysis:e.analysis}),n.clickTimeId&&clearTimeout(n.clickTimeId),n.clickTimeId=setTimeout((function(){n.props.refreshMessage(o),n.refs.wordCloud&&n.refs.wordCloud.resetState(),n.clickTimeId=void 0}),1e3)},n.resetWordcloudState=function(){setTimeout((function(){n.refs.wordCloud&&n.refs.wordCloud.resetState(),n.setState({activeOpinionIndex:-1})}),0)},n.resetBarchartState=function(){setTimeout((function(){n.refs.bar&&n.refs.bar.resetChartRender()}),0)},n.handleMyWordChartClick=function(e,t){var a=n.props.opinionChart,i=a.queryTimeType,r=a.clusterType,s=n.state.activeOpinionIndex,o=s===t?null:e?{opinion:e.name,type:i,clusterType:r}:null;n.props.refreshMessage(o),n.setState({activeOpinionIndex:s===t||-1===t?-1:t,activeOpinionName:s===t||-1===t?void 0:e.name},(function(){n.clickTimeId&&clearTimeout(n.clickTimeId),n.clickTimeId=setTimeout((function(){n.refs.bar&&n.refs.bar.resetState(),n.clickTimeId=void 0}),100)}))},n.onWindowResize=function(){setTimeout((function(){n.resize()}),300)},n.resize=function(){var e;if(n.flexWrapper){var t=n.flexWrapper.offsetWidth*n.rate;n.flexSpan.style.fontSize=t+"px"}n.refs.bar&&(null==(e=n.refs.bar.refs.chart)||e.myChart.resize())},n.changeQueryTime=function(e){e.name;var t=e.id,a=n.props,i=a.opinionChart.queryParams,r=a.dispatch,s=JSON.parse(JSON.stringify(i));s.dateFilter.dateGroupType=t,n.setState({dateType:t}),r({type:we+"/save",payload:{queryTimeType:t,queryParams:s}})},n.renderOpinionOverlay=function(){return o.createElement("div",null,o.createElement("div",null,"\u8be5\u6570\u636e\u4e3a\u60a8\u663e\u793a\uff1a\u7531\u4e8e\u6240\u9009\u7684\u6d88\u606f\u4e2d\u4e0d\u5149\u4f1a\u6709\u4e0e\u4e2d\u5fc3\u6307\u6807\u60c5\u611f\u76f8\u5173\u7684\u89c2\u70b9\uff0c\u8fd8\u4f1a\u6709\u5176\u4ed6\u76f8\u5173\u6307\u6807\u548c\u60c5\u611f\u7684\u89c2\u70b9\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u4e3b\u63a7\u5236\u662f\u5426\u5c55\u793a\u4ec5\u5c55\u793a\u4e2d\u5fc3\u6307\u6807\u60c5\u611f\u76f8\u5173\u7684\u89c2\u70b9\uff1b\u540c\u65f6\u5bf9\u4e8e\u805a\u7c7b\u7684\u89c2\u70b9\u7c97\u7ec6\u7a0b\u5ea6\u4e5f\u53ef\u4ee5\u7531\u7528\u6237\u9009\u62e9\u3002"),o.createElement("div",{style:{margin:"5px 0"}},"\u7b97\u6cd5\u8bf4\u660e\uff1a\u5178\u578b\u610f\u89c1\u7684\u83b7\u5f97\u5927\u81f4\u7ecf\u5386\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a\u2460\u4ece\u6d88\u606f\u4e2d\u62bd\u53d6\u89c2\u70b9\u2192\u2461\u5bf9\u89c2\u70b9\u805a\u7c7b\u2192\u2462\u9009\u4e3e\u4e2d\u5fc3\u89c2\u70b9\u3002\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e0a\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u2460\u4e4b\u540e\u9009\u62e9\u5373\u5c06\u805a\u7c7b\u7684\u89c2\u70b9\u662f\u5426\u4e0e\u4e2d\u5fc3\u6307\u6807\u60c5\u611f\u76f8\u5173\uff1b\u5728\u2461\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u805a\u7c7b\u7684\u7c97\u7ec6\u7a0b\u5e8f\uff0c\u53c2\u6570\u8bbe\u7f6e\u8d8a\u5c0f\uff0c\u805a\u7c7b\u7684\u89c2\u70b9\u8d8a\u7ec6\uff1b\u5728\u2462\u53ef\u80fd\u4f1a\u9009\u4e3e\u51fa\u4e0e\u4e2d\u5fc3\u6307\u6807\u7684\u60c5\u611f\u76f8\u5173\u7684\u89c2\u70b9\uff0c\u8fd9\u662f\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u6392\u9664\u8be5\u4e2d\u5fc3\u89c2\u70b9\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u7ed9\u51fa\u7b2c\u4e8c\u5907\u9009\u7684\u89c2\u70b9\u3002"),o.createElement("div",null,"\u540d\u8bcd\u8fa8\u6790\uff1a\u5178\u578b\u610f\u89c1\u5373\u89c2\u70b9\uff0c\u662f\u4e00\u4e2a\u805a\u7c7b\u51fa\u7684\u89c2\u70b9\u7c07\u4e2d\u7684\u4ee3\u8868\u3002"))},n._handleMoreClick=function(e){var t=n.props.opinionChart,a=t.json_word,i=t.json_bar,r=t.queryTimeType;if("wImage"===e)(0,te._v)(n.refs.wordCloud.refs.chart.myChart,"\u5178\u578b\u610f\u89c1");else if("bImage"===e)(0,te._v)(n.refs.bar.refs.chart.myChart,"\u6570\u636e\u8d8b\u52bf");else if("bExcel"===e){var s=i.reduce((function(e,t){return[].concat(e,[[t.time,t.count]])}),[["\u65e5\u671f/\u6309"+De[r],"\u8bcd\u9891"]]);(0,te.aT)([s],"\u6570\u636e\u8d8b\u52bf")}else if("wExcel"===e){var o=a.reduce((function(e,t){return t?[].concat(e,[[t.name,t.value]]):e}),[["\u8bcd\u540d","\u8bcd\u9891"]]);(0,te.aT)([o],"\u5178\u578b\u610f\u89c1")}},n._handleCommonChange=function(e){var t=n.props,a=t.dispatch,i=t.opinionChart,r=i.refreshing,s=i.reloaded,o=i.allData,l=i.type,c=(i.hasRecord,i.json_word,n.state),u=c.activeOpinionIndex,d=c.activeOpinionName,p=e.clusterType;if(-1!==u&&d){var m=o[p].findIndex((function(e){return(null==e?void 0:e.name)===d}));n.setState({activeOpinionIndex:-1===m?100:m})}if(r&&3!==l&&!s||4===l){var f=o[p];a({type:we+"/save",payload:{clusterType:p,json_word:f}})}else a({type:we+"/save",payload:{clusterType:p}}),a({type:we+"/getWordCloudList"});n.setState({optionPage:1})},n.renderWordOverlay=function(e){return o.createElement("div",{onClick:function(e){e.stopPropagation()}},o.createElement("span",null,e),o.createElement("span",{style:{marginLeft:10,color:"#1890ff",cursor:"pointer"},onClick:function(t){n._handleWordHideClick(e)}},"\u9690\u85cf"))},n._handleWordHideClick=function(e){var t=n.props,a=t.opinionChart.json_word,i=t.dispatch,r=a.filter((function(t){return t&&t.name!==e})),s=Math.ceil(a.length/30);r=[].concat(r,Array(30*s-r.length).fill(void 0)),je(r),i({type:we+"/save",payload:{json_word:r}})},n.goOpinion=function(){var e=n.props.taskId;window.open("/opinion?id="+e+"&source=detail")},n._handleOnOptionWordListPageChange=function(e){n.setState({optionPage:e})},n.state={activeOpinionIndex:-1,activeOpinionName:void 0,optionPage:1,dateType:"DAY"},n}(0,i.Z)(t,e);var r=t.prototype;return r.componentDidMount=function(){var e=this.props,t=e.type,n=e.dispatch,a=e.opinionChart,i=a.opinion,r=(a.hasRecord,e.taskId);if(location.search.length>0&&"/tab/aspectDetail"===location.pathname){var s=JSON.parse(decodeURIComponent(location.search).split("?")[1]);n({type:we+"/save",payload:{queryParams:s,queryTimeType:s.dateFilter.dateGroupType,type:t,currTaskId:r}})}if(i&&(2===t||3===t)&&n({type:we+"/getWordCloudList"}),this.flexWrapper){var o=this.flexWrapper.offsetWidth;this.rate=.03,this.flexSpan.style.fontSize=o*this.rate+"px"}window.addEventListener("resize",this.onWindowResize)},r.UNSAFE_componentWillReceiveProps=function(e,t){var n=this.props,a=n.dispatch,i=(n.opinionChart.opinion,this.props.taskId),r=e.taskId;i!==r&&a({type:we+"/save",payload:{currTaskId:r}}),this.props.type!==e.type&&a({type:we+"/save",payload:{type:e.type}}),JSON.stringify(this.props.params)!==JSON.stringify(e.params)&&a({type:we+"/save",payload:{queryParams:e.params,queryTimeType:e.params.dateFilter&&e.params.dateFilter.dateGroupType||"DAY"}})},r.componentWillMount=function(){(0,this.props.dispatch)({type:we+"/save",payload:{count:0,average:0,json_bar:"\u6ca1\u6709\u6570\u636e\u53ef\u7528",json_word:[]}}),window.addEventListener("resize",this.onWindowResize),window.addEventListener("message",this._handleOnWsMessage)},r.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage)},r.shouldComponentUpdate=function(e,t){var n=this.props,a=n.opinionChart,i=a.clusterType,r=a.json_word,s=a.json_bar,o=a.opinionTaskValid,l=a.queryTimeType,c=a.refreshing,u=a.wordCloud,d=a.allData,p=a.loading,m=(n.params,e.opinionChart),f=m.clusterType,h=m.json_word,g=m.json_bar,v=m.opinionTaskValid,y=m.queryTimeType,E=m.refreshing,C=m.wordCloud,S=m.allData,N=m.loading;e.params;return!(i===f&&o===v&&l===y&&c===E&&u===C&&p===N&&k(r,h)&&k(s,g)&&k(d,S))||(this.state.optionPage!==t.optionPage||this.state.activeOpinionIndex!==t.activeOpinionIndex)},r.render=function(){var e=this,t=this.props,a=t.opinionChart,i=a.type,r=a.wordCloud,s=(a.json_bar,a.average,a.queryTimeType,a.json_word),l=a.queryParams,c=a.opinion,u=a.clusterType,p=a.refreshing,m=(a.allData,a.opinionTaskValid),f=a.invalidReason,h=(a.hasRecord,a.clusterTypeOptions),g=a.loading,v=t.params,E=this.state,C=E.optionPage,S=E.activeOpinionIndex;return o.createElement("div",{className:"detailChart"},4===i&&v.analysisObjs&&/1|12/.exec(v.categoryId)&&o.createElement(Ie,{ref:"bar",params:v,onChartClick:this.myChartClick,onLineDateTypeChange:this.changeQueryTime}),c&&o.createElement("div",{className:"detailChart-bottom"},o.createElement("div",{className:"title"},o.createElement("span",null,o.createElement("span",{style:{marginLeft:5,fontSize:14}},"\u5178\u578b\u610f\u89c1",4===i&&"\uff08"+(l&&l.seriesName)+"\uff09"),o.createElement(y.Z,{placement:"bottom",overlayClassName:4===i?"popover-detial-wrapper":"popover-opinion-wrapper",overlay:this.renderOpinionOverlay()},o.createElement("i",{className:"icon-cem_file1"}))),o.createElement("span",null,4!==i&&o.createElement(y.Z,{overlay:"\u5f53\u524d\u56fe\u8868\u663e\u793a\u7684\u662f\u524d5000\u6761\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1\u7ed3\u7b97\u7ed3\u679c\uff0c\u7cfb\u7edf\u6b63\u5728\u8ba1\u7b97\u5168\u90e8\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1\uff0c\u8ba1\u7b97\u597d\u4e4b\u540e\u4f1a\u81ea\u52a8\u5237\u65b0\u56fe\u8868",placement:"top",overlayClassName:"alert-log-tips"},o.createElement("i",{className:p?"icon-cem_refresh refreshing":"icon-cem_refresh",style:{display:p?"inline-block":"none"}})),o.createElement("span",{className:"clustering"},o.createElement("span",{className:p?"":"disapper"},"\u805a\u7c7b\u9897\u7c92\uff1a"),o.createElement(ne.Z,{activeObj:u,onChange:this._handleCommonChange,options:h,objName:"clusterType"})),o.createElement("i",{className:"icon-cem_cloud "+(r?"active":""),onClick:this.changeChart.bind(this,!0)}),o.createElement("i",{className:"icon-cem_listing "+(r?"":"active"),onClick:this.changeChart.bind(this,!1)}),o.createElement("span",{style:{color:"#e5e5e5",marginRight:8}},"|"),o.createElement(ee.Z,{options:Le,onClick:this._handleMoreClick}))),o.createElement(d.Loading,{className:"chart-table",loading:g,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},s?m?r?o.createElement($.Z,{index:4===i?1:0,ref:"wordCloud",json:s,activeOpinionIndex:S,myChartClick:this.handleMyWordChartClick}):o.createElement(o.Fragment,null,o.createElement("div",{className:"oppion-word"},0!==s.length||g?s.slice(30*(C-1),30*C).map((function(t,n){var a=30*(C-1)+n+1;return o.createElement("div",{key:a},t?o.createElement(y.Z,{overlayClassName:"popover-detail-wrodcloud-list-wrapper",placement:"top",overlay:e.renderWordOverlay(t.name)},o.createElement("span",{className:"option-item "+(-1===S||a-1===S?"":"inactive-option-item"),onClick:function(n){e.handleMyWordChartClick(t,a-1)}},o.createElement("span",null,o.createElement("span",{style:{backgroundColor:""+(a<7?xe[a%xe.length]:"#8c8c8c")}},a)),o.createElement("span",null,t.name),o.createElement("span",null,Ae(t.value,2)),o.createElement("span",null,"("+t.ratio+")"))):null)})):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6ca1\u6709\u6570\u636e\u53ef\u7528"))),s.length>30?o.createElement(d.Pagination,{className:"oppion-word-pagination",layout:"prev, pager, next",total:s.length,pageSize:30,currentPage:C,small:!0,onCurrentChange:this._handleOnOptionWordListPageChange}):null):o.createElement("div",{className:"no-data"},0!==f&&o.createElement(o.Fragment,null,o.createElement("img",{src:n(6714)}),o.createElement("span",null,"\u5f53\u524d",1===f?"\u6d88\u606f\u4e2d\u5c11\u4e8e20\u4e2a\u89c2\u70b9":2===f?"\u5c0f\u4e8e50\u6761\u6d88\u606f":"\u5927\u4e8e50\u4e07\u6761\u6d88\u606f","\uff0c\u65e0\u6cd5\u542f\u52a8\u5178\u578b\u610f\u89c1"),o.createElement("span",null,"\u8bf7\u91cd\u65b0\u9009\u62e9\u7b5b\u9009\u6761\u4ef6"))):null)))},(0,l.Z)(t,[{key:"formatterData",get:function(){var e=this.props.opinionChart.count,t=String(e);if(t.length>3){var n=t.split(""),a="",i=n.length,r=i-(3+(i%3===0?3:i%3));r>=3&&r<6&&i>6?a="K":r>=6&&(a="M");for(var s=0,o=i;o>0;o--)0!==s&&s%3===0&&n.splice(o,0,","),s++;return n.slice(0,n.indexOf(",")+4).join("")+a}return e}}]),t}(o.Component);const Fe=(0,ae.connect)((function(e){e.loading;return{opinionChart:(0,X.Z)(e,Te)[we]}}),null,null,{withRef:!0})(_e);var Ae=function(e,t){return e?e/1e4<1?e:e/1e8<1?(e/1e4).toFixed(t||0)+"\u4e07":(e/1e8).toFixed(t||0)+"\u4ebf":0},je=function(e){var t=e.reduce((function(e,t){return t?e+t.value:e}),0);e.forEach((function(e){e&&(e.ratio=(e.value/t*100).toFixed(2)+"%")}))},Re=(n(9405),n(89552)),Me=(n(75314),n(11187)),Pe=(n(38425),n(52314)),Ve=n(12234),Ze=n(94184),We=n.n(Ze),He="1",Be="17",Je="21",Ye="22",qe="12",ze=n(66746),Ue=function(e,t){var n;return null!=e&&null!=(n=e.aspects)&&n.length?o.createElement("div",{className:"blog_aspects",style:{}},o.createElement("div",null,e.aspects.filter((function(e){return 8===e.escore})).length?o.createElement(o.Fragment,null,o.createElement("span",{className:"name"},"\u6307\u6807"),o.createElement("div",{className:"aspects"},e.aspects.filter((function(e){return 8===e.escore})).map((function(e,n){return o.createElement(y.Z,{key:"aspects_"+n,mouseEnterDelay:.6,overlay:o.createElement("div",{className:"aspects_tip"},o.createElement("p",null,o.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),o.createElement("span",null,e.aspect1)),o.createElement("p",null,o.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),o.createElement("span",null,e.aspect2)),o.createElement("p",null,o.createElement("span",null,"\u6307\u6807\u60c5\u611f"),o.createElement("span",null,"\u6b63\u9762"))),placement:"bottom"},o.createElement("span",{className:e.currentModule?"escore8_deep":"escore8",onMouseEnter:function(){var n;return(null==(n=e.highLightInfoList)?void 0:n.length)>0&&t({currentHighLight:[].concat(e.highLightInfoList),tagHoverInfo:{id:e.msgId,type:"aspect"}})},onMouseLeave:function(){return t({currentHighLight:[],tagHoverInfo:{}})}},e.aspect2))})))):null),o.createElement("div",{className:"negative"},e.aspects.filter((function(e){return 8!==e.escore})).length?o.createElement(o.Fragment,null,o.createElement("span",{className:"name"},"\u6307\u6807"),o.createElement("div",{className:"aspects"},e.aspects.filter((function(e){return 8!==e.escore})).map((function(e,n){return o.createElement(y.Z,{key:"aspects_"+n,mouseEnterDelay:.6,overlay:o.createElement("div",{className:"aspects_tip"},o.createElement("p",null,o.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),o.createElement("span",null,e.aspect1)),o.createElement("p",null,o.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),o.createElement("span",null,e.aspect2)),o.createElement("p",null,o.createElement("span",null,"\u6307\u6807\u60c5\u611f"),o.createElement("span",null,"\u8d1f\u9762"))),placement:"bottom"},o.createElement("span",{className:e.currentModule?"escore3_deep":"escore3",onMouseEnter:function(){var n;return(null==(n=e.highLightInfoList)?void 0:n.length)>0&&t({currentHighLight:[].concat(e.highLightInfoList),tagHoverInfo:{id:e.msgId,type:""}})},onMouseLeave:function(){return t({currentHighLight:[],tagHoverInfo:{}})}},e.aspect2))})))):null)):null},Ke=function(e,t,n,a){var i=t.filterModel.content&&t.filterModel.content[0]&&t.filterModel.content[0].contain;if(null!=i&&i.length){var r=e&&e.replace(/ on.*?=/g," harmony=");return r&&i&&i.forEach((function(e){var t=e.includes("*")?e.replaceAll("*",""):e,n=new RegExp(t,"ig");"pre"!==e&&(r=r.replace(n,(function(e){return"<pre>"+e+"</pre>"})))})),r=r.replace(/!\[\]\((.*)\)/g,(function(e,t){return'<img src="'+t+'" />'}))}if(null!=n&&n.length){var s=n.map((function(e){return(e=e.split("-"))[1]=Number(e[0])+Number(e[1]),e})).sort((function(e,t){return t[1]-e[1]})),o=e.split(""),l=a?'<a class="highlight-green">':'<a class="highlight-red">';return s.forEach((function(e){o.splice(e[0],0,l),o.splice(e[1]+1,0,"<a/>")})),o.join("")}return e},Ge=n(49357);F().locale("zh-cn");const Qe=function(e){var t=e.getRef,a=e.aspects,i=e.params,r=e.openItem,s=e.isLoading,l=(e.sourceEmotion,e.emotion),c=e.seriesName,u=e.info,p=e.data,m=(e.deleteAsp,e.transformAsp,e.openItems),h=e.searchTable,g=e.onFeedback,v=e.getDrawerRef,y=e.lock,E=o.useState(null),C=E[0],S=E[1],N=o.useState(null),k=N[0],I=N[1],b=o.useState([]),w=b[0],x=b[1],L=o.useState({}),D=L[0],_=L[1],A=!1,j=function(e,t,n){var a=(0,O.Lh)(e||""),r=i.filterModel.content&&i.filterModel.content[0]&&i.filterModel.content[0].contain,s="aspect"===n?'<a class="highlight-green">':'<a class="highlight-red">';if(t){var o=a.split(""),l=t.map((function(e){return e&&"string"===typeof e&&((e=e.split("-"))[1]=Number(e[0])+Number(e[1])),e})).sort((function(e,t){return t[1]-e[1]}));l.forEach((function(e){(0,Ge.W5)(o,e,s)})),a=o.join("")}return r&&r.length>0&&r.forEach((function(e){var t=new RegExp(e,"g"),n='<a class="highlight-yellow">'+e+"</a>";a=a.replace(t,n)})),a},R=function(e){S(e)},M=function(e){e&&(x(null==e?void 0:e.currentHighLight),_(null==e?void 0:e.tagHoverInfo))},P=function(e){var t=e.aspects.filter((function(e){return e.escore===(l?8:3)})).map((function(e){return e.aspect2}));return o.createElement(Pe.X,{className:"detail-extend"},o.createElement("div",null,o.createElement(d.Select,{value:C,onChange:R},a&&Object.keys(a).map((function(t,n){return o.createElement(d.Select.Option,{label:t,value:t,key:t+e.commentId})}))),o.createElement("i",{className:"icon-cem_delete close",onClick:function(){return m(e.commentId)}})),o.createElement("div",{className:l?"asp asp-positive":"asp asp-negative"},a&&a[C].filter((function(e){return-1===t.indexOf(e)})).map((function(t,n){return o.createElement("span",{key:n,style:{cursor:s?"not-allowed":""},onClick:function(){return s?"":function(e,t,n){I(e.commentId),f.h.post("inbox/messages/add",{commentId:e.commentId,index:e.index,routing:e.routing,score:l?8:3,aspect1:t,aspect2:n,flag:"aspect"}).then((function(e){h(u),I(null)}))}(e,C,t)}},o.createElement("i",{className:"text"},t),o.createElement("i",{className:"hover-state"},o.createElement(Ve.l,{name:"add-to-white"})))}))))};T.Z.hasAuthority("REVIEW_MESSAGE_LOCK")||(y=!0);var V=(document.documentElement.clientWidth-64-36-76-68-24-32-200)/2;return o.createElement("div",{ref:t,className:"message_list"},p.length>0?p.map((function(e,t){var a=e;A=A||c.includes("\u6b63\u9762")||!y;We()("asp","asp-negative",{"negative-border":A});return o.createElement(Re.default,{spinning:k===e.commentId,key:a.commentId+t},o.createElement("div",{className:"blog-container "+(y?"lock":"unlock")},o.createElement(Pe.X,{className:"blog-title"},o.createElement(Pe.J,{className:"base-info source"},o.createElement("span",{className:"source-img"},o.createElement("img",{src:a.userImage?a.userImage.startsWith("http")?a.userImage:location.protocol+"//"+a.userImage:n(88958),"data-url":a.userImage,alt:"\u5934\u50cf"}))),o.createElement(Pe.J,{className:"base-info product"},a.username),o.createElement(Pe.J,{className:"base-info  pull-right"},!!e.oids&&"\u5929\u732b"===e.sourceName&&o.createElement("span",null,"\u8ba2\u5355\u7f16\u53f7:",o.createElement("span",{className:"copyValues",onClick:function(){return(0,O.zp)("copyValues")}},e.oids),o.createElement("i",{className:"icon-fuzhi",onClick:function(){return(0,O.zp)("copyValues")},style:{color:"#7262FD",cursor:"pointer",marginRight:"10px"}})),null!=e.score&&0!==e.score&&o.createElement(d.Rate,{className:"rate",disabled:!0,key:e.score,value:e.score,colors:["#FF8373","#FF8373","#FF8373"],showText:!1}),o.createElement("span",{className:"time"},F()(a.ctime).format("YYYY-MM-DD HH:mm")),o.createElement("span",{className:"type"},"\u8bc4"))),o.createElement(Pe.X,{className:"blog-body",dangerouslySetInnerHTML:{__html:j(a.content,D.id===a.commentId&&w.length>0?[].concat(a.opinionHighLightList,w):a.opinionHighLightList,D.id===a.commentId&&D.type)}}),o.createElement(Pe.X,{className:"blog-comment-aspects"},Ue(a,M)),r===a.commentId&&P(a),o.createElement("div",{className:"blog-body message-detail"},o.createElement("span",{className:"title line ellipsis",style:{maxWidth:V},title:a.title?a.title:""},"- "+(a.title?a.title:"")),o.createElement("div",null,o.createElement("span",{className:"source line ellipsis"},"\u6765\u6e90\uff1a",a.sourceName),o.createElement("span",{className:"connect line ellipsis",style:{maxWidth:V},title:a.title},"\u94fe\u63a5\uff1a",a.connectionName),o.createElement("a",{href:a.url,target:"_blank",className:"line ellipsis",rel:"noreferrer"},"\u6570\u636e\u6e90"),o.createElement("span",{className:"feedback feed-back",onClick:function(){return g(a)}},"\u53cd\u9988"),o.createElement(ze.Z,{ref:v})))))})):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))};var Xe=n(1374),$e={TEXT:"\u666e\u901a\u9898\u578b\u95ee\u5377",TEXTAREA:"\u666e\u901a\u9898\u578b\u95ee\u5377",NPS_REASON:"NPS\u95ee\u5377",SATISFACTION_REASON:"\u6ee1\u610f\u5ea6\u95ee\u5377"};const et=function(e){var t=e.params,i=e.data,r=e.sourceEmotion,s=e.getDrawerRef,l=(e.onFeedback,o.useState({})),c=l[0],u=l[1],p=function(e){return o.createElement("div",{className:"radio_content common_card_style"},o.createElement("div",{className:"title"},e.title),o.createElement(d.Radio.Group,{value:e.choosed},e.opinion&&e.opinion.map((function(e,t){return o.createElement(d.Radio,{value:e,key:t,disabled:!0},e)}))))},m=function(e){return o.createElement("div",{className:"checkbox_content common_card_style"},o.createElement("div",{className:"title"},e.title),o.createElement(d.Checkbox.Group,{value:e.choosed},e.opinion&&e.opinion.map((function(e,t){return o.createElement(d.Checkbox,{key:t,label:e,disabled:!0})}))))},f=function(e){if("USER_INFO"===e.type){var n=JSON.parse(e.answer)||"";return o.createElement("div",{className:"single_text common_card_style"},o.createElement("div",{className:"title"},o.createElement("span",null,e.title)),o.createElement("div",{className:"single_text_reason"},o.createElement("p",{dangerouslySetInnerHTML:{__html:Ke(n.id||"",t,e.opinionHighLightList,r)}}),o.createElement("p",{dangerouslySetInnerHTML:{__html:Ke(n.name||"",t,e.opinionHighLightList,r)}}),o.createElement("p",{dangerouslySetInnerHTML:{__html:Ke(n.value||"",t,e.opinionHighLightList,r)}})),Ue(e))}return o.createElement("div",{className:"single_text common_card_style"},o.createElement("div",{className:"title"},o.createElement("span",null,e.title)),o.createElement("div",{className:"single_text_reason"},o.createElement("span",{dangerouslySetInnerHTML:{__html:Ke(e.answer||"",t,e.opinionHighLightList,r)}})),Ue(e))},h=function(e){return o.createElement("div",{className:"nps_score_content common_card_style"},o.createElement("div",{className:"content_wrap"},o.createElement("div",{className:"title"},e.title),o.createElement("div",{className:"score"},o.createElement("ul",null,new Array(11).fill(0).map((function(t,n){return o.createElement("li",{className:parseInt(e.answer)===n?"sel":"",key:n},n)}))),o.createElement("p",null,o.createElement("span",{dangerouslySetInnerHTML:{__html:Ke("0\uff1a\u4e0d\u53ef\u80fd",t,e.opinionHighLightList,r)}}),o.createElement("span",{dangerouslySetInnerHTML:{__html:Ke("10\uff1a\u6781\u6709\u53ef\u80fd",t,e.opinionHighLightList,r)}})))))},g=function(e){return o.createElement("div",{className:"rate_content common_card_style"},o.createElement("div",{className:"rate_content_tips"},o.createElement("div",{className:"title",dangerouslySetInnerHTML:{__html:Ke(e.title||"",t,e.opinionHighLightList,r)}}),o.createElement("div",{className:"rate_box"},o.createElement(d.Rate,{allowHalf:!0,disabled:!0,value:Number(e.answer)}),o.createElement("div",{className:"rate_score"},o.createElement("span",{dangerouslySetInnerHTML:{__html:Ke("\u5f88\u4e0d\u6ee1\u610f",t,e.opinionHighLightList,r)}}),o.createElement("span",{dangerouslySetInnerHTML:{__html:Ke("\u4e00\u822c",t,e.opinionHighLightList,r)}}),o.createElement("span",{dangerouslySetInnerHTML:{__html:Ke("\u5f88\u6ee1\u610f",t,e.opinionHighLightList,r)}})))),Ue(e))};return o.createElement("div",{className:"message_list"},i&&i.length?i.map((function(e){var t,i,r;return o.createElement("div",{key:e.id},o.createElement("div",{className:"blog-container"},o.createElement("div",{className:"blog-title"},o.createElement("div",{className:"base-info source"},o.createElement("span",{className:"source-img"},o.createElement(Xe.Z,{src:e.uimg?e.uimg.startsWith("http")?e.uimg:location.protocol+"//"+e.uimg:n(88958),defaultImg:n(88958)}))),o.createElement("span",{className:"base-info product"},e.username||"\u533f\u540d\u7528\u6237"),o.createElement("div",{className:"base-info  pull-right"},o.createElement("span",{className:"time"},F()(e.ctime).format("YYYY-MM-DD HH:mm")),o.createElement("span",{className:"type"},e.type?e.type.substring(1):"")))),o.createElement("div",{className:"blog_body"},null!=(t=e.nestedDetails)&&t.length?e.nestedDetails.map((function(t,n){return o.createElement("div",{key:t.id,style:{display:n>=1&&!c[e.id]?"none":"block"}},function(e){switch(e.type){case"SINGLE_CHOICE":return p(e);case"TEXT":case"TEXTAREA":case"USER_INFO":case"PHONE":case"NAME":case"EMAIL":case"SATISFACTION_REASON":case"NPS_REASON":case"SEX":case"DATE":default:return f(e);case"MULTIPLE_CHOICE":return m(e);case"NPS_SCORE":return h(e);case"SATISFACTION":return g(e)}}(t))})):null,(null==(i=e.nestedDetails)?void 0:i.length)>1&&o.createElement("div",{className:"content_show_search",onClick:function(){var t;u((0,a.Z)({},c,((t={})[e.id]=!c[e.id],t)))}},c[e.id]?"\u6536\u8d77":"\u663e\u793a","\u5168\u6587"),!(null!=(r=e.nestedDetails)&&r.some((function(e){var t;return null==(t=e.aspects)?void 0:t.length})))&&Ue(e)),o.createElement("div",{className:"message-detail"},o.createElement("div",null,o.createElement("span",{className:"line"},e.answerListType?$e[e.answerListType]:e.type),o.createElement("span",null,e.sourceName,"-",e.questionnaireName||"")),o.createElement(ze.Z,{ref:s})))})):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))};const tt=function(e){var t=e.params,a=e.data,i=e.sourceEmotion,r=e.getDrawerRef,s=e.onFeedback;return o.createElement("div",{className:"message_list"},a&&a.length?a.map((function(e){return o.createElement("div",{className:"blog-container",key:e.id},o.createElement("div",{className:"blog-title"},o.createElement("div",{className:"base-info source"},o.createElement("span",{className:"source-img"},o.createElement(Xe.Z,{src:e.uimg?e.uimg.startsWith("http")?e.uimg:location.protocol+"//"+e.uimg:n(88958),defaultImg:n(88958)}))),o.createElement("div",{className:"base-info product"},e.username),o.createElement("div",{className:"base-info  pull-right"},null!=e.score&&0!==e.score&&o.createElement(d.Rate,{className:"rate",disabled:!0,key:e.score,value:e.score,colors:["#FF8373","#FF8373","#FF8373"],showText:!1}),o.createElement("span",{className:"time"},F()(e.ctime).format("YYYY-MM-DD HH:mm")),o.createElement("span",{className:"type"},e.type?e.type.substring(0,1):""))),o.createElement("div",{className:"blog_body blog_app_body"},o.createElement("div",{className:"text_content",dangerouslySetInnerHTML:{__html:Ke(e.content,t,e.opinionHighLightList,i)}}),Ue(e)),o.createElement("div",{className:"message-detail blog_app_foot"},o.createElement("div",null,o.createElement("span",{className:"source-img"},o.createElement(Xe.Z,{src:e.icon?e.icon.startsWith("http")?e.icon:location.protocol+"//"+e.icon:n(49845),defaultImg:n(49845)})),o.createElement("span",{className:"line"},e.appName),o.createElement("span",null,o.createElement("span",null,"\u7248\u672c\uff1a"),e.version||"--")),o.createElement("div",null,o.createElement("span",{className:"line",style:{color:"#8c8c8c",fontWeight:400}},e.type),o.createElement("span",null,o.createElement("span",null,"\u5e73\u53f0\uff1a")," ",e.sourceName)),o.createElement("span",{className:"feedback",onClick:function(){return s(e)}},"\u53cd\u9988"),o.createElement(ze.Z,{ref:r})))})):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))};const nt=function(e){var t=e.params,i=e.data,r=e.sourceEmotion,s=e.getDrawerRef,l=e.onFeedback,c=o.useState({}),u=c[0],d=c[1],p=o.useState({}),m=p[0],f=p[1];o.useEffect((function(){h()}),[i]);var h=function(){var e=document.querySelectorAll(".message_list .report_content .report_text");if(null!=e&&e.length){var t={};e.forEach((function(e){var n;e.id,t=(0,a.Z)({},t,((n={})[e.id.split("_")[1]]=e.scrollHeight>48,n)),f(t)}))}};return o.createElement("div",{className:"message_list"},i&&i.length?i.map((function(e,i){var c,p,f,h,g=(null==(c=e.nestedDetails)?void 0:c.length)>1||m[e.id]&&1===(null==(p=e.nestedDetails)?void 0:p.length);return o.createElement("div",{className:"blog-container",key:e.id},o.createElement("div",{className:"blog-title blog_title",style:{paddingBottom:8}},o.createElement("div",{className:"base-info source"},o.createElement("span",{className:"source-img"},o.createElement(Xe.Z,{src:e.icon?e.icon.startsWith("http")?e.icon:location.protocol+"//"+e.icon:n(86073),defaultImg:n(86073)}))),o.createElement("span",{className:"base-info product"},e.title||"\u5de5\u5355"),o.createElement("div",{className:"base-info pull-right",style:{lineHeight:"unset"}},e.starLevel&&o.createElement("div",{className:"star_level"},o.createElement("span",{className:"message_t1"},"Rating"),o.createElement("span",{className:"message_t2"},e.starLevel)),o.createElement("span",{className:"time"},F()(e.ctime).format("YYYY-MM-DD HH:mm")),o.createElement("span",{className:"type"},"\u5de5"))),o.createElement("div",{className:"blog_ticket_body"},null!=(f=e.nestedDetails)&&f.length?e.nestedDetails.map((function(a,i){return o.createElement("div",{key:a.id,style:{display:i>=1&&!u[e.id]?"none":"block"}},o.createElement("div",{className:"blog-title"},o.createElement("div",{className:"base-info source"},o.createElement("span",{className:"source-img"},o.createElement(Xe.Z,{src:e.uimg?e.uimg.startsWith("http")?e.uimg:location.protocol+"//"+e.uimg:n(88958),defaultImg:n(88958)}))),o.createElement("span",{className:"base-info product"},a.username||"\u533f\u540d\u7528\u6237")),o.createElement("div",{className:"report_content"},o.createElement("div",{className:"report_text",id:"text_"+e.id,style:{maxHeight:0===i?u[e.id]?"unset":48:"unset"},dangerouslySetInnerHTML:{__html:Ke(a.content,t,a.opinionHighLightList,r)}})),Ue(a))})):null,!(null!=(h=e.nestedDetails)&&h.some((function(e){var t;return null==(t=e.aspects)?void 0:t.length})))&&Ue(e),g&&o.createElement("div",{className:"content_show_search",onClick:function(){var t;d((0,a.Z)({},u,((t={})[e.id]=!u[e.id],t)))}},u[e.id]?"\u6536\u8d77":"\u663e\u793a","\u5168\u6587")),o.createElement("div",{className:"message-detail"},o.createElement("div",null,o.createElement("span",{className:"line"},e.sourceName),o.createElement("span",{className:"ellipsis"},e.ticketId)),o.createElement("span",{className:"feedback",onClick:function(){return l(e)}},"\u53cd\u9988"),o.createElement(ze.Z,{ref:s})))})):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))};var at=n(21554);const it=function(e){var t=e.renderContent,n=e.data,i=n.title,r=n.content,s=n.commentId,l=n.opinionHighLightList,c=n.pictures,u=n.vimg,d=n.video,p=n.messageCategory,m=n.sourceId,f=e.tagHoverInfo,h=e.currentHighLight,g=o.useState(null),v=g[0],y=g[1],E=(0,o.useState)(!0),C=E[0],S=E[1],N=o.useState(!1),k=N[0],O=N[1],I=(0,o.useState)({isShowPreview:!1,sourcePicArr:[],startIndex:0}),b=I[0],T=I[1];return(0,o.useEffect)((function(){v&&function(){if(v.getElementsByTagName("img").length>0)var e=2,t=setInterval((function(){e>0?v&&v.scrollHeight>48?(O(!0),clearInterval(t)):e--:clearInterval(t)}),200);else v&&v.scrollHeight>48&&O(!0)}()}),[v]),o.createElement(o.Fragment,null,i&&o.createElement("h5",{className:"content_title"},i),o.createElement("div",{ref:function(e){return y(e)},className:"blog-body "+(C?"content_text":""),style:{maxHeight:C?48:"unset"},dangerouslySetInnerHTML:{__html:t(r,f.id===s&&h.length>0?[].concat(l,h):l,f.id===s&&f.type)}}),o.createElement(Pe.X,{className:"blog-footer"},(c||u)&&function(e){var t=e.pictures,n=e.vimg,i=e.video,r=(e.messageCategory,e.sourceId),s=[];try{s=JSON.parse(t),"1"===r&&s.forEach((function(e,t){return s[t]=e.replace(/s\d{2,3}x\d{2,3}/,"s960x960")})),"51"===r&&s.forEach((function(e,t){return s[t]=e.replace(/US\d{2,3}/,"US960")}))}catch(l){}return(n||s.length>0)&&o.createElement("div",{className:"picture_weibo"},n&&o.createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer"},o.createElement("span",{className:"video_cover",style:{backgroundImage:"url("+n+")"}},o.createElement("i",{className:"icon-shipinbofang"}))),s.length>0&&s.reduce((function(e,t,n){return n<9?[].concat(e,[o.createElement("img",{className:"pic_cover "+(s.length>9&&8===n?"pic_end":""),key:n,src:t,onClick:function(e){!function(e,t,n){var a=n.map((function(e){return{thumbnail:e,original:e}}));T({isShowPreview:!0,sourcePicArr:a,startIndex:t})}(0,n,s)}})]):e}),[]),o.createElement(at.Z,{startIndex:b.startIndex,images:b.sourcePicArr,closeDialog:function(){T((0,a.Z)({},b,{isShowPreview:!1}))},isShow:b.isShowPreview}))}({pictures:c,vimg:u,video:d,messageCategory:p,sourceId:m}),k&&o.createElement("div",{className:"content_search",onClick:function(){return S(!C)}},C?"\u663e\u793a\u5168\u6587":"\u6536\u8d77\u5168\u6587")))};F().locale("zh-cn");const rt=function(e){var t=e.getRef,a=(e.aspects,e.params),i=(e.isLoading,e.sourceEmotion,e.emotion,e.seriesName),r=e.data,s=(e.transformAsp,e.openItems,e.searchTable,e.onFeedback),l=e.getDrawerRef,c=e.lock,u=o.useState(null),d=u[0],p=(u[1],o.useState([])),m=p[0],f=p[1],h=o.useState({}),g=h[0],v=h[1],y=!1,E=function(e,t,n){var i=(0,O.Lh)(e||""),r=a.filterModel.content&&a.filterModel.content[0]&&a.filterModel.content[0].contain,s="aspect"===n?'<a class="highlight-green">':'<a class="highlight-red">';if(t){var o=i.split(""),l=t.map((function(e){return e&&"string"===typeof e&&((e=e.split("-"))[1]=Number(e[0])+Number(e[1])),e})).sort((function(e,t){return t[1]-e[1]}));l.forEach((function(e){(0,Ge.W5)(o,e,s)})),i=o.join("")}return r&&r.length>0&&r.forEach((function(e){var t=new RegExp(e,"g"),n='<a class="highlight-yellow">'+e+"</a>";i=i.replace(t,n)})),i},C=function(e){e&&(f(null==e?void 0:e.currentHighLight),v(null==e?void 0:e.tagHoverInfo))};T.Z.hasAuthority("REVIEW_MESSAGE_LOCK")||(c=!0);document.documentElement.clientWidth;return o.createElement("div",{ref:t,className:"message_list"},r.length>0?r.map((function(e,t){var a=e;return y=y||i.includes("\u6b63\u9762")||!c,o.createElement(Re.default,{spinning:d===e.commentId,key:a.commentId+t},o.createElement("div",{className:"blog-container "+(c?"lock":"unlock")},o.createElement(Pe.X,{className:"blog-title"},o.createElement(Pe.J,{className:"base-info source"},o.createElement("span",{className:"source-img"},o.createElement("img",{src:a.userImage?a.userImage.startsWith("http")?a.userImage:location.protocol+"//"+a.userImage:n(88958),"data-url":a.userImage,alt:"\u5934\u50cf"}))),o.createElement(Pe.J,{className:"base-info product"},a.username),o.createElement(Pe.J,{className:"base-info  pull-right"},!!e.oids&&"\u5929\u732b"===e.sourceName&&o.createElement("span",null,"\u8ba2\u5355\u7f16\u53f7:",o.createElement("span",{className:"copyValues",onClick:function(){return(0,O.zp)("copyValues")}},e.oids),o.createElement("i",{className:"icon-fuzhi",onClick:function(){return(0,O.zp)("copyValues")},style:{color:"#7262FD",cursor:"pointer",marginRight:"10px"}})),o.createElement("span",{className:"time"},F()(a.ctime).format("YYYY/MM/DD HH:mm")),o.createElement("span",{className:"type"},e.showDetailType))),o.createElement(it,{renderContent:E,data:a,tagHoverInfo:g,currentHighLight:m}),o.createElement(Pe.X,{className:"blog-comment-aspects"},o.createElement(Pe.J,null,Ue(a,C),o.createElement("div",{className:"source-block"},o.createElement("span",{className:"source line ellipsis"},"\u6765\u6e90\uff1a",a.sourceName),o.createElement("a",{href:a.url,target:"_blank",className:"icon-cem_data-source ellipsis",rel:"noreferrer"},"\u6570\u636e\u6e90"),o.createElement("span",{className:"feedback feed-back",onClick:function(){return s(a)}},"\u53cd\u9988"),o.createElement(ze.Z,{ref:l}))))))})):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))};var st;const ot=((st={})[He]=Qe,st[Be]=et,st[Je]=tt,st[Ye]=nt,st[qe]=rt,st);o.PureComponent;F().locale("zh-cn");var lt=[{title:"\u5bfc\u51fa\u6570\u636e",type:"excel"}],ct=function(e){function t(t){var i;return(i=e.call(this,t)||this).openItem=function(e,t){i.getAspects(),i.setState({openItem:i.state.openItem===e?null:e,emotion:t})},i.getPageTable=function(e){var t=i.state,n=t.info,a=t.isInitial;if(i.setState({isLoading:!0,pageIndex:e},(function(){return i.searchTable(n)})),!a)if(location.pathname.includes("opinion")){var r=document.getElementsByClassName("content-sidebar")&&document.getElementsByClassName("content-sidebar")[0];r&&(r.scrollTop=760)}else{var s=document.getElementsByClassName("content")&&document.getElementsByClassName("content")[0];s&&(s.scrollTop=620)}},i.searchTable=function(e){var t=i.state,n=t.params,r=t.pageSize,s=t.pageIndex,o=t.info,l=t.searchValue;if(n.filterModel.taskId||n.dateFilter){n.filterModel.aspect||(n.filterModel.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]});var c=i.props,u=c.params,d=(c.type,JSON.parse(JSON.stringify(n))),p=JSON.parse(JSON.stringify(u)),m=p.filterModel.aspect.emotion,h=[];1===m.length?h="positive"===m[0]?["\u6b63\u9762"]:["\u8d1f\u9762"]:2===m.length&&(h=["\u6b63\u9762","\u8d1f\u9762"]),i.setState({seriesName:h});var g="";if(!e||e.content)d=p,e&&void 0!==e.hide&&!1===e.hide?g=void 0:e&&e.content&&(g=e.content[0].contain[0]);else if(e.opinion)d.typicalOpinion=e.opinion,d.clusterLevel=e&&e.clusterType||20,d.taskId=p.taskId,e&&e.opinion&&(g=void 0);else if(e?e.type:o.type){if(d=p,"DAY"===(e?e.type:o.type))d.dateFilter.from=e?e.time:o.time,d.dateFilter.to=e?e.time:o.time;else if("WEEK"===(e?e.type:o.type)){var v=(o?o.time:e.time).split("-"),y=v[0],C=v[1],S=""+Number(y),N=F()(S).week(C);"first"===e.sideType?d.dateFilter.from=e.sideTime:d.dateFilter.from=N.startOf("week").format("YYYY-MM-DD"),"last"===e.sideType?d.dateFilter.to=e.sideTime:d.dateFilter.to=N.endOf("week").format("YYYY-MM-DD")}else if("MONTH"===(e?e.type:o.type)){var k=F()(e.time);"first"===e.sideType?d.dateFilter.from=e.sideTime:d.dateFilter.from=k.startOf("month").format("YYYY-MM-DD"),"last"===e.sideType?d.dateFilter.to=e.sideTime:d.dateFilter.to=k.endOf("month").format("YYYY-MM-DD")}i.setState({mParams:{from:d.dateFilter.from,to:d.dateFilter.to}}),d.dateFilter.dateGroupType=e?e.type:o.type,d.dateFilter.aspect_bar=!0}else e.analysis&&((d=p).filterModel.analysis=e.analysis);d.filterModel.project=[p.projectId],g=void 0===g?"":""===g?l:g;var O=[];d.filterModel.content&&d.filterModel.content[0]&&(O=d.filterModel.content[0].contain),d.filterModel.content=[{contain:[].concat(O,g?g.trim().split(" "):[]),queryType:"FUZZY_SEARCH"}],d.pageIndex=JSON.stringify(e)!==JSON.stringify(o)?1:s,d.pageSize=r,i.setState({listLoading:!0},(function(){return f.h.post("/inbox/aspect/detail/find",d).then((function(t){var n=t.data.result;if(n.messages){var r=n.messages.map((function(e){return(0,a.Z)({},e,{commentId:e.id})})).map((function(e){return Array.isArray(e.aspects)?e.aspects=i.cleanData(e.aspects):e.aspects=[],e}));"1"!==d.categoryId?i.setState({pageIndex:d.pageIndex,listLoading:!1,isLoading:!1,searchValue:g,info:e||void 0,data:r,params:d,count:{total:n.total,aspectTotal:n.aspectTotal},isInitial:!1}):f.h.post("feedback/find",{projectId:E.t.get(E.V.curProject).id,commentIds:r.map((function(e){return e.commentId}))}).then((function(t){T.Z.hasAuthority("MESSAGE_ORDER_NO")&&f.h.post("order/find",{projectId:E.t.get(E.V.curProject).id,messageIds:r.map((function(e){return e.oid}))}).then((function(e){var t=e.data,n=t.code,a=t.result;2e4===n&&a.length>0&&a.forEach((function(e,t){r[t].oids=e.oid}))})).catch((function(e){}));var a=t.data,s=a.code,o=a.result;2e4===s&&o&&(r.forEach((function(e){e.feedback=o.find((function(t){return t.commentId===e.commentId}))||{status:!1,count:0,modelTime:"",submitTypes:[]}})),setTimeout((function(){i.setState({pageIndex:d.pageIndex,listLoading:!1,isLoading:!1,searchValue:g,info:e||void 0,data:r,params:d,count:{total:n.total,aspectTotal:n.aspectTotal},isInitial:!1})}),1e3))}))}else i.setState({pageIndex:d.pageIndex,listLoading:!1,isLoading:!1,searchValue:g,info:e||void 0,data:r.map((function(e){return(0,a.Z)({},e,{commentId:e.id})})),params:(0,a.Z)({},d,{aspect:d.filterModel.opinion}),count:{total:n.total,aspectTotal:0},isInitial:!1})}))}))}},i.getAspects=function(e){var t=new FormData;t.append("widgetId","");var n=i.state.params.projectId;t.append("projectId",n),f.h.post("/inbox/aspect",t).then((function(e){var t=JSON.parse(e.data.result);i.setState({aspects:t,selectedIndex:Object.keys(t)[0]})}))},i.addAspect=function(e,t,n){i.setState({loadingId:e.commentId});var a=i.state,r=a.emotion,s=(a.data,a.info);f.h.post("inbox/messages/add",{commentId:e.commentId,index:e.index,routing:e.routing,score:r?8:3,aspect1:t,aspect2:n,flag:"aspect"}).then((function(e){i.searchTable(s),i.setState({loadingId:null})}))},i.deleteAsp=function(e,t){var n=t.aspectId,a=i.state,r=a.data,s=a.info;i.setState({loadingId:e.commentId}),f.h.post("inbox/messages/delete",{id:n,commentId:e.commentId,index:e.index,routing:e.routing,flag:"aspect",originScore:t.escore,aspectName:t.aspect2}).then((function(t){r.forEach((function(t){t.commentId===e.commentId&&t.aspects.forEach((function(e,a){e.aspectId===n&&t.aspects.splice(a,1)}))})),i.setState({data:r,loadingId:null},(function(){return i.searchTable(s)}))}))},i.transformAsp=function(e,t){var n=i.state,a=(n.emotion,n.data),r=n.info,s=a.filter((function(t){return t.commentId===e.commentId})),o=s[0].aspects?s[0].aspects.filter((function(e){return e.escore===(8===t.escore?3:8)})):[],l=8===t.escore?3:8;o.some((function(e){return e.aspect2===t.aspect2}))?p.Z.warning("\u6307\u6807\u5df2\u5b58\u5728"):(i.setState({loadingId:e.commentId}),f.h.post("inbox/messages/update",{id:t.aspectId,index:e.index,commentId:e.commentId,routing:e.routing,score:l,flag:"aspect",originScore:t.escore,aspectName:t.aspect2}).then((function(n){a.forEach((function(n){n.commentId===e.commentId&&n.aspects.forEach((function(e){e.aspectId===t.aspectId&&(e.escore=l)}))})),i.setState({data:a,loadingId:null},(function(){return i.searchTable(r)}))})))},i.selectChange=function(e){i.setState({selectedIndex:e})},i.renderExtend=function(e){var t=i.state,n=t.aspects,a=t.selectedIndex,r=t.emotion,s=t.isLoading,l=e.aspects.filter((function(e){return e.escore===(r?8:3)})).map((function(e){return e.aspect2}));return o.createElement(Pe.X,{className:"detail-extend"},o.createElement("div",null,o.createElement(d.Select,{value:i.state.selectedIndex,onChange:i.selectChange},n&&Object.keys(n).map((function(t,n){return o.createElement(d.Select.Option,{label:t,value:t,key:t+e.commentId})}))),o.createElement("i",{className:"icon-cem_delete close",onClick:function(){return i.openItem(e.commentId)}})),o.createElement("div",{className:r?"asp asp-positive":"asp asp-negative"},n&&n[a].filter((function(e){return-1===l.indexOf(e)})).map((function(t,n){return o.createElement("span",{key:n,style:{cursor:s?"not-allowed":""},onClick:function(){return s?"":i.addAspect(e,a,t)}},o.createElement("i",{className:"text"},t),o.createElement("i",{className:"hover-state"},o.createElement(Ve.l,{name:"add-to-white"})))}))))},i._handleFeedbackCountChange=function(e){i.setState({data:i.state.data.map((function(t){return t.feedback.commentId===e.commentId?(0,a.Z)({},t,{count:e.count,feedback:e}):(0,a.Z)({},t,{count:e.count,feedback:(0,a.Z)({},t.feedback,{count:e.count})})}))})},i._handleMsgClick=function(e){var t=i.props.params,n=t.dateFilter,a=t.leftName,r=t.projectId,s={dateFilter:n,filterModel:{project:[r]},projectId:r,msgId:e,filterTip:"\u4ea7\u54c1\u6d1e\u5bdf/"+(a||"\u5178\u578b\u610f\u89c1")+"/\u6d88\u606f\u8be6\u60c5"};window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(s)))},i.handleLock=function(e){i.setState({lock:!i.state.lock,openItem:null})},i.exportData=function(e){var t=JSON.parse(JSON.stringify(e));t.name=t.leftName,t.leftName="",f.h.post("/data/aspect/analysis/message/export",(0,a.Z)({},t)).then((function(e){var t=e.data;2e4===t.code?p.Z.success(t.msg+"\uff0c\u8bf7\u5230\u4e2a\u4eba\u4e2d\u5fc3\u7684\u4e0b\u8f7d\u5217\u8868\u6216\u8005\u70b9\u51fb\u53f3\u4e0a\u89d2\u201c\u5c0f\u94c3\u94db\u201d\u4e0b\u8f7d\u3002"):p.Z.error(t.msg)}))},i.handleReset=function(){i.setState({info:void 0},(function(){var e=i.props.params,t=JSON.parse(JSON.stringify(e));t.filterModel.project=[t.projectId];var n="\u6b63\u9762"===t.seriesName;i.setState({params:t,sourceEmotion:n,searchValue:""},(function(){return i.searchTable(i.info)}))})),i.props.resetMessage()},i.addAspectBorder=function(e){var t=document.querySelectorAll(".blog-foot")[e].children[0]&&document.querySelectorAll(".blog-foot")[e].children[0].children||[],n=document.querySelectorAll(".blog-foot")[e].children[1]&&document.querySelectorAll(".blog-foot")[e].children[1].children||[];if(t.length>0)for(var a=0;a<t.length;a++)t[a].style.borderColor="#00B76E";if(n.length>0)for(var i=0;i<n.length;i++)n[i].style.borderColor="#D96969"},i._handleOnInputChange=function(e){var t=i.state.info;i.setState({searchValue:e},(function(){!e&&i.state.hasSearched&&i.setState({hasSearched:!1},(function(){return i.searchTable(t||null)}))}))},i._handleSearchButtonClick=function(){var e=i.state,t=e.searchValue,n=e.params,a=e.info;a&&void 0!==a.hide&&delete a.hide,n.filterModel.content||t?i.setState({hasSearched:!0,pageIndex:1},(function(){return i.searchTable(a)})):p.Z.warning("\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u8bcd")},i._handleOnFeedback=function(e){var t=i.props.params,a=JSON.parse(JSON.stringify(t));i.drawerRef.show({aspectList:e.aspects,callback:function(t){f.h.post("/data_feedback/save",{feedbackDetails:t,messageId:e.commentId,projectId:a.projectId,messageContent:e.content,historyTag:JSON.stringify(e.aspects.filter((function(e){return e.escore})).map((function(e){return{aspect1:e.aspect1,aspect2:e.aspect2,aspect:e.aspect2,escore:e.escore,highLightInfoList:e.highLightInfoList}})))}).then((function(e){2e4===e.data.code&&Me.default.success({style:{marginTop:"85px"},className:"feedback_success_message",content:o.createElement("div",{className:"feedback_success_tip"},o.createElement("img",{src:n(43134)}),o.createElement("p",null,"\u6307\u6807\u53cd\u9988\u6210\u529f\uff0c\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01"))})}))}})},i.state={data:null,isLoading:!0,loadingId:null,info:void 0,searchValue:"",params:{},pageIndex:1,pageSize:20,count:{},sourceEmotion:null,emotion:"",lock:!0,listLoading:!1,aspects:null,selectedIndex:null,lastClickedTime:0,lastClickedMsgId:0,seriesName:[],hasSearched:!1,isInitial:!0,mParams:void 0},i}(0,i.Z)(t,e);var r=t.prototype;return r.cleanData=function(e){for(var t=[],n=function(n){t.some((function(t){return e[n].aspect1===t.aspect1&&e[n].aspect2===t.aspect2&&e[n].escore===t.escore}))||t.push(e[n])},a=0;a<e.length;a++)n(a);return t},r.renderContent=function(e,t,n){var a=this.state.params,i=a.filterModel.content&&a.filterModel.content[0]&&a.filterModel.content[0].contain;if(i&&i.length>0){var r=e;return i.forEach((function(e){var t=new RegExp(e,"g"),n='<a class="highlight-yellow">'+e+"</a>";r=r.replace(t,n)})),r}if(!t||!e)return e;var s=t.split(",").map((function(e){return(e=e.split("-"))[1]=Number(e[0])+Number(e[1]),e})).sort((function(e,t){return t[1]-e[1]})),o=e.split(""),l=n?'<a class="highlight-green">':'<a class="highlight-red">';return s.forEach((function(e){o.splice(e[0],0,l),o.splice(e[1]+1,0,"<a/>")})),o.join("")},r.componentWillMount=function(){var e=this.props.params,t=this.state.seriesName;if(e){var n=JSON.parse(JSON.stringify(e));n.filterModel.project=[n.projectId];var a="\u6b63\u9762"===n.seriesName;t.push(n.seriesName),this.setState({params:n,sourceEmotion:a,seriesName:t})}else this.setState({params:{},sourceEmotion:"",seriesName:""})},r.componentDidMount=function(){this.props.params&&this.searchTable(this.state.info)},r.UNSAFE_componentWillReceiveProps=function(e){var t=e.params,n=this.state.seriesName;if(t){var a=JSON.parse(JSON.stringify(t));a.filterModel.project=[a.projectId];var i="\u6b63\u9762"===a.seriesName;n.push(a.seriesName),this.setState({params:a,sourceEmotion:i,seriesName:n})}},r.removeAspectBorder=function(e){var t=document.querySelectorAll(".blog-foot")[e].children[0]&&document.querySelectorAll(".blog-foot")[e].children[0].children||[],n=document.querySelectorAll(".blog-foot")[e].children[1]&&document.querySelectorAll(".blog-foot")[e].children[1].children||[];if(t.length>0)for(var a=0;a<t.length;a++)t[a].style.borderColor="transparent";if(n.length>0)for(var i=0;i<n.length;i++)n[i].style.borderColor="transparent"},r.render=function(){var e=this,t=this.state,n=t.params,i=t.data,r=(t.isLoading,t.pageIndex),s=t.count,l=t.pageSize,c=t.info,u=t.searchValue,p=t.mParams,m=t.listLoading,f=ot[n.categoryId],h=this.props.type;this.state.lock;T.Z.hasAuthority("REVIEW_MESSAGE_LOCK");var g=!(!c||!c.opinion&&!c.hide),v="";if(p)v=p.from+" ~ "+p.to;else if(c){if(c.opinion)v=c.opinion;else if(c.content)v=c.content[0].contain[0];else if(c.time){var y=(0,O.LV)(c.time,"WEEK");v="WEEK"===c.type?y.from+" ~ "+y.to:n.dateFilter.from+" ~ "+n.dateFilter.to}}else n.dateFilter&&(v=n.dateFilter.from+" ~ "+n.dateFilter.to);return o.createElement("div",{className:"message-detail-wrapper"},o.createElement("div",{className:"message-top"},o.createElement("div",{className:"left"},o.createElement("span",{style:{marginLeft:5,fontSize:14}},"\u6d88\u606f\u8be6\u60c5"),v&&o.createElement("div",{style:{display:"inline-block"}},o.createElement("span",null,v),o.createElement("span",{onClick:this.handleReset},"\u6e05\u9664\u9009\u62e9"))),o.createElement("div",{className:"total"},4!==h||s.total&&!s.aspectTotal?o.createElement("span",null,"\u5171",o.createElement("i",null," ",s.total||0," "),"\u6761\u6d88\u606f"):o.createElement("span",null,"\u5171",o.createElement("i",null," ",s.total," "),"\u6761\u6d88\u606f\uff0c",o.createElement("i",null," ",s.aspectTotal," "),"\u4e2a\u3010",n.aspect,"\u3011",n.seriesName,"\u6307\u6807")),o.createElement("div",{className:"right"},o.createElement(d.Input,{value:u,disabled:g,className:"keyword-input-wrapper "+(g?"disable":""),onKeyDown:function(t){g||13!==t.keyCode||e._handleSearchButtonClick()},placeholder:"\u8bf7\u8f93\u5165\u5173\u952e\u8bcd",onChange:this._handleOnInputChange,append:o.createElement("i",{onClick:g?void 0:this._handleSearchButtonClick,className:"icon-cem_search "+(g?"disable":"")})}),o.createElement(ee.Z,{options:lt,onClick:function(t){return"excel"===t&&e.exportData(n)}}))),o.createElement(Re.default,{spinning:m,style:{minHeight:200}},i&&o.createElement(f,(0,a.Z)({},this.props,this.state,{getDrawerRef:function(t){e.drawerRef=t},deleteAsp:this.deleteAsp,transformAsp:this.transformAsp,openItems:this.openItem,searchTable:this.searchTable,onFeedback:this._handleOnFeedback}))),!!s.total&&o.createElement("div",{className:"pager-container"},o.createElement(d.Pagination,{pageSize:l,className:"pagination",small:!0,total:s.total,layout:"prev, pager, next",currentPage:r,onCurrentChange:this.getPageTable})))},t}(o.Component),ut=[{type:"sImage",title:"\u5bfc\u51fa\u56fe\u7247"},{type:"sExcel",title:"\u5bfc\u51fa\u6570\u636e"}],dt=[{type:"wImage",title:"\u5bfc\u51fa\u56fe\u7247"},{type:"wExcel",title:"\u5bfc\u51fa\u6570\u636e"}];const pt=function(e){var t=e.getScallterChartRef,a=e.getWordcloudChartRef,i=e.onChartClick,r=e.onMoreClick,s=e.onChartMouseOut,l=e.onChartMouseOver,c=e.wcLoading,u=e.loading,p=e.onWordcloudChartFinish,m=e.data,f=m.sOption,h=m.wOption,g=m.chartData;return o.createElement("div",{className:"opinion-chart-wrapper"},o.createElement("div",{className:"scatter"},o.createElement(d.Loading,{loading:c||u,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d",style:{height:"100%",width:"100%"}},g.wordAgeList&&g.wordAgeList.length>0?o.createElement(o.Fragment,null,o.createElement(ge.Z,{option:f,style:{height:"100%"},theme:"yunting_multi_color",onChartReady:t,onEvents:{mouseout:s,mouseover:l}}),o.createElement("div",{className:"tip"},o.createElement(d.Popover,{width:"376",trigger:"hover",content:"\u8be5\u56fe\u8868\u4e3a\u60a8\u663e\u793a\u9009\u4e2d\u7684\u6d88\u606f\u4e2d\u7684\u8bcd\u7684\u65b0\u65e7\u7a0b\u5ea6\u548c\u706b\u70ed\u7a0b\u5ea6\uff0c\u60a8\u53ef\u4ee5\u4ece\u4e2d\u66f4\u76f4\u89c2\u7684\u4e86\u89e3\u7528\u6237\u7684\u5173\u6ce8\u70b9\u7684\u51fa\u73b0\u65f6\u95f4\u548c\u5173\u6ce8\u7a0b\u5ea6\u3002\u57fa\u4e8e\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\uff0c\u7cfb\u7edf\u4f1a\u5bf9\u6d88\u606f\u8fdb\u884c\u5206\u8bcd\u5904\u7406\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5206\u51fa\u6765\u7684\u8bcd\uff0c\u7cfb\u7edf\u4f1a\u8ba1\u7b97\u5176\u7b2c\u4e00\u6b21\u5b58\u5728\u7cfb\u7edf\u4e2d\u7684\u65f6\u957f\u2014\u2014\u5373\u8bcd\u9f84\uff0c\u8bcd\u9f84\u53ef\u4ee5\u6807\u8bc6\u8be5\u8bcd\u7684\u65b0\u65e7\u7a0b\u5ea6\uff0c\u5c24\u5176\u662f\u8bcd\u9f84\u8f83\u5c0f\u7684\u8bcd\u4e00\u822c\u662f\u65b0\u521b\u5efa\u51fa\u6765\u7684\u8bcd\u6c47\u6216\u8005\u8fd1\u671f\u6d41\u884c\u7684\u8bcd\u6c47\u3002\u540c\u65f6\uff0c\u7cfb\u7edf\u4f1a\u7edf\u8ba1\u5177\u4f53\u8bcd\u51fa\u73b0\u7684\u6b21\u6570\u2014\u2014\u8bcd\u9891\uff0c\u8bcd\u9891\u53ef\u4ee5\u6807\u8bc6\u8be5\u8bcd\u7684\u706b\u70ed\u7a0b\u5ea6\u3002",popperClass:"card_pop"},o.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),o.createElement("div",{className:"buttons"},o.createElement(ee.Z,{onClick:r,options:ut}))):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))),o.createElement("div",{className:"wordcloud"},o.createElement(d.Loading,{loading:c||u,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d",style:{height:"100%",width:"100%"}},g.list&&g.list.length>0?o.createElement(o.Fragment,null,o.createElement(ge.Z,{option:h,style:{height:"100%",width:"100%"},theme:"yunting_multi_color",onChartReady:a,onEvents:{click:i,mouseout:s,mouseover:l,finished:p}}),o.createElement("div",{className:"buttons"},o.createElement(ee.Z,{onClick:r,options:dt}))):o.createElement("div",{className:"no-data"},o.createElement("img",{src:n(3381)}),o.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))))};var mt=["loading"],ft=be.Z.aspectDetail.detail,ht=function(e){function t(t){var n;return(n=e.call(this,t)||this)._resize=function(){n.scatterChartRef&&n.scatterChartRef.resize()},n._fetchData=function(){var e=n.props,t=e.detail,i=e.params;t&&t.projectId&&n.props.fetchWordData((0,a.Z)({projectId:t.projectId,taskId:t.taskId,filterType:"OPINION_TASK"},i))},n._handleOnMoreClick=function(e){var t=n.props.data.chartData;if("sImage"===e)(0,te._v)(n.scatterChartRef,"\u8bcd\u9f84-\u8bcd\u9891\u6563\u70b9\u56fe");else if("wImage"===e)(0,te._v)(n.wordcloudChartRef,"\u8bcd\u4e91\u56fe");else if("sExcel"===e){var a=t.wordAgeList.reduce((function(e,t){return[].concat(e,[[t.keyword,t.age,t.count]])}),[["\u8bcd\u540d","\u8bcd\u9f84","\u8bcd\u9891"]]);(0,te.aT)([a],"\u8bcd\u9f84-\u8bcd\u9891\u6563\u70b9\u56fe")}else if("wExcel"===e){var i=t.list.reduce((function(e,t){return[].concat(e,[[t.name,t.total]])}),[["\u8bcd\u540d","\u8bcd\u9891"]]);(0,te.aT)([i],"\u8bcd\u9f84-\u8bcd\u9891\u6563\u70b9\u56fe")}},n._handleOnChartClick=function(e){var t=e.componentType,a=e.componentSubType,i=e.data.name,r=n.state.selectedWordName,s=n.props.refreshMessage;if("series"===t&&"wordCloud"===a){var o=void 0;r&&r===i?n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",""):(o=i,n.dispatchEchartsAction(n.wordcloudChartRef,"highlight",""),n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",i)),n.setState({selectedWordName:o},(function(){i&&(n.clickTimeId&&clearInterval(n.clickTimeId),n.clickTimeId=setTimeout((function(){s({hide:!!o,content:[{contain:[o?i:""]}]}),n.clickTimeId=void 0}),100))}))}},n._handleOnChartMouseOut=function(e){var t=e.componentType,a=e.componentSubType,i=e.name,r=n.state.selectedWordName;"series"===t&&"wordCloud"===a?(n.dispatchTooltipAction(n.scatterChartRef,"hideTip",i),r&&r!==i&&n.dispatchEchartsAction(n.wordcloudChartRef,"highlight",i)):"series"===t&&"scatter"===a&&n.dispatchTooltipAction(n.wordcloudChartRef,"hideTip",i)},n._handleOnChartMouseOver=function(e){var t=e.componentType,a=e.componentSubType,i=e.name;"series"===t&&"wordCloud"===a?(n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",i),n.dispatchTooltipAction(n.scatterChartRef,"showTip",i),n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",i)):"series"===t&&"scatter"===a&&n.dispatchTooltipAction(n.wordcloudChartRef,"showTip",i)},n.reset=function(){var e=n.state.selectedWordName;e&&n._handleOnChartClick({componentType:"series",componentSubType:"wordCloud",data:{name:e}})},n.dispatchEchartsAction=function(e,t,n){setTimeout((function(){var a={type:t,seriesName:"opinionWordCloud"};n&&(a.name=n),e.dispatchAction(a)}),0)},n.dispatchTooltipAction=function(e,t,n){setTimeout((function(){e.dispatchAction({type:t,name:n,seriesIndex:0})}),0)},n._handleOnWordcloudChartFinish=function(){n.wcTimeoutId&&clearTimeout(n.wcTimeoutId),n.wcTimeoutId=setTimeout((function(){n.setState({wcLoading:!1}),n.wcTimeoutId=void 0}),100)},n.scatterChartRef=void 0,n.wordcloudChartRef=void 0,n.wcTimeoutId=void 0,n.event={onMoreClick:n._handleOnMoreClick,onChartClick:n._handleOnChartClick,onChartMouseOut:n._handleOnChartMouseOut,onChartMouseOver:n._handleOnChartMouseOver,onChartReady:n._handleOnChartReady,onWordcloudChartFinish:n._handleOnWordcloudChartFinish,getScallterChartRef:function(e){return n.scatterChartRef=e},getWordcloudChartRef:function(e){return n.wordcloudChartRef=e}},n.state={selectedWordName:void 0,wcLoading:!0,loading:!0},n}(0,i.Z)(t,e);var n=t.prototype;return n.clearLoading=function(){this.setState({wcLoading:!1,loading:!1})},n.startLoading=function(){this.setState({wcLoading:!0,loading:!0})},n.componentDidMount=function(){this._fetchData(),window.addEventListener("resize",this._resize)},n.componentWillUnmount=function(){var e=this.props.resetData;window.removeEventListener("resize",this._resize),e({topChartData:{chartData:[],sOption:{},wOption:{}}})},n.componentDidUpdate=function(e){if(e.fetchWordDataEffecting&&!this.props.fetchWordDataEffecting){var t=this.state.wcLoading,n=this.props.data.chartData,a=n.wordAgeList,i=n.list;this.setState({loading:!1,wcLoading:(0!==a.length||0!==i.length)&&t})}JSON.stringify(e.detail)!==JSON.stringify(this.props.detail)&&this._fetchData()},n.render=function(){return o.createElement(pt,(0,a.Z)({},this.state,this.props,this.event,this.ref))},t}(o.PureComponent);(0,ae.connect)((function(e){var t=e.loading;return{data:(0,X.Z)(e,mt)[ft].topChartData,fetchWordDataEffecting:t.effects[ft+"/fetchWordData"]||!1}}),(function(e){return{fetchWordData:function(t){return e({type:ft+"/fetchWordData",payload:t})},resetData:function(t){return e({type:ft+"/fetchWordData",payload:t})}}}),null,{withRef:!0})(ht);var gt=n(97911),vt=function(e){if(Array.isArray(e)){var t=[];return e.includes("\u6b63\u9762\u60c5\u611f")&&t.push("positive"),e.includes("\u8d1f\u9762\u60c5\u611f")&&t.push("negative"),t}return[]},yt=function(e){if(Array.isArray(e)){var t=[];return e.includes("positive")&&t.push("\u6b63\u9762\u60c5\u611f"),e.includes("negative")&&t.push("\u8d1f\u9762\u60c5\u611f"),t}return[]},Et=function(e){function t(t){var n;return(n=e.call(this,t)||this).changeState=function(e){n.setState(e,(function(){n.updateFilter()}))},n.clickCheckbox=function(e){var t=e.aspect1,a=e.aspect2,i=n.state.limit;i&&(t&&t.length>i||a&&a.length>i)?p.Z.warning("\u5f53\u524d\u6761\u4ef6\u4e0b\u6700\u591a\u652f\u6301\u9009\u62e9"+i+"\u4e2a\u5206\u6790\u6307\u6807"):n.setState(e)},n.clickEmotion=function(e){n.setState({emotion:e})},n.updateFilter=function(){var e=n.state.aspectType,t=n.state,a=t.aspect1,i=t.aspect2;e&&a&&a.length>0?i=[]:i.length>0&&(a=[]),n.setState({aspect1:a,aspect2:i})},n.clickCancelBtn=function(){n.state.aspectShow&&n.props.closePanel()},n.orderAspect=function(e){for(var t=n.state.aspectList,a=[],i=[],r=0;r<t.length;r++){for(var s=!1,o=0;o<e.length;o++)if(t[r].name===e[o]){s=!0,a[o]=t[r];break}s||i.push(t[r])}n.setState({aspectList:a.concat(i)})},n.toggleCheckAll=function(){var e=n.state,t=e.aspect2CheckStatus.allChecked,a=e.allAspect2,i=[];t||(i=JSON.parse(JSON.stringify(a))),n.setState({aspect2:i,aspect2CheckStatus:{allChecked:!t,indeterminate:!1}})},n.handleClickAspect2=function(e){var t=n.state.allAspect2;n.clickCheckbox({aspect2:e}),n.setState({aspect2CheckStatus:{allChecked:t.length===e.length&&e.length>0,indeterminate:0!==e.length&&t.length!==e.length}})},n.state={aspectShow:!1,aspectType:!0,aspect1:[],aspect2:[],emotion:[],rawAspectList:[],aspectList:[],projectId:t.projectId,model:t.model,ready:!1,limit:t.limit,panelWidth:t.panelWidth,allAspect2:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}},n}(0,i.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){var t=e.aspectShow,n=e.limit,a=e.panelWidth;this.setState({aspectShow:t,limit:n,panelWidth:a})},n.componentDidMount=function(){this.getValue(),window.addEventListener("click",this.clickCancelBtn)},n.componentDidUpdate=function(){this.setLeftBlockHeight()},n.componentWillUnmount=function(){window.removeEventListener("click",this.clickCancelBtn)},n.setLeftBlockHeight=function(){var e=document.querySelectorAll(".analyse-aspect-panel-body .left .new-checkbox-panel .wt-checkbox-group .wt-checkbox"),t=document.querySelectorAll(".analyse-aspect-panel-body .right .new-checkbox-panel .wt-checkbox-group"),n=document.querySelector(".analyse-aspect-panel-body .right");if(document.querySelector(".analyse-aspect-panel-body .emotion").style.height=n.offsetHeight+"px",e.forEach((function(e){return e.style.marginBottom="0"})),t.length>0)for(var a=t.length-1;a>=0;a--){var i=t[a].offsetHeight;i>36&&(e[a].style.marginBottom=i-36+"px")}},n.getValue=function(){var e=this.state,t=e.aspectType,n=e.aspect1,a=e.aspect2,i=e.emotion;if(e.ready)return{aspect1:t?n:[],aspect2:t?[]:a,emotion:vt(i)};var r=this.props,s=r.projectId,o=r.model;this.fetchAspects(s,o)},n.getSndIndex=function(e){var t=this.state.aspects[e];return t&&t.length>0&&this.setState({aspectType:!1,aspect1:[],aspect2:t}),t},n.setAspectFromOutside=function(e){var t=this.state.allAspect2,n=e.aspect1,i=e.aspect2,r=e.emotion;e&&this.setState((0,a.Z)({aspectType:n.length>0},e,{emotion:r&&yt(r),aspect2CheckStatus:{allChecked:t.length===i.length&&i.length>0,indeterminate:0!==i.length&&t.length!==i.length}}))},n.fetchAspects=function(e,t){var n=this,a=t.map((function(t){return f.h.post("filter/find",{filterTypes:["ASPECT"],projectId:e,type:t})}));Promise.all(a).then((function(a){a.forEach((function(a){var i=a.data.result,r=n.state.rawAspectList;i.aspect&&n.setState({projectId:e,model:t,rawAspectList:r.concat(i.aspect)})})),n.formatData()}))},n.formatData=function(){var e=this.state,t=e.model,n=e.aspect1,a=e.aspect2,i=e.rawAspectList,r=(e.limit,this.state),s=r.aspectShow,o=r.aspectType,l=i,c={};if("BRAND"===t){var u=l.map((function(e){return e&&JSON.parse(e)})),d=0,p=T.Z.getAuthority();if(p.indexOf("ANALYZE_PRODUCT")>=0&&d++,p.indexOf("ANALYZE_SERVER")>=0&&d++,p.indexOf("ANALYZE_MARKETING")>=0&&d++,0===d)u.forEach((function(e){Object.keys(e).forEach((function(e,t){return c[t]=e}))}));else if(1===d)["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].forEach((function(e,t){p.indexOf(e)>=0&&Object.keys(u[t]).map((function(e,t){return c[t]=e}))}));else if(d>1){if(p.indexOf("ANALYZE_PRODUCT")>=0){var m=Object.keys(u[0]);1===m.length?c["\u4ea7\u54c1"]=u[0][m[0]]:m.length>1&&(c["\u4ea7\u54c1"]=u[0])}if(p.indexOf("ANALYZE_SERVER")>=0){var f=Object.keys(u[1]);1===f.length?c["\u670d\u52a1"]=u[1][f[0]]:f.length>1&&(c["\u670d\u52a1"]=u[1])}if(p.indexOf("ANALYZE_MARKETING")>=0){var h=Object.keys(u[2]);1===h.length?c["\u5e02\u573a"]=u[2][h[0]]:h.length>1&&(c["\u5e02\u573a"]=u[2])}}}else l&&l[0]&&l.forEach((function(e){c=Object.assign.apply(Object,[c].concat(JSON.parse(e)))}));var g=Object.keys(c).map((function(e,t){var n=c[e];return{id:t,name:e,contain:n.length?n:Object.keys(n).map((function(e,t){var a=n[e];return{id:t,name:e,contain:a.length?a:Object.keys(a)}}))}}));g.length<=1&&(s=!1,o=!1);var v=[];Object.keys(c).forEach((function(e){v=v.concat(c[e])})),this.changeState({aspectList:g,aspectShow:s,aspects:c,aspectType:o,aspect1:n,aspect2:a,ready:!0,allAspect2:v})},n.handleClickBlock=function(e,t){var n=this.state,a=n.aspectType;if(n.aspectShow&&a!==e){var i=document.querySelectorAll(".analyse-aspect-panel-body div"),r="disabled";e?this.hanldeClass("remove",i[1],r):this.hanldeClass("remove",i[0],r),e?this.setState({aspectType:e,aspect2:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}}):this.setState({aspectType:e,aspect1:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}})}},n.hanldeClass=function(e,t,n){if("add"===e)(0,x.addClass)(t,n);else(0,x.removeClass)(t,n)},n.clickConfirmBtn=function(){this.props.onChange(),this.props.closePanel()},n.clearOptions=function(){this.setState({aspect1:[],aspect2:[],emotion:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}})},n.render=function(){var e=this,t=this.state,n=t.aspectList,a=t.aspectType,i=t.aspect1,r=t.aspect2,s=t.emotion,l=t.aspectShow,c=t.limit,u=t.panelWidth,p=t.aspect2CheckStatus,m=p.allChecked,f=p.indeterminate;return o.createElement("div",{className:"opinion-analyse-aspect-panel-wrapper",style:{display:l?"block":"none",width:u},onClick:function(e){return e.stopPropagation()}},o.createElement("div",{className:"analyse-aspect-panel-body"},o.createElement("div",{className:"emotion"},o.createElement(gt.Z,{changeState:function(t){return e.clickEmotion(t)},checkedList:s,ITEMS:["\u6b63\u9762\u60c5\u611f","\u8d1f\u9762\u60c5\u611f"].map((function(e){return e.name||e})),categoryTitle:"\u5168\u90e8\u60c5\u611f",type:"vertical"})),o.createElement("div",{className:a?"left":"left disabled",onClick:function(t){return e.handleClickBlock(!0,t)}},o.createElement(gt.Z,{changeState:function(t){return e.clickCheckbox({aspect1:t})},checkedList:i,ITEMS:n.map((function(e){return e.name||e})),categoryTitle:"\u4e00\u7ea7\u6307\u6807",type:"vertical",limit:c})),o.createElement("div",{className:a?"right disabled":"right",onClick:function(t){return e.handleClickBlock(!1,t)}},o.createElement("div",null,o.createElement(H.Jg,{checked:m,indeterminate:f,onChange:this.toggleCheckAll},"\u4e8c\u7ea7\u6307\u6807")),n.length>0&&n.map((function(t,n){return o.createElement(gt.Z,{changeState:e.handleClickAspect2,checkedList:JSON.parse(JSON.stringify(r)),key:"aspect1-"+n,categoryTitle:t.name,ITEMS:t.contain.map((function(e){return e.name||e})),type:"horizontal",limit:c})})))),o.createElement("div",{className:"analyse-aspect-panel-footer"},o.createElement("span",{onClick:function(){return e.clearOptions()}},"\u6e05\u7a7a\u5168\u90e8\u9009\u9879"),o.createElement("div",null,o.createElement(d.Button,{type:"primary",onClick:function(){return e.clickConfirmBtn()}},"\u786e\u5b9a"),o.createElement("span",{className:"cancelBtn",onClick:function(){return e.clickCancelBtn()}},"\u53d6\u6d88"))))},t}(o.Component),Ct=function(e){function t(t){var n;return(n=e.call(this,t)||this).closePanel=function(){n.setState({showPanel:!1})},n.state={showPanel:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.togglePanel=function(e){var t=this,n=this.state.showPanel;n&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){return t.setState({showPanel:!n})}),0)},n.getValue=function(){if(this.panel)return this.panel.getValue()},n.getSndIndex=function(e){return this.panel.getSndIndex(e)},n.setAspectFromOutside=function(e){return this.panel.setAspectFromOutside(e)},n.orderAspect=function(e){this.panel.orderAspect(e)},n.render=function(){var e=this,t=this.state.showPanel;return o.createElement("div",{className:"opinion-analyse-aspect-wrapper"},o.createElement("div",{className:"analyse-aspect-trigger",style:{color:t?"#0847A6":"#8C8C8C"},onClick:function(t){return e.togglePanel(t)}},o.createElement("span",null,"\u6307\u6807\u60c5\u611f"),o.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":"",color:t?"#0847A6":"#8C8C8C"}})),o.createElement(Et,(0,a.Z)({ref:function(t){e.panel=t},aspectShow:t,closePanel:this.closePanel},this.props)))},t}(o.Component),St=(o.PureComponent,n(55815)),Nt=be.Z.aspectDetail.detail,kt=be.Z.aspectDetail.opinionChart,Ot=function(e){if(Object.keys(e).length>0){var t=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach((function(e){t[e]||delete t[e]})),delete t.aspect,t}return{}},It=function(e){return e?{from:e.from,to:e.to,quickChoice:e.quickChoice,dateGroupType:e.dateGroupType,remoteName:e.remoteName}:null},bt=function(e){function t(t){var n;(n=e.call(this,t)||this).fetchOpinionDetail=function(e){var t=n.props.dispatch;t({type:kt+"/reset"});var i=E.t.get(E.V.curProject).id;f.h.post("/user/opinion/find",(0,a.Z)({},e)).then((function(e){var r=e.data;if(2e4===r.code){var s=r.result,o=s.id,l=s.name,c=(s.sequence,s.date),u=s.filter,d=s.messageTotal,p=s.opinionTotal,m=s.status;if(!c||!u)return n.opinionChart&&n.opinionChart.getWrappedInstance().clearLoading(),void t({type:kt+"/save",payload:{loading:!1}});u&&!u.aspect&&(u.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]});var f=function(e){if(e){var t=JSON.parse(JSON.stringify(e)),n=t.quickChoice;if(-1===t.quickChoice.indexOf("-")){var i=R.indexOf(n),r=Z(i),s=r[0],o=r[1];return(0,a.Z)({},t,{from:s,to:o})}return t}}(c),h={projectId:i,taskId:o||"",leftName:"",analyseName:"",type:"EMOTION_ASPECT_LEVEL_BAR",aspect:"",aspectTotal:d||0,seriesName:"",dateFilter:f,filterModel:u||{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}}};n.setState({type:2,params:h,detail:{projectId:i,taskId:o,taskName:window.location.host.substr(0,1).toUpperCase()+"-"+r.result.sequence},currOpinonObj:{id:o,name:l,messageTotal:d,opinionTotal:p,status:m,filter:{filterModel:u||{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:f},mode:o&&!l?"save":"rename"}},(function(){var e=p>=20&&d>=50&&d<=5e5&&"DISABLE"!==m,a=0;e||(p<20?a=1:d<50?a=2:d>5e5&&(a=3)),t({type:kt+"/save",payload:{opinionTaskValid:e,invalidReason:a,refreshing:e&&"FINISH"!==m,messageTotal:d,reloaded:e}}),e&&t({type:kt+"/resetClusterOptions"}),n.refreshData()}))}}))},n.createOpinionTask=function(e){var t=n.props.dispatch,i=n.state,r=(i.currOpinonObj,i.type),s=i.detail;t({type:kt+"/reset"}),4!==r&&s.taskId&&n.opinionChart&&n.opinionChart.getWrappedInstance().startLoading(),e.filterModel.aspect||(e.filterModel.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]}),f.h.post("/opinion/add",(0,a.Z)({projectId:E.t.get(E.V.curProject).id,filterType:"OPINION_TASK"},e,{filterModel:{treeId:e.filterModel.treeId},temp:4===r?"1":""})).then((function(i){if(2e4===i.data.code&&i.data.result){var o=n.state.currOpinonObj,l=i.data.result,c=l.id,u=l.messageTotal,d=l.opinionTotal,p=(l.name,l.sequence),m=l.status,f=l.filter,h=l.date,g=3===r?(0,a.Z)({},n.state.params,{taskId:c,filterModel:e.taskId?f:e.filterModel,dateFilter:e.taskId?h:e.dateFilter,aspectTotal:d}):(0,a.Z)({},n.state.params,{taskId:c});e.taskId&&(o.filter={filterModel:f,dateFilter:h}),n.setState({currOpinonObj:(0,a.Z)({},o,{status:m,id:c,sequence:p,messageTotal:u,opinionTotal:d}),params:g,detail:(0,a.Z)({},s,{taskId:c})},(function(){if(n.refreshData(!0),"FINISH"===m)return t({type:kt+"/save",payload:{opinionTaskValid:!0,invalidReason:0,refreshing:!1,clusterType:20,messageTotal:u,loading:!0}}),void setTimeout((function(){t({type:kt+"/getWordCloudList"})}),200);var e=d>=20&&u>=50&&u<=5e5&&"DISABLE"!==m,a=0;e||(d<20?a=1:u<50?a=2:u>5e5&&(a=3)),t({type:kt+"/save",payload:{opinionTaskValid:e,invalidReason:a,refreshing:e&&"FINISH"!==m,clusterType:20,messageTotal:u,loading:e&&"FINISH"!==m}})}))}}))},n.onFilterChange=function(){var e=n.state,t=e.currOpinonObj,i=e.params,r=e.type,s={filterModel:Ot(i.filterModel),dateFilter:It(i.dateFilter)};delete s.filterModel.aspect;var o=n.filter&&n.filter.getValue(),l=o.filterModel,c=o.dateFilter;if(!k(s,{filterModel:Ot(l),dateFilter:c})){t.changed=!0,t.mode=1===r?"save":"update";var u=i.filterModel.aspect;n.createOpinionTask({filterModel:(0,a.Z)({aspect:u},l),dateFilter:c}),i.dateFilter=c,i.filterModel=(0,a.Z)({aspect:u},l),t.filter={dateFilter:c,filterModel:(0,a.Z)({aspect:u},l)},n.setState({currOpinonObj:t,params:i})}},n.handleOnFilterReady=function(){},n.onAspectChange=function(e){var t=n.state,a=t.currOpinonObj,i=t.params,r=t.params,s=r.filterModel,o=r.dateFilter,l=t.type;if(!k(e,a.filter.filterModel.aspect)){var c=JSON.parse(JSON.stringify(s));c.aspect=e,a.changed=!0,a.mode=1===l?"save":"update",a.filter.filterModel=c,i.filterModel=c,n.createOpinionTask({filterModel:c,dateFilter:o}),n.setState({currOpinonObj:a,params:i})}},n.refreshData=function(e){var t=n.state,i=t.detail,r=t.params,s=t.type,o=n.props.dispatch;4!==s&&i.taskId&&o({type:Nt+"/fetchWordData",payload:(0,a.Z)({projectId:i.projectId,taskId:i.taskId,filterType:"OPINION_TASK"},r)}),4!==s&&!e&&o({type:kt+"/getWordCloudList"})},n.refreshMenuList=function(){return(0,n.props.dispatch)({type:"menu/fetchMenuList"})},n.updateCurrOpinonObj=function(e){var t=n.state.currOpinonObj;e?n.setState({currOpinonObj:e}):(t.mode="update",n.setState({currOpinonObj:t}))},n.handleTransformDate=function(e){if(e){var t=e.from,n=e.to,a=function(e){return e.split(" ")[0].replaceAll("-",".")};return a(t)+"-"+a(n)}},n.onEscoreChange=function(e){var t=n.state.params,i=t.filterModel,o=t.headerFilterParamsNew,l=t.dateFilter,c=t.categoryId,u=(0,s.Z)(i);u.aspect.emotion=[e],o.find((function(e){return"ASPECT_MODEL"===e.id})).values.find((function(e){return"ASPECT_ESCORE"===e.id})).values=[K.Ku[e]],n.setState({params:(0,a.Z)({},t,{filterModel:u,headerFilterParamsNew:o,aspectEscoreType:e,seriesName:K.o.find((function(t){return t.value===e})).title})},(function(){var e=n.props,t=e.chartState.storagedAspectDetails,a=e.dispatch,s=n.state.params,u=decodeURIComponent(window.location.search).split("?"),d=(u[0],u[1]),p=!1;if(t&&t.length){var m=t.find((function(e){var t=e.uri,n=e.escore;return(0,r.Z)({uri:t,escore:n},{uri:d,escore:s.aspectEscoreType})}));if(m){p=!0;var f=m.data[20];s.taskId=m.taskId,a({type:kt+"/save",payload:{hasRecord:!0,allData:m.data,json_word:f,loading:!1,opinionTaskValid:!0}})}}n.setState({params:s},(function(){p?n.message.searchTable():(n.message.searchTable(null),n.createOpinionTask({filterModel:i,dateFilter:l,headerFilterParamsNew:o,categoryId:c}),a({type:kt+"/save",payload:{loading:!0}}))}))}))};var i=4,o=location.pathname;return o.startsWith("/opinion")&&(i=3===o.split("/").length?2:location.search?3:1),n.state={params:{analyseName:"",aspect:"",aspectTotal:0,leftName:"",projectId:E.t.get(E.V.curProject)&&E.t.get(E.V.curProject).id||"",seriesName:"",taskId:"",type:"EMOTION_ASPECT_LEVEL_BAR",filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},detail:{projectId:"",taskId:"",taskName:""},type:i,currOpinonObj:{id:"",name:"",status:status,filter:{filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},messageTotal:0,opinionTotal:0,changed:!1,mode:"update"}},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=E.t.get(E.V.curProject).id,n=decodeURIComponent(window.location.search).substr(1),a=location.pathname;if(a.startsWith("/opinion"))if(3===a.split("/").length){var i=a.split("/")[2];this.fetchOpinionDetail({id:i})}else{var r=location.search;if(location.search){var s=r.indexOf("id=")+3,o=r.indexOf("&"),l=r.substring(s,o),c=this.state.currOpinonObj;c.changed=!0,this.setState({type:3,currOpinonObj:c},(function(){return e.createOpinionTask({taskId:l,filterModel:{},dateFilter:{}})}))}else this.fetchOpinionDetail({projectId:t})}else{var u=this.props.dispatch,d=JSON.parse(n),p=d.filterModel,m=d.dateFilter,f=d.headerFilterParamsNew,h=d.categoryId,g=!1,v=E.t.get(E.V.opinionDetail);if(v&&v.uri&&v.uri===n){g=!0;var y=E.t.get(E.V.opinionDetail),C=y.data[20];d.taskId=y.taskId,u({type:kt+"/save",payload:{hasRecord:!0,allData:y.data,json_word:C,loading:!1}})}this.setState({params:d,type:4},(function(){g?e.message.searchTable():(e.createOpinionTask({filterModel:p,dateFilter:m,headerFilterParamsNew:f,categoryId:h}),u({type:kt+"/save",payload:{loading:!0}}))}))}},n.render=function(){var e=this,t=this.state,n=t.params,a=(t.detail,t.currOpinonObj),i=t.currOpinonObj,r=(i.messageTotal,i.opinionTotal,i.filter,i.filter.filterModel.aspect,t.type),s=this.props.chartState.loading;n&&n.filterModel,n&&n.dateFilter;return o.createElement("div",{className:"detail-wrapper"},4===r&&o.createElement(St.Z,{title:"\u8be6\u60c5\uff1a"+n.analyseName+"\uff0c"+n.aspect+"\uff0c\n            "+n.seriesName+"\uff0c"+this.handleTransformDate(n.dateFilter),rightContent:o.createElement("span",{className:"clustering"},o.createElement("span",null,"\u6307\u6807\u60c5\u611f\uff1a"),o.createElement(ne.Z,{activeObj:n.aspectEscoreType,onChange:this.onEscoreChange,options:K.o,enable:!s}))}),o.createElement("div",{className:4!==r?"content-sidebar":"content"},o.createElement(Fe,{params:n,taskId:a&&a.id||n.taskId,ref:function(t){return e.detailChart=t},type:r,refreshMessage:function(t){e.opinionChart&&e.opinionChart.getWrappedInstance().reset(),e.message&&e.message.searchTable(t)}}),(null==n?void 0:n.categoryId)&&o.createElement(ct,{params:n,ref:function(t){return e.message=t},resetMessage:function(){e.detailChart&&e.detailChart.getWrappedInstance().resetWordcloudState(),e.detailChart&&e.detailChart.getWrappedInstance().resetBarchartState(),e.opinionChart&&e.opinionChart.getWrappedInstance().reset()},type:r})))},t}(o.Component);const Tt=(0,ae.connect)((function(e){return{chartState:e[kt]}}))(bt)},36025:(e,t,n)=>{n.d(t,{Nm:()=>r,o:()=>s,Ku:()=>o,hj:()=>c});var a=n(87462),i=n(35239),r=function(e){var t=(JSON.parse(i.t.get(i.V.filterList))||{list:[]}).list;return Object.keys(e).reduce((function(n,i){var r=e[i],s=Object.prototype.toString.call(r);if("[object Array]"===s){var o=r[0],l=Object.prototype.toString.call(o);if("[object String]"===l){var c,u=t.find((function(e){return e.id===i}));return u?(0,a.Z)({},n,((c={})[u.name]=r.map((function(e){return u.values.find((function(t){return t.id===e})).name})).join("\uff0c"),c)):n}if("[object Object]"===l)return(0,a.Z)({},n,r.reduce((function(e,n){var i,r=t.find((function(e){return e.id===n.id}));return r?(0,a.Z)({},e,((i={})[r.name]=n.values.reduce((function(e,t){var n=r.values.find((function(e){return e.id===t}));return n?[].concat(e,[n.name]):e}),[]).join("\uff0c"),i)):e}),{}))}else if("[object Object]"===s){var d,p=t.find((function(e){return e.id===r.id}));return p?(0,a.Z)({},n,((d={})[p.name]=r.values.reduce((function(e,t){var n=p.values.find((function(e){return e.id===t}));return n?[].concat(e,[n.name]):e}),[]).join("\uff0c"),d)):n}return n}),{})},s=[{title:"\u6b63\u9762",value:"positive"},{title:"\u8d1f\u9762",value:"negative"}],o={positive:"8",negative:"3"},l={"9b3298db87a4405d9c093ce8f1a75d0a":"\u5173\u952e\u5b57"},c=function(e){var t=l[i.t.get(i.V.curProject).id];return"\u578b\u53f7"===e&&t?t:e}},1374:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294);const i=function(e){var t=e.src,n=e.defaultImg,i=e.timeoutTime,r=void 0===i?1e3:i,s=(0,a.useState)(t),o=s[0],l=s[1];return(0,a.useEffect)((function(){var e=new Image;e.src=t;var a=setTimeout((function(){l(n),e.onerror=null}),r);return e.onload=function(n){e.onload=null,clearTimeout(a),l(t)},e.onerror=function(t){e.onerror=null,clearTimeout(a),l(n)},function(){clearTimeout(a)}}),[t]),a.createElement("img",{src:o,alt:""})}},21554:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),i=n(67294),r=n(45697),s=n.n(r),o=n(92360),l=n(66982),c=n.n(l),u=function(e){function t(t){return e.call(this,t)||this}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.render=function(){var e=this.props,t=e.images,n=e.isShow,a=e.startIndex,r=e.closeDialog;return i.createElement(o.Dialog,{visible:n,className:"imgpreview-dialog",onCancel:r,lockScroll:!1},i.createElement(o.Dialog.Body,null,i.createElement(c(),{items:t,startIndex:a})))},t}(i.Component);u.propTypes={images:s().array.isRequired,isShow:s().bool.isRequired,closeDialog:s().func.isRequired,startIndex:s().number.isRequired}},49845:(e,t,n)=>{e.exports=n.p+"img/efa6ed59795721e67957.png"}}]);