"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8481],{8481:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var l=a(87462),n=a(94578),i=a(67294),s=a(92360),r=a(5133),c=a(35108),o=a(49722),m=a(19586),d=a(35239),u=a(97189),h=a(21694),g=function(e){function t(t){var a;return(a=e.call(this,t)||this).fetchData=function(e){var t=e?"data/price/chart/export":"/price/list/monitors/all/v2",n=d.t.get(d.V.curProject).id;e||a.setState({loading:!0});var i=a.filter.getValue();o.h.post(t,(0,l.Z)({type:"ALL",id:n},i)).then((function(t){if(200===t.status||304===t.status)if(e)r.Z.success("\u64cd\u4f5c\u6210\u529f\uff0c\u8bf7\u5230\u4e2a\u4eba\u4e2d\u5fc3\u7684\u4e0b\u8f7d\u5217\u8868\u6216\u8005\u70b9\u51fb\u53f3\u4e0a\u89d2\u201c\u5c0f\u94c3\u94db\u201d\u4e0b\u8f7d\u3002");else{var l=t.data.result;a.setState({platforms:l.part1,goods:l.part2.data,firstColumnName:l.part2.topic3Name,loading:!1},(function(){return a.formatData()}))}})).catch((function(e){return r.Z.error(e.toString())}))},a.formatData=function(){for(var e=a.state.goods,t=0;t<e.length;t++){e[t].noStockCityList=[];var l=e[t].cityStockModelList;if(l&&l.length>0)for(var n=l.filter((function(e){return"\u65e0\u8d27"===e.stockState})).map((function(e){return e.city})),i=0;i<n.length;i++)for(var s=0;s<h.Q1.length;s++)h.Q1[i].fullName===n[i]&&e[t].noStockCityList.push(h.Q1[s].simplifiedName)}a.setState({goods:e})},a.refreshTable=function(){a.setState({goods:[],columnWidth:[],isFirst:!1},(function(){return a.fetchData(!1)}))},a.getTableWidth=function(){var e=a.state,t=e.tableWidth,l=e.tableHeight;t=document.getElementsByClassName("mainContent")[0].clientWidth-48,l=document.documentElement.clientHeight-46-48-48-30,a.setState({tableWidth:t,tableHeight:l})},a.onScrollEnd=function(){for(var e=a.state.activeIndex,t=document.getElementsByClassName("Htag"),l=document.getElementsByClassName("Mtag"),n=t.length-1;n>=0;n--)t[n].style.display=e.indexOf(2)>-1?"block":"none";for(var i=l.length-1;i>=0;i--)l[i].style.display=e.indexOf(3)>-1?"block":"none";return!0},a.onColumnResizeEndCallback=function(e,t){var l=a.state.columnWidth;l[t]=e,a.setState({columnWidth:l})},a.onRowClick=function(e){e!==a.state.highlightedRowIndex&&a.setState({highlightedRowIndex:e})},a.handleClass=function(e,t){var a;switch(e){case"upFlag":a="increasing";break;case"downFlag":a="decreasing";break;case"maxFlag":a="maximumPrice";break;case"minFlag":a="minimumPrice"}for(var l=document.querySelectorAll("."+e),n=l.length-1;n>=0;n--)"add"===t?(0,u.addClass)(l[n],a):(0,u.removeClass)(l[n],a);var i=document.getElementsByClassName("Htag"),s=document.getElementsByClassName("Mtag");if("maxFlag"===e)for(var r=i.length-1;r>=0;r--)i[r].style.display="add"===t?"block":"none";if("minFlag"===e)for(var c=s.length-1;c>=0;c--)s[c].style.display="add"===t?"block":"none"},a._handleOnFilterReady=function(){a.fetchData(!1),a.setState({isFirst:"default"===a.filter.state.filterObj.id})},a.state={loading:!1,isFirst:!0,platforms:[],goods:[],firstColumnName:"",columnWidth:[],tableWidth:0,tableHeight:0,pageIndex:1,pageSize:20,activeIndex:[0,1],highlightedRowIndex:-1},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.getTableWidth(),window.addEventListener("resize",this.getTableWidth)},a.UNSAFE_componentWillUpdate=function(e,t){var a=t.activeIndex;if(a.indexOf(2)>-1)for(var l=document.getElementsByClassName("Htag"),n=l.length-1;n>=0;n--)l[n].style.display="block";if(a.indexOf(3)>-1)for(var i=document.getElementsByClassName("Mtag"),s=i.length-1;s>=0;s--)i[s].style.display="block"},a.componentWillUnmount=function(){window.removeEventListener("resize",this.getTableWidth)},a.clickTableLegend=function(e){var t=this.state.activeIndex,a=document.querySelectorAll(".item")[e].children[0];if(-1===t.indexOf(e))switch(t.push(e),e){case 0:a.className+=" green",this.handleClass("upFlag","add");break;case 1:a.className+=" red",this.handleClass("downFlag","add");break;case 2:a.className+=" yellowTriangle",this.handleClass("maxFlag","add");break;case 3:a.className+=" blueTriangle",this.handleClass("minFlag","add")}else{var l=t.indexOf(e);switch(t.splice(l,1),e){case 0:a.className="square",this.handleClass("upFlag","remove");break;case 1:a.className="square",this.handleClass("downFlag","remove");break;case 2:a.className="triangle",this.handleClass("maxFlag","remove");break;case 3:a.className="triangle",this.handleClass("minFlag","remove")}}},a.render=function(){var e=this,t=this.state,a=t.loading,l=t.isFirst,n=t.platforms,r=t.goods,o=t.firstColumnName,d=t.columnWidth,u=t.tableWidth,h=t.tableHeight,g=t.activeIndex;return i.createElement("div",{className:"chartWrapper"},i.createElement(m.Z,{ref:function(t){return e.filter=t},showList:["condition","save"],defaultShow:"condition",filterCondition:{filter:["CONN_CONFIG","SOURCE","TAG"]},model:"PRICE_MONITOR_CHART",onChange:this.refreshTable,onFilterReady:this._handleOnFilterReady}),i.createElement(s.Loading,{loading:a},l?i.createElement("div",{className:"noFiltersTip"},"\u8bf7\u5148\u9009\u62e9\u7b5b\u9009\u6761\u4ef6"):i.createElement("div",{className:"body"},i.createElement("div",{className:"operation"},i.createElement("ul",{className:"desc"},i.createElement("li",{className:"item",onClick:function(){return e.clickTableLegend(0)}},i.createElement("div",{className:"square green"}),i.createElement("span",null,"\u6da8\u4ef7")),i.createElement("li",{className:"item",onClick:function(){return e.clickTableLegend(1)}},i.createElement("div",{className:"square red"}),i.createElement("span",null,"\u964d\u4ef7")),i.createElement("li",{className:"item",onClick:function(){return e.clickTableLegend(2)}},i.createElement("div",{className:"triangle"}),i.createElement("span",null,"\u6700\u9ad8\u4ef7")),i.createElement("li",{className:"item",onClick:function(){return e.clickTableLegend(3)}},i.createElement("div",{className:"triangle"}),i.createElement("span",null,"\u6700\u4f4e\u4ef7"))),r.length>0&&i.createElement("span",{className:"downloadBtn",onClick:function(){return e.fetchData(!0)}},i.createElement("i",{className:"cem-icon icon-cem_download"}),"\u4e0b\u8f7d")),r.length>0?i.createElement("div",{className:"priceMonitorTableWrapper"},i.createElement(c.Table,{ref:function(t){return e.table=t},rowHeight:24,rowsCount:r.length,groupHeaderHeight:24,headerHeight:24,width:u,height:h,onRowClick:function(t,a){return e.onRowClick(a)},onScrollEnd:this.onScrollEnd,onColumnResizeEndCallback:this.onColumnResizeEndCallback,isColumnResizing:!1},i.createElement(c.ColumnGroup,{fixed:!0},i.createElement(c.Column,{allowCellsRecycling:!0,fixed:!0,header:i.createElement("div",{className:"customizedCell headerCell",title:o},o),cell:function(e){var t=e.rowIndex;return i.createElement("div",{className:"customizedCell",style:{textAlign:"left"},title:r[t].topic3Value},r[t].topic3Value)},columnKey:0,flexGrow:1,width:d[0]||150,isResizable:!0})),n.map((function(e,t){for(var a=e.topic2Values,l=0,s=0;s<n.length;s++)s<t&&(l+=n[s].topic2Values.length);return i.createElement(c.ColumnGroup,{key:t,header:i.createElement("div",{className:"customizedCell headerCell"},e.topic1Value)},a.map((function(e,t){var a=l+t;return i.createElement(c.Column,{header:i.createElement("div",{className:"customizedCell headerCell",title:e},e),cell:function(e){var t=e.rowIndex,l=r[t].detail[a],n="customizedCell";if(l){switch(l.flag){case 0:default:break;case 1:n+=" upFlag",g.indexOf(0)>-1&&(n+=" increasing");break;case 2:n+=" downFlag",g.indexOf(1)>-1&&(n+=" decreasing")}l.max&&(n+=" maxFlag",g.indexOf(2)>-1&&(n+=" maximumPrice")),l.min&&(n+=" minFlag",g.indexOf(3)>-1&&(n+=" minimumPrice"))}return i.createElement("div",{className:n},l?l.noStockCityList&&l.noStockCityList.length>0?l.noStockCityList.join("").concat("\u7f3a\u8d27"):l.price:"-",l?i.createElement("span",{className:l.max?"Htag":l.min?"Mtag":""},l.max?"H":l.min?"M":""):null)},flexGrow:1,width:d[a+1]||150,key:t,columnKey:a+1,isResizable:!0,allowCellsRecycling:!0,pureRendering:!0})})))})))):i.createElement("div",{className:"noDataTip"},"\u6682\u65e0\u6570\u636e"))))},t}(i.Component)},21694:(e,t,a)=>{a.d(t,{U7:()=>l,QQ:()=>n,Se:()=>i,Q1:()=>s});var l=[{title:"\u4ef7\u683c\u4e0a\u5347",value:"UP"},{title:"\u4ef7\u683c\u4e0b\u964d",value:"DOWN"},{title:"\u5168\u90e8",value:"ALL"}],n=[{title:"1\u5c0f\u65f6\u5185",value:1},{title:"2\u5c0f\u65f6\u5185",value:2},{title:"4\u5c0f\u65f6\u5185",value:4},{title:"12\u5c0f\u65f6\u5185",value:12},{title:"\u5f53\u5929",value:0}],i=[{title:"\u5df2\u66f4\u65b0",value:"UPDATED"},{title:"\u672a\u66f4\u65b0",value:"UN_UPDATED"},{title:"\u624b\u52a8\u66f4\u65b0\u4e2d",value:"UPDATING"},{title:"\u5168\u90e8",value:"ALL"}],s=[{fullName:"\u5317\u4eac",simplifiedName:"\u4eac"},{fullName:"\u4e0a\u6d77",simplifiedName:"\u6caa"},{fullName:"\u5e7f\u5dde",simplifiedName:"\u7a57"},{fullName:"\u6df1\u5733",simplifiedName:"\u6df1"}]}}]);