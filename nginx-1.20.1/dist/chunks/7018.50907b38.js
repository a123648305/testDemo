"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[7018],{7018:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var n=i(94578),o=i(67294),a=i(92360),l=i(5133),r=i(49722),s=i(61193),c=function(e){function t(){var t;return(t=e.call(this)||this).uploadExcel=function(e){t.state.uploadLink="excel/import",t.refs.uploadInput.click()},t.uploadBzy=function(e){t.refs.uploadBzyInput.click()},t.showDialog=function(e){t.setState({dialogVisible:!0})},t.reset=function(e){t.setState({dialogVisible:!1,projectId:""})},t.onChange=function(e){t.setState({projectId:e})},t.exportExcel=function(e){var i=t.state.projectId;r.h.post("/excel/connection/export",{projectId:i}).then((function(e){var t=e.data;if(2e4===t.code){var i=document.createElement("a");i.href=t.result,i.click()}else l.Z.error(t.msg)})),t.setState({dialogVisible:!1})},t.sendFile=function(e){var i=new FormData;i.append("file",e.target.files[0]),i.append("projectId",t.state.selProject.id),e.target.value="",r.v.post(t.state.uploadLink,i,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){l.Z.success(e.data.result)})),t.setState({projectDialogVisible:!1})},t.sendBzyFile=function(e){var t=new FormData;t.append("file",e.target.files[0]),e.target.value="",r.v.post("excel/bzy_task/import",t,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){l.Z.success(e.data.result)}))},t.closeProjectDialog=function(e){t.setState({projectDialogVisible:!1})},t.importComment=function(e){null==t.state.selProject.id?l.Z.error("\u8bf7\u9009\u62e9\u5bfc\u5165\u8bc4\u8bba\u7684\u9879\u76ee\uff01"):(t.state.uploadLink="excel/import/comment",t.refs.uploadInput.click())},t.selectProject=function(e){t.setState({selProject:{id:e}})},t.state={dialogVisible:!1,projectId:"",projectDialogVisible:!1,projectList:[],selProject:{},upload:"excel/import"},t}(0,n.Z)(t,e);var i=t.prototype;return i.componentDidMount=function(){var e=this;r.h.post("projects/list").then((function(t){e.state.projectList=t.data.result.list}))},i.render=function(){var e=this,t=this.state.dialogVisible;return o.createElement("div",{style:{marginTop:"20px"}},o.createElement("input",{type:"file",ref:"uploadInput",hidden:!0,onChange:this.sendFile}),o.createElement("input",{type:"file",ref:"uploadBzyInput",hidden:!0,onChange:this.sendBzyFile}),s.Z.hasAuthority("PROJECT_EDIT")&&o.createElement(a.Button,{type:"primary",onClick:this.uploadBzy,className:"excel-btn"},"+ \xa0\xa0\u516b\u722a\u9c7c\u5bfc\u5165\u94fe\u63a5"),s.Z.hasAuthority("PROJECT_EDIT")&&o.createElement(a.Button,{type:"primary",onClick:this.uploadExcel,className:"excel-btn"},"+ \xa0\xa0Excel\u5bfc\u5165\u94fe\u63a5"),s.Z.hasAuthority("PROJECT_EDIT")&&o.createElement(a.Button,{type:"primary",onClick:this.showDialog,className:"excel-btn"},"+ \xa0\xa0\u5bfc\u51fa\u9879\u76ee\u94fe\u63a5"),s.Z.hasAuthority("PROJECT_EDIT")&&o.createElement(a.Button,{type:"primary",onClick:function(t){e.setState({projectDialogVisible:!0})},className:"excel-btn"},"+ \xa0\xa0\u5bfc\u5165\u8bc4\u8bba"),o.createElement(a.Dialog,{title:"\u9009\u62e9\u9879\u76ee",size:"400",visible:this.state.projectDialogVisible,onCancel:this.closeProjectDialog.bind(this)},o.createElement(a.Dialog.Body,null,o.createElement(a.Select,{value:this.state.selProject.id,placeholder:"\u5168\u90e8",onChange:this.selectProject},this.state.projectList.map((function(e,t){return o.createElement(a.Select.Option,{key:t,label:e.name,value:e.id},e.name)})))),o.createElement(a.Dialog.Footer,{className:"dialog-footer"},o.createElement(a.Button,{onClick:this.closeProjectDialog.bind(this)},"\u53d6 \u6d88"),o.createElement(a.Button,{type:"primary",onClick:this.importComment},"\u786e \u5b9a"))),o.createElement(a.Dialog,{title:"\u8f93\u5165\u9879\u76eeId",size:"tiny",visible:t,onCancel:this.reset.bind(this)},o.createElement(a.Dialog.Body,null,o.createElement(a.Form,null,o.createElement(a.Form.Item,{label:"\u9879\u76eeId"},o.createElement(a.Input,{placeholder:"\u8bf7\u8f93\u5165\u9879\u76eeId",type:"text",onChange:this.onChange.bind(this)})))),o.createElement(a.Dialog.Footer,{className:"dialog-footer"},o.createElement(a.Button,{onClick:this.reset.bind(this)},"\u53d6 \u6d88"),o.createElement(a.Button,{type:"primary",onClick:this.exportExcel},"\u786e \u5b9a"))))},t}(o.Component)}}]);