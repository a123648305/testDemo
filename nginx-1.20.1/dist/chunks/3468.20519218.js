"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3468],{48850:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var a=n(63366),i=n(87462),s=n(94578),o=n(67294),r=n(61918),c=n(43036),l=n(53754),u=n(61409),p=n(92360),d=n(43144),m=n(2271),h=n(60496),f=n(17190);const g=function(e){var t=e.data,n=e.detailList,a=e.onChooseSpu,i=e.onChooseSku,s=e.keywordSku,r=e.keywordSpu;return o.createElement("div",{className:"product_setting_edit_left_wrap"},o.createElement("div",{className:"top"},o.createElement(c.Z,{overlay:o.createElement("div",{style:{maxWidth:260},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},onMouseUp:function(){s&&document.querySelector(".product_setting_edit_left_wrap")&&document.querySelector(".product_setting_edit_left_wrap").click(),s&&i(""),a(window.getSelection().toString().trim())}},t.name),placement:"top"},o.createElement("div",{className:"setting_name_wrap"},o.createElement("div",{className:"title",onClick:function(){window.open(""+t.url)}},t.name))),o.createElement("div",{className:"content_item"},n.map((function(e){return o.createElement("div",{className:"product",key:e.id},o.createElement("span",null,e.name),o.createElement("div",{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},e.values.map((function(e,t){return o.createElement("span",{key:e.name,onMouseUp:function(){r&&document.querySelector(".product_setting_edit_left_wrap")&&document.querySelector(".product_setting_edit_left_wrap").click(),r&&a(""),i(window.getSelection().toString().trim())},className:(0===t&&"checked")+" "+(e.offShelf&&"closed")},e.name)}))))})))))};var k=n(35303),v=n(29257),y=n(35239);const S=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnSelectChange=function(e,t,a){var i;if(e&&e.length){var s,o=e[e.length-1];if(n.state["topicValue"+t].find((function(e){return e.value===o})))n.setState(((s={})["value"+a.id]=[o],s["id"+a.id]=n.state["topicValue"+t].find((function(e){return e.value===o})).id,s));else n.props.fetchAddTopicValue({value:o,topicId:a.id}).then((function(e){var t;2e4===e.code&&n.setState(((t={})["value"+a.id]=[o],t["id"+a.id]=e.result,t))}))}!e.length&&n.setState(((i={})["value"+a.id]=void 0,i))},n.getValue=function(){var e=n.state,t=e.spu,a=e.sku,i=e.spuName,s=e.skuName,o=e.topicList,r=e.packageType,c=[];return o.forEach((function(e){n.state["value"+e.id]&&c.push({id:e.id,name:n.state["id"+e.id]})})),{spuId:t,skuId:a,spuName:i,skuName:s,customizeConfig:c,packageType:r}},n.state={spu:t.data.spuId,spuName:null,sku:t.data.skuId,skuName:null,spuTip:t.spuTip,skuTip:t.skuTip,topicList:t.topicList,oddMaxLeng:0,evenMaxLeng:0,packageType:t.data.packageType&&"null"!==t.data.packageType?t.data.packageType:v.$[0].id},n}(0,s.Z)(t,e);var n=t.prototype;return n.setTopicList=function(e,t,n,a){var i=this;this.setState({topicList:[].concat(t.spuTitle.map((function(e,t){return{id:e,name:e,values:n&&i.props.spuList.find((function(e){return e.id===n}))?JSON.parse(i.props.spuList.find((function(e){return e.id===n})).config)[e]:""}})),t.skuTitle.map((function(e,t){return{id:e,name:e,values:a&&i.props.skuList.find((function(e){return e.id===a}))?JSON.parse(i.props.skuList.find((function(e){return e.id===a})).config)[e]:""}})),e)})},n.componentDidMount=function(){var e=this;this.props.data.spuName===this.state.spuName&&this.props.data.skuName===this.state.skuName||this.setState({spu:this.props.data.spuId,spuName:this.props.data.spuName,sku:this.props.data.skuId,skuName:this.props.data.skuName},(function(){e.setTopicList(e.props.topicList,e.props.data,e.props.data.spuId,e.props.data.skuId),setTimeout((function(){if(e.state.topicList){var t=e.state.topicList.filter((function(e,t){return t%2===0})).map((function(e){return e.name.length})),n=e.state.topicList.filter((function(e,t){return t%2!==0})).map((function(e){return e.name.length}));e.setState({oddMaxLeng:Math.max.apply(Math,t)>6?6:Math.max.apply(Math,t),evenMaxLeng:Math.max.apply(Math,n)>6?6:Math.max.apply(Math,n)})}}),0)}))},n.componentDidUpdate=function(e,t){var n=this,a=e.data,i=e.spuTip,s=e.skuTip,o=this.props,r=o.data,c=o.topicList,l=o.spuTip,u=o.skuTip,p=o.topicOpts,d=t.spuName,m=t.skuName,h=this.state,f=h.spuName,g=h.skuName,k=h.spu,y=h.sku;JSON.stringify(i)!==JSON.stringify(l)?this.setState({spuTip:l.substring(0,8)}):JSON.stringify(s)!==JSON.stringify(u)&&this.setState({skuTip:u.substring(0,8)}),JSON.stringify(d)===JSON.stringify(f)&&JSON.stringify(m)===JSON.stringify(g)||this.setTopicList([].concat(this.props.topicList.filter((function(e){return"\u5e73\u53f0"===e.id})),this.props.topicList.filter((function(e){return"\u5e97\u94fa\u7c7b\u578b"===e.id})),this.props.topicList.filter((function(e){return"\u5e97\u94fa"===e.id}))),r,k,y),JSON.stringify(a)!==JSON.stringify(r)&&this.setState({spu:r.spuId,spuName:r.spuName,sku:r.skuId,skuName:r.skuName,spuTip:"",skuTip:"",packageType:r.packageType?r.packageType:v.$[0].id},(function(){p&&p.forEach((function(e,t){var a;n.setState(((a={})["value"+e.id]=void 0,a))})),n.setTopicList(c,r,k,y)})),p.forEach((function(a,i){var s;n.props["topicValue"+i]&&JSON.stringify(e["topicValue"+i]!==JSON.stringify(n.props["topicValue"+i]))&&n.setState(((s={})["topicValue"+i]=n.props["topicValue"+i],s));JSON.stringify(t["value"+a.id])===JSON.stringify(n.state["value"+a.id])&&JSON.stringify(d)===JSON.stringify(f)&&JSON.stringify(m)===JSON.stringify(g)||n.setTopicList([].concat(n.props.topicList.filter((function(e){return"\u5e73\u53f0"===e.id})),n.props.topicList.filter((function(e){return"\u5e97\u94fa\u7c7b\u578b"===e.id})),n.props.topicList.filter((function(e){return"\u5e97\u94fa"===e.id})),p.map((function(e){return{id:e.id,name:e.name,values:e.id===a.id&&n.state["value"+a.id]&&n.state["value"+e.id]?n.state["value"+a.id][0]:n.state["value"+e.id]?n.state["value"+e.id][0]:""}}))),r,k,y)}))},n.render=function(){var e=this,t=this.props,n=t.spuList,a=t.skuList,i=t.topicOpts,s=t.onFocus,r=t.keywordSpu,c=t.spuShow,l=t.keywordSku,u=t.skuShow,p=this.state,d=p.spu,m=p.spuName,h=p.sku,g=p.spuTip,S=p.skuTip,E=p.topicList,N=p.oddMaxLeng,I=p.evenMaxLeng,C=p.packageType,_=y.t.get(y.V.curProject).notShowTopicList;return o.createElement("div",{className:"product_setting_edit_right_wrap"},o.createElement("div",{className:"top"},o.createElement("div",{className:"spu_sku_base"},o.createElement("span",null,"SPU\u8bcd\u6761"),o.createElement("div",null,n&&o.createElement(f.Z,{show:c,onChange:function(t){e.setState({spu:t.id,spuName:t.name,spuSplit:t.split})},trigger:"click",data:n,value:d,onTipClick:function(){g&&e.setState({spuTip:""}),s()},addText:"\u521b\u5efaSPU\u8bcd\u6761",onAddClick:function(){window.open("/account/project/base?drawerVisible=true")},className:g?"content-error":"",keyword:r}),g&&o.createElement("span",{className:"content-error-hint"},g))),o.createElement("div",{className:"spu_sku_base"},o.createElement("span",null,"SKU\u8bcd\u6761"),o.createElement("div",null,a&&o.createElement(f.Z,{show:u,onChange:function(t){e.setState({sku:t.id,skuName:t.name,skuSplit:t.split})},trigger:"click",data:d?a.filter((function(e){return e.parentId===d})):a,value:h,onTipClick:function(){S&&e.setState({skuTip:""}),s()},addText:"\u521b\u5efaSKU\u8bcd\u6761",disabled:!d,onAddClick:function(){window.open("/account/project/base/sku?spuId="+d+"&spuName="+m+"&drawerVisible=true")},className:S?"content-error":"",keyword:l}),S&&o.createElement("span",{className:"content-error-hint"},S))),!(_&&_.includes("PACKAGE_TYPE"))&&o.createElement("div",{className:"spu_sku_base"},o.createElement("span",null,"\u9500\u552e\u7248\u672c"),o.createElement("div",null,v.$&&o.createElement(f.Z,{onChange:function(t){e.setState({packageType:t.name})},trigger:"click",data:v.$,value:C})))),o.createElement("div",{className:"middle"},o.createElement("div",{className:"title"},o.createElement("h4",null,"\u81ea\u5b9a\u4e49\u4e3b\u9898"),o.createElement("i",{className:"icon-cem_collection-settings",onClick:function(){window.open("/account/project/linkTopic?open=true")}})),o.createElement("div",{className:"content"},i&&i.map((function(t,n){return o.createElement("div",{className:"item",key:t.id},o.createElement("span",{className:"ellipsis"},t.name),o.createElement(k.RS,{tags:!0,multiple:!1,onChange:function(a){e._handleOnSelectChange(a,n,t)},value:e.state["value"+t.id],optionLabelProp:"label",optionFilterProp:"label",placeholder:"\u8bf7\u9009\u62e9\u6216\u8005\u8f93\u5165"},e.state["topicValue"+n]&&e.state["topicValue"+n].map((function(e){return o.createElement(k.Wx,{key:e.id,value:e.value,label:e.value},e.value)}))))})))),o.createElement("div",{className:"bottom"},o.createElement("h4",null,"\u4e3b\u9898\u503c\u603b\u89c8"),o.createElement("div",null,o.createElement("div",{className:"content"},E&&E.map((function(e,t){return o.createElement("span",{key:e.id},o.createElement("span",{className:"name",style:{width:t%2===0?12*N+16+"px":12*I+16+"px"}},e.name),o.createElement("span",{className:"value",style:{width:t%2===0?190-12*N-16-32+"px":190-12*I-16-32+"px"}},e.values))}))))))},t}(o.PureComponent);var E=n(55609),N=n(5133),I=n(64396),C=I.Z.product.setting.subscribe.overview,_={visible:!1,esId:"",id:"",nextId:"",topicList:[],isNext:!0,data:{spuName:"",skuName:""},detailList:[],spuTip:"",skuTip:"",keywordSpu:"",spuShow:!1,keywordSku:"",skuShow:!1},T=function(e){function t(t){var n;return(n=e.call(this,t)||this).show=function(e){var t=e.id,a=e.esId,i=e.nextId,s=e.nextEsId,o=e.topicList,r=e.data,c=e.detailList;n.setState({visible:!0,id:t,nextId:i,nextEsId:s,topicList:o,data:r,detailList:c,esId:a})},n._handleOnOk=function(){n._handleOnCancel()},n._handleOnCancel=function(){n.setState({visible:!1})},n._handleOnAddIgnore=function(e){var t=n.state,a=t.id,s=t.isNext,o=t.nextId,r=t.nextEsId,c=t.data,l=t.esId,u=n.props,p=u.dataList,d=u.total,m=u.keyword,h=u.pageIndex,f=u.pageSize,g=u.topicOpts;if("add"===e){if(!n.contentRef.getValue().spuId)return void n.setState({spuTip:"\u8bf7\u9009\u62e9SPU\u8bcd\u6761"+(new Date).getTime()});if(!n.contentRef.getValue().skuId)return void n.setState({skuTip:"\u8bf7\u9009\u62e9SKU\u8bcd\u6761"+(new Date).getTime()});n.props.fetchAdd((0,i.Z)({connectionId:c.id,esId:l,name:c.name,url:c.url,sourceId:c.sourceId},n.contentRef.getValue()))}else"ignore"===e&&n.props.fetchIgnoreSingle({ignoreId:a});var k=n.contentRef.getValue().spuId,v=n.contentRef.getValue().spuName;s?o?(n.setState({id:o,esId:r}),n.props.fetchDetail({connectionId:o}).then((function(t){2e4===t.data.code&&n.props.fetchLinkList({searchTitleWord:m}).then((function(a){var s=a.findIndex((function(e){return e.id===o}));a.length&&n.setState({data:(0,i.Z)({},a.find((function(e){return e.id===o})),{spuId:"add"===e&&!a.find((function(e){return e.id===o})).spuId&&k?k:a.find((function(e){return e.id===o})).spuId,spuName:"add"===e&&!a.find((function(e){return e.id===o})).spuId&&k?v:a.find((function(e){return e.id===o})).spuName}),topicList:[{id:"\u5e73\u53f0",name:"\u5e73\u53f0",values:a.find((function(e){return e.id===o})).sourceName},{id:"\u5e97\u94fa\u7c7b\u578b",name:"\u5e97\u94fa\u7c7b\u578b",values:a.find((function(e){return e.id===o})).shopType},{id:"\u5e97\u94fa",name:"\u5e97\u94fa",values:a.find((function(e){return e.id===o})).shopName}].concat(g.map((function(e){return{id:e.id,name:e.name,values:""}}))),detailList:t.data.result,nextId:s!==a.length-1?a[s+1].id:"",nextEsId:s!==a.length-1?a[s+1].esId:""})}))}))):d>p.length&&h!==Math.ceil(d/f)?n.props.fetchLinkList({searchTitleWord:m,pageIndex:h+1}).then((function(t){if(t.length){var a=t[0].id,s=t[0].esId;n.setState({id:a,esId:s}),n.props.fetchDetail({connectionId:a}).then((function(a){2e4===a.data.code&&n.setState({data:(0,i.Z)({},t[0],{spuId:"add"===e&&!t[0].spuId&&k?k:t[0].spuId,spuName:"add"===e&&!t[0].spuId&&k?v:t[0].spuName}),topicList:[{id:"\u5e73\u53f0",name:"\u5e73\u53f0",values:t[0].sourceName},{id:"\u5e97\u94fa\u7c7b\u578b",name:"\u5e97\u94fa\u7c7b\u578b",values:t[0].shopType},{id:"\u5e97\u94fa",name:"\u5e97\u94fa",values:t[0].shopName}].concat(g.map((function(e){return{id:e.id,name:e.name,values:""}}))),detailList:a.data.result,nextId:t[1]?t[1].id:"",nextEsId:t[1]?t[1].nextEsId:""})}))}})):(N.Z.error("\u5f53\u524d\u5df2\u662f\u6700\u540e\u4e00\u4e2a\u5546\u54c1"),setTimeout((function(){n.props.fetchLinkList({searchTitleWord:m}),n._handleOnCancel()}),100)):setTimeout((function(){n.props.fetchLinkList({searchTitleWord:m}),n._handleOnCancel()}),100)},n._handleOnNextChange=function(e){n.setState({isNext:e})},n._handleOnChooseSpu=function(e){var t=n.state,a=t.spuShow;t.skuShow;n.setState({keywordSpu:e,spuShow:!a,skuShow:!1})},n._handleOnChooseSku=function(e){var t=n.state,a=t.skuShow;t.spuShow;n.setState({keywordSku:e,skuShow:!a,spuShow:!1})},n.state=(0,i.Z)({},Object.assign({},_)),n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this,t=this.state,n=t.visible,a=t.isNext,s=t.topicList,r=t.data,c=t.detailList,l=t.spuTip,u=t.skuTip,d=t.keywordSpu,m=t.spuShow,h=t.keywordSku,f=t.skuShow,k=this.props,v=k.spuList,y=k.skuList,E=k.topicOpts;return n?o.createElement(p.Dialog,{className:"yt_product_setting_edit_dialog_wrapper",title:"\u5546\u54c1\u94fe\u63a5\u4e3b\u9898\u7ef4\u62a4",size:"tiny",visible:n,onCancel:function(){e.setState({visible:!1})},lockScroll:!0},o.createElement(p.Dialog.Body,null,o.createElement("div",{style:{display:"flex"}},o.createElement(g,{data:r,detailList:c,onChooseSpu:function(t){return e._handleOnChooseSpu(t)},onChooseSku:function(t){return e._handleOnChooseSku(t)},keywordSku:h,keywordSpu:d}),o.createElement(S,(0,i.Z)({ref:function(t){return e.contentRef=t},data:r,spuList:v,skuList:y,topicList:s,spuTip:l,skuTip:u,topicOpts:E,keywordSpu:d,spuShow:m,keywordSku:h,skuShow:f},this.props)))),o.createElement(p.Dialog.Footer,null,o.createElement(p.Checkbox,{checked:a,onChange:this._handleOnNextChange},"\u4e0b\u4e00\u5546\u54c1"),o.createElement(p.Button,{onClick:function(){return e._handleOnAddIgnore("ignore")}},"\u5ffd\u7565"),o.createElement(p.Button,{type:"primary",onClick:function(){return e._handleOnAddIgnore("add")}},"\u6dfb\u52a0"))):null},t}(o.PureComponent);const w=(0,E.connect)((function(e){var t=(0,i.Z)({},e),n=t[C],a=n.skuList,s=n.spuList,o=n.dataList,r=n.pageIndex,c=(n.pageSize,n.searchTitleWord),l=n.total,u=n.topicOpts;return(0,i.Z)({},t[C],{skuList:a,spuList:s,dataList:o,pageIndex:r,keyword:c,total:l,topicOpts:u})}),(function(e){return{fetchLinkList:function(t){return e({type:C+"/fetchLinkList",payload:t})},fetchDetail:function(t){return e({type:C+"/fetchDetail",payload:t})},fetchAdd:function(t){return e({type:C+"/fetchAdd",payload:t})},fetchIgnoreSingle:function(t){return e({type:C+"/fetchIgnoreSingle",payload:t})},fetchTopicOpts:function(t){return e({type:C+"/fetchTopicOpts",payload:t})},fetchAddTopicValue:function(t){return e({type:C+"/fetchAddTopicValue",payload:t})}}}),null,{withRef:!0})(T);var b=n(87219);const L=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnEdit=function(e){var t=n.props.data,a=t.findIndex((function(t){return t.id===e.id}));n.props.fetchDetail({connectionId:e.id}).then((function(i){2e4===i.data.code&&n.props.fetchTopicOpts().then((function(s){s.forEach((function(e,t){n.props.fetchTopicValue({topicId:e.id,projectId:y.t.get(y.V.curProject).id}).then((function(e){var a;2e4===e.data.code&&n.props.save(((a={})["topicValue"+t]=e.data.result.result,a))}))})),n.editModalRef.wrappedInstance.show({id:e.id,esId:e.esId,nextEsId:a!==t.length-1?t[a+1].esId:"",nextId:a!==t.length-1?t[a+1].id:"",data:e,topicList:[{id:"\u5e73\u53f0",name:"\u5e73\u53f0",values:e.sourceName},{id:"\u5e97\u94fa\u7c7b\u578b",name:"\u5e97\u94fa\u7c7b\u578b",values:e.shopType},{id:"\u5e97\u94fa",name:"\u5e97\u94fa",values:e.shopName}].concat(s.map((function(e){return{id:e.id,name:e.name,values:""}}))),detailList:i.data.result})}))}))},n._handleOnAddIgnore=function(e,t){var a=n.state,i=a.spuName,s=a.skuName,o=a.spu,r=a.sku,c=o||e.spuId,l=r||e.skuId;if("add"===t){if(!c)return void n.setState({spuTip:"\u8bf7\u9009\u62e9SPU\u8bcd\u6761"});if(!l)return void n.setState({skuTip:"\u8bf7\u9009\u62e9SKU\u8bcd\u6761"});n.props.onFilterChange({spuName:i||e.spuName,skuName:s||e.skuName,spuId:c,skuId:l,connectionId:e.id,esId:e.esId,name:e.name,url:e.url,sourceId:e.sourceId,isList:!0}),setTimeout((function(){n.setState({spu:0,sku:0,spuName:"",skuName:""})}),0)}else"ignore"===t&&n.props.onFilterChange({ignoreId:e.id,isList:!0})},n._handleOnSelectChange=function(e,t){var a=n.state,i=a.checkedName,s=a.clickAllChecked,o=a.notContain,r=n.props,c=r.total,l=r.firstId,u={projectId:y.t.get(y.V.curProject).id,id:t.id,esId:t.esId,spuId:t.id===l&&n.state.spu||t.spuId,spuName:t.id===l&&n.state.spuName||t.spuName,skuId:t.id===l&&n.state.sku||t.skuId,skuName:t.id===l&&n.state.skuName||t.skuName,name:t.name,url:t.url,sourceId:t.sourceId,connectionId:t.id},p=(0,b.ZP)(i,(function(n){if(e)return n.filter((function(e){return e.id!==t.id}));n.push(u)})),d=(0,b.ZP)(o,(function(n){if(!e)return n.filter((function(e){return e.id!==t.id}));n.push(u)})),m=p.length===c,h=!m&&p.length>0||s&&d.length<c;n.setState({checkedName:p,isAllChecked:m,indeterminate:h}),!m&&s&&n.setState({notContain:d})},n._handleOnSelectAll=function(e){var t=n.props,a=t.data,i=t.firstId,s=t.connectionType;n.setState({isAllChecked:e,indeterminate:!1,checkedName:e?a.map((function(e){return{projectId:y.t.get(y.V.curProject).id,id:e.id,esId:e.esId,spuId:e.id===i&&n.state.spu||e.spuId,spuName:e.id===i&&n.state.spuName||e.spuName,skuId:e.id===i&&n.state.sku||e.skuId,skuName:e.id===i&&n.state.skuName||e.skuName,name:e.name,url:e.url,sourceId:e.sourceId,connectionId:e.id,connectionType:s}})):[],clickAllChecked:e})},n.state={operateState:"",isAllChecked:!1,clickAllChecked:!1,indeterminate:!1,checkedName:[],notContain:[],spuTip:"",skuTip:"",keywordSpu:"",spuShow:!1,skuShow:!1,keywordSku:""},n.columns=[{label:"\u5546\u54c1\u8be6\u60c5\u9875\u6807\u9898",prop:"name",width:200,fixed:"",checked:!0},{label:"SPU\u8bcd\u6761",prop:"spuName",width:220,fixed:"",checked:!0},{label:"SKU\u8bcd\u6761",prop:"skuName",width:220,fixed:"",checked:!0},{label:"\u64cd\u4f5c",prop:"control",width:120,fixed:"",checked:!0}],n.prefixColumns=[{fixed:"left",label:"",width:16},{width:30,fixed:"left",prop:"selection",label:""}],n.columnRenders={selection:function(e){var t=n.state,a=t.clickAllChecked,i=t.isAllChecked,s=t.notContain,r=t.checkedName,c=i||a&&!s.map((function(e){return e.id})).includes(e.id)||r.map((function(e){return e.id})).includes(e.id);return o.createElement("span",{className:(c?"checkbox_checked":"")+" icon_checkbox",onClick:function(){return n._handleOnSelectChange(c,e)}})},name:function(e){return o.createElement(c.Z,{overlay:o.createElement("div",{style:{maxWidth:260},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},o.createElement("p",{onMouseUp:function(){n.setState({keywordSpu:window.getSelection().toString().trim(),spuShow:!n.state.spuShow})}},e.name),o.createElement("div",{style:{color:"#8c8c8c"},onMouseUp:function(){n.setState({keywordSku:window.getSelection().toString().trim(),skuShow:!n.state.skuShow})},dangerouslySetInnerHTML:{__html:""+(e.urlTopics?Object.values(JSON.parse(e.urlTopics)).join("&nbsp;"):"")}})),placement:"top"},o.createElement("div",{className:"setting_name_wrap"},o.createElement("div",{className:"name",onClick:function(){window.open(""+e.url)}},e.name),o.createElement("div",{className:"ellipsis",dangerouslySetInnerHTML:{__html:""+(e.urlTopics?Object.values(JSON.parse(e.urlTopics)).join("&nbsp;"):"")}})))},spuName:function(e){var t=n.state,a=t.spuTip,i=t.spu,s=n.props,r=s.spuList,c=s.firstId,l=s.onFocus;return e.id===c?o.createElement("div",{className:"entry_select_wrap"},o.createElement(f.Z,{show:n.state.spuShow,onChange:function(t){n.setState({id:e.id,spu:t.id,spuName:t.name})},className:a?"content-error":"",trigger:"hover",data:r,value:e.id===n.state.id?i:"",onTipClick:function(){a&&n.setState({spuTip:""}),l()},defaultValue:e.spuId,addText:"\u521b\u5efaSPU\u8bcd\u6761",onAddClick:function(){window.open("/account/project/base?drawerVisible=true")},keyword:n.state.keywordSpu}),a&&o.createElement("span",{className:"content-error-hint"},a)):o.createElement("span",null,e.spuName)},skuName:function(e){var t=n.state,a=t.skuTip,i=t.sku,s=t.spu,r=t.spuName,c=n.props,l=c.skuList,u=c.firstId,p=c.onFocus;return e.id===u?o.createElement("div",{className:"entry_select_wrap"},o.createElement(f.Z,{show:n.state.skuShow,onChange:function(t){n.setState({id:e.id,sku:t.id,skuName:t.name})},className:a?"content-error":"",trigger:"hover",data:s&&l?l.filter((function(e){return e.parentId===s})):e.spuId&&l?l.filter((function(t){return t.parentId===e.spuId})):l,value:e.id===n.state.id?i:"",onTipClick:function(){a&&n.setState({skuTip:""}),p()},defaultValue:e.skuId,addText:"\u521b\u5efaSKU\u8bcd\u6761",disabled:!e.spuId&&!s,onAddClick:function(){window.open("/account/project/base/sku?spuId="+(s||e.spuId)+"&spuName="+(r||e.spuName)+"&drawerVisible=true")},keyword:n.state.keywordSku}),a&&o.createElement("span",{className:"content-error-hint"},a)):o.createElement("span",null,e.skuName)},control:function(e){var t=n.props.firstId;return e.id===t?o.createElement("div",{className:"control"},o.createElement("span",{onClick:function(){return n._handleOnAddIgnore(e,"add")}},"\u6dfb\u52a0"),o.createElement("span",{onClick:function(){return n._handleOnAddIgnore(e,"ignore")}},"\u5ffd\u7565")):o.createElement("div",{className:"control"},o.createElement("span",{onClick:function(){return n._handleOnEdit(e)}},"\u7f16\u8f91"))}},n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.data,a=t.total,i=t.pageIndex,s=t.pageSize,r=t.loading,c=t.className,l=t.onEditChange,u=t.onPageChange,d=t.onPageSizeChange,f=t.onFocus,g=this.state,k=g.checkedName,v=g.visible,y=g.indeterminate,S=g.isAllChecked,E=g.clickAllChecked,N=g.notContain,I=g.operateState;return o.createElement(o.Fragment,null,o.createElement("div",{className:"operate_btn"},o.createElement(h.Z,{type:"button",divider:"none",sufTitle:"\u6279\u91cf\u64cd\u4f5c",activeObj:I,enable:y||S,onChange:function(t){e.setState({operateState:t,visible:!0})},options:[{title:"\u6279\u91cf\u6dfb\u52a0",value:"add",disabled:!k.length},{title:"\u6279\u91cf\u5ffd\u7565",value:"ignore"}]})),o.createElement(m.Z,{savedKey:"product_setting_overview",rowKeyProp:"id",total:a,pageIndex:i,pageSize:s,className:c,prefixColumns:this.prefixColumns,data:n,loading:r,columns:this.columns,columnRenders:this.columnRenders,headerRenders:this.headerRenders,onPageChange:u,onPageSizeChange:d}),o.createElement(w,{ref:function(t){return e.editModalRef=t},onFocus:f}),o.createElement(p.Dialog,{className:"yt_product_setting_ignore_dialog_wrapper",title:"\u786e\u5b9a\u8981\u6279\u91cf"+("add"===I?"\u6dfb\u52a0":"\u5ffd\u7565")+"\u9009\u4e2d\u7684\u5546\u54c1\u94fe\u63a5\uff1f",size:"tiny",visible:v,onCancel:function(){e.setState({visible:!1})},lockScroll:!0},o.createElement(p.Dialog.Body,null,"add"===I?"\u6dfb\u52a0\u540e\u7684\u5546\u54c1\u94fe\u63a5\u53ef\u5728\u300c\u5546\u54c1\u94fe\u63a5\u300d\u9875\u9762\u627e\u5230\uff0c\u5728\u90a3\u4f60\u53ef\u4ee5\u66f4\u597d\u7684\u7ef4\u62a4\u540c\u4e00\u8be6\u60c5\u9875\u4e0b\u7684\u5144\u5f1f\u5546\u54c1\u53ca\u5176\u4e3b\u9898\u503c":"\u8fd9\u4e9b\u5546\u54c1\u94fe\u63a5\u5c06\u88ab\u6807\u8bb0\u4e3a\u201c\u6682\u5ffd\u7565\u201d\uff0c\u8fd9\u4e9b\u5546\u54c1\u94fe\u63a5\u76f8\u5173\u7684\u6d88\u606f\u4e0d\u4f1a\u5c55\u793a\u5728\u524d\u53f0\u5e94\u7528\u4e2d"),o.createElement(p.Dialog.Footer,{className:"dialog-footer"},o.createElement(p.Button,{onClick:function(){e.setState({visible:!1})}},"\u53d6\u6d88"),o.createElement(p.Button,{type:"primary",onClick:function(){l({checkedName:k,notContain:N,clickAllChecked:E,operateState:I,indeterminate:y}),e.setState({checkedName:[],notContain:[],clickAllChecked:!1,isAllChecked:!1,indeterminate:!1,visible:!1})}},"\u786e\u5b9a"))))},(0,d.Z)(t,[{key:"headerRenders",get:function(){var e=this;return{selection:function(){var t=e.state,n=t.isAllChecked,a=t.indeterminate;return o.createElement("span",{className:(n?"checkbox_checked":a?"checkbox_indeterminate":"")+" icon_checkbox",onClick:function(){return e._handleOnSelectAll(!n)}})}}}}]),t}(o.PureComponent);var O=n(30381),x=n.n(O);const P=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={},n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.formPush,a=t.teamList,i=t.userList,s=t.formPushChange;return o.createElement("div",{className:"pulice_push_rule_edit"},o.createElement(p.Form,{ref:function(t){return e.form=t},model:n,rules:{},labelWidth:"80",className:"form",labelPosition:"left",style:{paddingLeft:"24px"}},o.createElement(p.Form.Item,{label:"\u63d0\u9192\u65f6\u95f4"},o.createElement(h.Z,{onChange:function(e){s({key:"weekDay",value:e.weekDay})},className:"rule_single_select",style:{position:"relative"},objName:"weekDay",activeObj:n.weekDay,options:[{title:"\u5de5\u4f5c\u65e5",value:"1,2,3,4,5"},{title:"\u6574\u5468",value:"1,2,3,4,5,6,7"}]}),o.createElement(p.TimeSelect,{start:"00:00",step:"00:30",end:"23:59",onChange:function(e){s({key:"time",value:x()(e).format("HH:mm")})},value:new Date("2000 "+n.time+":00"),placeholder:"\u9009\u62e9\u65f6\u95f4"})),o.createElement(p.Form.Item,{label:"\u63a8\u9001\u65b9\u5f0f",prop:"pass"},o.createElement("span",null,"\u5fae\u4fe1\u901a\u77e5",o.createElement(c.Z,{overlay:o.createElement("div",{style:{lineHeight:"24px",color:"#262626"}},"\u7cfb\u7edf\u4f1a\u7ed9\u7528\u6237\u53d1\u9001\u5fae\u4fe1\u6a21\u677f\u6d88\u606f\u548c",o.createElement("br",null),"\u7cfb\u7edf\u63d0\u9192\uff0c\u5982\u679c\u63a5\u6536\u63d0\u9192\u7684\u7528\u6237\u6ca1",o.createElement("br",null),"\u6709\u7ed1\u5b9a\u5fae\u4fe1\uff0c\u7cfb\u7edf\u4f1a\u5411\u5176\u90ae\u7bb1\u63a8\u9001",o.createElement("br",null),"\u7ed1\u5b9a\u5fae\u4fe1\u7684\u64cd\u4f5c\u8bf4\u660e\uff0c\u6309\u90ae\u4ef6\u8bf4\u660e",o.createElement("br",null),"\u64cd\u4f5c\u5373\u53ef\u3002",o.createElement("br",null),"\u5728\u201c\u4e2a\u4eba\u4e2d\u5fc3/\u4e2a\u4eba\u8d44\u6599\u201d\u9875\u9762\u626b\u7801",o.createElement("br",null),"\u7ed1\u5b9a\u5fae\u4fe1\uff0c\u5373\u53ef\u63a5\u53d7\u9884\u8b66\u901a\u77e5\u3002",o.createElement("br",null),o.createElement("a",{href:"/personalSettings/overview",target:"_black",style:{color:"#0847a6"}},"\u7acb\u5373\u524d\u5f80")),placement:"top"},o.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:"8px"}})))),o.createElement(p.Form.Item,{label:"\u63d0\u9192\u56e2\u961f",prop:"pass"},o.createElement("ul",{className:"push_member"},o.createElement("li",null,o.createElement("span",null,o.createElement(k.RS,{multiple:!0,tags:!1,onChange:function(e){return s({key:"subscribeTeam",value:e})},value:n.subscribeTeam,optionLabelProp:"label",optionFilterProp:"label"},a.map((function(e,t){return o.createElement(k.Wx,{key:t,value:e.id,label:e.name},e.name)}))))))),o.createElement(p.Form.Item,{label:"\u7528\u6237",prop:"pass"},o.createElement("ul",{className:"push_member"},o.createElement("li",null,o.createElement("span",null,o.createElement(k.RS,{multiple:!0,tags:!1,onChange:function(e){return s({key:"subscribeUser",value:e})},value:n.subscribeUser,optionLabelProp:"label",optionFilterProp:"label"},i.map((function(e,t){return o.createElement(k.Wx,{key:t,value:e.id,label:e.username},e.username)})))))))))},t}(o.Component);const A=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this;return o.createElement(p.Dialog,{title:o.createElement("div",null,"\u8bbe\u7f6e\u63d0\u9192"),visible:this.props.visible,className:"push_rule_dialog_wrap",onCancel:function(){return e.props.visibleChange(!1)}},o.createElement(p.Dialog.Body,null,o.createElement("div",{className:"push_rule_edit_wrap"},o.createElement("div",null,o.createElement(p.Loading,{loading:this.props.fetchingDetail},o.createElement(P,this.props))))),o.createElement(p.Dialog.Footer,{className:"dialog-footer"},o.createElement(p.Button,{onClick:function(){return e.props.visibleChange(!1)}},"\u53d6 \u6d88"),o.createElement(p.Button,{type:"primary",onClick:function(){e.props._judge()&&e.props.comfirm().then((function(t){e.props.visibleChange(!1)}))}},"\u786e \u5b9a")))},t}(o.Component);var Z=["loading"],V=I.Z.pushRule,D=function(e){function t(t){var n;return(n=e.call(this,t)||this).judge=function(){var e=n.props.formPush,t=e.subscribeUser,a=e.subscribeTeam,i="";return t.length||a.length||(i="\u8bf7\u81f3\u5c11\u9009\u62e9\u9009\u4e00\u4e2a\u56e2\u961f\u6216\u8005\u7528\u6237\u63a8\u9001"),i&&!0!==i&&p.Message.warning(i),!i},n.props.save({projectId:y.t.get(y.V.curProject).id}),n._event={_judge:n.judge},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.getDetail(),this.props.fetchUserList()},n.componentWillUnmount=function(){this.props.clear()},n.render=function(){return o.createElement(A,(0,i.Z)({},this.props,this._event,this.state))},t}(o.Component);const j=(0,E.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,Z);return(0,i.Z)({},n[V],{fetchingDetail:t.effects[V+"/getDetail"]||!1})}),(function(e){return{fetchUserList:function(t){return e({type:V+"/fetchUserList",payload:t})},getDetail:function(t){return e({type:V+"/getDetail",payload:t})},formPushChange:function(t){return e({type:V+"/formPushChange",payload:t})},comfirm:function(t){return e({type:V+"/comfirm",payload:t})},save:function(t){return e({type:V+"/save",payload:t})},clear:function(t){return e({type:V+"/clear",payload:t})},visibleChange:function(t){return e({type:V+"/visibleChange",payload:t})}}}))(D);const F=function(e){var t=e.loading,n=e.searchTitleWord,a=e.ruleNumbers,i=e.ruleOpts,s=e.skuList,d=e.spuList,m=e.dataList,h=e.pageIndex,f=e.pageSize,g=e.total,k=e.firstId,v=e.onFilterChange,y=e.onEditChange,S=e.onEdit,E=e.fetchDetail,N=e.fetchTopicOpts,I=e.fetchTopicValue,C=e.onPageChange,_=e.onPageSizeChange,T=e.save,w=e.onFocus,b=e.location,O=e.visibleChange,x=e.connectionType,P=b.pathname.split("/")[3];return o.createElement("div",{className:"yt_product_setting_subscribe_overview_wrapper"},o.createElement("div",{className:"top_zone"},o.createElement("div",null,o.createElement(r.Z,{onSearch:function(e){return v({searchTitleWord:e})},onClear:function(e){return v({searchTitleWord:e})},placeholder:"\u641c\u7d22\u5546\u54c1\u6807\u9898",defValue:n,style:{width:168}}),o.createElement(l.Z,{title:"\u8ba2\u9605\u89c4\u5219",options:i,value:a,onChange:function(e){v({ruleNumbers:e})}})),o.createElement("div",{className:"right_btn"},o.createElement(c.Z,{placement:"top",overlay:"\u8bbe\u7f6e\u63d0\u9192"},o.createElement("i",{className:"icon-cem_set-reminders rule_setting-button",onClick:function(){return O(!0)}})),o.createElement(c.Z,{overlay:"\u67e5\u770b\u88ab\u6807\u8bc6\u4e3a\u201c\u6682\u5ffd\u7565\u201d\u7684\u5546\u54c1\u94fe\u63a5",placement:"top"},o.createElement("span",{className:"icon_trash",onClick:function(){u.mW.push({pathname:"/account/project/"+P+"/subscribe/recycling"})}},o.createElement("i",{className:"icon-cem_trash"}))),o.createElement(p.Button,{type:"primary",onClick:function(){u.mW.push({pathname:"/account/project/"+P+"/subscribe/rules"})}},"\u8ba2\u9605\u89c4\u5219"))),m?o.createElement(L,{className:"list_content_wrap",loading:t,data:m,skuList:s,spuList:d,pageIndex:h,pageSize:f,total:g,firstId:k,onChange:v,onEdit:S,fetchDetail:E,fetchTopicOpts:N,fetchTopicValue:I,save:T,onEditChange:y,onPageChange:C,onPageSizeChange:_,onFilterChange:v,onFocus:w,connectionType:x}):o.createElement(p.Loading,{style:{height:"100%"},loading:t}),o.createElement(j,null))};var M=["loading"],U=I.Z.product.setting.public,R=I.Z.product.setting.subscribe.overview,W=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnFocus=function(){var e=n.props,t=e.spuList,a=e.skuList,i=y.t.get(y.V.newEntry)||{},s=i.spuName,o=i.skuName,r=i.spuId,c=i.skuId;(s&&!t.find((function(e){return s.includes(e.name.replaceAll(e.split,"").replaceAll("|",""))}))||o&&!a.find((function(e){return o.includes(e.name.replaceAll(e.split,"").replaceAll("|",""))}))||r&&!t.find((function(e){return String(e.id)===String(r)}))||c&&!a.find((function(e){return String(e.id)===String(c)})))&&n.props.fetchEntryOpts({projectId:y.t.get(y.V.curProject).id,id:1})},n._handleOnEdit=function(e){n.props.fetchEdit(e)},n._handleOnEditChange=function(e){var t=n.state.connectionType;"ignore"===e.operateState?e.checkedName.length&&e.indeterminate?n.props.fetchIgnore({batchIgnoreId:e.checkedName.map((function(e){return e.id})),connectionType:t}):e.clickAllChecked&&n.props.fetchIgnoreAll({notIgnoreId:e.notContain.length?e.notContain.map((function(e){return e.id})):void 0,connectionType:t}):"add"===e.operateState&&n.props.fetchAddAll(e.checkedName)},n._handleOnFilterChange=function(e){var t=n.state.connectionType;void 0!==e.searchTitleWord?n.props.fetchLinkList({searchTitleWord:e.searchTitleWord,pageIndex:1}):e.ignoreId?n.props.fetchIgnoreSingle({ignoreId:e.ignoreId,isList:e.isList,connectionType:t}):e.esId?n.props.fetchAdd((0,i.Z)({},e,{connectionType:t})):e.ruleNumbers&&n.props.fetchLinkList({ruleNumbers:e.ruleNumbers,pageIndex:1})},n._handleOnPageChange=function(e){var t=n.props,a=t.searchTitleWord;(0,t.fetchLinkList)({pageIndex:e,searchTitleWord:a})},n._handleOnPageSizeChange=function(e){var t=n.props,a=t.searchTitleWord;(0,t.fetchLinkList)({pageSize:e,pageIndex:1,searchTitleWord:a})},n.state={connectionType:t.location.pathname.includes("/price")?"PRICE":"DEFAULT"},n.event={onFilterChange:n._handleOnFilterChange,onPageChange:n._handleOnPageChange,onPageSizeChange:n._handleOnPageSizeChange,onEditChange:n._handleOnEditChange,onEdit:n._handleOnEdit,onFocus:n._handleOnFocus},t.save({connectionType:t.location.pathname.includes("/price")?"PRICE":"DEFAULT"}),t.titleChange([{title:"\u667a\u80fd\u8ba2\u9605",state:{type:""}}]),n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.fetchRuleList({projectId:y.t.get(y.V.curProject).id,type:this.state.connectionType}),this.props.fetchEntryOpts({projectId:y.t.get(y.V.curProject).id,connectionType:this.state.connectionType})},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return o.createElement(F,(0,i.Z)({},this.props,this.state,this.event))},t}(o.PureComponent);const J=(0,E.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,M);return(0,i.Z)({},n[R],{loading:t.effects[R+"/fetchLinkList"]||!1})}),(function(e){return{save:function(t){return e({type:R+"/save",payload:t})},clean:function(t){return e({type:R+"/clean",payload:t})},fetchLinkList:function(t){return e({type:R+"/fetchLinkList",payload:t})},fetchAdd:function(t){return e({type:R+"/fetchAdd",payload:t})},fetchAddAll:function(t){return e({type:R+"/fetchAddAll",payload:t})},fetchIgnoreSingle:function(t){return e({type:R+"/fetchIgnoreSingle",payload:t})},fetchIgnore:function(t){return e({type:R+"/fetchIgnore",payload:t})},fetchIgnoreAll:function(t){return e({type:R+"/fetchIgnoreAll",payload:t})},fetchDetail:function(t){return e({type:R+"/fetchDetail",payload:t})},fetchEntryOpts:function(t){return e({type:R+"/fetchEntryOpts",payload:t})},fetchTopicOpts:function(t){return e({type:R+"/fetchTopicOpts",payload:t})},fetchTopicValue:function(t){return e({type:R+"/fetchTopicValue",payload:t})},fetchAddTopicValue:function(t){return e({type:R+"/fetchAddTopicValue",payload:t})},fetchRuleList:function(t){return e({type:R+"/fetchRuleList",payload:t})},titleChange:function(t){return e({type:U+"/titleChange",payload:t})},visibleChange:function(t){return e({type:"pushRule/visibleChange",payload:t})}}}))(W)}}]);