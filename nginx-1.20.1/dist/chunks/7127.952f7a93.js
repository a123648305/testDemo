"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[7127],{48930:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var r,a=n(87462),l=n(94578),o=n(67294),c=(n(1025),n(65400)),u=(n(89858),n(51024)),i=n(15861),s=(n(75314),n(11187)),d=(n(53294),n(56697)),m=n(87757),p=n.n(m),f=n(55815),v=n(96889),g=n(45467),b=n(38064),h=n(1179),E=n(35239),I=function(e){return e&&e instanceof Array&&e.length>0};!function(e){e.ACCOUNT_ROLE="ACCOUNT_ROLE",e.PROJECT_ROLE="PROJECT_ROLE",e.SYS_ROLE="SYS_ROLE"}(r||(r={}));var y=function(e){var t=e.title,n=e.url;return[{title:E.t.get(E.V.backProjectConfig).name,url:"/account/project/preview"},{title:t,url:n}]};function k(e){return e.map((function(e,t){return{id:e.id,key:e.id,title:e.name,remark:e.remark,children:I(e.children)?k(e.children):null}}))}var S=function(e){var t,n=[];return null!=e&&null!=(t=e.members)&&t.length&&e.members.forEach((function(t){var r;null!=e&&null!=(r=e.memberRoles)&&r.length&&e.memberRoles.forEach((function(e){n.push({objId:t.objId,objType:t.objType,passDown:t.directlyUnder,roleId:e.roleId,projectId:E.t.get(E.V.backProjectConfig).id})}))})),n};function x(e){var t=[],n=[];return function e(r){return r.forEach((function(r){I(r.children)?(n.push(r.id),e(r.children)):t.push(r.id)}))}(e),{leafNode:t,nonLeafNode:n}}var w=n(33798),j=n(1374),C=n(68855),_=n(12827),N=n.n(_),R=(n(7940),n(31059)),Z=(n(77785),n(59361)),z=n(76295),T=n(53074);const O=function(e){var t=e.title,n=e.activeItem,r=e.allAuths,a=e.list,l=e.roleList,c=e.searchList,u=e.onCancel,m=e.onOk,f=(0,o.useState)([]),v=f[0],b=f[1],h=(0,o.useState)(""),E=h[0],I=h[1],y=(0,o.useState)((null==n?void 0:n.members)||[]),k=y[0],S=y[1],w=(0,o.useState)((null==n?void 0:n.memberRoles)||[]),j=w[0],C=w[1];(0,o.useEffect)((function(){var e;if(t&&(S((null==n?void 0:n.members)||[]),C((null==n?void 0:n.memberRoles)||[])),null!=n&&null!=(e=n.memberRoles)&&e.length)try{(0,g.v4)({roleIds:null==n?void 0:n.memberRoles.map((function(e){return e.roleId})),appName:"APP_NAME_SERVER"}).then((function(e){var t=e.data;2e4===t.code&&t.result&&b(x(t.result).leafNode)}))}catch(r){b([])}}),[n,t]);var _=function(){I(""),b([]),S((null==n?void 0:n.members)||[]),C((null==n?void 0:n.memberRoles)||[]),u&&u()},N=function(){var e=(0,i.Z)(p().mark((function e(){var t,r,a,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=11;break}if(k&&k.length){e.next=4;break}return s.default.error("\u8bf7\u9009\u62e9\u6210\u5458/\u90e8\u95e8"),e.abrupt("return");case 4:if(j&&j.length){e.next=7;break}return s.default.error("\u8bf7\u9009\u62e9\u89d2\u8272"),e.abrupt("return");case 7:return e.next=9,m({members:k.map((function(e){return{directlyUnder:e.directlyUnder,objId:e.objId,objType:e.objType}})),memberRoles:j,isEdit:(null==n||null==(t=n.members)?void 0:t.length)||(null==n||null==(r=n.memberRoles)?void 0:r.length)});case 9:2e4===e.sent.data.code&&(s.default.success(null!=n&&null!=(a=n.members)&&a.length||null!=n&&null!=(l=n.memberRoles)&&l.length?"\u7f16\u8f91\u6210\u529f":"\u6dfb\u52a0\u6210\u529f"),_());case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o.createElement(d.Z,{className:"yt_project_add_project_member_modal",width:960,title:t,visible:!!t,onOk:N,onCancel:_},o.createElement("div",{className:"item member"},o.createElement("span",null,"\u6210\u5458/\u90e8\u95e8"),o.createElement("div",{className:"tag_content "+(null!=k&&k.length?"":"empty_tag")+" "+(n?"edit_tag_content":""),onClick:function(){return!n&&I("\u9009\u62e9\u6210\u5458\u6216\u90e8\u95e8")}},null!=k&&k.length?k.map((function(e){return o.createElement(Z.default,{closable:!n,closeIcon:o.createElement("i",{className:"icon-cem_delete"}),onClick:function(e){e.stopPropagation()},key:e.objId,icon:o.createElement("i",{className:"USER"===e.objType?"icon-cem_name":"icon-jiagou",style:{marginRight:4}}),onClose:function(t){return n=e,void S(k.filter((function(e){return e.objId!==n.objId})));var n}},e.name)})):o.createElement("span",{className:"tip"},"\u8bf7\u9009\u62e9\u6210\u5458/\u90e8\u95e8"))),o.createElement("div",{className:"item role"},o.createElement("span",null,"\u89d2\u8272"),o.createElement(R.default.Group,{onChange:function(e){null!=e&&e.length?((0,g.v4)({roleIds:e,appName:"APP_NAME_SERVER"}).then((function(e){var t=e.data;2e4===t.code&&t.result&&b(x(t.result).leafNode)})),C(e.map((function(e){return{roleId:e}})))):(C([]),b([]))},value:j.map((function(e){return e.roleId}))},l.map((function(e){return o.createElement(R.default,{value:e.id,key:e.id},e.name)})))),o.createElement(T.Z,{disabled:!0,allAuth:r,selectedAuth:v,title:"\u89d2\u8272\u5bf9\u5e94\u6743\u9650",titleOverlay:"\u4e0b\u9762\u5c55\u793a\u89d2\u8272\u5bf9\u5e94\u7684\u6743\u9650\u5217\u8868\uff0c\u65b9\u4fbf\u77e5\u9053\u8be5\u6210\u5458/\u90e8\u95e8\u62e5\u6709\u7684\u5177\u4f53\u6743\u9650"}),o.createElement(z.Z,{members:k,list:a,searchList:c,searchOptions:[{label:"\u641c\u7d22\u6210\u5458",value:"USER"},{label:"\u641c\u7d22\u90e8\u95e8",value:"DEPT"}],type:3,directControl:!0,subTitle:"\u4ec5\u9009\u62e9\u90e8\u95e8\u7684\u76f4\u5c5e\u6210\u5458",title:E,onOk:function(e){S(e.members)},onCancel:function(){return I("")}}))};var P=n(58447);const L=function(e){var t,l,m=(0,o.useState)({list:[],total:0,pageIndex:1,pageSize:10,loading:!1}),I=m[0],x=m[1],_=(0,o.useState)({}),R=_[0],Z=_[1],z=(0,o.useState)([]),T=z[0],L=z[1],U=(0,o.useState)(""),A=U[0],H=U[1],V=(0,o.useState)([]),J=V[0],D=V[1],F=(0,o.useState)(null==(t=e.location)||null==(l=t.state)?void 0:l.roleIds),B=F[0],M=F[1],W=(0,o.useState)("All"),Y=W[0],q=W[1],G=(0,o.useState)(""),K=G[0],Q=G[1],X=(0,o.useState)(void 0),$=X[0],ee=X[1],te=(0,o.useState)(0),ne=te[0],re=te[1],ae=[{title:"",width:"0.1%"},{title:"\u6210\u5458/\u90e8\u95e8",dataIndex:"name",width:"22%",render:function(e,t){return o.createElement("div",{className:"member_team"},"USER"===t.objType?o.createElement("span",{className:"member_name"},o.createElement(j.Z,{src:t.userHead?t.userHead.startsWith("http")?t.userHead:location.protocol+"//"+t.userHead:n(68374),defaultImg:n(68374)}),e||"--"):o.createElement("span",{className:"team_name"},o.createElement(w.Z,{defaultIcon:"bumen",activeIcon:"bumen"}),o.createElement("span",{className:"team_text"},e),o.createElement("span",{className:t.directlyUnder?"direct":"all"},1===t.directlyUnder?"\u76f4\u5c5e\u6210\u5458":"\u6240\u6709\u6210\u5458")))}},{title:"\u90ae\u7bb1",dataIndex:"email",width:"22%",render:function(e,t){return o.createElement("span",null,"USER"===t.objType&&e||"--")}},{title:"\u8d26\u53f7\u72b6\u6001",dataIndex:"userStatus",width:"13%",render:function(e,t){var n=P.h.find((function(t){return t.value===e}));return n?o.createElement(o.Fragment,null,o.createElement("div",{style:{background:n.background,color:n.color},className:"organization-status"},n.icon,n.title)):"--"}},{title:"\u89d2\u8272",dataIndex:"roles",width:"30%",render:function(e){return o.createElement("div",null,e.filter((function(e){return e})).map((function(e){return e.roleName})).join("\u3001"))}},{title:"\u64cd\u4f5c",key:"operate",width:"13%",render:function(e){return o.createElement("div",{className:"operate"},o.createElement("span",{onClick:function(){return de(e)}},"\u7f16\u8f91"),o.createElement("span",{onClick:function(){return le(e)}},"\u79fb\u9664"))}}],le=function(e){var t=I.pageIndex,n=I.pageSize,r=I.list;d.Z.confirm({title:"\u79fb\u9664\u6210\u5458/\u90e8\u95e8",icon:o.createElement(C.Z,{style:{color:"#FF7955"}}),content:"\u662f\u5426\u786e\u5b9a\u5c06\u201c"+e.name+"\u201d\u4ece\u9879\u76ee\u4e2d\u79fb\u9664\uff1f\u79fb\u9664\u540e\uff0c\u4e0d\u53ef\u67e5\u770b\u9879\u76ee\u6570\u636e\u3002",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",maskClosable:!1,onOk:function(){(0,g.k3)({objId:e.objId,objType:e.objType,projectId:E.t.get(E.V.backProjectConfig).id}).then((function(e){2e4===e.data.code&&(s.default.success("\u79fb\u9664\u6210\u529f"),oe({keyword:A,roleId:B,pageIndex:1===r.length?t-1||1:t,pageSize:n}))}))},onCancel:function(){}})},oe=function(){var e=(0,i.Z)(p().mark((function e(t){var n,r,l,o,c,u,i,s,d,m,f,v,b;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyword,r=t.roleId,l=t.pageIndex,o=t.pageSize,c=t.status,u=void 0===c?Y:c,i=E.t.get(E.V.backProjectConfig).id,e.prev=2,x((function(e){return(0,a.Z)({},e,{loading:!0})})),e.next=6,(0,g.Zy)({keyword:n,pageIndex:l,pageSize:o,projectId:i,roleIds:r,userStatus:"All"===u?void 0:[u]});case 6:s=e.sent,d=(s||{}).data,m=(d||{}).result,v=(f=m||{}).records,b=f.total,x((function(e){return(0,a.Z)({},e,{total:b,list:v})})),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(2);case 15:return e.prev=15,x((function(e){return(0,a.Z)({},e,{loading:!1})})),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,13,15,18]])})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=(0,i.Z)(p().mark((function e(){var t,n,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.t.get(E.V.backProjectConfig).id,e.prev=1,e.next=4,(0,g.kP)({roleType:r.PROJECT_ROLE,typeId:t});case 4:n=e.sent,null!=(a=(n||{}).data.result)&&a.length&&L(a.map((function(e){return{id:e.id,name:e.roleName}}))),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=(0,i.Z)(p().mark((function e(){var t,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,g.P6)();case 3:t=e.sent,null!=(n=(t||{}).data.result)&&n.length&&D(k(n)),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=(0,i.Z)(p().mark((function e(){var t,n,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.t.get(E.V.backProjectConfig).id,e.prev=1,e.next=4,(0,g.zU)({roleType:r.PROJECT_ROLE,projectId:t});case 4:n=e.sent,(a=(n||{}).data.result)&&Z(a),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e=I.pageIndex,t=I.pageSize;oe({keyword:A,roleId:B,pageIndex:e,pageSize:t}),ie(),ce(),ue()}),[]);var se=function(e){I.pageIndex;var t=I.pageSize;void 0!==e.name?(x((function(e){return(0,a.Z)({},e,{pageIndex:1})})),oe({keyword:e.name,roleId:B,pageIndex:1,pageSize:t})):e.roleIds?(M(e.roleIds),x((function(e){return(0,a.Z)({},e,{pageIndex:1})})),oe({keyword:A,roleId:e.roleIds,pageIndex:1,pageSize:t})):void 0!==e.userStatus&&(q(e.userStatus),x((function(e){return(0,a.Z)({},e,{pageIndex:1})})),oe({keyword:A,roleId:B,pageIndex:1,pageSize:t,status:e.userStatus}))},de=function(e){Q("\u7f16\u8f91\u6210\u5458/\u90e8\u95e8"),ee({members:[{objId:e.objId,name:e.name,objType:e.objType,directlyUnder:e.directlyUnder,userHead:e.userHead,pathNode:e.pathNode.reduce((function(e,t){return[t].concat(e)}),[])}],memberRoles:e.roles.map((function(t){return{roleId:t.id,passDown:e.directlyUnder}}))})},me=function(){var e=(0,i.Z)(p().mark((function e(t){var n,r,a,l,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.members,r=t.memberRoles,!(a=t.isEdit)){e.next=7;break}return e.next=4,(0,g.Zs)(S({members:n,memberRoles:r}));case 4:return 2e4===(l=e.sent).data.code&&oe({keyword:A,roleId:B,pageIndex:I.pageIndex,pageSize:I.pageSize}),e.abrupt("return",l);case 7:if(a){e.next=19;break}return e.prev=8,e.next=11,(0,g.gc)({members:n,memberRoles:r,projectId:E.t.get(E.V.backProjectConfig).id});case 11:return 2e4===(o=e.sent).data.code&&oe({keyword:A,roleId:B,pageIndex:1,pageSize:I.pageSize}),e.abrupt("return",o);case 16:e.prev=16,e.t0=e.catch(8),40010===e.t0.data.code&&s.default.error(e.t0.data.msg);case 19:case"end":return e.stop()}}),e,null,[[8,16]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=document.querySelector(".yt_project_member_wrapper .container .content");re((null==e?void 0:e.offsetHeight)-126)};return(0,o.useEffect)((function(){return window.addEventListener("resize",pe),pe(),function(){return window.removeEventListener("resize",pe)}}),[]),o.createElement("div",{className:"yt_project_member_wrapper"},o.createElement(f.Z,{title:y({title:"\u6210\u5458\u7ba1\u7406",url:void 0})}),o.createElement("div",{className:"container"},o.createElement("div",{className:"content"},o.createElement("div",{className:"table_top"},o.createElement("div",null,o.createElement("div",{className:"super_manager"},"\u9879\u76ee\u8d85\u7ea7\u7ba1\u7406\u5458\uff1a",o.createElement(j.Z,{src:R.userHead?R.userHead.startsWith("http")?R.userHead:location.protocol+"//"+R.userHead:n(68374),defaultImg:n(68374)}),o.createElement("span",{className:"user_name"},R.username),"\uff08",R.email,"\uff09"),o.createElement(u.default,{placeholder:"\u8bf7\u8f93\u5165",allowClear:!0,suffix:o.createElement("i",{className:"icon-cem_small-search",onClick:function(){return se({name:A})}}),onPressEnter:function(){return se({name:A})},onChange:function(e){H(e.target.value),""===e.target.value&&se({name:e.target.value})},value:A,style:{height:28,width:240}}),o.createElement(b.Z,{title:"\u89d2\u8272",options:T,showClearBtn:!0,value:B,onChange:function(e){return se({roleIds:e})},onClear:function(){var t,n=N()();if(null!=(t=e.location)&&t.state){var r,l=(0,a.Z)({},null==(r=e.location)?void 0:r.state);delete l.roleIds,n.replace((0,a.Z)({},n.location,{state:l}))}}}),o.createElement(h.Z,{options:P.h.map((function(e){return(0,a.Z)({},e,{icon:void 0})})),onChange:function(e){return se(e)},objName:"userStatus",preTitle:"\u8d26\u53f7\u72b6\u6001",divider:"none",type:"button",activeObj:Y,sufIcon:"icon-cem_pull-down-or-take-up"})),o.createElement(c.default,{type:"primary",onClick:function(){Q("\u6dfb\u52a0\u6210\u5458/\u90e8\u95e8")}},"\u6dfb\u52a0\u6210\u5458/\u90e8\u95e8")),o.createElement(v.ZP,{loading:I.loading,dataSource:I.list,columns:ae,rowKey:"id",scroll:{y:ne-88},toolBarRender:!1,search:!1,pagination:{total:I.total,current:I.pageIndex,pageSize:I.pageSize},onChange:function(e){var t=e.pageSize,n=e.current,r=I.pageSize!==t?1:n;x((function(e){return(0,a.Z)({},e,{pageSize:t,pageIndex:r})})),oe({keyword:A,roleId:B,pageIndex:r,pageSize:t})}}))),o.createElement(O,{allAuths:J,roleList:T,title:K,activeItem:$,onOk:me,onCancel:function(){Q(""),ee(void 0)}}))};const U=function(e){function t(t){var n;return(n=e.call(this,t)||this).state=void 0,n.state={},n}return(0,l.Z)(t,e),t.prototype.render=function(){return o.createElement(L,(0,a.Z)({},this.props,this.state))},t}(o.PureComponent)}}]);