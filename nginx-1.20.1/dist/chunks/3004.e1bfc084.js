"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3004],{38177:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(94578),r=a(67294),i=a(45697),l=a.n(i),o=a(92360),c=a(43036),u=function(e){function t(t){var a;return(a=e.call(this,t)||this).getPercentage=function(){for(var e=a.props.data,t=0,n=0,r=0,i=0,l=0,o=0;o<e.length;o++){var c=e[o].value;t+=c,o<100&&(l+=c,o<50&&(i+=c,o<30&&(r+=c,o<10&&(n+=c))))}a.setState({percentage:{10:0===t?0:n/t,30:0===t?0:r/t,50:0===t?0:i/t,100:0===t?0:l/t}})},a.toggleDisplay=function(){var e=a.state.show;a.setState({show:!e})},a.switchTopValue=function(e){a.setState({topValue:e})},a.handleConfirm=function(){var e=a.props.onConfirm,t=a.state.topValue;e&&e(t),a.setState({show:!1})},a.state={show:!1,topValue:t.topValue||0,percentage:{10:0,30:0,50:0,100:0}},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.getPercentage()},a.render=function(){var e=this,t=this.state,a=t.show,n=t.topValue,i=t.percentage,l=this.props.data,u=l[0]?l[0].value:0,s=l[n<=l.length?n-1:l.length-1].value||0,p=[10,30,50,100];return r.createElement(o.Dialog,{title:"\u89c6\u56fe\u8fc7\u6ee4",size:"tiny",visible:a,customClass:"data_filter_wrapper",onCancel:this.toggleDisplay,lockScroll:!0},r.createElement(o.Dialog.Body,null,r.createElement("div",{className:"input_set"},r.createElement(o.Input,{value:u,disabled:!0}),r.createElement("span",null,"-"),r.createElement(o.Input,{value:s,disabled:!0})),r.createElement("div",{className:"bar_set"},p.map((function(t){return r.createElement(c.Z,{placement:"top",overlay:"Top"+t+"\u5360\u603b\u6570\u636e\u91cf\u7684"+(100*i[t]).toFixed(2)+"%",key:t},r.createElement("div",{className:n===t?"bar active":"bar",style:{height:100*i[t]+"px"},onClick:function(){return e.switchTopValue(t)}}))}))),r.createElement("div",{className:"desc_set"},p.map((function(e){return r.createElement("span",{key:e},"top"+e)})))),r.createElement(o.Dialog.Footer,{className:"dialog-footer"},r.createElement(o.Button,{onClick:this.toggleDisplay},"\u53d6\u6d88"),r.createElement(o.Button,{type:"primary",onClick:this.handleConfirm},"\u786e\u5b9a")))},t}(r.Component);u.propTypes={data:l().arrayOf(l().shape({name:l().string.isRequired,value:l().number.isRequired})),topValue:l().number.isRequired,onConfirm:l().func.isRequired}},41103:(e,t,a)=>{a.d(t,{Z:()=>h});var n=a(50361),r=a.n(n),i=a(67294),l=a(50976),o=a(30133),c=a(31705),u=a(38177),s=a(94644),p=a(87462),d=a(39432);const h=function(e){var t=e.isInitial,a=e.loading,n=e.title,h=e.otherChartType,m=e.pieChartData,f=e.otherChartData,g=e.type,v=e.formatedData,y=e.topValue,C=e.save,E=i.useState(void 0),D=E[0],b=E[1],w=i.useState(void 0),k=w[0],O=w[1];i.useEffect((function(){if(!t&&!a&&D&&m&&m.length>0&&f){var e=function(e){var t=e.title,a=e.otherChartType,n=e.pieChartData,r=e.otherChartData,i=e.type,l=n.length>0?n.reduce((function(e,t){return e+t.count}),0):0,o=n.map((function(e){var t=0===l?0:e.count/l*100;return e.percentage=Number.isInteger(t)?t:t.toFixed(2),e})),c={type:"pie",id:"pie",radius:["57%","68%"],center:["9%","60%"],legendHoverLink:!1,hoverAnimation:!0,hoverOffset:3,label:{show:!0,position:"center",formatter:["{a|"+d.ZP.formatNumber(l)+"}","{b|"+(i&&"PRODUCT"===i?"\u8bc4\u8bba\u6570":"\u9500\u91cf")+"}"].join("\n"),rich:{a:{fontSize:24,lineHeight:32,color:"#262626",padding:[4,0]},b:{fontSize:14,lineHeight:20,color:"#8C8C8C",padding:[4,0]}}},itemStyle:{borderWidth:1,borderColor:"#fff"},data:o.map((function(e){return{name:e.name,value:e.count}}))},u=r.map((function(e){var t=0;return e.data.length>0&&e.data.forEach((function(e){t+=e.count})),e.total=t,e}));u.sort((function(e,t){return t.total-e.total}));var s="bar"===a?{barMaxWidth:32,large:!0}:{smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{opacity:1}},h=u.map((function(e){var t=e.name,n=e.data;return(0,p.Z)({},s,{name:t,type:a,stack:"stack",data:n.length>0?n.map((function(e){return{name:e.date,value:e.count}})):[]})}));return{title:{text:t,textStyle:{fontSize:14,lineHeight:20},left:0,top:0},tooltip:{confine:!0,enterable:o&&o.length>17,axisPointer:{type:"none"},formatter:function(e){return Array.isArray(e)?(e.sort((function(e,t){return e.value-t.value})),e[0].name+e.map((function(e){return"<br/>"+e.marker+e.seriesName+"\uff1a"+e.value})).reverse().join("")):e.marker+" "+e.name+"\uff1a"+e.value+"\uff08"+e.percent+"%\uff09"},extraCssText:"max-height: 400px; overflow: auto"},legend:{type:"scroll",orient:"vertical",left:"20%",top:"26%",itemWidth:12,itemHeight:12,itemGap:16,pageIconSize:12,formatter:function(e){return"{a|"+(e.length>9?e.substring(0,9)+"...":e)+"}{b|"+o.filter((function(t){return t.name===e}))[0].percentage+"%}"},textStyle:{rich:{a:{width:102,padding:[0,4]},b:{width:48,color:"#8C8C8C",align:"right"}}},data:o.length>0?o.map((function(e){return{name:e.name,icon:"rect"}})):[]},xAxis:{type:"category",boundaryGap:"bar"===a,data:u.length>0?u[0].data.map((function(e){return e.date})):[]},yAxis:{gridIndex:0},grid:{show:!1,top:"26%",left:"40%",right:"2%",bottom:0,containLabel:!0,tooltip:{trigger:"axis"}},series:[].concat(h,[c])}}({title:n,otherChartType:h,pieChartData:r()(m),otherChartData:r()(f),type:g});D.clear(),D.setOption(e)}}),[t,a,m,f,D,g]);var S=["SPU","SHOP"];return i.createElement("div",{className:"double-chart-wrapper"},t?i.createElement(o.Z,null):0===m.length?i.createElement("div",{className:"empty-block"},"\u6682\u65e0\u6570\u636e"):i.createElement(i.Fragment,null,i.createElement(l.Z,{theme:"yunting_multi_color",option:{},showLoading:a,style:{width:"100",height:"252px",display:m.length>0?"block":"none"},loadingOption:{text:"",color:"#1574B3"},onChartReady:function(e){return b(e)}}),i.createElement(c.Z,{onDownChartClick:function(){return function(e,t){(0,s._v)(e,t)}(D,n)},onDownExcelClick:function(){return function(e,t){if(e.length>0){for(var a=e.map((function(e){return e.name})),n=[],r=0;r<e[0].data.length;r++){var i=[];i.push(e[0].data[r].date);for(var l=0;l<e.length;l++)i.push(e[l].data[r].count);n.push(i)}a.splice(0,0,"\u65e5\u671f"),n.splice(0,0,a),(0,s.aT)([n],t)}}(f,n)},otherOptions:S.includes(g)?[{label:"\u89c6\u56fe\u8fc7\u6ee4",clickFun:function(){return k.toggleDisplay()}}]:[]}),S.includes(g)&&i.createElement(u.Z,{data:v,topValue:y,ref:O,onConfirm:function(e){return C({firstTopValue:e})}})))}},93004:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var n=a(63366),r=a(87462),i=a(94578),l=a(67294),o=a(19586),c=a(41103),u=a(50976),s=a(92360),p=a(70715),d=a(30133),h=a(31705),m=a(38177),f=a(94644);const g=function(e){var t=e.pieChartloading,a=e.pieChartData,n=e.type,r=e.isInitial,i=e.handleChartClick,o=e.formatedData,c=e.topValue,g=e.save,v=l.useState(void 0),y=v[0],C=v[1],E=l.useState(void 0),D=E[0],b=E[1],w=a&&a.length>0?function(e,t){var a=[],n=[],r=[];e.forEach((function(e,i){a.push(e.name);var l=void 0;if("MODEL"===t){!r.find((function(t){return t.name===e.brand}))&&r.push({name:e.brand,color:void 0});var o=r.findIndex((function(t){return t.name===e.brand})),c=Math.floor(o/p.Fq.length);l=p.Fq[o%p.Fq.length],!r[o].color&&(r[o].color="#"+(parseInt(l.substring(1),16)+1118481*c).toString(16))}else{var u=Math.floor(i/p.Fq.length);l=p.Fq[i%p.Fq.length],l="#"+(parseInt(l.substring(1),16)+65793*u).toString(16)}n.push({obj:e,name:e.brand,value:e.count,spu:"SPU"===t?e.spu:"",itemStyle:{color:l}})}));var i=10/e.length<1&&10/e.length;return{title:{text:("MODEL"===t?"\u8bc4\u8bba\u6570":"\u9500\u91cf")+"\u6392\u540d - "+("MODEL"===t?"\u578b\u53f7":"SHOP"===t?"\u5e97\u94fa":"SPU"),left:20},tooltip:{formatter:function(e){var a=e.marker,n=e.data.obj;return"MODEL"===t?[a+" \u54c1\u724c\uff1a"+n.brand,"\u578b\u53f7\uff1a"+n.name,"\u8bc4\u8bba\u6570\uff1a"+n.count].join("</br>"):[a+" "+("SHOP"===t?"\u5e97\u94fa":"SPU")+"\uff1a"+n.name,"\u9500\u91cf\uff1a"+n.count].join("</br>")}},grid:{top:"MODEL"===t?"20%":"12%",left:"6%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:a.reverse(),axisLabel:{formatter:function(e){return e.length>9?e.substring(0,9)+"...":e}}},dataZoom:[{type:"slider",show:!!i,yAxisIndex:[0],start:i?100-100*i:0,end:100,width:18,showDetail:!1,left:20}],series:[{type:"bar",barMaxWidth:"22",data:n.reverse(),large:!0,largeThreshold:400,progressive:0}],opt:{brandData:r}}}(a,n):{};return l.createElement("div",{className:"price-product-ranking-chart"},r?l.createElement(d.Z,null):0===a.length?l.createElement("div",{className:"empty-block"},"\u6682\u65e0\u6570\u636e"):l.createElement(s.Loading,{loading:t,style:{height:"100%"}},l.createElement(u.Z,{theme:"yunting_multi_color",option:w,style:{width:"calc(100% - 480px)",height:"500px"},onChartReady:function(e){return C(e)},onEvents:{click:"SPU"===n?i:null}}),l.createElement("div",{className:"table-wrap"},l.createElement("div",{className:"table-header"},"MODEL"===n&&l.createElement("div",null,"\u54c1\u724c"),l.createElement("div",null,"MODEL"===n?"\u578b\u53f7":"SPU"===n?"SPU":"\u5e97\u94fa"),"MODEL"===n&&l.createElement("div",null,"\u8bc4\u8bba\u6570"),"MODEL"!==n&&l.createElement("div",null,"\u9500\u91cf")),l.createElement("ul",null,a.map((function(e){return l.createElement("li",{key:e.name},"MODEL"===n&&l.createElement("div",null,e.brand),l.createElement("div",null,e.name),l.createElement("div",null,e.count))})))),"MODEL"===n&&w.opt&&l.createElement("div",{className:"chart_fake_legend"},w.opt.brandData.map((function(e){return l.createElement("span",{key:e.name},l.createElement("span",{className:"chart_fake_legend_icon",style:{background:e.color}}),e.name)}))),l.createElement(h.Z,{onDownChartClick:function(){return e=y,t=("MODEL"===n?"\u8bc4\u8bba\u6570":"\u9500\u91cf")+"\u6392\u540d - "+("MODEL"===n?"\u578b\u53f7":"\u5e97\u94fa")+"\u56fe",void(0,f._v)(e,t);var e,t},onDownExcelClick:function(){return function(e,t,a){if(e.length>0){var n=[[],[]];e.forEach((function(e){n[0].push(e.name),n[1].push(e.count)})),n[0].unshift("MODEL"===a?"\u578b\u53f7":"\u5e97\u94fa"),n[1].unshift("\u9500\u91cf"),(0,f.aT)([n],t)}}(a,("MODEL"===n?"\u8bc4\u8bba\u6570":"\u9500\u91cf")+"\u6392\u540d - "+("MODEL"===n?"\u578b\u53f7":"\u5e97\u94fa")+"\u6570\u636e",n)},otherOptions:"MODEL"!==n?[{label:"\u89c6\u56fe\u8fc7\u6ee4",clickFun:function(){return D.toggleDisplay()}}]:[]}),"MODEL"!==n&&l.createElement(m.Z,{data:o,topValue:c,ref:b,onConfirm:function(e){return g({sndTopValue:e})}})))};const v=function(e){var t=e.isInitial,a=e.type,n=e.pieChartloading,r=e.lineChartloading,i=e.pieChartData,u=e.lineChartData,s=e.handleFilterReady,p=e.handleFilterChange,d=e.handleChartClick,h=e.getFilterRef,m=e.saleData,f=e.filteredItems,v=e.firstTopValue,y=e.sndTopValue,C=e.save,E=i.slice(0,v),D=u.filter((function(e){var t=e.spu;return f.includes(t)})),b=i.slice(0,y),w=i.map((function(e){return{name:e.name,value:e.count}}));return l.createElement("div",{className:"price-product-analysis-wrapper"},l.createElement(o.Z,{ref:h,title:("MODEL"===a?"\u4ea7\u54c1":"SHOP"===a?"\u5e97\u94fa":"SPU")+"\u5206\u6790",showList:["condition","time"],filter:["CONN_CONFIG","SOURCE"],onFilterReady:s,onChange:p}),l.createElement("div",{className:"price-product-analysis-body"},l.createElement("div",null,l.createElement(c.Z,{isInitial:t,loading:r,title:"MODEL"===a?"\u8bc4\u8bba\u6570\u5206\u5e03 - \u578b\u53f7":"\u9500\u91cf\u5206\u5e03 - "+("SHOP"===a?"\u5e97\u94fa":"SPU"),otherChartType:"line",pieChartData:"MODEL"!==a?E:i,otherChartData:"MODEL"!==a?D:u,type:a,topValue:v,formatedData:w,save:C})),l.createElement(g,{saleData:m,pieChartData:b,pieChartloading:n,type:a,isInitial:t,handleChartClick:d,topValue:y,formatedData:w,save:C})))};var y=a(35239),C=a(55609),E=a(64396),D=["loading"],b=E.Z.price.productShop,w=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleFilterReady=function(){var e=a.props.fetchData,t=a.filter.getValue(),n=t.filterModel,r=t.dateFilter;e({projectId:y.t.get(y.V.curProject).id,filterModel:n,dateFilter:r})},a._handleFilterChange=function(e){var t=a.props,n=t.fetchData,r=t.init,i=e.filterModel,l=e.dateFilter,o=y.t.get(y.V.curProject).id;r(),n({projectId:o,filterModel:i,dateFilter:l})},a._handleChartClick=function(e){var t=a.props.type,n=a.props[t].dateFilter,r=e.data.spu;window.windowPool=[];var i=window.open("/price/realTimePrice/priceDetail");window.windowPool.push({window:i,parameter:{source:3,data:{spu:r,dateFilter:n}}})},t.saveType({type:t.pageType}),a.event={handleFilterReady:a._handleFilterReady,handleFilterChange:a._handleFilterChange,handleChartClick:a._handleChartClick,getFilterRef:function(e){return a.filter=e}},a}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.type,a=e.pageType,n=this.props,i=n.save,o=n.pieChartloading,c=n.lineChartloading;return t&&t===a?l.createElement(v,(0,r.Z)({},this.props[t],this.event,{type:t,pieChartloading:o,lineChartloading:c,save:i})):null},t}(l.Component);const k=(0,C.connect)((function(e){var t=e.loading,a=(0,n.Z)(e,D);return(0,r.Z)({},a[b],{pieChartloading:t.effects[b+"/fetchPieChartData"]||!1,lineChartloading:t.effects[b+"/fetchLineChartData"]||!1})}),(function(e){return{fetchData:function(t){return e({type:b+"/fetchData",payload:t})},saveType:function(t){return e({type:b+"/saveType",payload:t})},init:function(t){return e({type:b+"/init",payload:t})},save:function(t){return e({type:b+"/save",payload:t})}}}))(w)}}]);