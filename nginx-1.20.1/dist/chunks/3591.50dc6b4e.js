"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3591],{58287:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var r,a=n(67294),l=n(55815),o=(n(1025),n(65400)),u=(n(89858),n(51024)),i=n(15861),s=(n(75314),n(11187)),c=(n(53294),n(56697)),d=n(87462),m=n(87757),p=n.n(m),f=n(96889),v=n(68855);!function(e){e.ACCOUNT_ROLE="ACCOUNT_ROLE",e.PROJECT_ROLE="PROJECT_ROLE",e.SYS_ROLE="SYS_ROLE"}(r||(r={}));var h=function(e){return e&&e instanceof Array&&e.length>0};function g(e){return e.map((function(e,t){return{id:e.id,key:e.id,title:e.name,remark:e.remark,children:h(e.children)?g(e.children):null}}))}function E(e){var t=[],n=[];return function e(r){return r.forEach((function(r){h(r.children)?(n.push(r.id),e(r.children)):t.push(r.id)}))}(e),{leafNode:t,nonLeafNode:n}}var I=function(e){var t,n=[];return null!=e&&null!=(t=e.members)&&t.length&&e.members.forEach((function(t){var r;null!=e&&null!=(r=e.memberRoles)&&r.length&&e.memberRoles.forEach((function(e){n.push({objId:t.objId,objType:t.objType,passDown:t.directlyUnder,roleId:e.roleId})}))})),n},b=n(1374),S=n(38064),y=n(1179),k=n(49722);function w(e){return k.h.post("/upms/account/admin/page",e)}function _(e){return k.h.post("/upms/permission/role/find",e)}n(7940);var x=n(31059),C=(n(77785),n(59361)),N=n(76295),R=n(53074);const Z=function(e){var t=e.title,n=e.activeItem,r=e.allAuths,l=e.list,o=e.roleList,u=e.searchList,d=e.onCancel,m=e.onOk,f=(0,a.useState)([]),v=f[0],h=f[1],b=(0,a.useState)(""),S=b[0],y=b[1],k=(0,a.useState)((null==n?void 0:n.members)||[]),w=k[0],Z=k[1],O=(0,a.useState)((null==n?void 0:n.memberRoles)||[]),z=O[0],j=O[1];(0,a.useEffect)((function(){var e;if(t&&(Z((null==n?void 0:n.members)||[]),j((null==n?void 0:n.memberRoles)||[])),null!=n&&null!=(e=n.memberRoles)&&e.length)try{_({roleIds:null==n?void 0:n.memberRoles.map((function(e){return e.roleId})),appName:"APP_NAME_SERVER"}).then((function(e){var t=e.data;2e4===t.code&&t.result&&h(E(t.result).leafNode)}))}catch(r){h([])}}),[n,t]);var T=function(){y(""),h([]),Z((null==n?void 0:n.members)||[]),j((null==n?void 0:n.memberRoles)||[]),d&&d()},A=function(){var e=(0,i.Z)(p().mark((function e(){var t,r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=12;break}if(w&&w.length){e.next=4;break}return s.default.error("\u8bf7\u9009\u62e9\u6210\u5458"),e.abrupt("return");case 4:if(z&&z.length){e.next=7;break}return s.default.error("\u8bf7\u9009\u62e9\u89d2\u8272"),e.abrupt("return");case 7:return t=I({members:w,memberRoles:z}),e.next=10,m(t);case 10:2e4===e.sent.data.code&&(s.default.success(null!=n&&null!=(r=n.members)&&r.length||null!=n&&null!=(a=n.memberRoles)&&a.length?"\u7f16\u8f91\u6210\u529f":"\u6dfb\u52a0\u6210\u529f"),T());case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.createElement(c.Z,{className:"yt_project_add_bussiness_member_modal",width:960,title:t,visible:!!t,onOk:A,onCancel:T},a.createElement("div",{className:"item member"},a.createElement("span",null,"\u6210\u5458"),a.createElement("div",{className:"tag_content "+(null!=w&&w.length?"":"empty_tag")+" "+(n?"edit_tag_content":""),onClick:function(){return!n&&y("\u9009\u62e9\u6210\u5458")}},null!=w&&w.length?w.map((function(e){return a.createElement(C.default,{closable:!n,closeIcon:a.createElement("i",{className:"icon-cem_delete"}),onClick:function(e){e.stopPropagation()},key:e.objId,icon:a.createElement("i",{className:"icon-cem_name",style:{marginRight:4}}),onClose:function(t){return n=e,void Z(w.filter((function(e){return e.objId!==n.objId})));var n}},e.name)})):a.createElement("span",{className:"tip"},"\u8bf7\u9009\u62e9\u6210\u5458"))),a.createElement("div",{className:"item role"},a.createElement("span",null,"\u89d2\u8272"),a.createElement(x.default.Group,{onChange:function(e){null!=e&&e.length?(_({roleIds:e,appName:"APP_NAME_SERVER"}).then((function(e){var t=e.data;if(2e4===t.code&&t.result){g(t.result);h(E(t.result).leafNode)}})),j(e.map((function(e){return{roleId:e}})))):(j([]),h([]))},value:z.map((function(e){return e.roleId}))},o.map((function(e){return a.createElement(x.default,{value:e.id,key:e.id},e.name)})))),a.createElement(R.Z,{disabled:!0,allAuth:r,showSearch:!1,selectedAuth:v,title:"\u89d2\u8272\u5bf9\u5e94\u6743\u9650",titleOverlay:"\u4e0b\u9762\u5c55\u793a\u89d2\u8272\u5bf9\u5e94\u7684\u6743\u9650\u5217\u8868\uff0c\u65b9\u4fbf\u77e5\u9053\u8be5\u6210\u5458\u62e5\u6709\u7684\u5177\u4f53\u6743\u9650"}),a.createElement(N.Z,{members:w,list:l,searchList:u,searchOptions:[{label:"\u641c\u7d22\u6210\u5458",value:"USER"},{label:"\u641c\u7d22\u90e8\u95e8",value:"DEPT"}],type:4,title:S,onOk:function(e){Z(e.members)},onCancel:function(){return y("")}}))};var O=n(12827),z=n.n(O),j=n(49388),T=n(58447);const A=function(e){var t,l,m=(0,a.useState)({list:[],total:0,pageIndex:1,pageSize:10,loading:!1}),h=m[0],E=m[1],I=(0,a.useState)({}),_=I[0],x=I[1],C=(0,a.useState)([]),N=C[0],R=C[1],O=(0,a.useState)([]),A=O[0],P=O[1],L=(0,a.useState)(""),U=L[0],H=L[1],V=(0,a.useState)(null==(t=e.location)||null==(l=t.state)?void 0:l.roleIds),D=V[0],F=V[1],M=(0,a.useState)("All"),W=M[0],B=M[1],J=(0,a.useState)([]),Y=J[0],q=(J[1],(0,a.useState)("")),G=q[0],K=q[1],Q=(0,a.useState)(void 0),X=Q[0],$=Q[1],ee=(0,a.useState)(!1),te=ee[0],ne=ee[1],re=(0,a.useState)(0),ae=re[0],le=re[1],oe=[{title:"",width:"0.1%"},{title:"\u59d3\u540d",dataIndex:"userName",width:"22%",render:function(e,t){return a.createElement("span",{className:"member_name"},a.createElement(b.Z,{src:t.headerUrl?t.headerUrl.startsWith("http")?t.headerUrl:location.protocol+"//"+t.headerUrl:n(68374),defaultImg:n(68374)}),e)}},{title:"\u90ae\u7bb1",dataIndex:"email",width:"22%"},{title:"\u8d26\u53f7\u72b6\u6001",dataIndex:"userStatus",width:"13%",render:function(e,t){var n=T.h.find((function(t){return t.value===e}));return n&&a.createElement(a.Fragment,null,a.createElement("div",{style:{background:n.background,color:n.color},className:"organization-status"},n.icon,n.title))}},{title:"\u89d2\u8272",dataIndex:"roleVoS",width:"30%",render:function(e){return a.createElement("div",null,e.filter((function(e){return e})).map((function(e){return e.roleName})).join("\u3001"))}},{title:"\u64cd\u4f5c",key:"operate",width:"13%",render:function(e){return a.createElement("div",{className:"operate"},a.createElement("span",{onClick:function(){return pe(e)}},"\u7f16\u8f91"),a.createElement("span",{onClick:function(){return ue(e)}},"\u79fb\u9664"))}}],ue=function(e){var t=h.pageIndex,n=h.pageSize,r=h.list;c.Z.confirm({title:"\u79fb\u9664\u7ba1\u7406\u5458",icon:a.createElement(v.Z,{style:{color:"#FF7955"}}),content:"\u662f\u5426\u786e\u5b9a\u5c06\u201c"+e.userName+"\u201d\u4ece\u7ba1\u7406\u5458\u4e2d\u79fb\u9664\uff1f\u79fb\u9664\u540e\uff0c\u4e0d\u53ef\u914d\u7f6e\u4f01\u4e1a\u4e2d\u5fc3\u529f\u80fd",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",maskClosable:!1,onOk:function(){var a;(a={objId:e.userId,objType:"USER",roleIds:e.roleVoS.map((function(e){return e.id}))},k.h.post("/upms/umps_role/removeRoleToObj",a)).then((function(e){2e4===e.data.code&&(s.default.success("\u79fb\u9664\u6210\u529f"),ie({keyword:U,roleId:D,permissionId:Y,pageIndex:1===r.length?t-1||1:t,pageSize:n}))}))},onCancel:function(){}})},ie=function(){var e=(0,i.Z)(p().mark((function e(t){var n,r,a,l,o,u,i,s,c,m,f,v,h;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyword,r=t.roleId,a=t.permissionId,l=t.pageIndex,o=t.pageSize,u=t.status,i=void 0===u?W:u,e.prev=1,E((function(e){return(0,d.Z)({},e,{loading:!0})})),e.next=5,w({keywords:n,pageIndex:l,pageSize:o,userStatus:"All"===i?void 0:[i],roleIds:r,permissionIds:a});case 5:s=e.sent,c=(s||{}).data,m=(c||{}).result,v=(f=m||{}).records,h=f.total,E((function(e){return(0,d.Z)({},e,{total:h,list:v})})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(1);case 14:return e.prev=14,E((function(e){return(0,d.Z)({},e,{loading:!1})})),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,12,14,17]])})));return function(t){return e.apply(this,arguments)}}(),se=function(e){h.pageIndex;var t=h.pageSize;void 0!==e.name?(E((function(e){return(0,d.Z)({},e,{pageIndex:1})})),ie({keyword:e.name,roleId:D,permissionId:Y,pageIndex:1,pageSize:t})):e.roleIds?(F(e.roleIds),E((function(e){return(0,d.Z)({},e,{pageIndex:1})})),ie({keyword:U,roleId:e.roleIds,permissionId:Y,pageIndex:1,pageSize:t})):void 0!==e.userStatus&&(B(e.userStatus),E((function(e){return(0,d.Z)({},e,{pageIndex:1})})),ie({keyword:U,roleId:D,permissionId:Y,status:e.userStatus,pageIndex:1,pageSize:t}))},ce=function(){var e=(0,i.Z)(p().mark((function e(){var t,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a={roleType:r.ACCOUNT_ROLE},k.h.post("/upms/umps_role/list",a);case 3:t=e.sent,null!=(n=(t||{}).data.result)&&n.length&&R(n.map((function(e){return{id:e.id,name:e.roleName}}))),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}var a}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=(0,i.Z)(p().mark((function e(){var t,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.h.post("/upms/permission/setting/find",{type:"ENTERPRISE"});case 3:t=e.sent,null!=(n=(t||{}).data.result)&&n.length&&P(g(n)),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=(0,i.Z)(p().mark((function e(){var t,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a={appName:"APP_NAME_SERVER",roleType:r.ACCOUNT_ROLE},k.h.post("/upms/umps_role/super_role/find",a);case 3:t=e.sent,(n=(t||{}).data.result)&&x(n),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}var a}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){var e=h.pageIndex,t=h.pageSize;ie({keyword:U,roleId:D,permissionId:Y,pageIndex:e,pageSize:t}),me(),ce(),de()}),[]);var pe=function(e){K("\u7f16\u8f91\u7ba1\u7406\u5458"),$({members:[{objId:e.userId,name:e.userName,objType:"USER",directlyUnder:0,userHead:e.headerUrl}],memberRoles:e.roleVoS.map((function(e){return{roleId:e.id}}))})},fe=function(){var e=(0,i.Z)(p().mark((function e(t){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r=t,k.h.post("/upms/umps_role/grantRolesToObj",r);case 3:return 2e4===(n=e.sent).data.code&&(E((function(e){return(0,d.Z)({},e,{pageIndex:1})})),ie({keyword:U,roleId:D,permissionId:Y,pageIndex:1,pageSize:h.pageSize})),e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(0),40010===e.t0.data.code&&s.default.error(e.t0.data.msg);case 11:case"end":return e.stop()}var r}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=document.querySelector(".business_setting_manager_content");le((null==e?void 0:e.offsetHeight)-126)};return(0,a.useEffect)((function(){return window.addEventListener("resize",ve),ve(),function(){return window.removeEventListener("resize",ve)}}),[]),a.createElement("div",{className:"business_setting_manager_content"},a.createElement("div",{className:"content_header"},a.createElement("div",null,a.createElement("div",{className:"super_manager"},"\u4f01\u4e1a\u8d85\u7ea7\u7ba1\u7406\u5458\uff1a",a.createElement(b.Z,{src:_.userHead?_.userHead.startsWith("http")?_.userHead:location.protocol+"//"+_.userHead:n(68374),defaultImg:n(68374)}),a.createElement("span",{className:"user_name"},_.username),"\uff08",_.email,"\uff09",JSON.parse(localStorage.getItem("__user__")).userId===_.id&&a.createElement("span",{className:"change",onClick:function(){return ne(!0)}},"\u8f6c\u8ba9")),a.createElement(u.default,{placeholder:"\u8bf7\u8f93\u5165\u59d3\u540d\u3001\u90ae\u7bb1\u6216\u624b\u673a\u53f7",allowClear:!0,value:U,suffix:a.createElement("i",{className:"icon-cem_small-search",onClick:function(){return se({name:U})}}),onPressEnter:function(){return se({name:U})},onChange:function(e){H(e.target.value),""===e.target.value&&se({name:e.target.value})},style:{height:28,width:240}}),a.createElement(S.Z,{title:"\u89d2\u8272",options:N,showClearBtn:!0,value:D,onChange:function(e){return se({roleIds:e})},onClear:function(){var t,n=z()();if(null!=(t=e.location)&&t.state){var r,a=(0,d.Z)({},null==(r=e.location)?void 0:r.state);delete a.roleIds,n.replace((0,d.Z)({},n.location,{state:a}))}}}),a.createElement(y.Z,{options:T.h.map((function(e){return(0,d.Z)({},e,{icon:void 0})})),onChange:function(e){return se(e)},objName:"userStatus",preTitle:"\u8d26\u53f7\u72b6\u6001",divider:"none",type:"button",activeObj:W,sufIcon:"icon-cem_pull-down-or-take-up"})),a.createElement(o.default,{type:"primary",onClick:function(){K("\u6dfb\u52a0\u7ba1\u7406\u5458")}},"\u6dfb\u52a0\u7ba1\u7406\u5458")),a.createElement(f.ZP,{loading:h.loading,dataSource:h.list,columns:oe,rowKey:"id",scroll:{y:ae-88},toolBarRender:!1,search:!1,pagination:{total:h.total,current:h.pageIndex,pageSize:h.pageSize},onChange:function(e){var t=e.pageSize,n=e.current,r=h.pageSize!==t?1:n;E((function(e){return(0,d.Z)({},e,{pageSize:t,pageIndex:r})})),ie({keyword:U,roleId:D,permissionId:Y,pageIndex:r,pageSize:t})}}),a.createElement(Z,{allAuths:A,roleList:N,activeItem:X,title:G,onOk:fe,onCancel:function(){K(""),$(void 0)}}),a.createElement(j.Z,{title:"\u8f6c\u8ba9\u4f01\u4e1a\u8d85\u7ea7\u7ba1\u7406\u5458\u8eab\u4efd",visible:te,onClose:function(){return ne(!1)},onConfirm:function(e,t){var n;(n={id:e},k.h.post("/upms/account/changeAccountSuperManager",n)).then((function(e){var n=e.data,r=n.code;n.result;if(2e4===r){s.default.success("\u8f6c\u8ba9\u6210\u529f");var a=h.pageIndex,l=h.pageSize;me(),ie({keyword:U,roleId:D,permissionId:Y,pageIndex:a,pageSize:l}),t()}})).catch((function(e){var t;return s.default.error(null!=(t=e.data.msg)?t:"\u8f6c\u8ba9\u5931\u8d25")}))}}))},P=function(e){return a.createElement("div",{className:"business_setting_manager_wrapper"},a.createElement(l.Z,{title:"\u7ba1\u7406\u5458"}),a.createElement("div",{className:"business_setting_manager"},a.createElement(A,e)))}},83566:(e,t,n)=>{n.d(t,{mE:()=>a,iI:()=>l,Nw:()=>o});var r=n(49722),a=function(){return r.h.post("/upms/project/pageProject")},l=function(e){return r.h.post("/upms/user/multiSearch",e)},o=function(e){return r.h.post("/upms/project/change/leader",e)}},49388:(e,t,n)=>{n.d(t,{Z:()=>m});n(53294);var r,a=n(56697),l=(n(35797),n(64749)),o=(n(15086),n(94055)),u=(n(82815),n(84960)),i=(n(9405),n(89552)),s=n(67294),c=n(39432),d=n(83566);const m=function(e){var t=e.title,m=e.visible,p=e.onClose,f=e.onConfirm,v=(0,s.useState)(),h=v[0],g=v[1],E=(0,s.useState)([]),I=E[0],b=E[1],S=(0,s.useState)(!1),y=S[0],k=S[1];var w=function(){p(),g(void 0),b([])};return s.createElement(a.Z,{title:t,visible:m,onCancel:w,onOk:function(){h&&f(h,(function(){w()}))},width:450,okButtonProps:{disabled:!h},className:"yt-role-transfer-modal-wrapper role-modal-wrapper",destroyOnClose:!0},s.createElement("div",null,s.createElement("label",null,"\u6210\u5458"),s.createElement(l.default,{showSearch:!0,value:h,style:{width:326},placeholder:"\u8bf7\u8f93\u5165\u59d3\u540d\u3001\u90ae\u7bb1\u548c\u624b\u673a\u53f7",showArrow:!1,filterOption:!1,onSearch:function(e){e?function(e){k(!0),r&&(clearTimeout(r),r=null),r=setTimeout((function(){d.iI({keyword:e}).then((function(e){var t=e.data,n=t.code,r=t.result;2e4===n&&b(r)})).finally((function(){return k(!1)}))}),500)}(e):b([])},onChange:function(e){g(e)},notFoundContent:y?s.createElement(i.default,{style:{width:"100%"}}):null,optionLabelProp:"label",getPopupContainer:function(e){return e}},I.map((function(e){var t,r=e.id,a=e.username,i=e.userHeadUrl,d=null!=(t=e.path)&&t.startsWith("/")?e.path.substring(1):e.path,m=s.createElement("div",{className:"option"},s.createElement(u.ZP,{src:i?i.startsWith("http")?i:location.protocol+"//"+i:n(68374)}),s.createElement("div",null,s.createElement("div",null,a),s.createElement("div",null,d)));return s.createElement(l.default.Option,{key:r,value:r,label:a},(0,c.jD)(d,12)>250?s.createElement(o.default,{title:d,mouseEnterDelay:.5},m):m)})))))}}}]);