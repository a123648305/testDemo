"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[675],{13922:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(94578),r=n(67294),s=n(45697),i=n.n(s),l=n(92360),o=n(66982),c=n.n(o),d=function(e){function t(){return e.apply(this,arguments)||this}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.images,n=e.isShow,a=e.startIndex,s=e.closeDialog,i=e.className;return r.createElement(l.Dialog,{visible:n,className:"img-preview-dialog "+i,onCancel:s,lockScroll:!1},r.createElement(l.Dialog.Body,null,r.createElement(c(),{items:t,startIndex:a,showThumbnails:!1})))},t}(r.Component);d.propTypes={images:i().array.isRequired,isShow:i().bool.isRequired,closeDialog:i().func.isRequired,startIndex:i().number.isRequired,className:i().string}},90675:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Qn});var a=n(63366),r=n(87462),s=n(94578),i=n(19586),l=n(35103),o=n(30133),c=n(35239),d=n(67294),u=n(73098),m=(n(75314),n(11187)),p=n(23279),h=n.n(p),g=n(45697),f=n.n(g),v=n(49722),E=n(92360),y=n(43036),C=n(30381),S=n.n(C),N=n(39432),w=n(55609),k=n(1374),_=n(15861),T=n(87757),I=n.n(T),L=n(12234),b={"\u6b63\u9762":1,"\u4e2d\u6027":0,"\u8d1f\u9762":-1};const O=function(e){var t=e.emotionScore,n=e.msgType,a=e.routing,r=e.index,s=e.id,i=e.changeMessage,l=e.disableSwitch,o=void 0!==l&&l,c=e.commentId,u=d.useState(t),m=u[0],p=u[1],h=function(){var e=(0,_.Z)(I().mark((function e(t){var n,l;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.h.post("/inbox/messages/update",{flag:c?"ticket_comment":"message",id:s,index:r,routing:a,score:t,commentId:c});case 2:2e4===(null==(l=e.sent)||null==(n=l.data)?void 0:n.code)&&(i&&i({score:t}),p(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object.values(b).includes(m)&&"\u5b98"!==n&&d.createElement("div",{className:"msg-header-center"},d.createElement("div",{className:"msg-center-icon "+(o?"disable-switch":"")},d.createElement("i",{className:"cem-icon icon-cem_"+(-1===m?"negative":0===m?"neutral":"positive")}),d.createElement("ul",{className:"popup-list"},["\u6b63\u9762","\u4e2d\u6027","\u8d1f\u9762"].filter((function(e){return b[e]!==m})).map((function(e,t){return d.createElement("li",{key:t,onClick:function(){return h(b[e])}},d.createElement(L.l,{className:"normal-state",name:"\u8d1f\u9762"===e?"negative-no-hover":"\u4e2d\u6027"===e?"neutral-no-hover":"positive-no-hover"}),d.createElement(L.l,{className:"hover-state",name:"\u8d1f\u9762"===e?"negative-hover":"\u4e2d\u6027"===e?"neutral-hover":"positive-hover"}),"\xa0",e)})))))};var x=n(88958),D=function(e){function t(t){var a;(a=e.call(this,t)||this).switchEmotion=function(e){var t=a.props,n=t.id,r=t.index,s=t.routing,i=t.commentId;v.h.post("/inbox/messages/update",{flag:i?"ticket_comment":"message",id:n,index:r,routing:s,score:e,commentId:i}).then((function(t){2e4===t.data.code&&a.setState({emotion:e},(function(){return a.props.changeMessage({id:n,escore:e})}))}))},a.renderAvatarOverlay=function(e){var t=e.userName,n=e.userDescription,r=e.userFocusCount,s=e.userFollowerCount,i=e.userBlogCount,l=e.userVerifyLevel,o=e.userGender,c=a.state.userHead;return d.createElement("div",{className:"msg_userHead_overlay_wrap"},d.createElement("div",{className:"msg_top_userHead_overlay"},d.createElement("img",{src:c,onError:a.handleImgError}),d.createElement("div",null,d.createElement("div",null,t),d.createElement("div",{className:"introduction"},n))),d.createElement("div",{className:"msg_middle_userHead_overlay"},d.createElement("ul",null,d.createElement("li",null,d.createElement("div",null,N.ZP.getApproximateNum(r)),d.createElement("span",null,"\u5173\u6ce8")),d.createElement("li",null,d.createElement("div",null,N.ZP.getApproximateNum(s)),d.createElement("span",null,"\u7c89\u4e1d")),d.createElement("li",null,d.createElement("div",null,N.ZP.getApproximateNum(i)),d.createElement("span",null,"\u5fae\u535a")))),d.createElement("div",{className:"msg_bottom_userHead_overlay"},d.createElement("ul",null,""!==l&&d.createElement("li",null,d.createElement("span",null,"\u8ba4\u8bc1\u7b49\u7ea7"),l),""!==o&&d.createElement("li",null,d.createElement("span",null,"\u6027\u522b"),"f"===o?"\u5973":"\u7537"))))};var r=t.avatar,s=t.msgType,i=t.defaultAvatar,l=void 0===i?n(70269):i;return a.state={userHead:"\u5b98"===s?l:r?r.startsWith("http")?r:"http://"+r:n(88958)},a}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.userName,n=e.score,a=e.time,r=e.msgType,s=e.alignDirection,i=e.isWeibo,l=(e.emotionScore,this.state.userHead);return d.createElement("div",{className:"msg-header-wrapper"},d.createElement("div",{className:"msg-header-left"},!s||s&&"right"!==s?d.createElement(d.Fragment,null,i?d.createElement(y.Z,{overlayClassName:"yt_msg_userHead_overlay_tips",overlay:this.renderAvatarOverlay(this.props),placement:"bottomLeft",mouseEnterDelay:.6},d.createElement("div",{style:{display:"inline"}},d.createElement("img",{src:l,onError:this.handleImgError}),d.createElement("span",null,t))):d.createElement("div",null,d.createElement(k.Z,{src:l,defaultImg:x}),d.createElement("span",null,t))):null),d.createElement(O,this.props),d.createElement("div",{className:s&&"right"===s?"msg-header-right avatar-right":"msg-header-right"},!s||s&&"right"!==s&&n&&d.createElement(E.Rate,{disabled:!0,key:n,value:n,colors:["#FF8373","#FF8373","#FF8373"],showText:!1}),s&&"right"===s&&d.createElement("div",{className:"avatar-username"},d.createElement("span",null,t),d.createElement("img",{src:l,onError:this.handleImgError})),a&&d.createElement("span",{className:"time"},S()(a).format("YYYY/MM/DD HH:mm:ss")),r&&d.createElement("span",{className:"msg-type"},r.substring(0,1))))},t}(d.PureComponent);D.propTypes={isWeibo:f().boolean,avatar:f().string,defaultAvatar:f().string,userName:f().string.isRequired,emotionScore:f().number,score:f().number,time:f().string.isRequired,msgType:f().string,id:f().string,index:f().string,routing:f().string,alignDirection:f().string};const M=(0,w.connect)(null,(function(e){return{changeMessage:function(t){return e({type:"inbox/changeMessage",payload:t})}}}))(D);var R=n(43144),P=n(18446),V=n.n(P),A=function(e){function t(){var t;return(t=e.call(this)||this).replaceImgSrc=function(){for(var e=document.querySelectorAll(".msg-reply figure img"),t=0;t<e.length;t++){var n=e[t].getAttribute("data-actualsrc");n&&(e[t].src=n)}},t.fetchReplyList=function(){var e=t.state,n=e.pageIndex,a=e.list,r=t.props,s=r.projectId,i=r.categoryId,l=r.group,o=r.oid,c=r.suboid,d=r.sourceId;t.setState({loading:!0},(function(){v.h.post("/message/talk/list",{projectId:s,categoryId:i,group:l,oid:o,suboid:c,sourceId:d,pageIndex:n,pageSize:15}).then((function(e){var n=e.data;if(2e4===n.code){var r=n.result,s=r.total,i=r.list;t.setState({total:s,list:a.concat(i)})}})).finally((function(){t.setState({loading:!1,isInitial:!1})}))}))},t.handleCollapse=function(){var e=t.state.collapsed;t.setState({collapsed:!e})},t.handleClickMoreBtn=function(){var e=t.state,n=e.pageIndex,a=e.collapsed,r=e.moreBtnClickTimes;t.setState({pageIndex:a?n:n+1,moreBtnClickTimes:r+1},(function(){return!a&&t.fetchReplyList()}))},t.state={pageIndex:1,total:0,list:[],isInitial:!0,loading:!1,collapsed:!0,moreBtnClickTimes:0},t}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.fetchReplyList()},n.componentDidUpdate=function(e,t){var n=this.state,a=n.list,r=n.moreBtnClickTimes;(0===r||r>0&&t.list.length!==a.length)&&this.replaceImgSrc()},n.render=function(){var e=this.state,t=e.total,n=e.list,a=e.loading,r=(e.isInitial,e.pageIndex),s=e.collapsed,i=t>15?t-15*r:0,l=n.length>0?function(e){var t=document.createElement("canvas");document.body.appendChild(t);var n=t.getContext("2d");n.font="12px Arial";var a=n.measureText(e).width;return document.body.removeChild(t),Math.ceil(a)}(Math.max.apply(null,n.map((function(e){return e.likes}))))+14+24+119:0;return d.createElement("div",{className:"msg-reply-wrapper",style:{display:t?"block":"none"}},s?d.createElement("div",null,d.createElement("span",{className:"username"},n.length>0&&n[0].username," \u7b49\u4eba "),d.createElement("span",{className:"operation",onClick:this.handleCollapse},"\u5171",t,"\u6761\u56de\u590d",d.createElement("i",{className:"icon-cem_show-more"}))):n.map((function(e,t){return d.createElement("div",{className:"msg-reply",key:e.cTime+"-"+t},d.createElement("div",{className:"msg-reply-left",style:{width:"calc(100% - "+(l+24)+"px)"}},d.createElement("span",{className:"username"},e.username,"\uff1a"),d.createElement("span",{className:"content",dangerouslySetInnerHTML:{__html:e.content}})),d.createElement("div",{className:"msg-reply-right fade",style:{width:l+10}},d.createElement("i",{className:"icon-cem_weibo-fabulous"}),d.createElement("span",null,N.ZP.getApproximateNum(e.likes)),d.createElement("span",null,e.cTime)))})),a&&d.createElement(E.Loading,null),r>=1&&d.createElement("div",{className:s?"msg-reply-footer":"msg-reply-footer expand"},i>0&&!s&&d.createElement("span",{className:"operation",onClick:this.handleClickMoreBtn},"\u66f4\u591a",i,"\u6761\u56de\u590d",d.createElement("i",{className:"icon-cem_arrow-launches"})),!s&&d.createElement("span",{className:"operation collapse",onClick:this.handleCollapse},"\u6536\u8d77\u5168\u90e8")))},t}(d.Component);A.propTypes={projectId:f().string.isRequired,categoryId:f().number.isRequired,group:f().string.isRequired,oid:f().string.isRequired,suboid:f().string.isRequired,sourceId:f().string.isRequired};const F=A;var Z=n(29030),W=n(21554),B=n(94184),U=n.n(B),H=(n(53294),n(56697)),j=(n(77785),n(59361)),J=(n(1025),n(65400)),z=n(76570),q=n(79508),G=n(78924),Y=n.n(G),K=n(55898),Q=n(87219),X=n(5133),$=n(61409),ee=["onClose","onConfirm","projectId","messageId","visible","customTag","messageType"];const te=function(e){var t=e.onClose,n=e.onConfirm,r=e.projectId,s=e.messageId,i=(e.visible,e.customTag),l=e.messageType,o=((0,a.Z)(e,ee),(0,d.useState)([])),u=o[0],m=o[1],p=(0,d.useState)([]),g=p[0],f=p[1],v=(0,d.useState)([]),E=v[0],y=v[1],C=(0,d.useState)(""),S=C[0],N=C[1],w=(0,d.useState)(!1),k=w[0],T=w[1],L=(0,d.useState)([]),b=L[0],O=L[1],x=(0,d.useState)([]),D=x[0],M=x[1],R=(0,d.useRef)();(0,d.useEffect)((function(){var e=(0,Q.ZP)(i,(function(e){e.forEach((function(e){e.name=e.tagName,e.id=e.tagId,e.checked=!0}))})),t=e.filter((function(e){return!e.systemTag})),n=e.filter((function(e){return e.systemTag}));M(t),m(t),O(n),P(t)}),[]);var P=function(){var e=(0,_.Z)(I().mark((function e(t){var n,a,s,i;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,K.gA)({projectId:r});case 2:n=e.sent,a=n.data,s=a.code,i=a.result,2e4===s&&(i.map((function(e){t.find((function(t){return t.id===e.id}))?e.checked=!0:e.checked=!1})),y(i));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=(0,d.useCallback)(h()(function(){var e=(0,_.Z)(I().mark((function e(t){var n,a,s,i,l,o;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],t){e.next=3;break}return e.abrupt("return",f([]));case 3:return e.next=5,(0,K.TD)({projectId:r,tagName:t});case 5:a=e.sent,s=a.data,i=s.code,l=s.result,2e4===i&&(0===l.length?n=[{name:"\u65b0\u589e\u201c"+t+"\u201d\u6807\u7b7e",checked:!1,orginName:t}]:(o=l.find((function(e){return e.name===t})),n=o?l:[{name:"\u65b0\u589e\u201c"+t+"\u201d\u6807\u7b7e",checked:!1,orginName:t}].concat(l)),f(n));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),300),[]),A=function(){var e=(0,_.Z)(I().mark((function e(t,n){var a,s,i,l,o,c,d,p,h,g,v,C;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name,s=t.orginName,i=t.id,l=t.checked,o={name:a,id:i,checked:l,orginName:s},i){e.next=12;break}return e.next=5,(0,K.cL)({projectId:r,tagName:s});case 5:if(c=e.sent,d=c.data,p=d.code,h=d.result,2e4===p){e.next=12;break}throw X.Z.error(h.msg),Error("\u6807\u7b7e\u91cd\u590d");case 12:if(!l){e.next=18;break}return g=(0,Q.ZP)(E,(function(e){var t=n||e.findIndex((function(e){return e.name===a}));e[t].checked=!1})),y(g),v=(0,Q.ZP)(u,(function(e){var t=e.findIndex((function(e){return e.name===a}));e.splice(t,1)})),m(v),e.abrupt("return");case 18:o.name=i?a:s,o.checked=!0,N(""),f([]),!u.find((function(e){return e.name===o.name}))&&m([].concat(u,[o])),C=(0,Q.ZP)(E,(function(e){var t=e.findIndex((function(e){return e.name===o.name}));-1!==t&&e.splice(t,1),e.unshift(o)})),y(C);case 26:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),F=function(){var e=(0,_.Z)(I().mark((function e(){var t,a,i,o,c,d,m,p,h;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T(!0),t=[],a=[],u.map((function(e){e.id?t=[].concat(t,[e.id]):a=[].concat(a,[e.name])})),i=D.map((function(e){return e.id})),o=i.filter((function(e){return!t.includes(e)})),0!==t.length||0!==a.length||0!==o.length){e.next=7;break}return e.abrupt("return",n());case 7:return c={projectId:r,messageId:s,service:"SERVICE"===l,tagId:t,tagName:a,removeId:o},e.next=10,(0,K.LG)(c);case 10:d=e.sent,m=d.data,p=m.code,h=m.msg,T(!1),2e4===p&&n(),X.Z.success(h);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=d.createElement(d.Fragment,null,d.createElement("p",{className:"tag_footer_text",style:{color:Y()["primary-color"]},onClick:function(){return function(e){var t=c.t.get("projectName");c.t.set(c.V.backProjectConfig,{name:t,id:r}),$.mW.push(e)}("/account/project/tag")}},"\u67e5\u770b\u6807\u7b7e\u5e93"),d.createElement(J.default,{key:"back",onClick:t},"\u53d6\u6d88"),d.createElement(J.default,{key:"submit",type:"primary",onClick:F,loading:k},"\u786e\u5b9a"));return d.createElement(H.Z,{title:"\u8bbe\u7f6e\u6807\u7b7e",visible:!0,onCancel:t,onOk:n,width:"560px",wrapClassName:"tag_dialog",footer:Z},d.createElement("div",{className:"tag_box",ref:R},d.createElement("div",{className:"tag_box_containter"},u.map((function(e,t){return d.createElement(j.default,{key:t,closable:!0,onClose:function(){return function(e,t){var n=(0,Q.ZP)(u,(function(e){e.splice(t,1)}));m(n);var a=(0,Q.ZP)(E,(function(t){var n=t.findIndex((function(t){return t.name===e.name}));t[n].checked=!1}));y(a)}(e,t)},visible:!0},e.name)})),d.createElement("input",{placeholder:"\u65b0\u589e\u6216\u641c\u7d22\u6807\u7b7e",onChange:function(e){var t=e.target.value.replace(/\s/g,"").slice(0,30);N(t),V(t)},onFocus:function(){return R.current.classList.add("tag_box_fcous")},onBlur:function(){return R.current.classList.remove("tag_box_fcous")},value:S,maxLength:30,onKeyDown:function(e){return function(e,t){var n=e.keyCode;if(13===n&&g.length>0&&A(g[0]),8===n&&!t){var a=u.slice(-1)[0];u.length>0&&A(a)}}(e,S)}})),d.createElement(z.Z,{style:{color:"#E5E5E5FF",marginLeft:"auto"}})),g&&g.length?d.createElement("ul",{className:"tag_ul"},g.map((function(e,t){return d.createElement("li",{key:t,className:"tag_ul_li",onClick:function(){return A(e)}},e.name)}))):d.createElement(d.Fragment,null,E&&E.length>0&&d.createElement("div",{className:"recently_box"},d.createElement("p",{className:"recently_title"},"\u6700\u8fd1\u4f7f\u7528"),d.createElement("ul",{className:"tag_ul"},E.map((function(e,t){return d.createElement("li",{key:t,className:"tag_ul_li "+(e.checked&&"tag_ul_li_active"),style:{backgroundColor:e.checked?Y()["primary-color"]:"white"},onClick:function(){return A(e,t)}},e.checked&&d.createElement(q.Z,{className:"tag_checked"}),e.name)})))),b&&b.length>0&&d.createElement("div",{className:"recently_box"},d.createElement("p",{className:"recently_title"},"\u7cfb\u7edf\u6807\u7b7e"),d.createElement("ul",{className:"tag_ul"},b.map((function(e,t){return d.createElement("li",{key:t,className:"tag_ul_li_default tags_stystm"},e.name)}))))))};var ne=n(64396),ae=ne.Z.message.inboxDetail,re=function(e){function t(t){var n;(n=e.call(this,t)||this)._processContent=function(){if(n.contentRef.getElementsByTagName("img").length>0){var e=2;n.intToken=setInterval((function(){e>0?n.contentRef&&n.contentRef.scrollHeight>n.contentMaxHeight?(n.setState({loading:!1,showCollapse:!0}),clearInterval(n.intToken)):e--:(n.setState({loading:!1}),clearInterval(n.intToken))}),200)}else n.contentRef&&n.contentRef.scrollHeight>n.contentMaxHeight?n.setState({showCollapse:!0,loading:!1}):n.setState({loading:!1})},n._getImg=function(e,t){new Promise((function(t,n){var a=document.getElementById("imgframe").contentWindow.document.createElement("img"),r=e.getAttribute("data-original")||e.getAttribute("data-actualsrc")||e.getAttribute("src")||null;a.src=r,a.onload=function(){t(r)}})).then((function(n){e.src=n,t&&t(n)}))},n._isShouldContentAlignRight=function(e,t,a){var r=n.props.data,s=r.showDetailType,i=r.type,l=s||i;return!(!a||"\u56de"!==l&&"\u5907"!==l||!(t>0))&&(0,N.jD)(e,14)<t-24-32-32-180},n._handleImgPreview=function(e,t,a){var r=a.map((function(e){return{thumbnail:e,original:e}}));n.setState({isShowPreview:!0,sourcePicArr:r,startIndex:t})},n._renderPictures=function(e){var t=e.pictures,a=e.vimg,r=e.video,s=e.messageCategory,i=e.sourceId;if(["WEIBO","COMMENT","SELF"].includes(s)){var l=[];try{l=JSON.parse(t),"1"===i&&l.forEach((function(e,t){return l[t]=e.replace(/s\d{2,3}x\d{2,3}/,"s960x960")})),"51"===i&&l.forEach((function(e,t){return l[t]=e.replace(/US\d{2,3}/,"US960")}))}catch(o){}return(a||l.length>0)&&d.createElement("div",{className:"picture_weibo"},a&&d.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},d.createElement("span",{className:"video_cover",style:{backgroundImage:"url("+a+")"}},d.createElement("i",{className:"icon-shipinbofang"}))),l.length>0&&l.reduce((function(e,t,a){return a<9?[].concat(e,[d.createElement("span",{data_count:"+"+(l.length-9),className:"pic_cover "+(l.length>9&&8===a?"pic_end":""),key:a,style:{backgroundImage:"url("+t+")"},onClick:function(e){n._handleImgPreview(e,a,l)}},d.createElement("img",{src:t,style:{width:"100%",height:"100%"}}))]):e}),[]),d.createElement(W.Z,{startIndex:n.state.startIndex,images:n.state.sourcePicArr,closeDialog:function(){n.setState({isShowPreview:!1})},isShow:n.state.isShowPreview}))}},n._handleOnShowAllContentClick=function(){n.setState({isCollapse:!n.state.isCollapse})},n._handleputTag=function(){n.setState({tagsDialogVisbile:!0})},n._handleTagClose=function(){n.setState({tagsDialogVisbile:!1})},n._handleTagConfirm=function(){var e=n.props,t=e.data,a=t.id,r=t.index;(0,e.updateMessInfoTags)({id:a,index:r}),n.setState({tagsDialogVisbile:!1})},n.contentRef=void 0;var a=t.data.content,r=t.contentWidth,s=t.options,i=t.detailParams.messageCategory,l=s.includes("alignRight");return n.state={shouldContentAlignRight:n._isShouldContentAlignRight(a,r,l),shouldAlignRight:l,showCollapse:!1,loading:!0,isCollapse:!["COMMENT","APP_COMMENT"].includes(i),isShowPreview:!1,startIndex:0,sourcePicArr:[],tagsDialogVisbile:!1,currentHighLight:[],isTagHover:!1},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._processContent()},n.componentDidUpdate=function(e,t){var n=e.contentWidth,a=this.props,r=a.contentWidth,s=a.data.content,i=a.highLightInfoList,l=this.state.shouldAlignRight;n!==r&&this.setState({shouldContentAlignRight:this._isShouldContentAlignRight(s,r,l)}),V()(i,e.highLightInfoList)||this.setState({currentHighLight:i})},n.render=function(){var e=this,t=this.state,n=t.shouldContentAlignRight,a=t.shouldAlignRight,r=t.showCollapse,s=t.isCollapse,i=t.isTagHover,l=t.loading,o=t.tagsDialogVisbile,c=t.currentHighLight,m=this.props,p=m.data,h=p.id,g=p.content,f=p.pictures,v=p.originSource,C=p.repostsCount,S=p.commentsCount,w=p.attitudesCount,k=p.viewsCount,_=p.categoryId,T=p.oid,I=p.group,L=p.suboid,b=p.sourceId,O=p.sourceName,x=p.aspectVos,D=p.tagVos,M=p.score,R=p.dataLevel,P=p.title,V=p.code,A=p.target,W=p.question,B=p.requirement,H=p.money,j=p.url,J=p.progress,z=p.questionnaireName,q=(p.messageId,p.video),G=p.vimg,Y=p.type,K=p.highLightInfoList,Q=m.MESSAGE_TYPE,X=m.detailParams,$=X.messageCategory,ee=X.projectId,ne=m.options,ae=m.isTagClicked,re=m.fetchedTag,se=m.handleTagClick,ie=m.harmonyEvent,le=m.onFeedbackClick,oe=m.tagModalHidden,ce=R&&/^COMMENT/.exec(R),de=["COMMENT","APP_COMMENT"].includes($);return d.createElement("div",{className:"yt_message_detail_content"},d.createElement("div",{className:"content_wrapper "+("COMMENT"===$?"comment_content_wrapper":"")+" "+this.props.classNames},(["QUE_ANS_QUESTION","POST","NEWS","COMPLAINT","SELF_POST","VIDEO","OFFICIAL_ACCOUNT"].includes(R)||["APP_COMMENT","SELF"].includes($))&&d.createElement("div",{className:"sub_title "+(["APP_COMMENT","SELF"].includes($)?"bold":""),dangerouslySetInnerHTML:{__html:ie(P)}}),"VIDEO"===R&&d.createElement("a",{href:j,target:"_blank",rel:"noopener noreferrer",style:{color:"#0847a6"}},"\u67e5\u770b\u539f\u94fe\u63a5"),"COMPLAINT"===R&&d.createElement("div",{className:"complaint_wrapper"},d.createElement("div",null,d.createElement("span",null,"\u6295\u8bc9\u7f16\u53f7\uff1a",V),d.createElement("span",null,"\u6295\u8bc9\u5bf9\u8c61\uff1a",A)),d.createElement("div",null,d.createElement("span",null,"\u6295\u8bc9\u95ee\u9898\uff1a",W),d.createElement("span",null,"\u6295\u8bc9\u8981\u6c42\uff1a",B)),d.createElement("div",null,d.createElement("span",null,"\u6d89\u8bc9\u91d1\u989d\uff1a",N.ZP.getApproximateNum(parseInt(H)),"\u5143"),d.createElement("span",null,"\u6295\u8bc9\u8fdb\u5ea6\uff1a",J))),d.createElement(E.Loading,{loading:l,className:"content_loading"},d.createElement("div",{className:"content_card_titlte"},d.createElement("span",null,z||"")),d.createElement("div",{ref:function(t){return e.contentRef=t},className:U()("content",{content_text:s}),style:{maxHeight:s?this.contentMaxHeight:"unset",textAlign:n?"right":"left",marginRight:a?180:"COMMENT"===$?90:60,lineHeight:"COMMENT"===$?"28px":"unset",minHeight:"30px"}},d.createElement("div",{className:$,dangerouslySetInnerHTML:{__html:ie(g,c.concat((null==K?void 0:K.length)>0?K:[]),i)}}),["COMMENT","APP_COMMENT","TICKET","SELF"].includes($)&&("COMMENT_REPLY"!==R||"SELF"===$)&&"\u5907"!==Y&&"\u5b98\u65b9\u56de\u590d"!==Y&&re?d.createElement("span",{className:"feedback",onClick:function(){return le({messageContent:g,messageId:h,aspectVos:x||[]})}},d.createElement("i",{className:"icon-fankui"}),"\u53cd\u9988"):null)),(f||G)&&this._renderPictures({pictures:f,vimg:G,video:q,messageCategory:$,sourceId:b}),r&&!de&&d.createElement("div",{className:"content_search",onClick:this._handleOnShowAllContentClick},s?"\u663e\u793a\u5168\u6587":"\u6536\u8d77\u5168\u6587")),!["bdtb","bd"].includes(Z.z[O])&&ne.includes("property")&&d.createElement("div",{className:"property"},v&&d.createElement("span",{className:"tail"},v),d.createElement("span",{className:"social"},void 0!==C&&d.createElement("span",{className:"repost"},N.ZP.getApproximateNum(C)),void 0!==S&&d.createElement("span",{className:"comment"},N.ZP.getApproximateNum(S)),void 0!==k&&d.createElement("span",{className:"views"},N.ZP.getApproximateNum(k)),void 0!==w&&d.createElement("span",{className:"attitude"},N.ZP.getApproximateNum(w)))),ne.includes("score")&&d.createElement("div",{className:"score"},"\u51c0\u63a8\u8350\u503c\uff1a",M,"\u5206"),ne.includes("reply")&&d.createElement(F,{categoryId:_,oid:T,group:I,projectId:ee,suboid:L,sourceId:b}),"38"!==b&&!ce&&(D&&D.length||x&&x.length)?d.createElement("div",{className:"line_message"}):null,!oe&&d.createElement("div",{className:"tags"},d.createElement("span",{className:"name"},"\u6807\u7b7e"),D&&D.map((function(t){return d.createElement(y.Z,{key:t.tagId,mouseEnterDelay:.5,placement:"bottom",overlayClassName:"custom-tag-popver",overlay:d.createElement("div",{className:"aspects_tip"},d.createElement("p",null,d.createElement("span",null,t.systemTag?"\u7cfb\u7edf\u6807\u7b7e":"\u81ea\u5b9a\u4e49\u6807\u7b7e"),d.createElement("span",null,t.tagValue)))},d.createElement("span",{key:t.tagId,className:ae&&ae.tagId===t.tagId&&ae.id===h?"tags_stystm active":"tags_stystm",style:(0,u.JG)(t),onMouseEnter:function(){se&&se(t.tagId,h,t),e.setState({isTagHover:!0})},onMouseLeave:function(){se&&se(t.tagId,h,t),e.setState({isTagHover:!1})}},t.tagValue))})),d.createElement("span",{className:"tags_addBtn",onClick:this._handleputTag},d.createElement("i",{className:"icon-cem_add-to"}),"\u6807\u7b7e")),x&&x.length?d.createElement("div",{className:"aspects",style:{paddingTop:D&&D.length?"10px":""}},d.createElement("span",{className:"name"},"\u6307\u6807"),x.map((function(t,n){return d.createElement(y.Z,{key:"aspects_"+n,mouseEnterDelay:.6,overlay:d.createElement("div",{className:"aspects_tip"},d.createElement("p",null,d.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),d.createElement("span",null,t.aspect1Name)),d.createElement("p",null,d.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),d.createElement("span",null,t.aspect2Name)),d.createElement("p",null,d.createElement("span",null,"\u6307\u6807\u60c5\u611f"),d.createElement("span",null,3===t.escore?"\u8d1f\u9762":8===t.escore?"\u6b63\u9762":"--"))),placement:"bottom"},d.createElement("span",{onMouseEnter:function(){var n;return(null==(n=t.highLightInfoList)?void 0:n.length)>0&&e.setState({currentHighLight:[].concat(t.highLightInfoList),isTagHover:{head:8===t.escore?'<a class="highlight-green">':'<a class="highlight-red">',end:"</a>"}})},onMouseLeave:function(){return e.setState({currentHighLight:[],isTagHover:!1})},className:"escore"+t.escore},t.aspect2Name))}))):null,o&&d.createElement(te,{onClose:this._handleTagClose,onConfirm:this._handleTagConfirm,messageId:h,projectId:ee,customTag:D||[],messageType:Q}))},(0,R.Z)(t,[{key:"contentMaxHeight",get:function(){switch(this.props.detailParams.messageCategory){case"QUE_ANS":case"NEWS":return 168;case"COMPLAINT":case"QUESTIONAIRE":return 56;default:return 48}}}]),t}(d.PureComponent);const se=(0,w.connect)((function(e){return{MESSAGE_TYPE:e.inbox.MESSAGE_TYPE}}),(function(e){return{updateMessInfoTags:function(t){return e({type:ae+"/updateMessInfoTags",payload:t})}}}))(re);re.proTypes={data:f().object,contentWidth:f().number,options:f().array.isRequired,detailParams:f().object.isRequired};n(15267);var ie=n(64713);var le={username:"",userHeadUrl:"",email:"",id:"",userId:""},oe=function(e){function t(t){var n;return(n=e.call(this,t)||this).showDialog=function(e){var t=e.data,a=e.callback;n.state.visible?n.setState({visible:!0,data:t,callback:a}):n.setState({visible:!1,data:void 0,callback:void 0},(function(){return n.setState({visible:!0,data:t,callback:a})}))},n.handleSelectUsers=function(e){var t=n.state.data.id,a=e.id;n.setState({data:(0,r.Z)({},n.state.data,e,{id:t,userId:a})})},n.submitTransform=function(){var e=n.transTextarea.value,t=n.state,a=t.data,s=t.callback;(function(e){var t=e.detailId,n=e.id,a=e.connectionId,r=e.remark,s=e.content,i=e.url,l=e.index,o=e.messageId,c=e.escore,d=e.score,u=e.mid,m=e.type;return v.h.post("/message/forward/add",{id:t,connectionId:a,remark:r,content:s,url:i,index:l,userIds:[n],messageId:o,escore:c,score:d,mid:u,type:m})})((0,r.Z)({},a,{id:a.userId,remark:e,type:a.MESSAGE_TYPE})).then((function(e){var t=e.data;2e4===t.code&&(X.Z.success(t.msg),s&&s(n.state.data)),n.setState({visible:!1,data:void 0,callback:void 0,searchKeyword:""})}))},n._handleOnCancel=function(){n.setState({visible:!1,data:void 0,callback:void 0})},n._handleOnChange=function(e){return n.setState({searchKeyword:e.target.value})},n.state={visible:!1,data:void 0,callback:void 0,searchKeyword:""},n}(0,s.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){},a.render=function(){var e=this,t=this.state,a=t.visible,r=t.data,s=void 0===r?le:r,i=t.searchKeyword,l=s.username,o=s.userHeadUrl,c=s.email,u=s.id,m=s.userId;return d.createElement(E.Dialog,{customClass:"yt_inbox_dialog",visible:a,onCancel:function(){return e.setState({dialogVisible:!1})},closeOnClickModal:!1},d.createElement(E.Dialog.Body,{className:"body"},d.createElement("p",{className:"top"},"\u5f53\u524d\u7ecf\u529e\u4eba"),l?d.createElement("div",{className:"user-list"},d.createElement("img",{src:o||n(88958)}),d.createElement("span",{className:"name"},l),d.createElement("span",{className:"email"},"-"+c)):d.createElement("div",{className:"user-list"},d.createElement("img",{src:n(88958)}),d.createElement("span",{className:"name"},"\u6682\u672a\u9009\u62e9")),d.createElement("div",{className:"line"}),d.createElement("input",{onChange:this._handleOnChange,type:"text",placeholder:"\u641c\u7d22"}),d.createElement("p",null,i.trim()?"\u641c\u7d22\u7ed3\u679c":"\u63a8\u8350"),d.createElement("ul",null,this.showUserList.map((function(t,a){return d.createElement("li",{className:"user-list "+(u===t.id||m===t.id?"sel":""),key:a,onClick:function(){return e.handleSelectUsers(t)}},d.createElement("img",{src:t.userHeadUrl||n(88958)}),d.createElement("span",{className:"name"},t.username),d.createElement("span",{className:"email"},"-"+t.email))}))),d.createElement("div",{className:"line"}),d.createElement("textarea",{ref:function(t){return e.transTextarea=t},placeholder:"\u8bf4\u660e\u5907\u6ce8",autoFocus:!0})),d.createElement(E.Dialog.Footer,{className:"dialog-footer"},d.createElement(E.Button,{type:"primary",disabled:!l,onClick:this.submitTransform},"\u786e \u5b9a"),d.createElement(E.Button,{onClick:this._handleOnCancel},"\u53d6 \u6d88")))},(0,R.Z)(t,[{key:"showUserList",get:function(){var e=this.state.searchKeyword,t=this.props.operatorList;return e.trim()?t.filter((function(t){return-1!==t.username.toLocaleLowerCase().indexOf(e.trim().toLocaleLowerCase())||-1!==t.email.toLocaleLowerCase().indexOf(e.trim().toLocaleLowerCase())})):t}}]),t}(d.PureComponent);const ce=oe;var de=n(61193);var ue=n(84122),me=["inbox","loading"],pe=ne.Z.global,he=ne.Z.message.inboxDetail,ge=ne.Z.public.menu,fe={reply:"\u56de\u590d",remark:"\u5907\u6ce8"},ve={0:"\u672a\u89e3\u51b3",1:"\u672a\u89e3\u51b3",2:"\u5df2\u89e3\u51b3",3:"\u89e3\u51b3\u4e2d"},Ee=function(e){function t(t){var n;(n=e.call(this,t)||this)._getPageRef=function(e){return n.pageRef=e},n._handleOnWsMessage=function(e){var t=e.data;if(t.type&&"ws"===t.type){var a=t.payload,r=a.type,s=a.result;"MESSAGE_HANDLE_RESULT"===r&&n.props.data.id===s.id&&setTimeout((function(){n.props.updateRuleSeetingList({ruleSettingList:n.props.ruleSettingList.filter((function(e){return e.id!==s.id}))})}),100)}},n._handleOnRemarkClick=function(){var e=n.props.onEditBoxOpen;n.setState({editType:"remark"},(function(){return e&&e(!0)}))},n._handleOnReplyClick=function(){var e=n.props.onEditBoxOpen;n.setState({editType:"reply"},(function(){return e&&e(!0)}))},n._handleOnCancel=function(){var e=n.props.onEditBoxOpen;n.setState({editType:""},(function(){return e&&e(!1)}))},n._handleOnConfirm=function(){var e=n.state.editType,t=n.props,a=t.data,s=t.projectId,i=t.onEditBoxOpen,l=t.MESSAGE_TYPE,o=t.curSelectMessage,c=a.id,d=a.connectionId,u=a.routing,m=a.sourceName,p=a.mid,h=a.index,g=n.textareaRef.value;g?"remark"===e?function(e){var t=e.id,n=e.connectionId,a=e.mid,r=e.routing,s=e.content,i=e.projectId,l=e.type;return v.h.post("/message/remark/add",{id:t,mid:a,routing:r,content:s,connectionId:n,projectId:i,type:l})}({id:c,connectionId:d,mid:p,routing:u,content:g,projectId:s,type:l||o.messageCategory}).then((function(e){2e4===e.data.code&&n.setState({editType:""},(function(){n._handleRefreshDetail(c,h),i&&i(!1)}))})):"reply"===e&&(0,ue.YG)((function(t){var l=Z.z[m];"xl"===l?(0,ue.Pl)(t,a,g,(function(t){return function(e){return v.h.post("/message/weibo/reply/add",{id:e.id,projectId:e.projectId,insertTimestamp:e.timestamp,img:e.profile_image_url,uid:e.uid,username:e.screen_name,content:e.content})}((0,r.Z)({},t,{projectId:s})).then((function(){X.Z.success("\u56de\u590d\u6210\u529f"),n.setState({editType:""},(function(){n._handleRefreshDetail(c,h,e),i&&i(!1)}))})).catch((function(){return X.Z.error("\u56de\u590d\u5931\u8d25")}))})):"bd"===l||"bdtb"===l?(0,ue.VG)(t,a,g,(function(t){return function(e){return v.h.post("/message/baidu/reply/add",{id:e.id,projectId:e.projectId,insertTimestamp:e.timestamp,img:e.headImg,uid:e.id,username:e.username,content:e.content})}((0,r.Z)({},t,{projectId:s})).then((function(){X.Z.success("\u56de\u590d\u6210\u529f"),n.setState({editType:""},(function(){n._handleRefreshDetail(c,h,e),i&&i(!1)}))})).catch((function(){return X.Z.error("\u56de\u590d\u5931\u8d25")}))})):"zh"===l&&(0,ue.Rr)(t,a,g,(function(t){return function(e){return v.h.post("/message/zhihu/reply/add",{projectId:e.projectId,id:e.id,answerId:e.id,insertTimestamp:e.created_time,img:e.avatar_url,uid:e.uid,username:e.name,userDesc:e.headline,userHome:e.url,content:e.content})}((0,r.Z)({},t,{projectId:s})).then((function(){X.Z.success("\u56de\u590d\u6210\u529f"),n.setState({editType:""},(function(){n._handleRefreshDetail(c,h,e),i&&i(!1)}))})).catch((function(){return X.Z.error("\u56de\u590d\u5931\u8d25")}))}))})):X.Z.error("\u8bf7\u8f93\u5165\u5185\u5bb9")},n._handleOnStatusChange=function(e){var t=n.props,a=t.data,r=a.id,s=a.routing,i=a.index,l=t.projectId,o=t.MESSAGE_TYPE;(function(e){var t=e.id,n=e.routing,a=e.projectId,r=e.status,s=e.type;return v.h.post("/message/private/operate",{id:t,routing:n,projectId:a,status:r,type:s})})({id:r,routing:s,status:e,projectId:l,type:o}).then((function(t){2e4===t.data.code&&n.setState({status:e},(function(){return n._handleRefreshDetail(r,i)}))}))},n._handleOnOperatorClick=function(){var e=n.props,t=e.data,a=e.fetchPersonalCount,s=e.MESSAGE_TYPE;n.opeDialogRef&&n.opeDialogRef.showDialog({data:(0,r.Z)({},t.messageVO,{connectionId:t.connectionId,mid:t.mid,content:t.content,routing:t.routing,url:t.url,detailId:t.id,index:t.index,messageId:t.messageId,escore:t.escore,score:t.score,MESSAGE_TYPE:s}),callback:function(e){n._handleRefreshDetail(t.id,t.index),e.userId===de.Z.getUser().userId&&a()}})},n._handleRefreshDetail=function(e,t,a){var r=n.props.data.messageCategory;"reply"===a?(n.props.resetPageIndex(),n.props.fetchMsgDetail()):"SERVICE"===r?(n.props.resetPageIndex(),n.props.fetchCustomerServiceDetail()):n.props.fetchSpecifyMsg({id:e,index:t})},n._renderValidateOverlay=function(){var e=n.props,t=e.data,a=e.settingMessageInvalidate,s=e.settingMessageValidate,i=n.props.ruleSettingList.find((function(e){return e.id===n.props.data.id})),l=t.tagVos&&t.tagVos.find((function(e){return"\u65e0\u6548\u6570\u636e"===e.tagName}))||!1,o=i||a||s,c=de.Z.getUser(),u="",m="";return o?(i?m="\u7cfb\u7edf\u6b63\u5728\u5c06\u6b64\u6d88\u606f\u6309\u89c4\u5219\u5904\u7406...":a?m="\u7cfb\u7edf\u6b63\u5728\u5c06\u6b64\u6d88\u606f\u6807\u8bb0\u4e3a\u65e0\u6548\u6570\u636e...":s&&(m="\u7cfb\u7edf\u6b63\u5728\u5c06\u6b64\u6d88\u606f\u6807\u8bb0\u4e3a\u6709\u6548\u6570\u636e..."),u=d.createElement("div",{className:"history_content"},i&&i.msgHistory||n.msgHistory)):(m=l?"\u5c06\u6b64\u6d88\u606f"+(t.msgHistory?"\u91cd":"")+"\u8bbe\u4e3a\u6709\u6548\u6570\u636e\uff1f":"\u5c06\u6b64\u6d88\u606f"+(t.msgHistory?"\u91cd":"")+"\u8bbe\u4e3a\u65e0\u6548\u6570\u636e\uff1f",t.msgHistory&&(u="GARBAGE_BY_RULE"===t.msgType?d.createElement("div",{className:"history_content"},"\u6b64\u6d88\u606f\u88ab\u65e0\u6548\u6570\u636e\u89c4\u5219\u300c"+t.msgHistory+"\u300d\u81ea\u52a8\u6807\u8bb0\u4e3a\u65e0\u6548\u6570\u636e"):d.createElement(d.Fragment,null,d.createElement("div",{className:"history_content"},t.msgHistory),d.createElement(ie.default.Group,{className:"history_content_radio",value:n.state.validateRuleType,onChange:function(e){n.setState({validateRuleType:e.target.value})}},d.createElement(ie.default,{value:"validate"},'\u8bbe\u4e3a"'+(l?"\u6709":"\u65e0")+'\u6548\u6570\u636e"'),d.createElement(ie.default,{value:"rule"},"\u6309\u89c4\u5219\u5904\u7406"))))),d.createElement("div",{className:"validate_status_overlay"},d.createElement("div",{className:"validate_status_title"},m),d.createElement("div",{className:"validate_status_content"},u),!o&&d.createElement("div",{className:"validate_status_bottom"},d.createElement(J.default,{className:"btn_confirm",size:"small",type:"primary",onClick:function(){var e=n.props,a=e.setMessageHandleByRule,s=e.setMessageValidate,i=e.setMessageInvalidate,o=n.state.validateRuleType,d={id:t.id,index:t.index};n.msgHistory="\u6b64\u6d88\u606f\u88ab "+c.username+"\uff08"+c.email+"\uff09\u4e8e"+S()().format("YYYY-MM-DD HH:mm")+"\u8bbe\u4e3a","rule"===o?(n.msgHistory+="\u6309\u89c4\u5219\u5904\u7406",n.setState({validateRuleType:"validate"},(function(){return a((0,r.Z)({},d,{msgHistory:n.msgHistory}))}))):l?(n.msgHistory+="\u6709\u6548\u6570\u636e",s((0,r.Z)({},d,{msgHistory:n.msgHistory}))):(n.msgHistory+="\u65e0\u6548\u6570\u636e",i((0,r.Z)({},d,{msgHistory:n.msgHistory})))}},"\u786e\u5b9a")))};var a=Object.keys(ve).map((function(e){return{title:ve[e],value:parseInt(e)}}));return n.state={editType:"",status:t.data.status,statusOptions:a,validateRuleType:"validate"},n.msgHistory="",n.textareaRef=void 0,n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){window.addEventListener("message",this._handleOnWsMessage)},n.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage)},n.render=function(){var e=this,t=this.props,n=t.data,a=n.id,r=n.messageId,s=(n.originSource,n.repostsCount,n.commentsCount),i=(n.attitudesCount,n.relatedCount),l=(n.viewsCount,n.likesCount),o=n.collectionsCount,c=n.sourceName,u=n.url,m=n.dataLevel,p=t.options,h=(t.modelType,t.operatorList),g=t.notContain,f=void 0===g?[]:g,v=(t.messageStatus,t.total),E=t.inboxIndex,y=t.MESSAGE_TYPE,C=(t.messageCategory,t.projectId,t.onStateChange),S=this.state,w=S.editType;S.statusOptions,S.status,this.props.data.messageVO;return d.createElement(d.Fragment,null,d.createElement("div",{className:"yt_message_detail_footer "+this.props.classNames},w?d.createElement("div",{className:"edit_view"},d.createElement("textarea",{ref:function(t){return e.textareaRef=t},placeholder:"\u8bf7\u8f93\u5165...",autoFocus:!0}),d.createElement("div",null,d.createElement(J.default,{onClick:this._handleOnCancel},"\u53d6\u6d88"),d.createElement(J.default,{type:"primary",onClick:this._handleOnConfirm},fe[w]))):d.createElement("div",{className:"button_view"},!f.includes("source")&&d.createElement("a",{className:"btn_item btn_source",href:u,target:"_blank",rel:"noopener noreferrer"},"\u6570\u636e\u6e90"),d.createElement("span",{className:"relative_wkOrder"},de.Z.hasAuthority("ADD_WORK_ORDER")&&d.createElement("span",{className:"relative_wkOrder"},d.createElement("span",{className:"btn_item",onClick:function(){return C("open-add",r||a)}},d.createElement("i",{className:"icon-gongdan"}),"\u521b\u5efa\u5de5\u5355"),d.createElement("span",{className:"btn_item",onClick:function(){return C("open-relate",r||a)}},d.createElement("i",{className:"icon-guanlian"}),"\u5173\u8054\u5de5\u5355",i>0&&d.createElement("span",{style:{marginLeft:"8px"}},i)))),("COMMENT"===y||"SERVICE"===y||"QUESTIONAIRE"===y)&&d.createElement("span",{style:{cssFloat:"right",lineHeight:"28px",color:"#8C8C8C",fontSize:"12px"}},E+1,"\u4e4b",v)),!["bdtb","bd"].includes(Z.z[c])&&(null==p?void 0:p.includes("property"))&&d.createElement("div",{className:"property"},d.createElement(d.Fragment,null,d.createElement("span",{className:"like"},d.createElement("i",{className:"icon-dianzan"}),N.ZP.getApproximateNum(l||0)),"COMMENT"!==m&&"COMMENT_REPLY"!==m&&d.createElement("span",{className:"collection"},d.createElement("i",{className:"icon-guanzhu"}),N.ZP.getApproximateNum(o||0)),"COMMENT"!==m&&"COMMENT_REPLY"!==m&&d.createElement("span",{className:"comment"},d.createElement("i",{className:"icon-cem_default-comment"}),N.ZP.getApproximateNum(s||0))))),h&&d.createElement(ce,{ref:function(t){return e.opeDialogRef=t},operatorList:h}))},t}(d.PureComponent);const ye=(0,w.connect)((function(e){var t=e.inbox,n=e.loading,r=(0,a.Z)(e,me);return{operatorList:r[he].operatorList,MESSAGE_TYPE:t.MESSAGE_TYPE,curSelectMessage:t.curSelectMessage,ruleSettingList:r[""+pe].ruleSettingList,settingMessageInvalidate:n.effects[he+"/setMessageInvalidate"]||!1,settingMessageValidate:n.effects[he+"/setMessageValidate"]||!1}}),(function(e){return{updateRuleSeetingList:function(t){return e({type:pe+"/save",payload:t})},resetPageIndex:function(){return e({type:he+"/save",payload:{pageIndex:0,resetTime:(new Date).getTime()}})},fetchMsgDetail:function(t){return e({type:he+"/fetchMsgDetail",payload:t})},fetchCustomerServiceDetail:function(t){return e({type:he+"/fetchCustomerServiceDetail",payload:t})},fetchSpecifyMsg:function(t){return e({type:he+"/fetchSpecifyMsg",payload:t})},fetchPersonalCount:function(){return e({type:ge+"/fetchPersonalCount"})},setMessageInvalidate:function(t){return e({type:he+"/setMessageInvalidate",payload:t})},setMessageValidate:function(t){return e({type:he+"/setMessageValidate",payload:t})},setMessageHandleByRule:function(t){return e({type:he+"/setMessageHandleByRule",payload:t})}}}))(Ee);Ee.propTypes={projectId:f().string.isRequired,data:f().object.isRequired,modelType:f().string,notContain:f().array.isRequired,onEditBoxOpen:f().func};var Ce=n(66746);const Se=function(e){e.messageType;var t=e.messageList,n=e.loading,a=e.detailParams,r=(e.onMoreClick,e.projectId),s=e.contentWidth,i=e.modelType,l=e.harmonyEvent,c=e.handleTagsClick,u=e.onStateChange,m=e.onFeedbackClick,p=e.getDrawerRef,h=d.useState(!0),g=(h[0],h[1],d.useState("")),f=g[0],v=g[1];return n&&t&&0===t.length?d.createElement(o.Z,null):d.createElement("div",{className:"news_list_wrapper"},function(e,t,n,a,r,s,i,l,o,c){return e&&e.length>0&&e.map((function(e,u){return function(e,t,n,a,r,s,i,l,o,c,u){return d.createElement("div",{className:"\n      "+(t?"msg-wrapper content-market-wrapper":"msg-wrapper content-market-wrapper not-first-msg")+" "+(e.showTopColor?"show-tips-color":"")+"\n      ",key:e.id},d.createElement("div",{className:e.remarkVos&&e.remarkVos.length>0?"time-line":""},d.createElement(M,{avatar:e.uimg,userName:e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:e.score,time:e.ctime,msgType:e.showDetailType||e.type,flag:e.status,id:e.id,index:e.index,routing:e.routing,isWeibo:!1}),d.createElement(se,{classNames:"content-market__content-wrapper",options:"38"===e.sourceId?[]:["property"],data:e,fetchedTag:!0,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o,onFeedbackClick:u})),e.remarkVos&&e.remarkVos.length>0&&e.remarkVos.map((function(t,n){return d.createElement("div",{className:n===e.remarkVos.length-1?"":"time-line",key:t.id},d.createElement(M,{isWeibo:!1,avatar:t.userHeadUrl,userName:t.username||"\u533f\u540d\u7528\u6237",time:t.ctime,msgType:t.showDetailType||t.type,alignDirection:"right"}),d.createElement(se,{classNames:"content-market__content-wrapper",data:t,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o,onFeedbackClick:u}))})),d.createElement(ye,{options:"38"===e.sourceId?["property"]:[],classNames:"38"===e.sourceId?"content-market-msg-footer mr0":"content-market-msg-footer",projectId:n,data:e,modelType:s,notContain:["reply"],messageCategory:e.messageCategory,onStateChange:c}))}(e,0===u,t,n,a,r,s,i,l,o,c)}))}(t,r,s,a,i,l,f,(function(e,t,n){f&&e===f.tagId?f&&v(""):(v({tagId:e,id:t}),c(e,n))}),u,m),d.createElement(Ce.Z,{ref:p}))};var Ne=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.messageList},n.handleScroll=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=n.scrollContainer,a=t.scrollTop,r=t.offsetHeight;t.scrollHeight-a-r<100&&e()}),500)},n.handleOnWindowResize=function(){document.querySelector(".news_list_wrapper")&&n.setState({contentWidth:document.querySelector(".news_list_wrapper").offsetWidth})},n.handleOnMoreClick=function(e){n.props.fetchMsgDetail(e),n.scrollContainer.scrollTo({top:0,behavior:"auto"})},n.state={id:"",contentWidth:0,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]},n.event={},n}(0,s.Z)(t,e),t.getDerivedStateFromProps=function(e,t){var n=t.id,a=t.addedMessageList,r=t.willBeUpdatedData,s=t.resetTime,i=t.messageList,l=e.detailData,o=e.data,c=e.data.id,d=e.specifyData,u=e.resetTime;if(!d&&n===c&&a&&l&&JSON.stringify(a)!==JSON.stringify(l)){var m=JSON.stringify(a.map((function(e){return e.id})))===JSON.stringify(l.map((function(e){return e.id}))),p=o.dataLevel&&"NEWS"===o.dataLevel&&2===t.messageList.length?l:t.messageList.concat(l);return{messageList:m?i.length>l.length?i.slice(0,i.length-l.length).concat(l):l:p,addedMessageList:JSON.parse(JSON.stringify(l))}}if(r&&d&&JSON.stringify(r)!==JSON.stringify(d)){for(var h=JSON.parse(JSON.stringify(t.messageList)),g=0;g<h.length;g++)for(var f=0;f<d.length;f++)h[g]&&d[f]&&h[g].id===d[f].id&&(h[g]=d[f]);return{messageList:h,willBeUpdatedData:d}}return n!==c?{id:c,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:u>s?{resetTime:u,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:null};var n=t.prototype;return n.componentDidMount=function(){this.handleOnWindowResize(),window.addEventListener("resize",this.handleOnWindowResize),this.scrollContainer=document.querySelector(".inbox_wrap .msg_detail_wrap"),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll)},n.componentWillUnmount=function(){this.scrollContainer&&this.scrollContainer.removeEventListener("resize",this.handleScroll)},n.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.projectId,r=e.detailParams,s=e.modelType,i=e.harmonyEvent,l=e.handleTagsClick,o=e.onStateChange,c=e.onFeedbackClick,u=e.getDrawerRef,m=this.state,p=m.messageList,h=m.contentWidth;return d.createElement(Se,{contentWidth:h,detailParams:r,modelType:s,projectId:a,messageList:p,loading:n,messageType:t.dataLevel,harmonyEvent:i,onMoreClick:this.handleOnMoreClick,handleTagsClick:l,onStateChange:o,onFeedbackClick:c,getDrawerRef:u})},t}(d.PureComponent);const we=function(e){var t=e.messageType,n=e.messageList,a=e.loading,r=e.detailParams,s=e.onMoreClick,i=e.projectId,l=e.contentWidth,c=e.modelType,u=e.harmonyEvent,m=e.handleTagsClick,p=e.onStateChange,h=d.useState(!0),g=h[0],f=h[1],v=d.useState(""),E=v[0],y=v[1],C=function(e,t,n){E&&e===E.tagId?E&&y(""):(y({tagId:e,id:t}),m(e,n))},S=function(e,t,n,a,r,s,i,l,o,c){return d.createElement("div",{className:t?"msg-wrapper new-media-wrapper":"msg-wrapper new-media-wrapper not-first-msg",key:e.id},d.createElement("div",{className:e.remarkVos&&e.remarkVos.length>0?"time-line":""},d.createElement(M,{avatar:e.uimg,userName:e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:e.score,time:e.ctime,msgType:e.showDetailType||e.type,flag:e.status,id:e.id,index:e.index,routing:e.routing}),d.createElement(se,{options:["property"],data:e,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o})),e.remarkVos&&e.remarkVos.length>0&&e.remarkVos.map((function(t,n){return d.createElement("div",{className:n===e.remarkVos.length-1?"":"time-line",key:t.id},d.createElement(M,{avatar:t.userHeadUrl,userName:t.username||"\u533f\u540d\u7528\u6237",time:t.ctime,msgType:t.showDetailType||t.type,alignDirection:"right"}),d.createElement(se,{options:["property","alignRight"],data:t,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o}))})),d.createElement(ye,{projectId:n,data:e,modelType:s,notContain:["reply"],messageCategory:e.messageCategory,onStateChange:c}))};return a&&n&&0===n.length?d.createElement(o.Z,null):t&&"QUE_ANS_TALK"===t&&g?d.createElement("div",{className:"news_list_wrapper"},n&&n[0]&&S(n[0],!0,i,l,r,c,u,E,C,p),d.createElement("div",{className:"expand-more"},d.createElement("span",{onClick:function(){return f(!1),void s(r)}},"\u67e5\u770b\u66f4\u591a",d.createElement("i",{className:"icon-cem_cross-page"}))),n&&n[1]&&S(n[1],!1,i,l,r,c,u,E,C,p)):d.createElement("div",{className:"news_list_wrapper"},function(e,t,n,a,r,s,i,l,o){return e&&e.length>0&&e.map((function(e,c){return S(e,0===c,t,n,a,r,s,i,l,o)}))}(n,i,l,r,c,u,E,C,p))};var ke=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.messageList},n.handleScroll=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=n.scrollContainer,a=t.scrollTop,r=t.offsetHeight;t.scrollHeight-a-r<100&&e()}),500)},n.handleOnWindowResize=function(){document.querySelector(".news_list_wrapper")&&n.setState({contentWidth:document.querySelector(".news_list_wrapper").offsetWidth})},n.handleOnMoreClick=function(e){n.props.fetchMsgDetail(e),n.scrollContainer.scrollTo({top:0,behavior:"auto"})},n.state={id:"",contentWidth:0,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]},n.event={},n}(0,s.Z)(t,e),t.getDerivedStateFromProps=function(e,t){var n=t.id,a=t.addedMessageList,r=t.willBeUpdatedData,s=t.resetTime,i=t.messageList,l=e.detailData,o=e.data,c=e.data.id,d=e.specifyData,u=e.resetTime;if(!d&&n===c&&a&&l&&JSON.stringify(a)!==JSON.stringify(l)){var m=JSON.stringify(a.map((function(e){return e.id})))===JSON.stringify(l.map((function(e){return e.id}))),p=o.dataLevel&&"NEWS"===o.dataLevel&&2===t.messageList.length?l:t.messageList.concat(l);return{messageList:m?i.length>l.length?i.slice(0,i.length-l.length).concat(l):l:p,addedMessageList:JSON.parse(JSON.stringify(l))}}if(r&&d&&JSON.stringify(r)!==JSON.stringify(d)){for(var h=JSON.parse(JSON.stringify(t.messageList)),g=0;g<h.length;g++)for(var f=0;f<d.length;f++)h[g]&&d[f]&&h[g].id===d[f].id&&(h[g]=d[f]);return{messageList:h,willBeUpdatedData:d}}return n!==c?{id:c,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:u>s?{resetTime:u,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:null};var n=t.prototype;return n.componentDidMount=function(){this.handleOnWindowResize(),window.addEventListener("resize",this.handleOnWindowResize),this.scrollContainer=document.querySelector(".inbox_wrap .msg_detail_wrap"),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll)},n.componentWillUnmount=function(){this.scrollContainer&&this.scrollContainer.removeEventListener("resize",this.handleScroll)},n.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.projectId,r=e.detailParams,s=e.modelType,i=e.harmonyEvent,l=e.handleTagsClick,o=e.onStateChange,c=this.state,u=c.messageList,m=c.contentWidth;return d.createElement(we,{contentWidth:m,detailParams:r,modelType:s,projectId:a,messageList:u,loading:n,messageType:t.dataLevel,harmonyEvent:i,onMoreClick:this.handleOnMoreClick,handleTagsClick:l,onStateChange:o})},t}(d.PureComponent),_e=function(e,t,n,a,s,i,l,o,c,u,m,p){return d.createElement("div",{className:t?"msg-wrapper social-media-wrapper":"msg-wrapper social-media-wrapper not-first-msg",key:e.id},d.createElement("div",{className:e.remarkVos&&e.remarkVos.length>0?"time-line":""},d.createElement(M,{avatar:e.uimg,userName:e.username||"\u533f\u540d\u7528\u6237",userDescription:e.userDescription,userFocusCount:e.userFocusCount,userFollowerCount:e.userFollowerCount,userBlogCount:e.userBlogCount,userVerifyLevel:e.userVerifyLevel,userGender:e.userGender,emotionScore:e.escore,score:e.score,time:e.ctime,msgType:e.showDetailType||e.type,flag:e.status,id:e.id,index:e.index,routing:e.routing,isWeibo:"WEIBO"===e.messageCategory}),0===i&&l?d.createElement(d.Fragment,null,d.createElement(se,{options:["property"],data:e,contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m}),d.createElement("div",{className:"original-blog"},e.originName&&d.createElement("span",{className:"original-username"},"@",e.originName),d.createElement(se,{options:["property"],data:(0,r.Z)({},e,{content:e.originText,pictures:e.originPics,originSource:"",tagVos:void 0,aspectVos:void 0}),contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m,tagModalHidden:"hidden"})),d.createElement(F,{projectId:n,categoryId:e.categoryId,group:e.group,oid:e.oid,suboid:e.suboid,sourceId:e.sourceId})):d.createElement(se,{options:["property","reply"],data:e,contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m})),e.remarkVos&&e.remarkVos.length>0&&e.remarkVos.map((function(t,n){return d.createElement("div",{className:n===e.remarkVos.length-1?"":"time-line",key:t.id},d.createElement(M,{avatar:t.userHeadUrl,userName:t.username||"\u533f\u540d\u7528\u6237",time:t.ctime,msgType:t.showDetailType||t.type,alignDirection:"right"}),d.createElement(se,{options:["alignRight"],data:t,contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m}))})),d.createElement(ye,{projectId:n,data:e,modelType:o,notContain:t?[]:["reply"],messageCategory:"SOCIAL",onStateChange:p}))};const Te=function(e){var t=e.messageType,n=e.messageList,a=e.loading,r=e.projectId,s=e.contentWidth,i=e.detailParams,l=e.harmonyEvent,c=e.onMoreClick,u=e.modelType,m=e.handleTagsClick,p=e.onStateChange,h=d.useState(!0),g=h[0],f=h[1],v=d.useState(""),E=v[0],y=v[1],C=function(e,t,n){E&&e===E.tagId?E&&y(""):(y({tagId:e,id:t}),m(e,n))};return a&&n&&0===n.length?d.createElement(o.Z,null):g&&t&&"WEIBO_TALK"===t||g&&t&&"COMMENT_REPLY"===t?d.createElement("div",{className:"msg-list-wrapper"},n&&n[0]&&_e(n[0],!0,r,s,i,0,n[0].dataLevel&&"WEIBO_REPORT"===n[0].dataLevel,u,l,E,C,p),d.createElement("div",{className:"expand-more"},d.createElement("span",{onClick:function(){return f(!1),void c(i)}},"\u67e5\u770b\u66f4\u591a",d.createElement("i",{className:"icon-cem_cross-page"}))),n&&n[1]&&_e(n[1],!1,r,s,i,1,n[1].dataLevel&&"WEIBO_REPORT"===n[1].dataLevel,u,l,E,C,p)):d.createElement("div",{className:"msg-list-wrapper"},function(e,t,n,a,r,s,i,l,o){return e&&e.length>0&&e.map((function(e,c){return _e(e,0===c,t,n,a,c,e.dataLevel&&"WEIBO_REPORT"===e.dataLevel,r,s,i,l,o)}))}(n,r,s,i,u,l,E,C,p))};var Ie=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.messageList},n.handleScroll=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=n.scrollContainer,a=t.scrollTop,r=t.offsetHeight;t.scrollHeight-a-r<100&&e()}),500)},n.handleOnWindowResize=function(){document.querySelector(".msg-list-wrapper")&&n.setState({contentWidth:document.querySelector(".msg-list-wrapper").offsetWidth})},n.handleOnMoreClick=function(e){n.setState({messageList:[]},(function(){n.props.resetIndex({pageIndex:0}),n.props.fetchMsgDetail(e),n.scrollContainer.scrollTo({top:0,behavior:"auto"})}))},n.state={id:"",contentWidth:0,bottomDistance:0,resetTime:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.handleOnWindowResize(),window.addEventListener("resize",this.handleOnWindowResize),this.scrollContainer=document.querySelector(".inbox_wrap .msg_detail_wrap"),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll)},t.getDerivedStateFromProps=function(e,t){var n=t.id,a=t.addedMessageList,r=t.willBeUpdatedData,s=t.resetTime,i=t.messageList,l=e.detailData,o=e.data,c=e.data.id,d=e.specifyData,u=e.resetTime;if(!d&&n===c&&a&&l&&JSON.stringify(a)!==JSON.stringify(l)){var m=JSON.stringify(a.map((function(e){return e.id})))===JSON.stringify(l.map((function(e){return e.id}))),p=o.dataLevel&&"WEIBO_TALK"===o.dataLevel&&2===t.messageList.length?l:t.messageList.concat(l);return{messageList:m?i.length>l.length?i.slice(0,i.length-l.length).concat(l):l:p,addedMessageList:JSON.parse(JSON.stringify(l))}}if(r&&d&&JSON.stringify(r)!==JSON.stringify(d)){for(var h=JSON.parse(JSON.stringify(t.messageList)),g=0;g<h.length;g++)for(var f=0;f<d.length;f++)h[g]&&d[f]&&h[g].id===d[f].id&&(h[g]=d[f]);return{messageList:h,willBeUpdatedData:d}}return n!==c?{id:c,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:u>s?{resetTime:u,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:null},n.componentWillUnmount=function(){this.scrollContainer.removeEventListener("resize",this.handleScroll)},n.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.projectId,r=e.detailParams,s=e.modelType,i=e.harmonyEvent,l=e.handleTagsClick,o=e.onStateChange,c=this.state,u=c.messageList,m=c.contentWidth;return d.createElement(Te,{contentWidth:m,detailParams:r,projectId:a,messageList:u,loading:n,modelType:s,messageType:t.dataLevel,harmonyEvent:i,onMoreClick:this.handleOnMoreClick,handleTagsClick:l,onStateChange:o})},t}(d.PureComponent),Le=n(8201),be=n(70715),Oe=n(13922);const xe=function(e){var t=e.data,a=e.detailParams,s=e.detailProduct,i=e.detailAspect,l=e.detailTopic,o=e.modelType,c=e.contentWidth,m=e.formatContent,p=e.handleScroll,h=e.handleScrollToOrBottom,g=e.getScrollBtnText,f=e.highLightWordList,v=e.harmonyEvent,E=e.serviceCustomerType,C=e.filterValue,w=e.inboxIndex,k=e.total,_=e.MESSAGE_TYPE,T=e.updateMessInfoTags,I=e.onStateChange,L=(e.onFeedbackClick,e.getDrawerRef),b=(0,d.useState)(!1),O=b[0],x=b[1],D=(0,d.useState)(""),R=D[0],P=D[1],V=(0,d.useState)(""),A=V[0],F=V[1],W=(0,d.useState)(""),B=W[0],U=W[1],H=(0,d.useState)(""),j=H[0],J=H[1],z=["\u54a8\u8be2/\u6c42\u52a9","\u8d5e\u626c","\u4e0d\u6ee1/\u8fb1\u9a82"],q=(0,d.useState)(""),G=q[0],Y=q[1],K=(0,d.useState)(!0),Q=K[0],X=K[1],$=(0,d.useState)(!1),ee=$[0],ne=$[1],ae=(0,d.useState)(0),re=ae[0],ie=ae[1],le=(0,d.useRef)(null),oe=function e(t){if(t&&"UL"!==t.nodeName)return"LI"===t.nodeName?t:e(t.parentNode)},ce=(0,d.useState)(),de=ce[0],ue=ce[1];(0,d.useEffect)((function(){if(R){var e=document.getElementById(R);(e=oe(e))&&(le.current.scrollTop=e.offsetTop)}}),[R]),(0,d.useEffect)((function(){if(B){var e=document.getElementById(B);(e=oe(e))&&(le.current.scrollTop=e.offsetTop)}}),[B]),(0,d.useEffect)((function(){if(B){var e=document.getElementsByClassName("topic-high-light-words");e.length>0&&function(){for(var t=function(e){switch(B){case z[0]:e.classList.add("ask");break;case z[1]:e.classList.add("positive");break;case z[2]:e.classList.add("negative")}},n=0;n<=e.length;n++)e[n]&&e[n].parentNode&&[e[n].parentNode,e[n].parentNode.parentNode,e[n].parentNode.parentNode.parentNode].some((function(e){return!!e.className.includes("msg")&&(t(e),!0)}))}()}}),[B]);var me=[];function pe(e,t,n){if("aspect"===n&&(P(R===e?"":e),F(t),Y(R===e?j:t)),"topic"===n){var a=document.getElementsByClassName("topic-high-light-words");a.length>0&&function(){for(var e=function(e){switch(B){case z[0]:e.classList.remove("ask");break;case z[1]:e.classList.remove("positive");break;case z[2]:e.classList.remove("negative")}},t=0;t<=a.length;t++)a[t]&&a[t].parentNode&&[a[t].parentNode,a[t].parentNode.parentNode,a[t].parentNode.parentNode.parentNode].some((function(t){return!!t.className.includes("msg")&&(e(t),!0)}))}(),U(B===e?"":e),J(t),Y(B===e?A:t)}}function he(e,t){var n=e.type,a=e.imgUrl;if(a)return'<div style="font-size: 0; margin: 0 -3px 0 -5px; cursor: pointer;">\n        <img class="message-service-images" src="'+a+'" style="max-width: 200px; max-height: 200px"/>\n      </div>';var r=m(e.content)||"",s=f,o=[];if(C&&C.headerFilterParamsNew.forEach((function(e){"CUSTOMER_SERVICE"===e.id&&e.values.length&&e.values.forEach((function(e){"WAITER_ROLE"===e.id&&(o=e.values)}))})),s&&s.forEach((function(e){var t=e.includes("*")?e.replaceAll("*",""):e,a=new RegExp(t,"ig");E?(o.includes(n)||["CUSTOMER","SERVER"].includes(E))&&(r=r.replace(a,'<span style="background: #D2CE77">'+t+"</span>")):r=r.replace(a,'<span style="background: #D2CE77">'+t+"</span>")})),R&&"CUSTOMER"===n){var c=i.find((function(e){return e.aspectId===R}));c&&(s=s.concat(c.aspectList),c.aspectList&&c.aspectList.forEach((function(e){var n=e.highLightWord.includes("*")?e.highLightWord.replaceAll("*",""):e.highLightWord,a=new RegExp(n,"ig");r=r.replace(a,'<span id="'+R+'" index="'+t+'" style="background: '+A+'; color: #f0f2f5;">'+n+"</span>")})))}if(B&&"CUSTOMER"===n){var d=l.find((function(e){return e.aspect1===B}));d&&(s=s.concat(d.aspectList),d.aspectList&&d.aspectList.forEach((function(e){var n=e.highLightWord.includes("*")?e.highLightWord.replaceAll("*",""):e.highLightWord,a=new RegExp(n,"ig"),s=j;if(G!==j){var l=i.find((function(e){return e.aspectId===R}));l&&l.aspectList&&l.aspectList.forEach((function(e){(e.highLightWord.includes("*")?e.highLightWord.replaceAll("*",""):e.highLightWord)===n&&(s=G)}))}r=r.replace(a,'<span id="'+B+'" index="'+t+'" class="topic-high-light-words" style="background: '+s+'; color: #f0f2f5;">'+n+"</span>")})))}return r}i&&i.forEach((function(e){e.aspect1&&!me.includes(e.aspect1)&&me.push(e.aspect1)}));var ge=(0,d.useMemo)((function(){return t&&t.contentList&&t.contentList}),[t]);return d.createElement(Le.Z,{data:t,className:"detail_part"},t&&d.createElement(d.Fragment,null,d.createElement("div",{className:"detail_header"},d.createElement("div",{className:"chat_title"},d.createElement("div",{className:"shop_info"},d.createElement("img",{className:"logo",src:(0,u.Pk)(Z.z[t.sourceName]),alt:t.sourceName}),d.createElement("h4",{className:"shop_name"},t.shopName)),(s&&s.length>0||i&&i.length>0||l&&l.length>0)&&d.createElement("div",null,d.createElement(y.Z,{overlay:Q?"\u6536\u8d77":"\u5c55\u5f00",placement:"top",mouseEnterDelay:.6},d.createElement("i",{className:(Q?"icon-cem_reduce":"icon-cem_enlarge")+" enlarge",onClick:function(){return X(!Q)}})))),Q&&s&&s.length>0&&d.createElement("div",{className:"commodity"},d.createElement("div",{className:"name"},"\u5546\u54c1"),d.createElement("div",{className:"content"},s.filter((function(e){return e.name===t.shopName})).map((function(e){return d.createElement(y.Z,{key:e.name,mouseEnterDelay:.6,overlay:d.createElement("div",{style:{lineHeight:"26px"}},d.createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"\u4f1a\u8bdd\u63d0\u53ca\u5546\u54c1"),d.createElement("br",null),"\u6240\u5c5e\u54c1\u724c\uff1a",e.brand),placement:"top"},d.createElement("span",null,e.name))})),s.some((function(e){return e.name===t.shopName}))&&s.some((function(e){return e.name!==t.shopName}))&&d.createElement("span",{className:"line"}),s.filter((function(e){return e.name!==t.shopName})).map((function(e){return d.createElement(y.Z,{key:e.name,mouseEnterDelay:.6,overlay:d.createElement("div",{style:{lineHeight:"26px"}},d.createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"\u4f1a\u8bdd\u63d0\u53ca\u5546\u54c1"),d.createElement("br",null),"\u6240\u5c5e\u54c1\u724c\uff1a",e.brand),placement:"top"},d.createElement("span",{className:"compare_product"},e.name,d.createElement("i",{className:"separator"})))})))),Q&&i&&i.length>0&&d.createElement("div",{className:"concern"},d.createElement("div",{className:"name"},"\u5173\u6ce8\u70b9"),d.createElement("div",{className:"content"},i.map((function(e){var t=be.fX[me.indexOf(e.aspect1)%20],n=e.aspectId===R;return d.createElement(y.Z,{key:e.aspect2,mouseEnterDelay:.6,overlay:d.createElement("div",{style:{lineHeight:"26px",color:"#8c8c8c"}},d.createElement("span",null,"\u4e00\u7ea7\uff1a",d.createElement("span",{style:{color:"#262626",fontWeight:"bold"}},e.aspect1)),d.createElement("br",null),"\u4e8c\u7ea7\uff1a",d.createElement("span",{style:{color:"#262626",fontWeight:"bold"}},e.aspect2)),placement:"top"},d.createElement("span",{style:{borderColor:t,background:n?t:"#fff",color:n?"#f7f8fa":"#262626"},onClick:function(){return pe(e.aspectId,t,"aspect")}},e.aspect2))})))),Q&&l&&l.length>0&&d.createElement("div",{className:"concern"},d.createElement("div",{className:"name"},"\u8bdd\u9898\u5206\u7c7b"),d.createElement("div",{className:"content"},z.map((function(e,t){var n=be.TJ[t],a=e===B;return d.createElement("span",{key:e,style:{borderColor:n,background:a?n:"#fff",color:a?"#f7f8fa":"#262626",display:l.find((function(t){return t.aspect1===e}))?"inline-block":"none"},onClick:function(){return pe(e,n,"topic")}},e)})))),Q&&d.createElement("div",{className:"concern",style:{paddingRight:"-20px"}},d.createElement("div",{className:"name"},"\u6807\u7b7e"),d.createElement("div",{className:"content"},t.tagVos&&t.tagVos.map((function(e,t){return d.createElement(y.Z,{key:e.tagId,mouseEnterDelay:.6,placement:"top",overlayClassName:"custom-tag-popver",overlay:d.createElement("div",{className:"aspects_tip"},d.createElement("p",null,d.createElement("span",null,e.systemTag?"\u7cfb\u7edf\u6807\u7b7e":"\u81ea\u5b9a\u4e49\u6807\u7b7e"),d.createElement("span",null,e.tagValue)))},d.createElement("span",{key:t,style:(0,u.JG)(e)},e.tagValue))})),d.createElement("span",{className:"tags_addBtn",onClick:function(){ue(!0)}},d.createElement("i",{className:"icon-cem_add-to"}),"\u6807\u7b7e")),Q&&3===Number(t.sourceId)&&d.createElement("div",null,d.createElement("div",null,d.createElement("div",{className:"message_tail",style:{whiteSpace:"nowrap",fontSize:"12px",fontWeight:400,color:" #626262"}},!!t.oids&&d.createElement("span",{className:"message_tail_number"},"\u8ba2\u5355\u7f16\u53f7:\xa0",d.createElement("span",{className:"copyValue",onClick:function(){return(0,N.zp)("copyValue")}},t.oids,"\xa0"),d.createElement("i",{className:"icon-fuzhi",onClick:function(){return(0,N.zp)("copyValue")},style:{color:"#7262FD",cursor:"pointer"}}))))))),d.createElement("div",{className:"card",style:{paddingBottom:O?76:0},onScroll:p,ref:le},d.createElement("div",{className:"date"},S()(t.startTime).format("YYYY-MM-DD")),d.createElement("div",{className:"content_yy"},d.createElement("ul",null,ge&&ge.map((function(e,t){return"CUSTOMER"===e.type?d.createElement("li",{key:e.id,id:t},d.createElement("div",{className:"left"},d.createElement("div",{className:"icon"},d.createElement("img",{src:n(23072),alt:"\u5934\u50cf"})),d.createElement("div",{className:"users"},d.createElement("div",{className:"user_left"},d.createElement("span",{className:"user_name_left"},e.name),d.createElement("span",{className:"user_time"},"("+S()(e.ctime).format("HH:mm:ss")+")")),d.createElement("p",{className:"msg msg_left",dangerouslySetInnerHTML:{__html:he(e,t)}})))):d.createElement("li",{key:e.id,id:t},d.createElement("div",{className:"right"},d.createElement("div",{className:"users"},d.createElement("div",{className:"user_right"},d.createElement("span",{className:"user_time"},"("+S()(e.ctime).format("HH:mm:ss")+")"),d.createElement("span",{className:"user_name_right"},e.name)),d.createElement("p",{className:"msg msg_right",dangerouslySetInnerHTML:{__html:he(e,t)}})),d.createElement("div",{className:"icon"},d.createElement("img",{src:n(95045),alt:"\u5934\u50cf"}),d.createElement("div",{className:"waiter_type"},e.saleType))))}))),ge&&function(){var e=document.getElementsByClassName("message-service-images"),t=[];return e.length>0&&(t=Array.from(e).map((function(e,t){return e.parentNode.onclick=function(){ne(!0),ie(t)},{thumbnail:e.currentSrc,original:e.currentSrc}}))),d.createElement(Oe.Z,{startIndex:re,images:t,closeDialog:function(){ne(!1)},isShow:ee})}()),d.createElement("div",{className:"date date_btm"},"- \u5df2\u5230\u5e95\u90e8 -"),t.remark&&t.remark.length>0&&d.createElement("div",{className:"line"}),t.remark&&t.remark.map((function(e){return d.createElement("div",{className:"remark_wrap",key:e.id},d.createElement(M,{avatar:e.userHeadUrl,userName:e.username||"\u533f\u540d\u7528\u6237",time:S()(e.ctime).format("YYYY-MM-DD HH:mm:ss"),msgType:e.type,alignDirection:"right"}),d.createElement(se,{data:(0,r.Z)({},e,{pictures:"",showDetailType:"\u5907",originSource:"",repostsCount:null,commentCount:null,attitudesCount:null,categoryId:"",oid:"",suboid:"",sourceId:"",sourceName:"",score:"",tagsVos:null}),contentWidth:c,options:["alignRight"],detailParams:a,harmonyEvent:v,highLightWordList:f}))}))),d.createElement(y.Z,{overlay:g,placement:"left",mouseEnterDelay:.6},d.createElement("div",{className:"up_down_btn",onClick:h},d.createElement("i",{className:"scroll_icon_down"}))),d.createElement(ye,{data:(0,r.Z)({sourceName:"",mid:t.mid,status:"",url:"",showDetailType:"",escore:"",score:""},t,{messageId:t.id,index:a.projectId,connectionId:"",routing:a.projectId}),projectId:a.projectId,modelType:o,notContain:["source","operator","remark"],onEditBoxOpen:x,inboxIndex:w,total:k,onStateChange:I}),de&&d.createElement(te,{onClose:function(){return ue(!1)},onConfirm:function(){var e=t.id,n=t.index;T({id:e,index:n}),ue(!1)},messageId:t.id,projectId:a.projectId,customTag:t.tagVos||[],messageType:_}),d.createElement(Ce.Z,{ref:L})))};var De=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleOnFeedbackClick=function(e){a.drawerRef.show({aspectList:e.aspectVos,isAspect:!0,callback:function(t){a.props.feedbackCommentTags({feedbackDetails:t,messageId:e.messageId,projectId:c.t.get(c.V.curProject).id,messageContent:e.messageContent,historyTag:e.aspectVos&&e.aspectVos.length?JSON.stringify(e.aspectVos.filter((function(e){return e.aspect2})).map((function(e){return{aspect:e.aspect2,escore:e.escore}}))):""}).then((function(e){2e4===e.data.code&&m.default.success({style:{marginTop:"85px"},className:"feedback_success_message",content:d.createElement("div",{className:"feedback_success_tip"},d.createElement("img",{src:n(43134)}),d.createElement("p",null,"\u6307\u6807\u53cd\u9988\u6210\u529f\uff0c\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01"))})}))}})},a._handleScroll=function(e){var t=e.target,n=t.scrollHeight,r=t.scrollTop,s=t.clientHeight,i=document.getElementsByClassName("up_down_btn")[0],l=i.querySelector("i").classList,o="icon-zhiding",c="icon-zhidi";r+s===n?(i.style.display="none",setTimeout((function(){i.style.display="block",l.contains(o)||(a.upOrDown="up",l.add(o),l.remove(c))}),150)):0===r?i.style.display="none":setTimeout((function(){i.style.display="block",l.contains(c)||(a.upOrDown="down",l.add(c),l.remove(o))}))},a.handleScroll=function(e){e.persist(),a._handleScroll(e)},a.getScrollBtnText=function(){return"up"===a.upOrDown?"\u56de\u5230\u9876\u90e8":"\u524d\u5f80\u5e95\u90e8"},a.handleScrollToOrBottom=function(e){var t=document.getElementsByClassName("card")[0],n=document.getElementsByClassName("scroll_icon_down")[0],a=t.scrollHeight,r=t.clientHeight;t.scrollTop=n.classList.contains("icon-zhiding")?0:a-r},a.handleFormatContent=function(e){var t=a.escape2Html(a.escape2Html(e)),n=document.createElement("div");return n.innerHTML=t,n.innerText},a.escape2Html=function(e){var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e&&e.replace(/&(lt|gt|nbsp|amp|quot);/gi,(function(e,n){return t[n]}))},a._handleWindowResize=h()((function(){var e=document.getElementsByClassName("detail_part");e&&e.length&&a.setState({contentWidth:e[0].offsetWidth})}),150),a.state={contentWidth:0,data:void 0,dataList:[]},a.event={formatContent:a.handleFormatContent,handleScroll:a.handleScroll,handleScrollToOrBottom:a.handleScrollToOrBottom,getScrollBtnText:a.getScrollBtnText,getDrawerRef:function(e){return a.drawerRef=e},onFeedbackClick:a._handleOnFeedbackClick},a.upOrDown="",a}(0,s.Z)(t,e);var a=t.prototype;return a.scrollToBottom=function(){var e=document.getElementsByClassName("section_content")[0];if(e){var t=e.getElementsByClassName("card")[0];if(t){var n=t.scrollHeight-t.clientHeight;t.scrollTop=n>0?n:0}}},a.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},a.componentDidUpdate=function(e,t){var n=e.specifyData,a=e.detailData,r=this.props,s=r.specifyData,i=r.detailData;(JSON.stringify(a)!==JSON.stringify(i)||isFinite(null==i?void 0:i.relatedCount)||isFinite(null==s?void 0:s.relatedCount))&&this.setState({data:i}),JSON.stringify(n)!==JSON.stringify(s)&&this.setState({data:s})},a.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},a.render=function(){return d.createElement(xe,(0,r.Z)({},this.props,this.state,this.event))},t}(d.PureComponent),Me=function(e,t,n,a,r,s,i,l,o){var c=void 0===e.userHeadUrl?e.uimg:e.userHeadUrl;return d.createElement(d.Fragment,null,d.createElement(M,{avatar:c,userName:e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:e.score,time:e.ctime,msgType:e.showDetailType||e.type,id:e.id,index:e.index,routing:e.routing,alignDirection:a,type:e.type}),d.createElement(se,{options:"right"===a?["alignRight"]:[],data:e,contentWidth:t,detailParams:n,harmonyEvent:r,isTagClicked:s,handleTagClick:l,onFeedbackClick:o,fetchedTag:i}))};const Re=function(e){var t=e.data,n=e.detailParams,a=e.modelType,r=e.contentWidth,s=e.harmonyEvent,i=e.handleTagsClick,l=e.fetchedTag,o=e.getDrawerRef,c=e.onFeedbackClick,m=e.total,p=e.inboxIndex,h=e.messageCategory,g=e.onStateChange,f=d.useState(""),v=f[0],E=f[1],y=function(e,t,n){v&&e===v.tagId?v&&E(""):(E({tagId:e,id:t}),i(e,n))};return d.createElement(Le.Z,{data:t,className:"yt_message_template_ecommerce"},t&&t instanceof Array&&t.length>0&&d.createElement(d.Fragment,null,d.createElement("div",{className:"message_detail"},d.createElement("div",{className:"message_title"},d.createElement("img",{src:(0,u.Pk)(Z.z[t[0].sourceName]),alt:t[0].sourceName}),d.createElement("span",null,t[0].title)),d.createElement("div",{className:"messge_content"},t[0].connectionName),!!t[0].detail&&[1,3].includes(Number(t[0].sourceId))&&d.createElement("div",null,d.createElement("div",{className:"message_tail"},t[0].detail.replaceAll("&nbsp"," "),!!t[0].oids&&de.Z.hasAuthority("MESSAGE_ORDER_NO")&&d.createElement("span",{className:"message_tail_number"},"\u8ba2\u5355\u7f16\u53f7:",d.createElement("span",{className:"copyValue",onClick:function(){return(0,N.zp)("copyValue")}},t[0].oids),d.createElement("i",{className:"icon-fuzhi",onClick:function(){return(0,N.zp)("copyValue")},style:{color:"#7262FD",cursor:"pointer"}}))))),d.createElement("div",{className:"message_commond"},t.map((function(e){return d.createElement("div",{className:"\u5b98"===e.showDetailType?"customer":"",key:e.id},Me(e,r,n,["\u5907","\u56de"].includes(e.showDetailType)?"right":"left",s,v,l,y,c))})),t[0].remarkVos&&t[0].remarkVos.map((function(e){return d.createElement("div",{key:e.id},Me(e,r,n,"right",s,v,l,y,c))}))),d.createElement(ye,{notContain:[],projectId:n.projectId,data:t[0],modelType:a,total:m,inboxIndex:p,messageCategory:h,onStateChange:g}),d.createElement(Ce.Z,{ref:o})))};var Pe=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.data},n._drawCommentLine=function(){var e=document.getElementsByClassName("message_commond")[0],t=document.getElementsByClassName("msg-type"),n=t.length;if(n>1){var a=e.getBoundingClientRect(),r=document.getElementById("lineCanvas");r.width=18,r.height=e.offsetHeight-32;var s=r.getContext("2d");s.beginPath();for(var i=0;i<n-1;i++)s.moveTo(9,2+t[i].getBoundingClientRect().y-a.y),s.lineTo(9,2+t[i+1].getBoundingClientRect().y-a.y-18);s.strokeStyle="#DFE3E8",s.lineWidth=1,s.stroke()}},n._handleWindowResize=function(){n.setState({contentWidth:document.getElementsByClassName("yt_section_component_wrapper")[0].offsetWidth})},n.state={contentWidth:0,data:void 0},n.event={},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.componentDidUpdate=function(e,t){var n=e.specifyData,a=e.detailData,r=this.props,s=r.specifyData,i=r.detailData;JSON.stringify(a)!==JSON.stringify(i)&&this.setState({data:i}),JSON.stringify(n)!==JSON.stringify(s)&&s&&this.setState({data:(0,Q.ZP)(s,(function(e){i&&i.forEach((function(t){-1===e.findIndex((function(e){return e.id===t.id}))&&e.push(t)}))}))})},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return d.createElement(Re,(0,r.Z)({},this.props,this.state,this.event))},t}(d.PureComponent),Ve=(n(43378),n(62443)),Ae=["\u9879\u76ee\u4e3b\u9898","\u6d88\u606f","\u60c5\u611f\u7c7b\u578b","\u7528\u6237","\u6307\u6807\u6a21\u578b","\u9500\u552e\u5c5e\u6027"],Fe=["\u6d88\u606f","\u7528\u6237","\u4e92\u52a8\u91cf","\u60c5\u611f\u7c7b\u578b","\u5907\u6ce8","\u5b9e\u4f53\u6a21\u578b","\u6307\u6807\u6a21\u578b","\u89c4\u5219\u6807\u7b7e","\u9500\u552e\u5c5e\u6027"],Ze=["\u4f1a\u8bdd\u5185\u5bb9","\u63d0\u53ca\u5546\u54c1","\u5e97\u94fa\u540d\u79f0","\u5ba2\u6237\u540d\u79f0","\u5ba2\u670d\u4fe1\u606f","\u5173\u6ce8\u70b9\u6a21\u578b"],We=["\u4f1a\u8bdd\u5185\u5bb9","\u6307\u6807\u6a21\u578b"];var Be=function(e){function t(t){var n;return(n=e.call(this,t)||this).closeDownloadModal=function(){n.setState({step:1,show:!1,fields:[0,1,2,3],newFields:[0,1],serviceFields:[0]}),n.props.close()},n.renderFieldsDetail=function(){return d.createElement("div",{className:"download_fileds_detail"},d.createElement("div",{className:"title"},"\u4e0b\u8f7d\u5b57\u6bb5"),d.createElement("div",null,d.createElement("span",null,"\u6d88\u606f"),d.createElement("div",null,"\u6570\u636e\u6e90\u94fe\u63a5\uff0c\u6d88\u606f\u7c7b\u578b\uff0c\u6d88\u606fID\uff0c\u7236\u6d88\u606fID\uff0c\u6d88\u606f\u5185\u5bb9\uff0c\u521b\u5efa\u65f6\u95f4\uff0c\u8bc4\u4ef7\u7b49\u7ea7\uff0c\u8bc4\u8bba\u6709\u6548\u6027")),d.createElement("div",null,d.createElement("span",null,"\u60c5\u611f\u7c7b\u578b"),d.createElement("div",null,"\u60c5\u611f\u7c7b\u578b")),d.createElement("div",null,d.createElement("span",null,"\u7528\u6237"),d.createElement("div",null,"\u7528\u6237\u6635\u79f0\uff0c\u7528\u6237\u7b49\u7ea7\uff08\u6682\u4e0d\u63d0\u4f9b\uff09")),d.createElement("div",null,d.createElement("span",null,"\u6307\u6807\u6a21\u578b"),d.createElement("div",null,"\u4e00\u7ea7\u6307\u6807\uff0c\u4e8c\u7ea7\u6307\u6807\uff0c\u65b9\u9762\u60c5\u611f...")),d.createElement("a",{onClick:n.goWiki},"\u67e5\u770b\u66f4\u8be6\u7ec6\u8bf4\u660e"))},n.renderTicketFieldsDetail=function(){return d.createElement("div",{className:"download_fileds_detail"},d.createElement("div",{className:"title"},"\u4e0b\u8f7d\u5b57\u6bb5"),d.createElement("div",null,d.createElement("span",null,"\u4f1a\u8bdd\u5185\u5bb9"),d.createElement("div",null,"\u4f1a\u8bddId\uff0c\u5e73\u53f0\uff0c\u4f1a\u8bdd\u5185\u5bb9\uff0c\u4f1a\u8bdd\u65f6\u95f4")),d.createElement("div",null,d.createElement("span",null,"\u6307\u6807\u6a21\u578b"),d.createElement("div",null,"\u6307\u6807\u6a21\u578b")))},n.renderServiceFieldsDetail=function(){return d.createElement("div",{className:"download_fileds_detail"},d.createElement("div",{className:"title"},"\u4e0b\u8f7d\u5b57\u6bb5"),d.createElement("div",null,d.createElement("span",null,"\u4f1a\u8bdd\u5185\u5bb9"),d.createElement("div",null,"\u4f1a\u8bddId\uff0c\u5e73\u53f0\uff0c\u4f1a\u8bdd\u5185\u5bb9\uff0c\u4f1a\u8bdd\u65f6\u95f4")),d.createElement("div",null,d.createElement("span",null,"\u63d0\u53ca\u5546\u54c1"),d.createElement("div",null,"\u54c1\u724c\uff0c\u578b\u53f7")),d.createElement("div",null,d.createElement("span",null,"\u5e97\u94fa\u540d\u79f0"),d.createElement("div",null,"\u5e97\u94fa\u540d\u79f0")),d.createElement("div",null,d.createElement("span",null,"\u5ba2\u6237\u540d\u79f0"),d.createElement("div",null,"\u5ba2\u6237\u540d\u79f0")),d.createElement("div",null,d.createElement("span",null,"\u5ba2\u670d\u4fe1\u606f"),d.createElement("div",null,"\u5ba2\u670d\u540d\u79f0")),d.createElement("div",null,d.createElement("span",null,"\u5173\u6ce8\u70b9\u6a21\u578b"),d.createElement("div",null,"\u4e00\u7ea7\u5173\u6ce8\u70b9\uff0c\u4e8c\u7ea7\u5173\u6ce8\u70b9")))},n.handleFieldsChange=function(e){var t=n.state.fields,a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),n.setState({fields:t})},n.handleNewFieldsChange=function(e){var t=n.state.newFields,a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),n.setState({newFields:t})},n.handleServiceFieldsChange=function(e){var t=n.state.serviceFields,a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),n.setState({serviceFields:t})},n.handleTicketDownloadMsg=function(){var e=n.state,t=e.serviceFields,a=e.step,r=n.props.messageType;if(0!==t.length){var s=[];t.includes(0)&&(s=s.concat(["SESSIONID","PLATFORM","CONTENT","TIME"])),t.includes(1)&&s.push("ASPECT"),n.props.onServiceMessageDownload({exportTypes:s,category:"select",messageCategory:r}).then((function(e){2e4===e.data.code&&n.setState({step:a+1,category:"select"})}))}else E.Message.warning("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u4e0b\u8f7d\u5b57\u6bb5")},n.handleServiceDownloadMsg=function(){var e=n.state,t=e.serviceFields,a=e.step;n.props.messageType;if(0!==t.length){var r=[];t.includes(0)&&(r=r.concat(["SESSIONID","PLATFORM","CONTENT","TIME"])),t.includes(1)&&r.push("PRODUCT"),t.includes(2)&&r.push("SHOP"),t.includes(3)&&r.push("CUSTOMER"),t.includes(4)&&r.push("SELLER"),t.includes(5)&&r.push("FOCUS"),n.props.onServiceMessageDownload({exportTypes:r,category:"select",messageCategory:"WAITER_SESSION"}).then((function(e){2e4===e.data.code&&n.setState({step:a+1,category:"select"})}))}else E.Message.warning("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u4e0b\u8f7d\u5b57\u6bb5")},n.handleNewDownloadMsg=function(){var e=n.state,t=e.newFields,a=e.step,r=e.category;n.props.messageType;if(0!==t.length){var s=[];t.includes(0)&&(s=s.concat(["TEXT_MSG"])),t.includes(1)&&(s=s.concat(["TEXT_USER"])),t.includes(2)&&s.push("TEXT_INTERACTION"),t.includes(3)&&s.push("TEXT_ESCORE"),t.includes(4)&&s.push("TEXT_REMARK"),t.includes(5)&&s.push("TEXT_ENTITY"),t.includes(6)&&s.push("TEXT_ASPECT"),t.includes(7)&&s.push("TEXT_TAG"),t.includes(8)&&s.push("URL_TOPICS"),n.props.onDownload({exportTypes:s,category:r}).then((function(e){2e4===e.data.code&&n.setState({step:a+1,category:"select"})}))}else E.Message.warning("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u4e0b\u8f7d\u5b57\u6bb5")},n.handleDownloadMsg=function(){var e=n.state,t=e.fields,a=e.step,r=e.category;n.props.messageType;if(0!==t.length){var s=[];t.includes(0)&&(s=s.concat(["SOURCE","TITLE","TOPIC"])),t.includes(1)&&(s=s.concat(["URL","MESSAGE_TYPE","ID","PARENT_ID","MESSAGE_CONTENT","MESSAGE_TIME","MESSAGE_SCORE","MESSAGE_EFFECTIVENESS"])),t.includes(2)&&s.push("MESSAGE_ESCORE"),t.includes(3)&&s.push("MESSAGE_USER"),t.includes(4)&&s.push("ASPECT"),t.includes(5)&&s.push("URL_TOPICS"),n.props.onDownload({exportTypes:s,category:r}).then((function(e){2e4===e.data.code&&n.setState({step:a+1,category:"select"})}))}else E.Message.warning("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u4e0b\u8f7d\u5b57\u6bb5")},n.setStep=function(e){n.setState({step:e})},n.state={show:!1,step:1,fields:[0,1,2,3],category:"select",newFields:[0,1],serviceFields:[0]},n}(0,s.Z)(t,e);var n=t.prototype;return n.goWiki=function(){window.open("http://wiki.yuntingai.com/pages/viewpage.action?pageId=65609&os_username=yuntingguest&os_password=skieer@2019&os_cookie=true&login=%E7%99%BB%E5%BD%95&os_destination=")},n.componentDidUpdate=function(e){var t=this,n=this.props,a=n.show;n.messageType;e.show!==a&&this.setState({show:a},(function(){a&&t.setStep(t.props.total>5e4?1:2)}))},n.render=function(){var e,t=this,n=this.props,a=n.total,r=n.messageType,s=this.state,i=s.step,l=s.fields,o=s.newFields,c=s.serviceFields,m=s.show,p="QUESTIONAIRE"===r?"1\u6761\u6d88\u606f\u6709\u5bf9\u5e94\u591a\u4e2a\u6807\u7b7e\u3001\u6307\u6807\u6216\u5b9e\u4f53\u65f6\u5019\uff0c\u662f\u5426\u53ea\u5bfc\u51fa\u7b5b\u9009\u9762\u677f\u4e2d\u9009\u4e2d\u7684\u9009\u9879\u5bf9\u5e94\u7684\u503c":"\u8bf4\u660e\uff1a\u4e00\u6761\u6d88\u606f\u4f1a\u88ab\u6253\u4e0a\u591a\u4e2a\u89c4\u5219\u6807\u7b7e\u6216\u6307\u6807\uff0c\u662f\u5426\u53ea\u5bfc\u51fa\u7b5b\u9009\u9762\u677f\u4e2d\u7684\u9009\u9879\u5bf9\u5e94\u7684\u89c4\u5219\u6807\u7b7e";return d.createElement(E.Dialog,{title:"",size:"tiny",visible:m,onCancel:function(){return t.closeDownloadModal()},lockScroll:!0,className:"message_download_dialog_wrap "+(2===i?"message_download_dialog_check_wrapper":"")},d.createElement(E.Dialog.Body,null,1===i&&d.createElement("div",{className:"download-tips"},d.createElement("div",{className:"mock-dialog-tilte"},d.createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"\u6d88\u606f\u6570\u91cf\u8d85\u8fc7\u4e0a\u9650\uff0c\u662f\u5426\u7ee7\u7eed\u5bfc\u51fa"),d.createElement("div",null,"\u5f53\u524d\u9875\u9762\u6d88\u606f\u6570\u4e3a",d.createElement("span",{style:{color:"#262626"}},0<=(e=a)&&e<1e3?e:e<1e4?(e/1e3).toFixed(2)+"\u5343":(e/1e4).toFixed(2)+"\u4e07","\u6761"),"\uff0c\u5355\u6b21\u5bfc\u51fa",d.createElement("span",{style:{color:"#262626"}},"\u4e0a\u96505\u4e07\u6761")),d.createElement("div",null,"\u70b9\u51fb\u786e\u5b9a\u540e\u4f1a\u6309\u7167\u65f6\u95f4\u6392\u5e8f\u5bfc\u51fa\u6700\u65b0\u7684\u6d88\u606f\uff0c\u6216\u8005\u70b9\u51fb\u53d6\u6d88\u8fdb\u884c\u66f4\u7cbe\u51c6\u7684\u7b5b\u9009")),2===i&&d.createElement("div",{className:"fields-select"},d.createElement("div",{className:"mock-dialog-tilte"},d.createElement("h4",null,"\u8bf7\u9009\u62e9\u4e0b\u8f7d\u5b57\u6bb5",d.createElement(y.Z,{placement:"bottom",overlayClassName:"alert-log-tips message_download_tips_wrap",overlay:"TICKET"===r?this.renderTicketFieldsDetail():"SERVICE"===r?this.renderServiceFieldsDetail():this.renderFieldsDetail(),mouseEnterDelay:.6},d.createElement("i",{className:"icon-cem_file1",style:{marginLeft:4,fontSize:14,color:"#979797",verticalAlign:"unset"}})))),d.createElement("div",{style:{display:"flex",padding:"0 16px 16px 16px"}},r&&d.createElement("div",{className:"fields-select-title"},(0,u.Gt)(r)),d.createElement("div",{style:{flex:3}},r&&"COMMENT"!==r&&"QUESTION"!==r?"SERVICE"===r?d.createElement(d.Fragment,null,Ze.map((function(e,n){return d.createElement(E.Checkbox,{key:n,value:n,checked:c.includes(n),disabled:0===n,onChange:function(){return t.handleServiceFieldsChange(n)}},e)}))):"TICKET"===r?d.createElement(d.Fragment,null,We.map((function(e,n){return d.createElement(E.Checkbox,{key:n,value:n,checked:c.includes(n),disabled:0===n,onChange:function(){return t.handleServiceFieldsChange(n)}},e)}))):d.createElement(d.Fragment,null,Fe.map((function(e,n){return d.createElement(E.Checkbox,{key:n,value:n,checked:o.includes(n),disabled:0===n,onChange:function(){return t.handleNewFieldsChange(n)}},e)}))):d.createElement(d.Fragment,null,Ae.map((function(e,n){return d.createElement(E.Checkbox,{key:n,value:n,checked:l.includes(n),disabled:0===n||1===n,onChange:function(){return t.handleFieldsChange(n)}},e)}))))),d.createElement("div",null,r&&!["TICKET","SERVICE"].includes(r)&&d.createElement(d.Fragment,null,d.createElement("p",null,p),d.createElement(E.Radio.Group,{value:this.state.category,onChange:function(e){return t.setState({category:e})}},d.createElement(E.Radio,{value:"select"},"\u53ea\u5bfc\u51fa\u9009\u4e2d"),d.createElement(E.Radio,{value:"all"},"\u5bfc\u51fa\u5168\u90e8"))))),3===i&&d.createElement("div",{className:"after-download-tips"},d.createElement("div",{className:"mock-dialog-tilte"},d.createElement("i",{className:"icon-cem_complete1",style:{color:"#00B76E"}}),"\u6b63\u5728\u5bfc\u51fa\u4e2d..."),d.createElement("div",null,"\u8bf7\u7a0d\u540e\u67e5\u770b",d.createElement("a",{target:"_blank",style:{color:"#0847a6"},rel:"noopener noreferrer",href:"/personalSettings/download"},"\u5bfc\u51fa\u8bb0\u5f55")),d.createElement("div",null,"\u5bfc\u51fa\u5b8c\u6210\u540e\uff0c\u4e5f\u53ef\u4ece\u53f3\u4e0a\u89d2\u7684\u6d88\u606f\u5904\u4e0b\u8f7d\u5bfc\u51fa\u6570\u636e"))),d.createElement(E.Dialog.Footer,{className:"dialog-footer"},d.createElement(E.Button,{type:"primary",onClick:function(){var e=t.state.step;1===e?t.setStep(e+1):2===e?r&&"COMMENT"!==r&&"QUESTION"!==r?"SERVICE"===r?t.handleServiceDownloadMsg():"TICKET"===r?t.handleTicketDownloadMsg():t.handleNewDownloadMsg():t.handleDownloadMsg():t.closeDownloadModal()}},1===i?"\u7ee7\u7eed\u5bfc\u51fa":"\u786e\u5b9a"),2!==i&&d.createElement(E.Button,{onClick:function(){return t.closeDownloadModal()}},"\u53d6\u6d88")))},t}(d.Component);const Ue=Be;var He=n(60496);const je=function(e){var t,n=e.isShow,a=e.options,r=(e.children,e.contentDom);return d.createElement(d.Fragment,null,n?d.createElement(y.Z,{placement:"top",overlay:(t=d.createElement(d.Fragment,null,a.map((function(e,t){return d.createElement("p",{key:t},d.createElement("span",{style:{color:"#8c8c8c"}},e.name,"\uff1a"),e.value)}))),d.createElement("div",{style:{maxWidth:260}},t))},r[0]):r[1])};var Je=n(18863);Array.prototype.duplicator=function(e){var t=this,n=[];return new Array(e).fill(0).forEach((function(){return n.push.apply(n,t)})),n};var ze=["40%","60%","80%","60%","0"].duplicator(4),qe=[{title:"\u6309\u53d1\u5e03\u65f6\u95f4\u6700\u65b0",value:"cTime|DESC"},{title:"\u6309\u53d1\u5e03\u65f6\u95f4\u6700\u65e9",value:"cTime|ASC"},{title:"\u6309\u70b9\u8d5e\u6570\u91cf\u6700\u5927",value:"attitudesCount|DESC"},{title:"\u6309\u8f6c\u53d1\u6570\u91cf\u6700\u5927",value:"repostsCount|DESC"},{title:"\u6309\u8bc4\u8bba\u6570\u91cf\u6700\u5927",value:"commentsCount|DESC"}],Ge=[{title:"\u6309\u7b54\u9898\u65f6\u95f4\u6700\u65b0",value:"cTime|DESC"},{title:"\u6309\u7b54\u9898\u65f6\u95f4\u6700\u65e9",value:"cTime|ASC"}],Ye={PROMOTER:"\u63a8\u8350\u8005",PASSIVE:"\u88ab\u52a8\u8005",DETRACTOR:"\u8d2c\u635f\u8005"},Ke={TEXT:"\u666e\u901a\u9898\u578b\u95ee\u5377",TEXTAREA:"\u666e\u901a\u9898\u578b\u95ee\u5377",NPS_REASON:"NPS\u95ee\u5377",SATISFACTION_REASON:"\u6ee1\u610f\u5ea6\u95ee\u5377"},Qe={OFFICIAL_REPLY:"\u5b98\u65b9\u56de\u590d"},Xe=function(e){function t(){var t;return(t=e.call(this)||this).fixedTime=function(e){t.state.serverTime;var n=new Date,a=new Date(e.substring(0,19).replace(/-/g,"/").replace(/T/," ")),r=n.getTime()-a.getTime(),s=36e5,i=864e5,l=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime(),o=new Date(l-864e5).getTime();switch(!0){case r<s:var c=Math.abs(Math.floor(r/6e4));return c?c+"\u5206\u949f\u524d":"\u521a\u521a";case r<i:return Math.floor(r/s)+"\u5c0f\u65f6\u524d";case a.getTime()>=o&&a.getTime()<l:return"\u6628\u5929 "+t.formatterNum(new Date(+a-i).getHours())+" : "+t.formatterNum(new Date(+a-i).getMinutes());case a.getFullYear()===n.getFullYear():return t.formatterNum(a.getMonth()+1)+"\u6708"+t.formatterNum(a.getDate())+"\u65e5";default:return a.getFullYear()+"\u5e74"+t.formatterNum(a.getMonth()+1)+"\u6708"+t.formatterNum(a.getDate())+"\u65e5"}},t.formatterNum=function(e){return e<10?"0"+e:e},t.loadMore=function(){var e=t.inboxListWrap,n=e.scrollTop,a=e.offsetHeight,r=e.scrollHeight,s=t.props,i=s.messageList,l=s.total,o=s.messageListFetching;t.setState({leftListScrollBottom:r-n-a}),o||i.length>=l||r-n-a>30||t.setState({leftListScrollBottom:100},(function(){t.props.fetchMessageList({pageIndex:t.props.pageIndex+1})}))},t.closeDownload=function(){t.setState({downloadModalShow:!1})},t.downhandler=function(e){if(t.inboxListWrap){var n=e.keyCode,a=t.props,r=a.messageList,s=a.total,i=a.messageListFetching,l=t.inboxListWrap,o=l.clientHeight,c=l.scrollTop,d=l.scrollHeight;if(!(i||r.length>s)&&o&&(40===n||38===n)){e.preventDefault(),t.currentId=t.currentId?t.currentId:0,40===n?t.currentId+1!==s&&t.currentId++:t.currentId>0&&t.currentId--;var u=r[t.currentId];if(t.showMessage=(0,N.Nn)(u,t.visiblePermission),u&&t.currentId+1!==s||(t.inboxListWrap.scrollTop=d-o),t.currentId>=0&&u){var m=t.inboxListWrap.children[t.currentId],p=m.offsetHeight,h=m.offsetTop;h+p>c+o&&(t.inboxListWrap.scrollTop=h-o+p),c-h>0&&(t.inboxListWrap.scrollTop=h),t.props.onInboxClick(u,t.currentId,t.showMessage)}}}},t.handleFormatContent=function(e){var n=t.escape2Html(t.escape2Html(e)),a=document.createElement("div");return a.innerHTML=n,a.innerText},t.escape2Html=function(e){var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e&&e.replace(/&(lt|gt|nbsp|amp|quot);/gi,(function(e,n){return t[n]}))},t.renderEScoreType=function(e,t){return t?e.answerListTypes&&e.answerListTypes.includes("NPS_SCORE")?d.createElement("span",{className:e.scoreLevel},Ye[e.scoreLevel]):e.answerListTypes&&e.answerListTypes.includes("SATISFACTION")?"QUESTIONAIRE"===e.messageCategory?null:"NEGATIVE"===e.starLevel?"\u5dee\u8bc4":"NEUTRAL"===e.starLevel?"\u4e2d\u8bc4":"\u597d\u8bc4":null:[-1,0,1].includes(e.escore)&&22!==e.categoryId?d.createElement(y.Z,{overlay:-1===e.escore?"\u8d1f\u9762":0===e.escore?"\u4e2d\u6027":"\u6b63\u9762",placement:"top",mouseEnterDelay:.6},d.createElement("i",{className:"cem-icon icon-cem_"+(-1===e.escore?"negative":0===e.escore?"neutral":"positive")})):null},t.state={leftListScrollBottom:100,downloadModalShow:!1},t.visiblePermission=de.Z.hasAuthority("ANSWER_DETAIL_SHOWINFO_ALL")?"showAll":de.Z.hasAuthority("ANSWER_DETAIL_SHOWINFO_PART")?"showPart":"hide",t.isCustomer=de.Z.hasAuthority("CUSTOMER_MANAGER"),t.myRef=d.createRef(),t.currentId=null,t.showMessage={},t}(0,s.Z)(t,e);var n=t.prototype;return n.handleTimeFormat=function(e){if("string"===typeof e&&e){return e.replace(/(\s\d+)$/g,"").replace(/[a-z]/gi," ").replace(/-/g,"/")}},n.hightLightWord=function(e,t){var n=this.handleFormatContent(e)||"",a=this.props.highLightWordList;Array.isArray(t)&&(a=(a&&a.length>0?a:[]).concat(t));return n&&a&&a.forEach((function(e){var t,a=e.includes("*")?e.replaceAll("*",""):e,r=new RegExp(a,"ig");"pre"!==e&&(n=null==(t=n)?void 0:t.replace(r,(function(e){return"<pre>"+e+"</pre>"})))})),n},n.componentDidMount=function(){window.addEventListener("keydown",this.downhandler)},n.componentWillUnmount=function(){window.removeEventListener("keydown",this.downhandler)},n.render=function(){var e=this,t=this.state,n=(t.leftListScrollBottom,t.downloadModalShow),a=this.props,r=a.MODEL,s=a.MESSAGE_TYPE,i=a.messageList,l=a.total,c=(a.questionnaireCount,a.curSelectMessage),m=a.garbageTotal,p=a.messageListFetching,h=a.onInboxClick,g=a.onMessageDownload,f=a.onServiceMessageDownload,v=a.onSortTypeChange,E=a.sortName,C=(a.sourceId,c?c.id:null),S=c?c.messageCategory:null,w=!s||"COMMENT"===s||"WEIBO"===s||"SOCIAL"===s||"BBS"===s||"SELF"===s||"QUE_ANS"===s||"COMPLAINT"===s||"NEWS"===s||"VIDEO"===s||"QUESTION"===s||"SERVICE"===s||"TICKET"===s,k="QUESTIONAIRE"===s||"QUESTIONAIRE"===S,_="SERVICE"===s||"SERVICE"===S,T=!s||"COMMENT"===s||"SERVICE"===s||"WEIBO"===s||"APP_COMMENT"===s||"TICKET"===s||"SELF"===s?qe.slice(0,2):k?Ge:qe;return d.createElement("div",{style:{height:"100%"}},void 0===i&&d.createElement(o.Z,{paragraph:ze}),void 0!==i&&d.createElement("div",{className:"list-part"},d.createElement("div",{className:"sort-bar"},d.createElement("div",{className:"total"},d.createElement("span",null,"\u5171",d.createElement("span",null,l&&new String(l).replace(/(?=(\B)(\d{3})+$)/g,","))," ",s&&k?"\u4efd\u7b54\u5377":"\u9879"),0!==m&&!k&&d.createElement("div",{className:"tip"},d.createElement(y.Z,{overlay:"\u5171"+l+"\u9879\uff0c\u5176\u4e2d\u88ab\u81ea\u5b9a\u4e49\u89c4\u5219\u6807\u8bb0\u4e3a\u7528\u6237\u53ef\u89c1\u7684\u65e0\u6548\u6570\u636e\u6d88\u606f\u6570\u4e3a"+m+"\u9879",placement:"top",mouseEnterDelay:.2},d.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}})))),d.createElement("div",{className:"sort"},d.createElement("span",null,"\u6392\u5e8f "),d.createElement(He.Z,{onChange:v,activeObj:E,options:T,sufIcon:"icon-cem_show-more"})),w&&de.Z.hasAuthority("MESSAGE_DATA_EXPORT")&&!r&&d.createElement("div",{className:"download hoverColor",onClick:function(){return e.setState({downloadModalShow:!0})}},d.createElement(y.Z,{overlay:"\u5bfc\u51fa\u5f53\u524d\u9875\u6570\u636e",placement:"top",mouseEnterDelay:.6},d.createElement("i",{className:"icon-xiazai"})))),!!l&&d.createElement("ul",{className:"inbox-list-wrap "+("APP_COMMENT"===s?"app-comment":""),ref:function(t){return e.inboxListWrap=t},onScroll:this.loadMore},i.map((function(t,n){var a="APP_COMMENT"===t.messageCategory?"":t.connectionName,s=Qe[t.dataLevel]||t.username||t.uid||"",i=(0,N.Nn)(t,e.visiblePermission),l=[{name:"\u59d3\u540d",value:i.username},{name:"\u624b\u673a",value:i.phoneNumber},{name:"\u90ae\u7bb1",value:i.email}],o=e.isCustomer&&1===t.existContact;return d.createElement("li",{key:t.id,className:"list-inbox "+("PERSONAL"!==r&&"FOLDER"!==r||0===t.status?"":"read")+" "+(C&&t.id===C?"current":""),onClick:function(){e.currentId=n,h(t,n,i)}},d.createElement("div",{className:"wrap"},d.createElement("div",{className:"title"},d.createElement("div",{className:"message-user"},d.createElement("span",{className:"source-img"},d.createElement("img",{src:(0,u.Pk)(Z.z[t.sourceName]),alt:t.sourceName})),d.createElement(je,{isShow:"QUESTIONAIRE"===t.messageCategory,options:l,contentDom:[d.createElement("span",{key:"1",className:"name",onClick:function(e){e.stopPropagation(),o&&(0,Je.gi)(t.contactId)}},i.username),d.createElement("span",{className:"name",key:"2"},s)]})),d.createElement(y.Z,{overlay:""+e.handleTimeFormat(null==t?void 0:t.ctime),placement:"top",mouseEnterDelay:.6},d.createElement("span",{className:"time-to-now fade-color"},t.ctime&&e.fixedTime(t.ctime)))),t.title&&!_&&d.createElement("div",{className:"content-header-wrap"},d.createElement("p",{className:"content-header fade-color",dangerouslySetInnerHTML:{__html:e.hightLightWord(t.title,t.highLightInfoList)},title:t.title})),d.createElement("div",{className:"msg_list_content_wrap",dangerouslySetInnerHTML:{__html:e.hightLightWord(t.hasOwnProperty("summary")?t.summary:t.answerOrReason,t.highLightInfoList)}}),d.createElement("p",{className:"connection-name"},t.answerListType||t.type?d.createElement(d.Fragment,null,d.createElement("div",null,t.answerListType?d.createElement(Ve.default,{content:d.createElement("div",null,t.answerListTypes.map((function(e){return d.createElement("p",{key:e},Ke[e])}))),trigger:"hover"},Ke[t.answerListType]):""+t.type),d.createElement("span",{className:"space"}," | ")):null,e.props.messageName&&e.props.messageName({sourceName:t.sourceName,transConnectionName:a,messageCategory:t.messageCategory,questionnaireId:t.questionnaireId||"",dataLevel:t.dataLevel,existQuestionnaire:t.existQuestionnaire}),t.ticketId&&d.createElement("span",null,t.ticketId),d.createElement("span",{className:"escore-type"},e.renderEScoreType(t,k)))))})),0!==l&&null!==l&&d.createElement("li",{className:"more"},d.createElement("p",{style:{display:p?"block":"none"}},"\u52a0\u8f7d\u66f4\u591a\u6570\u636e\u4e2d..."),d.createElement("p",{style:{display:i.length>=l&&!p?"block":"none"}},"\u6ca1\u6709\u66f4\u591a\u6570\u636e..."))),0===l&&d.createElement("li",{className:"empty-block"},"\u6ca1\u6709\u6570\u636e...")),w&&!r&&d.createElement(Ue,{total:l,messageType:s,show:n,close:this.closeDownload,onDownload:g,onServiceMessageDownload:f}))},t}(d.Component),$e=n(49845),et=function(e,t,n,a,s,i,l,o,c){var m=void 0===e.userHeadUrl?e.uimg:e.userHeadUrl,p=(0,r.Z)({},e,{aspectVos:"\u8bc4"===e.showDetailType?e.aspectVos:null});return d.createElement(d.Fragment,null,d.createElement(M,{avatar:m,userName:Qe[e.dataLevel]||e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:["COMMENT"].includes(e.dataLevel)?e.score:null,time:e.ctime||null,msgType:e.showDetailType||e.type,id:e.id,index:e.index,routing:e.routing,alignDirection:a,type:e.type,defaultAvatar:"\u5b98"===e.showDetailType?(0,u.Pk)(Z.z[e.sourceName]):""}),d.createElement(se,{options:"right"===a?["alignRight"]:[],data:p,contentWidth:t,detailParams:n,harmonyEvent:s,isTagClicked:i,handleTagClick:o,onFeedbackClick:c,fetchedTag:l,tagModalHidden:!0}))};const tt=function(e){var t=e.data,n=e.detailParams,a=e.modelType,s=e.contentWidth,i=e.harmonyEvent,l=e.handleTagsClick,o=e.fetchedTag,c=e.getDrawerRef,u=e.onFeedbackClick,m=e.total,p=e.inboxIndex,h=e.onStateChange,g=d.useState(""),f=g[0],v=g[1],E=function(e,t,n){f&&e===f.tagId?f&&v(""):(v({tagId:e,id:t}),l(e,n))},y=function(e){var t=e?[].concat(e):[],n=t.findIndex((function(e){return"0"===e.parent}));if(n){var a=t.splice(n,1);t.unshift.apply(t,a)}return t}(t);return d.createElement(Le.Z,{data:y,className:"yt_message_app_ecommerce"},y&&y instanceof Array&&y.length>0&&d.createElement(d.Fragment,null,d.createElement("div",{className:"message_detail"},d.createElement("div",{className:"message_title"},d.createElement(k.Z,{src:y[0].icon,defaultImg:$e}),d.createElement("div",null,y[0].appName,d.createElement("div",{className:"flex mt-15",style:{fontWeight:"normal"}},d.createElement("div",{className:"text-12"},d.createElement("div",{className:"color-tip mb-5"},"\u5e73\u53f0"),d.createElement("div",null,y[0].sourceName)),d.createElement("div",{className:"ml-30 text-12"},d.createElement("div",{className:"color-tip mb-5"},"\u7248\u672c"),d.createElement("div",null,y[0].version||"--")))))),d.createElement("div",{className:"message_commond"},y.map((function(e){return d.createElement("div",{className:"\u5b98"===e.showDetailType?"customer":"",key:e.id},et(e,s,n,["\u5907","\u56de"].includes(e.showDetailType)?"right":"left",i,f,o,E,u))})),y[0].remarkVos&&y[0].remarkVos.map((function(e){var t=(0,r.Z)({},e,{score:null});return d.createElement("div",{key:e.id},et(t,s,n,"right",i,f,o,E,u))}))),d.createElement(ye,{notContain:["remark","reply","operator","InvalidMessage",y[0].url?void 0:"source"],projectId:n.projectId,data:y[0],modelType:a,total:m,inboxIndex:p,onStateChange:h}),d.createElement(Ce.Z,{ref:c})))};var nt=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.data},n._drawCommentLine=function(){var e=document.getElementsByClassName("message_commond")[0],t=document.getElementsByClassName("msg-type"),n=t.length;if(n>1){var a=e.getBoundingClientRect(),r=document.getElementById("lineCanvas");r.width=18,r.height=e.offsetHeight-32;var s=r.getContext("2d");s.beginPath();for(var i=0;i<n-1;i++)s.moveTo(9,2+t[i].getBoundingClientRect().y-a.y),s.lineTo(9,2+t[i+1].getBoundingClientRect().y-a.y-18);s.strokeStyle="#DFE3E8",s.lineWidth=1,s.stroke()}},n._handleWindowResize=function(){n.setState({contentWidth:document.getElementsByClassName("yt_section_component_wrapper")[0].offsetWidth})},n.state={contentWidth:0,data:void 0},n.event={},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.componentDidUpdate=function(e,t){var n=e.specifyData,a=e.detailData,r=this.props,s=r.specifyData,i=r.detailData;JSON.stringify(a)!==JSON.stringify(i)&&this.setState({data:i}),JSON.stringify(n)!==JSON.stringify(s)&&s&&this.setState({data:(0,Q.ZP)(s,(function(e){i&&i.forEach((function(t){-1===e.findIndex((function(e){return e.id===t.id}))&&e.push(t)}))}))})},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return d.createElement(tt,(0,r.Z)({},this.props,this.state,this.event))},t}(d.PureComponent),at=n(86073);const rt=function(e){var t,n,a,s=e.data,i=e.detailParams,l=e.modelType,o=e.contentWidth,c=e.harmonyEvent,m=e.handleTagsClick,p=e.fetchedTag,h=e.getDrawerRef,g=e.onFeedbackClick,f=e.total,v=e.inboxIndex,E=e.onStateChange,C=d.useState(""),S=C[0],N=C[1],w=function(e,t,n){S&&e===S.tagId?S&&N(""):(N({tagId:e,id:t}),m(e,n))};return s&&s[0]&&!s[0].report&&(s[0].report=[{content:i.content,createdAt:i.ctime,escore:i.escore,id:i.ticketId,type:"noReport_VoiceComment",username:i.uid}]),d.createElement(Le.Z,{data:s,className:"yt_message_ticket_ecommerce"},Array.isArray(s)&&s.length>0&&d.createElement(d.Fragment,null,d.createElement("div",{className:"message_detail"},d.createElement("div",{className:"message_title"},d.createElement("div",{style:{display:"flex"}},d.createElement(k.Z,{src:s[0].icon,defaultImg:at}),d.createElement("div",null,s[0].title)),d.createElement("div",{className:"product_name",style:{transform:s[0].channel?"translateY(24px)":"translateY(0)"}},s[0].productName)),s[0].channel&&d.createElement("div",{className:"messge_content"},s[0].channel)),s[0].starLevel?d.createElement("div",{className:"message_comments"},s[0].starLevel&&d.createElement("div",null,d.createElement("span",{className:"message_t1"},"Rating"),d.createElement("span",{className:"message_t2"},s[0].starLevel)),s[0].satisfactionLevel&&d.createElement("div",{className:"message_t3"},s[0].satisfactionLevel),null!=(t=s[0].aspectVos)&&t.length?d.createElement("div",{className:"aspects"},d.createElement("span",{className:"name"},"\u6307\u6807"),s[0].aspectVos.map((function(e,t){return d.createElement(y.Z,{key:"aspects_"+t,mouseEnterDelay:.6,overlay:d.createElement("div",{className:"aspects_tip"},d.createElement("p",null,d.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),d.createElement("span",null,e.aspect1Name)),d.createElement("p",null,d.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),d.createElement("span",null,e.aspect2Name)),d.createElement("p",null,d.createElement("span",null,"\u6307\u6807\u60c5\u611f"),d.createElement("span",null,3===e.escore?"\u8d1f\u9762":8===e.escore?"\u6b63\u9762":"--"))),placement:"top"},d.createElement("span",{className:"escore"+e.escore},e.aspect2Name))}))):null):null,d.createElement("div",{className:"message_commond"},null==(n=s[0])||null==(a=n.report)?void 0:a.map((function(e){return d.createElement("div",{className:"\u5b98"===e.showDetailType?"customer":"",key:e.id},function(e,t,n,a,s,i,l,o,c,m){var p=void 0===e.userHeadUrl?e.uimg:e.userHeadUrl,h=(0,r.Z)({},e);return"noReport_VoiceComment"===e.type&&(h.aspectVos=m.aspectVos),d.createElement(d.Fragment,null,d.createElement(M,{avatar:p,userName:Qe[e.dataLevel]||e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:["COMMENT"].includes(e.dataLevel)?e.escore:null,time:e.createdAt||null,msgType:null,id:null==m?void 0:m.id,commentId:e.id,index:null==m?void 0:m.index,routing:null==m?void 0:m.routing,alignDirection:a,type:e.type,defaultAvatar:"\u5b98"===e.showDetailType?(0,u.Pk)(Z.z[e.sourceName]):""}),d.createElement(se,{options:"right"===a?["alignRight"]:[],data:h,contentWidth:t,detailParams:n,harmonyEvent:s,isTagClicked:i,handleTagClick:o,onFeedbackClick:c,fetchedTag:l,tagModalHidden:!0}))}(e,o,i,["\u5907","\u56de"].includes(e.showDetailType)?"right":"left",c,S,p,w,g,s[0]))}))),d.createElement(ye,{notContain:["remark","reply","operator","InvalidMessage",s[0].url?void 0:"source"],projectId:i.projectId,data:s[0],modelType:l,total:f,inboxIndex:v,onStateChange:E}),d.createElement(Ce.Z,{ref:h})))};var st=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.data},n._drawCommentLine=function(){var e=document.getElementsByClassName("message_commond")[0],t=document.getElementsByClassName("msg-type"),n=t.length;if(n>1){var a=e.getBoundingClientRect(),r=document.getElementById("lineCanvas");r.width=18,r.height=e.offsetHeight-32;var s=r.getContext("2d");s.beginPath();for(var i=0;i<n-1;i++)s.moveTo(9,2+t[i].getBoundingClientRect().y-a.y),s.lineTo(9,2+t[i+1].getBoundingClientRect().y-a.y-18);s.strokeStyle="#DFE3E8",s.lineWidth=1,s.stroke()}},n._handleWindowResize=function(){n.setState({contentWidth:document.getElementsByClassName("yt_section_component_wrapper")[0].offsetWidth})},n.state={contentWidth:0,data:void 0},n.event={},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.componentDidUpdate=function(e,t){var n=e.specifyData,a=e.detailData,r=this.props,s=r.specifyData,i=r.detailData;JSON.stringify(a)!==JSON.stringify(i)&&this.setState({data:i}),JSON.stringify(n)!==JSON.stringify(s)&&s&&this.setState({data:(0,Q.ZP)(s,(function(e){i&&i.forEach((function(t){-1===e.findIndex((function(e){return e.id===t.id}))&&e.push(t)}))}))})},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return d.createElement(rt,(0,r.Z)({},this.props,this.state,this.event))},t}(d.PureComponent),it=function(e,t,n,a,r,s,i,l,o,c){return d.createElement("div",{className:t?"msg-wrapper":"msg-wrapper not-first-msg",key:e.id},d.createElement("div",{className:e.remarkVos&&e.remarkVos.length>0?"time-line":""},d.createElement(M,{avatar:e.uimg,userName:e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:e.score,time:e.ctime,msgType:e.showDetailType||e.type,flag:e.status,id:e.id,index:e.index,routing:e.routing}),d.createElement(se,{options:["reply","property"],data:e,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o})),e.remarkVos&&e.remarkVos.length>0&&e.remarkVos.map((function(t,n){return d.createElement("div",{className:n===e.remarkVos.length-1?"":"time-line",key:t.id},d.createElement(M,{avatar:t.userHeadUrl,userName:t.username||"\u533f\u540d\u7528\u6237",time:t.ctime,msgType:t.showDetailType||t.type,alignDirection:"right"}),d.createElement(se,{options:["alignRight"],data:t,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o}))})),d.createElement(ye,{projectId:n,data:e,modelType:s,notContain:t?[]:["reply"],messageCategory:e.messageCategory,onStateChange:c}))};const lt=function(e){var t=e.messageType,n=e.messageList,a=e.loading,r=e.projectId,s=e.contentWidth,i=e.detailParams,l=e.onMoreClick,c=e.modelType,u=e.harmonyEvent,m=e.handleTagsClick,p=e.onStateChange,h=d.useState(!0),g=h[0],f=h[1],v=d.useState(""),E=v[0],y=v[1],C=function(e,t,n){E&&e===E.tagId&&t===E.id?E&&y(""):(y({tagId:e,id:t}),m(e,n))};return a&&n&&0===n.length?d.createElement(o.Z,null):t&&"COMMENT_REPLY"===t&&g?d.createElement("div",{className:"msg-list-wrapper"},n&&n[0]&&it(n[0],!0,r,s,i,c,u,E,C,p),d.createElement("div",{className:"expand-more"},d.createElement("span",{onClick:function(){return f(!1),void l(i)}},"\u67e5\u770b\u66f4\u591a",d.createElement("i",{className:"icon-cem_cross-page"}))),n&&n[1]&&it(n[1],!1,r,s,i,c,u,E,C,p)):d.createElement("div",{className:"msg-list-wrapper"},function(e,t,n,a,r,s,i,l,o){return e&&e.length>0&&e.map((function(e,c){return it(e,0===c,t,n,a,r,s,i,l,o)}))}(n,r,s,i,c,u,E,C,p))};var ot=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.messageList},n.handleScroll=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=n.scrollContainer,a=t.scrollTop,r=t.offsetHeight;t.scrollHeight-a-r<100&&e()}),500)},n.handleOnWindowResize=function(){document.querySelector(".msg-list-wrapper")&&n.setState({contentWidth:document.querySelector(".msg-list-wrapper").offsetWidth})},n.handleOnMoreClick=function(e){n.setState({messageList:[]},(function(){n.props.resetIndex({pageIndex:0}),n.props.fetchMsgDetail(e),n.scrollContainer.scrollTo({top:0,behavior:"auto"})}))},n.state={id:"",resetTime:0,contentWidth:0,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.handleOnWindowResize(),window.addEventListener("resize",this.handleOnWindowResize),this.scrollContainer=document.querySelector(".inbox_wrap .msg_detail_wrap"),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll)},t.getDerivedStateFromProps=function(e,t){var n=t.id,a=t.addedMessageList,r=t.willBeUpdatedData,s=t.resetTime,i=t.messageList,l=e.detailData,o=e.data,c=e.data.id,d=e.specifyData,u=e.resetTime;if(!d&&n===c&&a&&l&&JSON.stringify(a)!==JSON.stringify(l)){var m=JSON.stringify(a.map((function(e){return e.id})))===JSON.stringify(l.map((function(e){return e.id}))),p=o.dataLevel&&"COMMENT_REPLY"===o.dataLevel&&2===t.messageList.length?l:t.messageList.concat(l);return{messageList:m?i.length>l.length?i.slice(0,i.length-l.length).concat(l):l:p,addedMessageList:JSON.parse(JSON.stringify(l))}}if(r&&d&&JSON.stringify(r)!==JSON.stringify(d)){for(var h=JSON.parse(JSON.stringify(t.messageList)),g=0;g<h.length;g++)for(var f=0;f<d.length;f++)h[g]&&d[f]&&h[g].id===d[f].id&&(h[g]=d[f]);return{messageList:h,willBeUpdatedData:d}}return n!==c?{id:c,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:u>s?{resetTime:u,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:null},n.componentWillUnmount=function(){this.scrollContainer&&this.scrollContainer.removeEventListener("resize",this.handleScroll)},n.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.projectId,r=e.detailParams,s=e.modelType,i=e.harmonyEvent,l=e.handleTagsClick,o=e.onStateChange,c=this.state,u=c.messageList,m=c.contentWidth;return d.createElement(lt,{contentWidth:m,detailParams:r,modelType:s,projectId:a,messageList:u,loading:n,messageType:t.dataLevel,harmonyEvent:i,onMoreClick:this.handleOnMoreClick,handleTagsClick:l,onStateChange:o})},t}(d.PureComponent),ct={"\u6b63\u9762":1,"\u4e2d\u6027":0,"\u8d1f\u9762":-1};const dt=function(e){var t=e.emotionScore,n=e.msgType,a=e.routing,r=e.index,s=e.id,i=e.answerId,l=e.changeMessage,o=e.disableSwitch,c=void 0!==o&&o,u=e.commentId,m=d.useState(t),p=m[0],h=m[1],g=function(){var e=(0,_.Z)(I().mark((function e(t){var n,o;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.h.post("/inbox/messages/update",{flag:"questionnaire_answer",id:s,answerId:i,index:r,routing:a,score:t,commentId:u});case 2:2e4===(null==(o=e.sent)||null==(n=o.data)?void 0:n.code)&&(l&&l({score:t}),h(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object.values(ct).includes(p)&&"\u5b98"!==n&&d.createElement("div",{className:"msg-header-center"},d.createElement("div",{className:"msg-center-icon "+(c?"disable-switch":"")},d.createElement("i",{className:"cem-icon icon-cem_"+(-1===p?"negative":0===p?"neutral":"positive")}),d.createElement("ul",{className:"popup-list"},["\u6b63\u9762","\u4e2d\u6027","\u8d1f\u9762"].filter((function(e){return ct[e]!==p})).map((function(e,t){return d.createElement("li",{key:t,onClick:function(){return g(ct[e])}},d.createElement(L.l,{className:"normal-state",name:"\u8d1f\u9762"===e?"negative-no-hover":"\u4e2d\u6027"===e?"neutral-no-hover":"positive-no-hover"}),d.createElement(L.l,{className:"hover-state",name:"\u8d1f\u9762"===e?"negative-hover":"\u4e2d\u6027"===e?"neutral-hover":"positive-hover"}),"\xa0",e)})))))};var ut=n(3820),mt=n(36470),pt=n(41691),ht=n(63141),gt=n(42420),ft=n(19957),vt=n(44188),Et=n(32980),yt=n(20961),Ct=n(67705),St=n(29276),Nt=n(47752),wt=(n(96606),n(36155)),kt=(n(31822),n(41764)),_t=n(21314);var Tt,It=n(93951),Lt=n(2933),bt=n(60909),Ot=n(9643),xt=n(875),Dt=n(50713),Mt=n(57305),Rt=n(22737),Pt=n(62658),Vt=n(65001);var At=((Tt={})[ut.C2.MULTI_SELECTION]=pt.Z,Tt[ut.C2.MULTIPLE_CHOICE]=It.t,Tt[ut.C2.SINGLE_CHOICE]=It.t,Tt[ut.C2.GENDER]=mt.Z,Tt[ut.C2.NPS]=ht.Z,Tt[ut.C2.CSAT]=gt.Z,Tt[ut.C2.NPS_REASON]=vt.Z,Tt[ut.C2.CSAT_REASON]=vt.Z,Tt[ut.C2.SINGLELINE_TEXT]=ft.Z,Tt[ut.C2.MULTILINE_TEXT]=vt.Z,Tt[ut.C2.NAME]=ft.Z,Tt[ut.C2.PHONE_NUMBER]=ft.Z,Tt[ut.C2.EMAIL]=ft.Z,Tt[ut.C2.CUSTOMER_INFO]=Et.Z,Tt[ut.C2.DECORATION_TEXT]=yt.Z,Tt[ut.C2.SINGLE_PULL_DOWN]=St.t,Tt[ut.C2.DATE]=Ct.t,Tt[ut.C2.SORT]=Nt.t,Tt[ut.C2.SCALE]=function(e){var t=e.limit,n=e.lowScoreText,a=e.midScoreText,r=e.highScoreText,s=e.style,i=(e.answerd,parseInt(e.answer)),l=[n,a,r],o=(0,_t.SS)(t,s),c=(0,_t.qB)(s,o),u=o.includes(0)&&"CIRCLE"===c?+i+1:+i;return d.createElement("div",{className:"yt-qs-message-scale"},"Slider"!==c?"STAR"===s?d.createElement(kt.Z,{value:u,count:o.length,disabled:!0}):d.createElement("div",{className:"score"},o.map((function(e,t){return d.createElement("span",{className:"score_point "+(e===i?"active":""),key:t},e)}))):d.createElement("div",{className:"yt-slider-scale"},d.createElement("span",{className:"number"},t[0]),d.createElement(wt.Z,{min:t[0],max:t[1],value:u,disabled:!1}),d.createElement("span",{className:"number"},t[1])),d.createElement("div",{className:"start_desc"},l.map((function(e,t){return d.createElement("span",{key:t},e)}))))},Tt[ut.C2.UPLOAD_FILE]=function(e){var t=e.files,n=(0,d.useState)(!1),a=n[0],r=n[1],s=(0,d.useState)(0),i=s[0],l=s[1],o=function(e){l(e),r(!0)};return d.createElement("div",{className:"yt-qs-file"},t.map((function(e,n){return d.createElement("div",{key:n,className:"yt-qs-list"},d.createElement("div",{className:"yt-qs-image"},d.createElement("img",{src:/(png|jpg|jpeg)$/.test(e.name)?/(png)$/.test(e.name)?e.url?e.url:Ot:e.url?e.url:bt:/(doc|docx)$/.test(e.name)?xt:/(pdf)$/.test(e.name)?Dt:/(txt)$/.test(e.name)?Rt:/(ppt|pptx)$/.test(e.name)?Pt:Mt,onClick:function(){return o(n)}})),d.createElement("div",{className:"yt-qs-img",onClick:function(){return o(n)}},d.createElement(J.default,{size:"small",type:"link",className:"down-load-button",icon:d.createElement("i",{className:"icon-xiazai"}),onClick:function(t){t.stopPropagation(),function(e){e.url&&(window.location.href=e.url)}(e)}})),d.createElement("div",{className:"file-name"},e.name),e.url&&/(png|jpg|jpeg)$/.test(e.name)&&d.createElement(Vt.Z,{fileList:t,previewVisible:a&&i===n,previewTitle:e.name,previewImage:e.url,setPreviewVisible:function(){return r(!1)}}))})))},Tt[ut.C2.MATRIX_SINGLE_CHOICE]=Lt.t,Tt[ut.C2.MATRIX_MULTIPLE_CHOICE]=Lt.t,Tt[ut.C2.MATRIX_SCALE]=Lt.t,Tt);const Ft=At;const Zt=(0,w.connect)(null,(function(e){return{changeMessage:function(t){return e({type:"inbox/changeMessage",payload:t})}}}))((function(e){var t=e.surveryData,n=e.highLightWordList,a=e.harmonyEvent,s=e.data,i=e.changeMessage,l=e.index,o=e.onFeedbackClick,c=e.data,u=(c.answer,c.aspectVos,c.messageId),m=e.getDrawerRef,p=function(e){var t=(0,r.Z)({},s,{changeMessage:i,index:l,answerId:e.id,id:e.messageId,emotionScore:e.escore,disableSwitch:!0});return d.createElement("div",{className:"single_text common_card_style"},d.createElement("div",{className:"title"},d.createElement("span",null,e.title),d.createElement("div",{className:"flex flex-1 justify-end"},d.createElement(dt,t))),d.createElement("div",{className:"single_question_content"},Ft[e.type]((0,r.Z)({},e,{highLightWordList:n,harmonyEvent:a}))),f(e))},h=function(e){var t=(0,r.Z)({},s,{changeMessage:i,emotionScore:e.escore,disableSwitch:!0});if("USER_INFO"===e.type){var l=JSON.parse(e.answer)||"";return d.createElement("div",{className:"single_text common_card_style"},d.createElement("div",{className:"title"},d.createElement("span",null,e.title),d.createElement("div",{className:"flex flex-1 justify-end"},d.createElement(O,t))),d.createElement("div",{className:"single_text_reason"},d.createElement("p",{dangerouslySetInnerHTML:{__html:a(l.id||"",n)}}),d.createElement("p",{dangerouslySetInnerHTML:{__html:a(l.name||"",n)}}),d.createElement("p",{dangerouslySetInnerHTML:{__html:a(l.value||"",n)}})),f(e))}return d.createElement("div",{className:"single_text common_card_style"},d.createElement("div",{className:"title"},d.createElement("span",null,e.title),d.createElement("div",{className:"flex flex-1 justify-end"},d.createElement(O,t))),d.createElement("div",{className:"single_text_reason"},d.createElement("span",{dangerouslySetInnerHTML:{__html:a(e.answer||"",n)}}),("SATISFACTION_REASON"===e.type||"TEXT"===e.type||"TEXTAREA"===e.type||"NPS_REASON"===e.type)&&d.createElement("span",{className:"feedback",onClick:function(){return o({messageContent:e.answer,messageId:u,aspectVos:e.aspectVos||[]})}},d.createElement("i",{className:"icon-fankui"}),"\u53cd\u9988")),f(e))},g=function(e){return d.createElement("div",{className:"nps_score_content common_card_style"},d.createElement("div",{className:"content"},d.createElement("div",{className:"title"},e.title),d.createElement("div",{className:"score"},d.createElement("ul",null,new Array(11).fill(0).map((function(t,n){return d.createElement("li",{className:parseInt(e.answer)===n?"sel":"",key:n},n)}))),d.createElement("p",null,d.createElement("span",{dangerouslySetInnerHTML:{__html:a("0\uff1a\u4e0d\u53ef\u80fd",n)}}),d.createElement("span",{dangerouslySetInnerHTML:{__html:a("10\uff1a\u6781\u6709\u53ef\u80fd",n)}})))))},f=function(e){var t;return null!=e&&null!=(t=e.aspectVos)&&t.length?d.createElement("div",{className:"aspects",style:{}},d.createElement("span",{className:"name"},"\u6307\u6807"),e.aspectVos.map((function(e,t){return d.createElement(y.Z,{key:"aspects_"+t,mouseEnterDelay:.6,overlay:d.createElement("div",{className:"aspects_tip"},d.createElement("p",null,d.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),d.createElement("span",null,e.aspect1Name)),d.createElement("p",null,d.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),d.createElement("span",null,e.aspect2Name)),d.createElement("p",null,d.createElement("span",null,"\u6307\u6807\u60c5\u611f"),d.createElement("span",null,3===e.escore?"\u8d1f\u9762":8===e.escore?"\u6b63\u9762":"--"))),placement:"bottom"},d.createElement("span",{className:"escore"+e.escore},e.aspect2Name))}))):null},v=function(e){return d.createElement("div",{className:"rate_content common_card_style"},d.createElement("div",{className:"rate_content_tips"},d.createElement("div",{className:"title",dangerouslySetInnerHTML:{__html:a(e.title||"",n)}}),d.createElement("div",{className:"rate_box"},d.createElement(E.Rate,{allowHalf:!0,disabled:!0,value:e.answer}),d.createElement("div",{className:"rate_score"},d.createElement("span",{dangerouslySetInnerHTML:{__html:a("\u5f88\u4e0d\u6ee1\u610f",n)}}),d.createElement("span",{dangerouslySetInnerHTML:{__html:a("\u4e00\u822c",n)}}),d.createElement("span",{dangerouslySetInnerHTML:{__html:a("\u5f88\u6ee1\u610f",n)}})))),f(e))};return d.createElement("div",{className:"result_card"},t.map((function(e){return d.createElement(d.Fragment,{key:e.id},function(e){switch(e.type){case"TEXT":case"TEXTAREA":case"USER_INFO":case"PHONE":case"NAME":case"EMAIL":case"SATISFACTION_REASON":case"NPS_REASON":case"SEX":return h(e);case"NPS_SCORE":return g(e);case"SATISFACTION":return v(e);default:return p(e,n,a)}}(e),d.createElement(Ce.Z,{ref:m}))})))}));const Wt=function(e){function t(){var t;return(t=e.call(this)||this)._drawCommentLine=function(){var e=t.contentRef.getElementsByClassName("msg-type"),n=e.length;if(n>1){var a=t.contentRef.getBoundingClientRect();t.canvasRef.setAttribute("width","18px"),t.canvasRef.setAttribute("height",t.contentRef.offsetHeight-32+"px");var r=t.canvasRef.getContext("2d");r.beginPath();for(var s=1;s<n-1;s++)r.moveTo(9,2+e[s].getBoundingClientRect().y-a.y),r.lineTo(9,2+e[s+1].getBoundingClientRect().y-a.y-18);r.strokeStyle="#DFE3E8",r.lineWidth=1,r.stroke()}},t.skip=function(e){var t=JSON.stringify({questionnaireId:e.questionnaireId,dataLevel:e.dataLevel});e.existQuestionnaire?window.open("/research/manage?"+encodeURIComponent(t)):m.default.error("\u8be5\u95ee\u5377\u5df2\u4e0d\u5b58\u5728")},t.namePageJump=h()((function(e){var t=JSON.stringify({customerId:e});window.open("/customerFile/customerDetail?"+encodeURIComponent(t))}),200),t.isVisible=de.Z.hasAuthority("NPS_CONTACT_VISIBLE")||de.Z.hasAuthority("NPS_CONTACT_HALF_VISIBLE"),t.isCustomer=de.Z.hasAuthority("CUSTOMER_MANAGER"),t}(0,s.Z)(t,e);var a=t.prototype;return a.componentDidUpdate=function(){this._drawCommentLine()},a.render=function(){var e=this,t=this.props,a=t.obj,s=t.detailParams,i=t.contentWidth,l=t.modelType,o=t.surveryData,c=t.highLightWordList,u=t.harmonyEvent,m=t.inboxIndex,p=t.messageList,h=t.total,g=t.data,f=t.onStateChange,v=t.onFeedbackClick,E=t.getDrawerRef,y=this.props.showMessage,C=a.uimg;C?C.startsWith("http")||(C="http://"+C):C=n(88958),0===Object.keys(y).length&&(y=(0,Je.n0)(p[0],this.isVisible));var N=[{name:"\u59d3\u540d",value:y.username},{name:"\u624b\u673a",value:y.phoneNumber},{name:"\u90ae\u7bb1",value:y.email}],w=this.isCustomer&&1===y.existContact;return d.createElement("div",{className:"NPs_content",ref:function(t){return e.contentRef=t}},d.createElement("div",{className:"question-header"},d.createElement("div",{className:"question-name",onClick:function(){return e.skip(g)}},a.questionnaireName),d.createElement("div",{className:"question-right"},g.ctime&&d.createElement("span",{className:"time"},S()(g.ctime).format("YYYY/MM/DD HH:mm:ss")),d.createElement("span",{className:"msg-type"},"\u5377"))),d.createElement("div",{className:"sub-header"},d.createElement("img",{src:C,onError:this.handleImgError}),d.createElement(je,{isShow:"QUESTIONAIRE"===y.messageCategory,options:N,contentDom:[d.createElement("div",{key:"1",className:"person-name "+(w?"isclick":null),onClick:function(e){e.stopPropagation(),w&&(0,Je.gi)(y.contactId)}},y.username||"\u533f\u540d\u7528\u6237"),d.createElement("div",{className:"person-name "+(w?"isclick":null),key:"2"},a.username||"\u533f\u540d\u7528\u6237")]}),a.productName?d.createElement("div",{className:"product-name"},a.productName):null),d.createElement("div",{className:"line"}),d.createElement(Zt,{surveryData:o,highLightWordList:c,harmonyEvent:u,data:a,index:s.index,onFeedbackClick:v,getDrawerRef:E}),a.remarkVos&&a.remarkVos.map((function(e){return d.createElement("div",{key:e.id},d.createElement(M,{avatar:e.userHeadUrl,userName:e.username||"\u533f\u540d\u7528\u6237",time:e.ctime,msgType:e.showDetailType||e.type,alignDirection:"right"}),d.createElement(se,{data:(0,r.Z)({},e,{pictures:"",showDetailType:"\u5907",originSource:"",repostsCount:null,commentCount:null,attitudesCount:null,categoryId:"",oid:"",suboid:"",sourceId:"",sourceName:"",score:"",tagsVos:null}),contentWidth:i,options:["alignRight"],detailParams:s,harmonyEvent:u}))})),d.createElement("canvas",{id:"lineCanvas",ref:function(t){return e.canvasRef=t}}),d.createElement(ye,{projectId:s.index,data:(0,r.Z)({},a,{connectionId:s.group,sourceName:"",mid:a.mid,url:"",escore:"",showDetailType:"",index:s.index}),modelType:l,notContain:["source","operator"],inboxIndex:m,total:h,onStateChange:f}))},t}(d.Component);const Bt=function(e){var t=e.detailData,n=e.dataList,a=e.detailParams,r=e.contentWidth,s=e.modelType,i=e.highLightWordList,l=e.harmonyEvent,o=e.inboxIndex,c=e.total,u=e.data,m=e.onStateChange,p=e.showMessage,h=e.messageList,g=e.onFeedbackClick,f=e.getDrawerRef,v=n.length>0||("string"===typeof t?t:void 0);return d.createElement(Le.Z,{data:v,className:"detail_part_yy"},v&&d.createElement(d.Fragment,null,d.createElement("div",{className:"survey_wrap"},d.createElement("div",{className:"card_yy"},d.createElement("ul",{id:"inboxListWrap"},d.createElement("li",{className:"card_wrap"},d.createElement(Wt,{obj:n[0],detailParams:a,contentWidth:r,modelType:s,surveryData:n,highLightWordList:i,harmonyEvent:l,inboxIndex:o,total:c,data:u,onStateChange:m,showMessage:p,messageList:h,onFeedbackClick:g,getDrawerRef:f})))))))};var Ut=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.dataList},n._handleWindowResize=function(){n.setState({contentWidth:document.getElementsByClassName("yt_section_component_wrapper")[0].offsetWidth})},n._handleEndReached=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=document.querySelector(".survey_wrap");if(t){var a=t.scrollTop,r=t.offsetHeight,s=t.scrollHeight-a-r;n.setState({bottomDistance:s}),s<40&&e()}}),500)},n.state={dataList:[],bottomDistance:0,contentWidth:0},n.event={onEndReached:n._handleEndReached()},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=e.detailData,n=e.specifyData,a=this.props,r=a.detailData,s=a.specifyData;if(JSON.stringify(t)!==JSON.stringify(r)&&r instanceof Array&&this.setState({dataList:r}),JSON.stringify(s)!==JSON.stringify(n)&&s){var i=this.state.dataList,l=i.find((function(e){return e.id===s[0].id}));l&&(l.remarkVos=s[0].remarkVos||[],l.messageVO=s[0].messageVO||[],l.tagVos=s[0].tagVos||[],this.setState({dataList:JSON.parse(JSON.stringify(i))}))}},n.componentWillUnmount=function(){this.setState({dataList:[]}),window.removeEventListener("resize",this._handleWindowResize)},n.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.render=function(){return d.createElement(Bt,(0,r.Z)({},this.props,this.state,this.event))},t}(d.PureComponent),Ht=function(e,t,n,a,r,s,i,l,o,c){return d.createElement("div",{className:t?"msg-wrapper que-ans-wrapper":"que-ans-wrapper msg-wrapper not-first-msg",key:e.id},d.createElement("div",{className:e.remarkVos&&e.remarkVos.length>0?"time-line":""},d.createElement(M,{avatar:e.uimg,userName:e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:e.score,time:e.ctime,msgType:e.showDetailType||e.type,flag:e.status,id:e.id,index:e.index,routing:e.routing}),d.createElement(se,{options:["reply","property"],data:e,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o})),e.remarkVos&&e.remarkVos.length>0&&e.remarkVos.map((function(t,n){return d.createElement("div",{className:n===e.remarkVos.length-1?"":"time-line",key:t.id},d.createElement(M,{avatar:t.userHeadUrl,userName:t.username||"\u533f\u540d\u7528\u6237",time:t.ctime,msgType:t.showDetailType||t.type,alignDirection:"right"}),d.createElement(se,{options:["alignRight"],data:t,contentWidth:a,detailParams:r,harmonyEvent:i,isTagClicked:l,handleTagClick:o}))})),d.createElement(ye,{projectId:n,data:e,modelType:s,notContain:t?[]:["reply"],messageCategory:e.messageCategory,onStateChange:c}))};const jt=function(e){var t=e.messageType,n=e.messageList,a=e.loading,r=e.projectId,s=e.contentWidth,i=e.detailParams,l=e.harmonyEvent,c=e.onMoreClick,u=e.modelType,m=e.handleTagsClick,p=e.onStateChange,h=d.useState(!0),g=h[0],f=h[1],v=d.useState(""),E=v[0],y=v[1],C=function(e,t,n){E&&e===E.tagId?E&&y(""):(y({tagId:e,id:t}),m(e,n))};return a&&n&&0===n.length?d.createElement(o.Z,null):t&&"QUE_ANS_TALK"===t&&g?d.createElement("div",{className:"msg-list-wrapper"},n&&n[0]&&Ht(n[0],!0,r,s,i,u,l,E,C,p),d.createElement("div",{className:"expand-more"},d.createElement("span",{onClick:function(){return f(!1),void c(i)}},"\u67e5\u770b\u66f4\u591a",d.createElement("i",{className:"icon-cem_cross-page"}))),n&&n[1]&&Ht(n[1],!1,r,s,i,u,l,E,C,p)):d.createElement("div",{className:"msg-list-wrapper"},function(e,t,n,a,r,s,i,l,o){return e&&e.length>0&&e.map((function(e,c){return Ht(e,0===c,t,n,a,r,s,i,l,o)}))}(n,r,s,i,u,l,E,C,p))};var Jt=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.messageList},n.handleScroll=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=n.scrollContainer,a=t.scrollTop,r=t.offsetHeight;t.scrollHeight-a-r<100&&e()}),500)},n.handleOnWindowResize=function(){document.querySelector(".msg-list-wrapper")&&n.setState({contentWidth:document.querySelector(".msg-list-wrapper").offsetWidth})},n.handleOnMoreClick=function(e){n.setState({messageList:[]},(function(){n.props.resetIndex({pageIndex:0}),n.props.fetchMsgDetail(e),n.scrollContainer.scrollTo({top:0,behavior:"auto"})}))},n.state={id:"",resetTime:0,contentWidth:0,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.handleOnWindowResize(),window.addEventListener("resize",this.handleOnWindowResize),this.scrollContainer=document.querySelector(".inbox_wrap .msg_detail_wrap"),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll)},t.getDerivedStateFromProps=function(e,t){var n=t.id,a=t.addedMessageList,r=t.willBeUpdatedData,s=t.resetTime,i=t.messageList,l=e.detailData,o=e.data,c=e.data.id,d=e.specifyData,u=e.resetTime;if(!d&&n===c&&a&&l&&JSON.stringify(a)!==JSON.stringify(l)){var m=JSON.stringify(a.map((function(e){return e.id})))===JSON.stringify(l.map((function(e){return e.id}))),p=o.dataLevel&&"QUE_ANS_TALK"===o.dataLevel&&2===t.messageList.length?l:t.messageList.concat(l);return{messageList:m?i.length>l.length?i.slice(0,i.length-l.length).concat(l):l:p,addedMessageList:JSON.parse(JSON.stringify(l))}}if(r&&d&&JSON.stringify(r)!==JSON.stringify(d)){for(var h=JSON.parse(JSON.stringify(t.messageList)),g=0;g<h.length;g++)for(var f=0;f<d.length;f++)h[g]&&d[f]&&h[g].id===d[f].id&&(h[g]=d[f]);return{messageList:h,willBeUpdatedData:d}}return n!==c?{id:c,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:u>s?{resetTime:u,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:null},n.componentWillUnmount=function(){this.scrollContainer&&this.scrollContainer.removeEventListener("resize",this.handleScroll)},n.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.projectId,r=e.detailParams,s=e.modelType,i=e.harmonyEvent,l=e.handleTagsClick,o=e.onStateChange,c=this.state,u=c.messageList,m=c.contentWidth;return d.createElement(jt,{contentWidth:m,detailParams:r,modelType:s,projectId:a,messageList:u,loading:n,messageType:t.dataLevel,harmonyEvent:i,onMoreClick:this.handleOnMoreClick,handleTagsClick:l,onStateChange:o})},t}(d.PureComponent),zt=function(e,t,n,a,r,s,i,l){return d.createElement("div",{className:t?"msg-wrapper":"msg-wrapper not-first-msg",key:e.id},d.createElement("div",{className:e.remarkVos&&e.remarkVos.length>0?"time-line":""},d.createElement(M,{avatar:e.uimg,userName:e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:e.score,time:e.ctime,msgType:"\u6295"===e.showDetailType?"\u8bc9":e.showDetailType,flag:e.status,id:e.id,index:e.index,routing:e.routing}),d.createElement(se,{options:t?["property"]:["reply","property"],data:e,contentWidth:a,detailParams:r,harmonyEvent:s})),e.remarkVos&&e.remarkVos.length>0&&e.remarkVos.map((function(t,n){return d.createElement("div",{className:n===e.remarkVos.length-1?"":"time-line",key:t.id},d.createElement(M,{avatar:t.userHeadUrl,userName:t.username||"\u533f\u540d\u7528\u6237",time:t.ctime,msgType:t.showDetailType||t.type,alignDirection:"right"}),d.createElement(se,{options:["alignRight"],data:t,contentWidth:a,detailParams:r,harmonyEvent:s}))})),d.createElement(ye,{projectId:n,data:e,modelType:i,notContain:t?[]:["reply"],onStateChange:l}))};const qt=function(e){var t=e.messageType,n=e.messageList,a=e.loading,r=e.projectId,s=e.contentWidth,i=e.detailParams,l=e.harmonyEvent,c=e.onMoreClick,u=e.modelType,m=e.onStateChange,p=d.useState(!0),h=p[0],g=p[1];return a&&n&&0===n.length?d.createElement(o.Z,null):h&&t&&"COMPLAINT_REPLY"===t?d.createElement("div",{className:"msg-list-wrapper"},n&&n[0]&&zt(n[0],!0,r,s,i,l,u,m),d.createElement("div",{className:"expand-more"},d.createElement("span",{onClick:function(){return g(!1),void c(i)}},"\u67e5\u770b\u66f4\u591a",d.createElement("i",{className:"icon-cem_cross-page"}))),n&&n[1]&&zt(n[1],!1,r,s,i,l,u,m)):d.createElement("div",{className:"msg-list-wrapper"},function(e,t,n,a,r,s,i){return e&&e.length>0&&e.map((function(e,l){return zt(e,0===l,t,n,a,r,s,i)}))}(n,r,s,i,l,u,m))};var Gt=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.messageList},n.handleScroll=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=n.scrollContainer,a=t.scrollTop,r=t.offsetHeight;t.scrollHeight-a-r<100&&e()}),500)},n.handleOnWindowResize=function(){document.querySelector(".msg-list-wrapper")&&n.setState({contentWidth:document.querySelector(".msg-list-wrapper").offsetWidth})},n.handleOnMoreClick=function(e){n.setState({messageList:[]},(function(){n.props.resetIndex({pageIndex:0}),n.props.fetchMsgDetail(e),n.scrollContainer.scrollTo({top:0,behavior:"auto"})}))},n.state={id:"",resetTime:0,contentWidth:0,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.handleOnWindowResize(),window.addEventListener("resize",this.handleOnWindowResize),this.scrollContainer=document.querySelector(".inbox_wrap .msg_detail_wrap"),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll)},t.getDerivedStateFromProps=function(e,t){var n=t.id,a=t.addedMessageList,r=t.willBeUpdatedData,s=t.resetTime,i=t.messageList,l=e.detailData,o=e.data,c=e.data.id,d=e.specifyData,u=e.resetTime;if(!d&&n===c&&a&&l&&JSON.stringify(a)!==JSON.stringify(l)){var m=JSON.stringify(a.map((function(e){return e.id})))===JSON.stringify(l.map((function(e){return e.id}))),p=o.dataLevel&&"QUE_ANS_TALK"===o.dataLevel&&2===t.messageList.length?l:t.messageList.concat(l);return{messageList:m?i.length>l.length?i.slice(0,i.length-l.length).concat(l):l:p,addedMessageList:JSON.parse(JSON.stringify(l))}}if(r&&d&&JSON.stringify(r)!==JSON.stringify(d)){for(var h=JSON.parse(JSON.stringify(t.messageList)),g=0;g<h.length;g++)for(var f=0;f<d.length;f++)h[g]&&d[f]&&h[g].id===d[f].id&&(h[g]=d[f]);return{messageList:h,willBeUpdatedData:d}}return n!==c?{id:c,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:u>s?{resetTime:u,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:null},n.componentWillUnmount=function(){this.scrollContainer&&this.scrollContainer.removeEventListener("resize",this.handleScroll)},n.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.projectId,r=e.detailParams,s=e.modelType,i=e.harmonyEvent,l=e.onStateChange,o=this.state,c=o.messageList,u=o.contentWidth;return d.createElement(qt,{contentWidth:u,detailParams:r,modelType:s,projectId:a,messageList:c,loading:n,messageType:t.dataLevel,onMoreClick:this.handleOnMoreClick,harmonyEvent:i,onStateChange:l})},t}(d.PureComponent),Yt=function(e,t,n,a,s,i,l,o,c,u,m,p){return d.createElement("div",{className:t?"msg-wrapper":"msg-wrapper not-first-msg",key:e.id},d.createElement("div",{className:e.remarkVos&&e.remarkVos.length>0?"time-line":""},d.createElement(M,{avatar:e.uimg,userName:e.username||"\u533f\u540d\u7528\u6237",emotionScore:e.escore,score:e.score,time:e.ctime,msgType:e.showDetailType||e.type,flag:e.status,id:e.id,index:e.index,routing:e.routing}),0===i&&l?d.createElement(d.Fragment,null,d.createElement(se,{options:["property"],data:e,contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m}),d.createElement("div",{className:"original-blog"},e.originName&&d.createElement("span",{className:"original-username"},"@",e.originName),d.createElement(se,{options:["property"],data:(0,r.Z)({},e,{content:e.originText,pictures:e.originPics,originSource:"",tagVos:void 0}),contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m})),d.createElement(F,{projectId:n,categoryId:e.categoryId,group:e.group,oid:e.oid,suboid:e.suboid,sourceId:e.sourceId})):d.createElement(se,{options:["property","reply"],data:e,contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m})),e.remarkVos&&e.remarkVos.length>0&&e.remarkVos.map((function(t,n){return d.createElement("div",{className:n===e.remarkVos.length-1?"":"time-line",key:t.id},d.createElement(M,{avatar:t.userHeadUrl,userName:t.username||"\u533f\u540d\u7528\u6237",time:t.ctime,msgType:t.showDetailType||t.type,alignDirection:"right"}),d.createElement(se,{options:["alignRight"],data:t,contentWidth:a,detailParams:s,harmonyEvent:c,isTagClicked:u,handleTagClick:m}))})),d.createElement(ye,{projectId:n,data:e,modelType:o,notContain:t?[]:["reply"],onStateChange:p}))};const Kt=function(e){var t=e.messageType,n=e.messageList,a=e.loading,r=e.projectId,s=e.contentWidth,i=e.detailParams,l=e.onMoreClick,c=e.modelType,u=e.harmonyEvent,m=e.handleTagsClick,p=e.onStateChange,h=d.useState(!0),g=h[0],f=h[1],v=d.useState(""),E=v[0],y=v[1],C=function(e,t,n){E&&e===E.tagId?E&&y(""):(y({tagId:e,id:t}),m(e,n))};return a&&n&&0===n.length?d.createElement(o.Z,null):g&&t&&"VIDEO_REPLY"===t?d.createElement("div",{className:"msg-list-wrapper"},n&&n[0]&&Yt(n[0],!0,r,s,i,0,n[0].dataLevel&&"WEIBO_REPORT"===n[0].dataLevel,c,u,E,C,p),d.createElement("div",{className:"expand-more"},d.createElement("span",{onClick:function(){return f(!1),void l(i)}},"\u67e5\u770b\u66f4\u591a",d.createElement("i",{className:"icon-cem_cross-page"}))),n&&n[1]&&Yt(n[1],!1,r,s,i,1,n[1].dataLevel&&"WEIBO_REPORT"===n[1].dataLevel,c,u,E,C,p)):d.createElement("div",{className:"msg-list-wrapper"},function(e,t,n,a,r,s,i,l,o){return e&&e.length>0&&e.map((function(e,c){return Yt(e,0===c,t,n,a,c,e.dataLevel&&"WEIBO_REPORT"===e.dataLevel,r,s,i,l,o)}))}(n,r,s,i,c,u,E,C,p))};var Qt=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPageData=function(){return n.state.messageList},n.handleScroll=function(){var e=n.props.onScrollRefresh;n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){var t=n.scrollContainer,a=t.scrollTop,r=t.offsetHeight;t.scrollHeight-a-r<100&&e()}),500)},n.handleOnWindowResize=function(){document.querySelector(".msg-list-wrapper")&&n.setState({contentWidth:document.querySelector(".msg-list-wrapper").offsetWidth})},n.handleOnMoreClick=function(e){n.setState({messageList:[]},(function(){n.props.resetIndex({pageIndex:0}),n.props.fetchMsgDetail(e),n.scrollContainer.scrollTo({top:0,behavior:"auto"})}))},n.state={id:"",contentWidth:0,bottomDistance:0,resetTime:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.handleOnWindowResize(),window.addEventListener("resize",this.handleOnWindowResize),this.scrollContainer=document.querySelector(".inbox_wrap .msg_detail_wrap"),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll)},t.getDerivedStateFromProps=function(e,t){var n=t.id,a=t.addedMessageList,r=t.willBeUpdatedData,s=t.resetTime,i=t.messageList,l=e.detailData,o=e.data,c=e.data.id,d=e.specifyData,u=e.resetTime;if(!d&&n===c&&a&&l&&JSON.stringify(a)!==JSON.stringify(l)){var m=JSON.stringify(a.map((function(e){return e.id})))===JSON.stringify(l.map((function(e){return e.id}))),p=o.dataLevel&&"WEIBO_TALK"===o.dataLevel&&2===t.messageList.length?l:t.messageList.concat(l);return{messageList:m?i.length>l.length?i.slice(0,i.length-l.length).concat(l):l:p,addedMessageList:JSON.parse(JSON.stringify(l))}}if(r&&d&&JSON.stringify(r)!==JSON.stringify(d)){for(var h=JSON.parse(JSON.stringify(t.messageList)),g=0;g<h.length;g++)for(var f=0;f<d.length;f++)h[g]&&d[f]&&h[g].id===d[f].id&&(h[g]=d[f]);return{messageList:h,willBeUpdatedData:d}}return n!==c?{id:c,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:u>s?{resetTime:u,bottomDistance:0,messageList:[],addedMessageList:[],willBeUpdatedData:[]}:null},n.componentWillUnmount=function(){this.scrollContainer.removeEventListener("resize",this.handleScroll)},n.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.projectId,r=e.detailParams,s=e.modelType,i=e.harmonyEvent,l=e.handleTagsClick,o=e.MESSAGE_TYPE,c=e.updateMessInfoTags,u=e.onStateChange,m=this.state,p=m.messageList,h=m.contentWidth;return d.createElement(Kt,{contentWidth:h,detailParams:r,projectId:a,messageList:p,loading:n,modelType:s,messageType:t.dataLevel,harmonyEvent:i,onMoreClick:this.handleOnMoreClick,handleTagsClick:l,MESSAGE_TYPE:o,updateMessInfoTags:c,onStateChange:u})},t}(d.PureComponent),Xt=n(32624),$t=n(98482),en=n(12021),tn=["loading"],nn=ne.Z.message.inboxDetail,an=ne.Z.inbox,rn=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleStateChange=function(e,t){switch(e){case"open-add":a.setState({curMsgId:t,wkOrderModalVisible:!0});break;case"open-relate":a.setState({curMsgId:t,wkRelatedModalVisible:!0});break;case"remove-relate":a.props.saveRelatedCount({id:t,count:-1})}},a._handleOnScrollRefresh=function(){var e=a.props,t=e.data,n=e.noMoreData,r=e.detailParams;!n&&r&&("SERVICE"===t.messageCategory?a.props.fetchCustomerServiceDetail():a.props.fetchMsgDetail(),setTimeout((function(){a.props.fetchEnableOperatorList()}),0))},a._handleOnFeedbackClick=function(e){var t=a.state.projectId;a.drawerRef.show({aspectList:e.aspectVos.map((function(e){return(0,r.Z)({},e,{aspect2:e.aspect2Name})})),callback:function(r){a.props.feedbackCommentTags({feedbackDetails:r,messageId:e.messageId,projectId:t,messageContent:e.messageContent,historyTag:e.aspectVos&&e.aspectVos.length?JSON.stringify(e.aspectVos.filter((function(e){return e.escore})).map((function(e){return{aspect1:e.aspect1Name,aspect2:e.aspect2Name,aspect:e.aspect2Name,escore:e.escore,highLightInfoList:e.highLightInfoList}}))):""}).then((function(e){2e4===e.data.code&&m.default.success({style:{marginTop:"85px"},className:"feedback_success_message",content:d.createElement("div",{className:"feedback_success_tip"},d.createElement("img",{src:n(43134)}),d.createElement("p",null,"\u6307\u6807\u53cd\u9988\u6210\u529f\uff0c\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01"))})}))}})},a._handleRelated=function(e,t,n){var s=a.state.addRelationLoading,i=a.props.saveRelatedCount;if(!s){var l=e.id,o=e.params,c=a.state.projectId;a.setState({addRelationLoading:!0}),(0,en.Im)((0,r.Z)({id:l,projectId:c,kind:"MESSAGE"},t?{workOrderIdList:o}:{workOrderParam:(0,r.Z)({projectId:c},o)})).then((function(e){2e4===e.data.code&&X.Z.success(t?"\u5de5\u5355\u5173\u8054\u6210\u529f":"\u5de5\u5355\u521b\u5efa\u6210\u529f")&&a.setState({wkOrderModalVisible:!1,addRelationLoading:!1,addedCount:t?""+(a.state.addedCount+1):a.state.addedCount+1}),i({id:l,count:t?o.length:1}),n&&n()})).catch((function(e){40009===(null==e?void 0:e.data.code)&&(m.default.destroy(),X.Z.error(/[0-9a-f]{32}/.test(e.data.msg)?"\u90e8\u5206\u5b57\u6bb5\u6216\u9009\u9879\u88ab\u7ba1\u7406\u5458\u4fee\u6539\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u9875\u9762\u540e\u64cd\u4f5c":e.data.msg)),a.setState({addRelationLoading:!1})}))}},a._handleMsgType=function(e,t,n,s,i){switch(e){case"QUE_ANS":return d.createElement(Jt,(0,r.Z)({},i,{data:t||n,key:s,ref:a._getPageRef}));case"COMPLAINT":return d.createElement(Gt,(0,r.Z)({},i,{data:t||n,key:s,ref:a._getPageRef}));case"NEWS":return d.createElement(ke,(0,r.Z)({},i,{data:t||n,key:s}));case"SELF":return d.createElement(Ne,(0,r.Z)({},i,{data:t||n,key:s}));case"QUESTION":case"COMMENT":return d.createElement(Pe,(0,r.Z)({},i,{data:t||n,key:s}));case"APP_COMMENT":return d.createElement(nt,(0,r.Z)({},i,{data:t||n,key:s}));case"TICKET":return d.createElement(st,(0,r.Z)({},i,{data:t||n,key:s}));case"SERVICE":return d.createElement(De,(0,r.Z)({},i,{data:t||n,key:s}));case"BBS":case"COMMENT_REPLY":return d.createElement(ot,(0,r.Z)({},i,{data:t||n,key:s}));case"WEIBO":case"SOCIAL":return d.createElement(Ie,(0,r.Z)({},i,{data:t||n,key:s}));case"QUESTIONAIRE":return d.createElement(Ut,(0,r.Z)({},i,{data:t||n,key:s}));case"VIDEO":return d.createElement(Qt,(0,r.Z)({},i,{data:t||n,key:s}));default:return d.createElement(o.Z,null)}},a.state={projectId:c.t.get(c.V.curProject).id,curMsgId:void 0,wkOrderModalVisible:!1,wkRelatedModalVisible:!1,addedCount:0,addRelationLoading:!1},a.event={onScrollRefresh:a._handleOnScrollRefresh,onFeedbackClick:a._handleOnFeedbackClick,onStateChange:a._handleStateChange,getDrawerRef:function(e){return a.drawerRef=e}},a}(0,s.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.fetchMsgDetail=h()(this.props.fetchMsgDetail,700,{leading:!0}),this.fetchCustomerServiceDetail=h()(this.props.fetchCustomerServiceDetail,700,{leading:!0})},a.componentDidUpdate=function(e,t){var n=this,a=e.data,s=this.props.data;if(JSON.stringify(a)!==JSON.stringify(s)&&s&&s.messageCategory){this.props.clean();var i=(0,r.Z)({},s,{parent:"",projectId:this.state.projectId,id:"QUESTIONAIRE"===s.messageCategory?s.messageId:s.id});"SERVICE"===s.messageCategory?this.fetchCustomerServiceDetail(i):this.fetchMsgDetail(i),setTimeout((function(){n.props.fetchEnableOperatorList()}),0)}},a.render=function(){var e=this,t=this.props,n=t.isEmpty,a=t.data,s=t.detailData,i=this.state,l=i.curMsgId,o=i.wkOrderModalVisible,c=i.wkRelatedModalVisible,u=i.addRelationLoading,m=i.addedCount,p=a&&a.messageCategory||"",h=a&&a.id||"";if(n)return d.createElement("div",{style:{background:"white",height:"100%"}},d.createElement("div",{className:"empty-block"},"\u6ca1\u6709\u6570\u636e..."));var g=(0,r.Z)({},this.props,this.state,this.event,{messageCategory:p,detailParams:(0,r.Z)({},this.props.data,{projectId:this.state.projectId})});return d.createElement(d.Fragment,null,this._handleMsgType(p,a,s,h,g),d.createElement(Xt.Z,{visible:o,editType:"new",otherConfig:{hideSetting:!0,relatedAdd:function(t,n){return e._handleRelated({id:l,params:t},null,n)}},setVisible:function(t,n){e.setState({wkOrderModalVisible:t})}}),d.createElement($t.Z,{id:l,addRelationLoading:u,addedCount:m,visible:c,relationKind:"MESSAGE",relatedAdd:function(t,n){return e._handleRelated({id:l,params:t},"list",n)},setVisible:function(t,n){e.setState({wkRelatedModalVisible:t,addedCount:0})},onStateChange:function(t,n){return e._handleStateChange(t,n||l)}}))},t}(d.PureComponent);const sn=(0,w.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,tn);return(0,r.Z)({},n[nn],{MESSAGE_TYPE:n[an].MESSAGE_TYPE,total:n[an].total,loading:t.effects[nn+"/fetchMsgDetail"]||!1})}),(function(e){return{fetchMsgDetail:function(t){return e({type:nn+"/fetchMsgDetail",payload:t})},fetchEnableOperatorList:function(t){return e({type:nn+"/fetchEnableOperatorList",payload:t})},fetchCustomerServiceDetail:function(t){return e({type:nn+"/fetchCustomerServiceDetail",payload:t})},saveRelatedCount:function(t){return e({type:nn+"/saveRelatedCount",payload:t})},clean:function(t){return e({type:nn+"/clean",payload:t})},resetIndex:function(t){return e({type:nn+"/save",payload:t})},feedbackCommentTags:function(t){return e({type:nn+"/feedbackCommentTags",payload:t})},updateMessInfoTags:function(t){return e({type:nn+"/updateMessInfoTags",payload:t})}}}))(rn);const ln=function(e){var t=e.sourceName,n=e.transConnectionName,a=e.messageCategory,r=e.questionnaireId,s=e.dataLevel,i=e.existQuestionnaire;return d.createElement(y.Z,{overlay:t+(n?"-"+n:""),placement:"topLeft",mouseEnterDelay:.6,overlayStyle:{maxWidth:424}},d.createElement("span",{onClick:function(){"QUESTIONAIRE"===a&&function(){var e=JSON.stringify({questionnaireId:r,dataLevel:s});i?window.open("/research/manage?"+encodeURIComponent(e)):m.default.error("\u8be5\u95ee\u5377\u5df2\u4e0d\u5b58\u5728")}()},className:"survery_Type"},t+(n?"-"+n:"")))};const on=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={filterRef:{}},n}(0,s.Z)(t,e);var n=t.prototype;return n.handleFilterShow=function(e,t){var n=this.state.filterRef;n[e]?n[e]=Object.assign(n[e],t):n[e]=t,this.setState({filterRef:(0,r.Z)({},n)})},n.render=function(){var e=this,t=this.state.filterRef,n=this.props.unreducedFilter;return d.createElement("div",{className:"not_restored_wrapper"},d.createElement("div",{className:"title"},"\u672a\u8fd8\u539f\u7b5b\u9009\u6761\u4ef6"),n&&n.map((function(n){return d.createElement("dl",{key:n.id},d.createElement("dt",null,n.label),d.createElement("dd",{ref:function(a){return!t[n.id]&&e.handleFilterShow(n.id,{ref:a,clientHeight:a.clientHeight,class:a.clientHeight>22?"collaspe":"",isShow:!1})},className:t[n.id]&&t[n.id].class?"showItem "+(t[n.id].isShow?"":t[n.id].class):""},d.createElement("span",null,n.values.join("\u3001")),t[n.id]&&t[n.id].class?d.createElement("span",{onClick:function(){return e.handleFilterShow(n.id,{isShow:!t[n.id].isShow})}},t[n.id].isShow?"\u6536\u8d77":"\u5c55\u5f00"):""))})))},t}(d.Component);const cn=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){var e,t,n=this.props.extraParameter;return d.createElement("div",{className:"extra_parameter_wrapper"},d.createElement("div",null,d.createElement("span",{className:"title"},n[0]),d.createElement("span",null,n[1]),n[2]&&d.createElement("span",{style:null==(e=n[2])?void 0:e.style},null==(t=n[2])?void 0:t.title)))},t}(d.Component);var dn=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.onConfirm,a=t.onCancel,r=t.style;return d.createElement("div",{className:"bottom_bar",style:r||{}},d.createElement("ul",{className:"handle"},this.props.screeningValues.length>0&&d.createElement("li",null,d.createElement("span",{className:"clear",onClick:function(){return e.props.clearAllValues()}},"\u6e05\u7a7a\u9009\u9879"))),d.createElement(E.Button,{type:"primary",onClick:function(){n&&n()}},"\u67e5\u8be2"),d.createElement(E.Button,{onClick:function(){a&&a()}},"\u53d6\u6d88"))},t}(d.PureComponent);const un=dn;var mn=n(85151),pn=100,hn=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleCheckedAll=function(e){var t,a=n.props,r=a.data,s=a.changeState,i=a.allListLength,l=n.state.checkedList;if(i>pn){var o=r.slice(0,pn).map((function(e){return e.id}));t=e.target.checked?Array.from(new Set(o.concat(l))):l.filter((function(e){return!o.includes(e)}))}else t=e.target.checked?r.map((function(e){return e.id})):[];n.setState({newCheckedList:t}),s&&s(t,n.props.secondValue)},n.handleChange=function(e){Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)};var t=n.state.checkedList,a=n.props.changeState;-1===t.indexOf(e)?t.push(e):t.remove(e),n.setState({checkedList:t}),a&&a(t,n.props.secondValue)},n.handleSecondChange=function(e,t){var a=n.props,r=(a.data,a.secondValue),s=a.changeState;Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},r.some((function(n){return n.id===e&&(n.values.indexOf(t)>-1?n.values.remove(t):n.values.push(t),!0)}))||r.push({id:e,values:[t]}),s&&s(n.props.checkedList,r.filter((function(e){return e.values.length>0})))},n.competeOpen=function(){n.checkBox.offsetHeight>45?n.setState({showOpen:!0}):n.setState({showOpen:!1})},n.renderSecondList=function(e){var t=n.props,a=t.secondValue,r=t.secondInfo,s=n.state,i=s.showSecond,l=s.searchKeywords;return d.createElement("div",{className:"second-list"},d.createElement("span",{className:"name",onClick:function(e){return n.setState({showSecond:!i})}},d.createElement("i",{className:i?"icon-cem_data-collection":"icon-cem_unfolding-data"}),d.createElement("span",null,r.name)),i&&e.filter((function(e){return-1!==e.name.toLowerCase().indexOf(l.toLowerCase())})).map((function(e,t){var r=a.filter((function(t){return t.id===e.id})).length>0?a.filter((function(t){return t.id===e.id}))[0].values:[];return d.createElement("div",{key:t,className:"second-wrap"},d.createElement("span",{className:"title-second"},e.name),d.createElement("div",{className:"check-wrap"},e.child.map((function(t,a){return d.createElement(mn.Jg,{className:"checkbox-yt",onChange:function(){return n.handleSecondChange(e.id,t.id)},key:t.id,value:t.id,checked:-1!==r.indexOf(t.id)},t.name)}))))})))},n.state={checkedList:t.checkedList||[],open:!1,showOpen:!1,showSecond:!0,searchKeywords:t.searchKeywords},n}(0,s.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){var t=this;(e.checkedList||e.searchKeywords)&&this.setState({checkedList:e.checkedList,searchKeywords:e.searchKeywords},(function(){return t.competeOpen()}))},n.componentDidMount=function(){this.competeOpen(),window.addEventListener("resize",this.competeOpen)},n.componentWillUnmount=function(){window.removeEventListener("resize",this.competeOpen)},n.render=function(){var e=this,t=this.state,n=t.checkedList,a=t.open,r=t.showOpen,s=t.searchKeywords,i=this.props,l=i.data,o=i.categoryTitle,c=i.title,u=i.close,m=i.onSearch,p=l.map((function(e){return e.id})),h=n.filter((function(e){return p.indexOf(e)>=0})),g=!!h.length&&l.slice(0,pn).every((function(e){return n.includes(e.id)})),f=!g&&!!h.length&&l.slice(0,pn).some((function(e){return n.includes(e.id)})),v=l.filter((function(e){return n.includes(e.id)&&e.child&&e.child.length>0}));return d.createElement("div",{className:"checkbox-panel-yt"},d.createElement("span",{className:"title"},c,m&&d.createElement(y.Z,{overlay:"\u6309\u4e3b\u9898\u503c\u641c\u7d22",placement:"top",mouseEnterDelay:.6},d.createElement("i",{className:"icon-cem_search search",onClick:function(e){return m()}}))),d.createElement(mn.Jg,{className:"check-all",checked:g,indeterminate:f,onChange:this.handleCheckedAll,disabled:this.props.disabled},o||"\u5168\u9009"),d.createElement("div",{className:"all-checkbox",style:{height:a?"":"38px"}},d.createElement("span",{className:"more"},r&&d.createElement("i",{className:"open",onClick:function(t){return e.setState({open:!a})}},a?"\u6536\u8d77":"\u66f4\u591a",d.createElement("i",{className:a?"icon-cem_pull-or-take-up":"icon-cem_pull-down-or-take-up"})),u&&d.createElement("i",{className:"close",onClick:u},"\xd7")),d.createElement("div",{className:"check-box",ref:function(t){return e.checkBox=t}},l&&l.filter((function(e){return!s||-1!==e.name.toLowerCase().indexOf(s.toLowerCase())})).slice(0,pn).map((function(t){return d.createElement(mn.Jg,{className:"checkbox-yt",onChange:function(){return e.handleChange(t.id)},key:t.id,value:t.id,checked:-1!==n.indexOf(t.id),disabled:e.props.disabled},t.name)})),l&&l.length>pn&&d.createElement("div",{className:"tip"},"\u2014 \u8be5\u6570\u503c\u5c55\u793a\u4e0d\u4f1a\u8d85\u8fc7",pn,"\u6761,\u9700\u8981\u67e5\u770b\u66f4\u591a\u8bf7\u641c\u7d22"))),v.length>0&&this.renderSecondList(v))},t}(d.Component);hn.propTypes={checkedList:f().array,secondInfo:f().array,secondValue:f().array,data:f().array,allListLength:f().oneOfType([f().number,f().string]),changeState:f().func,searchKeywords:f().string,onSearch:f().func,title:f().oneOfType([f().number,f().string]),close:f().func};var gn=function(e){function t(t){var n;return(n=e.call(this,t)||this)._setEvent=function(e){return 0===e?{onMouseEnter:function(){n.setState({firstLiHover:!0})},onMouseLeave:function(){n.setState({firstLiHover:!1})}}:{}},n.setDefaultValue=function(){var e=n.getValue();v.h.post("/default/value/update",{projectId:c.t.get(c.V.curProject).id,key:"PRODUCT_ANALYSIS_OBJ",value:JSON.stringify(e)}).then((function(t){n.setState({defaultSelectValue:e,shouldUpdataDefaultSelectValue:!1})}))},n.state={options:[{}],sel:[{name:""},{name:""}],defaultSelectValue:n.props.defaultSelectValue,shouldUpdataDefaultSelectValue:!0,value:{},firstLiHover:!1},n}(0,s.Z)(t,e);var n=t.prototype;return n.onSel=function(e,t){var n=this,a=this.state.options;a.forEach((function(e){return e.sel=!1})),a[t].sel=!0,this.setState({options:a},(function(e){return n.props.onChange&&n.props.onChange(n.getValue())}))},n.getValue=function(){return JSON.parse(JSON.stringify(this.state.options)).filter((function(e){return e.sel}))[0]},n.UNSAFE_componentWillReceiveProps=function(e){if(e.options||e.value){var t=JSON.parse(JSON.stringify(e.options)),n=JSON.parse(JSON.stringify(e.value));t.forEach((function(e){e.id===n.id&&(e.sel=!0)})),this.setState({options:t,value:n}),this.state.shouldUpdataDefaultSelectValue&&this.setState({defaultSelectValue:e.defaultSelectValue})}},n.UNSAFE_componentWillMount=function(){var e=this.props.options,t=this.props.value?this.props.value:{};e.forEach((function(e){e.id===t.id&&(e.sel=!0)})),this.setState({options:e,value:t})},n.componentWillUnmount=function(){},n.render=function(){var e=this,t=this.state,n=t.options,a=t.defaultSelectValue,s=n[0]&&n[0].sel;return d.createElement("div",{className:"selItem "+(this.props.triangle?"triangle":"")+" "+(this.state.firstLiHover||s?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},d.createElement("div",{className:"wrap"},d.createElement("ul",null,n.length>0?n.map((function(t,n){return d.createElement("li",(0,r.Z)({className:(t.sel?"sel":"")+(t.disable?" disable":""),key:n,onClick:function(t){return e.onSel(t,n)}},e._setEvent(n)),d.createElement("span",null,t.name),!e.props.noCollect&&t.sel&&d.createElement("i",{className:"default icon-cem_star",style:{color:a.id===t.id?"#D5B437":"#8C8C8C",opacity:a.id===t.id?"1":""},onClick:a.id===t.id?null:e.setDefaultValue}),d.createElement("i",{className:"check cem-icon icon-cem_arrow-thick"}))})):d.createElement("div",{className:"noData"},"\u65e0\u6570\u636e"))))},t}(d.Component);gn.propTypes={noCollect:f().bool,options:f().array,value:f().object,onChange:f().func};var fn=function(e){function t(){var t;return(t=e.call(this)||this).sortList=function(e,n,a){a.stopPropagation(),a.nativeEvent.stopImmediatePropagation();var r=JSON.parse(JSON.stringify(t.state.value)),s=r.splice(e,1)[0];switch(n){case"top":r.unshift(s);break;case"up":r.splice(e-1,0,s);break;case"down":r.splice(e+1,0,s)}t.setState({value:r},(function(e){return t.props.onChange&&t.props.onChange(t.getValue())}))},t._setEvent=function(e){return 0===e?{onMouseEnter:function(){t.setState({firstLiHover:!0})},onMouseLeave:function(){t.setState({firstLiHover:!1})}}:{}},t.state={options:[],value:[],showSel:!1,firstLiHover:!1,searchWord:""},t}(0,s.Z)(t,e);var n=t.prototype;return n.onSel=function(e,t){var n=this,a=this.state.options,r=this.state.value;!t.sel&&this.props.limit&&r.length>=this.props.limit?X.Z.warning("\u6700\u591a\u9009\u62e9"+this.props.limit+"\u4e2a\u5bf9\u8c61\uff01"):(a.forEach((function(e){e.id===t.id&&(n.props.singelSel?(e.sel=!0,r=[e]):(e.sel=!e.sel,e.sel?r.push(e):r.some((function(e,n){return e.id===t.id&&(r.splice(n,1),!0)}))))})),this.setState({options:a,value:r},(function(e){return n.props.onChange&&n.props.onChange(n.getValue())})))},n.getValue=function(){return this.state.value},n.UNSAFE_componentWillReceiveProps=function(e){if(e.options||e.value){var t=JSON.parse(JSON.stringify(e.options)),n=JSON.parse(JSON.stringify(e.value));t.forEach((function(e){n.map((function(e){return e.id})).includes(e.id)?e.sel=!0:e.sel=!1})),this.setState({options:t,value:n})}},n.UNSAFE_componentWillMount=function(){var e=this.props,t=e.options,n=e.value,a=void 0===n?[]:n;t.forEach((function(e){a.map((function(e){return e.id})).includes(e.id)&&(e.sel=!0)})),this.setState({options:t,value:a})},n.componentWillUnmount=function(){},n.render=function(){var e=this,t=this.state,n=t.options,a=t.value,s=t.searchWord,i=[];return a.length>0&&n.filter((function(e){return e.sel})).length>0&&a.forEach((function(e){n.filter((function(t){return t.id===e.id}))[0]&&i.push(n.filter((function(t){return t.id===e.id}))[0])})),d.createElement("div",{className:"analyze-object-sort-select"},d.createElement("div",{className:"selItem "+(this.props.triangle?"triangle":"")+" "+(this.state.firstLiHover?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},d.createElement("div",{className:"wrap"},d.createElement("div",null,d.createElement(E.Input,{value:s,placeholder:"\u8f93\u5165\u641c\u7d22\u5173\u952e\u8bcd",className:"search",icon:"close",onChange:function(t){return e.setState({searchWord:t})},onIconClick:function(){return e.setState({searchWord:""})}})),d.createElement("ul",null,i.length>0&&i.filter((function(e){return!s||-1!==e.name.toLocaleLowerCase().indexOf(s.trim().toLocaleLowerCase())})).map((function(t,n){return d.createElement("li",(0,r.Z)({className:(t.sel?"sel":"")+(t.disable?" disable":""),key:n,onClick:function(n){return e.props.singelSel?"":e.onSel(n,t)}},e._setEvent(n)),!e.props.singelSel&&d.createElement(mn.Jg,{className:"check-all",checked:t.sel,onChange:function(e){}}),d.createElement("span",null,t.name),!e.props.singelSel&&d.createElement("div",{className:"handle"},0!==n&&d.createElement("i",{title:"\u7f6e\u9876",onClick:function(t){e.sortList(n,"top",t)},className:"icon-cem_roof-placement"}),0!==n&&d.createElement("i",{title:"\u4e0a\u4e00\u4f4d",onClick:function(t){e.sortList(n,"up",t)},className:"icon-cem_upper"}),n!==i.length-1&&d.createElement("i",{title:"\u4e0b\u4e00\u4f4d",onClick:function(t){e.sortList(n,"down",t)},className:"icon-cem_lower"})))})),i.length>0&&n.filter((function(e){return!e.sel})).length>0&&d.createElement("div",{className:"line"}),n.filter((function(e){return!e.sel})).length>0&&n.filter((function(e){return!e.sel})).filter((function(e){return!s||-1!==e.name.toLocaleLowerCase().indexOf(s.trim().toLocaleLowerCase())})).map((function(t,n){return d.createElement("li",{className:(t.sel?"sel":"")+(t.disable?" disable":""),key:n,onClick:function(n){return e.onSel(n,t)}},!e.props.singelSel&&d.createElement(mn.Jg,{className:"check-all",checked:t.sel,onChange:function(e){}}),d.createElement("span",{className:"dark"},t.name))})),0===n.length&&d.createElement("div",{className:"noData"},"\u65e0\u6570\u636e")))))},t}(d.Component);fn.propTypes={options:f().array,value:f().array,onChange:f().func,singelSel:f().bool};var vn=function(e){function t(t){var n;return(n=e.call(this,t)||this).stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.getPropsValue=function(){var e=n.props.value;e&&e[0]&&e[0].id&&(n.setState({selectValue:{id:e[0].id,name:e[0].name}},(function(){return n.copyVal=n.getValue()})),e[0].values&&n.setState({sortSelectValue:e[0].values},(function(){return n.copyVal=n.getValue()})))},n.setShowSelFalse=function(){n.state.show&&(n.setState({selectValue:n.copyVal?{id:n.copyVal[0].id,name:n.copyVal[0].name}:{},sortSelectValue:n.copyVal&&n.copyVal[0].values?n.copyVal[0].values:[]}),n.cancel()),n.state.show&&n.setState({show:!1})},n.cancel=function(){n.setState({show:!1})},n.onSelChange=function(e,t){var a;n.setState(((a={})[e]=t,a)),"selectValue"===e&&n.setState({sortSelectValue:[]})},n.state={list:t.list||[],selectValue:{},sortSelectValue:[],show:!1,triangle:"select"},n}(0,s.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillMount=function(){if(this.props.left&&this.props.left<-200&&this.setState({triangle:"sortSelect"}),this.props.value){var e=this.props.value;this.setState({selectValue:{id:e.id,name:e.name},sortSelectValue:e.values})}},n.componentDidMount=function(){var e=this;this.getPropsValue(),window.addEventListener("click",this.setShowSelFalse),this.props.left&&document.querySelectorAll(".analyze-object").forEach((function(t){return t.style.setProperty("--x",e.props.left+"px")}))},n.UNSAFE_componentWillUpdate=function(e){this.state.show||"{}"===JSON.stringify(this.state.selectValue)||"[]"!==JSON.stringify(e.value)||this.setState({selectValue:{},sortSelectValue:[]})},n.componentWillUnmount=function(){window.removeEventListener("click",this.setShowSelFalse)},n.getValue=function(){return this.state.selectValue.id?[{id:this.state.selectValue.id,values:this.state.sortSelectValue,name:this.state.selectValue.name}]:{}},n.changeShow=function(e){var t=this;this.state.show&&this.stop(e),setTimeout((function(){t.setState({show:!t.state.show})}),0)},n.render=function(){var e=this,t=this.state,n=t.list,a=t.selectValue,r=t.sortSelectValue,s=t.defaultSelectValue,i=t.show,l=t.triangle,o=n.map((function(e){return{id:e.id,name:e.name}})),c=this.props.close,u=n.filter((function(e){return e.id===a.id}))[0]?n.filter((function(e){return e.id===a.id}))[0].values.map((function(e){return delete e.sel,e})):[],m=a.name?a.name+(r.map((function(e){return e.name})).filter((function(e){return e})).length?" | "+r.map((function(e){return e.name})).filter((function(e){return e})).join(","):""):"\u8bf7\u9009\u62e9";return d.createElement("div",{className:"checkbox-panel-yt-point"},d.createElement("span",{className:"title"},this.props.name),d.createElement("div",{className:"all-checkbox",style:{height:open?"":"38px"}},d.createElement("span",{className:"more"},c&&d.createElement("i",{className:"close",onClick:c},"\xd7")),d.createElement("div",{className:"check-box",ref:function(t){return e.checkBox=t}},d.createElement("div",{className:"service-analyze-object"},d.createElement("div",{className:"analyze-object-select",onClick:function(t){return e.changeShow(t)}},d.createElement("div",{className:"infor "+(i?"sel":"")},d.createElement("span",null,m),d.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:i?"rotate(-180deg)":""}})),i&&d.createElement(gn,{noCollect:!0,options:o,defaultSelectValue:s,value:a,onChange:function(t){return e.onSelChange("selectValue",t)},triangle:"select"===l})),i&&d.createElement(fn,{options:u,limit:this.props.limit,value:r,onChange:function(t){return e.onSelChange("sortSelectValue",t)},triangle:"sortSelect"===l}),i&&d.createElement("div",{className:"footer",onClick:function(t){return e.stop(t)}},o.length>0&&d.createElement("div",{className:"control"},d.createElement(E.Button,{type:"primary",disabled:!o.length||!u.length||!a.id,onClick:function(){e.copyVal=e.getValue(),e.cancel(),e.props.onChange&&e.props.onChange(e.getValue())}},"\u786e\u5b9a"),d.createElement("span",{className:"cancel",onClick:function(){e.setState({selectValue:e.copyVal?{id:e.copyVal[0].id,name:e.copyVal[0].name}:{},sortSelectValue:e.copyVal&&e.copyVal[0].values?e.copyVal[0].values:[]}),e.cancel()}},"\u53d6\u6d88")))))))},t}(d.Component);const En=function(e){var t=e.searchInfo,n=e.onInput,a=e.onClose,r=d.useState(!0),s=r[0];r[1];return d.createElement("div",{className:"filter-search-wrap"},d.createElement("div",{className:"search"},d.createElement("span",null,d.createElement("i",{className:"icon-cem_search"}),d.createElement("span",null,t.name+":")),d.createElement("input",{placeholder:"\u8bf7\u8f93\u5165\u641c\u7d22\u8bcd",autoFocus:!0,value:t.keyword,onInput:function(e){return s&&n(e)}})),d.createElement("i",{className:"icon-cem_delete del",onClick:a}))};var yn=function(e){function t(t){var n;return(n=e.call(this,t)||this).inputChange=function(e){n.setState({inputVal:e.target.value})},n.keywordChange=function(e){var t=n.state,a=t.inputVal,r=t.inputValMap;"keydown"===e.type&&13===e.keyCode||"keydown"===e.type&&32===e.keyCode||"blur"===e.type?a.trim()&&(r.push(a.trim()),n.setState({inputValMap:r,inputVal:""}),n.onChange()):"keydown"===e.type&&8===e.keyCode||e.type},n.delKeyWords=function(e){var t=n.state.inputValMap;t.splice(e,1),n.setState({inputValMap:t},(function(e){return n.onChange()}))},n.onChange=function(){n.props.onChange&&n.props.onChange(n.state.inputValMap)},n.state={inputValMap:t.values?t.values:[],inputVal:""},n}(0,s.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e,t){e.values&&this.setState({inputValMap:e.values})},n.render=function(){var e=this,t=this.state,n=t.inputValMap,a=t.inputVal,r=this.props,s=r.style,i=r.close;return d.createElement("div",{className:"word-segmentation",style:s||{}},i&&d.createElement("i",{className:"close",onClick:i},"\xd7"),d.createElement("div",{className:"input-wrap"},d.createElement("input",{type:"text",className:"keyword-setting",value:a,placeholder:"\u5173\u952e\u8bcd(\u8f93\u5165\u7a7a\u683c\u952e\u6216\u56de\u8f66\u4ee5\u5206\u8bcd)",onChange:this.inputChange,onBlur:this.keywordChange,onKeyDown:this.keywordChange})),n.map((function(t,n){return d.createElement("span",{className:"word",key:t+n},t,d.createElement("i",{onClick:function(){return e.delKeyWords(n)}},"\xd7"))})))},t}(d.Component);const Cn=yn;const Sn=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleChangeSel=function(e,t){n.props.screeningValuesChange({values:[{listDetail:e,values:t}],type:n.props.type})},n.renderCheckBox=function(e,t,a){var r=n.state.searchInfo;return d.createElement(hn,{key:t,checkedList:a,data:e.list,changeState:function(t){return n.handleChangeSel(e,t)},searchKeywords:r.id===e.id?r.keyword:"",onSearch:function(){n.setState({searchInfo:{isSearching:!0,id:e.id,name:e.name,keyword:""}})},title:e.name})},n._handelKeywordChange=function(e){var t=n.state.searchInfo;n.setState({searchInfo:{isSearching:!0,id:t.id,name:t.name,keyword:e.target.value}})},n._handelKeywordClose=function(){return n.setState({searchInfo:{isSearching:!1,id:"",name:"",keyword:""}})},n.state={searchInfo:{isSearching:!1,id:"",name:"",keyword:""}},n}(0,s.Z)(t,e);var n=t.prototype;return n.renderRadio=function(e,t,n){var a=this;return d.createElement(RadioPanel,{key:t,value:n,data:e.list,changeState:function(t){return a.handleChangeSel(e,t)},onSearch:function(e){},title:e.name})},n.renderCascade=function(e,t,n){var a=this;return d.createElement(vn,{left:-66,key:t,list:e.list,value:n,onChange:function(t){return a.handleChangeSel(e,t)},name:e.name})},n.renderWordSegmentation=function(e,t,n){var a=this;return d.createElement("div",{className:"key-word-wrap",key:t},d.createElement("span",{className:"title"},e.name),d.createElement(Cn,{style:{width:"calc(100% - 108px)"},values:n,onChange:function(t){return a.handleChangeSel(e,t)}}))},n.componentDidMount=function(){},n.render=function(){var e=this,t=this.props.screeningList,n=this.state.searchInfo;return d.createElement("div",{className:"screening_view"},d.createElement("div",{className:"screening"},n.isSearching&&d.createElement(En,{searchInfo:n,onInput:this._handelKeywordChange,onClose:this._handelKeywordClose}),t.map((function(t,n){var a=e.props.screeningValues.filter((function(e){return e.id===t.id}))[0]?e.props.screeningValues.filter((function(e){return e.id===t.id}))[0].values:[];switch(t.type){case"checkbox":return e.renderCheckBox(t,n,a);case"cascade":return e.renderCascade(t,n,a);case"keywords":return e.renderWordSegmentation(t,n,a);default:return null}}))))},t}(d.Component);const Nn=function(e){function t(t){var n;return(n=e.call(this,t)||this).onConfirm=function(){n.props.handelChange(),n.props.handelChangeShow(!1)},n.onCancel=function(){n.props.handelChangeShow(!1)},n.clearAllValues=function(){n.props.clearAllValues({type:n.props.type})},n.state={},n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=(e.handelChangeShow,e.screeningValues);return d.createElement("div",{className:"screening_wrap_view"},d.createElement(Sn,this.props),d.createElement(un,{onConfirm:this.onConfirm,onCancel:this.onCancel,clearAllValues:this.clearAllValues,screeningValues:t}))},t}(d.Component);var wn=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e._handelClick,n=e.select,a=e.name,r=e.style;return d.createElement("div",{className:"HeaderButton",style:r||{}},d.createElement("div",{className:n?"sel wrap":"wrap",onClick:function(){return t()}},d.createElement("i",{className:"icon-cem_screen"}),d.createElement("span",null,a),d.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:n?"rotate(180deg) translateY(-1px)":""}})))},t}(d.PureComponent);const kn=wn;var _n=n(77131);function Tn(e,t,n){return v.h.post("/default/value/update",{key:e,projectId:t,value:n})}var In=n(97189),Ln="empty",bn=function(e){function t(t){var n;return(n=e.call(this,t)||this).getSelectedFilterObj=function(){return n.state.selFilterObj},n._handleListSelect=function(e,t){e.stopPropagation(),n.props.onFilterChange(t),n.setState({selFilterObj:t})},n._handleListStar=function(e,t,a){e.stopPropagation(),n.lastStaredSaveId=t;var r=n.state,s=r.staredFilterId,i=r.savedKey,l=r.projectId,o=r.staredFilterIndex;if(s!==t){if(-1!==o){var c=document.querySelectorAll(".saved-condition-list .star")[o].children[1];(0,In.removeClass)(c,"star-active")}(0,In.addClass)(e.target.parentNode,"star-active")}else(0,In.removeClass)(e.target.parentNode,"star-active");n.setState({staredFilterIndex:a,staredFilterId:s===t?Ln:t},(function(){Tn(i,l,n.state.staredFilterId).then((function(e){2e4!==e.data.code&&n.setState({staredFilterId:n.lastStaredSaveId})}))}))},n._handleOnEditClick=function(e,t){e.stopPropagation(),n.refs.saveNameInput.refs.input.value=t.name,n.setState({targetFilterObj:t,editDialogVisible:!0})},n._handleConfitionSaveConfirm=function(){var e,t=n.state,a=t.selFilterObj,r=t.projectId,s=t.targetFilterObj,i=n.props,l=i.model,o=i.onFilterRename;(e=s.id,v.h.post("/filter/find/save",{id:e})).then((function(e){var t=e.data;if(2e4===t.code){var i=n.refs.saveNameInput.refs.input.value;s.id===a.id&&o&&o(i),function(e,t,n,a,r,s){return v.h.post("/filter/add",{name:e,copy:t,type:a,id:n,projectId:r,selected:s})}(i,!1,s.id,l,r,t.result.selected).then((function(e){2e4===e.data.code&&(X.Z.success("\u4fee\u6539\u6210\u529f"),n.setState({editDialogVisible:!1}),n.refresh(a.id))}))}}))},n._handleOnDeleteClick=function(e,t){e.stopPropagation(),n.setState({targetFilterObj:t,delDialogVisible:!0})},n._handleOnDeleteConfirm=function(e){e.stopPropagation();var t,a=n.state,r=a.targetFilterObj,s=a.savedKey,i=a.projectId,l=a.staredFilterId,o=a.filterList,c=a.selFilterObj,d=[(t=r.id,v.h.post("/filter/delete",{id:t,menuModel:{}}))];l===r.id&&d.push(Tn(s,i,Ln)),Promise.all(d).then((function(e){2e4===e[0].data.code&&n.refresh(r.id===c.id?void 0:c.id)})),r.id===c.id&&n.props.onFilterChange(o[0])},n.renderDeleteDialog=function(){var e=n.state,t=e.selFilterObj,a=e.targetFilterObj;return d.createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},d.createElement(E.Dialog,{title:"\u5220\u9664",className:"delete-saved-confition-dialog",size:"tiny",modal:!1,visible:n.state.delDialogVisible,onMouseLeave:function(e){return e.stopPropagation()},onCancel:function(e){return n.setState({delDialogVisible:!1})}},d.createElement(E.Dialog.Body,null,d.createElement("span",null,a&&t&&t.id===a.id?"\u5220\u9664\u8be5\u7b5b\u9009\u5668\u540e\uff0c\u5f53\u524d\u9875\u9762\u7684\u7b5b\u9009\u5668\u5c06\u81ea\u52a8\u5207\u6362\u4e3a\u201d\u5168\u90e8\u6570\u636e\uff08\u9ed8\u8ba4\uff09\u201d\u7b5b\u9009\u5668\uff0c\u662f\u5426\u5220\u9664\uff1f":'\u662f\u5426\u5220\u9664"'+a.name+'"\u7b5b\u9009\u5668\uff1f')),d.createElement(E.Dialog.Footer,null,d.createElement(E.Button,{type:"primary",onClick:n._handleOnDeleteConfirm},"\u786e\u5b9a"),d.createElement(E.Button,{type:"default",onClick:function(e){return n.setState({delDialogVisible:!1})}},"\u53d6\u6d88"))))},n.renderEditDialog=function(){return d.createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},d.createElement(E.Dialog,{title:"\u4fee\u6539\u540d\u79f0",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:n.state.editDialogVisible,onCancel:function(e){return n.setState({editDialogVisible:!1})}},d.createElement(E.Dialog.Body,null,d.createElement(E.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",ref:"saveNameInput"})),d.createElement(E.Dialog.Footer,null,d.createElement(E.Button,{type:"primary",onClick:n._handleConfitionSaveConfirm},"\u786e\u5b9a"),d.createElement(E.Button,{type:"default",onClick:function(e){return n.setState({editDialogVisible:!1})}},"\u53d6\u6d88"))))},n.state={projectId:c.t.get(c.V.curProject).id,savedKey:t.model+"_SAVED_OBJ",filterList:void 0,selFilterObj:void 0,targetFilterObj:{},staredFilterId:Ln,staredFilterIndex:-1,isEditing:!1,delDialogVisible:!1,editDialogVisible:!1},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.componentDidUpdate=function(e,t){this.state.filterList;this.props.show===e.show||this.props.show||this.setState({isEditing:!1,fullListShow:!1})},n.componentWillUnmount=function(){},n.refresh=function(e){var t=this,n=this.state,a=n.savedKey,r=n.projectId,s=(n.staredFilterId,this.props),i=s.model,l=(s.onFilterChange,s.shouldShowDefault),o=void 0,c=function(e,t){return v.h.post("/filter/list",{type:e,projectId:t})}(i,r),d=function(e,t){return v.h.post("/default/value/find",{key:e,projectId:t})}(a,r);return Promise.all([c,d]).then((function(n){var a,r,s,i,c=n[0].data;2e4===c.code&&(a=c.result.all).unshift({id:"default",name:"\u5168\u90e8\u6570\u636e\uff08\u9ed8\u8ba4\uff09"});var d=n[1].data;return 2e4===d.code&&(r=d.result||Ln,s=l?-1:a.findIndex((function(e){return e.id===r})),e&&(i=a.findIndex((function(t){return t.id===e}))),o=i?a[i]:-1===s?a[0]:a[s]),t.setState({delDialogVisible:!1,selFilterObj:o,staredFilterIndex:s,filterList:a,staredFilterId:r,fullListShow:a.length>15&&t.state.fullListShow}),o}))},n.render=function(){var e=this,t=this.state,n=t.filterList,a=t.selFilterObj,r=t.staredFilterId,s=t.isEditing,i=this.props,l=(i.onFilterChange,i.show),o=n?JSON.parse(JSON.stringify(n)):[];return d.createElement("div",{className:"saved-condition-wrapper",style:{display:l?"block":"none",width:o.length>2?"728px":o.length>1?"486px":"278px"}},d.createElement("div",{className:"saved-condition-list"},d.createElement("p",{className:"saved-condition-tip"},"\u63d0\u793a\uff1a\u901a\u8fc7\u7b5b\u9009\u5668\u53ef\u63d0\u9ad8\u56fe\u8868\u67e5\u770b\u6548\u7387"),d.createElement("ul",null,o.map((function(t,n){return d.createElement("li",{className:s?"editing":"star",key:s?"edit"+n:"star"+n,onClick:function(n){return e._handleListSelect(n,t)}},d.createElement("span",{className:a&&a.id===t.id?"active":""},d.createElement("i",{className:"radio"}),d.createElement("span",null,t.name)),"default"!==t.id&&d.createElement("span",{className:"edt-active tool"},d.createElement(y.Z,{placement:"top",overlay:r===t.id?"\u53d6\u6d88\u9ed8\u8ba4":"\u8bbe\u4e3a\u9ed8\u8ba4"},d.createElement("span",{className:r===t.id?"star-active":"",onClick:function(a){return e._handleListStar(a,t.id,n)}},d.createElement("i",{className:r===t.id?"icon-cem_star":"icon-cem_star-line"}))),d.createElement(y.Z,{placement:"top",overlay:"\u91cd\u547d\u540d"},d.createElement("span",{onClick:function(n){return e._handleOnEditClick(n,t)}},d.createElement("i",{className:"icon-cem icon-cem_screening-editor"}))),d.createElement(y.Z,{placement:"top",overlay:"\u5220\u9664"},d.createElement("span",{onClick:function(n){return e._handleOnDeleteClick(n,t)}},d.createElement("i",{className:"icon-cem icon-cem_delete"})))))})))),this.renderDeleteDialog(),this.renderEditDialog())},t}(d.Component);const On=bn;const xn=function(e){function t(t){var n;return(n=e.call(this,t)||this).showSaveDialog=function(e){return n.setState({saveVisible:!0,dialogType:e})},n.hideSaveDialog=function(){return n.setState({saveVisible:!1})},n.state={saveVisible:!1,nameValue:"",dialogType:""},n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.selSaveInfo,a=t.handleSaveScreen,r=this.state,s=r.saveVisible,i=r.nameValue,l=r.dialogType;return d.createElement("div",{className:"button-zone"},d.createElement("div",null,d.createElement("span",{className:"modified"},"\u5df2\u4fee\u6539"),"default"===n.id?d.createElement("a",null,d.createElement("span",{className:"save",onClick:function(){return e.showSaveDialog("save")}},"\u4fdd\u5b58\u4e3a\u7b5b\u9009\u5668")):d.createElement("span",{className:"save",onClick:function(){return a({type:"update"})}},"\u66f4\u65b0\u7b5b\u9009\u5668"),n&&"default"!==n.id&&d.createElement("div",{className:"more-zone"},d.createElement("span",{className:"more"},d.createElement("i",{className:"icon-cem icon-cem_more"})),d.createElement("div",{className:"more-list"},d.createElement("div",{className:"li-item",onClick:function(){return e.showSaveDialog("saveOther")}},"\u53e6\u5b58\u4e3a\u7b5b\u9009\u5668")))),d.createElement(E.Dialog,{title:"save"===this.state.dialogType?"\u4fdd\u5b58\u7b5b\u9009\u6761\u4ef6":"\u7b5b\u9009\u6761\u4ef6\u53e6\u5b58\u4e3a",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:s,onCancel:this.hideSaveDialog},d.createElement(E.Dialog.Body,null,d.createElement(E.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",value:i,onChange:function(t){return e.setState({nameValue:t})}})),d.createElement(E.Dialog.Footer,null,d.createElement(E.Button,{type:"primary",onClick:function(){return a({type:l,name:i})}},"\u786e\u5b9a"),d.createElement(E.Button,{type:"default",onClick:this.hideSaveDialog},"\u53d6\u6d88"))))},t}(d.Component);var Dn=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleDetailShow=function(){n.setState({isShow:!n.state.isShow})},n.competeInfoWidth=function(){if(n.info){n.info.style.whiteSpace="nowrap";var e=[];Array.from(n.info.getElementsByClassName("detail-info")).forEach((function(t){t.style.width="unset",e.push(t.clientWidth),t.style.width="calc(100% - 88px)"}));var t=Math.max.apply(null,e),a=122;a+=t>700?700:t,n.info.style.whiteSpace="normal",n.info.style.width=a+"px"}},n.state={isShow:!1},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;setTimeout((function(){e.competeInfoWidth()}),0)},n.componentWillUnmount=function(){var e=this;setTimeout((function(){e.competeInfoWidth()}),0)},n.render=function(){var e=this,t=this.props.value;return d.createElement("div",{id:"info"},d.createElement("span",{className:"detail",onMouseEnter:this.handelDetailShow},"\u8be6\u60c5"),!this.state.isShow&&d.createElement("div",{className:"info-wrap",onMouseLeave:this.handelDetailShow},d.createElement("div",null,"\u5f53\u524d\u9875\u9762\u7b5b\u9009\u6761\u4ef6"),t&&t.length>0?d.createElement("ul",{ref:function(t){return e.info=t},id:"yt_info_ul"},t.map((function(e,t){return d.createElement("li",{key:t},d.createElement("div",{className:"name"},e.name),"aspect"===e.id?d.createElement("div",{className:"detail-info"},e.values.length>0&&e.values.map((function(e,t){return d.createElement("span",{key:t},e.id,e.values.length>0&&e.values.map((function(e,t){return d.createElement("span",{key:t}," | ",e.name)})))}))):d.createElement("div",{className:"detail-info"},e.values.length>0&&e.values instanceof Array?e.values.slice(0,100).map((function(t,n){return d.createElement("span",{key:n},t+(n===e.values.length-1?"":"\uff0c"))})):d.createElement("span",null,e.values)))}))):d.createElement("div",{className:"noData"},"\u6682\u65e0\u7b5b\u9009\u5185\u5bb9")))},t}(d.Component),Mn={overview:"WAITER_SESSION_OVERVIEW",commodityAnalyze:"WAITER_SESSION_ASPECT",concernAnalyze:"WAITER_SESSION_PRODUCT",all:"MSG_WAITER_SESSION"},Rn=function(e){function t(t){var n;return(n=e.call(this,t)||this).handelChangeShow=function(e){return n.setState({show:e===n.state.show?null:e})},n.handelTimeChange=function(e){n.props.dateValueChange({value:e}).then((function(){n.handelChangeShow(null),n.props.handelValueChange()}))},n.state={show:t.defaultShow?t.defaultShow:null,saveFilterVisible:!1},n}(0,s.Z)(t,e);var n=t.prototype;return n.handleShowSave=function(e){this.saveScreen.setAttribute("class","enter"===e?"title sel":"title"),this.setState({saveFilterVisible:"enter"===e})},n.render=function(){var e=this,t=this.state.show,n=this.props,a=(n.title,n.dateFilter),s=n.handelValueChange,i=n.screeningMap,l=n.children,c=n.selSaveInfo,u=n.handleOnSaveBoxChange,m=n.handleSaveScreen,p=n.getsaveBoxRef,h=n.getTimeRef,g=n.getControlRef,f=n.type,v=n.detailInfo,y=this.state.saveFilterVisible;return d.createElement("div",{className:"service_Filter_view",style:{height:l?"100%":""}},d.createElement(E.Loading,{loading:void 0===i},d.createElement("div",{className:"header_Filter_bar"},d.createElement("div",{className:"title",ref:function(t){return e.saveScreen=t},onMouseEnter:function(){return e.handleShowSave("enter")},onMouseLeave:function(){return e.handleShowSave("leave")}},d.createElement("span",null,"\u7b5b\u9009\u5668: "),d.createElement("span",{className:"save_name"},c.name),d.createElement("i",{className:"icon-cem_arrow-launches"}),d.createElement(On,{ref:p,show:y,model:Mn[f],onFilterChange:u,onFilterRename:function(e){return u(e,"name")}})),"screening"===t&&c&&this.isScreeningChanged&&d.createElement(xn,{ref:g,selSaveInfo:c,handleSaveScreen:m}),d.createElement(Dn,{value:v}),d.createElement(kn,{name:this.time,_handelClick:function(){return e.handelChangeShow("time")},select:"time"===t}),d.createElement(kn,{name:"\u7b5b\u9009",_handelClick:function(){return e.handelChangeShow("screening")},select:"screening"===t})),d.createElement("div",null,"screening"===t&&d.createElement(Nn,(0,r.Z)({},this.props,{handelChangeShow:this.handelChangeShow,handelChange:s})),d.createElement(_n.Z,{ref:h,onChange:function(t){return e.handelTimeChange(t)},show:"time"===t,onCancel:function(){return e.handelChangeShow("time")},params:a}))),l&&d.createElement("div",{className:"contentWrap"},void 0===i?d.createElement(o.Z,null):l))},(0,R.Z)(t,[{key:"time",get:function(){var e="\u65f6\u95f4";return this.props.dateFilter&&this.props.dateFilter.from&&(e=this.props.dateFilter.quickChoice?this.props.dateFilter.quickChoice:this.props.dateFilter.from.replace(/-/g,"/")+"-"+this.props.dateFilter.to.replace(/-/g,"/")),e}},{key:"isScreeningChanged",get:function(){var e=this.props,t=e.selSaveInfo,n=e.screeningValues;return!V()(t.screeningValues,n)}}]),t}(d.Component);const Pn=Rn;var Vn=n(51797),An=["loading"],Fn=ne.Z.serviceFilter,Zn=function(e){function t(t){var n;return(n=e.call(this,t)||this).getAspect1=function(e){var t=n.props.screeningMap,a=null,r=null;if(t.aspect){var s=JSON.parse(t.aspect)[0];Object.keys(s).forEach((function(t){s[t].includes(e)&&(a=t,r=t)}))}return{id:a,name:r}},n.setDefaultValue=function(e){var t=n.props,a=t.screeningMap,r=(t.screeningList,t.type),s=[];if(e)return n.props.saveBoxChange({value:e,type:n.props.type}).then((function(){return n._handelValueChange()}));var i=function(){s.push({id:"product",name:"\u5206\u6790\u5546\u54c1",serverKey:"product",type:"radio",values:a.maxSessionProduct})},l=function(){s.push({id:"aspect",name:"\u5173\u6ce8\u70b9",serverKey:"aspect",type:"cascade",values:[{id:a.maxSessionAspect,name:a.maxSessionAspect,values:[]}]})};if(n.props.value&&n.props.value.length)if(s=JSON.parse(JSON.stringify(n.props.value)),n.props.value.some((function(e){return"product"===e.id}))||"commodityAnalyze"!==r||i(),n.props.value.some((function(e){return"aspect"===e.id}))||"concernAnalyze"!==r){if(n.props.value.some((function(e){return"aspect"===e.id}))&&!n.props.value.filter((function(e){return"aspect"===e.id}))[0].values[0].id&&n.props.value.filter((function(e){return"aspect"===e.id}))[0].values[0].values[0].id){s=s.filter((function(e){return"aspect"!==e.id}));var o=n.props.value.filter((function(e){return"aspect"===e.id}))[0].values[0].values[0].id,c=n.getAspect1(o),d=c.id,u=c.name;s.push({id:"aspect",name:"\u5173\u6ce8\u70b9",serverKey:"aspect",type:"cascade",values:[{id:d,name:u,values:n.props.value.filter((function(e){return"aspect"===e.id}))[0].values[0].values}]})}}else l();else"commodityAnalyze"===r&&i(),"concernAnalyze"===r&&l();n.props.saveValue({value:s,type:n.props.type}).then((function(){n._handelValueChange(n.props.onFilterReady)}))},n._handleOnSaveBoxChange=function(e,t){n.props.saveBoxChange({value:e,type:n.props.type,key:t}).then((function(){return t!==Fn&&n._handelValueChange()}))},n.competeInfoWidth=function(){if(document.getElementById("yt_info_ul")){document.getElementById("yt_info_ul").style.whiteSpace="nowrap";var e=[];Array.from(document.getElementById("yt_info_ul").getElementsByClassName("detail-info")).forEach((function(t){t.style.width="unset",e.push(t.clientWidth),t.style.width="calc(100% - 88px)"}));var t=Math.max.apply(null,e),n=122;n+=t>700?700:t,document.getElementById("yt_info_ul").style.whiteSpace="normal",document.getElementById("yt_info_ul").style.width=n+"px"}},n._handelValueChange=function(e){n.props.saveDetailInfoValue({value:JSON.parse(JSON.stringify(n.props.screeningValues))});var t=[{filterModel:(0,r.Z)({},(0,Vn.bp)(n.props.screeningValues)),dateFilter:n.props.dateFilter},n.props.screeningValues];e?e(t[0],t[1]):n.props.onChange&&n.props.onChange(t[0],t[1]),setTimeout((function(){n.competeInfoWidth()}),0)},n._handleSaveScreen=function(e){var t=e.type,a=e.name;n.props.saveScreening({type:t,name:a,model:n.props.type}).then((function(e){n.saveBoxRef.refresh(e.id)}))},n.state={},n._event={handelValueChange:n._handelValueChange,handleOnSaveBoxChange:n._handleOnSaveBoxChange,handleSaveScreen:n._handleSaveScreen,getsaveBoxRef:function(e){return n.saveBoxRef=e},getTimeRef:function(e){return n.timeRef=e},getControlRef:function(e){return n.controlRef=e}},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.props.screeningMap?(this.props.clearAllValues({type:this.props.type}),Promise.all([this.timeRef.fetchDefaultValue(),this.saveBoxRef.refresh()]).then((function(t){e.setDefaultValue("default"===t[1].id?"":t[1])}))):Promise.all([this.props.fetchScreeningMap({type:this.props.type}),this.timeRef.fetchDefaultValue(),this.saveBoxRef.refresh()]).then((function(t){e.props.dateValueChange({value:t[1]}).then((function(){return e.setDefaultValue("default"===t[2].id?"":t[2])}))}))},n.render=function(){return d.createElement(Pn,(0,r.Z)({},this.state,this._event,this.props))},t}(d.Component);Zn.propTypes={onChange:f().func,onFilterReady:f().func,type:f().string,value:f().array};const Wn=(0,w.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,An);return(0,r.Z)({},n[Fn],{fetchingScreeningMap:t.effects[Fn+"/fetchScreeningMap"]||!1})}),(function(e){return{fetchScreeningMap:function(t){return e({type:Fn+"/fetchScreeningMap",payload:t})},saveBoxChange:function(t){return e({type:Fn+"/saveBoxChange",payload:t})},saveScreening:function(t){return e({type:Fn+"/saveScreening",payload:t})},screeningValuesChange:function(t){return e({type:Fn+"/screeningValuesChange",payload:t})},dateValueChange:function(t){return e({type:Fn+"/dateValueChange",payload:t})},clearAllValues:function(t){return e({type:Fn+"/clearAllValues",payload:t})},saveValue:function(t){return e({type:Fn+"/saveValue",payload:t})},saveDetailInfoValue:function(t){return e({type:Fn+"/saveDetailInfoValue",payload:t})}}}),null,{withRef:!0})(Zn);var Bn=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.canRenderFilter,n=e.filterReady,a=e.filterValue,s=e.onFilterReady,m=e.onFilterChange,p=e.curSelectMessage,h=e.onInboxClick,g=e.onMessageDownload,f=e.onServiceMessageDownload,v=e.MODEL,E=void 0===v?"":v,y=e.total,C=e.messageType,S=e.filterTip,N=e.outsideFilter,w=e.model,k=e.highLightWordList,_=e.hightLightTagsList,T=e.handleTagsClick,I=e.harmonyEvent,L=e.serviceCustomerType,b=e.unreducedFilter,O=e.reducedFilter,x=e.showKind,D=e.extraParameter,M=e.inboxIndex,R=e.showMessage,P=N?N.textRankWord:"",V=["CONN_CONFIG","MESSAGE_RELATION","TAG","DIMENSION","BRAND_SERIES"],A=["fullDate","screening","save","contentSearch"];return"SERVICE"===C&&A.push("nameContentSearch","usernameSearch"),"SOCIAL"===C&&V.push("MESSAGE_USER"),(!C||"QUE_ANS"===C||"BBS"===C||"SOCIAL"===C||"SELF"===C||"NEWS"===C||"COMPLAINT"===C||N&&N.filterModel.vocAspect)&&V.push("ALL_ASPECT","VOC_ASPECT"),"PERSONAL"!==w&&"ARCHIVE"!==w&&"FOLDER"!==w&&(0,u.PM)(C)?d.createElement("div",{className:"inbox_wrap"},d.createElement(l.Z,{onReady:s,onChange:m,pageType:(0,u.PM)(C),noSavingFilterList:!0,reducedScreenValue:O,screenValue:N&&N.headerFilterParamsNew,dateValue:N&&N.dateFilter,advanceAuthority:!["APP_COMMENT","QUESTIONAIRE","SERVICE","TICKET"].includes(C),contentValue:N&&N.filterModel.content&&N.filterModel.queryType&&[{contain:N.filterModel.content[0].contain,queryType:N.filterModel.queryType}],isExplore:!(!S||"\u6570\u636e\u63a2\u7d22/\u81ea\u7531\u63a2\u7d22/\u70ed\u8bcd"!==S),showList:A,hasHour:!0},S&&!b||S&&!b.length&&d.createElement("div",{className:"msg_filter_tip"},d.createElement("i",{className:"icon-cem_warning"}),"\u4f9d\u636e\u300c",S,"\u300d\u67e5\u770b\u539f\u6587\u529f\u80fd\u67e5\u8be2\u51fa\u4ee5\u4e0b\u5185\u5bb9"),!S&&null!==S&&location&&location.search&&!b&&d.createElement("div",{className:"msg_filter_tip"},d.createElement("i",{className:"icon-cem_warning"}),"\u7531\u56fe\u8868\u6570\u636e\u70b9\u4e0b\u94bb\u67e5\u51fa\u4ee5\u4e0b\u5185\u5bb9"),"screening"===x&&b&&b.length?d.createElement(on,{unreducedFilter:b}):null,D&&D.length?d.createElement(cn,{extraParameter:D}):null,P&&d.createElement("p",{className:"msg_hotWords_tip"},"\u4e0b\u94bb\u81ea \u3010\u70ed\u8bcd\u3011\uff1a ",P),n&&d.createElement("div",{className:"msg_list_wrap "+(S||!S&&null!==S&&location&&location.search&&!b?"with_tip":"")},d.createElement(Xe,(0,r.Z)({},this.props,{onMessageDownload:g,onInboxClick:h,messageName:function(e){return d.createElement(ln,e)}}))),n&&d.createElement("div",{className:"msg_detail_wrap "+(S||!S&&null!==S&&location&&location.search&&!b?"with_tip":"")},d.createElement(sn,{data:p,modelType:E,isEmpty:0===y,highLightWordList:k,hightLightTagsList:_,handleTagsClick:T,harmonyEvent:I,serviceCustomerType:L,inboxIndex:M,showMessage:R,messageList:this.props.messageList})),!n&&d.createElement(o.Z,null))):d.createElement("div",{className:"inbox_wrap"},t&&"SERVICE"===C?d.createElement(Wn,{onChange:m,type:"all",value:a,onFilterReady:s}):t&&d.createElement(i.Z,{values:a,model:"INBOX",showList:["condition","time","save"],filterCondition:{filter:V,filterConfig:["EMOTION","ESCORE","WEIBA","CHAOHUA","TOPICS","MULTI_KEY_WORD","USEFUL_DATA","BUSINESS_TYPE"],messageRelationConfig:{unshow:C?["messageCategory"]:[]}},onFilterReady:s,onChange:m,saveFilterListShow:c.V.messageFilterListSave,useHourSelect:!0}),S&&d.createElement("div",{className:"msg_filter_tip"},d.createElement("i",{className:"icon-cem_warning"}),"\u4f9d\u636e\u300c",S,"\u300d\u67e5\u770b\u539f\u6587\u529f\u80fd\u67e5\u8be2\u51fa\u4ee5\u4e0b\u5185\u5bb9"),n&&d.createElement("div",{className:"msg_list_wrap del_old_msg "+(S?"with_tip":"")},d.createElement(Xe,(0,r.Z)({},this.props,{onMessageDownload:g,onServiceMessageDownload:f,onInboxClick:h,messageName:function(e){return d.createElement(ln,e)}}))),n&&d.createElement("div",{className:"msg_detail_wrap del_old_msg "+(S?"with_tip":"")},d.createElement(sn,{data:p,modelType:E,isEmpty:0===y,highLightWordList:k,hightLightTagsList:_,handleTagsClick:T,harmonyEvent:I,serviceCustomerType:L,filterValue:a,inboxIndex:M,showMessage:R,messageList:this.props.messageList})),!n&&d.createElement(o.Z,null))},t}(d.Component);const Un=Bn;var Hn=n(90549),jn=["queryParamsId"],Jn=["loading"],zn=ne.Z.inbox,qn=ne.Z.IDBHeaderScreening.screening,Gn=ne.Z.IDBHeaderScreening.headerScreening,Yn=ne.Z.public.menu,Kn=function(e){function t(t){var n;(n=e.call(this,t)||this).resetParams=function(e){if(e.filterModel.project=[e.projectId],e.dateFilter&&(e.dateFilter.quickChoice=e.dateFilter.currSelector&&1===e.dateFilter.currSelector&&e.dateFilter.quickChoice.indexOf("-")>-1?e.dateFilter.quickChoice:e.dateFilter.from.replaceAll("-",".")+" - "+e.dateFilter.to.replaceAll("-",".")),e.projectId){var t=c.t.get(c.V.project).filter((function(t){return t.id===e.projectId}))[0];c.t.set(c.V.curProject,t)}return delete e.projectId,e},n._handelFilterReady=function(e){var t=n.state.outsideFilter,a=n.props.curScreeningMap,s=[];if(t){if(t&&t.filterValues&&t.filterValues.length&&t.filterValues.forEach((function(e){a.find((function(t){return t.id===e.id}))?a.filter((function(t){return t.id===e.id})).forEach((function(t){e.values.forEach((function(n){if(t.data.find((function(e){return e.id===n.id}))){var a=t.data.find((function(e){return e.id===n.id})).options;n.values.forEach((function(t){(t.label?a.find((function(e){return e.label===t.label})):a.find((function(e){return e.label===t})))||s.push.apply(s,e.values)}))}else s.push.apply(s,e.values)}))})):s.push.apply(s,e.values)})),t&&t.topic1Names&&t.topic1Names.length||t&&t.topic2Names&&t.topic2Names.length){var i=t.topic1Names,l=t.topic2Names;i&&s.push({id:"\u8bdd\u9898\u5206\u7c7b",label:"\u8bdd\u9898\u5206\u7c7b",values:i}),l&&s.push({id:"\u8bdd\u9898",label:"\u8bdd\u9898",values:l})}if(t&&t.extraParameter&&t.extraParameter.length){var o=t.extraParameter;n.setState({extraParameter:o})}n.setState({unreducedFilter:s.map((function(e){return{id:e.id,label:e.label,values:e.values instanceof Array&&e.values.some((function(e){return e.label}))?e.values.map((function(e){return e.label})):e.values}}))},(function(){if(n.state.unreducedFilter&&n.state.unreducedFilter.length&&t&&t.headerFilterParamsNew&&t.headerFilterParamsNew.length){var e=JSON.parse(JSON.stringify(t.headerFilterParamsNew)).filter((function(e){return a.map((function(e){return e.id})).indexOf(e.id)>-1}));e.length&&(e=e.map((function(e){return(0,r.Z)({},e,{values:e.values.filter((function(t){return a.find((function(t){return t.id===e.id})).data.map((function(e){return e.id})).indexOf(t.id)>-1}))})}))).length&&n.setState({reducedFilter:e.map((function(e){return(0,r.Z)({},e,{values:e.values.map((function(t){return(0,r.Z)({},t,{values:t.values.filter((function(n){return a.find((function(t){return t.id===e.id})).data.find((function(e){return e.id===t.id})).options.map((function(e){return null==e?void 0:e.id})).indexOf(null!=n&&n.id?n.id:n)>-1}))})}))})}))})}}))}n.props.filterReady({filterValue:n.state.outsideFilter?n.state.outsideFilter:e,messageType:n.props.messageType,model:n.props.model,smartFolderId:n.props.folderId})},n._handelFilterChange=function(e){n.props.filterChange({filterValue:e})},n._handelSortTypeChange=function(e){n.props.sortTypeChange({value:e})},n._handelMessageDownload=function(e){return n.props.downloadMessage(e)},n._handleServiceMessageDownload=function(e){return n.props.downloadServiceMessage(e)},n._handelInboxClick=function(e,t,a){n.setState({inboxIndex:t,showMessage:a});var r=n.props,s=r.inboxClick,i=r.MODEL,l=r.fetchPersonalCount;s(e),("PERSONAL"===i||"FOLDER"===i)&&0===e.status&&l()},n._harmonyEvent=function(e,t,a){var r=n.props,s=r.hightLightTagsList,i=r.highLightWordList,l=!(null==a||!a.head)&&a,o=a&&!l&&s&&s.length>0?s:i;Array.isArray(o)&&t&&t.length>0&&(o=o.concat(t.filter((function(e){return"string"===typeof e}))));var c=e&&e.replace(/ on.*?=/g," harmony=");return l&&(null==t?void 0:t.length)>0&&(c=(0,u.mm)(c,t,l)),c&&o&&o.forEach((function(e){var t=e.includes("*")?e.replaceAll("*",""):e,n=new RegExp(t,"ig");"pre"!==e&&(c=c.replace(n,(function(e){return"<pre>"+e+"</pre>"})))})),l?c:c=c.replace(/!\[\]\((.*)\)/g,(function(e,t){return'<img src="'+t+'" />'}))},n._handleTagsClick=function(e,t){n.props.getHightLightTags({tagId:e,tag:t})};var s,i={};if(["/inbox/public","/inbox/service","/inbox/commont","/inbox/questionnaire","/inbox/app","/inbox/ticket","/inbox/self"].some((function(e){return-1!==location.href.indexOf(e)}))&&location.search){var l=JSON.parse(decodeURIComponent(location.search.substring(1)));l.queryParamsId?Hn.Z.get(Hn.Z.store.queryParams,l.queryParamsId).then((function(e){var t=e[0]||{},r=(t.queryParamsId,(0,a.Z)(t,jn)),s=n.resetParams(r);n.setState({outsideFilter:s}),n.props.saveStorageFilterValue(s)})):s=i=n.resetParams(l)}else-1!==location.href.indexOf("/inbox/public")||-1!==location.href.indexOf("/inbox/service")?i=c.t.getWidthProject(c.V.messageFilterValue,"session")||{}:void 0===t.model&&(i.filterModel={},i.filterModel.messageCategory=[t.messageType]);return n.state={outsideFilter:s,unreducedFilter:null,reducedFilter:null,extraParameter:null,inboxIndex:0,contactId:"",showMessage:{}},setTimeout((function(){t.saveStorageFilterValue(i)}),0),n._event={onFilterReady:n._handelFilterReady,onFilterChange:n._handelFilterChange,onSortTypeChange:n._handelSortTypeChange,onMessageDownload:n._handelMessageDownload,onServiceMessageDownload:n._handleServiceMessageDownload,onInboxClick:n._handelInboxClick,handleTagsClick:n._handleTagsClick,harmonyEvent:n._harmonyEvent},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e,t){var n=e.screeningValues,a=this.props,s=a.screeningValues,i=a.curScreeningMap;if(JSON.stringify(n)!==JSON.stringify(s))if(this.state.unreducedFilter&&this.state.unreducedFilter.length&&(s.length&&X.Z.error("\u4e0d\u652f\u6301\u5305\u542b\u672a\u8fd8\u539f\u7684\u7b5b\u9009\u6761\u4ef6\u67e5\u8be2"),this.setState({unreducedFilter:null})),this.state.extraParameter&&this.state.extraParameter.length&&(s.length&&X.Z.error("\u4e0d\u652f\u6301\u5305\u542b\u672a\u8fd8\u539f\u7684\u7b5b\u9009\u6761\u4ef6\u67e5\u8be2"),this.setState({extraParameter:null})),s&&s.length){if(!n){var l=s.filter((function(e){return i.map((function(e){return e.id})).indexOf(e.id)>-1}));l.length&&(l=l.map((function(e){return(0,r.Z)({},e,{values:e.values.filter((function(t){return"CUSTOMER_NAME"===t.id?t:i.find((function(t){return t.id===e.id})).data.map((function(e){return e.id})).indexOf(t.id)>-1}))})}))).length&&this.setState({reducedFilter:l.map((function(e){return(0,r.Z)({},e,{values:e.values.map((function(t){return(0,r.Z)({},t,{values:"CONTENT_BUSINESS_MSG_LENGTH"===t.id||"CONTENT_BUSINESS_START_NUM"===t.id||"COMMENT_LENGTH"===t.id||"CUSTOMER_NAME"===t.id?t.values:t.values.filter((function(n){return i.find((function(t){return t.id===e.id})).data.find((function(e){return e.id===t.id})).options.map((function(e){return null==e?void 0:e.id})).indexOf(null!=n&&n.id?n.id:n)>-1}))})}))})}))})}}else this.state.reducedFilter&&this.setState({reducedFilter:null})},n.componentWillUnmount=function(){this.props.clearData()},n.render=function(){return d.createElement(Un,(0,r.Z)({},this.state,this.props,this._event))},t}(d.Component);const Qn=(0,w.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,Jn);return(0,r.Z)({},n[zn],{messageListFetching:t.effects[zn+"/fetchMessageList"]||!1,curScreeningMap:n[qn].curScreeningMap,screeningValues:n[qn].screeningValues,showKind:n[Gn].showKind})}),(function(e){return{filterReady:function(t){return e({type:zn+"/filterReady",payload:t})},filterChange:function(t){return e({type:zn+"/filterChange",payload:t})},sortTypeChange:function(t){return e({type:zn+"/sortTypeChange",payload:t})},fetchMessageList:function(t){return e({type:zn+"/fetchMessageList",payload:t})},downloadMessage:function(t){return e({type:zn+"/downloadMessage",payload:t})},downloadServiceMessage:function(t){return e({type:zn+"/downloadServiceMessage",payload:t})},inboxClick:function(t){return e({type:zn+"/inboxClick",payload:t})},saveStorageFilterValue:function(t){return e({type:zn+"/saveStorageFilterValue",payload:t})},clearData:function(){return e({type:zn+"/clearData"})},fetchPersonalCount:function(){return e({type:Yn+"/fetchPersonalCount"})},getHightLightTags:function(t){return e({type:zn+"/getHightLightTags",payload:t})}}}))(Kn)},98482:(e,t,n)=>{n.d(t,{Z:()=>C});var a=n(87462),r=n(94578),s=n(5133),i=n(35239),l=n(67294),o=(n(53294),n(56697)),c=(n(89858),n(51024)),d=(n(54277),n(74048)),u=(n(1025),n(65400)),m=(n(69909),n(17669)),p=(n(15144),n(2307)),h=(n(54038),n(36671)),g=n(61409),f=n(61193);const v=function(e){var t=e.list,n=e.listLoading,r=e.isRelated,s=e.selectedRowKeys,i=e.onStateChange,o={PENDING:"#BFBFBF",PROCESSING:"#0090FF",FINISHED:"#27CDA1"},c=[{title:"\u7f16\u53f7",key:"code",width:"12%",render:function(e){return l.createElement("span",null,e.code)}},{title:"\u6807\u9898",key:"title",ellipsis:!0,render:function(e){return l.createElement("span",null,l.createElement(g.rU,{to:"/workOrderDetail?workOrderId="+e.workOrderId+(f.Z.hasAuthority("EDIT_WORK_ORDER")||e.assigneeId===f.Z.getUser().userId||e.creatorId===f.Z.getUser().userId?"":"&view=true")+(e.hasDeleted?"&hasDeleted="+e.hasDeleted:"")+(f.Z.hasAuthority("EDIT_WORK_ORDER")||e.assigneeId!==f.Z.getUser().userId||e.creatorId===f.Z.getUser().userId?"":"&normalAssignee=true"),target:"_blank"},e.title))}},{title:"\u72b6\u6001",key:"stateName",width:200,render:function(e,t){return l.createElement(l.Fragment,null,l.createElement("span",{className:"status_point",style:{backgroundColor:o[t.statusKind],marginRight:"8px"}}),l.createElement("span",null,t.stateName))}}].concat("related"===r?[{title:"\u64cd\u4f5c",key:"action",width:120,render:function(e){return l.createElement(d.default,{size:"middle"},l.createElement("a",{onClick:function(){return i("remove",e)}},"\u53d6\u6d88\u5173\u8054"))}}]:[]),u={rowSelection:{selectedRowKeys:s,onChange:function(e){return i("selected",e)},fixed:!0}};return l.createElement(p.Z,(0,a.Z)({columns:c,dataSource:t.map((function(e){return e.key=e.workOrderId,e})),scroll:{y:"calc(100vh - 385px)"},pagination:!1,loading:n},"related"===r?{locale:{emptyText:l.createElement(h.default,{image:h.default.PRESENTED_IMAGE_SIMPLE,description:"\u6682\u65e0\u5173\u8054\u7684\u5de5\u5355"})}}:u))};m.Z.Option;const E=function(e){var t=e.id,n=e.visible,a=e.setVisible,r=e.hideRelateBtn,s=e.list,i=e.relationKind,m=e.listLoading,p=e.onStateChange,h=(0,l.useState)("related"),g=h[0],f=h[1],E=(0,l.useState)(""),y=E[0],C=E[1],S=(0,l.useState)([]),N=S[0],w=S[1],k=function(e,n,a){if("selected"!==e){var r="remove"===e?{id:t,kind:i,workOrderId:n.workOrderId}:n;p(e,r,a)}else w(n)},_=function(e){f(e),p("isRelated","related"===e)};return l.createElement(o.Z,{title:"\u5173\u8054\u5de5\u5355",visible:n,wrapClassName:"relation-modal "+g+" "+(s.length<1?"no-data":""),width:960,centered:!0,destroyOnClose:!0,closeIcon:l.createElement("i",{className:"icon-cem_cancel"}),footer:r?l.createElement(d.default,null):"related"===g?l.createElement("div",{className:"existingBtn"},l.createElement(u.default,{type:"primary",onClick:function(){return _("unRelated")}},"\u5173\u8054\u5df2\u6709\u5de5\u5355")):l.createElement(d.default,null,l.createElement(u.default,{onClick:function(){return _("related")}},"\u53d6\u6d88"),l.createElement(u.default,{type:"primary",onClick:function(){N.length>0&&k("addRelated",N,(function(){return _("related")}))}},"\u5173\u8054")),afterClose:function(){f("related"),C(""),w([])},onCancel:function(){return a(!1)},onOk:function(){a(!1)}},"related"!==g&&l.createElement(l.Fragment,null,l.createElement(c.default,{allowClear:!0,style:{width:"100%"},placeholder:"\u8bf7\u641c\u7d22\u5de5\u5355\u7f16\u53f7\u6216\u5de5\u5355\u6807\u9898\u6765\u5173\u8054",onChange:function(e){e.target.value||(C(e.target.value),p("search-keyword",e.target.value))},onPressEnter:function(e){var t=e.target.value;C(t),p("search-keyword",t)}}),!y&&l.createElement("p",null,"\u6700\u8fd1\u64cd\u4f5c")),l.createElement(v,{list:s,listLoading:m,isRelated:g,selectedRowKeys:N,onStateChange:k}))};var y=n(12021);const C=function(e){function t(t){var n;return(n=e.call(this,t)||this).state=void 0,n.events=void 0,n._handleStateChange=function(e,t,r){var i=n.props.onStateChange;switch(e){case"remove":(0,y.VG)((0,a.Z)({},t,{projectId:n.state.projectId})).then((function(e){2e4===e.data.code&&(s.Z.success("\u53d6\u6d88\u5173\u8054\u6210\u529f"),n._handleFetchList(),i&&i("remove-relate"))}));break;case"isRelated":n._handleFetchList(t);break;case"addRelated":n._handleAddReleted(t,r);break;case"search":case"search-keyword":n._handleFetchList(!1,t)}},n._handleFetchList=function(e,t){void 0===e&&(e=!0),void 0===t&&(t="");var r=n.props,s=r.id,i=r.relationKind,l=n.state,o=l.projectId,c=l.pageIndex,d=l.pageSize;n.setState({listLoading:!0});var u={searchList:[]};s&&(0,y.qH)({id:s,projectId:o,relationKind:i,keyword:t,pageIndex:c,pageSize:d,isRelated:e}).then((function(e){return e.data.result.list&&n.setState((0,a.Z)({list:e.data.result.list,listLoading:!1},t?{}:u))})).catch((function(e){return console.error(e)}))},n._handleAddReleted=function(e,t){return n.props.relatedAdd(e,t)},n.state={projectId:i.t.get(i.V.curProject).id,list:[],searchList:[],keyword:"",pageIndex:0,pageSize:10,listLoading:!1},n.events={onStateChange:n._handleStateChange},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=this.props,n=t.visible,a=t.addedCount,r=t.id;!n||e.visible===n&&e.id===r||this._handleFetchList("string"!==typeof a)},n.render=function(){return l.createElement(E,(0,a.Z)({},this.props,this.state,this.events))},t}(l.Component)},12021:(e,t,n)=>{n.d(t,{qH:()=>r,Im:()=>s,VG:()=>i});var a=n(49722);function r(e){var t=e.id,n=e.projectId,r=e.relationKind,s=e.keyword,i=e.pageIndex,l=e.pageSize,o=e.isRelated;return a.h.get("/workorder/work-order/"+(o?"relation":"unRelation")+"/list",{params:{id:t,projectId:n,relationKind:r,keyword:s,pageIndex:i,pageSize:l}})}function s(e){var t=e.id,n=e.projectId,r=e.kind,s=e.workOrderIdList,i=e.workOrderParam;return a.h.post("/workorder/work-order/relation/add",{id:t,projectId:n,kind:r,workOrderIdList:s,workOrderParam:i})}function i(e){var t=e.id,n=e.kind,r=e.workOrderId,s=e.projectId;return a.h.delete("/workorder/work-order/relation/remove?projectId="+s+"&id="+t+"&kind="+n+"&workOrderId="+r)}},24473:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(87462),r=n(63366),s=n(94578),i=n(67294),l=n(45697),o=n.n(l),c=n(94184),d=n.n(c),u=["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"],m=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){var e,t=this.props,n=t.prefixCls,s=t.children,l=t.className,o=t.block,c=t.indeterminate,m=t.value,p=t.checked,h=t.defaultChecked,g=t.onChange,f=t.disabled,v=(0,r.Z)(t,u),E={value:m,checked:p,defaultChecked:h,onChange:g,disabled:f},y=d()(n,((e={})[n+"-disabled"]=E.disabled,e[n+"-block"]=o,e[n+"-indeterminate"]=c,e),l);return i.createElement("label",(0,a.Z)({tabIndex:E.disabled?-1:0,className:y},v),i.createElement("input",(0,a.Z)({type:"checkbox",className:n+"-input"},E)),i.createElement("span",{className:n+"-status"}),s&&i.createElement("span",{className:n+"-text",title:s},s))},t}(i.Component);m.propTypes={prefixCls:o().string,value:o().oneOfType([o().string,o().number]),checked:o().bool,defaultChecked:o().bool,onChange:o().func,indeterminate:o().bool,disabled:o().bool,block:o().bool},m.defaultProps={prefixCls:"wt-checkbox"};const p=m},85151:(e,t,n)=>{n.d(t,{Jg:()=>a.Z,CS:()=>h});var a=n(24473),r=n(87462),s=n(63366),i=n(94578),l=n(67294),o=n(45697),c=n.n(o),d=n(94184),u=n.n(d),m=["prefixCls","children","className","onChange","values","checkedList","block"],p=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this).handleCheckBoxChange=function(e){var n=t.props.onChange;n&&n(e)},t}return(0,i.Z)(t,e),t.prototype.render=function(){var e,t=this,n=this.props,a=n.prefixCls,i=n.children,o=n.className,c=(n.onChange,n.values),d=n.checkedList,p=n.block,h=(0,s.Z)(n,m);return e=c?c.map((function(e,n){var a=0!==d.length&&-1!==d.indexOf(e);return l.createElement(Checkbox,{key:n,value:e,checked:a,onChange:function(e){return t.handleCheckBoxChange(e)},block:p},e)})):l.Children.map(i,(function(e,n){if(e){var a=e.props,r=a.value,s=0!==d.length&&-1!==d.indexOf(r);return l.cloneElement(e,{checked:s,key:n,block:a.block||p,onChange:function(){var e=a.value;t.handleCheckBoxChange(e)}})}})),l.createElement("div",(0,r.Z)({className:u()(a,o)},h),e)},t}(l.Component);p.defaultProps={prefixCls:"wt-checkbox-group"},p.propTypes={onChange:c().func,values:c().array,block:c().bool};const h=p;var g=function(e){var t={};return Object.keys(e).forEach((function(n){/^data\-.+$/.test(n)&&(t[n]=e[n])})),t},f=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this.props,t=g(e);return l.createElement("label",{className:e.className,title:e.children},l.createElement("div",{className:"checkbox"},l.createElement("input",(0,r.Z)({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),l.createElement("div",{className:"checkbox-body"})),"\xa0",l.createElement("span",null,e.children))},t}(l.Component);f.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},12234:(e,t,n)=>{n.d(t,{l:()=>d});var a=n(87462),r=n(63366),s=n(94578),i=n(67294),l=n(94184),o=n.n(l),c=["className","name"],d=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.name,s=(0,r.Z)(e,c),l=o()("icon",["cem-"+n],t);return i.createElement("svg",(0,a.Z)({className:l},s),i.createElement("use",{xlinkHref:"#icon-cem-"+n}))},t}(i.Component)},66746:(e,t,n)=>{n.d(t,{Z:()=>u});n(16049);var a=n(1825),r=(n(89858),n(51024)),s=(n(7940),n(31059)),i=(n(1025),n(65400)),l=(n(75314),n(11187)),o=n(94578),c=n(67294),d=n(87219);const u=function(e){function t(t){var n;return(n=e.call(this,t)||this).show=function(e){var t=e.aspectList,a=e.isAspect,r=e.callback;n.setState({visible:!0,aspectList:t,isAspect:a}),n.callback=r},n._handleOnClose=function(){n.setState({visible:!1,aspectList:void 0,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:"",isAspect:!1},(function(){n.callback=void 0}))},n._handleOnConfigConfirm=function(){var e=n.state,t=e.moreChecked,a=e.moreContent,r=e.errorChecked,s=e.errorContent,i=e.lessChecked,l=e.lessContent,o=e.isAspect,c=[],d=o?"FOCUS_TOO_MANY":"ASPECT_TOO_MANY",u=o?"FOCUS_NOT_ENOUGH":"ASPECT_NOT_ENOUGH";t&&a.length?c.push({feedbackType:d,feedbackContent:o?JSON.stringify(a):JSON.stringify(a.filter((function(e){return e.escore})))}):c.filter((function(e){return e.feedbackType!==d})),r&&s.length?c.push({feedbackType:"EMOTION_WRONG",feedbackContent:o?JSON.stringify(a):JSON.stringify(s.filter((function(e){return e.escore})))}):c.filter((function(e){return"EMOTION_WRONG"!==e.feedbackType})),i?c.push({feedbackType:u,feedbackContent:l}):c.filter((function(e){return e.feedbackType!==u})),n.callback&&n.callback(c),n._handleOnClose()},n._handleOnChange=function(e,t){var a,r;(n.setState(((a={})[t+"Checked"]=e,a)),t.includes("more")&&!e||t.includes("error")&&!e)&&(n.state[t+"Content"]&&n.state[t+"Content"].length&&n.setState(((r={})[t+"Content"]=[],r)))},n._handleOnInputChange=function(e){1e3===e.target.value.trim().length&&n.setState({lessTips:"\u6700\u591a\u8f93\u51651000\u5b57"}),n.setState({lessContent:e.target.value.trim().substring(0,1e3)})},n._handleOnClickAspect=function(e,t,a){var r,s=n.state,i=s.moreContent,o=s.errorContent,c="more"===a?i:o,u=(0,d.ZP)(c,(function(n){if(c.find((function(n){return JSON.stringify(n)===JSON.stringify({aspect:e,escore:t})})))return 1===c.length&&l.default.warning("\u81f3\u5c11\u4fdd\u7559\u4e00\u4e2a\u6307\u6807\u9009\u9879"),n.filter((function(n){return JSON.stringify(n)!==JSON.stringify({aspect:e,escore:t})}));n.push({aspect:e,escore:t})}));n.setState(((r={})[a+"Content"]=u,r))},n.callback=void 0,n.state={visible:!1,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:"",aspectList:void 0,isAspect:!1},n}return(0,o.Z)(t,e),t.prototype.render=function(){var e=this,t=this.state,n=t.visible,l=t.moreChecked,o=t.moreContent,d=t.errorChecked,u=t.errorContent,m=t.lessChecked,p=t.aspectList,h=t.lessContent,g=t.lessTips,f=t.isAspect;return c.createElement(a.Z,{title:"\u6211\u8981\u53cd\u9988",placement:"right",width:372,onClose:this._handleOnClose,visible:n,footer:c.createElement("div",{style:{float:"right"}},c.createElement(i.default,{onClick:this._handleOnClose},"\u53d6\u6d88"),c.createElement(i.default,{disabled:l&&d&&!m&&!o.length&&!u.length||l&&!d&&!m&&!o.length||d&&!l&&!m&&!u.length||!l&&!d&&!m,type:"primary",onClick:this._handleOnConfigConfirm},"\u786e\u5b9a"))},c.createElement("div",{className:"yt_aspect_feedback_drawer"},p&&p.length?c.createElement("div",{className:"item"},c.createElement(s.default,{checked:l,onChange:function(t){return e._handleOnChange(t.target.checked,"more")}},"\u591a\u4e86",f?"\u5173\u6ce8\u70b9":"\u6307\u6807"),c.createElement("div",{className:"feedback_content"},l&&p.map((function(t,n){return c.createElement("span",{key:n,className:8===t.escore?"positive":"negative",onClick:function(){return e._handleOnClickAspect(t.aspect2,t.escore,"more")}},c.createElement("i",{className:"icon-cem_big-gou",style:{display:o.find((function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})}))?"inline":"none"}}),t.aspect2)})))):null,!f&&p&&p.length?c.createElement("div",{className:"item"},c.createElement(s.default,{checked:d,onChange:function(t){return e._handleOnChange(t.target.checked,"error")}},"\u60c5\u611f\u6709\u8bef"),c.createElement("div",{className:"feedback_content"},d&&p.map((function(t,n){return c.createElement("span",{key:n,className:8===t.escore?"positive":"negative",onClick:function(){return e._handleOnClickAspect(t.aspect2,t.escore,"error")}},c.createElement("i",{className:"icon-cem_big-gou",style:{display:u.find((function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})}))?"inline":"none"}}),t.aspect2)})))):null,c.createElement(s.default,{checked:m,onChange:function(t){return e._handleOnChange(t.target.checked,"less")}},"\u5c11\u4e86",f?"\u5173\u6ce8\u70b9":"\u6307\u6807"),m&&c.createElement("div",{className:"item"},c.createElement("p",null,f?"\u5bf9\u5e94\u7684\u6587\u672c\u53ca\u8bf4\u660e":"\u5bf9\u5e94\u7684\u6587\u672c\u6216\u7f3a\u5931\u6307\u6807\u8bf4\u660e"),c.createElement(r.default.TextArea,{className:g?"border_err":"",autoSize:{minRows:3,maxRows:13},placeholder:"\u8bf7\u8f93\u5165",onFocus:function(t){g&&e.setState({lessTips:""})},onBlur:function(t){g&&e.setState({lessTips:""})},maxLength:1e3,value:h,onChange:this._handleOnInputChange}),g&&c.createElement("div",{className:"tips"},g))))},t}(c.PureComponent)},21554:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(94578),r=n(67294),s=n(45697),i=n.n(s),l=n(92360),o=n(66982),c=n.n(o),d=function(e){function t(t){return e.call(this,t)||this}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.render=function(){var e=this.props,t=e.images,n=e.isShow,a=e.startIndex,s=e.closeDialog;return r.createElement(l.Dialog,{visible:n,className:"imgpreview-dialog",onCancel:s,lockScroll:!1},r.createElement(l.Dialog.Body,null,r.createElement(c(),{items:t,startIndex:a})))},t}(r.Component);d.propTypes={images:i().array.isRequired,isShow:i().bool.isRequired,closeDialog:i().func.isRequired,startIndex:i().number.isRequired}},84122:(e,t,n)=>{n.d(t,{Ln:()=>c,YG:()=>d,Pl:()=>u,VG:()=>m,Rr:()=>p});var a=n(87462),r=n(67294),s=n(92360),i=n(5133);function l(e){s.MessageBox.confirm(r.createElement("span",null,"\u8bf7\u5148\u4e0b\u8f7d\u4e91\u542c\u63d2\u4ef6\u5e76\u5b89\u88c5\uff0c\u518d\u8fdb\u884c\u64cd\u4f5c!",r.createElement("br",null),"\u4e0b\u8f7d\u540e\u5237\u65b0\u6b64\u9875\uff0c",r.createElement("a",{href:e,target:"_black",style:{color:"#0747a6",textDecoration:"underline"}},"\u70b9\u8fd9\u53bb\u4e0b\u8f7d"),"\uff08",r.createElement("a",{href:"http://wiki.yuntingai.com/x/lgAB",target:"_black",style:{color:"#0747a6",textDecoration:"underline"}},"\u5b89\u88c5\u8bf4\u660e"),"\uff09",r.createElement("br",null)),"\u63d0\u793a",{type:"warning",confirmButtonText:"\u5df2\u5b8c\u6210\u4e0b\u8f7d"}).then((function(){window.location.reload()}))}function o(e,t,n,a){!function l(){s.MessageBox.confirm(r.createElement("span",null,"\u8bf7\u767b\u5f55",t,"\u5e73\u53f0\uff0c\u518d\u8fdb\u884c\u56de\u590d!",r.createElement("br",null),r.createElement("a",{href:n,target:"_black",style:{color:"#0747a6",textDecoration:"underline"}},"\u70b9\u8fd9\u53bb\u767b\u5f55")),"\u63d0\u793a",{type:"warning",confirmButtonText:"\u5df2\u5b8c\u6210\u767b\u5f55"}).then((function(t){e[a]().then((function(e){e.status||(l(),i.Z.warning("\u672a\u68c0\u6d4b\u5230\u767b\u5f55\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002"))}))}))}()}var c=function(e){new Promise((function(e,t){try{e(new YUNTING_OP_LOGIN)}catch(n){t(n)}})).then((function(t){e&&e(t)})).catch((function(e){l("https://yunting-1251101074.coscd.myqcloud.com/plugin/yunting-store.zip")}))},d=function(e){new Promise((function(e,t){try{e(new YUNTINGPLUGIN)}catch(n){t(n)}})).then((function(t){e&&e(t)})).catch((function(e){l("https://yunting-1251101074.file.myqcloud.com/plugin/yunting.zip")}))},u=function(e,t,n,r){return e.weibo.check().then((function(s){return s.status?e.weibo.reply(t.url,n).then((function(e){return e.status?r((0,a.Z)({},e,{content:n,id:t.id,uid:t.uid})):i.Z.error(e.msg||"\u56de\u590d\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458")})):o(e,"\u5fae\u535a","https://passport.weibo.cn/signin/login?entry=mweibo&yuntinglogin","weiboCheckLogin")}))},m=function(e,t,n,r){return e.tieba.check().then((function(s){return s.status?e.tieba.reply(t.group,n).then((function(e){return e.status?r((0,a.Z)({},e,{id:t.id,content:n})):i.Z.error(e.msg||"\u56de\u590d\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458")})):o(e,"\u767e\u5ea6\u8d34\u5427","https://passport.baidu.com/v2/?login&yuntinglogin","tiebaCheckLogin")}))},p=function(e,t,n,r){return e.zhihu.check().then((function(s){return s.status?e.zhihu.reply(t.zhihuId,n).then((function(e){return e.status?r((0,a.Z)({},e,{id:t.id,img:s.avatar_url,uid:s.uid,username:s.name,userDesc:s.headline,userHome:s.url,content:n})):i.Z.error(e.message||"\u56de\u590d\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458")})):o(e,"\u77e5\u4e4e","https://www.zhihu.com/signin?yuntinglogin","zhihuCheckLogin")}))}},29030:(e,t,n)=>{n.d(t,{z:()=>a});var a={"\u767e\u5ea6\u77e5\u9053":"bdzd","\u767e\u5ea6\u8d34\u5427":"bdtb","\u516b\u722a\u9c7c":"bzy","nps\u95ee\u5377":"nps","\u79d1\u6c83\u65af":"ecovacs","\u79d1\u6c83\u65af\u5b98\u7f51":"ecovacs","\u79d1\u6c83\u65af\u5546\u57ce":"ecovacs","\u56fd\u7f8e":"gm","\u4eac\u4e1c":"jd","\u82cf\u5b81\u6613\u8d2d":"snyg","\u82cf\u5b81":"snyg","\u5929\u732b":"tm","\u6dd8\u5b9d":"tb","\u552f\u54c1\u4f1a":"wph","\u5fae\u4fe1":"wx","\u516c\u4f17\u53f7":"wx","\u5fae\u4fe1\u516c\u4f17\u53f7":"wx","\u65b0\u6d6a":"xl","\u65b0\u6d6a\u5fae\u535a":"xl","\u5fae\u535a":"xl","\u65b0\u6d6a\u65b0\u95fb":"xlxw","\u5c0f\u7c73\u5546\u57ce":"xm","\u5c0f\u7c73\u793e\u533a":"xm_bbs","\u4e9a\u9a6c\u900a":"ymx","\u7c73\u5bb6\u6709\u54c1":"yp","\u77e5\u4e4e":"zh","\u767e\u5ea6":"bd","VIVO\u5b98\u7f51":"vivo","\u6d77\u4fe1":"haixin","1\u53f7\u5e97":"yhd","\u521b\u7ef4":"chuangwei","\u6b22\u592a\u5546\u57ce":"htsc","\u81ea\u5b9a\u4e49":"custom","\u4e91\u542cCEM":"nps","\u82b1\u7c89\u4ff1\u4e50\u90e8":"huawei","vivo\u793e\u533a":"vivo_bbs","coloros\u793e\u533a":"coloros_bbs","\u9152\u4ed9":"jx","\u4e00\u70b9\u8d44\u8baf":"yd","\u5c0f\u7ea2\u4e66":"xhs","\u4ec0\u4e48\u503c\u5f97\u4e70":"smzdm",bilibili:"bilibili","\u4eca\u65e5\u5934\u6761":"jrtt","\u7f51\u6613\u65b0\u95fb":"wyxw","\u767e\u5ea6\u65b0\u95fb":"bdxw","\u817e\u8baf\u65b0\u95fb":"txxw","\u6296\u97f3":"dy","\u65b0\u95fb":"xw","\u805a\u6295\u8bc9":"jts","\u9ed1\u732b\u6295\u8bc9":"hmts","\u62fc\u591a\u591a":"pdd","OPPO\u793e\u533a":"opposq","\u5927\u4f17\u70b9\u8bc4":"dzdp","\u5fae\u535a\u8bc4\u8bba":"xl","\u6296\u97f3\u5c0f\u5e97":"douyin","\u4e9a\u9a6c\u900a\u56fd\u9645":"ymx","\u5feb\u624b\u5c0f\u5e97":"ks","Google Play":"ggstore","App Store(iOS)":"iosapp","App Store(Mac)":"iosapp","\u817e\u8baf\u5e94\u7528\u5b9d":"tsyyb",Zendesk:"zendesk"}},95045:(e,t,n)=>{e.exports=n.p+"img/35ee9efeb09bc0840932.png"},23072:(e,t,n)=>{e.exports=n.p+"img/4eaaf9cf4c999dbabe06.png"},49845:(e,t,n)=>{e.exports=n.p+"img/efa6ed59795721e67957.png"},43134:(e,t,n)=>{e.exports=n.p+"img/c6a1e87945c5211f102e.png"},86073:(e,t,n)=>{e.exports=n.p+"img/3ad291b220504e21f139.png"}}]);