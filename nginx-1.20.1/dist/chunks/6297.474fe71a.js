(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6297],{46297:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});function s(e,t,n){return f().createElement("div",{className:"message-rule-content-overlay-wrapper"},f().createElement("div",{className:"content-overlay-title"},e),n.map(function(e){return f().createElement("div",{className:"content-overlay-item",key:e},f().createElement("span",{className:"content-overlay-item-type"},e),f().createElement("span",{className:"content-overlay-item-content"},t[e].join("，")))}),t["内容"]&&f().createElement("div",{className:"content-overlay-item"},f().createElement("span",{className:"content-overlay-item-type"},"组合规则"),f().createElement("span",{className:"content-overlay-item-content"},f().createElement("span",{className:"content-list-type"},"内容"),f().createElement("span",{className:"content-list-value"},t["内容"].map(function(e){return f().createElement("span",{key:e},e)})))))}function u(e,t,n,a){if("rule"===t)return f().createElement("div",{key:e,className:"column-item"},f().createElement("span",{className:"column-item-type"},e),f().createElement("span",{className:"column-item-content"},a));var r=(0,i.rV)(""+e+a)+12,l=n-35-36,n=l-(0,i.rV)(e)-12;return f().createElement("div",{key:e,className:"column-item-single"},f().createElement("span",{className:"column-item-type"},e),f().createElement("span",{style:{display:"inline-flex"}},f().createElement("span",{className:"column-item-content",style:{maxWidth:n}},a),l<r&&f().createElement(p.Z,{overlay:"recipient"===t?(r=e,t=a,f().createElement("div",{className:"message-rule-content-overlay-wrapper"},f().createElement("div",{className:"content-overlay-title"},r),f().createElement("div",null,t))):(e=e,a=a,f().createElement("div",{className:"message-rule-content-overlay-wrapper"},f().createElement("span",{style:{color:"#8c8c8c"}},"标签类型："),f().createElement("span",null,e+"， "),f().createElement("span",{style:{color:"#8c8c8c"}},"标签："),f().createElement("span",null,a))),placement:"top"},f().createElement("span",{className:"content-item-detail"},"详情"))))}var a=n(37316),r=n.n(a),l=n(67154),h=n.n(l),t=n(85354),o=n.n(t),a=n(67294),f=n.n(a),l=n(55609),d=n(55815),m=n(60496),g=n(92360),p=n(43036),i=n(6233);const v=function(e){var l=e.data,o=e.propType,i=e.maxWidth,t=e.height,c=Object.keys(l).filter(function(e){return"内容"!==e}),e=["无"];return l["内容"]&&0<l["内容"].length&&JSON.stringify(e)!==JSON.stringify(l["内容"])&&(5<l["内容"].length?(e=l["内容"].slice(0,4)).push("..."):e=l["内容"]),f().createElement("div",{className:"column-type-wrapper",style:{height:t}},c.map(function(e,t,n){var a="rule"===o?3:4,r=l[e].join("，");return n.length<a||("rule"===o?0===t:t<3)?u(e,o,i,r):("rule"===o?1===t:3===t)?f().createElement("div",{key:t},f().createElement("span",{style:{color:"#8c8c8c"}},"..."),"tag"===o&&f().createElement(p.Z,{overlay:s("标签",l,c),placement:"top"},f().createElement("span",{className:"content-item-detail"},"详情"))):null}),l["内容"]&&f().createElement("div",{className:"column-item"},f().createElement("span",{className:"column-item-type item-"+o},"内容"),f().createElement("span",{className:"column-item-content"},e.map(function(e,t,n){return f().createElement("span",{className:"content-item",key:""+e+t},e)}))),"rule"===o&&f().createElement(p.Z,{overlay:s("消息处理规则",l,c),placement:"top"},f().createElement("span",{className:"content-item-detail"},"详情")))};const E=function(e){var t=e.data,a=e.maxWidth,e=e.height;return f().createElement("div",{className:"simple-column-type-wrapper",style:{height:e}},t.map(function(e){var t=(0,i.rV)(e),n=a-35-36;return f().createElement("span",{className:"column-item-single",key:e},f().createElement("span",{className:"column-item-content",style:{maxWidth:n}},e),n<t&&f().createElement(p.Z,{placement:"top",overlay:e},f().createElement("span",{className:"content-item-detail"},"详情")))}))};var y=f().createContext({contentWidth:0});const C=function(e){var t=e.data,n=t.status,a=t.history,r=t.folders,l=e.id,o=e.projectId,i=e.height,e=f().useState("Enable"===n),c=e[0],s=e[1];return f().useEffect(function(){s("Enable"===n)},[n]),f().createElement(y.Consumer,null,function(e){var t=e.onDialogOpen,n=e.onEditTriggerClick;return f().createElement("div",{className:"control-item-wrapper",style:{height:i}},f().createElement(p.Z,{overlay:c?"开启":"关闭",placement:"top"},f().createElement("span",null,f().createElement(g.Switch,{value:c,onText:"",offText:"",onColor:"#0747A6",offColor:"#8c8c8c",onChange:function(e){t({type:c?"stop":"open",projectId:o,id:l,folderName:r&&r.join("，"),history:"Enable"===a,callback:function(){}})}}))),f().createElement("span",{onClick:function(e){n({id:l})}},"编辑"),f().createElement("span",{onClick:function(){t({type:"delete",projectId:o,id:l})}},"删除"))})};t=n(45697),a=n.n(t),t=function(t){function e(e){var a=t.call(this,e)||this;return a._setPadShowFalse=function(){a.state.show&&a.setState({show:!1})},a._setEvent=function(e){return 0===e?{onMouseEnter:function(){a.setState({firstLiHover:!0})},onMouseLeave:function(){a.setState({firstLiHover:!1})}}:{}},a._handleOnClick=function(e){var t=a.state.show;t&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){a.setState({show:!t})},0)},a._handleOptionChange=function(e){var t=a.props,n=(t.options,t.onChange);a.setState({checkedArr:e},function(){return n(e.map(function(e){return e}))})},a.state={show:!1,firstLiHover:!1,checkedArr:[],isAllChecked:!1,isIndeterminate:!1},a}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},n.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},n.componentDidUpdate=function(e){var t=e.value,n=this.props,e=n.value,a=n.options;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({checkedArr:e.reduce(function(e,t){var n=a.find(function(e){return e.title===t});return n&&e.push(n.value),e},[])})},n.render=function(){var e=this.state,t=e.show,n=e.checkedArr,a=this.props,r=a.options,e=a.preTitle,a=0===r.length?"暂无数据":0===n.length?"全部":n.map(function(t){return r.find(function(e){return e.value===t}).title}).join("，");return f().createElement("div",{className:"multi-check-button-wrapper",onClick:this._handleOnClick},f().createElement("span",{className:"button-trigger "+(t?"sel":"")},f().createElement("span",{className:"pre-title"},e,":"),f().createElement("span",{className:"title"},a),f().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),f().createElement("div",{className:"button-panel "+(t?"active":"")+" "+(this.state.firstLiHover?"selPadHover":""),onClick:function(e){return e.stopPropagation()}},0<r.length?f().createElement(g.Checkbox.Group,{value:n,onChange:this._handleOptionChange},r.map(function(e,t){return f().createElement(g.Checkbox,{label:e.value,className:"panel-item",key:e.value},e.title)})):f().createElement("div",{className:"empty"},"暂无数据")))},e}(f().PureComponent);t.propTypes={value:a().array,onChange:a().func.isRequired,options:a().array.isRequired,preTitle:a().string.isRequired};const b=t;var k=[{title:"全部",value:"null"},{title:"启用",value:"Enable"},{title:"停用",value:"Disable"}];const N=function(e){var t=e.ruleDatas,n=e.projectId,a=e.projectOptions,r=e.folderOptions,l=e.onFilterChange,o=e.folderData,i=e.filterObj.status,c=e.onEditTriggerClick;return f().createElement("div",{className:"message-rule-list-wrapper"},f().createElement("div",{className:"button-top"},f().createElement("span",{className:"button-left"},f().createElement(m.Z,{activeObj:n,preTitle:"项目",objName:"projectId",onChange:l,options:a}),f().createElement(b,{options:r,preTitle:"文件夹",value:o,onChange:function(e){return l({smartFolderIdList:e})}}),f().createElement(g.Radio.Group,{value:null===i?"null":i,onChange:function(e){l("null"===e?{status:null}:{status:e})}},k.map(function(e){return f().createElement(g.Radio.Button,{key:e.title,value:e.value},e.title)}))),f().createElement("span",{className:"button-right"},f().createElement(g.Button,{type:"primary",onClick:function(e){return c({})}},"创建规则"))),f().createElement(y.Consumer,null,function(e){var a,r,e=e.contentWidth;return f().createElement(g.Table,{style:{width:"100%",zIndex:0,marginTop:10,minHeight:500},columns:[{label:"",width:16},{label:"消息处理规则",prop:"rule",width:.4*(r=e-5-24-32-96-180),render:function(e,t,n){return f().createElement(v,{height:24*a[n].ruleLine+20,data:a[n][t.prop],propType:t.prop,maxWidth:.4*r})}},{label:"项目",prop:"projects",width:.3*r,render:function(e,t,n){return f().createElement(E,{height:24*a[n].ruleLine+20,data:a[n][t.prop],maxWidth:.3*r})}},{label:"个人文件夹",prop:"folders",width:.3*r,render:function(e,t,n){return f().createElement(E,{height:24*a[n].ruleLine+20,data:a[n][t.prop],maxWidth:.3*r})}},{label:"操作",width:180,render:function(e,t,n){return f().createElement(C,{height:24*a[n].ruleLine+20,data:{status:a[n].status,history:a[n].history,folders:a[n].folders},id:e.id})}},{label:"",width:16}],data:a=t,className:"rule-list-table"})}))};var O={delete:{title:"是否仍要删除该规则？",type:"warning",body:"删除规则后，基于该规则移动的消息将仍保留在相应的文件夹。如果要移出该文件夹，请使用个人文件夹管理功能。"},stop:{title:"是否仍要停用该规则？",type:"warning",body:"停用后新的消息不会被本规则处理，但基于该规则移动的消息仍保留在相应的文件夹。"},open:{title:"是否启用该规则？",type:"warning",body:"启用规则后，符合本规则的新消息将被移动至相应的文件夹中。"},leave:{title:"是否仍要离开该页面？",type:"warning",body:"您离开该页面，您输入的数据可能不会被保存"},created:{title:"私人消息处理规则创建成功",type:"success",body:"规则立即生效\n历史数据将稍后的几分钟内完成标签化工作，但是不会分发消息"},edited:{title:"消息处理规则保存成功",type:"success",body:"规则立即生效\n首先会将该规则的历史标签清除，在稍后的几分钟内完成新的标签化工作，但是不会分发消息"},editNoChecked:{title:"提示",type:"error",body:'"标记标签"和"消息分配给"至少选定一个'},contentInvalid:{title:"提示",type:"error",body:"过滤条件中存在内容规则为空"},filterEmpty:{title:"提示",type:"error",body:"过滤条件不能为空"},senderCheckedEmpty:{title:"提示",type:"error",body:'选定"转发人"后内容不能为空'},folderCheckedEmpty:{title:"提示",type:"error",body:'选定"将消息移动到文件夹"后内容不能为空'},flinterAndUserEmpty:{title:"提示",type:"error",body:'"转发人"和"过滤条件"不能同时为空'}};const R=function(n){function e(e){var t=n.call(this,e)||this;return t.showDialog=function(e){t.state.visible?t.setState({visible:!1},function(){return t.setState(h()({history:!1,visible:!0,callback:void 0,cancelCallback:void 0},e))}):t.setState(h()({history:!1,visible:!0,callback:void 0,cancelCallback:void 0},e))},t.state={visible:!1,type:"",id:"",projectId:"",folderName:"",history:!1,callback:void 0,cancelCallback:void 0},t}return o()(e,n),e.prototype.render=function(){var t=this,e=this.state,n=e.visible,a=e.type,r=e.id,l=e.projectId,o=e.callback,i=e.history,c=e.cancelCallback,e=(e.folderName,this.props),s=e.onConfirm,u=e.onCancel,e=a?O[a].body:"";return f().createElement(g.Dialog,{className:"simple-dialog-wrapper simple-dialog-"+(a?O[a].type:""),closeOnClickModal:!1,title:a?O[a].title:"",visible:n,onCancel:function(){return t.setState({visible:!1,type:"",id:"",projectId:"",folderName:""})},size:"tiny"},f().createElement(g.Dialog.Body,null,f().createElement("div",{className:"dialog-body"},f().createElement("div",{style:{display:e?"block":"none"}},e.split("\n").map(function(e){return f().createElement("p",{key:e},e)})),"open"===a&&f().createElement("div",null,f().createElement(g.Checkbox,{checked:i,onChange:function(e){t.setState({history:e})}},"将符合本规则的历史消息也移动到相应的文件夹中")))),f().createElement(g.Dialog.Footer,null,f().createElement("div",null,"created"===a||"edited"===a||"editNoChecked"===a||"editFilterEmpty"===a||"filterEmpty"===a||"contentInvalid"===a||"senderCheckedEmpty"===a||"folderCheckedEmpty"===a||"flinterAndUserEmpty"===a?f().createElement(g.Button,{type:"primary",onClick:function(){t.setState({visible:!1,type:"",id:"",projectId:"",folderName:""}),s&&s({type:a,id:r,history:i}),o&&o()}},"确定"):f().createElement(f().Fragment,null,f().createElement(g.Button,{type:"primary",onClick:function(){t.setState({visible:!1,type:"",id:"",projectId:"",folderName:""},function(){s&&s({type:a,id:r,projectId:l,history:i}),o&&o()})}},"确定"),f().createElement(g.Button,{onClick:function(){t.setState({visible:!1,type:"",id:"",projectId:"",folderName:""}),u&&u({type:a,id:r,projectId:l,history:i}),c&&c()}},"取消")))))},e}(f().PureComponent);var S=n(35303),c=n(83425),I=n(58992);const j=function(t){function e(e){var l=t.call(this,e)||this;return l.getValue=function(){return new Promise(function(t,n){var a=l.filterConditionRef?l.filterConditionRef.getValue():[],r=l.contentRef?l.contentRef.getValue():[];0<r.length?l.contentRef.formRef.validate(function(e){e?t(h()({},(0,i._l)(a),{content:r})):n("contentInvalid")}):0<a.length?t(h()({},(0,i._l)(a))):n("filterEmpty")})},l.filterConditionRef=void 0,l.getContentRef=void 0,l}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.filterConditionRef&&this.filterConditionRef.getFilter()},n.render=function(){var t=this,e=this.props,n=e.filter,a=e.content,e=e.projectId;return f().createElement(f().Fragment,null,f().createElement(c.Z,{ref:function(e){return t.filterConditionRef=e},style:{display:"block"},type:"PRICE_WARNING",value:n,filter:["SOURCE","CONN_CONFIG"],filterSpecial:["source"],filterConfig:["ESCORE","messageType"],noBottom:!0,specifiyProjectId:e,hideAdvanced:!0,moreFilterPosition:"top"}),f().createElement("div",{className:"dashed-divider"}),f().createElement(I.Z,{value:a,ref:function(e){return t.contentRef=e}}))},e}(f().PureComponent);const _=function(e){var t=e.conditionList,n=t.userList,a=t.smartFolderList,r=e.handleOnConfirm,l=e.handleOnCancel,o=e.handleOnCommonChange,i=e.projectId,c=e.loading,s=e.filter,u=e.folderValues,d=e.userValues,m=e.contentValues,p=e.getFilterRef,t=e.isFolderChecked,e=e.isUserChecked;return f().createElement("div",{className:"message-rule-edit-view-wrapper"},f().createElement(g.Loading,{loading:c,style:{height:"100%"}},f().createElement(f().Fragment,null,f().createElement("div",{className:"edit-item user-top"},f().createElement("span",null,f().createElement(g.Checkbox,{checked:e,onChange:function(e){return o("isUserChecked",e)}},"转发人")),f().createElement("span",null,f().createElement(S.RS,{multiple:!0,tags:!0,value:d,onChange:function(e){return o("userValues",e)}},n.map(function(e){return f().createElement(S.Wx,{key:e.name},e.name)})))),f().createElement("div",{className:"edit-top"},f().createElement("span",{className:"edit-top-title"},"设置各种过滤条件，以方便对消息进行分类或处理")),f().createElement("div",{className:"solid-divider"}),f().createElement("div",{className:"edit-rule"},f().createElement(j,{filter:s,content:m,ref:p,projectId:i}))),f().createElement("div",{className:"zone-divider"}),f().createElement(f().Fragment,null,f().createElement("div",{className:"edit-top"},f().createElement("span",{className:"edit-top-title"},"满足以上条件时，则执行以下操作")),f().createElement("div",{className:"solid-divider"}),f().createElement("div",{className:"edit-item"},f().createElement("span",null,f().createElement(g.Checkbox,{checked:t,onChange:function(e){return o("isFolderChecked",e)}},"将消息移动到文件夹")),f().createElement("span",null,f().createElement(S.RS,{tags:!1,value:u,optionFilterProp:"label",onChange:function(e){return o("folderValues",[e])}},a.filter(function(e){return e.value===i}).map(function(e){return f().createElement(S.Wx,{key:e.id,label:e.name,value:e.name},e.name)}))))),f().createElement("div",{className:"button-zone"},f().createElement("span",{className:"rigth"},f().createElement(g.Button,{type:"primary",onClick:r},"保存"),f().createElement(g.Button,{onClick:l},"取消")))))};var t=n(64396),w=t.Z.personalSet.messageRulePrivate,n=function(l){function e(e){var f=l.call(this,e)||this;f._handleEvent=function(e){e&&"specify-filter-list"===e.key&&(e=(e=f.props.editData.filter)?(0,i.Bd)(e):[],f.setState({loading:!1,filter:e}))},f._handleOnCommonChange=function(e,t){var n=f.state,a=n.isFolderChecked,r=n.isUserChecked,l=n.userValues,n=n.folderValues;f.props.conditionList.userList;f.setState(((n={isFolderChecked:"folderValues"===e?0<t.length:a,isUserChecked:"userValues"===e?0<t.length:r,userValues:"isUserChecked"!==e||t?l:[],folderValues:"isFolderChecked"!==e||t?n:[]})[e]=t,n))},f._handleOnConfrim=function(){var t=f.props.onDialogOpen,e=f.state,n=e.isFolderChecked,a=e.isUserChecked,r=e.folderValues,l=e.userValues;n&&0===r.length?t({type:"folderCheckedEmpty"}):a&&0===l.length?t({type:"senderCheckedEmpty"}):f.filterRef&&f.filterRef.getValue().then(function(e){f.commit(e)}).catch(function(e){"filterEmpty"===e?0===l.length?t({type:"flinterAndUserEmpty"}):f.commit({}):t({type:e})})},f.commit=function(e){var t=f.props,n=t.onDialogOpen,a=t.conditionList,r=a.smartFolderList,l=a.userList,o=t.editData,i=o.id,c=o.history,s=t.addRule,u=t.updateRule,d=t.projectId,m=t.filterObj,p=f.state,a=p.isFolderChecked,o=p.isUserChecked,t=p.folderValues,p=p.userValues,t=a?t.map(function(t){return r.find(function(e){return e.name===t}).id}):[],p=o?p.map(function(t){return l.find(function(e){return e.name===t})}):[];i?u({id:i,filterModel:h()({},e,{fromUserList:p}),smartFolderIdList:t,onDialogOpen:n,filterObj:m,history:c}):s({projectId:d,filterModel:h()({},e,{fromUserList:p}),smartFolderIdList:t,onDialogOpen:n,filterObj:m})},f._handleOnCancel=function(){var e=f.props,t=e.onEditTriggerClick;(0,e.onDialogOpen)({type:"leave",callback:function(){t(void 0)}})},f.filterRef=void 0;var t=e.editData,n=t.filter,a=t.smartFolderList,r=n&&n.content||void 0,e=a&&a.map(function(e){return e.name})||[],t=n&&n.fromUserList&&n.fromUserList.map(function(e){return e.name})||[],a=0<e.length,n=0<t.length||0<t.length;return f.state={filter:[],folderValues:e,isFolderChecked:a,userValues:t,isUserChecked:n,contentValues:r,loading:!0},f.events={getFilterRef:function(e){return f.filterRef=e},handleOnCommonChange:f._handleOnCommonChange,handleOnConfirm:f._handleOnConfrim,handleOnCancel:f._handleOnCancel},f}o()(e,l);var t=e.prototype;return t.componentDidMount=function(){window.addEventListener("setItemEvent",this._handleEvent)},t.componentWillUnmount=function(){window.removeEventListener("setItemEvent",this._handleEvent)},t.render=function(){return f().createElement(_,h()({},this.props,this.state,this.events))},e}(f().PureComponent);const D=(0,l.connect)(function(){return{}},function(t){return{addRule:function(e){return t({type:w+"/addRule",payload:e})},updateRule:function(e){return t({type:w+"/updateRule",payload:e})}}})(n);const L=function(e){var t=e.headerTitle,n=e.onDialogConfirm,a=e.getDialogRef,r=e.editData,l=e.onDialogCancel,o=e.loading,i=e.onBreadcrumbBeforeJump,c=document.documentElement.clientHeight-46-78-24;return f().createElement("div",{className:"personal-message-rule-wrapper"},f().createElement(d.Z,{title:t,beforeJump:r&&i}),f().createElement("div",{className:"content",id:"message-rule-content"},f().createElement("div",{style:{minHeight:c,backgroundColor:"#fff",padding:"16px",marginBottom:r?46:""}},f().createElement(g.Loading,{loading:o,style:{height:"100%"}},void 0===r?f().createElement(N,e):f().createElement(D,e)))),f().createElement(R,{onConfirm:n,onCancel:l,ref:a}))};var P=t.Z.personalSet.messageRulePrivate,t=function(t){function e(e){var o=t.call(this,e)||this;return o._handleWindowResize=function(){var e=document.getElementById("message-rule-content").offsetWidth;o.setState({contentWidth:e})},o._handleWindowPoststate=function(e){e.preventDefault(),e.stopImmediatePropagation(),o.state.editData||o._handleOnDialogOpen({type:"leave"})},o._handleOnFilterChange=function(e){var t=o.state.filterObj,n=o.props,a=n.fetchRuleList,n=n.setProejctId,r={filterObj:h()({},t,e)};e.projectId&&(r.filterObj.projectIdList=[e.projectId],n({projectId:e.projectId})),o.setState(r,function(){a(r.filterObj)})},o._handleOnDialogConfirm=function(e){var t=o.props,n=t.updateHistoryRule,a=t.deleteRule,r=t.setRuleStatus,l=o.state.filterObj;switch(e.type){case"created":case"edited":o._handleOnEditTriggerClick(void 0),n({projectId:e.projectId,id:e.id,history:e.history?"Enable":"Disable",filterObj:l});break;case"delete":a({projectId:e.projectId,id:e.id,filterObj:l});break;case"stop":r({projectId:e.projectId,id:e.id,history:e.history?"Enable":"Disable",status:"Disable",filterObj:l});break;case"open":r({projectId:e.projectId,id:e.id,history:e.history?"Enable":"Disable",status:"Enable",filterObj:l});break;case"leave":o._handleOnEditTriggerClick(void 0)}},o._handleOnDialogCancel=function(e){var t=o.props.fetchRuleList;"created"===e.type&&(o._handleOnEditTriggerClick(void 0),t())},o._handleOnDialogOpen=function(e){o.simpleDialogRef.showDialog(e)},o._handleOnEditTriggerClick=function(t){var e=o.props.ruleList,n=t?0<Object.keys(t).length?e.find(function(e){return e.id===t.id}):{}:void 0,e=[{title:"私人消息处理规则"}];n&&(e=[{title:"私人消息处理规则",url:"/personalSettings/privateMessageRule"},{title:n.id?"修改规则":"创建",url:""}]),o.setState({editData:n,headerTitle:e})},o._handleOnBreadcrumbBeforeJump=function(e,t){o._handleOnDialogOpen({type:"leave",callback:function(){o._handleOnEditTriggerClick(void 0)}})},o.simpleDialogRef=void 0,o.filterConditionRef=void 0,o.state={headerTitle:[{title:"私人消息处理规则"}],contentWidth:0,folderData:[],filterObj:{projectIdList:[],status:null,smartFolderIdList:[]},editData:void 0,loading:!0},o.events={getDialogRef:function(e){return o.simpleDialogRef=e},onFilterChange:o._handleOnFilterChange,onDialogConfirm:o._handleOnDialogConfirm,onDialogCancel:o._handleOnDialogCancel,onDialogOpen:o._handleOnDialogOpen,onEditTriggerClick:o._handleOnEditTriggerClick,onBreadcrumbBeforeJump:o._handleOnBreadcrumbBeforeJump},o}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){var e,t=this,n=this.props,a=n.fetchCondition,r=n.location.state,l=n.setProejctId,n=this.state.filterObj;r?(l({projectId:r.projectId}),e=[r.folderName],this.setState({folderData:e},function(){return a({folderData:e,callback:function(e){return t.setState({filterObj:e})}})})):a({filterObj:n,callback:function(e){return t.setState({filterObj:e})}}),window.addEventListener("resize",this._handleWindowResize),window.addEventListener("popstate",this._handleWindowPoststate),this._handleWindowResize()},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.componentDidUpdate=function(e){!this.props.ruleListEffecting&&e.ruleListEffecting&&this.setState({loading:!1})},n.render=function(){return f().createElement(y.Provider,{value:{contentWidth:this.state.contentWidth,onDialogOpen:this._handleOnDialogOpen,onEditTriggerClick:this._handleOnEditTriggerClick}},f().createElement(L,h()({},this.props,this.state,this.events)))},e}(f().PureComponent);const F=(0,l.connect)(function(e){var t=e.loading,e=r()(e,["loading"]);return h()({},e[P],{confitionEffecting:t.effects[P+"/fetchCondition"],ruleListEffecting:t.effects[P+"/fetchRuleList"]})},function(t){return{fetchRuleList:function(e){return t({type:P+"/fetchRuleList",payload:e})},fetchCondition:function(e){return t({type:P+"/fetchCondition",payload:e})},updateHistoryRule:function(e){return t({type:P+"/updateHistoryRule",payload:e})},deleteRule:function(e){return t({type:P+"/deleteRule",payload:e})},setRuleStatus:function(e){return t({type:P+"/setRuleStatus",payload:e})},setProejctId:function(e){return t({type:P+"/save",payload:e})}}})(t)},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(67154),d=n.n(a),r=n(37316),m=n.n(r),t=n(85354),l=n.n(t),a=n(67294),p=n.n(a),r=n(45697),t=n.n(r),r=n(94184),f=n.n(r),a=function(e){function t(){return e.apply(this,arguments)||this}return l()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,r=e.block,l=e.indeterminate,o=e.value,i=e.checked,c=e.defaultChecked,s=e.onChange,u=e.disabled,e=m()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),s={value:o,checked:i,defaultChecked:c,onChange:s,disabled:u},a=f()(t,((u={})[t+"-disabled"]=s.disabled,u[t+"-block"]=r,u[t+"-indeterminate"]=l,u),a);return p().createElement("label",d()({tabIndex:s.disabled?-1:0,className:a},e),p().createElement("input",d()({type:"checkbox",className:t+"-input"},s)),p().createElement("span",{className:t+"-status"}),n&&p().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const o=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>i});var a=n(24473),r=n(67154),c=n.n(r),l=n(37316),s=n.n(l),t=n(85354),o=n.n(t),r=n(67294),u=n.n(r),l=n(45697),t=n.n(l),l=n(94184),d=n.n(l),l=function(r){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=r.call.apply(r,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return o()(e,r),e.prototype.render=function(){var r=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,l=(e.onChange,e.values),o=e.checkedList,i=e.block,e=s()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=l?l.map(function(e,t){var n=0!==o.length&&-1!==o.indexOf(e);return u().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return r.handleCheckBoxChange(e)},block:i},e)}):u().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==o.length&&-1!==o.indexOf(a);return u().cloneElement(e,{checked:a,key:t,block:n.block||i,onChange:function(){var e=n.value;r.handleCheckBoxChange(e)}})}});return u().createElement("div",c()({className:d()(t,a)},e),n)},e}(r.Component);l.defaultProps={prefixCls:"wt-checkbox-group"},l.propTypes={onChange:t().func,values:t().array,block:t().bool};const i=l;var m=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},r=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=m(e);return u().createElement("label",{className:e.className,title:e.children},u().createElement("div",{className:"checkbox"},u().createElement("input",c()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),u().createElement("div",{className:"checkbox-body"}))," ",u().createElement("span",null,e.children))},t}(r.Component);r.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},58992:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var t=n(67154),o=n.n(t),t=n(85354),a=n.n(t),t=n(67294),g=n.n(t),v=n(92360),t=n(45697),t=n.n(t),E=n(2258),y=n.n(E),C=n(85151),b=[{label:"包含",value:"contain"},{label:"不包含",value:"notContain"}];const i=function(e){var l=e.ruleGroup,o=e.formRef,i=e.groupIdx,r=e.editable,c=e.onSelectChange,s=e.onInputChange,u=e.onRuleItemDelete,t=e.onRuleGroupDelete,n=e.onRuleItemAdd,a=e.onActiveRuleCheckChange,d=(0===l.contain.length||""===l.contain[0])&&0===l.notContain.length,m=g().useState(d),p=m[0],f=m[1],e=g().useState(""),d=e[0],h=e[1];g().useEffect(function(){var e,n;p||h((e=l.sentence,n=l,(e?"一句话中":"全文中")+"："+["contain","notContain"].reduce(function(e,t){return n[t]&&0<n[t].length?[].concat(e,[("contain"===t?"包含":"不包含")+n[t].map(function(e){return'<span style="color: #262626;">“'+e+"”</span>"}).join("，")]):e},[]).join("，且")))},[p]);m=l.contain.length+l.notContain.length,e=42*m+30+10;return g().createElement("div",{className:"content-rule-group"},g().createElement("div",{className:"content-rule-group-top"},g().createElement("span",{className:"show-icon",onClick:function(){var t,a,e,n,r;p?(t=l,a=i,e=o,n=["contain","notContain"].reduce(function(e,n){return[].concat(e,t[n].map(function(e,t){return"rule-"+a+"-"+n+"-"+t}))},[]),r=e[0],n=n.map(function(e){return new Promise(function(t,n){r?r.validateField(e,function(e){(null===e?t:n)()}):n()})}),Promise.all(n).then(function(){f(!1)})):f(!0)}},g().createElement("i",{className:"icon-cem_pull-or-take-up",style:{transform:"rotate("+(p?-180:0)+"deg)"}})),g().createElement("span",{className:"content-rule-group-title"},p?g().createElement("span",{className:"group-title-check"},g().createElement(C.Jg,{checked:l.sentence,onChange:function(e){e=e.currentTarget.checked;return a(i,e)}}),g().createElement("span",{style:{marginLeft:8}},"以下关键词出现在",g().createElement("span",{style:{color:"#262626"}},"“一句话”"),"中条件才生效?")):g().createElement("span",{dangerouslySetInnerHTML:{__html:d}})),g().createElement("span",{className:"group-delete",onClick:function(){return t(i)}},g().createElement("i",{className:"icon-cem_delete"}))),g().createElement("div",{className:"content-rule-group-list",style:{height:p?e:0,paddingTop:p?10:0}},g().createElement("div",{className:"group-list "+(1<m?"mulit-group-list":"")},g().createElement("span",{className:"list-left"},g().createElement("span",{style:{fontSize:14}},"且")),g().createElement("span",{className:"list-right"},["contain","notContain"].map(function(a){return l[a]&&l[a].map(function(e,t){var n="rule-"+i+"-"+a+"-"+t;return g().createElement("div",{key:n,className:"content-rule-group-item"},g().createElement("span",null,g().createElement(y(),{disabled:!r,value:b.find(function(e){return e.value===a}).label,onChange:function(e){return c(n,e)}},b.map(function(e){return g().createElement(E.Option,{key:e.value,title:e.label},e.label)}))),g().createElement("span",{style:{height:42}},g().createElement(v.Form.Item,{prop:n},g().createElement(v.Input,{disabled:!r,value:e,onChange:function(e){return s(n,e)}}))),r&&g().createElement("span",{onClick:function(){return u(n)}},g().createElement("i",{className:"icon-cem_delete"})))})}))),r&&g().createElement(g().Fragment,null,g().createElement("span",{className:"add-icon",onClick:function(){return n(i)}},g().createElement("i",{className:"icon-cem_add-to"})),g().createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"添加新的关键词"))))};var r={contain:[""],notContain:[],sentence:!0,id:Math.round(1e4*Math.random())},n=function(t){function e(e){var i=t.call(this,e)||this;i._handleOnRuleGroupAdd=function(){var e=i.state.content,e=[].concat(e,[JSON.parse(JSON.stringify(r))]);i.setState({content:e,formProps:i.getFormProps(e),hasChanged:!0})},i._handleOnRuleItemAdd=function(e){var t,n=i.state.content,a=i.props.onChange;n[e]&&((t=JSON.parse(JSON.stringify(n)))[e].contain||(t[e].contain=[]),t[e].contain.push(""),i.setState({content:t,formProps:i.getFormProps(t),hasChanged:!0},function(){return a&&a(t)}))},i._handleOnRuleItemDelete=function(e){var t,n,a,r,l;e&&(t=i.state.content,n=i.props.onChange,(r=e.split("-"))[0],a=r[1],e=r[2],r=r[3],t[a]&&t[a][e]&&void 0!==t[a][e][r]&&((l=JSON.parse(JSON.stringify(t)))[a][e].splice(r,1),0===l[a].contain.length&&0===l[a].notContain.length&&l.splice(a,1),i.setState({content:l,formProps:i.getFormProps(l),hasChanged:!0},function(){return n&&n(l)})))},i._handleOnSelecChange=function(e,t){var n,a,r,l,o;e&&t&&(n=i.state.content,a=i.props.onChange,(o=e.split("-"))[0],r=o[1],e=o[2],o=o[3],n[r]&&n[r][e]&&void 0!==n[r][e][o]&&(o=(l=JSON.parse(JSON.stringify(n)))[r][e].splice(o,1),l[r][t].push(o[0]),i.setState({content:l,formProps:i.getFormProps(l),hasChanged:!0},function(){return a&&a(l)})))},i._handleOnInputChange=function(e,t){var n,a,r,l,o;e&&(n=i.state.content,a=i.props.onChange,(l=e.split("-"))[0],r=l[1],e=l[2],l=l[3],n[r]&&n[r][e]&&void 0!==n[r][e][l]&&((o=JSON.parse(JSON.stringify(n)))[r][e][l]=t,i.setState({content:o,formProps:i.getFormProps(o),hasChanged:!0},function(){return a&&a(o)})))},i._handleOnActiveRuleCheckChange=function(e,t){var n,a=i.state.content,r=i.props.onChange;a[e]&&((n=JSON.parse(JSON.stringify(a)))[e].sentence=t,i.setState({content:n,hasChanged:!0},function(){return r&&r(n)}))},i._handleOnRuleGroupDelete=function(e){var t,n=i.state.content,a=i.props.onChange;!n[e]||(t=JSON.parse(JSON.stringify(n))).splice(e,1)&&i.setState({content:t,hasChanged:!0,formProps:i.getFormProps(t)},function(){return a&&a(t)})},i.getValue=function(){return i.state.content},i.hasChanged=function(){return i.state.hasChanged},i.getFormProps=function(e){var r={model:{},rules:{}};return e&&0<e.length&&e.forEach(function(e,a){e&&["contain","notContain"].forEach(function(n){e[n]&&e[n].forEach(function(e,t){t="rule-"+a+"-"+n+"-"+t;r.model[t]=e,r.rules[t]=[{required:!0,message:" ",trigger:"blur"}]})})}),r},i.mRefs=[],i.formRef=void 0;e=(e.value||[r]).map(function(e){return o()({},e,{id:Math.round(1e4*Math.random())})});return i.state={content:e,formProps:i.getFormProps(e),hasChanged:!1},i}a()(e,t);var n=e.prototype;return n.componentDidUpdate=function(e){var t=e.value,e=this.props.value;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({content:e,formProps:this.getFormProps(e)})},n.render=function(){var n=this,e=this.state,t=e.content,a=e.formProps,r=this.props,e=r.editable,l=void 0===e||e,r=r.className,r=void 0===r?"":r;return g().createElement("div",{className:"content-rule-wrapper "+r},g().createElement("span",{className:"content-rule-title"},"内容"),g().createElement("div",{className:"content-rule"},g().createElement(v.Form,o()({},a,{ref:function(e){n.formRef=e,n.mRefs.splice(0,n.mRefs.length),n.mRefs.push(e)}}),0<t.length&&g().createElement("span",{className:"content-rule-hint"},"满足任意一组条件，该规则即生效"),t.map(function(e,t){return g().createElement(i,{key:e.id,formRef:n.mRefs,ruleGroup:e,groupIdx:t,editable:l,onSelectChange:n._handleOnSelecChange,onRuleGroupDelete:n._handleOnRuleGroupDelete,onInputChange:n._handleOnInputChange,onRuleItemDelete:n._handleOnRuleItemDelete,onRuleItemAdd:n._handleOnRuleItemAdd,onActiveRuleCheckChange:n._handleOnActiveRuleCheckChange})})),l&&g().createElement(g().Fragment,null,g().createElement("span",{className:"add-icon",onClick:this._handleOnRuleGroupAdd},g().createElement("i",{className:"icon-cem_add-to"})),g().createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"添加新的条件"))))},e}(g().PureComponent);const l=n;n.propTypes={value:t().array,editable:t().bool,onChange:t().func,className:t().string}}}]);