"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6297],{46297:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var a=n(63366),r=n(87462),l=n(94578),i=n(67294),o=n(55609),c=n(55815),s=n(60496),u=n(92360),d=n(43036),m=n(6233),p=function(e,t,n){return i.createElement("div",{className:"message-rule-content-overlay-wrapper"},i.createElement("div",{className:"content-overlay-title"},e),n.map((function(e){return i.createElement("div",{className:"content-overlay-item",key:e},i.createElement("span",{className:"content-overlay-item-type"},e),i.createElement("span",{className:"content-overlay-item-content"},t[e].join("\uff0c")))})),t["\u5185\u5bb9"]&&i.createElement("div",{className:"content-overlay-item"},i.createElement("span",{className:"content-overlay-item-type"},"\u7ec4\u5408\u89c4\u5219"),i.createElement("span",{className:"content-overlay-item-content"},i.createElement("span",{className:"content-list-type"},"\u5185\u5bb9"),i.createElement("span",{className:"content-list-value"},t["\u5185\u5bb9"].map((function(e){return i.createElement("span",{key:e},e)}))))))},f=function(e,t){return i.createElement("div",{className:"message-rule-content-overlay-wrapper"},i.createElement("div",{className:"content-overlay-title"},e),i.createElement("div",null,t))},h=function(e,t){return i.createElement("div",{className:"message-rule-content-overlay-wrapper"},i.createElement("span",{style:{color:"#8c8c8c"}},"\u6807\u7b7e\u7c7b\u578b\uff1a"),i.createElement("span",null,e+"\uff0c "),i.createElement("span",{style:{color:"#8c8c8c"}},"\u6807\u7b7e\uff1a"),i.createElement("span",null,t))},g=function(e,t,n,a){if("rule"===t)return i.createElement("div",{key:e,className:"column-item"},i.createElement("span",{className:"column-item-type"},e),i.createElement("span",{className:"column-item-content"},a));var r=(0,m.rV)(""+e+a)+12,l=n-35-36,o=l-(0,m.rV)(e)-12;return i.createElement("div",{key:e,className:"column-item-single"},i.createElement("span",{className:"column-item-type"},e),i.createElement("span",{style:{display:"inline-flex"}},i.createElement("span",{className:"column-item-content",style:{maxWidth:o}},a),r>l&&i.createElement(d.Z,{overlay:"recipient"===t?f(e,a):h(e,a),placement:"top"},i.createElement("span",{className:"content-item-detail"},"\u8be6\u60c5"))))};const v=function(e){var t=e.data,n=e.propType,a=e.maxWidth,r=e.height,l=Object.keys(t).filter((function(e){return"\u5185\u5bb9"!==e})),o=["\u65e0"];return t["\u5185\u5bb9"]&&t["\u5185\u5bb9"].length>0&&JSON.stringify(o)!==JSON.stringify(t["\u5185\u5bb9"])&&(t["\u5185\u5bb9"].length>5?(o=t["\u5185\u5bb9"].slice(0,4)).push("..."):o=t["\u5185\u5bb9"]),i.createElement("div",{className:"column-type-wrapper",style:{height:r}},l.map((function(e,r,o){var c="rule"===n?3:4,s=t[e].join("\uff0c");return o.length<c||("rule"===n?0===r:r<3)?g(e,n,a,s):("rule"===n?1===r:3===r)?i.createElement("div",{key:r},i.createElement("span",{style:{color:"#8c8c8c"}},"..."),"tag"===n&&i.createElement(d.Z,{overlay:p("\u6807\u7b7e",t,l),placement:"top"},i.createElement("span",{className:"content-item-detail"},"\u8be6\u60c5"))):null})),t["\u5185\u5bb9"]&&i.createElement("div",{className:"column-item"},i.createElement("span",{className:"column-item-type item-"+n},"\u5185\u5bb9"),i.createElement("span",{className:"column-item-content"},o.map((function(e,t,n){return i.createElement("span",{className:"content-item",key:""+e+t},e)})))),"rule"===n&&i.createElement(d.Z,{overlay:p("\u6d88\u606f\u5904\u7406\u89c4\u5219",t,l),placement:"top"},i.createElement("span",{className:"content-item-detail"},"\u8be6\u60c5")))};const E=function(e){var t=e.data,n=e.maxWidth,a=e.height;return i.createElement("div",{className:"simple-column-type-wrapper",style:{height:a}},t.map((function(e){var t=(0,m.rV)(e),a=n-35-36;return i.createElement("span",{className:"column-item-single",key:e},i.createElement("span",{className:"column-item-content",style:{maxWidth:a}},e),t>a&&i.createElement(d.Z,{placement:"top",overlay:e},i.createElement("span",{className:"content-item-detail"},"\u8be6\u60c5")))})))};var y=i.createContext({contentWidth:0});const C=function(e){var t=e.data,n=t.status,a=t.history,r=t.folders,l=e.id,o=e.projectId,c=e.height,s=i.useState("Enable"===n),m=s[0],p=s[1];return i.useEffect((function(){p("Enable"===n)}),[n]),i.createElement(y.Consumer,null,(function(e){var t=e.onDialogOpen,n=e.onEditTriggerClick;return i.createElement("div",{className:"control-item-wrapper",style:{height:c}},i.createElement(d.Z,{overlay:m?"\u5f00\u542f":"\u5173\u95ed",placement:"top"},i.createElement("span",null,i.createElement(u.Switch,{value:m,onText:"",offText:"",onColor:"#0747A6",offColor:"#8c8c8c",onChange:function(e){t({type:m?"stop":"open",projectId:o,id:l,folderName:r&&r.join("\uff0c"),history:"Enable"===a,callback:function(){}})}}))),i.createElement("span",{onClick:function(e){n({id:l})}},"\u7f16\u8f91"),i.createElement("span",{onClick:function(){t({type:"delete",projectId:o,id:l})}},"\u5220\u9664"))}))};var b=n(45697),k=n.n(b),N=function(e){function t(t){var n;return(n=e.call(this,t)||this)._setPadShowFalse=function(){n.state.show&&n.setState({show:!1})},n._setEvent=function(e){return 0===e?{onMouseEnter:function(){n.setState({firstLiHover:!0})},onMouseLeave:function(){n.setState({firstLiHover:!1})}}:{}},n._handleOnClick=function(e){var t=n.state.show;t&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){n.setState({show:!t})}),0)},n._handleOptionChange=function(e){var t=n.props,a=(t.options,t.onChange);n.setState({checkedArr:e},(function(){return a(e.map((function(e){return e})))}))},n.state={show:!1,firstLiHover:!1,checkedArr:[],isAllChecked:!1,isIndeterminate:!1},n}(0,l.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},n.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},n.componentDidUpdate=function(e){var t=e.value,n=this.props,a=n.value,r=n.options;JSON.stringify(t)!==JSON.stringify(a)&&this.setState({checkedArr:a.reduce((function(e,t){var n=r.find((function(e){return e.title===t}));return n&&e.push(n.value),e}),[])})},n.render=function(){var e=this.state,t=e.show,n=e.checkedArr,a=this.props,r=a.options,l=a.preTitle,o=0===r.length?"\u6682\u65e0\u6570\u636e":0===n.length?"\u5168\u90e8":n.map((function(e){return r.find((function(t){return t.value===e})).title})).join("\uff0c");return i.createElement("div",{className:"multi-check-button-wrapper",onClick:this._handleOnClick},i.createElement("span",{className:"button-trigger "+(t?"sel":"")},i.createElement("span",{className:"pre-title"},l,":"),i.createElement("span",{className:"title"},o),i.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),i.createElement("div",{className:"button-panel "+(t?"active":"")+" "+(this.state.firstLiHover?"selPadHover":""),onClick:function(e){return e.stopPropagation()}},r.length>0?i.createElement(u.Checkbox.Group,{value:n,onChange:this._handleOptionChange},r.map((function(e,t){return i.createElement(u.Checkbox,{label:e.value,className:"panel-item",key:e.value},e.title)}))):i.createElement("div",{className:"empty"},"\u6682\u65e0\u6570\u636e")))},t}(i.PureComponent);N.propTypes={value:k().array,onChange:k().func.isRequired,options:k().array.isRequired,preTitle:k().string.isRequired};const O=N;var R=[{title:"\u5168\u90e8",value:"null"},{title:"\u542f\u7528",value:"Enable"},{title:"\u505c\u7528",value:"Disable"}],S=function(e,t){var n=e-5-24-32-96-180;return[{label:"",width:16},{label:"\u6d88\u606f\u5904\u7406\u89c4\u5219",prop:"rule",width:.4*n,render:function(e,a,r){return i.createElement(v,{height:24*t[r].ruleLine+20,data:t[r][a.prop],propType:a.prop,maxWidth:.4*n})}},{label:"\u9879\u76ee",prop:"projects",width:.3*n,render:function(e,a,r){return i.createElement(E,{height:24*t[r].ruleLine+20,data:t[r][a.prop],maxWidth:.3*n})}},{label:"\u4e2a\u4eba\u6587\u4ef6\u5939",prop:"folders",width:.3*n,render:function(e,a,r){return i.createElement(E,{height:24*t[r].ruleLine+20,data:t[r][a.prop],maxWidth:.3*n})}},{label:"\u64cd\u4f5c",width:180,render:function(e,n,a){return i.createElement(C,{height:24*t[a].ruleLine+20,data:{status:t[a].status,history:t[a].history,folders:t[a].folders},id:e.id})}},{label:"",width:16}]};const _=function(e){var t=e.ruleDatas,n=e.projectId,a=e.projectOptions,r=e.folderOptions,l=e.onFilterChange,o=e.folderData,c=e.filterObj.status,d=e.onEditTriggerClick;return i.createElement("div",{className:"message-rule-list-wrapper"},i.createElement("div",{className:"button-top"},i.createElement("span",{className:"button-left"},i.createElement(s.Z,{activeObj:n,preTitle:"\u9879\u76ee",objName:"projectId",onChange:l,options:a}),i.createElement(O,{options:r,preTitle:"\u6587\u4ef6\u5939",value:o,onChange:function(e){return l({smartFolderIdList:e})}}),i.createElement(u.Radio.Group,{value:null===c?"null":c,onChange:function(e){l("null"===e?{status:null}:{status:e})}},R.map((function(e){return i.createElement(u.Radio.Button,{key:e.title,value:e.value},e.title)})))),i.createElement("span",{className:"button-right"},i.createElement(u.Button,{type:"primary",onClick:function(e){return d({})}},"\u521b\u5efa\u89c4\u5219"))),i.createElement(y.Consumer,null,(function(e){var n=e.contentWidth;return i.createElement(u.Table,{style:{width:"100%",zIndex:0,marginTop:10,minHeight:500},columns:S(n,t),data:t,className:"rule-list-table"})})))};var I={delete:{title:"\u662f\u5426\u4ecd\u8981\u5220\u9664\u8be5\u89c4\u5219\uff1f",type:"warning",body:"\u5220\u9664\u89c4\u5219\u540e\uff0c\u57fa\u4e8e\u8be5\u89c4\u5219\u79fb\u52a8\u7684\u6d88\u606f\u5c06\u4ecd\u4fdd\u7559\u5728\u76f8\u5e94\u7684\u6587\u4ef6\u5939\u3002\u5982\u679c\u8981\u79fb\u51fa\u8be5\u6587\u4ef6\u5939\uff0c\u8bf7\u4f7f\u7528\u4e2a\u4eba\u6587\u4ef6\u5939\u7ba1\u7406\u529f\u80fd\u3002"},stop:{title:"\u662f\u5426\u4ecd\u8981\u505c\u7528\u8be5\u89c4\u5219\uff1f",type:"warning",body:"\u505c\u7528\u540e\u65b0\u7684\u6d88\u606f\u4e0d\u4f1a\u88ab\u672c\u89c4\u5219\u5904\u7406\uff0c\u4f46\u57fa\u4e8e\u8be5\u89c4\u5219\u79fb\u52a8\u7684\u6d88\u606f\u4ecd\u4fdd\u7559\u5728\u76f8\u5e94\u7684\u6587\u4ef6\u5939\u3002"},open:{title:"\u662f\u5426\u542f\u7528\u8be5\u89c4\u5219\uff1f",type:"warning",body:"\u542f\u7528\u89c4\u5219\u540e\uff0c\u7b26\u5408\u672c\u89c4\u5219\u7684\u65b0\u6d88\u606f\u5c06\u88ab\u79fb\u52a8\u81f3\u76f8\u5e94\u7684\u6587\u4ef6\u5939\u4e2d\u3002"},leave:{title:"\u662f\u5426\u4ecd\u8981\u79bb\u5f00\u8be5\u9875\u9762\uff1f",type:"warning",body:"\u60a8\u79bb\u5f00\u8be5\u9875\u9762\uff0c\u60a8\u8f93\u5165\u7684\u6570\u636e\u53ef\u80fd\u4e0d\u4f1a\u88ab\u4fdd\u5b58"},created:{title:"\u79c1\u4eba\u6d88\u606f\u5904\u7406\u89c4\u5219\u521b\u5efa\u6210\u529f",type:"success",body:"\u89c4\u5219\u7acb\u5373\u751f\u6548\n\u5386\u53f2\u6570\u636e\u5c06\u7a0d\u540e\u7684\u51e0\u5206\u949f\u5185\u5b8c\u6210\u6807\u7b7e\u5316\u5de5\u4f5c\uff0c\u4f46\u662f\u4e0d\u4f1a\u5206\u53d1\u6d88\u606f"},edited:{title:"\u6d88\u606f\u5904\u7406\u89c4\u5219\u4fdd\u5b58\u6210\u529f",type:"success",body:"\u89c4\u5219\u7acb\u5373\u751f\u6548\n\u9996\u5148\u4f1a\u5c06\u8be5\u89c4\u5219\u7684\u5386\u53f2\u6807\u7b7e\u6e05\u9664\uff0c\u5728\u7a0d\u540e\u7684\u51e0\u5206\u949f\u5185\u5b8c\u6210\u65b0\u7684\u6807\u7b7e\u5316\u5de5\u4f5c\uff0c\u4f46\u662f\u4e0d\u4f1a\u5206\u53d1\u6d88\u606f"},editNoChecked:{title:"\u63d0\u793a",type:"error",body:'"\u6807\u8bb0\u6807\u7b7e"\u548c"\u6d88\u606f\u5206\u914d\u7ed9"\u81f3\u5c11\u9009\u5b9a\u4e00\u4e2a'},contentInvalid:{title:"\u63d0\u793a",type:"error",body:"\u8fc7\u6ee4\u6761\u4ef6\u4e2d\u5b58\u5728\u5185\u5bb9\u89c4\u5219\u4e3a\u7a7a"},filterEmpty:{title:"\u63d0\u793a",type:"error",body:"\u8fc7\u6ee4\u6761\u4ef6\u4e0d\u80fd\u4e3a\u7a7a"},senderCheckedEmpty:{title:"\u63d0\u793a",type:"error",body:'\u9009\u5b9a"\u8f6c\u53d1\u4eba"\u540e\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a'},folderCheckedEmpty:{title:"\u63d0\u793a",type:"error",body:'\u9009\u5b9a"\u5c06\u6d88\u606f\u79fb\u52a8\u5230\u6587\u4ef6\u5939"\u540e\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a'},flinterAndUserEmpty:{title:"\u63d0\u793a",type:"error",body:'"\u8f6c\u53d1\u4eba"\u548c"\u8fc7\u6ee4\u6761\u4ef6"\u4e0d\u80fd\u540c\u65f6\u4e3a\u7a7a'}};const j=function(e){function t(t){var n;return(n=e.call(this,t)||this).showDialog=function(e){n.state.visible?n.setState({visible:!1},(function(){return n.setState((0,r.Z)({history:!1,visible:!0,callback:void 0,cancelCallback:void 0},e))})):n.setState((0,r.Z)({history:!1,visible:!0,callback:void 0,cancelCallback:void 0},e))},n.state={visible:!1,type:"",id:"",projectId:"",folderName:"",history:!1,callback:void 0,cancelCallback:void 0},n}return(0,l.Z)(t,e),t.prototype.render=function(){var e=this,t=this.state,n=t.visible,a=t.type,r=t.id,l=t.projectId,o=t.callback,c=t.history,s=t.cancelCallback,d=(t.folderName,this.props),m=d.onConfirm,p=d.onCancel,f=a?I[a].body:"";return i.createElement(u.Dialog,{className:"simple-dialog-wrapper simple-dialog-"+(a?I[a].type:""),closeOnClickModal:!1,title:a?I[a].title:"",visible:n,onCancel:function(){return e.setState({visible:!1,type:"",id:"",projectId:"",folderName:""})},size:"tiny"},i.createElement(u.Dialog.Body,null,i.createElement("div",{className:"dialog-body"},i.createElement("div",{style:{display:f?"block":"none"}},f.split("\n").map((function(e){return i.createElement("p",{key:e},e)}))),"open"===a&&i.createElement("div",null,i.createElement(u.Checkbox,{checked:c,onChange:function(t){e.setState({history:t})}},"\u5c06\u7b26\u5408\u672c\u89c4\u5219\u7684\u5386\u53f2\u6d88\u606f\u4e5f\u79fb\u52a8\u5230\u76f8\u5e94\u7684\u6587\u4ef6\u5939\u4e2d")))),i.createElement(u.Dialog.Footer,null,i.createElement("div",null,"created"===a||"edited"===a||"editNoChecked"===a||"editFilterEmpty"===a||"filterEmpty"===a||"contentInvalid"===a||"senderCheckedEmpty"===a||"folderCheckedEmpty"===a||"flinterAndUserEmpty"===a?i.createElement(u.Button,{type:"primary",onClick:function(){e.setState({visible:!1,type:"",id:"",projectId:"",folderName:""}),m&&m({type:a,id:r,history:c}),o&&o()}},"\u786e\u5b9a"):i.createElement(i.Fragment,null,i.createElement(u.Button,{type:"primary",onClick:function(){e.setState({visible:!1,type:"",id:"",projectId:"",folderName:""},(function(){m&&m({type:a,id:r,projectId:l,history:c}),o&&o()}))}},"\u786e\u5b9a"),i.createElement(u.Button,{onClick:function(){e.setState({visible:!1,type:"",id:"",projectId:"",folderName:""}),p&&p({type:a,id:r,projectId:l,history:c}),s&&s()}},"\u53d6\u6d88")))))},t}(i.PureComponent);var w=n(35303),D=n(83425),L=n(58992);const P=function(e){function t(t){var n;return(n=e.call(this,t)||this).getValue=function(){return new Promise((function(e,t){var a=n.filterConditionRef?n.filterConditionRef.getValue():[],l=n.contentRef?n.contentRef.getValue():[];l.length>0?n.contentRef.formRef.validate((function(n){n?e((0,r.Z)({},(0,m._l)(a),{content:l})):t("contentInvalid")})):a.length>0?e((0,r.Z)({},(0,m._l)(a))):t("filterEmpty")}))},n.filterConditionRef=void 0,n.getContentRef=void 0,n}(0,l.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.filterConditionRef&&this.filterConditionRef.getFilter()},n.render=function(){var e=this,t=this.props,n=t.filter,a=t.content,r=t.projectId;return i.createElement(i.Fragment,null,i.createElement(D.Z,{ref:function(t){return e.filterConditionRef=t},style:{display:"block"},type:"PRICE_WARNING",value:n,filter:["SOURCE","CONN_CONFIG"],filterSpecial:["source"],filterConfig:["ESCORE","messageType"],noBottom:!0,specifiyProjectId:r,hideAdvanced:!0,moreFilterPosition:"top"}),i.createElement("div",{className:"dashed-divider"}),i.createElement(L.Z,{value:a,ref:function(t){return e.contentRef=t}}))},t}(i.PureComponent);const F=function(e){var t=e.conditionList,n=t.userList,a=t.smartFolderList,r=e.handleOnConfirm,l=e.handleOnCancel,o=e.handleOnCommonChange,c=e.projectId,s=e.loading,d=e.filter,m=e.folderValues,p=e.userValues,f=e.contentValues,h=e.getFilterRef,g=e.isFolderChecked,v=e.isUserChecked;return i.createElement("div",{className:"message-rule-edit-view-wrapper"},i.createElement(u.Loading,{loading:s,style:{height:"100%"}},i.createElement(i.Fragment,null,i.createElement("div",{className:"edit-item user-top"},i.createElement("span",null,i.createElement(u.Checkbox,{checked:v,onChange:function(e){return o("isUserChecked",e)}},"\u8f6c\u53d1\u4eba")),i.createElement("span",null,i.createElement(w.RS,{multiple:!0,tags:!0,value:p,onChange:function(e){return o("userValues",e)}},n.map((function(e){return i.createElement(w.Wx,{key:e.name},e.name)}))))),i.createElement("div",{className:"edit-top"},i.createElement("span",{className:"edit-top-title"},"\u8bbe\u7f6e\u5404\u79cd\u8fc7\u6ee4\u6761\u4ef6\uff0c\u4ee5\u65b9\u4fbf\u5bf9\u6d88\u606f\u8fdb\u884c\u5206\u7c7b\u6216\u5904\u7406")),i.createElement("div",{className:"solid-divider"}),i.createElement("div",{className:"edit-rule"},i.createElement(P,{filter:d,content:f,ref:h,projectId:c}))),i.createElement("div",{className:"zone-divider"}),i.createElement(i.Fragment,null,i.createElement("div",{className:"edit-top"},i.createElement("span",{className:"edit-top-title"},"\u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\u65f6\uff0c\u5219\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c")),i.createElement("div",{className:"solid-divider"}),i.createElement("div",{className:"edit-item"},i.createElement("span",null,i.createElement(u.Checkbox,{checked:g,onChange:function(e){return o("isFolderChecked",e)}},"\u5c06\u6d88\u606f\u79fb\u52a8\u5230\u6587\u4ef6\u5939")),i.createElement("span",null,i.createElement(w.RS,{tags:!1,value:m,optionFilterProp:"label",onChange:function(e){return o("folderValues",[e])}},a.filter((function(e){return e.value===c})).map((function(e){return i.createElement(w.Wx,{key:e.id,label:e.name,value:e.name},e.name)})))))),i.createElement("div",{className:"button-zone"},i.createElement("span",{className:"rigth"},i.createElement(u.Button,{type:"primary",onClick:r},"\u4fdd\u5b58"),i.createElement(u.Button,{onClick:l},"\u53d6\u6d88")))))};var Z=n(64396),x=Z.Z.personalSet.messageRulePrivate,T=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleEvent=function(e){if(e&&"specify-filter-list"===e.key){var t=n.props.editData.filter,a=t?(0,m.Bd)(t):[];n.setState({loading:!1,filter:a})}},n._handleOnCommonChange=function(e,t){var a,r=n.state,l=r.isFolderChecked,i=r.isUserChecked,o=r.userValues,c=r.folderValues,s=(n.props.conditionList.userList,t);n.setState(((a={isFolderChecked:"folderValues"===e?t.length>0:l,isUserChecked:"userValues"===e?t.length>0:i,userValues:"isUserChecked"!==e||t?o:[],folderValues:"isFolderChecked"!==e||t?c:[]})[e]=s,a))},n._handleOnConfrim=function(){var e=n.props.onDialogOpen,t=n.state,a=t.isFolderChecked,r=t.isUserChecked,l=t.folderValues,i=t.userValues;a&&0===l.length?e({type:"folderCheckedEmpty"}):r&&0===i.length?e({type:"senderCheckedEmpty"}):n.filterRef&&n.filterRef.getValue().then((function(e){n.commit(e)})).catch((function(t){"filterEmpty"===t?0===i.length?e({type:"flinterAndUserEmpty"}):n.commit({}):e({type:t})}))},n.commit=function(e){var t=n.props,a=t.onDialogOpen,l=t.conditionList,i=l.smartFolderList,o=l.userList,c=t.editData,s=c.id,u=c.history,d=t.addRule,m=t.updateRule,p=t.projectId,f=t.filterObj,h=n.state,g=h.isFolderChecked,v=h.isUserChecked,E=h.folderValues,y=h.userValues,C=g?E.map((function(e){return i.find((function(t){return t.name===e})).id})):[],b=v?y.map((function(e){return o.find((function(t){return t.name===e}))})):[];s?m({id:s,filterModel:(0,r.Z)({},e,{fromUserList:b}),smartFolderIdList:C,onDialogOpen:a,filterObj:f,history:u}):d({projectId:p,filterModel:(0,r.Z)({},e,{fromUserList:b}),smartFolderIdList:C,onDialogOpen:a,filterObj:f})},n._handleOnCancel=function(){var e=n.props,t=e.onEditTriggerClick;(0,e.onDialogOpen)({type:"leave",callback:function(){t(void 0)}})},n.filterRef=void 0;var a=t.editData,l=a.filter,i=a.smartFolderList,o=l&&l.content||void 0,c=i&&i.map((function(e){return e.name}))||[],s=l&&l.fromUserList&&l.fromUserList.map((function(e){return e.name}))||[],u=c.length>0,d=s.length>0||s.length>0;return n.state={filter:[],folderValues:c,isFolderChecked:u,userValues:s,isUserChecked:d,contentValues:o,loading:!0},n.events={getFilterRef:function(e){return n.filterRef=e},handleOnCommonChange:n._handleOnCommonChange,handleOnConfirm:n._handleOnConfrim,handleOnCancel:n._handleOnCancel},n}(0,l.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){window.addEventListener("setItemEvent",this._handleEvent)},n.componentWillUnmount=function(){window.removeEventListener("setItemEvent",this._handleEvent)},n.render=function(){return i.createElement(F,(0,r.Z)({},this.props,this.state,this.events))},t}(i.PureComponent);const J=(0,o.connect)((function(){return{}}),(function(e){return{addRule:function(t){return e({type:x+"/addRule",payload:t})},updateRule:function(t){return e({type:x+"/updateRule",payload:t})}}}))(T);const W=function(e){var t=e.headerTitle,n=e.onDialogConfirm,a=e.getDialogRef,r=e.editData,l=e.onDialogCancel,o=e.loading,s=e.onBreadcrumbBeforeJump,d=document.documentElement.clientHeight-46-78-24;return i.createElement("div",{className:"personal-message-rule-wrapper"},i.createElement(c.Z,{title:t,beforeJump:r&&s}),i.createElement("div",{className:"content",id:"message-rule-content"},i.createElement("div",{style:{minHeight:d,backgroundColor:"#fff",padding:"16px",marginBottom:r?46:""}},i.createElement(u.Loading,{loading:o,style:{height:"100%"}},void 0===r?i.createElement(_,e):i.createElement(J,e)))),i.createElement(j,{onConfirm:n,onCancel:l,ref:a}))};var V=["loading"],B=Z.Z.personalSet.messageRulePrivate,A=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleWindowResize=function(){var e=document.getElementById("message-rule-content").offsetWidth;n.setState({contentWidth:e})},n._handleWindowPoststate=function(e){e.preventDefault(),e.stopImmediatePropagation(),!n.state.editData&&n._handleOnDialogOpen({type:"leave"})},n._handleOnFilterChange=function(e){var t=n.state.filterObj,a=n.props,l=a.fetchRuleList,i=a.setProejctId,o={filterObj:(0,r.Z)({},t,e)};e.projectId&&(o.filterObj.projectIdList=[e.projectId],i({projectId:e.projectId})),n.setState(o,(function(){l(o.filterObj)}))},n._handleOnDialogConfirm=function(e){var t=n.props,a=t.updateHistoryRule,r=t.deleteRule,l=t.setRuleStatus,i=n.state.filterObj;switch(e.type){case"created":case"edited":n._handleOnEditTriggerClick(void 0),a({projectId:e.projectId,id:e.id,history:e.history?"Enable":"Disable",filterObj:i});break;case"delete":r({projectId:e.projectId,id:e.id,filterObj:i});break;case"stop":l({projectId:e.projectId,id:e.id,history:e.history?"Enable":"Disable",status:"Disable",filterObj:i});break;case"open":l({projectId:e.projectId,id:e.id,history:e.history?"Enable":"Disable",status:"Enable",filterObj:i});break;case"leave":n._handleOnEditTriggerClick(void 0)}},n._handleOnDialogCancel=function(e){var t=n.props.fetchRuleList;if("created"===e.type)n._handleOnEditTriggerClick(void 0),t()},n._handleOnDialogOpen=function(e){n.simpleDialogRef.showDialog(e)},n._handleOnEditTriggerClick=function(e){var t=n.props.ruleList,a=e?Object.keys(e).length>0?t.find((function(t){return t.id===e.id})):{}:void 0,r=[{title:"\u79c1\u4eba\u6d88\u606f\u5904\u7406\u89c4\u5219"}];a&&(r=[{title:"\u79c1\u4eba\u6d88\u606f\u5904\u7406\u89c4\u5219",url:"/personalSettings/privateMessageRule"},{title:a.id?"\u4fee\u6539\u89c4\u5219":"\u521b\u5efa",url:""}]),n.setState({editData:a,headerTitle:r})},n._handleOnBreadcrumbBeforeJump=function(e,t){n._handleOnDialogOpen({type:"leave",callback:function(){n._handleOnEditTriggerClick(void 0)}})},n.simpleDialogRef=void 0,n.filterConditionRef=void 0,n.state={headerTitle:[{title:"\u79c1\u4eba\u6d88\u606f\u5904\u7406\u89c4\u5219"}],contentWidth:0,folderData:[],filterObj:{projectIdList:[],status:null,smartFolderIdList:[]},editData:void 0,loading:!0},n.events={getDialogRef:function(e){return n.simpleDialogRef=e},onFilterChange:n._handleOnFilterChange,onDialogConfirm:n._handleOnDialogConfirm,onDialogCancel:n._handleOnDialogCancel,onDialogOpen:n._handleOnDialogOpen,onEditTriggerClick:n._handleOnEditTriggerClick,onBreadcrumbBeforeJump:n._handleOnBreadcrumbBeforeJump},n}(0,l.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this.props,n=t.fetchCondition,a=t.location.state,r=t.setProejctId,l=this.state.filterObj;if(a){r({projectId:a.projectId});var i=[a.folderName];this.setState({folderData:i},(function(){return n({folderData:i,callback:function(t){return e.setState({filterObj:t})}})}))}else n({filterObj:l,callback:function(t){return e.setState({filterObj:t})}});window.addEventListener("resize",this._handleWindowResize),window.addEventListener("popstate",this._handleWindowPoststate),this._handleWindowResize()},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.componentDidUpdate=function(e){!this.props.ruleListEffecting&&e.ruleListEffecting&&this.setState({loading:!1})},n.render=function(){return i.createElement(y.Provider,{value:{contentWidth:this.state.contentWidth,onDialogOpen:this._handleOnDialogOpen,onEditTriggerClick:this._handleOnEditTriggerClick}},i.createElement(W,(0,r.Z)({},this.props,this.state,this.events)))},t}(i.PureComponent);const U=(0,o.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,V);return(0,r.Z)({},n[B],{confitionEffecting:t.effects[B+"/fetchCondition"],ruleListEffecting:t.effects[B+"/fetchRuleList"]})}),(function(e){return{fetchRuleList:function(t){return e({type:B+"/fetchRuleList",payload:t})},fetchCondition:function(t){return e({type:B+"/fetchCondition",payload:t})},updateHistoryRule:function(t){return e({type:B+"/updateHistoryRule",payload:t})},deleteRule:function(t){return e({type:B+"/deleteRule",payload:t})},setRuleStatus:function(t){return e({type:B+"/setRuleStatus",payload:t})},setProejctId:function(t){return e({type:B+"/save",payload:t})}}}))(A)},24473:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(87462),r=n(63366),l=n(94578),i=n(67294),o=n(45697),c=n.n(o),s=n(94184),u=n.n(s),d=["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"],m=function(e){function t(){return e.apply(this,arguments)||this}return(0,l.Z)(t,e),t.prototype.render=function(){var e,t=this.props,n=t.prefixCls,l=t.children,o=t.className,c=t.block,s=t.indeterminate,m=t.value,p=t.checked,f=t.defaultChecked,h=t.onChange,g=t.disabled,v=(0,r.Z)(t,d),E={value:m,checked:p,defaultChecked:f,onChange:h,disabled:g},y=u()(n,((e={})[n+"-disabled"]=E.disabled,e[n+"-block"]=c,e[n+"-indeterminate"]=s,e),o);return i.createElement("label",(0,a.Z)({tabIndex:E.disabled?-1:0,className:y},v),i.createElement("input",(0,a.Z)({type:"checkbox",className:n+"-input"},E)),i.createElement("span",{className:n+"-status"}),l&&i.createElement("span",{className:n+"-text",title:l},l))},t}(i.Component);m.propTypes={prefixCls:c().string,value:c().oneOfType([c().string,c().number]),checked:c().bool,defaultChecked:c().bool,onChange:c().func,indeterminate:c().bool,disabled:c().bool,block:c().bool},m.defaultProps={prefixCls:"wt-checkbox"};const p=m},85151:(e,t,n)=>{n.d(t,{Jg:()=>a.Z,CS:()=>f});var a=n(24473),r=n(87462),l=n(63366),i=n(94578),o=n(67294),c=n(45697),s=n.n(c),u=n(94184),d=n.n(u),m=["prefixCls","children","className","onChange","values","checkedList","block"],p=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this).handleCheckBoxChange=function(e){var n=t.props.onChange;n&&n(e)},t}return(0,i.Z)(t,e),t.prototype.render=function(){var e,t=this,n=this.props,a=n.prefixCls,i=n.children,c=n.className,s=(n.onChange,n.values),u=n.checkedList,p=n.block,f=(0,l.Z)(n,m);return e=s?s.map((function(e,n){var a=0!==u.length&&-1!==u.indexOf(e);return o.createElement(Checkbox,{key:n,value:e,checked:a,onChange:function(e){return t.handleCheckBoxChange(e)},block:p},e)})):o.Children.map(i,(function(e,n){if(e){var a=e.props,r=a.value,l=0!==u.length&&-1!==u.indexOf(r);return o.cloneElement(e,{checked:l,key:n,block:a.block||p,onChange:function(){var e=a.value;t.handleCheckBoxChange(e)}})}})),o.createElement("div",(0,r.Z)({className:d()(a,c)},f),e)},t}(o.Component);p.defaultProps={prefixCls:"wt-checkbox-group"},p.propTypes={onChange:s().func,values:s().array,block:s().bool};const f=p;var h=function(e){var t={};return Object.keys(e).forEach((function(n){/^data\-.+$/.test(n)&&(t[n]=e[n])})),t},g=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this.props,t=h(e);return o.createElement("label",{className:e.className,title:e.children},o.createElement("div",{className:"checkbox"},o.createElement("input",(0,r.Z)({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),o.createElement("div",{className:"checkbox-body"})),"\xa0",o.createElement("span",null,e.children))},t}(o.Component);g.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},55815:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),r=n(67294),l=n(45697),i=n.n(l),o=n(43036),c=n(61409),s=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this)._handleBreadcrumbClick=function(e){var n=t.props,a=n.title,r=n.beforeJump;e!==a.length-1&&(r?new Promise((function(e,t){return r(e,t)})).then((function(){c.mW.push({pathname:a[e].url,state:a[e].state})})):c.mW.push({pathname:a[e].url,state:a[e].state}))},t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,a=t.mainTitle,l=t.rightContent,i=t.className,c=t.overlay;return r.createElement("div",{className:"breadcumb-wrapper "+i},n instanceof Array?r.createElement("div",{className:"breadcrumb-left"},r.createElement("div",null,n.map((function(t,a){return r.createElement("span",{className:t.url?"":"not_clickable",key:a,onClick:function(){return t.url&&a!==n.length-1&&e._handleBreadcrumbClick(a)}},t.title,a!==n.length-1&&" / ")}))),r.createElement("span",null,a||n[n.length-1].title,c&&r.createElement(o.Z,{placement:"top",overlay:c},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):r.createElement("div",{className:"normal-title"},n,c&&r.createElement(o.Z,{placement:"top",overlay:c},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),l||"")},t}(r.Component);s.propTypes={className:i().string,title:i().oneOfType([i().string,i().arrayOf(i().shape({title:i().string,url:i().string,state:i().object}))]).isRequired,overlay:i().oneOfType([i().string,i().node]),mainTitle:i().oneOfType([i().string,i().node]),beforeJump:i().func,rightContent:i().node};const u=s},58992:(e,t,n)=>{n.d(t,{Z:()=>h});var a=n(87462),r=n(94578),l=n(67294),i=n(92360),o=n(45697),c=n.n(o),s=n(38263),u=n(85151),d=[{label:"\u5305\u542b",value:"contain"},{label:"\u4e0d\u5305\u542b",value:"notContain"}];const m=function(e){var t=e.ruleGroup,n=e.formRef,a=e.groupIdx,r=e.editable,o=e.onSelectChange,c=e.onInputChange,m=e.onRuleItemDelete,p=e.onRuleGroupDelete,f=e.onRuleItemAdd,h=e.onActiveRuleCheckChange,g=(0===t.contain.length||""===t.contain[0])&&0===t.notContain.length,v=l.useState(g),E=v[0],y=v[1],C=l.useState(""),b=C[0],k=C[1];l.useEffect((function(){!E&&k(function(e,t){return(e?"\u4e00\u53e5\u8bdd\u4e2d":"\u5168\u6587\u4e2d")+"\uff1a"+["contain","notContain"].reduce((function(e,n){return t[n]&&t[n].length>0?[].concat(e,[("contain"===n?"\u5305\u542b":"\u4e0d\u5305\u542b")+t[n].map((function(e){return'<span style="color: #262626;">\u201c'+e+"\u201d</span>"})).join("\uff0c")]):e}),[]).join("\uff0c\u4e14")}(t.sentence,t))}),[E]);var N=t.contain.length+t.notContain.length,O=42*N+30+10;return l.createElement("div",{className:"content-rule-group"},l.createElement("div",{className:"content-rule-group-top"},l.createElement("span",{className:"show-icon",onClick:function(){E?function(e,t,n){var a=["contain","notContain"].reduce((function(n,a){return[].concat(n,e[a].map((function(e,n){return"rule-"+t+"-"+a+"-"+n})))}),[]),r=n[0],l=a.map((function(e){return new Promise((function(t,n){r?r.validateField(e,(function(e){null===e?t():n()})):n()}))}));return Promise.all(l)}(t,a,n).then((function(){y(!1)})):y(!0)}},l.createElement("i",{className:"icon-cem_pull-or-take-up",style:{transform:"rotate("+(E?-180:0)+"deg)"}})),l.createElement("span",{className:"content-rule-group-title"},E?l.createElement("span",{className:"group-title-check"},l.createElement(u.Jg,{checked:t.sentence,onChange:function(e){var t=e.currentTarget.checked;return h(a,t)}}),l.createElement("span",{style:{marginLeft:8}},"\u4ee5\u4e0b\u5173\u952e\u8bcd\u51fa\u73b0\u5728",l.createElement("span",{style:{color:"#262626"}},"\u201c\u4e00\u53e5\u8bdd\u201d"),"\u4e2d\u6761\u4ef6\u624d\u751f\u6548?")):l.createElement("span",{dangerouslySetInnerHTML:{__html:b}})),l.createElement("span",{className:"group-delete",onClick:function(){return p(a)}},l.createElement("i",{className:"icon-cem_delete"}))),l.createElement("div",{className:"content-rule-group-list",style:{height:E?O:0,paddingTop:E?10:0}},l.createElement("div",{className:"group-list "+(N>1?"mulit-group-list":"")},l.createElement("span",{className:"list-left"},l.createElement("span",{style:{fontSize:14}},"\u4e14")),l.createElement("span",{className:"list-right"},["contain","notContain"].map((function(e){return t[e]&&t[e].map((function(t,n){var u="rule-"+a+"-"+e+"-"+n;return l.createElement("div",{key:u,className:"content-rule-group-item"},l.createElement("span",null,l.createElement(s.ZP,{disabled:!r,value:d.find((function(t){return t.value===e})).label,onChange:function(e){return o(u,e)}},d.map((function(e){return l.createElement(s.Wx,{key:e.value,title:e.label},e.label)})))),l.createElement("span",{style:{height:42}},l.createElement(i.Form.Item,{prop:u},l.createElement(i.Input,{disabled:!r,value:t,onChange:function(e){return c(u,e)}}))),r&&l.createElement("span",{onClick:function(){return m(u)}},l.createElement("i",{className:"icon-cem_delete"})))}))})))),r&&l.createElement(l.Fragment,null,l.createElement("span",{className:"add-icon",onClick:function(){return f(a)}},l.createElement("i",{className:"icon-cem_add-to"})),l.createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"\u6dfb\u52a0\u65b0\u7684\u5173\u952e\u8bcd"))))};var p={contain:[""],notContain:[],sentence:!0,id:Math.round(1e4*Math.random())},f=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleOnRuleGroupAdd=function(){var e=n.state.content,t=[].concat(e,[JSON.parse(JSON.stringify(p))]);n.setState({content:t,formProps:n.getFormProps(t),hasChanged:!0})},n._handleOnRuleItemAdd=function(e){var t=n.state.content,a=n.props.onChange;if(t[e]){var r=JSON.parse(JSON.stringify(t));!r[e].contain&&(r[e].contain=[]),r[e].contain.push(""),n.setState({content:r,formProps:n.getFormProps(r),hasChanged:!0},(function(){return a&&a(r)}))}},n._handleOnRuleItemDelete=function(e){if(e){var t=n.state.content,a=n.props.onChange,r=e.split("-"),l=(r[0],r[1]),i=r[2],o=r[3];if(t[l]&&t[l][i]&&void 0!==t[l][i][o]){var c=JSON.parse(JSON.stringify(t));c[l][i].splice(o,1),0===c[l].contain.length&&0===c[l].notContain.length&&c.splice(l,1),n.setState({content:c,formProps:n.getFormProps(c),hasChanged:!0},(function(){return a&&a(c)}))}}},n._handleOnSelecChange=function(e,t){if(e&&t){var a=n.state.content,r=n.props.onChange,l=e.split("-"),i=(l[0],l[1]),o=l[2],c=l[3];if(a[i]&&a[i][o]&&void 0!==a[i][o][c]){var s=JSON.parse(JSON.stringify(a)),u=s[i][o].splice(c,1);s[i][t].push(u[0]),n.setState({content:s,formProps:n.getFormProps(s),hasChanged:!0},(function(){return r&&r(s)}))}}},n._handleOnInputChange=function(e,t){if(e){var a=n.state.content,r=n.props.onChange,l=e.split("-"),i=(l[0],l[1]),o=l[2],c=l[3];if(a[i]&&a[i][o]&&void 0!==a[i][o][c]){var s=JSON.parse(JSON.stringify(a));s[i][o][c]=t,n.setState({content:s,formProps:n.getFormProps(s),hasChanged:!0},(function(){return r&&r(s)}))}}},n._handleOnActiveRuleCheckChange=function(e,t){var a=n.state.content,r=n.props.onChange;if(a[e]){var l=JSON.parse(JSON.stringify(a));l[e].sentence=t,n.setState({content:l,hasChanged:!0},(function(){return r&&r(l)}))}},n._handleOnRuleGroupDelete=function(e){var t=n.state.content,a=n.props.onChange;if(t[e]){var r=JSON.parse(JSON.stringify(t));r.splice(e,1)&&n.setState({content:r,hasChanged:!0,formProps:n.getFormProps(r)},(function(){return a&&a(r)}))}},n.getValue=function(){return n.state.content},n.hasChanged=function(){return n.state.hasChanged},n.getFormProps=function(e){var t={model:{},rules:{}};return e&&e.length>0&&e.forEach((function(e,n){e&&["contain","notContain"].forEach((function(a){e[a]&&e[a].forEach((function(e,r){var l="rule-"+n+"-"+a+"-"+r;t.model[l]=e,t.rules[l]=[{required:!0,message:" ",trigger:"blur"}]}))}))})),t},n.mRefs=[],n.formRef=void 0;var r=(t.value||[p]).map((function(e){return(0,a.Z)({},e,{id:Math.round(1e4*Math.random())})}));return n.state={content:r,formProps:n.getFormProps(r),hasChanged:!1},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=e.value,n=this.props.value;JSON.stringify(t)!==JSON.stringify(n)&&this.setState({content:n,formProps:this.getFormProps(n)})},n.render=function(){var e=this,t=this.state,n=t.content,r=t.formProps,o=this.props,c=o.editable,s=void 0===c||c,u=o.className,d=void 0===u?"":u;return l.createElement("div",{className:"content-rule-wrapper "+d},l.createElement("span",{className:"content-rule-title"},"\u5185\u5bb9"),l.createElement("div",{className:"content-rule"},l.createElement(i.Form,(0,a.Z)({},r,{ref:function(t){e.formRef=t,e.mRefs.splice(0,e.mRefs.length),e.mRefs.push(t)}}),n.length>0&&l.createElement("span",{className:"content-rule-hint"},"\u6ee1\u8db3\u4efb\u610f\u4e00\u7ec4\u6761\u4ef6\uff0c\u8be5\u89c4\u5219\u5373\u751f\u6548"),n.map((function(t,n){return l.createElement(m,{key:t.id,formRef:e.mRefs,ruleGroup:t,groupIdx:n,editable:s,onSelectChange:e._handleOnSelecChange,onRuleGroupDelete:e._handleOnRuleGroupDelete,onInputChange:e._handleOnInputChange,onRuleItemDelete:e._handleOnRuleItemDelete,onRuleItemAdd:e._handleOnRuleItemAdd,onActiveRuleCheckChange:e._handleOnActiveRuleCheckChange})}))),s&&l.createElement(l.Fragment,null,l.createElement("span",{className:"add-icon",onClick:this._handleOnRuleGroupAdd},l.createElement("i",{className:"icon-cem_add-to"})),l.createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"\u6dfb\u52a0\u65b0\u7684\u6761\u4ef6"))))},t}(l.PureComponent);const h=f;f.propTypes={value:c().array,editable:c().bool,onChange:c().func,className:c().string}}}]);