"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[7515],{87515:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var n=a(94578),l=a(67294),o=a(92360),r=a(5133),i=a(29383),c=a(55815),s=a(66130),d=a(87462),u=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={defaultChecked:!1},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.setState((0,d.Z)({},this.props))},a.UNSAFE_componentWillReceiveProps=function(e){this.setState((0,d.Z)({},e))},a.handleClick=function(e){var t=this.state,a=t.type,n=t.defaultChecked,l=t.selectedList,o=t.totalList;if("checkAll"===a)n?this.props.onChange([]):this.props.onChange(o);else{var r=l.indexOf(e);r>-1?l.splice(r,1):l.push(e),this.props.onChange(l)}this.setState({defaultChecked:!n})},a.render=function(){var e=this,t=this.state,a=t.type,n=t.defaultChecked,o=t.indeterminate,r=t.uniqueId,i="customized-checkobx";return n?i="customized-checkobx checked":"checkAll"===a&&o&&(i="customized-checkobx indeterminate"),l.createElement("div",{className:"customized-checkobx-wrapper"},l.createElement("div",{className:i,onClick:function(t){t.stopPropagation(),e.handleClick(r)}}))},t}(l.PureComponent),p=a(49722),h=a(30381),f=a.n(h),m=a(35239),v="YYYY-MM-DD",g=f()().format(v),b=function(e){function t(t){var a;return(a=e.call(this,t)||this).handleDateChange=function(e){a.setState({date:e?e.format(v):g},(function(){return a.handleFetchData()}))},a.handleFetchData=function(){var e=a.state,t=e.projectId,n=e.date;a.setState({loading:!0},(function(){p.h.post("/store/data/list",{projectId:t,dateFilter:{from:n,to:n}}).then((function(e){if(2e4===e.data.code){var t=e.data.result.list;t.forEach((function(e,t){e.id=t,e.checked=!1})),a.setState({data:t,selectedList:[],checkAllStatus:{checked:!1,indeterminate:!1}})}})).finally((function(){a.setState({loading:!1})}))}))},a.handleCheckAll=function(){var e=a.state,t=e.data,n=[],l={};e.checkAllStatus.checked?(n=[],t.forEach((function(e){return e.checked=!1})),l={checked:!1,indeterminate:!1}):(n=t.map((function(e){return e.id})),t.forEach((function(e){return e.checked=!0})),l={checked:!0,indeterminate:!1}),a.setState({selectedList:n,data:t,checkAllStatus:l})},a.handleCheck=function(e){for(var t=a.state.data,n=0;n<t.length;n++)e.includes(t[n].id)?t[n].checked=!0:t[n].checked=!1;a.setState({data:t,selectedList:e,checkAllStatus:{checked:e.length===t.length,indeterminate:e.length>0&&e.length!==t.length}})},a.handleDownload=function(e){var t=a.state.projectId,n=e.platformId,l=e.dataPlatformId,o=e.from,r=e.to;p.h.post("/store/data/download",{projectId:t,platformId:n,dataPlatformId:l,dateFilter:{from:o,to:r}}).then((function(e){if(2e4===e.data.code){var t=e.data.result.url;window.open(t)}}))},a.handleDownloadByGroup=function(){var e=a.state,t=e.projectId,n=e.selectedList,l=e.data;if(n.length>0){for(var o=[],i=0;i<l.length;i++)if(n.includes(l[i].id)){var c=l[i],s=c.platformId,d=c.dataPlatformId,u=c.from,h=c.to;o.push({projectId:t,platformId:s,dataPlatformId:d,dateFilter:{from:u,to:h}})}p.h.post("/store/data/batch/download",o).then((function(e){if(2e4===e.data.code){var t=e.data.result.url;window.open(t)}}))}else r.Z.warning("\u8bf7\u9009\u62e9\u9700\u8981\u4e0b\u8f7d\u7684\u8bb0\u5f55")},a.state={projectId:m.t.get(m.V.curProject)&&m.t.get(m.V.curProject).id,date:g,loading:!1,data:[],pageIndex:1,pageSize:20,total:0,selectedList:[],checkAllStatus:{checked:!1,indeterminate:!1}},a}(0,n.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.handleFetchData()},a.render=function(){var e=this,t=this.state,a=t.data,n=t.selectedList,r=t.loading,d=t.checkAllStatus,p=[{label:"",prop:"paddingLeft",width:16},{label:"",width:56,renderHeader:function(t){return l.createElement(l.Fragment,null,l.createElement(u,{type:"checkAll",defaultChecked:d.checked,indeterminate:d.indeterminate,onChange:e.handleCheckAll}))},render:function(t){return l.createElement(u,{type:"checkOne",ref:function(a){return e["checkOne"+t.id]=a},defaultChecked:t.checked||!1,onChange:e.handleCheck,selectedList:n,totalList:a,uniqueId:t.id})}},{label:"\u7535\u5546\u5e73\u53f0",prop:"platformName"},{label:"\u6570\u636e\u5e73\u53f0",prop:"dataPlatformName"},{label:"\u5e97\u94fa\u6570",prop:"storeCount"},{label:"\u5df2\u91c7\u96c6",prop:"collectedCount"},{label:"\u91c7\u96c6\u4e2d",prop:"collectingCount"},{label:"\u672a\u91c7\u96c6",prop:"notReadyCount"},{label:"\u64cd\u4f5c",prop:"operation",render:function(t){return l.createElement("span",{className:"operation",onClick:function(a){a.preventDefault(),a.nativeEvent.stopImmediatePropagation(),e.handleDownload(t)}},"\u4e0b\u8f7d")}},{label:"",prop:"paddingRight",width:16}],h=document.documentElement.clientHeight-46-48-24;return l.createElement("div",{className:"data-export-wrapper"},l.createElement(c.Z,{title:"\u6570\u636e\u5bfc\u51fa",rightContent:l.createElement(o.Button,{type:"primary",onClick:this.handleDownloadByGroup},"\u6279\u91cf\u4e0b\u8f7d")}),l.createElement("div",{className:"data-export-body"},l.createElement("div",{style:{minHeight:h}},l.createElement("div",null,l.createElement("span",null,"\u91c7\u96c6\u65e5\u671f"),l.createElement(s.M,{getDateRange:this.handleDateChange})),l.createElement(o.Loading,{loading:r,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},l.createElement(i.Z,{rowClassName:function(e){return n.includes(e.id)?"item active":"item"},columns:p,data:a,total:a.length,currentPage:1,pageSize:100,notLimit:!0})))))},t}(l.Component)},55815:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(94578),l=a(67294),o=a(45697),r=a.n(o),i=a(43036),c=a(61409),s=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),l=0;l<a;l++)n[l]=arguments[l];return(t=e.call.apply(e,[this].concat(n))||this)._handleBreadcrumbClick=function(e){var a=t.props,n=a.title,l=a.beforeJump;e!==n.length-1&&(l?new Promise((function(e,t){return l(e,t)})).then((function(){c.mW.push({pathname:n[e].url,state:n[e].state})})):c.mW.push({pathname:n[e].url,state:n[e].state}))},t}return(0,n.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.title,n=t.mainTitle,o=t.rightContent,r=t.className,c=t.overlay;return l.createElement("div",{className:"breadcumb-wrapper "+r},a instanceof Array?l.createElement("div",{className:"breadcrumb-left"},l.createElement("div",null,a.map((function(t,n){return l.createElement("span",{className:t.url?"":"not_clickable",key:n,onClick:function(){return t.url&&n!==a.length-1&&e._handleBreadcrumbClick(n)}},t.title,n!==a.length-1&&" / ")}))),l.createElement("span",null,n||a[a.length-1].title,c&&l.createElement(i.Z,{placement:"top",overlay:c},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):l.createElement("div",{className:"normal-title"},a,c&&l.createElement(i.Z,{placement:"top",overlay:c},l.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),o||"")},t}(l.Component);s.propTypes={className:r().string,title:r().oneOfType([r().string,r().arrayOf(r().shape({title:r().string,url:r().string,state:r().object}))]).isRequired,overlay:r().oneOfType([r().string,r().node]),mainTitle:r().oneOfType([r().string,r().node]),beforeJump:r().func,rightContent:r().node};const d=s},66130:(e,t,a)=>{a.d(t,{M:()=>b,S:()=>S});var n=a(87462),l=a(94578),o=a(67294),r=a(45697),i=a.n(r),c=a(91751),s=a(98619),d=a.n(s),u=a(82784),p=a.n(u),h=a(30381),f=a.n(h),m=(a(83839),"YYYY-MM-DD");function v(e){if(!e)return!1;var t=f()();return e.valueOf()>t.valueOf()}var g=function(e){function t(t){var a;return(a=e.call(this,t)||this).onChange=function(e){a.setState({value:e},(function(){a.props.getDateRange(e)}))},a.onOpenChange=function(e){!a.state.disabled&&a.setState({open:e})},a.onFocus=function(){!a.state.open&&a.state.isMouseDown?a.setState({isMouseDown:!1}):a.setState({open:!0})},a.onMouseEnter=function(){var e=a.state,t=e.value,n=e.disabled;t&&!n&&a.setState({clearable:!0})},a.onMouseDown=function(){a.setState({isMouseDown:!0})},a.clearValue=function(){a.setState({value:null}),a.props.getDateRange("")},a.state={showDateInput:!0,disabled:t.disabled||!1,open:!1,value:t.defaultValue?t.defaultValue:f()(),clearable:!1},a}(0,l.Z)(t,e);var a=t.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){var t=this.props,a=t.disabled,n=t.disabledDate,l=t.defaultValue;JSON.stringify(l)!==JSON.stringify(e.defaultValue)&&this.setState({value:e.defaultValue}),JSON.stringify(n)!==JSON.stringify(e.disabledDate)&&this.setState({disabledDate:e.disabledDate}),a!==e.disabled&&this.setState({disabled:e.disabled})},a.render=function(){var e=this,t=this.state,a=t.showDateInput,l=t.value,r=t.open,i=t.disabled,s=t.clearable,u={showDateInput:!0,locale:p(),showOk:!1,showToday:!1,format:m,renderFooter:function(){return null}},h=o.createElement(c.Z,(0,n.Z)({},u,{dateInputPlaceholder:"\u8bf7\u9009\u62e9\u65e5\u671f",showDateInput:a,disabledDate:this.props.disabledDate||v,focusablePanel:!1}));return o.createElement(d(),{animation:"slide-up",calendar:h,value:l,onChange:this.onChange,onOpenChange:this.onOpenChange,open:r,style:{zIndex:1014}},(function(t){var a=t.value;return o.createElement("span",{className:"ant-calendar-picker ant-calendar-picker-default",tabIndex:"0",onMouseDown:e.onMouseDown,onFocus:e.onFocus,onMouseEnter:e.onMouseEnter,onMouseLeave:function(){return e.setState({clearable:!1})}},o.createElement("div",null,o.createElement("input",{placeholder:"\u8bf7\u9009\u62e9\u65e5\u671f",disabled:i,readOnly:!0,tabIndex:"-1",className:i?"ant-calendar-picker-input ant-input disabled":"ant-calendar-picker-input ant-input",value:a&&a.format(m)||""}),o.createElement("i",{className:"icon-cem_time-controller .ant-calendar-picker-icon",style:{visibility:s?"hidden":"visible"}}),o.createElement("i",{className:"icon-cem_close-window .ant-calendar-picker-icon",style:{visibility:s?"visible":"hidden"},onClick:function(t){i||(t.stopPropagation(),e.clearValue())}})))}))},t}(o.Component);g.propTypes={defaultValue:i().object,getDateRange:i().func.isRequired,disabledDate:i().func,disabled:i().bool};const b=g;var k=a(59108),y=a.n(k),E="YYYY-MM-DD";function C(e){return e?e.format(E):""}function D(e){return e&&e[0]&&e[1]}function w(e){return!!e&&f()().valueOf()<e.valueOf()}var S=function(e){function t(t){var a;return(a=e.call(this,t)||this).onChange=function(e){a.setState({value:e});var t=e.map((function(e){return C(e)}));a.props.getDateRange(t)},a.onHoverChange=function(e){a.setState({hoverValue:e})},a.onFocus=function(){!a.state.open&&a.state.isMouseDown?a.setState({isMouseDown:!1}):a.setState({open:!0})},a.onMouseDown=function(){a.setState({isMouseDown:!0})},a.onMouserEnter=function(){D(a.state.value)&&a.setState({clearable:!0})},a.clearValue=function(){a.setState({value:[]}),a.props.getDateRange(["",""])},a.state={disabled:!1,showDateInput:!1,value:t.defaultValue||[],hoverValue:[],clearable:!1},a}return(0,l.Z)(t,e),t.prototype.render=function(){var e=this,t=this.state,a=t.value,l=t.hoverValue,r=t.clearable,i=t.disabled,c=t.defaultValue,s={showDateInput:!1,locale:p(),showOk:!1,showToday:!1,format:E,renderFooter:function(){return null}},u=o.createElement(y(),(0,n.Z)({},s,{hoverValue:l,onHoverChange:this.onHoverChange,dateInputPlaceholder:["\u5f00\u59cb\u65e5\u671f","\u7ed3\u675f\u65e5\u671f"],defaultValue:c,disabledDate:w})),h=D(a);return o.createElement(d(),{animation:"slide-up",calendar:u,value:a,onChange:this.onChange},(function(t){var a=t.value;return o.createElement("span",{tabIndex:"0",className:"ant-calendar-picker",onMouseDown:e.onMouseDown,onFocus:e.onFocus},o.createElement("span",{className:"ant-calendar-picker-input ant-input",onMouseEnter:e.onMouserEnter,onMouseLeave:function(){e.setState({clearable:!1})}},o.createElement("input",{placeholder:"\u5f00\u59cb\u65e5\u671f",style:{width:130},disabled:i,readOnly:!0,tabIndex:"-1",className:"ant-calendar-range-picker-input",value:h&&""+C(a[0])||""}),o.createElement("span",null,"\u81f3"),o.createElement("input",{placeholder:"\u7ed3\u675f\u65e5\u671f",style:{width:130},disabled:i,readOnly:!0,tabIndex:"-1",className:"ant-calendar-range-picker-input",value:h&&""+C(a[1])||""}),o.createElement("i",{className:"icon-cem_time-controller",style:{visibility:h?"hidden":"visible"}}),o.createElement("i",{className:"icon-cem_close-window",style:{visibility:r?"visible":"hidden"},onClick:function(t){t.stopPropagation(),e.clearValue()}})))}))},t}(o.Component);S.propTypes={defaultValue:i().array,getDateRange:i().func.isRequired,disabledDate:i().func,disabled:i().bool}}}]);