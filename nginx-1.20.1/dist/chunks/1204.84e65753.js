"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1204],{31204:(e,t,n)=>{n.r(t),n.d(t,{default:()=>De});var a=n(63366),o=n(87462),r=n(94578),i=n(67294),l=n(55609),s=n(39432),c=n(35103),u=n(43036),d=n(45697),p=n.n(d),f=(n(53294),n(56697)),m=(n(43378),n(62443)),h=(n(89858),n(51024)),v=(n(75314),n(11187)),g=n(15861),y=n(87757),C=n.n(y),E=n(70715),w=function(e){var t=["#7262fd","#1890ff","#78d3f8","#60dda9"];return e.length?JSON.parse(JSON.stringify(e)).map((function(e,n){return e.keywords=e.keywords||[],e.isInput=!1,e.color=t[n],e})):[]},_=n(30133),x=n(7660),b=n(35239);const N=function(e){var t=e.comparisonItems,n=e.recordId,a=e.onChange,o=e.fetchingScreeningMap,r=(0,i.useState)(!1),l=r[0],s=r[1],c=(0,i.useState)(!1),d=c[0],p=c[1],y=(0,i.useState)(w(t)),N=y[0],T=y[1],k=(0,i.useState)(0),S=k[0],O=k[1],F=function(){var e=(0,g.Z)(C().mark((function e(t){var n;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:8===t.keyCode&&""===t.target.value&&null!=(n=N[S].keywords)&&n.length&&(N[S].keywords.pop(),T([].concat(N)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){b.t.get(b.V.comparisonItemsSession,"session")&&b.t.get(b.V.comparisonItemsSession,"session").length>0?(T(w(b.t.get(b.V.comparisonItemsSession,"session"))),e.save({comparisonItems:b.t.get(b.V.comparisonItemsSession,"session")})):(T(w(t)),e.save({comparisonItems:w(t)})),e.router.setRouteLeaveHook(e.route,(function(e){"/explore/free/result"!==e.pathname&&b.t.remove(b.V.comparisonItemsSession,"session")}))}),[S,l,d]),(0,i.useEffect)((function(){var e=document.querySelector(".rc-tag-input .input-area input");return e&&e.addEventListener("keydown",F),function(){e&&e.removeEventListener("keydown",F)}}),[N]);function I(){return i.createElement("div",{className:"overlay_box"},i.createElement("p",{className:"about_word",onClick:function(e){return D(e)}},i.createElement("i",{className:"icon-xiangguanci"}),"\u76f8\u5173\u8bcd"),N.length>1&&i.createElement("p",{className:"delete_word",onClick:function(e){return M(e,S)}},i.createElement("i",{className:"icon-cem_cancel"}),"\u5220\u9664"))}var D=function(e){e.stopPropagation(),s(!0),setTimeout((function(){var e=document.querySelector(".analyse_rc_input .rc-tag-input .input-area input");e&&(e.focus(),e.value="")}),10)},M=function(e,t){e.stopPropagation();var n=[].concat(N);1!==N.length&&(n.splice(t,1),T([].concat(n)),a(n,t))},R=function(){var e=(0,g.Z)(C().mark((function e(t,n){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),t.stopPropagation(),N.forEach((function(e,t){e.isInput=t===n})),e.next=5,T([].concat(N));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),P=N.length;return i.createElement("div",{className:"analyse_object_wrap"},o&&!n?i.createElement(_.Z,{paragraph:["40%"],className:"explore_res_skeleton"}):i.createElement("div",{className:"analyse_object"},N.map((function(e,o){return e.isInput?i.createElement("div",{className:"analyse_item",style:{width:100/(P+1)+"%"}},i.createElement(h.default,{className:"object_item_input",defaultValue:e.name,onBlur:function(e){return function(e,n){var o=t.find((function(t){return t.name===e.target.value}));if(!e.target.value)return N.forEach((function(e,t){e.isInput=!1})),void T([].concat(N));if(o&&e.target.value!==t[n].name)v.default.error("\u5df2\u5b58\u5728\u6b64\u5173\u952e\u8bcd!");else{if(e.target.value===t[n].name)return N.forEach((function(e,t){e.isInput=!1})),void T([].concat(N));N.forEach((function(t,a){t.isInput=!1,n===a&&(t.name=e.target.value)})),T([].concat(N)),a(N,n)}}(e,o)},autoFocus:!0,onFocus:function(e){!function(e){e.currentTarget.select()}(e)},onKeyUp:function(e){return function(e,n){if(e.stopPropagation(),13===e.keyCode)if(e.target.value){if(t.find((function(t){return t.name===e.target.value}))&&e.target.value!==t[n].name)return void v.default.error("\u5df2\u5b58\u5728\u6b64\u5173\u952e\u8bcd!");if(e.target.value===t[n].name)return N.forEach((function(e,t){e.isInput=!1})),void T([].concat(N));N.forEach((function(t,a){t.isInput=!1,n===a&&(t.name=e.target.value)})),T([].concat(N)),a(N,n)}else N.forEach((function(e,t){e.isInput=!1})),T([].concat(N))}(e,o)},onClick:function(e){e.stopPropagation()}})):i.createElement("div",{className:"analyse_item object_item"+(o+1),key:e.name,style:{width:100/(n?1:P>3?P:P+1)+"%"}},i.createElement("div",{onClick:function(e){return!n&&R(e,o)}},i.createElement("p",{className:"analyse_title",style:{marginTop:e.keywords&&e.keywords.length?"15px":"24px"}},e.name),e.keywords.length?i.createElement(m.default,{content:e.keywords.join("\u3001"),className:"about_words_tooltip",getPopupContainer:function(){return document.querySelector(".analyse_object_wrap .analyse_object")},placement:"bottomLeft"},i.createElement("p",{className:"about_word_tip",style:{display:e.keywords&&e.keywords.length?"block":"none"}},"\u76f8\u5173\u8bcd\uff1a",e.keywords.length,"\u4e2a")):"",!n&&i.createElement(u.Z,{title:"",overlay:I,placement:"bottom",getPopupContainer:function(){return document.querySelector(".analyse_object_wrap .analyse_object")},trigger:"click"},i.createElement("p",{className:"more",onClick:function(e){return function(e,t){e.stopPropagation(),O(t)}(e,o)}},i.createElement("i",{className:"icon-cem_new-more"})))))})),!n&&t.length<4&&(d?i.createElement("div",{className:"add_object",style:{width:100/(N.length+1)+"%"}},i.createElement(h.default,{autoFocus:!0,onBlur:function(e){return function(e){if(e.target.value){if(t.find((function(t){return t.name===e.target.value})))return p(!1),void v.default.error("\u5df2\u5b58\u5728\u6b64\u5173\u952e\u8bcd!");N.push({name:e.target.value,isInput:!1,keywords:[],id:N.length,color:E.EH[N.length]}),T([].concat(N)),a(N,N.length-1),p(!1)}else p(!1)}(e)},onKeyUp:function(e){return function(e){if(13===e.keyCode&&e.target.value){if(t.find((function(t){return t.name===e.target.value})))return void v.default.error("\u5df2\u5b58\u5728\u6b64\u5173\u952e\u8bcd!");N.push({name:e.target.value,isInput:!1,keywords:[],id:N.length,color:E.EH[N.length]}),T([].concat(N)),a(N,N.length-1),p(!1)}}(e)},className:"add_object_input"})):i.createElement("p",{className:"add_object",onClick:function(){p(!0)},style:{display:N.length>3?"none":"block",width:100/(N.length+1)+"%"}},"+ \u6dfb\u52a0\u5bf9\u6bd4"))),i.createElement(f.Z,{className:"analyse_object_modal",title:"\u7f16\u8f91\u76f8\u5173\u8bcd",visible:l,onOk:function(){T([].concat(N));var e=document.querySelector(".analyse_rc_input .rc-tag-input .input-area input");e&&N[S].keywords.length<10&&""!==e.value.trim()&&!N[S].keywords.includes(e.value.trim())&&(N[S].keywords=[].concat(N[S].keywords,[e.value.trim()]),T([].concat(N))),a(N,S),s(!1)},wrapClassName:"explore_about_word_modal",onCancel:function(){return N[S].keywords=t[S].keywords,T([].concat(N)),void s(!1)}},i.createElement(i.Fragment,null,i.createElement(x.EG,{classNameWrap:"analyse_rc_input",className:"rule_content "+(N[S]&&N[S].keywords.length?"active":""),tags:N[S]&&N[S].keywords,onAdd:function(e){var t=e.name;N[S].keywords.length<10&&""!==t.trim()&&!N[S].keywords.includes(t.trim())&&(N[S].keywords=[].concat(N[S].keywords,[t.trim()])),T([].concat(N))},createTagOnPress:[" ",13],placeholder:N[S]&&N[S].keywords.length?"":"\u8bf7\u8f93\u5165\u76f8\u5173\u8bcd\uff0c\u6309\u56de\u8f66\u952e\u53ef\u6dfb\u52a0\u591a\u4e2a\u5173\u952e\u8bcd",onDelete:function(e,t,n){N[S].keywords.splice(t,1),T([].concat(N))},onInputChange:function(e){}}),i.createElement("span",{className:"about_tips"},"* \u6700\u591a\u53ef\u8f93\u516510\u4e2a\u76f8\u5173\u8bcd"))))};var T=n(8201),k=n(98191),S=[{title:"\u6309\u5c0f\u65f6",value:"HOUR"},{title:"\u6309\u5929",value:"DAY"},{title:"\u6309\u5468",value:"WEEK"},{title:"\u6309\u6708",value:"MONTH"},{title:"\u6309\u5b63",value:"QUARTER"},{title:"\u6309\u5e74",value:"YEAR"}],O=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPanelWidth=function(){var e=n.props,t=e.flavor,a=e.options,o=Math.max.apply(null,a.map((function(e){return(0,s.jD)(e.title,14)})))+2+10+32;return(o+=void 0!==t?24:0)>100?o:100},n._setPadShowFalse=function(){n.state.show&&n.setState({show:!1})},n._handleParentClick=function(e){n.state.show&&n.props.showFlavor&&n.props.enable&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},n._handleTriggerOnClick=function(){var e=n.state.show;n.props.enable&&setTimeout((function(){n.setState({show:!e})}),0)},n.state={show:!1,firstLiHover:!1,panelWidth:n.getPanelWidth()},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},n.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},n.componentDidUpdate=function(e){var t=e.options,n=this.props.options;JSON.stringify(t)!==JSON.stringify(n)&&this.setState({panelWidth:this.getPanelWidth()})},n.render=function(){var e=this.state,t=e.show,n=e.panelWidth,a=this.props,o=a.activeObj,r=void 0===o?"":o,l=a.onChange,s=a.options,c=a.objName,d=a.preTitle,p=a.sufTitle,f=void 0===p?"":p,h=a.showTitle,v=void 0!==h&&h,g=a.overlay,y=a.divider,C=void 0===y?"right":y,E=a.flavor,w=a.className,_=void 0===w?"":w,x=a.onFlavorChange,b=a.sufIcon,N=a.style,T=a.type,k=void 0===T?"text":T,O=a.enable,F=a.iconType,I=a.rightHook,D=a.tips,M=s.find((function(e){return e.value===r})),R=""===r?f:M&&M.title;if(r){var P=S.find((function(e){return e.value===r}));R=P?P.title:r}return i.createElement("div",{className:"single-select-button-wrapper single_select_diviver_"+C+" single-select-button_"+k+" "+_,style:N,onClick:this._handleParentClick},i.createElement("div",{className:"button_content "+(O?"":"button_content_disable")},i.createElement("span",{onClick:this._handleTriggerOnClick},i.createElement("span",{className:"button-trigger "+(t?"sel":"")},v&&i.createElement(i.Fragment,null,d&&i.createElement("span",{className:"pre-title"},d,"\uff1a"),D?i.createElement(m.default,{content:D,placement:"top"},F?i.createElement("i",{className:F+" word_icon_hover "+("no"!==r?"active_light":"")}):i.createElement("span",{className:"button-title"},R)):F?i.createElement("i",{className:F+" word_icon_hover "+("no"!==r?"active_light":"")}):i.createElement("span",{className:"button-title"},R)),O&&i.createElement("i",{className:b||"icon-cem_pull-down-or-take-up",style:{transform:t?"rotate(-180deg)":""}})),g&&i.createElement("span",{style:{marginLeft:4}},i.createElement(u.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:g},i.createElement("i",{className:"icon-cem_file1"})))),i.createElement("div",{className:"button-panel "+(t?"active":""),style:{minWidth:n}},s.map((function(e,t){return i.createElement("div",{className:"panel-item "+(e.value===r?"sel":"")+" "+(e.disabled?"disabled":""),key:e.value,onClick:function(){var t;!e.disabled&&l(c?((t={})[c]=e.value,t):e.value)}},i.createElement("i",{className:e.icon+" panel-item-icon"}),i.createElement("span",{className:"ellipsis",style:{maxWidth:97.5}},e.title),void 0!==E&&i.createElement("i",{className:E===e.value?"icon-cem_star":"icon-cem_star-filling star_hide",onClick:function(t){var n,a,o;t.stopPropagation(),x(E===e.value?c?((n={})[c]="",n):"":c?((a={})[c]=e.value,a):e.value),l(c?((o={})[c]=e.value,o):e.value)}}),i.createElement("i",{className:e.value===r&&I?"icon-cem_right1 choice":""}))})))))},t}(i.PureComponent);O.defaultProps={enable:!0,activeObj:"",sufTitle:"",showTitle:!0,divider:"right",className:"",type:"text"},O.propTypes={activeObj:p().any,onChange:p().func.isRequired,options:p().array.isRequired,objName:p().any,preTitle:p().string,sufTitle:p().string,showTitle:p().bool,overlay:p().string,divider:p().oneOf(["both","left","right","none"]),flavor:p().string,onFlavorChange:p().func,className:p().string,sufIcon:p().string,style:p().object,type:p().oneOf(["button","text"]),enable:p().bool,iconType:p().bool};const F=O;var I=n(50976),D=n(94644),M=n(87300),R=[{title:"\u5de6\u56fe",value:"left"},{title:"\u53f3\u56fe",value:"right"},{title:"\u5168\u90e8",value:"all"},{title:"\u4e0d\u663e\u793a",value:"no"}],P={FREE_EXPLORE_MSG_COMMENT:"\u8bc4\u8bba\u6570\u91cf",FREE_EXPLORE_MSG_SERVICE:"\u4f1a\u8bdd\u6570\u91cf",FREE_EXPLORE_MSG_SELF:"\u63d0\u53ca\u6b21\u6570"};function Y(e,t){var n=t&&t.length>0&&t.map((function(e){return[e.comparisonItemName,e.total]})),a=e.map((function(e){return e.comparisonItemName})),o=["\u65e5\u671f"].concat(a),r=t&&t.length>0&&function(e){var t=e.map((function(e){return e.comparisonItemName})),n={};e.forEach((function(e){e.data.forEach((function(t){n[t.name]=n[t.name]||{},n[t.name][e.comparisonItemName]=t.count}))}));var a=[],o=function(e){var o=[e];t.forEach((function(t){return o.push(n[e][t])})),a.push(o)};for(var r in n)o(r);return t.unshift("\u65e5\u671f"),a.splice(0,0),a}(t);return{datasets:[{dimensions:["\u4e3b\u9898","\u6d88\u606f\u6570\u91cf"],source:n},{dimensions:o,source:r}]}}var V,L,j=function(e){var t=0;e.forEach((function(e){var n=parseFloat(e[1]);n>t&&(t=n)})),t=Math.ceil(t);for(var n=0;n<4;n++)t%4!==0&&t++;return 0===t&&(t=4),{intVal:t/4,maxVal:t}},W=function(e){var t=JSON.parse(JSON.stringify(e)),n=0,a=[];t.forEach((function(e){e.splice(0,1),a.push.apply(a,e)})),a.forEach((function(e){e>n&&(n=e)})),n=Math.ceil(n);for(var o=0;o<4;o++)n%4!==0&&n++;return 0===n&&(n=4),{intVal:n/4,maxVal:n}};const Z=function(e){var t=e.labelTypeFlavor,n=e.labelType,a=e.timeOptions,r=e.timeType,l=e.timeTypeFlavor,c=e.save,u=e._handleOnMsgClick,d=e.fetchBarOrLineData,p=e.chartData,f=e.setDefaultValue,h=e.recordId,v=e.selectValue,g=e.barLineLoading,y=(e.filterValue,e.expandParam.dateFilter),C=(0,i.useState)(void 0),w=C[0],_=C[1],x=b.t.get(b.V.curProject).id||"",N=function(e){if(w)if((0,T.P)(p)){var t=function(e,t,n,a,r,i,l){void 0===i&&(i="DAY");var c=Y(e,t).datasets;return{title:{text:n},dataset:c.map((function(e){return(0,o.Z)({},e,{sourceHeader:!1})})),legend:{left:18,top:46,itemWidth:10,itemHeight:12,itemGap:24,data:e.map((function(e){return e.comparisonItemName})).map((function(e){return{name:e,icon:"circle"}}))},grid:[{left:36,right:"62%",top:90,bottom:50,containLabel:!0},{left:"42%",top:90,right:80,bottom:50,containLabel:!0}],tooltip:{trigger:"axis",showDelay:20,hideDelay:0,className:"explore_line_tooltip",backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n      box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",confine:!0,enterable:!0,padding:0,formatter:function(e,t,n){var a=e[0],o=a.marker,c=a.name,u=a.value,d=a.seriesType;return setTimeout((function(){if("bar"===d)return n(t,(0,M.r)("<span style='position:relative;font-size: 12px;font-weight: 400;color:#8c8c8c;'>\u6d88\u606f\u6570\u91cf\n                <span style='position:absolute;width:30px;height:250px;top:-50px;left:-36px;'></span>\n                    <span style='position:absolute;width:30px;height:250px;top:-50px;right:-38px;'></span>\n                </span><br/>",['<div class="item_content_row" style="margin-bottom: 12px">'+o+" <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-right:50px;'>"+c+'</span>\n                    <span style="color: #262626">'+u+"</span>\n                  </div>"],[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return r(e[0],c)}}])),!0;e[0].axisValue;var a=e.map((function(e){var t=e.marker,n=e.seriesName,a=e.value;return{name:'\n              <div class="item_content_row" style="margin-bottom: 16px">\n                <span style=\'font-size: 12px;font-weight: 400;color:#8c8c8c;\'>'+t+n+'</span>\n                <span style="color: #262626">'+a+"</span>\n              </div>",value:a}})),p=a.sort((function(e,t){return t.value-e.value})).map((function(e){return e.name})),f="\n            <div>\n              <p style='font-size: 12px;font-weight: 400;color:#8c8c8c;'>\n              "+P[l]+"\n              </p>\n              <p style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-top:15px'>"+(0,s.Sn)(i,c)+"</p>\n            </div>\n          ";n(t,(0,M.r)(f,p))}),0)}},xAxis:[{type:"category",gridIndex:0,axisTick:{show:!0},axisPointer:{type:"none",label:{show:!1}},axisLabel:{color:"#626262"},data:e.map((function(e){return e.comparisonItemName}))},{type:"category",gridIndex:1,axisPointer:{type:"line",label:{show:!1}},boundaryGap:!1,axisLabel:{color:"#626262",formatter:function(t){return e&&e.length?(0,s.Sn)(i,t):t}},data:e[0].data.map((function(e){return{value:e.name}}))}],yAxis:[{type:"value",data:e.map((function(e){return e.data.map((function(e){return e.count}))})),axisTick:{length:4},axisLabel:{color:"#626262",formatter:function(e){return(0,s.hE)(e)}},max:j(c[0].source).maxVal,interval:j(c[0].source).intVal,splitNumber:4,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#999"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}},{type:"value",axisLabel:{show:!0,color:"#626262",formatter:function(e){return(0,s.hE)(e)}},data:e.map((function(e){return e.data.map((function(e){return e.count}))})),axisPointer:!1,max:W(c[1].source).maxVal,interval:W(c[1].source).intVal,splitNumber:4,gridIndex:1,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}}],series:[{type:"bar",barWidth:30,xAxisIndex:0,yAxisIndex:0,data:c&&c.length>0&&c[0].source&&c[0].source.map((function(e,t){return{name:e[0],value:e[1],itemStyle:{color:E.EH[t]},tooltip:{trigger:"item",formatter:function(e,t,n){var a=e.marker,o=e.name,i=e.value,l=e.seriesType;return setTimeout((function(){"bar"!==l||n(t,(0,M.r)("<span style='position:relative;font-size: 12px;font-weight: 400;color:#8c8c8c;'>\u6d88\u606f\u6570\u91cf\n                        <span style='position:absolute;width:30px;height:250px;top:-50px;left:-36px;'></span>\n                            <span style='position:absolute;width:30px;height:250px;top:-50px;right:-38px;'></span>\n                        </span><br/>",['<div class="item_content_row" style="margin-bottom: 12px">'+a+" <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-right:50px;'>"+o+'</span>\n                            <span style="color: #262626">'+i+"</span>\n                          </div>"],[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return r(e[0],o)}}]))}))}}}})),label:{show:!("left"!==a&&"all"!==a),position:"top",valueAnimation:!0,color:"#8c8c8c"}}].concat(t.map((function(e,t){return{type:"line",name:e.comparisonItemName,xAxisIndex:1,yAxisIndex:1,showSymbol:!0,symbolSize:1,datasetIndex:1,data:c[1].source.map((function(n){return{value:n[t+1],tooltip:{trigger:"item",formatter:function(t,n,a){return setTimeout((function(){var o=t.name,u=t.value,d=t.marker,p=t.seriesName,f="\n                  <div style='font-size: 12px;font-weight: 400;color:#8c8c8c;position:relative;'>\n                    <span> "+P[l]+"</span>\n                    <span style='position:absolute;width:30px;height:250px;top:-50px;left:-33px;'></span>\n                    <span style='position:absolute;width:30px;height:250px;top:-50px;right:-38px;'></span>\n                  </div><br/>\n                  <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;'>\n                    "+(0,s.Sn)(i,o)+"\n                  </span>\n                ",m=['\n                  <div class="item_content_row" style="margin-bottom: 12px">\n                    '+d+" <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-right:50px;'>"+e.comparisonItemName+'</span><span style="color: #262626">'+(0,s.hE)(u)+"</span>\n                  </div>"];a(n,(0,M.r)(f,m,[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return r(t,p,"",o,c[1].source)}}]))}),0)}}}})),itemStyle:{color:E.EH[t]},label:{show:!("right"!==a&&"all"!==a),position:"top",valueAnimation:!0,color:"#8c8c8c"}}})))}}(p,p,"\u4e3b\u9898\u5bf9\u6bd4",e,u,r=h?y.dateGroupType:r,v);w.clear(),w.setOption(t)}else _(void 0)};i.useEffect((function(){V=setTimeout((function(){if(w){clearInterval(V);var e=w._dom.children,t=e[0],n=e[1];t.addEventListener("mouseleave",(function(e){L=setTimeout((function(){L&&(n.style.display="none")}),1e3)})),n&&n.addEventListener("mouseenter",(function(e){L=void 0}))}}),200),N(n)}),[w,n,r,l,JSON.stringify(p)]);return i.createElement("div",{className:"yt_analyse_object_chart_wrapper"},i.createElement(T.Z,{className:"yt_analyse_object_chart",loading:g,data:p,renderTitle:i.createElement(k.Z,{title:"\u4e3b\u9898\u5bf9\u6bd4",data:p,onMoreClick:function(){}},i.createElement(F,{options:a,activeObj:r,flavor:l,showTitle:!0,rightHook:!0,enable:!h,onChange:function(e){return function(e){c({timeType:e}),d({projectId:x})}(e)},onFlavorChange:function(e){return function(e){f(e===l?{timeTypeFlavor:""}:{timeTypeFlavor:e})}(e)}}),i.createElement(F,{options:R,activeObj:n,flavor:t,tips:"\u663e\u793a\u56fe\u8868\u6807\u7b7e",iconType:"icon-tubiaobiaoqian",rightHook:!0,onChange:function(e){return function(e){c({labelType:e}),N(n)}(e)},onFlavorChange:function(e){return function(e){f(t===e?{labelTypeFlavor:""}:{labelTypeFlavor:e})}(e)}}),i.createElement("div",{className:"export_icon"},i.createElement(m.default,{content:"\u5bfc\u51fa\u6570\u636e"},i.createElement("i",{className:"icon-daochu",onClick:function(){!function(e,t){var n=Y(e,t).datasets,a=[n[0].dimensions].concat(n[0].source),o=[n[1].dimensions].concat(n[1].source),r=[].concat(a,[[""]]),i=[].concat(o,[[""]]);(0,D.aT)([r,i],"\u4e3b\u9898\u5bf9\u6bd4")}(p,p)}})),i.createElement(m.default,{content:"\u5bfc\u51fa\u56fe\u7247"},i.createElement("i",{className:"icon-xiazaitupian",onClick:function(){return function(e){(0,D._v)(e,"\u4e3b\u9898\u5bf9\u6bd4")}(w)}}))))},i.createElement(I.Z,{theme:"yt_multi_color_4",className:"yt_echarts_style",option:{},style:{width:"100%",height:"100%"},onChartReady:function(e){return _(e)}})))};var A=[{title:"Top10",value:"10"},{title:"Top20",value:"20"},{title:"Top30",value:"30"},{title:"Top50",value:"50"},{title:"Top100",value:"100"}],H=[{title:"\u5355\u8272\u8bcd\u4e91",value:"0",icon:"icon-cem_cloud-new"},{title:"\u591a\u8272\u8bcd\u4e91",value:"1",icon:"icon-duoseciyun"},{title:"\u8868\u683c",value:"2",icon:"icon-biaoge1"}],J=[{title:"\u8bcd\u4e91",value:"0",icon:"icon-ciyunxuanze"},{title:"\u8868\u683c",value:"1",icon:"icon-biaoge1"}],q=n(18077),z=0,U=function(e,t,n){setTimeout((function(){var a={type:t,seriesIndex:0,seriesName:"overview-wordcloud"};n&&(a.name=n),e.dispatchAction(a)}),0)},B=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnMouseOver=function(e){var t=e.componentType,a=e.componentSubType,o=e.name;n.shouldNotCallOutside=!0,"series"===t&&"wordCloud"===a&&(U(n.wordcloudRef,"downplay",o),U(n.wordcloudRef,"showTip",o))},n._handleOnMouseOut=function(e){var t=e.componentType,a=e.componentSubType;n.shouldNotCallOutside=!0;var o=n.state.hightlightNames;"series"===t&&"wordCloud"===a&&(U(n.wordcloudRef,"downplay",void 0),o&&U(n.wordcloudRef,"highlight",o),U(n.wordcloudRef,"hideTip",void 0))},n._resize=function(){n.shouldNotCallOutside=!1},n._handleFinished=function(){n.shouldNotCallOutside||(!n.lastFinishTimeoutId&&n.props.onReady(!1),n.lastFinishTimeoutId&&clearTimeout(n.lastFinishTimeoutId),n.lastFinishTimeoutId=setTimeout((function(){n.props.onReady(!0),n.lastFinishTimeoutId=void 0}),100))},n.wordcloudRef,n.lastFinishTimeoutId=void 0,n.shouldNotCallOutside=!1,n.state={hightlightNames:void 0},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e){var t=this,n=e.data,a=e.top,o=this.props,r=o.data,i=o.top;if(a!==i||JSON.stringify(n)!==JSON.stringify(r)){var l=void 0;if(0!==i){l=[];for(var s=r.length-1;s>=i;s--)l.push(r[s].name)}this.setState({hightlightNames:l},(function(){U(t.wordcloudRef,"downplay",void 0),l&&U(t.wordcloudRef,"highlight",l)}))}},n.componentDidMount=function(){window.addEventListener("resize",this._resize)},n.componentWillUnmount=function(){window.removeEventListener("resize",this._resize)},n.render=function(){var e=this,t=this.props,n=t.option,a=t.getRef,o=t.style,r=t.colorType;return i.createElement(I.Z,{theme:"0"===r?"":"yt_multi_color_10",option:n,style:o,onChartReady:function(t){a(t),e.wordcloudRef=t}})},t}(i.PureComponent);const G=B;var X=n(60496),K=n(92360),Q={n:"#729EF8",a:"#F6903D",un:"#60DDA9"},$={n:"\u540d\u8bcd",a:"\u5f62\u5bb9\u8bcd",un:"\u5176\u4ed6"};const ee=function(e){var t=e.data,n=e.style,a=e.getRef,o=e.title,r=e.changeTopTable,l=e.wordCloudTotal,s=(0,i.useState)(1),c=s[0],d=s[1];i.useEffect((function(){d(1)}),[r]);var p=t.slice(40*(c-1),40*c);p.reduce((function(e,t){return e+t.total}),0);return i.createElement("div",{className:"explort_wordlist-wrapper",style:n,ref:a},i.createElement("div",{className:"title"},o),i.createElement("div",{className:"list"},p.map((function(e,t){var n,a=t+1+40*(c-1),o=e.pos?Q[e.pos]:a<11?E.Fq[t%E.Fq.length]:"#8c8c8c";return i.createElement(u.Z,{key:e.name+"_"+t,placement:"top",overlay:i.createElement(i.Fragment,null,i.createElement("div",{dangerouslySetInnerHTML:{__html:(n=o,'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+n+';"></span> '+e.name)}}),e.pos&&i.createElement("div",null,"\u8bcd\u6027\uff1a"+$[e.pos]))},i.createElement("div",{className:"item"},i.createElement("span",{className:"index "+(100===a?"last_item":""),style:{background:o}},a),i.createElement("span",{className:"name"},e.name),i.createElement("span",{className:"total"},""+(e.total/l*100).toFixed(2))))}))),i.createElement("div",{className:"pagination"},i.createElement(K.Pagination,{layout:"prev, pager, next",small:!0,total:t.length,pageSize:40,currentPage:c,onCurrentChange:function(e){return d(e)}})))};var te=n(18446),ne=n.n(te),ae=[{nounCount:!1},{adjCount:!1},{unCount:!1}],oe=[{nounColor:"#729EF8"},{adjColor:"#F6903D"},{unColor:"#60DDA9"}],re=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleOnMoreClick=function(e){var t=n.props,a=t.name,o=t.data,r=t.selectValue,i=t.enablePos,l=t.wordCloudModal,s=t.modal,c=t.wordCloudTotal;if("image"===e&&n.chartRef&&"2"!==l&&"1"!==s)(0,D._v)(n.chartRef,a);else if("image"===e&&n.getTableRef)(0,D.Mx)(n.getTableRef,a);else if("data"===e&&(0,T.P)(o)){var u=["\u70ed\u8bcd","\u70ed\u5ea6"];"FREE_EXPLORE_MSG_SERVICE"===r&&(u=["\u70ed\u8bcd","\u70ed\u5ea6"]),i&&u.splice(1,0,"\u8bcd\u6027");var d=o.reduce((function(e,t){return[].concat(e,[[].concat(u.map((function(e){var n;return"\u70ed\u8bcd"===e?n=t.name:"\u8bcd\u6027"===e&&i?n="n"===t.pos?"\u540d\u8bcd":"a"===t.pos?"\u5f62\u5bb9\u8bcd":"un"===t.pos?"\u5176\u4ed6":"":"\u70ed\u5ea6"===e&&(n=(t.total/c*100).toFixed(2)),n})))])}),[u]);(0,D.aT)([d],"\u70ed\u8bcd\u5206\u6790")}},n.handleCustomLegend=function(e){void 0===e&&(e="");var t=n.state.showTag;if("n"===e)if(ae[0].nounCount=!ae[0].nounCount,oe[0].nounColor=ae[0].nounCount?"#e5e5e5":"#729EF8",-1!==t.indexOf("nounCount")){var a=t.indexOf("nounCount");t.splice(a,1),n.setState({showTag:t})}else t.push("nounCount"),n.setState({showTag:t});else if("a"===e)if(ae[1].adjCount=!ae[1].adjCount,oe[1].adjColor=ae[1].adjCount?"#e5e5e5":"#F6903D",-1!==t.indexOf("adjCount")){var o=t.indexOf("adjCount");t.splice(o,1),n.setState({showTag:t})}else t.push("adjCount"),n.setState({showTag:t});else if("un"===e)if(ae[2].unCount=!ae[2].unCount,oe[2].unColor=ae[2].unCount?"#e5e5e5":"#60DDA9",-1!==t.indexOf("unCount")){var r=t.indexOf("unCount");t.splice(r,1),n.setState({showTag:t})}else t.push("unCount"),n.setState({showTag:t})},n.handLegendData=function(e,t){void 0===t&&(t=[]);var a=n.props,r=a.onChartClick,i=a.name,l=(a.selectValue,a.color),s=a.enablePos,c=a.wordCloudTotal,u=a.onWordModalView,d=(0,T.P)(e)?function(e,t,n,a,r,i,l,s,c,u,d){var p=[];c&&"empty"!==c&&c.length&&(p=c.map((function(e){return e.pos})));var f={color:s,title:{top:16,left:19,text:r?"\u70ed\u8bcd-"+r:"\u70ed\u8bcd",textStyle:{color:"#262626",fontSize:14,fontFamily:""+E.I8,fontWeight:"bold"}},graphic:[{type:"group",top:60,left:40,silent:!1,children:[{type:"circle",id:"1",left:p.includes("n")?z+=5:0,ignore:!(p.includes("n")&&i),shape:{cx:5,cy:4,r:5},style:{fill:""+(a[0]&&a[0].nounColor)},onclick:function(){return n("n")}},{type:"text",left:p.includes("n")?z+=18:0,ignore:!(p.includes("n")&&i),style:{text:"\u540d\u8bcd",font:"bolder 12px "+E.I8,fill:a[0]&&"#729EF8"===a[0].nounColor?"#262626":"#e5e5e5"},onclick:function(){return n("n")}},{type:"circle",id:"2",left:p.includes("a")?p.includes("n")?z+=42:5:0,ignore:!(p.includes("a")&&i),shape:{cx:5,cy:4,r:5},style:{fill:""+(a[1]&&a[1].adjColor)},onclick:function(){return n("a")}},{type:"text",left:p.includes("a")?p.includes("n")?z+=18:23:0,ignore:!(p.includes("a")&&i),style:{text:"\u5f62\u5bb9\u8bcd",font:"bolder 12px "+E.I8,fill:a[1]&&"#F6903D"===a[1].adjColor?"#262626":"#e5e5e5"},onclick:function(){return n("a")}},{type:"circle",id:"3",left:p.includes("un")?p.includes("n")&&p.includes("a")||!p.includes("n")&&p.includes("a")?z+=52:p.includes("n")&&!p.includes("a")?z+=42:5:0,ignore:!(p.includes("un")&&i),shape:{cx:5,cy:4,r:5},style:{fill:""+(a[2]&&a[2].unColor)},onclick:function(){return n("un")}},{type:"text",left:p.includes("un")?p.includes("n")&&p.includes("a")||p.includes("n")||p.includes("a")?z+=18:23:0,ignore:!(p.includes("un")&&i),style:{text:"\u5176\u4ed6",font:"bolder 12px "+E.I8,fill:a[2]&&"#60DDA9"===a[2].unColor?"#262626":"#e5e5e5"},onclick:function(){return n("un")}}]}],tooltip:{showDelay:100,hideDelay:0,transitionDuration:0,enterable:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n      box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",formatter:function(e,n,a){var o=e.data,i=o.name,l=o.total,s=o.positiveCount,c=o.negativeCount,p=o.neutralCount,f=o.pos,m=e.marker;return setTimeout((function(){(c/l*100).toFixed(2),(p/l*100).toFixed(2),(s/l*100).toFixed(2);var o=(0,q.v)({onOk:function(){return d(i)}});a(n,(0,M.r)("\n              <div style='position:relative;'>\n                <div class=\"title_circle\">"+m+"<span>"+i+'</span></div>\n                <span style="color: #262626">'+(l/u*100).toFixed(2)+"</span>\n                "+o+"\n                <span style='position:absolute;width:30px;height:140px;top:-50px;left:-36px;'></span>\n                    <span style='position:absolute;width:30px;height:140px;top:-50px;right:-38px;'></span>\n              </div>\n              ",[],[{title:"\u6d88\u606f",icon:"icon-cem_jump-message",callback:function(){return t(e,r,{name:i,pos:f})}}]))}),0)}},series:[{type:"wordCloud",name:"overview-wordcloud",gridSize:12,sizeRange:[16,50],rotationRange:[0,0],width:"100%",height:"90%",data:e&&e.map((function(e){return(0,o.Z)({},e,{name:e.name,value:Math.sqrt(e.total),escore:[-1,0,1]})})),textStyle:{normal:{color:function(e){switch(e.data.pos){case"n":return"#729EF8";case"a":return"#F6903D";case"un":return"#60DDA9"}}},emphasis:{color:"#D8D8D8"}}}]};return i||delete f.series[0].textStyle.normal,f}(e,r,n.handleCustomLegend,oe,i,s,0,l,t,c,u):{};return d},n.shouldComponentUpdate=function(e,t){return e.loading!==n.props.loading||ne()(t.showTag,n.state.showTag)||!ne()(e.item,n.props.item)},n.state={showTag:["nounCount","adjCount","unCount"],setTopActive:!1,setWordActive:!1,setCloudActive:!1,changeTopTable:""},n}return(0,r.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.data,a=t.modal,o=t.wordCloudModal,r=t.enablePos,l=t.recordId,s=t.onChange,c=t.name,u=t.loading,d=t.onWordFlavorChange,p=t.wordCloudFlavor,f=t.topN,h=t.wordCloudTotal,v=this.state.showTag,g={};if(r){var y={n:"nounCount",a:"adjCount",un:"unCount"},C="empty"!==n&&n.filter((function(e){return v.includes(y[e.pos])}));g=this.handLegendData(C,n)}else g=this.handLegendData(n);return i.createElement(T.Z,{className:"yt_explore_word_analysis_chart_wrapper",data:n,loading:u,renderTitle:i.createElement(k.Z,{data:n,onMoreClick:this.handleOnMoreClick,popoverOption:"open",title:"\u70ed\u8bcd-"+(c||""),titleOverlay:"\u70ed\u8bcd\u662f\u6839\u636e\u5173\u952e\u8bcd\u70ed\u5ea6\u800c\u5f97\u51fa\uff0c\u5173\u952e\u8bcd\u70ed\u5ea6\u8ddf\u8bcd\u9891\u548c\u91cd\u8981\u7a0b\u5ea6\u6709\u5173\u3002\u5173\u952e\u8bcd\u70ed\u5ea6\u503c\u57281-100\u4e4b\u95f4\u3002"},l?i.createElement(i.Fragment,null,i.createElement("div",{className:"top_title"},i.createElement("span",null,"TOP"+f))):i.createElement(X.Z,{className:this.state.setTopActive?"set_Top_active":"",options:A,activeObj:f,flavor:p.topN||null,rightHook:!0,onFlavorChange:function(e){d({topN:e})},onChange:function(t){e.setState({setTopActive:!0,changeTopTable:t}),s({topN:t})}}),i.createElement(i.Fragment,null,i.createElement("div",{style:{display:l?"none":"block"}},r?i.createElement(X.Z,{className:this.state.setWordActive?"set_word_active":"",options:J,activeObj:a,flavor:p.modal||null,rightHook:!0,onFlavorChange:function(e){d({modal:e})},onChange:function(t){e.setState({setWordActive:!0}),s({modal:t})}}):i.createElement(X.Z,{className:this.state.setCloudActive?"set_cloud_active":"",options:H,activeObj:o,flavor:p.wordCloudModal||null,rightHook:!0,onFlavorChange:function(e){d({wordCloudModal:e})},onChange:function(t){e.setState({setCloudActive:!0}),s({wordCloudModal:t})}}))),i.createElement(m.default,{content:"\u8bcd\u6027\u533a\u5206",placement:"top",mouseEnterDelay:.2},i.createElement("i",{style:{display:l?"none":"block",color:r?"#7262fd":"#8c8c8c"},className:"icon-cixingqufen icon_type",onClick:function(e){e.stopPropagation(),s({enablePos:!r,modal:J[0].value,wordCloudModal:H[0].value})}})))},"2"===o||"1"===a?(0,T.P)(n)&&i.createElement(ee,{getRef:function(t){return e.getTableRef=t},data:n,changeTopTable:this.state.changeTopTable,title:"\u70ed\u8bcd-"+(c||""),wordCloudTotal:h}):(0,T.P)(n)&&i.createElement(G,{data:n,getRef:function(t){return e.chartRef=t},option:g,colorType:o,style:{width:"100%",height:"100%"}}))},t}(i.Component);function ie(e){var t=[];return e.forEach((function(e){e.values.forEach((function(e){t.push(e.label+"\uff1a"+function(e){if(e.some((function(e){return e.label})))return e.map((function(e){return e.label}));var t="\u4ecb\u4e8e",n=e.map((function(e,n){return t=0!==n||e.id?1!==n||e.id?t:"\u5927\u4e8e":"\u5c0f\u4e8e",e.id?Number(e.id):""}));return""+t+n[0]+("\u4ecb\u4e8e"===t?"~":"")+n[1]}(e.values))}))})),t}var le={FREE_EXPLORE_MSG_COMMENT:"\u7535\u5546\u8bc4\u8bba",FREE_EXPLORE_MSG_SERVICE:"\u5ba2\u670d\u4f1a\u8bdd",FREE_EXPLORE_MSG_SELF:"\u5185\u5bb9\u7535\u5546"},se=function(e){var t=e.comparisonItems,n=e.wordCloudFlavor,a=e.filterReady,r=e.filterValue,l=e.filterChange,d=e.onSaveButtonClick,p=e.selectValue,f=e.filterId,m=e.recordId,h=e.recordName,v=e.onWordCloudChange,g=e.onKeyWordChange,y=e.fetchingIndex,C=e.onWordFlavorChange,E=e.getFilterRef,w=e.expandParam,_=e.touchData,x=e._handleOnMsgClick,b=e.findTouchSpotByAccountId,T=e.fetchWordCloud,k=w.dateFilter,S=w.messageCategory,O=e.allWordCloudList;O=O&&O.filter((function(e,n){return t&&t.length>0&&t[n]}));var F=i.useState({visible:!1,word:""}),I=F[0],D=F[1],M=(0,i.useCallback)((function(e){D({visible:!0,word:e})}),[]),R=(0,i.useCallback)((function(e){D({visible:e,word:""});var n=t.length;!function e(t){return T({index:t}).then((function(a){t<n-1&&e(t+1)}))}(0)}),[]);return i.createElement("div",{className:"explore_pageview_container"},i.createElement(c.Z,{pageType:p,filterId:f,recordId:m,onReady:a,onChange:l,touchData:_,selectValue:p,showList:["fullDate","sourceSearch","screening","save"],isNotShowHeaderButton:!0,advanceAuthority:!1,hasHour:!0,ref:E,filterDateFilter:r&&r.dateFilter||{},comparisonItems:t,findTouchSpotByAccountId:b,rightContent:i.createElement("div",{className:"header_Filter_right_wrap_save",onClick:d},i.createElement(u.Z,{overlay:"\u4fdd\u5b58\u63a2\u7d22\u7ed3\u679c",placement:"bottom",mouseEnterDelay:.2},i.createElement("i",{className:"icon-baocun"}))),valueConf:["fullInfo"]},m&&i.createElement("div",{className:"explore_result_filter"},i.createElement("div",{className:"filter_time"},i.createElement("p",{className:"filter_title"},"\u7ed3\u679c\u540d\u79f0\uff1a",h)),i.createElement("div",{className:"filter_time"},i.createElement("p",{className:"filter_title"},"\u7b5b\u9009\u65f6\u95f4\uff1a",(0,s.B1)(k.from),"~",(0,s.B1)(k.to,!0))),i.createElement("div",{className:"filter_result "+(ie(w.expandParam.filterValue).length?"has_value":"")},i.createElement("div",{className:"filter_result_title"},i.createElement("span",{className:"filter_title"},"\u7b5b\u9009\u6761\u4ef6\uff1a")),i.createElement("div",{className:"filter_result_content"},i.createElement("p",null,"\u6570\u636e\u7c7b\u578b\uff1a",le[S]),ie(w.expandParam.filterValue).map((function(e){return i.createElement("p",{key:e},e)}))))),i.createElement("div",{className:"explore_result_view"},i.createElement(i.Fragment,null,i.createElement(N,(0,o.Z)({},e,{onChange:g})),i.createElement(Z,e)),i.createElement(i.Fragment,null,p&&t&&t.length>0&&O&&O.map((function(a,r){return i.createElement(re,(0,o.Z)({key:r,item:a},e,{loading:y===r,name:t[r]?t[r].name:"",color:t[r]?t[r].color:"",data:a&&a.data,enablePos:a&&a.enablePos,modal:a&&a.modal,wordCloudModal:a&&a.wordCloudModal,topN:a&&a.topN,onChange:function(e){return v(r,e)},wordCloudFlavor:n[r]||{},recordId:m,selectValue:p,onWordFlavorChange:function(e){return C(r,e)},onChartClick:x,wordCloudTotal:a&&a.wordCloudTotal,onWordModalView:M}))})))),i.createElement(q.Z,{visible:I.visible,word:I.word,onClose:R})))};se.propTypes={onChartClick:p().func.isRequired};const ce=se;var ue=n(64396),de={FREE_EXPLORE_MSG_COMMENT:"COMMENT",FREE_EXPLORE_MSG_SERVICE:"SERVICE",FREE_EXPLORE_MSG_SELF:"SELF"};var pe=n(57522),fe=n(5133),me=n(23570),he=n(49722),ve=120,ge=function(e){var t=e.projectId,n=e.messageCategory,a=e.comparisonItems,o=e.dateFilter,r=e.filterModel,l=e.wordCountConfigs,s=e.headerFilterParamsNew,c=e.trendResult,u=e.wordCountResult,d=e.setParams,p=e.expandParam,f=e.count,m=i.useState(name||""),h=m[0],v=m[1],g=i.useState(!0),y=g[0],C=g[1],E=i.useState(""),w=E[0],_=E[1],x=function(e){return h===name?(e({result:"faild"}),!1):h?f>=50?(fe.Z.warning("\u60a8\u5df2\u4fdd\u5b5850\u4e2a\u63a2\u7d22\u7ed3\u679c\uff0c\u5df2\u8fbe\u4e0a\u9650\uff0c\u8bf7\u5148\u5220\u9664\u90e8\u5206\u63a2\u7d22\u7ed3\u679c\u518d\u4fdd\u5b58\u65b0\u63a2\u7d22\u7ed3\u679c"),!1):(function(e,t){he.h.post("/freeExploring/index/searchRecord/add",e).then((function(e){var n=e.data;2e4===n.code&&(t({result:"success"}),fe.Z.success(n.msg))})).catch((function(e){}))}({projectId:t,messageCategory:n,comparisonItems:a,dateFilter:o,headerFilterParamsNew:s,recordName:h,filterModel:r,wordCountConfigs:l,trendResult:c,wordCountResult:u,expandParam:p},e),!1):(_("\u8f93\u5165\u6846\u4e0d\u80fd\u4e3a\u7a7a"),C(!1),!1)};i.useEffect((function(){d({recordName:h,confirmRun:x}),!y&&h&&h.length<=ve&&C(!0)}),[h]);return i.createElement("div",{className:"filter_saved_edit_dialog_wrapper"},i.createElement("span",null,"\u540d\u79f0"),i.createElement("span",{className:y?"":"required_error",style:{position:"relative"}},i.createElement(me.Z,{className:"content_item_input",defaultValue:h,placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",onChange:function(e){var t=e.target.value;""===t.trim()?(_("\u8f93\u5165\u6846\u4e0d\u80fd\u4e3a\u7a7a"),C(!1)):ve<=t.length?(_("\u6700\u591a\u53ea\u80fd\u8f93\u5165120\u4e2a\u5b57\u7b26"),C(!1)):(_(""),C(!0)),v(t)},onBlur:function(e){var t=e.target.value;""===t.trim()?(_("\u8f93\u5165\u6846\u4e0d\u80fd\u4e3a\u7a7a"),C(!1)):t.length===ve&&(_(""),C(!0))},maxLength:ve}),i.createElement("span",{className:"tip_text"},w)))};const ye=ge;ge.propTypes={name:p().string};const Ce={edit:function(e){var t=(0,o.Z)({},e,{showClose:!1,content:i.createElement(ye,e)});return t.onOk?(0,pe.Z)(t):new Promise((function(e,n){t.onOk=e,t.onCancel=n,(0,pe.Z)(t)}))}};var Ee=n(97189),we=n(2786),_e=n(18784),xe=n(30381),be=n.n(xe),Ne=["loading"],Te=ue.Z.explore.result,ke=ue.Z.explore.savaResult,Se=ue.Z.IDBHeaderScreening.headerScreening;function Oe(e,t){var n=[];return e.forEach((function(e){e.name===t&&(n.push(e.name),e.keywords.length&&e.keywords.forEach((function(e){return n.push(e)})))})),n}function Fe(e){var t=JSON.parse(JSON.stringify(e)),n=e.dateFilter;if(n){if(-1===n.to.indexOf(":")&&(t.dateFilter.from=""+be()(t.dateFilter.from).format("YYYY-MM-DD HH:mm:ss"),t.dateFilter.to=""+be()(t.dateFilter.to).endOf("day").format("YYYY-MM-DD HH:mm:ss")),/\u8fd1/.test(n.quickChoice)){var a=be()().format("YYYY-MM-DD HH:mm:ss").split(" ")[1];t.dateFilter.from=be()(n.from).format("YYYY-MM-DD")+" "+a,t.dateFilter.to=""+be()().format("YYYY-MM-DD HH:mm:ss")}if(/\u5c0f\u65f6/.test(n.quickChoice)){var o=(0,_e.Ey)(n.quickChoice);t.dateFilter.from=o[0],t.dateFilter.to=o[1]}}return t}var Ie=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleFilterReady=function(e,t){var a=Fe(e),o=n.props,r=o.recordId,i=o.comparisonItems;r||(n.props.save({filterValue:a,filterValues:t.fullInfo.filterValue}),n.props.fetchDefaultValue().then((function(){var e=i.length;!function t(a){return n.props.fetchWordCloud({index:a}).then((function(n){a<e-1&&t(a+1)}))}(0),n.props.fetchBarOrLineData()})))},n._handleFilterChange=function(e,t){var a,o=Fe(e);n.props.save(((a={filterValue:o,selectValue:t.selectValue,filterValues:t.fullInfo.filterValue})[t.comparisonItems?"comparisonItems":void 0]=t.comparisonItems,a));var r=n.props.comparisonItems.length;!function e(t){return n.props.fetchWordCloud({index:t}).then((function(){t<r-1&&e(t+1)}))}(0),n.props.saveTimeOptions(e.dateFilter),n.props.fetchBarOrLineData()},n._handleKeyWordChange=function(e,t){b.t.set(b.V.comparisonItemsSession,e,"session");var a=n.props,o=a.fetchBarOrLineData,r=a.fetchWordCloud,i=a.comparisonItems,l=a.allWordCloudList;i.length>e.length?(l.splice(t,1),n.props.save({comparisonItems:e,allWordCloudList:JSON.parse(JSON.stringify(l))})):(n.props.save({comparisonItems:e}),r({index:t})),o()},n._handleWordCloudChange=function(e,t){var a=n.props,r=a.allWordCloudList,i=a.fetchWordCloud;r[e]=(0,o.Z)({},r[e],t),n.props.save({allWordCloudList:JSON.parse(JSON.stringify(r))}),1===Object.keys(t).length&&t.wordCloudModal||1===Object.keys(t).length&&t.modal||i({index:e})},n._handleWordFlavorChange=function(e,t){var a=n.props,r=a.wordCloudFlavor,i=a.setDefaultValue;r[e]=(0,o.Z)({},r[e],t),i({wordCloudFlavor:r})},n._handleSaveButtonClick=function(){var e=n.props,t=e.filterValue,a=e.screeningValues,r=e.selectValue,i=e.chartData,l=e.comparisonItems,s=e.allWordCloudList,c=e.timeType,u=[],d=[];s.forEach((function(e,t){u[t]={topN:e.topN,enablePos:e.enablePos,wordCloudModal:e.wordCloudModal,modal:e.modal,wordCloudTotal:e.wordCloudTotal},"object"===typeof e.data?d.push({data:e.data}):d.push({data:[]})})),l.forEach((function(e,t){u[t]=(0,o.Z)({},u[t],{name:e.name}),d[t]=(0,o.Z)({},d[t],{comparisonItemName:e.name})}));var p=n.filterRef&&n.filterRef.wrappedInstance&&n.filterRef.wrappedInstance.getFullValue(),f={dateFilter:(0,o.Z)({},t.dateFilter,{dateGroupType:c}),expandParam:p,messageCategory:r},m={projectId:b.t.get(b.V.curProject).id,messageCategory:r,comparisonItems:l,dateFilter:t.dateFilter,headerFilterParamsNew:t.headerFilterParamsNew,filterModel:a,trendResult:"object"===typeof i?i:[],wordCountResult:d,wordCountConfigs:u,expandParam:JSON.stringify(f)};Ce.edit((0,o.Z)({},m,{titleText:"\u4fdd\u5b58\u63a2\u7d22\u7ed3\u679c",count:n.props.filterData&&n.props.filterData.count,category:"\u63a2\u7d22\u7ed3\u679c",onOk:function(e){"success"===e.result&&n.props.fetchSaveFilter(b.t.get(b.V.curProject).id)},onCancel:function(){}}))},n._handleOnMsgClick=function(e,t,a,r,i){var l,s=n.props,c=s.projectId,u=s.filterValue,d=s.filterValues,p=s.selectValue,f=s.comparisonItems,m=s.timeType,h=(s.messageCategory,[]),v=JSON.parse(JSON.stringify(u.headerFilterParamsNew)),g=JSON.parse(JSON.stringify(d)),y={id:"CATEGORY_TYPE",values:[de[p]]},C={id:"CATEGORY_TYPE",label:"\u6570\u636e\u7c7b\u578b",values:"COMMENT"===de[p]?["\u7535\u5546\u8bc4\u8bba"]:"SERVICE"===de[p]?["\u5ba2\u670d\u4f1a\u8bdd"]:["\u8c03\u67e5\u95ee\u5377"]};"SELF"!==de[p]&&(v&&v[0]&&v&&"DEFAULT"===v[0].id?(v&&v[0].values.push(y),g&&g[0].values.push(C)):(v.unshift({id:"DEFAULT",values:[y]}),g.unshift({id:"DEFAULT",values:[C]})));var E=JSON.parse(JSON.stringify(u));r&&(h=i.map((function(e){return e[0]})),l=(0,we.X_)("line",u.dateFilter,r,h,m,!0));var w={projectId:b.t.get(b.V.curProject).id,dateFilter:r?Object.assign((0,o.Z)({},E.dateFilter),{from:l.from,to:l.to,quickChoice:l.quickChoice,dateGroupType:m}):(0,o.Z)({},u.dateFilter),filterModel:{content:[{contain:Oe(f,t),queryType:"FUZZY_SEARCH"}],queryType:"FUZZY_SEARCH",project:[c]},headerFilterParamsNew:v,filterValues:g,pageIndex:1,pageSize:20};a?(a.name&&(w.filterModel.content[0].andContain=[a.name],w.textRankWordPos=a.pos||""),w.filterTip=null):w.filterTip=null,"COMMENT"===de[p]?window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(w))):"SERVICE"===de[p]?window.open("/inbox/service?"+encodeURIComponent(JSON.stringify(w))):"SELF"===de[p]&&window.open("/inbox/self?"+encodeURIComponent(JSON.stringify(w)))};var a=t.location.state,r=(0,Ee.getQuery)("query")?JSON.parse(decodeURI((0,Ee.getQuery)("query").replace(/\*\*\*/g,"#"))):null;return t.save({projectId:b.t.get(b.V.curProject).id,comparisonItems:r?r.comparisonItems:a&&a.searchValue?[{name:a.searchValue,keywords:[],color:"#7262FD"}]:[],selectValue:r?r.selectValue:a&&a.selectValue?a.selectValue:void 0,filterId:(0,Ee.getQuery)("filterId")?(0,Ee.getQuery)("filterId"):void 0,recordId:(0,Ee.getQuery)("recordId")?(0,Ee.getQuery)("recordId"):void 0}),n._event={_handleOnMsgClick:n._handleOnMsgClick,onSaveButtonClick:n._handleSaveButtonClick,filterReady:n._handleFilterReady,filterChange:n._handleFilterChange,onWordCloudChange:n._handleWordCloudChange,onKeyWordChange:n._handleKeyWordChange,onWordFlavorChange:n._handleWordFlavorChange,getFilterRef:function(e){return n.filterRef=e}},n}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;setTimeout((function(){var t=e.props,n=t.recordId,a=t.filterId;n&&e.props.exploreResultDetail({recordId:n}),a&&e.props.findFilterDetail({filterId:a}),e.props.fetchSaveFilter(b.t.get(b.V.curProject).id)}),0)},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return this.props.selectValue?i.createElement(ce,(0,o.Z)({},this.state,this.props,this._event)):null},t}(i.Component);const De=(0,l.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,Ne);return(0,o.Z)({},n[Te],n[ke],{loading:t.effects[Te+"/fetchWordCloud"]||!1,barLineLoading:t.effects[Te+"/fetchBarOrLineData"]||!1,fetchingScreeningMap:t.effects[Se+"/init"]||!1})}),(function(e){return{save:function(t){return e({type:Te+"/save",payload:t})},clean:function(){return e({type:Te+"/clean"})},fetchWordCloud:function(t){return e({type:Te+"/fetchWordCloud",payload:t})},fetchBarOrLineData:function(t){return e({type:Te+"/fetchBarOrLineData",payload:t})},setDefaultValue:function(t){return e({type:Te+"/setDefaultValue",payload:t})},exploreResultDetail:function(t){return e({type:Te+"/exploreResultDetail",payload:t})},findFilterDetail:function(t){return e({type:Te+"/findFilterDetail",payload:t})},getDefaultValue:function(t){return e({type:Te+"/getDefaultValue",payload:t})},fetchDefaultValue:function(t){return e({type:Te+"/fetchDefaultValue",payload:t})},distributeData:function(t){return e({type:Te+"/distributeData",payload:t})},saveDistributeData:function(t){return e({type:Te+"/saveDistributeData",payload:t})},fetchSaveFilter:function(t){return e({type:ke+"/fetchSaveFilter",payload:t})},saveTimeOptions:function(t){return e({type:Te+"/saveTimeOptions",payload:t})},findTouchSpotByAccountId:function(t){return e({type:Te+"/findTouchSpotByAccountId",payload:t})}}}))(Ie)},2786:(e,t,n)=>{n.d(t,{X_:()=>l});var a=n(30381),o=n.n(a),r=n(87219);function i(e,t){var n=JSON.parse(JSON.stringify(e)),a=e.quickChoice,r=e.from,i=e.to,l=o()().format("YYYY-MM-DD HH:mm:ss").split(" ")[1];if("\u8fd124\u5c0f\u65f6"===a)if(1===t){var s=r.split(" ").map((function(e){return e.trim()}));n.from=o()(s[0]).format("YYYY-MM-DD")+" "+l,n.to=""+o()(s[0]).endOf("day").format("YYYY-MM-DD HH:mm:ss")}else{var c=i.split(" ").map((function(e){return e.trim()}));n.from=""+o()(c[0]).startOf("day").format("YYYY-MM-DD"),n.to=o()(c[0]).format("YYYY-MM-DD")+" "+l}else if(/\u5c0f\u65f6/.test(a)){var u=r.split(" ").map((function(e){return e.trim()}));1===t?(n.from=r,n.to=o()(u[0]).format("YYYY-MM-DD")+" "+o()(r).hour()+":59:59"):(n.from=""+o()(u[0]).startOf("day").format("YYYY-MM-DD HH:mm:ss"),n.to=i)}return n}var l=function(e,t,n,a,l,s){t.quickChoice;var c=t.numOfDays,u=/:/.test(t.quickChoice)||-1===t.quickChoice.indexOf("-"),d="line"===e&&a instanceof Array&&a.length>0?(0,r.ZP)(t,(function(e){var r=function(e,t,n){var a=n?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD";switch(t){case"HOUR":return{from:o()(e).format("YYYY-MM-DD HH:00:00"),to:o()(e).format("YYYY-MM-DD HH:59:59")};case"YEAR":var r=o()(e);return{from:r.startOf("year").format(a),to:r.endOf("year").format(a)};case"QUARTER":var i=e.split("-"),l=o()().year(i[0]).quarter(i[1]);return{from:l.startOf("quarter").format(a),to:l.endOf("quarter").format(a)};case"MONTH":var s=o()(e);return{from:s.startOf("month").format(a),to:s.endOf("month").format(a)};case"WEEK":var c=e.split("-"),u=c[0],d=c[1],p=o()().year(u).week(d);return{from:p.startOf("week").format(a),to:p.endOf("week").format(a)};default:return{from:e,to:e}}}(n,l,u),s=r.from,d=r.to;"DAY"!==l&&"HOUR"!==l?JSON.stringify(n)===JSON.stringify(a[0])?s=e.from:JSON.stringify(n)===JSON.stringify(a[a.length-1])&&(d=e.to):"DAY"!==l&&"HOUR"!==l||1!==c&&2!==c||(JSON.stringify(n)===JSON.stringify(a[0])?(s=i(t,1).from,d=i(t,1).to):JSON.stringify(n)===JSON.stringify(a[a.length-1])&&(d=i(t,2).to,s=i(t,2).from)),e.from=s,e.to=d,e.numOfDays=function(e,t){var n=Date.parse(e),a=Date.parse(t),o=Math.abs(n-a);return Math.floor(o/864e5)+1}(d,s),e.quickChoice=s.replaceAll("-",".")+" - "+d.replaceAll("-",".")})):t;return d}}}]);