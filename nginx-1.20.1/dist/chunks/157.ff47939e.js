"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[157],{24473:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(87462),i=n(63366),r=n(94578),l=n(67294),s=n(45697),c=n.n(s),o=n(94184),u=n.n(o),p=["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"],f=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.render=function(){var e,t=this.props,n=t.prefixCls,r=t.children,s=t.className,c=t.block,o=t.indeterminate,f=t.value,d=t.checked,h=t.defaultChecked,m=t.onChange,g=t.disabled,v=(0,i.Z)(t,p),y={value:f,checked:d,defaultChecked:h,onChange:m,disabled:g},C=u()(n,((e={})[n+"-disabled"]=y.disabled,e[n+"-block"]=c,e[n+"-indeterminate"]=o,e),s);return l.createElement("label",(0,a.Z)({tabIndex:y.disabled?-1:0,className:C},v),l.createElement("input",(0,a.Z)({type:"checkbox",className:n+"-input"},y)),l.createElement("span",{className:n+"-status"}),r&&l.createElement("span",{className:n+"-text",title:r},r))},t}(l.Component);f.propTypes={prefixCls:c().string,value:c().oneOfType([c().string,c().number]),checked:c().bool,defaultChecked:c().bool,onChange:c().func,indeterminate:c().bool,disabled:c().bool,block:c().bool},f.defaultProps={prefixCls:"wt-checkbox"};const d=f},85151:(e,t,n)=>{n.d(t,{Jg:()=>a.Z,CS:()=>h});var a=n(24473),i=n(87462),r=n(63366),l=n(94578),s=n(67294),c=n(45697),o=n.n(c),u=n(94184),p=n.n(u),f=["prefixCls","children","className","onChange","values","checkedList","block"],d=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).handleCheckBoxChange=function(e){var n=t.props.onChange;n&&n(e)},t}return(0,l.Z)(t,e),t.prototype.render=function(){var e,t=this,n=this.props,a=n.prefixCls,l=n.children,c=n.className,o=(n.onChange,n.values),u=n.checkedList,d=n.block,h=(0,r.Z)(n,f);return e=o?o.map((function(e,n){var a=0!==u.length&&-1!==u.indexOf(e);return s.createElement(Checkbox,{key:n,value:e,checked:a,onChange:function(e){return t.handleCheckBoxChange(e)},block:d},e)})):s.Children.map(l,(function(e,n){if(e){var a=e.props,i=a.value,r=0!==u.length&&-1!==u.indexOf(i);return s.cloneElement(e,{checked:r,key:n,block:a.block||d,onChange:function(){var e=a.value;t.handleCheckBoxChange(e)}})}})),s.createElement("div",(0,i.Z)({className:p()(a,c)},h),e)},t}(s.Component);d.defaultProps={prefixCls:"wt-checkbox-group"},d.propTypes={onChange:o().func,values:o().array,block:o().bool};const h=d;var m=function(e){var t={};return Object.keys(e).forEach((function(n){/^data\-.+$/.test(n)&&(t[n]=e[n])})),t},g=function(e){function t(){return e.apply(this,arguments)||this}return(0,l.Z)(t,e),t.prototype.render=function(){var e=this.props,t=m(e);return s.createElement("label",{className:e.className,title:e.children},s.createElement("div",{className:"checkbox"},s.createElement("input",(0,i.Z)({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),s.createElement("div",{className:"checkbox-body"})),"\xa0",s.createElement("span",null,e.children))},t}(s.Component);g.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},66161:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(43144),i=n(94578),r=n(67294),l=n(85151);const s=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleClear=function(e){var t=n.state.list;t.forEach((function(e){return e.sel=!1})),n.setState({list:t},(function(e){return n.commitUserSel()}))},n.hoverDropToggle=function(e){n.state.open&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){n.setState({open:!n.state.open})}),0)},n.closeDrop=function(e){n.state.open&&n.setState({open:!1})},n.initializeList=function(){if(n.props.value){var e=JSON.parse(JSON.stringify(n.state.list));e.forEach((function(e){e.sel=-1!==n.props.value.indexOf(String(e.id))||-1!==n.props.value.indexOf(Number(e.id))})),n.setState({list:e})}},n.state={list:JSON.parse(JSON.stringify(t.list||[])),searchKeyWords:"",open:!1,timeout:""},n}(0,i.Z)(t,e);var n=t.prototype;return n.search=function(){this.setState({searchKeyWords:this.searchInput.value})},n.handleChecked=function(e){var t=this,n=this.state.list;this.props.singleSel?n.forEach((function(t){t.sel=t.id===e})):n.forEach((function(t){t.id===e&&(t.sel=!t.sel)})),this.setState({list:n},(function(e){return t.commitUserSel()}))},n.handleCheckedAll=function(){var e=this,t=!this.checkedAll,n=this.state.list;n.forEach((function(e){return e.sel=t})),this.setState({list:n},(function(t){return e.commitUserSel()}))},n.commitUserSel=function(){this.props.singleSel?this.props.onSel(this.selList[0]?this.selList[0].id||this.selList[0].val:""):this.props.onSel(this.selList)},n.UNSAFE_componentWillReceiveProps=function(e,t){if(e.list){var n=JSON.parse(JSON.stringify(e.list));n.forEach((function(t){t.sel=-1!==e.value.indexOf(String(t.id))||-1!==e.value.indexOf(Number(t.id))})),this.setState({list:n})}},n.componentDidMount=function(){this.initializeList(),window.addEventListener("click",this.closeDrop)},n.componentWillUnmount=function(){window.removeEventListener("click",this.closeDrop)},n.render=function(){var e=this,t=this.props,n=t.classNames,a=t.style,i=t.title,s=t.selectPosition,c=t.special,o=this.state,u=o.list,p=o.searchKeyWords,f=o.open,d=p.length>0?this.searchList:u;return r.createElement("div",{className:(n||"")+" search-select-wrap",onClick:function(t){e.hoverDropToggle(t)},style:a},r.createElement("div",{className:f?"open sel-wrap":"sel-wrap"},r.createElement("span",{className:"title"},i+(c?"":"\uff1a")),!c&&(this.selList.length>0?this.selList.map((function(t,n){return r.createElement("span",{key:n},t.name,n===e.selList.length-1?"":" ,")})):r.createElement("span",null,this.props.singleSel?"\u8bf7\u9009\u62e9":"\u5168\u90e8")),r.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:f?"rotate(-180deg)":""}})),f&&r.createElement("div",{className:s+" allSelContent",style:{left:"left"===s?"0":"",right:"right"===s?"0":""}},r.createElement("div",{className:"search"},r.createElement("p",null,r.createElement("input",{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},placeholder:"\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u8bcd",ref:function(t){return e.searchInput=t},type:"text",onChange:function(t){return e.search()}})),r.createElement("p",null,r.createElement("span",{onClick:function(t){return e.handleClear()}},"\u6e05\u9664\u5df2\u9009\u9879\u76ee"))),d.length>0?r.createElement("div",{className:"all"},!this.props.singleSel&&p.length<1&&r.createElement(l.Jg,{checked:this.checkedAll,indeterminate:this.indeterminate,onChange:function(){return e.handleCheckedAll()},block:!0},"\u5168\u9009"),d.map((function(t){return r.createElement(l.Jg,{key:t.id,value:t.id,checked:t.sel,onChange:function(){return e.handleChecked(t.id)},block:!0},t.name)}))):r.createElement("div",{className:"all"},"\u65e0\u9009\u9879")))},(0,a.Z)(t,[{key:"selList",get:function(){return this.state.list.filter((function(e,t){return e.sel}))}},{key:"checkedAll",get:function(){return this.state.list.every((function(e){return e.sel}))}},{key:"indeterminate",get:function(){return!this.checkedAll&&this.state.list.some((function(e){return e.sel}))}},{key:"searchList",get:function(){var e=this;return this.state.list.filter((function(t){return t.name.toLocaleLowerCase().includes(e.state.searchKeyWords.trim().toLocaleLowerCase())}))}}]),t}(r.Component)},80157:(e,t,n)=>{n.d(t,{Z:()=>B});var a=n(87462),i=n(94578),r=n(67294),l=n(49722),s=n(66161),c={project:"\u9879\u76ee",topic:"\u4e3b\u9898",source:"\u6570\u636e\u6765\u6e90",escore:"\u60c5\u611f",star:"\u661f\u7ea7",messageType:"\u6d88\u606f\u7c7b\u578b",keyword:"\u5173\u952e\u8bcd",content:"\u5185\u5bb9",taskTypes:"\u4efb\u52a1\u7c7b\u578b"},o=n(45697),u=n.n(o),p=n(92360),f={opacity:"0",pointEvent:"none"},d=function(e){function t(t){var n;(n=e.call(this,t)||this).onSelectChange=function(e){n.setState({data:Object.assign(e)},(function(){return n.changeSelectConfig(e)}))},n.onInputChange=function(e,t,a){var i=n.state.data;i[e][t].value=a,n.setState({data:i},(function(){return n.changeSelectConfig(i)}))},n.delContent=function(e,t){var a=n.state.data;a[e].splice(t,1),0===a[e].length&&a.splice(e,1),n.setState({data:a},(function(){return n.changeSelectConfig(a)}))},n.addAndContent=function(e){var t=n.state.data;t[e].push({name:"",operator:"contains",value:""}),n.setState({data:t})},n.addOrContent=function(){var e=n.state.data;e.push([{name:"",operator:"contains",value:""}]),n.setState({data:e})},n.changeSelectConfig=function(e){var t=[];e.forEach((function(e,n){var a=[],i=[];e.forEach((function(e){"contains"===e.operator&&e.value&&a.push(e.value),"notContains"===e.operator&&e.value&&i.push(e.value)}));var r={};a.length>0&&(r.contain=a),i.length>0&&(r.notContain=i),t[n]=r})),n.props.changeSelectConfig("content",t)};var a=t.data,i=[[{name:"",operator:"contains",value:""}]];return a&&a.length&&a.forEach((function(e,t){var n=[];e.contain&&e.contain.forEach((function(e){n.push({name:"",operator:"contains",value:e})})),e.notContain&&e.notContain.forEach((function(e){n.push({name:"",operator:"notContains",value:e})})),0!==n.length&&(i[t]=n)})),n.state={data:i},n}(0,i.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this.setState({prop:n})}},n.render=function(){var e=this,t=this.props,n=t.name,a=t.options,i=t.className,l=this.state.data,s=i?i+" mulcondition-filter-wrap":"mulcondition-filter-wrap";return r.createElement("div",{className:s},r.createElement("div",{className:"mulcondition-filter-name"},n),r.createElement("ul",{className:"filter-cont"},l.map((function(t,n){return r.createElement("li",{className:"filter-state-item",key:n},r.createElement("div",{className:"state-tip"},0===n?"\u5982\u679c":"\u6216"),r.createElement("ul",{className:"state-cont"},t.map((function(t,i){return r.createElement("li",{className:"filter-content-item",key:i},r.createElement("span",{className:"content-title"},"\u5185\u5bb9"),r.createElement(p.Select,{className:"tagSetSelect height30",value:t.operator,onChange:function(t){l[n][i].operator=t,e.onSelectChange(l)}},a.map((function(e,t){return r.createElement(p.Select.Option,{key:t,label:e.label,value:e.value})}))),r.createElement(p.Input,{value:t.value,className:"tagSetInput height30",onChange:function(t){e.onInputChange(n,i,t)}}),r.createElement("i",{onClick:e.delContent.bind(e,n,i),className:"el-icon-close",style:1===l.length&&1===l[0].length?f:{}}))})),r.createElement("div",{className:"and-btn ele-btn"},r.createElement(p.Button,{onClick:e.addAndContent.bind(e,n),className:"tagSetButton height30",type:"info",plain:!0},"\u4e14\xa0\xa0\xa0+"))))})),r.createElement("div",{className:"or-btn ele-btn"},r.createElement(p.Button,{onClick:this.addOrContent.bind(this,l.name),className:"wrapButton height30",type:"info",plain:!0},"\u6216\xa0\xa0\xa0+"))))},t}(r.Component);d.defaultProps={data:[[{name:"",operator:"contains",value:""}]],name:"\u5185\u5bb9",options:[{value:"contains",label:"\u5305\u542b"},{value:"notContains",label:"\u4e0d\u5305\u542b"}]},d.propTypes={className:u().string,data:u().array,name:u().string,options:u().array};var h=function(e){function t(t){var n;return(n=e.call(this,t)||this).inputChange=function(e){n.setState({inputVal:e.target.value})},n.keywordChange=function(e){var t=n.state,a=t.inputVal,i=t.inputValMap;"keydown"===e.type&&13===e.keyCode?e.target.blur():"keydown"===e.type&&32===e.keyCode?a.trim()&&(i.push(a.trim()),n.setState({inputValMap:i,inputVal:""})):"keydown"===e.type&&8===e.keyCode?!a&&i&&i.length>0&&(i.splice(i.length-1,1),n.setState({inputValMap:i})):"blur"===e.type&&(a.trim()&&(i.push(a.trim()),n.setState({inputValMap:i,inputVal:""})),n.handleSel("keyword","keyword",i))},n.findShowConfig=function(){var e=n.props,t=e.selectConfig,a=e.allConfig,i=e.type,r=n.state.showList;if(!a)return null;var l=n.dataFormat(),s=[];if("dialog"===i)l.filter((function(e){return e.values&&e.values.length>0||r.indexOf(e.id)>=0&&0===s.filter((function(t){return t.id===e.id})).length})).map((function(e){return s.push(e)}));else s=[],r.length?l.filter((function(e){return r.indexOf(e.id)>=0})).map((function(e){return s.push(e)})):l.forEach((function(e){var n=!1;s.length<4&&(n=!0),t[e.id]&&t[e.id].length&&(n=!0),t[e.type]&&t[e.type].filter((function(t){return t.id===e.id})).length&&(n=!0),n&&s.push(e)}));return{config:s,allConfig:l}},n.getMaxLengthOfFilter=function(e){for(var t=.9*(document.getElementsByClassName("breadcumb-wrapper")[0].clientWidth-48),n=0,a=0,i=0;i<e.length;i++){if((n+=90+14*e[i].name.length)>=t){a=i;break}}return a},n.toggleDisplay=function(){var e=n.state.display;n.setState({display:!e})},n.state={showList:[],inputValMap:[],inputVal:"",showAllConfig:n.props.showAllConfig,maxLength:0,display:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.addMoreFilter=function(e){var t=this.props,n=t.selectConfig,a=t.changeSelectConfig,i={};e.forEach((function(e){switch(e.type){case"tag":case"connConfig":i[e.type]=i[e.type]||[];var t=n[e.type]?n[e.type].filter((function(t){return t.id===e.id})):[{id:e.id,values:[]}];t.length>0&&i[e.type].push(t[0]);break;default:n[e.type]&&(i[e.type]=n[e.type])}})),this.props.selectConfig.content&&e.some((function(e){return"content"===e.id}))&&(i.content=this.props.selectConfig.content),this.setState({showList:e.map((function(e){return e.id}))},(function(){return JSON.stringify(n)!==JSON.stringify(i)&&a(i)}))},n.handleSel=function(e,t,n){var a=this.props,i=a.selectConfig,r=a.changeSelectConfig;a.allConfig;switch(t){case"keyword":i.content=[{contain:n}],delete i.word,r(i);break;case"connConfig":case"tag":var l=i[t];if(l&&l.filter((function(t){return t.id===e})).length){var s=l.filter((function(t){return t.id===e}))[0];(s.values.length!==n.length||n.filter((function(e){return s.values.indexOf(e)<0})).length>0)&&(s.values=n.map((function(e){return e.id})),r(i))}else i[t]=l||[],i[t].push({id:e,values:n.map((function(e){return e.id}))}),r(i);break;default:i[t]=n.map((function(e){return e.id})),r(i)}},n.dataFormat=function(){var e=this.props,t=e.selectConfig,n=e.allConfig,a=e.filter;if(!n)return[];var i=[];return a.forEach((function(e){var a=n[e];switch(e){case"source":case"taskTypes":i.push({id:e,type:e,name:c[e],list:a,values:t[e]||[]});break;case"escore":i.push({id:e,type:e,name:c[e],list:[{id:"1",name:"\u597d\u8bc4"},{id:"0",name:"\u4e2d\u8bc4"},{id:"-1",name:"\u5dee\u8bc4"}],values:t[e]});break;case"star":i.push({id:e,type:e,name:c[e],list:[{id:"1",name:"1"},{id:"2",name:"2"},{id:"3",name:"3"},{id:"4",name:"4"},{id:"5",name:"5"}],values:t[e]});break;case"content":i.push({id:e,type:e,name:c[e],values:t[e]});break;case"messageType":i.push({id:e,type:e,name:c[e],list:[{id:"PL",name:"\u8bc4\u8bba"},{id:"ZP",name:"\u8ffd\u8bc4"},{id:"TW",name:"\u63d0\u95ee"},{id:"HD",name:"\u56de\u7b54"},{id:"SX",name:"\u79c1\u4fe1"},{id:"YW",name:"\u539f\u6587"},{id:"HF",name:"\u56de\u590d"}],values:t[e]});break;case"connConfig":var r=n&&n.topics&&n.topics.titles?n.topics.titles.map((function(e){return e.id})):[];r.length&&n.topics.titles.forEach((function(e,a){var r=t.connConfig?t.connConfig.filter((function(t){return e.id===t.id})):[];r=r.length?r[0].values:[];var l={};n.topics.data&&n.topics.data.length?n.topics.data.filter((function(e){var i=!0;return e.forEach((function(e,r){var l=t.connConfig?t.connConfig.filter((function(e){return n.topics.titles[r].id===e.id})):[];l=l.length?l[0].values:[],r!==a&&l.length&&l.indexOf(e.id)<0&&(i=!1)})),i})).filter((function(e){return e[a].name})).forEach((function(e){l[e[a].id]=e[a]})):e.list&&e.list.filter((function(e){return e.name})).map((function(e){return l[e.id]=e})),n.topics.titles.some((function(t){return t.id===e.id}))&&n.topics.titles.some((function(t){return t.id===e.id&&(t.values.some((function(e){return"EMPTY"===e.id}))&&(l.EMPTY={id:"EMPTY",name:"(\u7a7a\u503c)"}),!0)})),i.push({id:e.id,name:e.name,type:"connConfig",list:Object.keys(l).map((function(e){return l[e]})),values:r})}));break;case"tag":n.tag&&n.tag.forEach((function(n){var a=JSON.parse(JSON.stringify(n));a.type=e,a.list=n.values.map((function(e){return e}));var r=t[e]?t[e].filter((function(e){return e.id===n.id})):[];a.values=r.length>0?r[0].values:[],i.push(a)}))}})),i},n.delKeyWords=function(e){var t=this,n=this.state.inputValMap;n.splice(e,1),this.setState({inputValMap:n},(function(e){return t.handleSel("keyword","keyword",n)}))},n.componentDidMount=function(){this.initData()},n.initData=function(){var e=[];(this.props.filter.indexOf("keyword")&&this.props.selectConfig&&this.props.selectConfig.word&&(e.push(this.props.selectConfig.word),this.setState({inputValMap:e})),this.props.selectConfig&&this.props.selectConfig.content)&&(this.props.selectConfig.content.forEach((function(t){t.contain&&t.contain.forEach((function(t){e.push(t)}))})),this.setState({inputValMap:e}));if(this.state.showAllConfig&&this.dataFormat().length>0){var t=this.dataFormat().map((function(e){return e.id}));this.setState({showList:t,showAllConfig:!1})}},n.UNSAFE_componentWillReceiveProps=function(e){var t=this;for(var n in e)if(e.hasOwnProperty(n)){var a=e[n];"selectConfig"===n?this.setState({prop:a},(function(e){t.initData()})):this.setState({prop:a})}},n.buildHeaderFilter=function(){var e=this,t=this.props,n=t.filter,a=t.extraConfig,i=t.onExtraChange,l=this.state,c=l.inputVal,o=l.inputValMap,u=l.display,p=this.findShowConfig();if(!p)return r.createElement("div",null);var f=p.config,d=p.allConfig,h=this.getMaxLengthOfFilter(d);return r.createElement("div",{className:"filter-conditions"},r.createElement("div",{className:"first-line-wrap"},r.createElement("div",{className:"choice-wrapper"},r.createElement("div",null,f.slice(0,"filter"===this.props.type?1/0:4).map((function(t,n){return 0===h||n<h-1?r.createElement(s.Z,{list:t&&t.list,value:t.values||[],onSel:e.handleSel.bind(e,t.id,t.type),title:t.name,key:n}):r.createElement(s.Z,{list:t&&t.list,value:t.values||[],onSel:e.handleSel.bind(e,t.id,t.type),title:t.name,key:n,style:{display:u?"block":"none"}})})),a&&a.map((function(e){return r.createElement(s.Z,{key:e.id,list:e.list,value:e.values||[],title:e.name,onSel:function(t){return i?i[e.id](t):{}}})}))),r.createElement("div",{className:"more",onClick:this.toggleDisplay,style:{visibility:f.length>h&&h>0?"visible":"hidden"}},u?"\u6536\u8d77":"\u66f4\u591a",r.createElement("i",{className:u?"icon-cem_pull-or-take-up":"icon-cem_pull-down-or-take-up"}))),r.createElement("div",{className:"key-word-wrap"},n.indexOf("keyword")>=0&&r.createElement("div",{className:"key-wrap"},o.map((function(t,n){return r.createElement("span",{title:t,className:"key-word",key:t+n},t,r.createElement("i",{onClick:function(){return e.delKeyWords(n)}},"\xd7"))})),o.length<3&&r.createElement("input",{type:"text",className:"keyword-setting",value:c,style:{width:100-33*o.length+"%"},placeholder:o.length>0?"\u5173\u952e\u8bcd":"\u5173\u952e\u8bcd(\u8f93\u5165\u7a7a\u683c\u952e\u4ee5\u5206\u8bcd)",onChange:this.inputChange,onBlur:this.keywordChange,onKeyDown:this.keywordChange})),"filter"===this.props.type?"":r.createElement(s.Z,{classNames:"search-select-more",list:d,title:"\u66f4\u591a",special:!0,style:{width:n.includes("keyword")?"":"97%"},selectPosition:"right",value:f.map((function(e){return e.id})),onSel:function(t){return e.addMoreFilter(t)}}))),f.slice("filter"===this.props.type?1/0:4).length>0&&r.createElement("div",{className:"moreFilter"},f.slice(4).map((function(t,n){return r.createElement("div",{key:"more"+n},r.createElement(s.Z,{list:t&&t.list,value:t.values||[],onSel:e.handleSel.bind(e,t.id,t.type),title:t.name}))}))))},n.buildDialogFilter=function(){var e=this,t=this.findShowConfig();if(!t)return r.createElement("div",null);var n=t.config,i=t.allConfig;return r.createElement("div",{className:"filter-conditions border-filters",style:{width:"97%"}},r.createElement(s.Z,{list:i,title:"\u6dfb\u52a0\u7b5b\u9009\u6761\u4ef6",classNames:"dialog",special:!0,style:{width:"130px",float:"right",marginRight:"0"},selectPosition:"right",value:n.map((function(e){return e.id})),onSel:function(t){return e.addMoreFilter(t)}}),r.createElement("div",{className:"moreFilter"},n.map((function(t,n){var i={};return t.values&&t.values.length&&(i.data=t.values),"content"===t.id?r.createElement(d,(0,a.Z)({key:"moreFilter"+n},i,{changeSelectConfig:e.props.changeSelectConfig})):r.createElement(s.Z,{key:"moreFilter"+n,classNames:"dialog",list:t&&t.list,value:t.values||[],onSel:e.handleSel.bind(e,t.id,t.type),title:t.name})}))))},n.render=function(){switch(this.props.type){case"header":default:return this.buildHeaderFilter();case"dialog":return this.buildDialogFilter()}},t}(r.Component),m=n(63366),g=n(94184),v=n.n(g),y=n(59776),C=["className","feature","prefixCls"],E={prefixCls:u().string,feature:u().oneOf(["horizontal","vertical","around","bettween"])},S=function(e){function t(){return e.apply(this,arguments)||this}return(0,i.Z)(t,e),t.prototype.render=function(){var e,t=this.props,n=t.className,i=t.feature,l=t.prefixCls,s=(0,m.Z)(t,C),c=v()(l,((e={})[l+"-"+i]=i,e),n);return r.createElement("div",(0,a.Z)({className:c},s))},t}(r.Component);S.propTypes=E,S.defaultProps={prefixCls:"wt-btn-group",feature:"horizontal"};const b=S;var k=n(85151),N=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).handleCheckedAll=function(e){var n=t.props,a=n.ITEMS,i=n.changeState,r=n.checkedList,l=[];e.target.checked?(r.map((function(e){return l.push(e)})),a.filter((function(e){return l.indexOf(e)<0})).map((function(e){return l.push(e)}))):r.filter((function(e){return a.indexOf(e)<0})).map((function(e){return l.push(e)})),i&&i(l)},t.handleChange=function(e){Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)};var n=t.props,a=n.changeState,i=n.checkedList;-1===i.indexOf(e)?i.push(e):i.remove(e),a&&a(i)},t}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.ITEMS,a=t.categoryTitle,i=t.titles,l=t.checkedList,s=l.filter((function(e){return n.indexOf(e)>=0})),c=!!s.length&&s.length===n.length,o=!!s.length&&s.length!==n.length;return r.createElement("div",{className:"checkbox-panel"},r.createElement(k.Jg,{checked:c,indeterminate:o,onChange:this.handleCheckedAll},a||"\u5168\u9009"),r.createElement(k.CS,{checkedList:l,onChange:function(t){return e.handleChange(t)}},n&&n.map((function(e){return r.createElement(k.Jg,{key:e,value:e},i?i[e]:e)}))))},t}(r.Component),w=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).state={type:"connConfig",labelType:null,label:[],labelList:[]},t.getLabelType=function(){return t.state.labelType},t.selectConfig="",t.updateFilter=function(){var e=t.props,n=e.changeSelectConfig,a=e.selectConfig,i=e.allConfig,r=t.state,l=r.labelType,s=r.label;a.analysis=a.analysis||{},i[l]?a.analysis={type:l.toUpperCase(),values:s}:(i.topics&&i.topics.titles.map((function(e){e.values.map((function(e){return e.id})).indexOf(s[0])>=0&&(a.analysis={type:"CONN_CONFIG",id:e.id,values:s})})),i.tag.filter((function(e){return e.id===l})).length>0&&(a.analysis={type:"TAG",id:l,values:s})),n("analysis",a.analysis)},t.changeState=function(e){t.setState(e,(function(){t.updateFilter()}))},t.originChange=function(e){var n=t.state.labelList,a=t.props.selectConfig.topic,i=n.filter((function(t){return t.id===e}))[0].list.filter((function(e){return!a||!a.length||!e.topicId||a.filter((function(t){return e.topicId.indexOf(t)>=0})).length>0})).slice(0,1);t.setState({labelType:e,label:i.map((function(e){return e.id}))},(function(){return t.updateFilter()}))},t.getIdNameMapper=function(e,n){var a={},i={},r={},l=t.props.allConfig;return l.project&&l.project.map((function(e){return i[e.id]=e.name})),l.topic&&l.topic.map((function(e){return r[e.id]=e.name})),e.map((function(e){var t=e.parentId||e.parentIds&&e.parentIds[0],l=t?i[t]||r[t]:"";a[e.id]=(l&&!n?l+" - ":"")+e.name})),a},t.buildAspectCheckBoxPanel=function(){var e=t.state,n=e.label,a=e.labelType,i=e.labelList,l=t.props,s=l.allConfig,c=l.selectConfig,o=i.filter((function(e){return e.id===a}))[0];if(!o)return r.createElement("div",{style:{padding:"0 0 10px 20px"}},"\u6682\u65e0\u6570\u636e");if("topic"===a)o.list=o.list.filter((function(e){return!c.topic||0===c.topic.length||c.topic.indexOf(e.id)>=0}));else if(o.list.filter((function(e){return e.topicId})).length>0){var u={};s.topic.forEach((function(e){return u[e.id]=e.name}));var p={};return o.list.map((function(e){e.topicId?e.topicId.forEach((function(t){p[t]=p[t]||[],p[t].push(e)})):(p[""]=p[""]||[],p[""].push(e))})),Object.keys(p).filter((function(e){return!c.topic||0===c.topic.length||c.topic.indexOf(e)>=0})).map((function(e,a){return r.createElement(N,{key:a,changeState:function(e){return t.changeState({label:e})},checkedList:n,ITEMS:p[e].map((function(e){return e.id})),categoryTitle:u[e]||"\u5168\u90e8",titles:t.getIdNameMapper(p[e])})}))}return r.createElement(N,{changeState:function(e){return t.changeState({label:e})},checkedList:n,ITEMS:o.list.filter((function(e){return""!=e.name})).map((function(e){return e.id})),titles:t.getIdNameMapper(o.list)})},t}(0,i.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(){var e=this.props,t=e.selectConfig,n=e.allConfig,a=e.filter;if(n&&JSON.stringify(t)!==this.selectConfig){this.selectConfig=JSON.stringify(t);var i,r,l=a[0];if(t&&t.analysis&&t.analysis.type)switch(t.analysis.type){case"CONN_CONFIG":var s=t.connConfig;if(s&&s.length)if(s.map((function(e){return e.id})).indexOf(t.analysis.id)<0)i=t.analysis.id,r=t.analysis.values.map((function(e){return e}));else{var o=[];s.map((function(e){return e.values.map((function(e){return o.push(e)}))})),t.analysis.values.filter((function(e){return o.indexOf(e)>=0})).length?(i=t.analysis.id,r=t.analysis.values.filter((function(e){return o.indexOf(e)>=0}))):s[0].values&&s[0].values.length?(i=s[0].id,r=[s[0].values[0]]):(i=t.analysis.id,r=[t.analysis.values[0]])}else l="connConfig",i=t.analysis.id,r=t.analysis.values;break;case"TAG":l="tag";var u=t.tag;if(u&&u.length)if(u.map((function(e){return e.id})).indexOf(t.analysis.id)<0)i=u[0].id,r=u[0].values&&u[0].values.length?[u[0].values[0]]:[n.tag.filter((function(e){return e.id===i}))[0].list[0].id];else{i=t.analysis.id;var p=u.filter((function(e){return e.id===i}))[0];if(p.values.length>0&&(r=t.analysis.values.filter((function(e){return p.values.indexOf(e)>=0}))),!r.length){var f=n.tag.filter((function(e){return e.id===i}))[0].values,d=t.tag.filter((function(e){return e.id===i}))[0].values;t.analysis&&t.analysis.values.length>0?f.forEach((function(e){if(d.length&&d.indexOf(e.id)>-1)return r=[e.id],!1})):r=[]}}else i=t.analysis.id,r=t.analysis.values;break;case"MESSAGE_TYPE":l="messageType",(r=t[i="messageType"]&&t[i].length?t.analysis.values.filter((function(e){return t[i].indexOf(e)>=0})).map((function(e){return{id:e}})):t.analysis.values).length||(r=t[i]?[t[i][0]]:[n[i][0].id]);break;default:l=t.analysis.type.toLowerCase(),i=t.analysis.type.toLowerCase(),(r=t[i]&&t[i].length?t.analysis.values.filter((function(e){return t[i].indexOf(e)>=0})):t.analysis.values).length||(r=t[i]?[t[i][0]]:[n[i][0].id])}else switch(l){case"connConfig":var h=n.topics.titles[0];i=h.id,r=h.values.slice(0,1).map((function(e){return e.id}));break;case"tag":var m=n.tag[0];i=m.id,r=m.values.slice(0,1).map((function(e){return e.id}));break;default:i=l,r=n[l]?n[l].slice(0,1).map((function(e){return e.id})):[]}var g=[];a.map((function(e){switch(e){case"source":g.push({id:e,name:c[e],list:t[e]&&t[e].length?n[e].filter((function(n){return t[e].indexOf(n.id)>=0})):n[e]});break;case"connConfig":var a=t.connConfig,i=n.topics.data;a&&n.topics.titles.map((function(e,t){var n=a.filter((function(t){return t.id===e.id&&t.values.length>0}));n.length&&n[0].values.length>0&&(i=i.filter((function(e){return n[0].values.indexOf(e[t].id)>=0})))})),n.topics&&n.topics.titles&&n.topics.titles.map((function(e,t){var n=[];i&&i.map((function(e){0===n.filter((function(n){return n.id===e[t].id})).length&&n.push(e[t])})),g.push({id:e.id,name:e.name,list:n.filter((function(e){return e.name})).sort((function(t,n){var a=e.values.map((function(e){return e.id}));return a.indexOf(t.id)-a.indexOf(n.id)}))})}));break;case"tag":n[e]&&n[e].map((function(e){var n=e.values;t.tag&&t.tag.forEach((function(t){t.id===e.id&&(n=n.filter((function(e){return t.values.indexOf(e.id)>-1})))})),g.push({id:e.id,name:e.name,list:n})}))}})),this.changeState({labelList:g,labelType:i,label:r})}},n.render=function(){var e=this,t=this.state,n=t.labelType,a=t.labelList;return this.props.show?"dialog"===this.props.type?r.createElement("div",{className:"dialog"},r.createElement("div",{className:"sub-btn"},r.createElement(p.Select,{value:n,onChange:this.originChange,placeholder:""},a&&a.map((function(e,t){return r.createElement(p.Select.Option,{key:t,label:e.name,value:e.id?e.id:e.name},e.name)})))),r.createElement("div",null,this.buildAspectCheckBoxPanel())):r.createElement("div",null,r.createElement("div",{className:"sub-btn"},r.createElement(b,null,a.map((function(t){return r.createElement(y.Z,{feature:n===t.id?"primary":"minor",key:t.id,onClick:function(){return e.originChange(t.id)}},t.name)})))),r.createElement("div",{style:{borderBottom:"1px solid #ebebeb",marginTop:"12px"}},this.buildAspectCheckBoxPanel())):r.createElement("div",null)},t}(r.Component),x=n(5133),O=n(23939),T=["prefixCls","className","size","onPressEnter"],L={prefixCls:u().string,value:u().oneOfType([u().string,u().number]),defaultValue:u().oneOfType([u().string,u().number]),onChange:u().func,size:u().oneOf(["sm","lg"]),disabled:u().bool,placeholder:u().string},Z=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).handleKeyDown=function(e){var n=t.props,a=(n.onKeyDown,n.onPressEnter);a&&13===e.keyCode&&a(e)},t}(0,i.Z)(t,e);var n=t.prototype;return n.focus=function(){this.input.focus()},n.select=function(){this.input.select()},n.render=function(){var e,t=this,n=this.props,i=n.prefixCls,l=n.className,s=n.size,c=(n.onPressEnter,(0,m.Z)(n,T)),o=v()(i,((e={})[i+"-"+s]=s,e),l);return r.createElement("input",(0,a.Z)({ref:function(e){return t.input=e},onKeyDown:this.handleKeyDown,className:o},c))},t}(r.Component);Z.propTypes=L,Z.defaultProps={prefixCls:"wt-input"};const A=Z;var I=["prefixCls","text","className","mode","width","defaultValue","onChange","onSearch","block","size","placeholder"],P=function(e){function t(t){var n;return(n=e.call(this)||this).handleChange=function(e){var t=e.target.value;n.setState({value:t}),n.props.onChange&&n.props.onChange(t)},n.handleSearch=function(){n.props.onSearch&&n.props.onSearch(n.state.value)},n.handleKeyDown=function(e){13===e.keyCode&&n.handleSearch()},n.state={value:"value"in t?t.value:t.defaultValue?t.defaultValue:""},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillReceiveProps=function(e){"value"in e&&this.setState({value:e.value})},n.render=function(){var e,t=this.props,n=t.prefixCls,i=t.text,l=t.className,s=t.mode,c=t.width,o=(t.defaultValue,t.onChange,t.onSearch,t.block),u=t.size,p=t.placeholder,f=(0,m.Z)(t,I),d=this.state.value;delete f.value;var h={width:c,value:d,size:u,placeholder:p},g=v()(n,((e={})[n+"-block"]=o,e[n+"-inner"]="inner"===s,e[n+"-outer"]="outer"===s,e),l),C="inner"===s?"transparent":"primary";return r.createElement("div",(0,a.Z)({className:g},f),r.createElement(A,(0,a.Z)({onChange:this.handleChange,onKeyDown:this.handleKeyDown},h)),r.createElement(y.Z,{tabIndex:"-1",icon:"search",size:u,className:n+"-btn",feature:C,onClick:this.handleSearch},"outer"==s?r.createElement("span",null,i):null))},t}(r.Component);P.defaultProps={prefixCls:"wt-search",placeholder:"\u8bf7\u8f93\u5165\u5173\u952e\u8bcd",width:"260px",mode:"inner",text:"\u641c\u7d22"},P.propTypes={prefixCls:u().string,value:u().oneOfType([u().string,u().number]),defaultValue:u().oneOfType([u().string,u().number]),onChange:u().func,onSearch:u().func,size:u().oneOf(["sm","lg"]),placeholder:u().string,block:u().bool,mode:u().oneOf(["outer","inner"]),text:u().string};const F=P;var M=n(12234);Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)};var D=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleChange=function(e){var t=n.props.changeState,a=n.state.selected;a=a===e?"":e,n.setState({selected:a,open:!1},(function(e){t&&t(a)}))},n.dropToggle=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.setState({open:!n.state.open},(function(e){n.reOneHandler=function(){n.setState({open:!1}),document.removeEventListener("click",n.reOneHandler)},document.addEventListener("click",n.reOneHandler)}))},n.stopPop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.handleSearch=function(e){var t=n.props,a=t.ITEMS;t.titles;n.setState({searchList:a.filter((function(t){return-1!==t.name.indexOf(e)})),showSearchList:!!e})},n.handleEdit=function(e){var t=n.props.handleEdit;t&&t()},n.state={selected:t.selected,searchList:[],showSearchList:!1,open:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.oneHandler=function(){e.setState({open:!1}),document.removeEventListener("click",e.oneHandler)},document.addEventListener("click",this.oneHandler)},n.UNSAFE_componentWillReceiveProps=function(e){e.selected&&this.props.selected!=e.selected&&this.setState({selected:e.selected})},n.componentWillUnmount=function(){document.removeEventListener("click",this.oneHandler),document.removeEventListener("click",this.reOneHandler)},n.render=function(){var e,t=this,n=this.state,a=n.showSearchList,i=n.searchList,l=n.selected,s=n.open,c=this.props,o=(c.RECENT,c.ITEMS),u=c.title,p=v()("save-drop-select-wrap",((e={})["save-drop-select-open"]=s,e)),f=r.createElement("div",{className:"save-drop-select-over-panel",onClick:this.stopPop},r.createElement(F,{onChange:this.handleSearch,block:!0}),a?r.createElement("div",{className:"search-list"},i.length?i&&i.map((function(e){return r.createElement(O.W,{value:e.id,selected:e.id===l,key:e.id,onClick:function(n){return t.handleChange(e.id)}},e.name)})):r.createElement("div",null,"\u6ca1\u6709\u67e5\u627e\u7684\u5339\u914d\u9879")):r.createElement("div",{className:"check-list"},o&&o.length?r.createElement("div",{className:"search-checkbox-panel"},r.createElement("div",{className:"sub-title edit-bar"},r.createElement("span",{onClick:this.handleEdit},"\u7f16\u8f91")),o&&o.map((function(e){return r.createElement(O.W,{value:e.id,selected:e.id===l,key:e.id,onClick:function(n){return t.handleChange(e.id)}},e.name)}))):r.createElement("div",{className:"sub-title",style:{textAlign:"center"}},"\u6ca1\u6709\u4fdd\u5b58\u7684\u7b5b\u9009\u6761\u4ef6")));return r.createElement("div",{className:p},r.createElement("div",{className:"save-drop-select-box",onClick:this.dropToggle},u||(l&&o&&o.filter((function(e){return e.id===l}))[0]?o.filter((function(e){return e.id===l}))[0].name:"\u672a\u9009\u62e9\u7b5b\u9009\u6761\u4ef6"),r.createElement(M.l,{name:"pull-down-or-take-up"})),s?f:null)},t}(r.Component);D.defaultProps={placeholder:"\u5168\u90e8"};const j=D;var V=n(35239),_=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).state={saveDialogVisible:!1,dialogVisible:!1,saveFilterId:null,saveConfigList:{all:[],recent:[]},selectConfig:JSON.stringify(t.props.selectConfig),currentName:"",form:{name:""}},t.getList=function(){var e=V.t.get(V.V.curProject).id;return l.h.post("/filter/list",{type:t.props.model,projectId:e}).then((function(e){if(t.setState({saveConfigList:(0,a.Z)({},e.data.result)}),e.data.result.all.length>0&&"#filter"===window.location.hash){var n=e.data.result.all[0].id;return t.setState({saveFilterId:n}),t.handleSaveSelect(n)}return Promise.resolve(!1)}))},t.handleSaveSelect=function(e){e?l.h.post("/filter/find/save",{id:e}).then((function(n){var a=n.data.result;a&&(window.location.hash="filter",t.setState({saveFilterId:e},(function(){t.props.changeSelectConfig(a.filter)})))})):(window.location.hash="",t.setState({saveFilterId:e},(function(){var e=t.props;e.selectConfig;(0,e.changeSelectConfig)({})})))},t.handleSaveBtn=function(){var e=t.state,n=e.form,a=e.saveConfigList,i=e.saveFilterId;n.name=i?a.all.filter((function(e){return e.id===i}))[0].name:"",t.setState({form:n,saveDialogVisible:!0})},t.handleSaveFilter=function(e){var n=V.t.get(V.V.curProject).id,i=t.state,r=i.form,s=i.saveFilterId,c=t.props.getSelectConfig();r.name?l.h.post("/filter/add",(0,a.Z)({},r,{copy:e,id:s,type:t.props.model,projectId:n,filter:c})).then((function(n){if(window.location.hash="filter",e)t.setState({saveDialogVisible:!1,selectConfig:JSON.stringify(c),form:{name:""}}),t.getList();else{t.state.saveConfigList;t.setState({saveFilterId:n.data.result.id,selectConfig:JSON.stringify(c),saveDialogVisible:!1,form:{name:""}}),t.getList()}})):x.Z.warning("\u8bf7\u8f93\u5165\u540d\u79f0")},t.filterNameChange=function(e,n){var a;t.setState({form:Object.assign(t.state.form,(a={},a[e]=n,a))})},t.changeSaveConfigName=function(e,n){var i=e.currentTarget,r=i.defaultValue,s=i.value,c=e.currentTarget.value;if(c){if(s!==r){if(c.length>=20)return x.Z.warning("\u540d\u5b57\u987b\u5728\u4e8c\u5341\u4e2a\u5b57\u7b26\u4ee5\u5185"),void(e.currentTarget.value=r);l.h.post("/filter/update",{id:n,name:c,type:t.props.model,menuModel:(0,a.Z)({},t.data)}).then((function(){return t.getList()}))}}else e.currentTarget.value=r},t.handleEdit=function(e){t.setState({saveFilterId:e},(function(){t.input.select()}))},t.closeModal=function(){t.setState({dialogVisible:!1},(function(){t.deleteSelected||!t.state.saveConfigList.all.length?window.location.reload():t.queryInit()}))},t.deletesSaveConfig=function(e,n){var i=t.state,r=i.saveConfigList,s=i.saveFilterId;p.MessageBox.confirm("\u5220\u9664\u540e\u65e0\u6cd5\u6062\u590d, \u662f\u5426\u7ee7\u7eed?","\u63d0\u793a",{type:"warning"}).then((function(){l.h.post("/filter/delete",{id:n,menuModel:(0,a.Z)({},t.data)}).then((function(){x.Z.success("\u64cd\u4f5c\u6210\u529f!"),s===n&&(t.deleteSelected=!0),Object.keys(r).forEach((function(e){r[e]=r[e].filter((function(e){return e.id!==n}))})),t.setState({saveConfigList:r,saveFilterId:null})}))}))},t}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.getList()},n.render=function(){var e=this,t=this.state,n=t.saveConfigList,a=t.currentName,i=t.saveFilterId,l=t.selectConfig,s=t.saveDialogVisible,c=t.dialogVisible,o=t.form,u=this.props.getSelectConfig,f=l===JSON.stringify(u());return r.createElement("div",{className:"quick-setting"},n&&r.createElement(j,{RECENT:n.recent,ITEMS:n.all,selected:i||"",changeState:this.handleSaveSelect,handleEdit:function(){return e.setState({dialogVisible:!0})},title:a}),r.createElement(y.Z,{className:"setting-save",feature:f?"minor":"primary",disabled:f,onClick:this.handleSaveBtn},"\u4fdd\u5b58"),r.createElement(p.Dialog,{title:"\u4fdd\u5b58\u7b5b\u9009\u6761\u4ef6",visible:s,className:"add-project-modal",onCancel:function(){return e.setState({saveDialogVisible:!1})}},r.createElement(p.Dialog.Body,null,r.createElement(p.Form,{labelPosition:"left",model:o},r.createElement(p.Form.Item,{label:"\u540d\u79f0",prop:"name"},r.createElement(p.Input,{value:this.state.form.name,onChange:function(t){return e.filterNameChange("name",t)}}),r.createElement("i",null,"*"),r.createElement("input",{type:"text",style:{display:"none"}})))),r.createElement(p.Dialog.Footer,{className:"dialog-footer"},r.createElement(p.Button,{type:"primary",onClick:function(){return e.handleSaveFilter(!0)},disabled:!i},"\u53e6\u5b58\u4e3a"),r.createElement(p.Button,{type:"primary",onClick:function(){return e.handleSaveFilter(!1)}},"\u4fdd \u5b58"))),r.createElement(p.Dialog,{title:"\u7f16\u8f91\u7b5b\u9009\u6761\u4ef6",visible:c,className:"edit-save-modal",onCancel:this.closeModal},r.createElement(p.Dialog.Body,null,r.createElement("div",{className:"saveConfig-list-wrap"},n&&!!n.all.length&&n.all.map((function(t,n){return r.createElement("ul",{className:"saveConfig-list item",key:t.id},r.createElement("li",{className:"saveConfig-name"},r.createElement("input",{type:"text",ref:function(n){i===t.id&&(e.input=n)},defaultValue:t.name,readOnly:i!==t.id,onBlur:function(n){return e.changeSaveConfigName(n,t.id,t.name)},onKeyDown:function(t){return"Enter"===t.key&&e.input.blur()},className:i===t.id?"edit":null}),r.createElement("i",{className:"el-icon-edit",onClick:function(){return e.handleEdit(t.id)}})),r.createElement("li",{className:"operate"},r.createElement("a",{href:"javascript:;",onClick:function(){return e.deletesSaveConfig(t.name,t.id)}},"\u5220\u9664")))}))))))},t}(r.Component),J=n(61193),R=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).state={aspectShow:!0,aspectType:!0,aspect1:[],aspect2:[],aspectList:[]},t.selectConfig="",t.getAspectType=function(){return t.state.aspectType},t.getAspectList=function(){return t.state.aspectList},t.changeAspectType=function(e,n){if(t.state.aspectShow&&t.state.aspectType!==e)if(e){var a=t.state.aspectList;t.changeState({aspectType:e,aspect1:n||t.state.aspect1.length?t.state.aspect1:a.map((function(e){return e.name}))})}else{var i=t.state,r=i.aspectList,l=i.aspect1,s=[];l&&l[0]?r.filter((function(e){return e.name===l[0]}))[0].contain.map((function(e){return s.push(e.name||e)})):r[0]&&r[0].contain.map((function(e){return s.push(e.name||e)})),t.changeState({aspectType:e,aspect2:n||(t.state.aspect2.length?t.state.aspect2:s)})}},t.changeState=function(e){t.setState(e,(function(){t.updateFilter()}))},t.updateFilter=function(){var e=t.props,n=e.changeSelectConfig,a=e.selectConfig,i=e.model,r=t.state,l=r.aspectType,s=r.aspect1,c=r.aspect2,o=r.aspectList;if(a.aspect=a.aspect||{},l&&s&&s.length>0)if("BRAND"===i){var u=[];s.map((function(e){o.filter((function(t){return t.name===e})).map((function(e){return e.contain.map((function(e){e.contain?e.contain.map((function(e){return u.push(e)})):u.push(e)}))}))})),a.aspect.aspect1=[],a.aspect.aspect2=u}else a.aspect.aspect1=s,a.aspect.aspect2=[];else if(c.length>0)if("BRAND"===i){var p=[];s.map((function(e){o.filter((function(t){return t.name===e})).map((function(e){return e.contain.filter((function(e){return c.indexOf(e.name||e)>=0})).map((function(e){e.contain?e.contain.map((function(e){return p.push(e)})):p.push(e)}))}))})),a.aspect.aspect1=[],a.aspect.aspect2=p}else a.aspect.aspect1=[],a.aspect.aspect2=c;n("aspect",a.aspect)},t}(0,i.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(){var e=this.props,t=e.selectConfig,n=e.allConfig,a=e.model;if(n&&JSON.stringify(t)!==this.selectConfig){this.selectConfig=JSON.stringify(t);var i=n.aspect,r=this.state,l=r.aspectShow,s=r.aspectType,c=r.aspect1,o=r.aspect2,u={};if("BRAND"===a){var p=i.map((function(e){return e&&JSON.parse(e)})),f=0,d=J.Z.getAuthority();if(d.indexOf("ANALYZE_PRODUCT")>=0&&f++,d.indexOf("ANALYZE_SERVER")>=0&&f++,d.indexOf("ANALYZE_MARKETING")>=0&&f++,0===f)p.map((function(e){Object.keys(e).map((function(e,t){return u[t]=e}))}));else if(1===f)["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].map((function(e,t){d.indexOf(e)>=0&&Object.keys(p[t]).map((function(e,t){return u[t]=e}))}));else if(f>1){if(d.indexOf("ANALYZE_PRODUCT")>=0){var h=Object.keys(p[0]);1===h.length?u["\u4ea7\u54c1"]=p[0][h[0]]:h.length>1&&(u["\u4ea7\u54c1"]=p[0])}if(d.indexOf("ANALYZE_SERVER")>=0){var m=Object.keys(p[1]);1===m.length?u["\u670d\u52a1"]=p[1][m[0]]:m.length>1&&(u["\u670d\u52a1"]=p[1])}if(d.indexOf("ANALYZE_MARKETING")>=0){var g=Object.keys(p[2]);1===g.length?u["\u5e02\u573a"]=p[2][g[0]]:g.length>1&&(u["\u5e02\u573a"]=p[2])}}}else i&&i[0]&&(u=JSON.parse(i[0]));var v=Object.keys(u).map((function(e,t){var n=u[e];return{id:t,name:e,contain:n.length?n:Object.keys(n).map((function(e,t){var a=n[e];return{id:t,name:e,contain:a.length?a:Object.keys(a)}}))}}));v.length<=1&&(l=!1,s=!1),s&&!c.length?v.map((function(e){return c.push(e.name)})):s||o.length||v&&v[0]&&v[0].contain.map((function(e){"object"===typeof e?o.push(e.name):o.push(e)})),this.changeState({aspectList:v,aspectShow:l,aspects:u,aspectType:s,aspect1:c,aspect2:o,refresh:!0})}},n.render=function(){var e=this,t=this.state,n=t.aspectList,a=t.aspectType,i=t.aspect1,l=t.aspect2,s=t.aspectShow;return this.props.show?"dialog"===this.props.type?r.createElement("div",{className:"dialog"},r.createElement("div",{className:"sub-btn"},s&&r.createElement(p.Select,{value:a,onChange:function(t){return e.changeAspectType(t)},placeholder:""},r.createElement(p.Select.Option,{label:"\u4e00\u7ea7\u6307\u6807",value:!0},"\u4e00\u7ea7\u6307\u6807"),r.createElement(p.Select.Option,{label:"\u4e8c\u7ea7\u6307\u6807",value:!1},"\u4e8c\u7ea7\u6307\u6807"))),r.createElement("div",null,n&&!!n.length&&(a?r.createElement(N,{changeState:function(t){return e.changeState({aspect1:t})},checkedList:i,ITEMS:n.map((function(e){return e.name||e}))}):n.map((function(t,n){return r.createElement(N,{changeState:function(t){return e.changeState({aspect2:t})},checkedList:l,key:"aspect1-"+n,categoryTitle:t.name,ITEMS:t.contain.map((function(e){return e.name||e}))})}))))):r.createElement("div",null,r.createElement("div",{className:"sub-btn"},s&&r.createElement(b,null,r.createElement(y.Z,{feature:a?"primary":"minor",onClick:function(){return e.changeAspectType(!0)}},"\u4e00\u7ea7\u6307\u6807"),r.createElement(y.Z,{feature:a?"minor":"primary",onClick:function(){return e.changeAspectType(!1)}},"\u4e8c\u7ea7\u6307\u6807"))),r.createElement("div",{style:{borderBottom:"1px solid #ebebeb",marginTop:"12px"}},n&&!!n.length&&(a?r.createElement(N,{changeState:function(t){return e.changeState({aspect1:t})},checkedList:i,ITEMS:n.map((function(e){return e.name||e}))}):n.map((function(t,n){return r.createElement(N,{changeState:function(t){return e.changeState({aspect2:t})},checkedList:l,key:"aspect1-"+n,categoryTitle:t.name,ITEMS:t.contain.map((function(e){return e.name||e}))})}))))):r.createElement("div",null)},t}(r.Component),B=function(e){function t(t){var n;(n=e.call(this,t)||this).refreshFilter=function(e){l.h.post("filter/find",{type:n.props.model,filterTypes:n.shouldFindTypes(),projectId:e}).then((function(t){var a=n.state.selectConfig;a.project=[e],n.setState({allConfig:t.data.result,selectConfig:a},(function(){n.changeSelectConfig()}))}))},n.handlePanel=function(){var e=n.state.tab;e.show=!e.show,n.setState({tab:e})},n.closePanel=function(){var e=n.state.tab;e.show=!1,n.setState({tab:e})},n.getParams=function(){return JSON.parse(JSON.stringify(n.state.selectConfig))},n.changeTab=function(e,t){t&&t.stopPropagation(),t&&t.nativeEvent.stopImmediatePropagation();var a=n.state.tab;e===a.index?n.handlePanel():(a.index=e,a.show=!0,n.setState({tab:a}))},n.changeSelectConfig=function(e,t){var a=n.state,i=a.selectConfig,r=a.compare;if(t?i[e]=t:e&&(i=e),i.connConfig){var l=i.connConfig.filter((function(e){return e.values.length>0})).map((function(e){return e}));i.connConfig=l}if(i.tag){var s=i.tag.filter((function(e){return e.values.length>0})).map((function(e){return e}));i.tag=s}n.setState({selectConfig:i},(function(){var e=n.props,t=e.confirm,a=e.filter,i=n.state.selectConfig;(!(a.indexOf("aspect")>=0)||i.analysis&&0!==i.analysis.length&&i.aspect&&0!==i.aspect.length)&&!r&&t&&t(i)}))},n.getSelectConfig=function(){return n.state.selectConfig},n.shouldFindTypes=function(){var e=[];return n.props.filter.map((function(t){switch(t){case"topic":case"project":case"escore":case"emotion":case"keyword":case"messageType":case"content":break;case"connConfig":e.push("CONN_CONFIG");break;case"taskTypes":e.push("TASK_TYPE");break;default:e.push(t.toUpperCase())}})),e},n.getAspect=function(){return{labelType:n.refs.analysis?n.refs.analysis.getLabelType():"topic",aspectType:!n.refs.aspect||n.refs.aspect.getAspectType(),aspectList:n.refs.aspect?n.refs.aspect.getAspectList():null}},n.changeAspectType=function(){var e;(e=n.refs.aspect).changeAspectType.apply(e,arguments)};return n.state={projectId:"",allConfig:null,selectConfig:t.selectConfig||{},tab:{show:!1,index:0}},n}(0,i.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){e.selectConfig&&this.setState({selectConfig:e.selectConfig})},n.componentDidMount=function(){var e=this;this.getProject().then((function(t){e.setState({projects:t,projectId:e.props.projectId||t&&t[0]&&t[0].id},(function(t){return e.refreshFilter(e.state.projectId)}))}))},n.getProject=function(){return l.h.post("/projects/list").then((function(e){return e.data.result.list}))},n.selProject=function(e){var t=this;this.setState({projectId:e},(function(e){t.refreshFilter(t.state.projectId)}))},n.render=function(){var e=this,t=this.state.tab,n=this.props,i=n.type,l=n.aspect,s=n.save,c=n.filter,o=n.model,u=n.showAllConfig,p=n.extraConfig,f=n.onExtraChange,d=(0,a.Z)({model:o,type:i,showAllConfig:u,extraConfig:p,onExtraChange:f,getSelectConfig:this.getSelectConfig,changeSelectConfig:this.changeSelectConfig},this.state);switch(i){case"header":return r.createElement("div",{className:"filter-setting-wrap data-filter "+i+"-filter"},r.createElement("div",{className:"filter-head"},r.createElement("div",{className:"tab-btn"},r.createElement("span",{onClick:function(t){return e.changeTab(0,t)},className:0===t.index&&"active"},r.createElement("i",{className:"icon-cem_product"}),r.createElement("span",null,"\u7b5b\u9009\u6761\u4ef6")),l&&r.createElement("span",{onClick:function(t){return e.changeTab(1,t)},className:1===t.index&&"active"},r.createElement("i",{className:"icon-cem_object-of-analysis"}),r.createElement("span",null,"\u5206\u6790\u5bf9\u8c61")),l&&r.createElement("span",{onClick:function(t){return e.changeTab(2,t)},className:2===t.index&&"active"},r.createElement("i",{className:"icon-cem_analysis-index"}),r.createElement("span",null,"\u5206\u6790\u6307\u6807"))),s&&r.createElement(_,(0,a.Z)({},d,{type:i}))),r.createElement("div",{className:"filter-setting",style:{display:"header"!==i||t.show?"block":"none"}},r.createElement("div",{className:"sub-btn"},0===t.index&&r.createElement(h,(0,a.Z)({ref:"condition"},d,{filter:c})),l&&r.createElement(w,(0,a.Z)({show:1===t.index,ref:"analysis"},d,{filter:c})),l&&r.createElement(R,(0,a.Z)({show:2===t.index,ref:"aspect"},d,{filter:c}))),r.createElement("div",{className:"visibility",onClick:this.closePanel})));case"dialog":return r.createElement("div",{className:"filter-setting-wrap data-filter "+i+"-filter"},r.createElement("div",{className:"filter-setting"},r.createElement("div",{className:"sub-btn"},r.createElement("div",{className:"filter-title"},"\u7b5b\u9009\u6761\u4ef6"),r.createElement(h,(0,a.Z)({ref:"condition"},d,{filter:c})),l&&r.createElement("div",null,r.createElement("div",{className:"filter-title"},"\u5206\u6790\u5bf9\u8c61"),r.createElement(w,(0,a.Z)({show:"header"!==i||1===t.index,ref:"analysis"},d,{filter:c})),r.createElement("div",{className:"filter-title"},"\u5206\u6790\u6307\u6807"),r.createElement(R,(0,a.Z)({show:"header"!==i||2===t.index,ref:"aspect"},d,{filter:c}))))));case"filter":return r.createElement("div",{className:"filter-setting-wrap data-filter "+i+"-filter"},r.createElement("div",{className:"filter-setting"},r.createElement("div",{className:"sub-btn"},r.createElement(h,(0,a.Z)({ref:"condition"},d,{filter:c})))))}return r.createElement("div",{className:"filter-setting-wrap data-filter "+i+"-filter"},"header"===i&&r.createElement("div",{className:"filter-head"},r.createElement("div",{className:"tab-btn"},r.createElement("span",{onClick:function(t){return e.changeTab(0,t)},className:0===t.index&&"active"},r.createElement("i",{className:"icon-cem_product"}),r.createElement("span",null,"\u7b5b\u9009\u6761\u4ef6")),l&&r.createElement("span",{onClick:function(t){return e.changeTab(1,t)},className:1===t.index&&"active"},r.createElement("i",{className:"icon-cem_object-of-analysis"}),r.createElement("span",null,"\u5206\u6790\u5bf9\u8c61")),l&&r.createElement("span",{onClick:function(t){return e.changeTab(2,t)},className:2===t.index&&"active"},r.createElement("i",{className:"icon-cem_analysis-index"}),r.createElement("span",null,"\u5206\u6790\u6307\u6807"))),s&&r.createElement(_,(0,a.Z)({},d,{type:i}))),r.createElement("div",{className:"filter-setting",style:{display:"header"!==i||t.show?"block":"none"}},r.createElement("div",{className:"sub-btn"},("header"!==i||0===t.index)&&r.createElement(h,(0,a.Z)({ref:"condition"},d,{filter:c})),l&&r.createElement(w,(0,a.Z)({show:"header"!==i||1===t.index,ref:"analysis"},d,{filter:c})),l&&r.createElement(R,(0,a.Z)({show:"header"!==i||2===t.index,ref:"aspect"},d,{filter:c}))),"header"===i&&r.createElement("div",{className:"visibility",onClick:this.closePanel})))},t}(r.Component)}}]);