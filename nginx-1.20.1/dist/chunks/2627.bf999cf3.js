"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2627],{26137:(e,t,a)=>{a.r(t),a.d(t,{default:()=>he});var n=a(63366),r=a(87462),o=a(15861),i=a(94578),s=a(87757),c=a.n(s),l=a(67294),p=a(27310),u=a(70715),h=a(39432),d=["positive","negative","total"],f="*flag*",m=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).chartRef=void 0,t.dataset=void 0,t.color=void 0,t.aspects=void 0,t.datasetIndex=-1,t.oriPosRangeNames=void 0,t.oriNegRangeNames=void 0,t.getChartRef=function(e){return t.chartRef=e},t.getEmotionSourceData=function(e,a,n,r,o){return t.aspects=[],t.color=void 0,e.reduce((function(e,a,i){var s=a.view,c=a.aspects;return(o instanceof Array?o.reduce((function(e,t){var a=c.find((function(e){return e.aspect===t}));return a&&e.push(a),e}),[]):c.sort((function(e,t){return t[n]-e[n]}))).forEach((function(a){if(r===s&&(t.color=[u.Fq[i]]),!r||r===s){var o=parseInt(s)?""+f+s:s;e.push([o,a.aspect,a[n]]),t.aspects.push(a.aspect)}})),e}),[a])},t.setValue=function(e,a,n){var r=t.getEmotionSourceData(e,["\u4e1a\u52a1\u89c6\u89d2","\u6307\u6807","\u6307\u6807\u597d\u8bc4\u7387"],"posRate",a,n,t.oriPosRangeNames),o=t.getEmotionSourceData(e,["\u4e1a\u52a1\u89c6\u89d2","\u6307\u6807","\u6307\u6807\u5dee\u8bc4\u7387"],"negRate",a,n,t.oriNegRangeNames);t.dataset=[r,o].map((function(e){return{source:e}})),n instanceof Function&&n(),t.dataset},t.getOption=function(e){var a=t.chartRef.getWidth(),n=.8*a/(70*t.aspects.length),r=(0,h.jD)(t.aspects.join(""),12)/(.6*a)>1,o=d.indexOf(e);t.datasetIndex=o;var i=t.dataset[o].source.reduce((function(e,t,a){return a>0&&!e.includes(t[0])&&e.push(t[0]),e}),[]);return{title:{text:t.dataset[o].source[0][2]},dataset:t.dataset,grid:{top:80,left:36,right:72,bottom:r?60:n<1?50:30,containLabel:!0},visualMap:[{type:"piecewise",top:40,left:20,itemWidth:12,itemHeight:12,textGap:4,orient:"horizontal",dimension:0,categories:i.map((function(e){return e})),inRange:{symbol:"rect",color:t.color||u.Fq},outOfRange:{color:"#bfbfbf"},formatter:function(e){return e.startsWith(f)?e.substring(f.length):e}}],dataZoom:[{show:n<1,bottom:20,xAxisIndex:0,height:15,handleSize:"100%",showDetail:!1}],tooltip:{trigger:"axis",formatter:function(e){var t=e[0],a=t.marker,n=t.data,r=t.dimensionNames;return[(0,u.Zi)(n[1]),r[0]+"\uff1a"+(n[0].startsWith(f)?n[0].substring(f.length):n[0]),a+" "+r[2]+"\uff1a"+(100*n[2]).toFixed(2)+"%"].join("</br>")}},xAxis:{type:"category",axisLabel:{rotate:r?45:0,margin:r?15:8,formatter:function(e){return e.length>6?e.substring(0,5)+"...":e}}},yAxis:{type:"value",axisLabel:{formatter:function(e){return 100*e+"%"}}},series:[{type:"bar",datasetIndex:o,barMaxWidth:24,markLine:{symbol:"none",silent:!0,data:[{type:"average",lineStyle:{color:"#BFBFBF"},label:{formatter:function(e){return"{a|"+(100*e.value).toFixed(2)+"%}"},rich:{a:{backgroundColor:"#BFBFBF",color:"#fff",padding:[4,4]}}}}]},encode:{x:1,y:2}}]}},t}return(0,i.Z)(t,e),t.prototype.renderChart=function(e,t,a,n){this.setValue(e,a,n),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t))},t}(l.PureComponent);const y=m;var g=a(8201),v=a(98191),T=a(50976),R=a(94644),C=a(60496),E=a(71997),A=a(45697),S=a.n(A),w=a(43036),b=function(e){var t=e.onChange,a=e.check,n=e.enable,r=void 0===n||n,o=l.useState(a),i=o[0],s=o[1];return l.useEffect((function(){s(a)}),[a]),l.createElement("div",{className:"yt_range_button_wrapper"},l.createElement(w.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:i?"\u5404\u56fe\u72ec\u7acb\u6392\u5e8f":l.createElement("div",null,l.createElement("div",null,"\u6b64\u56fe\u4f5c\u4e3a\u5176\u4ed6\u56fe"),l.createElement("div",null,"\u8868\u7684\u6392\u5e8f\u4f9d\u636e"))},l.createElement("span",{onClick:function(){if(r){var e=!i;t&&t(e),s(e)}},style:{color:i?"#0847a6":"#8c8c8c"},className:"button_trigger "+(r?"enable":"disable")},l.createElement("i",{className:"icon-cem_independent"}))))};b.propTypes={check:S().bool,onChange:S().func,enable:S().bool};const O=b;var k=a(94309),_={positive:"\u6307\u6807\u597d\u8bc4\u7387",negative:"\u6307\u6807\u5dee\u8bc4\u7387"},x=function(e){function t(t){var a;return(a=e.call(this,t)||this).rangeParam=void 0,a.handleOnMoreClick=function(e){var t=a.props,n=t.emotionType,r=t.data;"image"===e&&a.chartRef?(0,R._v)(a.chartRef,_[n]):"data"===e&&(0,g.P)(r)&&(0,R.aT)([a.dataset.reduce((function(e,t){return t.source.forEach((function(t){e.push(t.map((function(e){return e%1||1===e||0===e?(100*e).toFixed(2)+"%":e})))})),e.push(""),e}),[])],_[n])},a.handleOnReceiveMessage=function(e){var t=e.data;if(a.chartRef&&"BarLineCountChart"===t.from)if(t.type===k.P.CHART_MESSAGE){var n=a.dataset[a.datasetIndex].source.findIndex((function(e){return e[1]===t.name}))-1;a.chartRef.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:n})}else t.type===k.P.CHART_MESSAGE_RANGE&&(a.rangeParam=t.rangedNames,a.renderChart(),a.setState({rangeChecked:!1}))},a.handleOnChartClick=function(e){var t=e.componentType,n=a.props,r=n.emotionType,o=n.onClick;"series"===t&&o(e,r)},a.handleOnMouseOver=function(e){var t=e.componentSubType,a=e.name;"bar"===t&&window.postMessage({type:k.P.CHART_MESSAGE,from:"BarLineRateChart",name:a},"*")},a.handleOnRangeClick=function(e){a.rangeParam instanceof Array&&e?(a.rangeParam=function(){a.postUpdateMessage(e)},a.renderChart()):(a.rangeParam=void 0,a.postUpdateMessage(e)),a.setState({rangeChecked:e})},a.postUpdateMessage=function(e){var t="positive"===a.props.emotionType?0:1;window.postMessage({type:k.P.CHART_MESSAGE_RANGE,from:"BarLineRateChart",rangedNames:e?a.dataset[t].source.reduce((function(e,t,a){return a&&e.push(t[1]),e}),[]):void 0})},a.state={rangeChecked:!1},a}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.renderChart(),window.addEventListener("message",this.handleOnReceiveMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this.handleOnReceiveMessage)},a.componentDidUpdate=function(e){var t=this,a=e.data,n=e.emotionType,r=e.filterName,o=this.props,i=o.data,s=o.emotionType,c=o.filterName;((0,g.P)(i)&&JSON.stringify(a)!==JSON.stringify(i)||s!==n||r!==c)&&(this.state.rangeChecked&&(this.rangeParam=function(){t.postUpdateMessage(!0)}),this.renderChart()),!(0,g.P)(i)&&this.chartRef&&(this.chartRef=void 0)},a.renderChart=function(){var t=this.props,a=t.data,n=t.emotionType,r=t.filterName;(0,g.P)(a)&&this.chartRef&&e.prototype.renderChart.call(this,a,n,r,this.rangeParam)},a.render=function(){var e=this.props,t=e.data,a=e.titleOverlay,n=e.loading,r=e.dataAspect2,o=e.updateFlavors,i=e.chartTypeChange,s=e.flavor,c=(e.curShowAspect,e.chartTypeValue),p=this.state.rangeChecked;return l.createElement(g.Z,{className:"yt_product_self_analysis_bar_line_chart",data:t,loading:n,renderTitle:l.createElement(v.Z,{title:_[c.emotionType],titleOverlay:a,data:t,onMoreClick:this.handleOnMoreClick},r&&l.createElement(C.Z,{options:E.Rx,activeObj:c.meAspectType,flavor:s.meAspectType,onFlavorChange:function(e){o({key:"meAspectType",value:e})},onChange:function(e){i({key:"meAspectType",value:e})}}),l.createElement(C.Z,{options:E.V2,activeObj:c.emotionType,flavor:s.emotionType,onFlavorChange:function(e){o({key:"emotionType",value:e.rateEmotionType})},onChange:function(e){i({key:"emotionType",value:e.rateEmotionType})},objName:"rateEmotionType"}),l.createElement(O,{check:p,onChange:this.handleOnRangeClick}))},l.createElement(T.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{click:this.handleOnChartClick,mouseover:this.handleOnMouseOver}}))},t}(y);x.propTypes={data:S().any,emotionType:S().string,titleOverlay:S().oneOf([S().node,S().string]),loading:S().bool,filterName:S().string};var M=a(43144),N=a(23493),P=a.n(N),F=a(18446),I=a.n(F),Z=a(28183),L=function(e){function t(t){var a;return(a=e.call(this,t)||this).handleOnReceiveMessage=function(e){var t=e.data;if(a.chartRef&&"VoiceChart"===t.from&&t.type===k.P.CHART_MESSAGE){var n=a.chartRef.getOption().xAxis[0].data.findIndex((function(e){return e===t.name}));a.chartRef.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:n})}},a.onClick=function(e){if("xAxis"===e.componentType){if(!a.props.dataAspect2)return;var t=a.props.chartTypeValue.meAspectType;a.state.showSingleAspect?a.setState({showSingleAspect:null}):"aspect1"===t?a.setState({showSingleAspect:e.value}):"aspect2"===t&&(a.props.chartTypeChange({key:"meAspectType",value:"aspect1"}),a.setState({showSingleAspect:null}))}},a.state={showSingleAspect:null},a.throttleHandleOnReceiveMessage=P()(a.handleOnReceiveMessage,200),a}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){window.addEventListener("message",this.throttleHandleOnReceiveMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this.throttleHandleOnReceiveMessage)},a.componentDidUpdate=function(e){var t=this,a=this.props,n=a.title,r=a.chartTypeValue,o=a.rangeChecked,i=a.chartState,s=this.state.showSingleAspect,c=r.meAspectType,l=r.emotionType,p=r.allEmotionType;if(this.chartRef&&(0,g.P)(this.data)&&(!I()(this.data,this.dataCopy)||this.chartRef!==this.chartRefCopy||e.chartTypeValue.meAspectType!==c||e.chartTypeValue.emotionType!==l||e.rangeChecked.chart2!==o.chart2||e.chartTypeValue.allEmotionType!==p||e.chartState!==i)){this.dataCopy=JSON.parse(JSON.stringify(this.data)),this.chartRefCopy=this.chartRef;var u=JSON.parse(JSON.stringify(this.data)).sort((function(e,t){var a="negative"===l?"negRate":"posRate";return t[a]-e[a]}));o.chart2&&(u=JSON.parse(JSON.stringify(this.data)).sort((function(e,t){return t[p]-e[p]})));var d=function(e,t,a,n,r){var o=e.map((function(e){return e[a]})),i=.8*n/(42*o.length),s=(0,h.jD)(o.join(""),12)/(.4*n)>1;return{title:{text:t,top:"13"},grid:{left:36,right:36,top:48,bottom:30,containLabel:!0},dataZoom:[{type:"slider",left:"5%",right:"5%",bottom:15,height:16,show:i<1}],tooltip:{trigger:"item",formatter:function(e){return window.postMessage({type:k.P.CHART_MESSAGE,from:"MentionRateChart",name:e.name},"*"),e.marker+" "+e.name+" "+Number(100*e.value).toFixed(2)+"%"}},xAxis:{data:o,triggerEvent:!0,axisLabel:{rotate:s?45:0,margin:s?15:8,formatter:function(e){return e.length>6?e.substring(0,6)+"...":e}}},yAxis:{type:"value",min:0,axisLabel:{formatter:function(e){return(100*e).toFixed(0)+"%"}}},series:{type:"bar",data:e.map((function(e){return"positive"===r?e.posRate:e.negRate})).sort((function(e,t){return e>t})),barMaxWidth:24}}}(u,n,s?"aspect2":c,this.wrapRef.getBoundingClientRect().width,l);this.chartRef.clear(),setTimeout((function(){t.chartRef.setOption(d)}),100)}},a.render=function(){var e=this,t=this.props,a=t.loading,n=t.title,r=t.titleOverlay,o=t.dataAspect2,i=t.chartTypeValue,s=t.chartTypeChange,c=t.chartState,p=t.chartStateChange,u=t.flavor,h=t.updateFlavors,d=t.rangeChecked,f=t.saveRangeChecked,m=i.meAspectType,y=this.state.showSingleAspect?"aspect2":m,A=this.data;return l.createElement("div",{className:"bar_trend_chart",style:{height:"100%"},ref:function(t){return e.wrapRef=t}},l.createElement(g.Z,{data:A,loading:a,style:{height:"100%"},renderTitle:l.createElement(v.Z,{title:n,data:A,titleOverlay:r,onMoreClick:function(t){return function(e,t,a,n,r){if("image"===t)(0,R._v)(e,n);else if("data"===t){var o={"\u6307\u6807\u597d\u8bc4\u7387":"posRate","\u6307\u6807\u5dee\u8bc4\u7387":"negRate"},i=[a.reduce((function(e,t){return[].concat(e,[[t[r],Number(100*t[o[n]]).toFixed(2)+"%"]])}),[["aspect1"===r?"\u4e00\u7ea7\u6307\u6807":"\u4e8c\u7ea7\u6307\u6807",n]])];(0,R.aT)(i,n)}}(e.chartRef,t,A,n,y)}},l.createElement(C.Z,{options:Z.Gn,activeObj:c,onChange:function(e){return p(e)}}),o&&l.createElement(C.Z,{options:E.Rx,activeObj:y,flavor:u.meAspectType,onFlavorChange:function(t){e.setState({showSingleAspect:null}),h({key:"meAspectType",value:t})},onChange:function(t){s({key:"meAspectType",value:t}),e.setState({showSingleAspect:null})}}),l.createElement(C.Z,{options:E.V2,activeObj:i.emotionType,flavor:u.emotionType,onFlavorChange:function(e){h({key:"emotionType",value:e.rateEmotionType})},onChange:function(e){s({key:"emotionType",value:e.rateEmotionType})},objName:"rateEmotionType"}),l.createElement(O,{check:d.chart1,onChange:function(e){return f({rangeChecked:{chart1:e,chart2:!1}})}}))},l.createElement(T.Z,{theme:"yunting_multi_color",className:"yt_echarts_style",option:{},style:{width:"100%",height:"100%"},onChartReady:function(t){return e.chartRef=t},onEvents:{click:this.onClick}})))},(0,M.Z)(t,[{key:"data",get:function(){var e=this.props,t=e.dataAspect1,a=e.dataAspect2,n=e.chartTypeValue.meAspectType,r=this.state.showSingleAspect;return r?a.filter((function(e){return e.aspect1===r})):"aspect1"===n?t:a}}]),t}(l.Component);const V=L;L.propTypes={title:S().string,loading:S().bool,data:S().oneOfType([S().string,S().object]),onClick:S().func};var D=a(33798),j={c1:["cem_histogram-gray","cem_histogram-colour","\u7c07\u72b6\u67f1\u5f62\u56fe"],c2:["cem_division","cem_division-colour","\u5806\u53e0\u67f1\u5f62\u56fe"]},G=function(e){var t=e.chartType,a=e.enable,n=void 0!==a&&a,r=e.notLimitList,o=void 0===r?[]:r,i=e.onChange;return l.createElement("div",{className:"yt-chart-type-radio-wrapper"},Object.keys(j).map((function(e){return l.createElement(w.Z,{key:e,placement:"top",overlay:j[e][2]},l.createElement("span",null,l.createElement(D.Z,{enable:!n||o.includes(e),isActive:t===e,defaultIcon:j[e][0],activeIcon:j[e][1],onClick:function(){return!n&&i(e)}})))})))};G.propTypes={chartType:S().string,enable:S().bool,options:S().object,notLimitList:S().array};var H=["positive","negative","total"],U=a(13941),J=a(87219),W=function(e){function t(t){var a;return(a=e.call(this,t)||this).handleOnReceiveMessage=function(e){var t=e.data;if(a.chartRef&&"MentionRateChart"===t.from&&t.type===k.P.CHART_MESSAGE){var n=H.indexOf(a.props.chartTypeValue.allEmotionType),r=a.chartRef.getOption().dataset[n].source.findIndex((function(e){return e[0]===t.name}));a.chartRef.dispatchAction({type:"showTip",seriesIndex:1,dataIndex:r-1})}},a.onClick=function(e){if(a.props.toPage){var t,n=a.props.chartTypeValue,o=n.meAspectType,i=n.allEmotionType,s=n.emotionType,c=e.eomtionsType?e.eomtionsType:"total"===i?s:i,l="negative"===c?"\u8d1f\u9762":"\u6b63\u9762";if("xAxis"===e.componentType){if(!a.props.dataAspect2)return;return void(a.state.showSingleAspect?a.setState({showSingleAspect:null}):"aspect1"===o?a.setState({showSingleAspect:e.value}):"aspect2"===o&&a.setState({showSingleAspect:null}))}var p,u=a.props,h=u.analysisModel,d=u.dateFilter,f=u.headerFilterParamsNew,m=u.projectId,y=u.treeId,g=null==(t=h[0])?void 0:t.values[0];try{var v="negative"===c?["3"]:["8"],T=e.aspectType?e.aspectType:o.toUpperCase();p={analyseName:g.values?g.values[0].label:g.label,analysisObjs:g.values?g.values.map((function(e){return e.id})):[],aspect:e.name,aspectTotal:e.value[1],dateFilter:d,module:"ANALYZE_MARKETING",filterModel:(0,r.Z)({},(0,U.bF)(f),{analysis:{id:g.id,name:g.label,type:"CONFIG"===h[0].id?"CONN_CONFIG":h[0].id,values:g.values?g.values.map((function(e){return e.id})):[]},aspect:{aspect1:"aspect1"===o?[e.name]:[],aspect2:"aspect1"===o?[]:[e.name],emotion:[c]},treeId:y}),leftName:"\u5ba2\u6237\u5173\u6ce8",projectId:m,seriesName:l,type:"EMOTION_ASPECT_LEVEL_BAR",categoryId:a.props.categoryId,aspectEscoreType:c,headerFilterParamsNew:(0,J.ZP)(f,(function(t){var a=t.find((function(e){return"ASPECT_MODEL"===e.id}));a?(a.values.find((function(e){return"ASPECT_ESCORE"===e.id}))?t.find((function(e){return"ASPECT_MODEL"===e.id})).values.find((function(e){return"ASPECT_ESCORE"===e.id})).values=v:a.values.push({id:"ASPECT_ESCORE",label:"\u6307\u6807\u60c5\u611f",values:v}),a.values.find((function(e){return e.id===T}))?t.find((function(e){return"ASPECT_MODEL"===e.id})).values.find((function(e){return e.id===T})).values=[e.name]:a.values.push({id:T,values:[e.name]})):t.push({id:"ASPECT_MODEL",values:[{id:"ASPECT_ESCORE",label:"\u6307\u6807\u60c5\u611f",values:v},{id:T,values:[e.name]}]})}))}}catch(R){}window.open("/tab/aspectDetail?"+encodeURIComponent(JSON.stringify(p)))}},a.state={chartType:"c1",showSingleAspect:null},a.throttleHandleOnReceiveMessage=P()(a.handleOnReceiveMessage,200),a}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){window.addEventListener("message",this.throttleHandleOnReceiveMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this.throttleHandleOnReceiveMessage)},a.componentDidUpdate=function(e,t){var a=this,n=this.props,r=(n.title,n.chartTypeValue),o=n.rangeChecked,i=n.chartState,s=r.emotionType,c=r.allEmotionType,l=r.meAspectType;if(this.chartRef&&this.wrapRef&&(0,g.P)(this.data)&&(!I()(this.data,this.dataCopy)||this.chartRef!==this.chartRefCopy||this.state.chartType!==t.chartType||e.chartTypeValue.allEmotionType!==c||e.chartTypeValue.meAspectType!==l||e.chartTypeValue.emotionType!==s||e.rangeChecked.chart1!==o.chart1||e.chartState!==i)){this.dataCopy=JSON.parse(JSON.stringify(this.data)),this.chartRefCopy=this.chartRef;var p=this.state,d=(p.chartType,p.showSingleAspect),f=this.props.chartTypeValue.meAspectType,m=JSON.parse(JSON.stringify(this.data)).sort((function(e,t){return t[c]-e[c]}));o.chart1&&(m=JSON.parse(JSON.stringify(this.data)).sort((function(e,t){var a="negative"===s?"negRate":"posRate";return t[a]-e[a]})));var y=function(e,t,a,n,r,o){var i=e.map((function(e){return e[a]})),s=.8*r/(42*i.length),c=(0,h.jD)(i.join(""),12)/(.4*r)>1,l=H.indexOf(o),p=[{source:[["\u6307\u6807","\u6307\u6807\u6b63\u9762\u58f0\u91cf","\u6307\u6807\u63d0\u53ca\u7387"]]},{source:[["\u6307\u6807","\u6307\u6807\u8d1f\u9762\u58f0\u91cf","\u6307\u6807\u63d0\u53ca\u7387"]]},{source:[["\u6307\u6807","\u6307\u6807\u58f0\u91cf","\u6307\u6807\u63d0\u53ca\u7387"]]}];return p.forEach((function(t,n){e.forEach((function(e){t.source.push([e[a],e[H[n]],e[H[n]]/e.messageTotal])}))})),{title:{text:p[l].source[0][1]},dataset:p,grid:{top:80,left:36,right:36,bottom:c?60:s<1?50:30,containLabel:!0},legend:{left:20,top:40,itemWidth:12,itemHeight:12,data:[p[l].source[0][2]],icon:u.W4.lineRing},dataZoom:[{show:s<1,bottom:20,xAxisIndex:0,height:15,handleSize:"100%",showDetail:!1}],tooltip:{trigger:"axis",formatter:function(e){window.postMessage({type:k.P.CHART_MESSAGE,from:"VoiceChart",name:e[0].name},"*");var t=e.find((function(e){return"line"===e.componentSubType})),a=e.find((function(e){return"bar"===e.componentSubType}));return[(0,u.Zi)(e[0].name),a.marker+" "+a.dimensionNames[1]+"\uff1a"+a.data[1],t?t.marker+" "+t.dimensionNames[2]+"\uff1a"+(100*t.data[2]).toFixed(2)+"%":""].join("</br>")}},xAxis:[0,1].map((function(e){return{type:"category",show:!e,axisLabel:e?void 0:{rotate:c?45:0,margin:c?15:8,formatter:function(e){return(null==e?void 0:e.length)>6?e.substring(0,5)+"...":e}}}})),yAxis:[0,1].map((function(e){return{type:"value",splitNumber:3,position:e?"right":"left",minInterval:e?1:void 0,axisLabel:{formatter:function(t){return e?t:(100*t).toFixed(2)+"%"}}}})),series:[{type:"line",datasetIndex:l,yAxisIndex:0,xAxisIndex:0,itemStyle:{color:"#D96969"},encode:{x:0,y:2,seriesName:2}},{type:"bar",datasetIndex:l,xAxisIndex:0,yAxisIndex:1,barMaxWidth:24,itemStyle:{color:u.Fq[0]},encode:{x:0,y:1}}]}}(m,0,d?"aspect2":f,0,this.wrapRef.getBoundingClientRect().width,r.allEmotionType);this.chartRef.clear(),setTimeout((function(){a.chartRef.setOption(y)}),100)}},a.render=function(){var e=this,t=this.props,a=t.loading,n=t.title,r=t.titleOverlay,o=(t.dataAspect2,t.flavor),i=t.chartTypeValue,s=t.updateFlavors,c=t.chartTypeChange,p=t.rangeChecked,u=t.saveRangeChecked,h=this.state,d=(h.chartType,h.showSingleAspect),f=i.meAspectType,m=(i.allEmotionType,d?"aspect2":f),y=this.data,A=this.onClick;return l.createElement("div",{className:"bar_trend_chart",style:{height:"100%"},ref:function(t){return e.wrapRef=t}},l.createElement(g.Z,{data:y,loading:a,style:{height:"100%"},renderTitle:l.createElement(v.Z,{title:n,data:y,titleOverlay:r,onMoreClick:function(t){return function(e,t,a,n,r){if("image"===t)(0,R._v)(e,n);else if("data"===t){var o={"\u6307\u6807\u58f0\u91cf":{key:"total",title:"\u6307\u6807\u58f0\u91cf",messageRage:function(e){return(100*e.menRate).toFixed(2)+"%"}},"\u6307\u6807\u6b63\u9762\u58f0\u91cf":{key:"positive",title:"\u6b63\u9762",messageRage:function(e){return 0===e.messageTotal?"0.00%":(e.positive/e.messageTotal*100).toFixed(2)+"%"}},"\u6307\u6807\u8d1f\u9762\u58f0\u91cf":{key:"negative",title:"\u8d1f\u9762",messageRage:function(e){return 0===e.messageTotal?"0.00%":(e.negative/e.messageTotal*100).toFixed(2)+"%"}}},i=[a.reduce((function(e,t){return[].concat(e,[[t[r],t[o[n].key],o[n].messageRage(t),t.messageTotal]])}),[["aspect1"===r?"\u4e00\u7ea7\u6307\u6807":"\u4e8c\u7ea7\u6307\u6807",o[n].title,"\u6307\u6807\u63d0\u53ca\u7387","\u6d88\u606f\u603b\u6570"]])];(0,R.aT)(i,n)}}(e.chartRef,t,y,n,m)}},l.createElement(C.Z,{options:E.jg,activeObj:i.allEmotionType,flavor:o.allEmotionType,onFlavorChange:function(e){return s({key:"allEmotionType",value:e.countEmotionType})},onChange:function(e){return c({key:"allEmotionType",value:e.countEmotionType})},objName:"countEmotionType"}),l.createElement(O,{check:p.chart2,onChange:function(e){return u({rangeChecked:{chart1:!1,chart2:e}})}}))},l.createElement(T.Z,{theme:"yunting_neg_pos",className:"yt_echarts_style",option:{},style:{width:"100%",height:"100%"},onChartReady:function(t){return e.chartRef=t},onEvents:{click:A}})))},(0,M.Z)(t,[{key:"data",get:function(){var e=this.props,t=e.dataAspect1,a=e.dataAspect2,n=e.chartTypeValue,r=this.state.showSingleAspect,o=n.meAspectType;return r?a.filter((function(e){return e.aspect1===r})):"aspect1"===o?t:a}}]),t}(l.Component);const B=W;W.propTypes={title:S().string,loading:S().bool,toPage:S().bool,data:S().oneOfType([S().string,S().object]),onClick:S().func};var z=a(94530),K=a(35103),q=a(86767),Q=a(61193),X=a(35239),Y=a(5724),$=["onFilterChange","onFilterReady","selectValue","dataAspect1","dataAspect2","metion","positiveRate","negativeRate","setCompare","MentionRateLoading","mentionLoading","positiveRateLoading","negativeRateLoading","chartTypeValue","flavor","chartTypeChange","updateFlavors","publicResource","chartData1","chartData2","curShowAspect"],ee={positive:"\u6307\u6807\u597d\u8bc4\u7387",negative:"\u6307\u6807\u5dee\u8bc4\u7387"},te={total:"\u6307\u6807\u58f0\u91cf",allEmotionType:"\u6307\u6807\u58f0\u91cf",positive:"\u6307\u6807\u6b63\u9762\u58f0\u91cf",negative:"\u6307\u6807\u8d1f\u9762\u58f0\u91cf"},ae=function(){var e,t=null==(e=Q.Z.getAuthority())?void 0:e.filter((function(e){return e.startsWith("MESSAGE")}));return t&&t.length?E.ou.filter((function(e){return t.some((function(t){return t==="MESSAGE_"+e.split("_")[2]}))})):E.ou},ne=ae();const re=function(e){var t=e.onFilterChange,a=e.onFilterReady,o=e.selectValue,i=e.dataAspect1,s=e.dataAspect2,c=e.metion,u=e.positiveRate,h=e.negativeRate,d=e.setCompare,f=(e.MentionRateLoading,e.mentionLoading),m=e.positiveRateLoading,y=e.negativeRateLoading,g=e.chartTypeValue,v=e.flavor,T=e.chartTypeChange,R=e.updateFlavors,C=(e.publicResource,e.chartData1,e.chartData2,e.curShowAspect,(0,n.Z)(e,$));l.useEffect((function(){(0,Y.xz)().then((function(e){var t=e[0].CHECK_OWNER.data;ne=ae().filter((function(e){var a,n;return(null==(a=t.find((function(t){return t.pageType===e&&t.projectId===X.t.get(X.V.curProject).id})))||null==(n=a.ownerChecks)?void 0:n.length)>0}))}))}),[]);var A=o||ne&&ne[0],S=["fullDate","screening","save"],w=(0,l.useState)("MULTI"),b=w[0],O=w[1],k=(0,l.useState)(null),_=k[0],x=k[1];return l.createElement("div",{className:"yt_marketAnalysis_aspectAnalysis_wrapper"},l.createElement(K.Z,{onReady:a,onChange:t,pageType:A||"MARKET_INSIGHT_PRODUCT_COMPARE",resourceKeys:"ASPECT_TREE.data.ANALYZE_MARKETING",advanceAuthority:!1,valueConf:["fullInfo"],touchData:ne,selectValue:A,showList:ne&&ne instanceof Array&&ne.length?[].concat(S,["sourceSearch"]):S,hasHour:!0},l.createElement("div",{className:"content"},l.createElement(p.Z,{className:"aspect_card",orientation:"horizontal",colNumber:4,showList:["com_key1","com_key2","com_key3"]},l.createElement(z.Z,{key:"com_key1",data:(0,E.LK)(c),tip:(0,E.QS)(),compare:c&&c.sameRateType,style:{width:"100%",height:"160px"},onSetting:function(e){return d({cartType:"ASPECT_MENTION_RATE_CARD",sameRateType:e.compareValue})},loading:f}),l.createElement(z.Z,{key:"com_key2",data:(0,E.jr)(u),tip:(0,E.gF)(),compare:u&&u.sameRateType,style:{width:"100%",height:"160px"},onSetting:function(e){return d({cartType:"POSITIVE_ASPECT_RATE_CARD",sameRateType:e.compareValue})},loading:m}),l.createElement(z.Z,{key:"com_key3",data:(0,E.nW)(h),tip:(0,E.Oy)(),compare:h&&h.sameRateType,style:{width:"100%",height:"160px"},onSetting:function(e){return d({cartType:"NEGATIVE_ASPECT_RATE_CARD",sameRateType:e.compareValue})},loading:y})),l.createElement(p.Z,{className:"chart_wrap",orientation:"vertical",showList:["w1","w2","w3"]},l.createElement("div",{key:"w1",className:"bar_chart",style:{display:"MULTI"===b?"block":"none"}},l.createElement(V,(0,r.Z)({title:ee[g.emotionType],titleOverlay:l.createElement(l.Fragment,null,l.createElement("div",null,"\u300c\u6307\u6807\u597d\u8bc4\u7387\u300d\u6307\u6807\u6b63\u9762\u58f0\u91cf\xf7\uff08\u6307\u6807\u6b63\u9762\u58f0\u91cf + \u6307\u6807\u8d1f\u9762\u58f0\u91cf\uff09\u3002"),l.createElement("div",null,"\u300c\u6307\u6807\u5dee\u8bc4\u7387\u300d\u6307\u6807\u8d1f\u9762\u58f0\u91cf\xf7\uff08\u6307\u6807\u6b63\u9762\u58f0\u91cf + \u6307\u6807\u8d1f\u9762\u58f0\u91cf\uff09\u3002")),dataAspect1:i,dataAspect2:s,chartTypeValue:g,flavor:v,chartState:b,chartStateChange:function(e){return O(e)},chartTypeChange:T,updateFlavors:R},C))),l.createElement("div",{key:"w2",className:"bar_chart",style:{display:"MULTI"===b?"block":"none"}},l.createElement(B,(0,r.Z)({ref:function(e){return x(e)},title:te[g.allEmotionType],dataAspect1:i,dataAspect2:s,chartTypeValue:g,flavor:v,chartState:b,chartTypeChange:T,updateFlavors:R,toPage:!0},C))),"MULTI"!==b&&l.createElement("div",{key:"w3",className:"bar_chart"},l.createElement(q.Z,(0,r.Z)({},C,{dataAspect1:Array.isArray(i)?null==i?void 0:i.sort((function(e,t){return t.total-e.total})):i,dataAspect2:Array.isArray(s)?null==s?void 0:s.sort((function(e,t){return t.total-e.total})):s,onChartClick:function(e,t){"showType"===e&&O(t)},onMsgClick:function(e){return"analyze"===e.type?_.onClick(e):C.onOpenMsg(e)}})))))))};var oe=a(55609),ie=a(64396),se=a(17238),ce=a(53113),le=a(64740),pe=["loading"],ue=function(e){function t(t){var a;return(a=e.call(this,t)||this)._handleFilterReady=function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.fetchParams({projectId:X.t.get(X.V.curProject).id,headerFilterParamsNew:t.headerFilterParamsNew,dateFilter:t.dateFilter,analysisModel:n.fullInfo.analysisModel,categoryId:n.categoryId});case 2:a.fetchData();case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),a._handleFilterChange=function(){var e=(0,o.Z)(c().mark((function e(t,n,o){var i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,ce.X)(t.dateFilter.numOfDays,!0),s=i.defaultDateType,i.dateOptions,e.next=3,a.props.save({headerFilterParamsNew:t.headerFilterParamsNew,dateFilter:(0,r.Z)({},t.dateFilter,{dateGroupType:s}),analysisModel:n.fullInfo.analysisModel,selectValue:n.selectValue,categoryId:n.categoryId});case 3:a.fetchData();case 4:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),a.fetchData=(0,o.Z)(c().mark((function e(){var t,n,r,o,i,s,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.fetchMentionRate,r=t.save,o=t.getMention,i=t.getPositiveRate,s=t.getNegativeRate,l=t.fetchBusinessPointList,r({dataAspect1:void 0,dataAspect2:void 0,metion:void 0,positiveRate:void 0,negativeRate:void 0}),e.next=4,l();case 4:Promise.all([n({aspectType:"aspect2"}),o(),i(),s()]).then((function(){}));case 5:case"end":return e.stop()}}),e)}))),a._handleOpenMsg=function(e){var t=e.type,n=e.name,r=a.props,o=r.dateFilter,i=r.projectId,s=r.headerFilterParamsNew,c=r.analysisModel,l=void 0===c?[]:c,p=r.categoryId,u=le.X3[p],h=le.Qe[p],d={dateFilter:o,filterModel:{project:[i],messageCategory:[u]},filterValues:(0,J.ZP)(l,(function(e){(0,le.OM)(e,t,n)})),headerFilterParamsNew:(0,J.ZP)(s,(function(e){(0,le.OM)(e,t,n)})),projectId:i,filterTip:null};window.open("/inbox/"+h+"?"+encodeURIComponent(JSON.stringify(d)))},a.event={onFilterReady:a._handleFilterReady,onFilterChange:a._handleFilterChange,onOpenMsg:a._handleOpenMsg},a}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=X.t.get(X.V.curProject).id;this.props.fetchAspectTreeId({projectId:e})},a.componentWillUnmount=function(){this.props.clean()},a.render=function(){return l.createElement(re,(0,r.Z)({},this.props,this.state,this.event))},t}(l.PureComponent);const he=(0,oe.connect)((function(e){var t=e.loading,a=(0,n.Z)(e,pe);return(0,r.Z)({},a[se.namespace],{publicResource:a[ie.Z.global].publicResource,MentionRateLoading:t.effects[se.namespace+"/fetchMentionRate"]||!1,mentionLoading:t.effects[se.namespace+"/getMention"]||!1,positiveRateLoading:t.effects[se.namespace+"/getPositiveRate"]||!1,negativeRateLoading:t.effects[se.namespace+"/getNegativeRate"]||!1})}),(function(e){return{save:function(t){return e({type:se.namespace+"/save",payload:t})},clean:function(){return e({type:se.namespace+"/clean"})},saveRangeChecked:function(t){return e({type:se.namespace+"/saveRangeChecked",payload:t})},fetchParams:function(t){return e({type:se.namespace+"/fetchParams",payload:t})},updateFlavors:function(t){return e({type:se.namespace+"/updateFlavors",payload:t})},fetchMentionRate:function(t){return e({type:se.namespace+"/fetchMentionRate",payload:t})},getMention:function(){return e({type:se.namespace+"/getMention"})},getPositiveRate:function(){return e({type:se.namespace+"/getPositiveRate"})},getNegativeRate:function(){return e({type:se.namespace+"/getNegativeRate"})},setCompare:function(t){return e({type:se.namespace+"/setCompare",payload:t})},chartTypeChange:function(t){return e({type:se.namespace+"/chartTypeChange",payload:t})},fetchBusinessPointList:function(){return e({type:se.namespace+"/fetchBusinessPointList"})},fetchAspectTreeId:function(t){return e({type:se.namespace+"/fetchAspectTreeId",payload:t})}}}))(ue)}}]);