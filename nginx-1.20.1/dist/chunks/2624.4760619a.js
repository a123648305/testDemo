"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2624],{1374:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294);const r=function(e){var t=e.src,n=e.defaultImg,r=e.timeoutTime,i=void 0===r?1e3:r,l=(0,a.useState)(t),o=l[0],c=l[1];return(0,a.useEffect)((function(){var e=new Image;e.src=t;var a=setTimeout((function(){c(n),e.onerror=null}),i);return e.onload=function(n){e.onload=null,clearTimeout(a),c(t)},e.onerror=function(t){e.onerror=null,clearTimeout(a),c(n)},function(){clearTimeout(a)}}),[t]),a.createElement("img",{src:o,alt:""})}},18863:(e,t,n)=>{n.d(t,{n0:()=>i,gi:()=>l,uh:()=>o});var a=n(23279),r={OFFICIAL_REPLY:"\u5b98\u65b9\u56de\u590d"};function i(e,t){void 0===t&&(t="hide");var n=r[e.dataLevel]||e.username||e.uid||"",a=e.phoneNumber,i=e.email;if("showPart"===t)if(n=n.substring(0,1)+new Array(n.length).join("*"),a=a?a.substring(0,3)+"****"+a.substring(7)+"}":"--",i){var l,o=null!=(l=i)&&l.includes("@")?i.split("@"):"";i=o&&(o[0].length>2?o[0].substring(0,2):"")+"***@"+o[1]}else i="--";else"hide"===t&&(n="***",a="***",i="***");return a=a||"--",i=i||"--",{contactId:e.contactId,phoneNumber:a,email:i,username:n,existContact:e.existContact,messageCategory:e.messageCategory}}var l=n.n(a)()((function(e){var t=JSON.stringify({customerId:e});window.open("/customerFile/customerDetail?"+encodeURIComponent(t))}),200),o=function(e){var t=c(c(e)),n=document.createElement("div");return n.innerHTML=t,n.innerText},c=function(e){var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e&&e.replace(/&(lt|gt|nbsp|amp|quot);/gi,(function(e,n){return t[n]}))}},33800:(e,t,n)=>{n.d(t,{Z:()=>c});n(53294);var a=n(56697),r=(n(1025),n(65400)),i=(n(89858),n(51024)),l=n(67294),o=i.default.TextArea;const c=function(e){var t=e.isShow,n=e.closeShow,i=e.handleSubmitRemark,c=(0,l.useState)(""),s=c[0],u=c[1],d=function(){u("")};return l.createElement(l.Fragment,null,l.createElement(a.Z,{title:null,footer:null,visible:t,closable:!1,width:600},l.createElement("div",{style:{marginTop:"10px"}},l.createElement("div",{style:{marginBottom:"20px"}},l.createElement("span",{style:{color:"#F08A8A"}},"*"),l.createElement("span",{style:{fontSize:"16px",marginLeft:"10px"}},"\u5907\u6ce8")),l.createElement(o,{placeholder:"\u8bf7\u8f93\u5165\u2026",onChange:function(e){!function(e){u(e.target.value)}(e)},className:"add_remark",value:s,maxLength:500,showCount:!0})),l.createElement("div",{style:{marginTop:"40px",textAlign:"right"}},l.createElement(r.default,{onClick:function(){d(),n()}},"\u53d6\u6d88"),l.createElement(r.default,{type:"primary",disabled:s.length<=0,onClick:function(){i(s),d()}},"\u786e\u8ba4"))))}},69042:(e,t,n)=>{n.d(t,{Z:()=>L});var a=n(87462),r=(n(54277),n(74048)),i=(n(1025),n(65400)),l=(n(75314),n(11187)),o=n(15861),c=n(87757),s=n.n(c),u=n(67294),d=(n(53294),n(56697)),m=(n(89858),n(51024).default.TextArea);const f=function(e){var t=e.isShowEditRemark,n=(e._handleShowRemark,e.closeIsShowEditRemark),r=e.title,l=e.onOk,c=e.value,f=(e.disabled,e.statusOptions),p=e.isRequired,h=e.remarkType,g=(0,u.useState)(!1),v=g[0],E=g[1],k=(0,u.useState)({remark:"",value:c}),S=k[0],w=k[1],I=(0,u.useState)(!1),y=I[0],C=I[1],b=(0,u.useState)(p),N=b[0],D=b[1];(0,u.useEffect)((function(){t&&(w({remark:"",value:c}),D(p),C(!1))}),[t,c]);var L=function(){var e=(0,o.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N||S.remark){e.next=3;break}return C(!0),e.abrupt("return",!1);case 3:if(e.t0="function"===typeof l,!e.t0){e.next=8;break}return e.next=7,l(Object.assign(S,{remarkContent:S.remark,remindUserIds:""}));case 7:e.t0=e.sent;case 8:t=e.t0,E(!1),t&&(n(!1),w({remark:"",value:c}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return u.createElement(u.Fragment,null,u.createElement(d.Z,{title:r,footer:null,visible:t,width:480,destroyOnClose:!0,onCancel:function(){return n(!1)}},u.createElement(e.children,(0,a.Z)({},e,{value:S.value,onChange:function(e){f.filter((function(t){return""+t.id===e})).length>0&&D(f.filter((function(t){return""+t.id===e}))[0].isRemark),w((0,a.Z)({},S,{value:e}))}})),u.createElement("div",{style:{display:"flex",justifyContent:"flex-start"}},u.createElement("div",{style:{width:"tk-assign"===h?"82px":["tk-back","tk-changeState","tk-done","tk-nextState"].includes(h)?"68px":"auto",textAlign:"right",flex:"none"}},N&&u.createElement("span",{style:{color:"#F08A8A"}},"*"),u.createElement("span",{style:{fontSize:"14px",marginLeft:"4px",color:"#8C8C8C"}},"\u5907\u6ce8")),u.createElement("div",{style:{marginBottom:"24px",flexShrink:1,flexGrow:1}},u.createElement(m,{placeholder:"\u8bf7\u8f93\u5165\u2026",maxLength:500,value:S.remark,showCount:!0,className:"add_remark",style:{marginLeft:"10px"},onChange:function(e){w((0,a.Z)({},S,{remark:e.target.value})),e.target.value&&C(!1)}}),y&&u.createElement("p",{style:{color:"#F08A8A",marginLeft:"10px"}},"\u8bf7\u6dfb\u52a0\u5907\u6ce8\uff01"))),u.createElement("div",{style:{textAlign:"right"}},u.createElement(i.default,{onClick:function(){n(!1)}},"\u53d6\u6d88"),u.createElement(i.default,{type:"primary",loading:v,onClick:L},"\u786e\u8ba4"))))};const p=function(e){return u.createElement(u.Fragment,null)};var h=n(21524);const g=function(e){var t=e.userList,n=(e.schema,e.value),a=e.onChange;return u.createElement("div",{className:"assignor-select-box"},u.createElement("div",{className:"assignor-select-left"},u.createElement("span",{style:{color:"#F08A8A"}},"*"),u.createElement("span",{className:"label"},"\u9009\u62e9\u5904\u7406\u4eba")),u.createElement(h.Q,{onChange:function(e){"function"===typeof a&&a(e)},className:"fast-assignor-select",options:t,value:n,width:400}))};n(35797);var v=n(64749),E=(v.default.Option,{PENDING:"icon-daichuli",PROCESSING:"icon-jinhangzhong",FINISHED:"icon-yiwancheng"}),k={PENDING:"pending",PROCESSING:"processing",FINISHED:"finished"};const S=function(e){var t=e.value,n=e.defaultValue,a=e.options,r=e.onChange,i=e.disabled;return u.createElement(v.default,{defaultValue:n,value:t,showArrow:!1,bordered:!1,dropdownMatchSelectWidth:!1,className:function(){var e,r=t||n,i=null!=(e=null==a?void 0:a.find((function(e){return e.value===r})))?e:null;return i?k[i.kind]:null}()+" status-select",dropdownClassName:"status-select-dropdown",onChange:function(e){"function"===typeof r&&r(e)},disabled:i},a.map((function(e){return u.createElement(v.default.Option,{key:e.value,value:e.value,className:"status-option "+k[e.kind]+"-option"},u.createElement("i",{className:E[e.kind]+" icon"}),u.createElement("span",{className:"label"},e.label))})))};const w=function(e){var t,n=e.value,a=e.statusOptions,r=e.onChange,i=e.disabled;return u.createElement(u.Fragment,null,u.createElement("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",marginBottom:"20px"}},u.createElement("div",{style:{width:"68px",textAlign:"right",marginRight:"10px"}},u.createElement("span",{style:{color:"#F08A8A"}},"*"),u.createElement("span",{style:{fontSize:"14px",marginLeft:"4px",color:"#8C8C8C"}},"\u9009\u62e9\u72b6\u6001")),u.createElement(S,{value:n,options:null!=(t=null==a?void 0:a.map((function(e){return{label:e.name,value:""+e.id,kind:e.kind}})))?t:[],disabled:i,onChange:function(e){"function"===typeof r&&r(e)}})))};var I={"tk-startHandle":p,"tk-assign":g,"tk-nextState":w,"tk-changeState":w,"tk-back":w,"tk-done":w},y={"tk-startHandle":"\u5f00\u59cb\u5904\u7406","tk-assign":"\u5de5\u5355\u6307\u6d3e","tk-nextState":"\u4e0b\u4e00\u4e2a\u72b6\u6001","tk-changeState":"\u53d8\u66f4\u72b6\u6001","tk-back":"\u72b6\u6001\u56de\u9000","tk-done":"\u5b8c\u6210"},C={"tk-startHandle":"START","tk-nextState":"NEXT","tk-back":"BACK","tk-done":"FINISH"},b=n(2796),N=n(35239),D=n(40553);const L=function(e){var t,n,c,d,m,p,h=e.showBtns,g=e.statusOptions,v=void 0===g?[]:g,E=e.workOrderId,k=e.status,S=e.assignee,w=e.moveKind,L=e.onStateChange,O=["start","ongoing","beforeEnd","isEnd"],x=function(){var e=v.findIndex((function(e){return String(e.id)===String(k)}));return O[0===e?e:e===v.length-1?3:w===D.uz[0]&&e===v.length-2?2:1]},T=(0,u.useState)(""),R=T[0],A=T[1],F=(0,u.useState)(!1),_=F[0],Z=F[1],W=function(e,t){A(e),Z(!0)},j=function(){var e=(0,o.Z)(s().mark((function e(t,n){var a,r,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.value!==k){e.next=3;break}return l.default.warning("\u8bf7\u66f4\u65b0\u72b6\u6001"),e.abrupt("return",!1);case 3:return a={projectId:N.t.get(N.V.curProject).id,rankAfterId:null,remark:t.remark||"",sameState:!1,stateId:+t.value,workOrderId:E,moveOperateKind:C[n]||"MOVE"},e.prev=4,e.next=7,(0,b.Lm)(a);case 7:if(2e4!==e.sent.data.code){e.next=14;break}return r=v.find((function(e){return String(e.id)===String(t.value)})),l.default.success("tk-startHandle"===R?"\u5f00\u59cb\u5904\u7406\u5de5\u5355\uff0c\u72b6\u6001\u53d8\u66f4\u4e3a"+r.name:"\u64cd\u4f5c\u6210\u529f\uff0c\u72b6\u6001\u53d8\u66f4\u4e3a"+r.name),A(""),L("update-btn-state",t.value),e.abrupt("return",!0);case 14:e.next=29;break;case 16:if(e.prev=16,e.t0=e.catch(4),52012!==(o=(null==e.t0||null==(i=e.t0.data)?void 0:i.code)||"")){e.next=22;break}return l.default.warning("\u60a8\u6ca1\u6709\u6743\u9650\u53d8\u66f4\u6b64\u5de5\u5355\u72b6\u6001\uff0c\u8bf7\u8054\u7cfb\u5de5\u5355\u521b\u5efa\u4eba\u6216\u5f53\u524d\u5904\u7406\u4eba"),e.abrupt("return",!1);case 22:if(40010!==o){e.next=25;break}return l.default.warning("\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u7ba1\u7406\u5458\u66f4\u65b0\u4e86\u5de5\u5355\u72b6\u6001\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u64cd\u4f5c"),e.abrupt("return",!1);case 25:if(40009!==o){e.next=28;break}return l.default.warning("\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u7ba1\u7406\u5458\u66f4\u65b0\u4e86\u5de5\u5355\u72b6\u6001\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u64cd\u4f5c"),e.abrupt("return",!1);case 28:return e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=(0,o.Z)(s().mark((function e(t){var n,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={projectId:N.t.get(N.V.curProject).id,assigneeId:t.value,refId:"",remarkContent:t.remarkContent,remindUserIds:t.remindUserIds||[],workOrderId:E},e.prev=1,e.next=4,(0,b.cL)(n);case 4:if(2e4!==e.sent.data.code){e.next=10;break}return A(""),l.default.success("\u64cd\u4f5c\u6210\u529f\uff01"),L("update-btn-asn",t.value),e.abrupt("return",!0);case 10:e.next=22;break;case 12:if(e.prev=12,e.t0=e.catch(1),52012!==(r=(null==e.t0||null==(a=e.t0.data)?void 0:a.code)||"")){e.next=18;break}return l.default.error("\u60a8\u6ca1\u6709\u6743\u9650\u53d8\u66f4\u6b64\u5de5\u5355\u5904\u7406\u4eba\uff0c\u8bf7\u8054\u7cfb\u5de5\u5355\u521b\u5efa\u4eba\u6216\u5f53\u524d\u5904\u7406\u4eba"),e.abrupt("return",!1);case 18:if(50304!==r){e.next=21;break}return l.default.error("\u8be5\u7528\u6237\u5df2\u88ab\u7981\u7528\uff0c\u8bf7\u9009\u62e9\u5176\u4ed6\u7528\u6237"),e.abrupt("return",!1);case 21:return e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=(0,o.Z)(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=R,e.next="tk-assign"===e.t0?3:"tk-startHandle"===e.t0||"tk-nextState"===e.t0||"tk-changeState"===e.t0||"tk-done"===e.t0||"tk-back"===e.t0?6:9;break;case 3:return e.next=5,V(t);case 5:case 8:return e.abrupt("return",e.sent);case 6:return e.next=8,j(t,R);case 9:return e.abrupt("break",10);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return u.createElement(u.Fragment,null,u.createElement(r.default,{className:"fast-btn"},x()!==O[3]&&(null==(t=null==h?void 0:h.includes("tk-assign"))||t)&&u.createElement(i.default,{onClick:function(){return W("tk-assign")}},"\u6307\u6d3e\u7ed9"),x()===O[0]&&(null==(n=null==h?void 0:h.includes("tk-startHandle"))||n)&&u.createElement(i.default,{onClick:function(){return W("tk-startHandle")}},"\u5f00\u59cb\u5904\u7406"),x()===O[1]&&(null==(c=null==h?void 0:h.includes("tk-nextState"))||c)&&w===D.uz[0]&&u.createElement(i.default,{onClick:function(){return W("tk-nextState")}},"\u4e0b\u4e00\u4e2a\u72b6\u6001"),x()!==O[0]&&(null==(d=null==h?void 0:h.includes("tk-changeState"))||d)&&w===D.uz[1]&&u.createElement(i.default,{onClick:function(){return W("tk-changeState")}},"\u53d8\u66f4\u72b6\u6001"),(w===D.uz[0]&&x()===O[2]||w===D.uz[1]&&x()===O[1])&&(null==(m=null==h?void 0:h.includes("tk-done"))||m)&&u.createElement(i.default,{onClick:function(){return W("tk-done")}},"\u5b8c\u6210"),x()!==O[0]&&(null==(p=null==h?void 0:h.includes("tk-back"))||p)&&u.createElement(i.default,{onClick:function(){return W("tk-back")}},"\u72b6\u6001\u56de\u9000")),R&&u.createElement(f,(0,a.Z)({},e,{value:function(){var e=v.findIndex((function(e){return String(e.id)===String(k)}));switch(R){case"tk-assign":return S||"";case"tk-startHandle":case"tk-nextState":return String(v[e+1].id);case"tk-changeState":return k;case"tk-done":return String(v[v.length-1].id);case"tk-back":return String(v[e-1].id)}return!1}(),isRequired:function(){var e=v.findIndex((function(e){return String(e.id)===String(k)}));switch(R){case"tk-assign":case"tk-changeState":return v[e].isRemark;case"tk-startHandle":case"tk-nextState":return v[e+1].isRemark;case"tk-done":return v[v.length-1].isRemark;case"tk-back":return v[e-1].isRemark}return!1}(),title:y[R],isShowEditRemark:_,closeIsShowEditRemark:function(){Z(!1)},statusOptions:v,onOk:M,disabled:["tk-done","tk-nextState","tk-back"].includes(R),remarkType:R}),I[R]))}},40553:(e,t,n)=>{n.d(t,{C4:()=>c,He:()=>s,G$:()=>u,Ez:()=>d,l2:()=>m,qq:()=>f,jQ:()=>p,zE:()=>h,uz:()=>g,g3:()=>v});var a=n(87462),r=n(30381),i=n.n(r),l=n(13013),o="HH:mm",c=function(e){var t="string"===typeof e?i()(e,"YYYY/MM/DD HH:mm"):e;if(t.get("year")!==i()().get("year"))return t.format("YYYY/MM/DD HH:mm");var n=new Date(t.format("YYYY/MM/DD")),a=new Date,r=(n-a)/1e3/60/60/24,l=a.getDay()||7;return r<14-l&&-7-l<r?r>-2&&r<=1?(r<0?r<0&&r>-1?"\u4eca\u5929":"\u6628\u5929":"\u660e\u5929")+" "+t.format(o):(r>7-l?"\u4e0b":r<-a.getDay()?"\u4e0a":"")+["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"][n.getDay()]+" "+t.format(o):t.format("MM/DD HH:mm")},s={bordered:!1,className:"no-focus",placeholder:"\u5f85\u6dfb\u52a0"},u=(0,a.Z)({},s,{className:"no-focus icon-cem_pull-down-or-take-up",showArrow:!1}),d=function(e){return new RegExp(""+l.WD.STATE).test(e)},m=function(e){return new RegExp("TITLE|"+l.WD.DESCRIPTION+"|"+l.WD.MESSAGE+"|"+l.WD.WARNING+"|"+l.WD.ATTACHMENT).test(e)},f=function(e,t){return e.map((function(e,n){return{uid:e.id||n,name:e.name,status:"done",attachmentId:e.attachmentId||e.id,url:e.url,kind:e.kind||t}}))},p=function(e,t){return new RegExp(""+l.WD.TEXT).test(e)?[{type:"string",max:1e3,message:t+"\u4e0d\u80fd\u8d85\u8fc71000\u4e2a\u5b57"}]:new RegExp(""+l.WD.DESCRIPTION).test(e)&&[{type:"string",max:15e3,message:t+"\u4e0d\u80fd\u8d85\u8fc715000\u4e2a\u5b57"}]},h=function(e,t,n){return new RegExp("TITLE|"+l.WD.TEXT+"|"+l.WD.NUMERIC+"|"+l.WD.DESCRIPTION).test(e)?"recover"===n?"\u672a\u586b\u5199"+(t||"\u6807\u9898")+"\uff0c\u586b\u5199\u540e\u624d\u80fd\u6062\u590d\u5de5\u5355":"\u8bf7\u8f93\u5165"+(t||"\u6807\u9898"):"recover"===n?"\u672a\u9009\u62e9"+t+"\uff0c\u9009\u62e9\u540e\u624d\u80fd\u6062\u590d\u5de5\u5355":"\u8bf7\u9009\u62e9"+t},g=["QUEUE","ANY"],v=function(e){return e&&e.replace(new RegExp('<a.*?href="(.*?)".*?>(.*?)</a>',"g"),(function(t,n,a){n!==a&&(e=e.replace(n,a))})),e||null}},21524:(e,t,n)=>{n.d(t,{Q:()=>m,Z:()=>f});n(6373);var a=n(82891),r=(n(54038),n(36671)),i=(n(54214),n(12386)),l=(n(43378),n(62443)),o=(n(56120),n(74253)),c=(n(89858),n(51024)),s=n(67294),u=n(77356),d=n(7732),m=function(e){var t=e.name,n=e.value,u=e.options,m=void 0===u?[]:u,f=e.onChange,p=e.onStateChange,h=e.width,g=(0,s.useState)(""),v=g[0],E=g[1],k=(0,s.useState)({}),S=k[0],w=k[1],I=(0,s.useState)(!1),y=I[0],C=I[1],b=(0,s.useState)(),N=b[0],D=b[1],L=(0,s.useState)(),O=L[0],x=L[1],T=(0,s.useState)(!0),R=(T[0],T[1],m.filter((function(e){return new RegExp(v).test(e.username)&&0!==e.status})));(0,s.useEffect)((function(){w(m.find((function(e){return e.id===n})))}),[n]);var A=s.createElement("div",{className:"search-selector-menu",id:"search-selector-menu",onClick:function(e){return e.stopPropagation},style:{width:h>0?h+"px":"100%"}},s.createElement("div",{style:{display:"flex",flexWrap:"nowrap",padding:"4px 8px 0"}},s.createElement(c.default,{style:{flex:"auto"},bordered:!1,placeholder:"\u8bf7\u641c\u7d22",allowClear:!0,onChange:function(e){return E(e.target.value)}})),s.createElement(o.Z,{style:{margin:"4px 0"}}),s.createElement(i.default,{selectedKeys:[n],onClick:function(e){var t;t=e.key,null==f||f(t),n&&(null==p||p("update",t)),w(R[R.findIndex((function(t){return t.id===e.key}))]),C(!1)}},R.map((function(e){return s.createElement(i.default.Item,{key:e.id,icon:s.createElement("img",{src:e.userHead||d})},s.createElement(l.default,{content:null==e?void 0:e.username,visible:O===e.id&&N,mouseEnterDelay:.6,overlayClassName:"cUserList_popover",onVisibleChange:function(t){!function(e,t,n){var a,r,i=document.createElement("span");i.className="search-list-name",i.style.visibility="hidden",i.style.position="absolute",i.style.zIndex="-1",i.textContent=t,document.body.appendChild(i),i.offsetWidth>(null!=(a=null==(r=document.querySelector("#search-selector-menu"))?void 0:r.offsetWidth)?a:230)-90&&(x(e),D(n)),document.body.removeChild(i)}(e.id,e.username,t)}},e.username))})),(null==R?void 0:R.length)<1&&s.createElement(r.default,{image:r.default.PRESENTED_IMAGE_SIMPLE,description:"\u65e0\u641c\u7d22\u7ed3\u679c"})));return s.createElement(a.default,{overlay:A,trigger:["click"],visible:y,className:"search-selector icon-cem_pull-down-or-take-up "+e.className,getPopupContainer:function(e){return e.parentNode},onVisibleChange:function(e){return C(e)}},s.createElement("span",null,null!=S&&S.username?s.createElement("span",null,s.createElement("img",{src:S.userHead||d})):s.createElement("i",{className:"icon-tianjiaren"}),s.createElement("span",{className:"name"},(null==S?void 0:S.username)||t,0===(null==S?void 0:S.status)&&"\uff08\u672a\u6d3b\u8dc3\uff09")))};const f=(0,u.Z)(m)},77356:(e,t,n)=>{n.d(t,{Z:()=>c});n(29809);var a=n(97538),r=n(87462),i=n(67294),l=n(40553),o=n(13013);const c=function(e){return function(t){var n=t.id,c=t.name,s=t.kind,u=t.isRequired,d=void 0!==u&&u,m=t.rules,f=void 0===m?[]:m,p=t.value,h=t.isEdit,g=t.fileList,v=void 0===g?[]:g;return i.createElement(a.Z.Item,{key:c,label:h&&s===o.WD.ATTACHMENT&&v.length>0?c+"\uff08"+v.length+"\uff09":s===o.WD.MESSAGE||s===o.WD.WARNING?"":c,name:n,className:""+s,rules:[{required:d,message:""+(0,l.zE)(s,c,h)}].concat(f)},i.createElement(e,(0,r.Z)({},t,{showState:h&&!(0,l.Ez)(s)?p?"noFocusHasValue":"noFocus":""})))}}},32624:(e,t,n)=>{n.d(t,{Z:()=>Et});var a=n(63366),r=(n(75314),n(11187)),i=n(15861),l=n(87462),o=n(94578),c=n(18446),s=n.n(c),u=n(87757),d=n.n(u),m=n(67294),f=n(5133),p=n(55609),h=n(64396),g=n(2796),v=n(35239),E=n(13013),k=n(24804),S=n(40553),w=n(30381),I=n.n(w),y=n(33800),C=(n(53294),n(56697)),b=(n(9405),n(89552));const N=function(e){var t=e.title,n=e.className,a=e.children;return m.createElement(m.Fragment,null,m.createElement("h4",null,t),m.createElement("span",{className:"tools "+n},a))};n(54277);var D=n(74048),L=(n(54214),n(12386)),O=(n(6373),n(82891));const x=function(e){var t=e.menu,n=e.controlVisible,a=e.children,r=(0,m.useState)(!1),i=r[0],o=r[1],c={visible:i,onVisibleChange:function(e){return o(e)}};return m.createElement(O.default,(0,l.Z)({overlay:t,trigger:["click"],className:"search-selector "+(i?"isOpen":"")},n?c:{}),a)};n(7940);var T=n(31059),R={all:"\u5168\u90e8",self:"\u81ea\u5b9a\u4e49"};const A=function(e){var t=e.createSchema,n=e.onSchema,a=e.result,r=e.onSchemaChange,i=(0,m.useState)(null!=a&&a.menuShowType?null==a?void 0:a.menuShowType:"all"),l=i[0],o=i[1],c=(0,m.useState)(t),s=c[0],u=c[1];return(0,m.useEffect)((function(){if("self"===l&&a){var e=t.filter((function(e){return e.isRequired||a&&a[e.id]}));u(t.filter((function(e){return!e.isRequired}))),r(e)}}),[l,a]),m.createElement("div",{className:"wk-setting-menu"},m.createElement("div",{className:"show-tabs"},m.createElement("span",null,"\u663e\u793a\u5b57\u6bb5\uff1a"),m.createElement("span",{className:"tabs"},Object.keys(R).map((function(e,i){return m.createElement("span",{key:"menuType"+i,className:l===e?"active":"",onClick:function(){return function(e){if("self"===e){var i=t.filter((function(e){return e.isRequired||a&&a[e.id]}));u(t.filter((function(e){return!e.isRequired}))),r(i)}else u(t),r(null);o(e),e!==(null==a?void 0:a.menuShowType)&&n(void 0,void 0,e)}(e)}},R[e])})))),m.createElement(L.default,null,s.map((function(e){return m.createElement(L.default.Item,{key:e.id},"all"===l?m.createElement(T.default,{checked:!0,disabled:!0},e.name):m.createElement(T.default,{checked:!!a&&a[e.id],onChange:function(t){n(t,e.id,l)}},e.name))}))))};var F=C.Z.confirm;const _=function(e,t){return F({icon:m.createElement("h4",null,m.createElement("i",{className:"icon-cem_ordinary"}),"\u5220\u9664",e),content:m.createElement("span",null,"\u662f\u5426\u786e\u8ba4\u5220\u9664\u8be5",e,"\uff1f"),className:"default-confirm-modal",onOk:t,onCancel:function(){}})};const Z=function(e){var t=e.editType,n=e.isRecover,a=e.otherConfig,r=e.allScreen,i=e.setAllScreen,l=e.isStar,o=e.createSchema,c=e.onSchema,s=e.onFocus,u=e.showResult,d=e.normalAssignee,p=e.setSelfSchema,h=e.onDelete,g=e.setVisible,v=e.onStateChange,E=m.createElement(A,{createSchema:o,onSchema:c,result:u,onSchemaChange:function(e){return p(e)}}),k=m.createElement(L.default,{className:"default-dropdown-menu",onClick:function(e){return"delete"===e.key&&_("\u5de5\u5355",(function(){return h((function(){f.Z.success("\u5de5\u5355\u5220\u9664\u6210\u529f"),g(!1,!0)}))}))}},m.createElement(L.default.Item,{key:"delete"},m.createElement("i",{className:"icon-cem_trash"}),"\u5220\u9664"));return m.createElement(m.Fragment,null,"new"===t?!a.hideSetting&&m.createElement(x,{controlVisible:!0,menu:E},m.createElement("span",null,m.createElement("i",{className:"icon-cem_more-two"}),"\u914d\u7f6e\u5b57\u6bb5")):m.createElement(D.default,{size:"middle"},"edit"===t||"view"===t?m.createElement(m.Fragment,null,!a.hideAllScreen&&m.createElement("span",{onClick:function(){return i(!r)}},m.createElement("i",{className:r?"icon-cem_reduce":"icon-cem_enlarge"}),r?"\u6536\u8d77\u5168\u5c4f":"\u5168\u5c4f\u5c55\u793a"),!n&&m.createElement("span",{className:l?"start":"",onClick:function(){return s(l)}},m.createElement("i",{className:l?"icon-guanzhu-shixin":"icon-guanzhu"}),l?"\u53d6\u5173":"\u5173\u6ce8"),"view"!==t&&!d&&m.createElement(x,{menu:k},m.createElement("i",{className:"icon-cem_more-more"}))):m.createElement(m.Fragment,null,!a.hideAllScreen&&m.createElement("span",{onClick:function(){return v("finish")}},m.createElement("i",{className:"icon-huifu"}),"\u6062\u590d\u5de5\u5355"))))};n(29809);var W=n(97538),j=n(39432),V=(n(15086),n(94055)),M=(n(89858),n(51024)),H=M.default.TextArea;const P=function(e){var t=e.content,n=e.isShowEdit,a=e.onCloseEdit,r=e.onStateChange,i=(0,m.useState)(t),l=i[0],o=i[1],c=(0,m.useRef)(null);return(0,m.useEffect)((function(){n&&(null==c?void 0:c.current).focus({cursor:"end"})}),[n]),m.createElement(m.Fragment,null,(l||n)&&m.createElement(H,{ref:c,disabled:!n,maxLength:500,value:l,onChange:function(e){return o(e.target.value)},onBlur:function(e){a(""),t!==e.target.value&&r(e.target.value)},autoSize:!0}))};var U=n(61193);const q=function(e){e.fileList;var t=e.previewVisible,n=e.previewTitle,a=e.setPreviewVisible,r=e.previewImage;return m.createElement("div",{style:{display:t?"block":"none"}},m.createElement("div",{className:"wk-image-preview-mask"}),m.createElement("div",{className:"wk-image-preview-wrap",onClick:function(e){var t,n=null==(t=e.target)?void 0:t.className;(null==n?void 0:n.indexOf("img"))>-1&&"wk-image-preview-img-wrapper"!==n||a()}},m.createElement("div",{className:"wk-image-preview-img-title"},m.createElement("span",null,n),m.createElement("span",null,m.createElement("i",{className:"icon-cem_cancel",onClick:function(){return a()}}))),m.createElement("div",{className:"wk-image-preview-img-wrapper"},m.createElement("img",{className:"wk-image-preview-img",src:r}))))};var z=n(7732),G=n(60909),K=n(875),Y=n(50713),B=n(57305),$=n(22737),Q=n(62658),X=[{type:"all",name:"\u5168\u90e8"},{type:"remark",name:"\u53ea\u770b\u5907\u6ce8"}];const J=function(e){var t=e.remarkList,n=void 0===t?[]:t,a=e.highLightWords,r=e.selectedType,i=void 0===r?"remark":r,l=e.editType,o=e.onStateChange,c=(0,m.useState)(""),s=c[0],u=c[1],d=(0,m.useState)(!1),f=d[0],p=d[1],h=(0,m.useState)(""),g=h[0],v=h[1],E=(0,m.useState)(""),w=E[0],y=E[1],C=U.Z.getUser().userId,b=function(e,t,n){return o(e,{attachmentIds:[t]},n)},N=function(e){var t=e.urls;window.location.href=t[0]};return m.createElement("div",{className:"comment-panel "+i},m.createElement("p",null,"\u6d3b\u52a8\u65e5\u5fd7"),m.createElement("div",{className:"comment-panel-title"},X.map((function(e){return m.createElement("span",{key:e.type,className:i===e.type?"active":"",onClick:function(){return t=e.type,void(i!==t&&o("panel-change",t));var t}},e.name)}))),m.createElement("div",{className:"comment-panel-body"},n.length>0?m.createElement(m.Fragment,null,n.map((function(e){return m.createElement("div",{className:"remark-list",key:e.id},m.createElement("div",{className:"remark-list-title"},m.createElement("span",{className:"remark-list-title-edit"},m.createElement("span",null,m.createElement("img",{src:e.operatorPicture||z})),m.createElement("span",null,m.createElement("span",null,e.operator),e.description?m.createElement("span",{dangerouslySetInnerHTML:{__html:(0,k.Il)(e.description,a)}}):m.createElement("span",null,"\u6dfb\u52a0\u4e86\u65b0\u7684\u5907\u6ce8")),m.createElement(V.default,{title:I()(e.operateTime).format("YYYY/MM/DD HH:mm")},m.createElement("span",{className:"time"},(0,S.C4)(e.operateTime))),e.operatorId===C&&"remark"===i&&"disabled"!==l&&m.createElement("span",null,m.createElement("i",{className:"icon-bianji",onClick:function(){return u(e.id)}}),m.createElement("i",{className:"icon-cem_trash",onClick:function(){return o("del-rmk",e.id)}})))),m.createElement("div",{className:"remark-list-edit-body"},m.createElement(P,{content:e.content,isShowEdit:s===e.id,onCloseEdit:u,onStateChange:function(t){return o("update-rmk",{id:e.id,value:t})}}),m.createElement("div",{className:"files-list"},e.attachmentList&&e.attachmentList.map((function(t){return m.createElement("div",{className:/(png|jpg|jpeg)$/.test(t.name)?"":"file",key:t.id,onClick:function(e){var n,a,r,i=null==(n=e.target)?void 0:n.className;(null==i?void 0:i.indexOf("icon-"))>-1||(a=t.url,r=t.name,a&&/(png|jpg|jpeg)$/.test(r)&&(v(r),y(a),p(!0)))}},m.createElement("div",null,m.createElement("img",{src:/(png|jpg|jpeg)$/.test(t.name)?t.url?t.url:G:/(doc|docx)$/.test(t.name)?K:/(pdf)$/.test(t.name)?Y:/(txt)$/.test(t.name)?$:/(ppt|pptx)$/.test(t.name)?Q:B})),m.createElement("span",null,m.createElement("a",null,t.name)),"remark"===i&&"disabled"!==l&&m.createElement("span",{className:"tools"},m.createElement("i",{className:"icon-xiazai",onClick:function(){return b("attach-download",t.id,N)}}),e.operatorId===C&&m.createElement("i",{className:"icon-cem_trash",onClick:function(){e.content||1!==e.attachmentList.length?b("del-rmk-Attach",t.id):o("del-rmk-has-attach",{id:e.id,attachmentId:t.id})}})))})))))}))):m.createElement("div",null,"\u8fd9\u4e2a\u5de5\u5355\u6ca1\u6709","remark"===i?"\u5907\u6ce8":"\u52a8\u6001")),m.createElement(q,{previewVisible:f,previewTitle:g,previewImage:w,setPreviewVisible:function(){return p(!1)}}))};n(1025);var ee=n(65400),te=(n(9896),n(4767)),ne=(n(1131),n(28465)),ae=n(60909),re=n(9643),ie=n(875),le=n(50713),oe=n(57305),ce=n(22737),se=n(62658),ue=n(49722),de=["total","loaded"];const me=function(e){var t=e.children,n=e.uploadProps,r=void 0===n?{}:n,i=e.config,o=void 0===i?{}:i,c=e.fileList,s=void 0===c?[]:c,u=e.totalFiles,d=void 0===u?[]:u,p=e.onStateChange,h=(0,m.useState)(s),g=h[0],v=h[1],E=(0,m.useState)([]),k=E[0],S=E[1],w=(0,m.useState)(!1),I=w[0],y=w[1],C=(0,m.useState)(""),b=C[0],N=C[1],D=(0,m.useState)(""),L=D[0],O=D[1],x=function(e,t){var n=null==t?void 0:t.attachmentIds;p(e,t,(function(){"attach-del"===e&&n&&v([].concat(g.filter((function(e){return e.attachmentId!==n[0]}))))}))};(0,m.useEffect)((function(){s.length!==g.length&&v(s)}),[s]);var T=Object.assign({headers:{Authorization:"Bearer "+localStorage.getItem("authorization")},action:"/workorder/attachment/upload",beforeUpload:function(e,t){return t.some((function(e){return!/(png|jpg|jpeg|doc|docx|xls|xlsx|pdf|ppt|pptx|txt)$/.test(e.name)}))?(f.Z.warning("\u4ec5\u9650\u4e0a\u4f20jpg\u3001png\u3001excel\u3001word\u3001ppt\u3001txt\u3001pdf\u683c\u5f0f\u6587\u4ef6!",void 0,3),!1):t.some((function(e){return e.size>20971520}))?(f.Z.warning("\u6587\u4ef6\u5927\u5c0f\u4e0d\u8981\u8d85\u8fc720MB!",void 0,1),!1):20===d.length?(f.Z.warning("\u6700\u591a\u4e0a\u4f2020\u4e2a\u6587\u4ef6!",void 0,2),!1):(d.length+t.length>20&&(f.Z.warning("\u6700\u591a\u4e0a\u4f2020\u4e2a\u6587\u4ef6!",void 0,2),t=t.slice(0,20-d.length)),v([].concat(g,t.map((function(e){return{name:e.name,uid:e.uid}})))),S([].concat(t)),e.uid===t[0].uid)},customRequest:function(e){var t=e.action,n=e.data,r=e.file,i=e.headers,l=e.onError,o=e.onProgress,c=e.onSuccess,s=new FormData;n&&Object.keys(n).forEach((function(e){s.append(e,n[e])})),k.forEach((function(e){s.append("files",e,e.name)})),ue.v.post(t,s,{headers:i,onUploadProgress:function(e){var t=e.total,n=e.loaded;(0,a.Z)(e,de);v(g.map((function(e){if(k.find((function(t){return t.uid===e.uid}))){var a=Math.round(n/t*100).toFixed();e.status="uploading",e.percent="100"===a?"99":a}return e}))),o&&o({percent:Math.round(n/t*100).toFixed()},r)}}).then((function(e){var t=e.data;t.result?(v([].concat(g.map((function(e){var a=k.find((function(t){return t.uid===e.uid}));if(a){var r=t.result.fileItems.find((function(t){return t.name===e.name||t.originalName===e.name}));e.uid=a.uid,e.percent="100",e.status="done",e.refId=r.refId,e.attachmentId=r.attachmentId||r.id,e.url=r.url,e.kind=n.kind,e.name=r.name}return e})))),c&&c([].concat(g.filter((function(e){return k.find((function(t){return t.uid===e.uid}))}))),r)):(f.Z.error(t.msg,void 0,3),l&&l(t.msg),v([].concat(g.map((function(e){return k.find((function(t){return t.uid===e.uid}))&&(e.status="error"),e})))))})).catch(l)}},r);return m.createElement(m.Fragment,null,m.createElement(ne.Z,(0,l.Z)({},T,{listType:"picture",maxCount:20,multiple:!0,fileList:[].concat(g),iconRender:function(e){return m.createElement("img",{src:/(png|jpg|jpeg)$/.test(e.name)?/(png)$/.test(e.name)?re:ae:/(doc|docx)$/.test(e.name)?ie:/(pdf)$/.test(e.name)?le:/(txt)$/.test(e.name)?ce:/(ppt|pptx)$/.test(e.name)?se:oe})},showUploadList:{showDownloadIcon:!0,showRemoveIcon:!0,downloadIcon:m.createElement("i",{className:"icon-xiazai"}),removeIcon:m.createElement("i",{className:"icon-cem_trash",onClick:function(e){return e.preventDefault()}})},progress:{strokeWidth:4,strokeColor:"#7262FD",style:{width:"calc(100%)"}},onChange:function(e){/removed|download/.test(e.file.status||"")&&x("removed"===e.file.status?"attach-del":"attach-download",{attachmentIds:[e.file.attachmentId],name:e.file.name})},onRemove:function(e){return x("attach-del",{attachmentIds:[e.attachmentId],name:e.name}),!1},onDownload:function(e){e.url&&(window.location.href=e.url)},onPreview:function(e){e.url&&/(png|jpg|jpeg)$/.test(e.name)&&(O(e.url),N(e.name),y(!0))}},o),t),m.createElement(q,{fileList:g,previewVisible:I,previewTitle:b,previewImage:L,setPreviewVisible:function(){return y(!1)}}))};const fe=function(e){var t=e.fileList,n=void 0===t?[]:t,a=e.workOrderId,r=e.refId,i=e.totalFiles,o=void 0===i?[]:i,c=e.oriFileList,s=e.onChange,u=e.onStateChange,d=(0,m.useState)([]),f=d[0],p=d[1],h=(0,m.useState)(!1),g=h[0],E=h[1],k=function(e){null==s||s(e)},S={data:{kind:"WORK_ORDER_COMMENT",refId:r,projectId:v.t.get(v.V.curProject).id,workOrderId:a},onProgress:function(e,t){e.percent;E(!r),t.name,u("onProgress")},onSuccess:function(e,t){if(e){var n=e[0].refId;!r&&n&&(E(!1),k(n)),p([].concat(f,e)),u("upload",e)}},onError:function(e){E(!1)}};return(0,m.useEffect)((function(){n.length<1&&(p([]),k(""))}),[n]),(0,m.useEffect)((function(){var e=f.filter((function(e){return c.find((function(t){return t.attachmentId===e.attachmentId}))}));e.length<=0&&k(""),p(e)}),[c]),m.createElement(me,(0,l.Z)({},e,{fileList:f,config:{disabled:g||o.length>=20},uploadProps:S,totalFiles:o,onStateChange:u}),m.createElement("i",{className:"icon-cem_file-links "+(g||o.length>=20?"disabled":"")}))};var pe=n(7732),he=te.ZP.Option;const ge=function(e){var t=e.workOrderId,n=e.userList,a=void 0===n?[]:n,r=e.fileList,i=void 0===r?[]:r,l=e.allScreen,o=e.getFooterHeight,c=e.onAddRemark,s=e.onStateChange,u=(0,m.useState)(!1),d=u[0],f=u[1],p=(0,m.useState)(""),h=p[0],g=p[1],v=(0,m.useState)(""),E=v[0],k=v[1],S=(0,m.useState)(!1),w=S[0],I=S[1],y=(0,m.useState)([]),C=y[0],b=y[1],N=(0,m.useState)([]),L=N[0],O=N[1],x=function(){g(""),O([]),b([]),I(!1)},T=function(){!w&&I(!0),(h||E)&&!w&&c(h,E,C.filter((function(e){return h.indexOf(e.value)>-1})).map((function(e){return e.key})),x)};return(0,m.useEffect)((function(){o&&o(26);var e=document.getElementById("edit-comment"),t=new MutationObserver((function(e){var t=26;if(!document.querySelector(".remarkBtn")){var n,a,r=(null==(n=document.querySelector(".edit-modal-footer .ant-upload-list.ant-upload-list-picture"))?void 0:n.scrollHeight)||0;t=(r>=140?140:r)+((null==(a=document.querySelector(".edit-modal-footer .comment-box-wrap"))?void 0:a.scrollHeight)||50)+46}o&&o(t)}));e&&t.observe(e,{attributes:!0,childList:!0,subtree:!0})}),[]),(0,m.useEffect)((function(){var e=document.querySelector(l?".allScreen .ant-modal .ant-modal-body":".work-order-form .left-main-body"),t=document.querySelector(".comment-panel-body"),n=null==t?void 0:t.children[t.children.length-1];e&&(e.scrollTop=e.scrollHeight+(null==n?void 0:n.offsetHeight))}),[L]),m.createElement("div",{id:"edit-comment"},d?m.createElement(m.Fragment,null,m.createElement("div",{className:"comment-box-wrap"},m.createElement(te.ZP,{value:h,placeholder:"@\u63d0\u53ca\u4ed6\u4eba\uff0c\u6309Enter\u5feb\u901f\u53d1\u5e03",maxLength:500,autoSize:{minRows:2},onSelect:function(e){return function(e){b([].concat(C,C.find((function(t){return t.key===e.key}))?[]:[e]))}(e)},onChange:function(e){return g(e)},onPressEnter:function(e){return function(e){e.preventDefault(),e.returnValue=!1,!w&&T()}(e)},getPopupContainer:function(){return document.getElementById("edit-comment")}},a.filter((function(e){return 0!==e.status})).map((function(e){return m.createElement(he,{className:"userInfo",key:e.id,value:e.username},m.createElement("span",null,m.createElement("img",{className:"userIcon",src:e.userHead||pe}),e.username))})))),m.createElement(fe,{workOrderId:t,refId:E,fileList:L,oriFileList:i,totalFiles:i,onChange:function(e){return k(e)},onStateChange:function(){"onProgress"!==(arguments.length<=0?void 0:arguments[0])?("upload"===(arguments.length<=0?void 0:arguments[0])&&I(!1),s.apply(void 0,arguments)):I(!0)}}),m.createElement("div",{className:"btns"},m.createElement(D.default,null,m.createElement(ee.default,{className:"normal-text",type:"link",onClick:function(){return f(!1)}},"\u53d6\u6d88"),m.createElement(ee.default,{type:"link",onClick:function(){return T()}},"\u6dfb\u52a0")))):m.createElement(ee.default,{className:"remarkBtn",type:"primary",onClick:function(){return f(!0)}},"\u5907\u6ce8"))};n(62713);var ve=n(14321),Ee=n(77356);const ke=(0,Ee.Z)((function(e){var t=e.value,n=e.state,a=e.config,r=void 0===a?{}:a,i=e.showState,o=e.showTime,c=e.onChange,s=e.onStateChange,u=(0,m.useState)(!1),d=u[0],f=u[1],p="HH:mm",h=function(e){null==c||c(e),s("update",e)};return m.createElement(m.Fragment,null,m.createElement(ve.default,(0,l.Z)({showTime:(0,l.Z)({defaultValue:I()("12:00",p),format:p},o),format:function(e){return e.format("YYYY/MM/DD HH:mm")},value:t,disabled:"DISABLED"===n,showNow:!1,suffixIcon:!1,getPopupContainer:function(e){return e.parentNode},renderExtraFooter:function(){return t&&m.createElement("span",{onClick:function(){return h(null)}},"\u6e05\u9664")},onChange:h,onFocus:function(){return f(!0)},onBlur:function(){return f(!1)}},r,i&&!d?(0,l.Z)({},S.He,{className:S.He.className+" icon-cem_time-controller"}):{className:"icon-cem_time-controller"})))}));const Se=(0,Ee.Z)((function(e){var t=e.value,n=e.state,a=e.showState,r=e.config,i=e.onChange,o=e.onStateChange,c=(0,m.useState)(!1),s=c[0],u=c[1];return m.createElement(M.default,(0,l.Z)({value:t,disabled:"DISABLED"===n,onChange:function(e){null==i||i(e)},onFocus:function(){return u(!0)},onBlur:function(){u(!1),o("update",t)}},a&&!s?S.He:{},r))}));n(35797);var we=n(64749),Ie=we.default.Option;const ye=(0,Ee.Z)((function(e){var t=e.config,n=void 0===t?{}:t,a=e.value,r=e.state,i=e.options,o=void 0===i?[]:i,c=e.showState,s=e.changeTrigger,u=e.onChange,d=e.onStateChange,f=(0,m.useState)(!1),p=f[0],h=f[1];return m.createElement(we.default,(0,l.Z)({},n,{dropdownClassName:"wk-default-selector "+(n.dropdownClassName||""),getPopupContainer:function(e){return e.parentNode},value:a,disabled:"DISABLED"===r,onChange:function(e){null==u||u(e),s&&d("update",e)},onFocus:function(){return h(!0)},onBlur:function(){h(!1),!s&&d("update",a)}},c&&!p?S.G$:{}),o.map((function(e){return m.createElement(Ie,{key:e.id,value:e.id},e.view||e.value)})))}));const Ce=(0,Ee.Z)((function(e){var t=e.fileList,n=e.refId,a=e.workOrderId,r=e.totalFiles,i=void 0===r?[]:r,o=e.isRecover,c=e.onChange,s=e.onStateChange,u=(0,m.useState)(!1),d=u[0],f=u[1],p={data:{kind:"WORK_ORDER_FILE",refId:n,projectId:v.t.get(v.V.curProject).id,workOrderId:a},onProgress:function(e,t){e.percent;f(!n)},onSuccess:function(e,t){if(e){var a=e[0].refId;!n&&a&&(s("refId",a),f(!1),r=a,null==c||c(r)),s("upload",e)}var r},onError:function(e){f(!1)}};return m.createElement(me,(0,l.Z)({},e,{fileList:t,totalFiles:i,uploadProps:p,onStateChange:s}),m.createElement(ee.default,{disabled:d||i.length>=20||o,size:"large",icon:m.createElement("i",{className:"icon-shangchuan"})},"\u4e0a\u4f20\u6587\u4ef6"),m.createElement("span",{className:"tips",onClick:function(e){return e.stopPropagation()}},"\u4ec5\u9650\u4e0a\u4f20jpg\u3001png\u3001excel\u3001word\u3001ppt\u3001txt\u3001pdf\u683c\u5f0f\u6587\u4ef6\uff0c\u6700\u591a\u4e0a\u4f2020\u4e2a\u6587\u4ef6\uff0c\u6bcf\u4e2a\u6587\u4ef6\u4e0d\u80fd\u8d85\u8fc720MB"))}));var be=n(72757),Ne=n(5234),De=n.n(Ne),Le=(n(38026),function(){function e(t){var n=this,a=t.loader,r=t.onStateChange;this.loader=void 0,this.onStateChange=void 0,this.upload=function(){return n.loader.file.then((function(t){return new Promise((function(a,r){if(e.disabled)r(!1);else{var i={kind:"WORK_ORDER_DESCRIPTION",refId:e.refId,projectId:v.t.get(v.V.curProject).id,workOrderId:e.workOrderId},l=new FormData;Object.keys(i).forEach((function(e){l.append(e,i[e])})),l.append("files",t,t.name),ue.v.post("/workorder/attachment/upload",l,{headers:{Authorization:"Bearer "+localStorage.getItem("authorization")}}).then((function(t){var i=t.data;if(i.result){if(e.fileList.length>=20||e.fileList.length+i.result.length>=20)return f.Z.warning("\u6700\u591a\u4e0a\u4f2020\u4e2a\u6587\u4ef6!"),r(!1),!1;if(!e.refId){var l=i.result.fileItems[0].refId;n.onStateChange("refId",l)}n.onStateChange("update",(0,S.qq)(i.result.fileItems,"WORK_ORDER_DESCRIPTION")),a({default:i.result.fileItems[0].url})}else 40009===i.code?f.Z.warning("\u6700\u591a\u4e0a\u4f2020\u4e2a\u6587\u4ef6!"):f.Z.error(i.msg),r(!1)})).catch()}}))}))},this.loader=a,this.onStateChange=r}return e.prototype.abort=function(){},e}());Le.refId="",Le.fileList=[],Le.workOrderId="",Le.disabled=!1;var Oe={toolbar:["heading","|","bold","italic","bulletedList","numberedList","link","imageUpload"],heading:{options:[{model:"paragraph",title:"H4",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"H1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"H2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"H3",class:"ck-heading_heading2"}]},image:{toolbar:[],insert:{type:"inline"},styles:{options:["inline"]},upload:{types:["jpeg","png"]}},link:{decorators:{isExternal:{mode:"automatic",callback:function(e){return e.startsWith("http://")||e.startsWith("https://")},attributes:{target:"_blank"}}}},disableObjectResizing:!1,language:"zh-cn"},xe={placeholder:"\u70b9\u51fb\u6dfb\u52a0\u63cf\u8ff0\u4fe1\u606f"};const Te=(0,Ee.Z)((function(e){var t=e.isEdit,n=e.fileList,a=e.refId,r=e.workOrderId,i=e.value,o=e.isRecover,c=e.onChange,s=e.onStateChange,u=(0,m.useState)(!1),d=u[0],f=u[1],p=(0,m.useState)(!1),h=p[0],g=p[1],v=(0,m.useState)(0),E=v[0],k=v[1],w=function(e){null==c||c(e)},I=function(e,t){"refId"===e?s("refId",t):s("upload",t),s("update",t)},y=function(e){var t=document.querySelector(".ck-focused");"A"!==e.target.nodeName||t||(e.preventDefault(),e.stopPropagation(),window.open(e.target.href,"_blank"))};return Le.disabled=o,(0,m.useEffect)((function(){Le.refId=a}),[a]),(0,m.useEffect)((function(){Le.fileList=n}),[n]),(0,m.useEffect)((function(){Le.workOrderId=r}),[r]),(0,m.useEffect)((function(){var e;k((null==(e=document.querySelector(".editor-wrapper"))?void 0:e.scrollHeight)||0)}),[i]),(0,m.useEffect)((function(){var e,t;return null==(e=document.querySelector(".editor-wrapper"))||e.addEventListener("mousedown",y,!0),k((null==(t=document.querySelector(".editor-wrapper"))?void 0:t.scrollHeight)||0),function(){var e;null==(e=document.querySelector(".editor-wrapper"))||e.removeEventListener("mousedown",y)}}),[]),m.createElement("div",{className:"editor-wrapper "+(t&&!d?"no-focus "+(E>360&&!d&&!h?"limit":""):"")},m.createElement(be.CKEditor,{editor:De(),config:(0,l.Z)({},Oe,t?xe:{}),data:i||"",onReady:function(e){if(e){e.plugins.get("FileRepository").createUploadAdapter=function(e){return new Le({loader:e,onStateChange:I})},e.plugins.get("ImageUploadEditing").on("uploadComplete",(function(t,n){n.data;var a=n.imageElement;e.model.change((function(t){t.setSelection(a,"after"),e.editing.view.focus()}))}));var t=e.plugins.get("LinkUI");t.actionsView.destroy();var n=document.querySelector(".ck.ck-reset_all.ck-body.ck-rounded-corners");t.actionsView.on("render",(function(){document.querySelector(".ck-link_selected")?null==n||n.classList.add("unshow"):Array.from(n.classList).indexOf("unshow")>-1&&n.classList.remove("unshow")})),t.formView.on("render",(function(){Array.from(n.classList).indexOf("unshow")>-1&&n.classList.remove("unshow")}))}},onChange:function(e,t){var n=t.getData();w(n)},onBlur:function(e,t){if(!document.querySelector(".ck-balloon-panel_visible")){f(!1);var n=t.getData();!/<img>/g.test(n)&&s("update",(0,S.g3)(i))}},onFocus:function(e,t){return f(!0)}}),t&&E>360&&!d&&m.createElement("div",{className:"isShowAll "+(h?"":"extend"),onClick:function(){return g(!h)}},h?"\u6536\u8d77":"\u663e\u793a\u66f4\u591a"))}));const Re=function(e){return m.createElement(ye,(0,l.Z)({},e,{config:{mode:"multiple"}}))};var Ae=n(21524),Fe=(n(43378),n(62443)),_e=n(44600),Ze=n(1374),We=n(61409),je=n(18863),Ve=n(88958),Me=n(60481);const He=(0,Ee.Z)((function(e){e.id;var t=e.name,a=e.kind,r=e.value,i=e.onStateChange,l=(0,m.useState)(!1),o=l[0],c=l[1],s=(0,m.useState)(!1),u=s[0],d=s[1],f=m.useState(void 0),p=f[0],h=f[1],g=(0,m.useState)(1),S=g[0],w=g[1],I=(0,m.useState)(""),y=I[0],C=I[1],b=(0,m.useState)(!1),N=b[0],D=b[1],L="\u90ae\u7bb1",O="\u624b\u673a",x=r.messageList?r.messageList:[],T=r.total,R=function(e){return"SERVICE"===e.messageCategory&&"\u5ba2\u6237"!==e.type||"\u5ba2\u670d"===e.type?n(92690):"CUSTOM"===e.messageCategory||"\u5ba2\u6237"===e.type?n(1583):"\u5ba2\u670d\u56de\u590d"===e.type?n(70269):e.uimg?e.uimg.startsWith("http")?e.uimg:"http://"+e.uimg:Ve};return(0,m.useEffect)((function(){o?setTimeout((function(){d(o)}),10):d(o)}),[o]),m.createElement(m.Fragment,null,m.createElement("div",{className:"form-label"},t,a===E.WD.MESSAGE&&m.createElement(m.Fragment,null,"\uff08",m.createElement("span",{className:"number",onClick:function(){return i("related")}},T),"\uff09"),m.createElement("span",{className:"collaspe "+(o?"icon-cem_pull-or-take-up":"icon-cem_pull-down-or-take-up"),onClick:function(){return c(!o)}},o?"\u6536\u8d77":"\u5c55\u5f00")),a===E.WD.WARNING&&o&&m.createElement(m.Fragment,null,m.createElement("div",{className:"related-item related-waring"},m.createElement("div",{className:"left"},r.warningMessageType&&m.createElement("div",{className:"related-item-type"},m.createElement("div",{className:r.warningMessageType+" icon-box"},m.createElement("i",{className:""+E.P$[r.warningMessageType]})),m.createElement("span",null,E.Cs[r.warningMessageType])),m.createElement("div",{className:"related-item-value",onClick:function(){p.wrappedInstance.ready({id:r.id,title:r.value,hideFooter:!0})}},r.value))),x.length>0&&m.createElement("p",null,"\u9884\u8b66\u5173\u8054\u7684\u6d88\u606f \uff08",m.createElement("span",{className:"number",onClick:function(){return i("related",r.id)}},r.additionalValue),"\uff09")),o&&x.length>0&&m.createElement("div",{className:"related-body"},x.map((function(e,t){var n,r=function(e){var t=(0,je.uh)(e),n=null==t?void 0:t.replace(/!\[\]\((.*)\)/g,(function(e,t){return'<img src="'+t+'" />'}));return n&&"undefined"!==n?n:""}(a===E.WD.MESSAGE?"SERVICE"===e.messageCategory?"\u5728\u3010"+e.connectionName+"\u3011\u91cc\u54a8\u8be2\u4e86\u5ba2\u670d\u3010"+e.title+"\u3011":"TICKET"===e.messageCategory?e.title:(e.questionnaireName?"\u7b54\u4e86\u95ee\u5377\u3010"+e.questionnaireName+"\u3011":"")||e.summary||e.answerOrReason:e.summary)||e.title||"[\u65e0\u6807\u9898]";return m.createElement("div",{key:e.id+t||t,className:"related-item"},m.createElement("div",{className:"left"},a!==E.WD.WARNING&&m.createElement("div",{className:"related-item-type"},m.createElement("div",{className:e.messageCategory+" icon-box"},m.createElement("i",{className:""+E.P$[e.messageCategory]})),m.createElement("span",null,E.Cs[e.messageCategory])),m.createElement("div",{className:(y===e.id?"related-item-value__"+e.id+" related-item-value text-wrap":"related-item-value__"+e.id+" related-item-value")+" ",dangerouslySetInnerHTML:{__html:r},onClick:function(){return i("related-msg",e.id)}}),u&&function(e,t){var n,a,r,i=document.createElement("span");i.className="related-item-value",i.style.visibility="hidden",i.style.position="absolute",i.style.zIndex="-1",i.textContent=e,document.body.appendChild(i);var l=i.offsetWidth,o=null!=(n=null==(a=document.querySelectorAll(".related-item-value__"+t))||null==(r=a[0])?void 0:r.offsetWidth)?n:document.body.offsetWidth;return document.body.removeChild(i),l>o}(r,e.id)&&m.createElement("div",{className:"more",onClick:function(t){return function(e,t){e.stopPropagation(),C(y===t?"":t)}(t,e.id)}},m.createElement("span",null,"\u66f4\u591a"),m.createElement("span",{className:(y===e.id?"icon-box active":"icon-box")+" "},m.createElement("i",{className:"icon-cem_pull-down-or-take-up"})))),m.createElement("span",{className:"related-item-icon"},m.createElement(Fe.default,{placement:"leftBottom",content:(n=e,m.createElement("div",null,m.createElement("img",{className:"custom_card",src:Me}),m.createElement("span",{className:"custom_icon"},m.createElement(Ze.Z,{src:R(n),defaultImg:Ve})),m.createElement("div",{className:"info-box"},m.createElement("h2",null,n.username||"\u533f\u540d"),v.t.get(v.V.curProject).projectType.includes("CUSTOMER_FILE")&&U.Z.hasAuthority("CUSTOMER_FILE")&&1===n.existContact&&m.createElement(ee.default,null,m.createElement(We.rU,{to:{pathname:"/customerFile/customerDetail",query:{customerId:n.contactId}},activeClassName:"active",target:"_blank"},"\u5ba2\u6237\u6863\u6848")),m.createElement("div",null,m.createElement("span",null,O),m.createElement("span",{className:"info-icon "+(n.phoneNumber&&"icon-shouji"),onClick:function(e){return(0,k.r0)(e)}},n.phoneNumber||"--")),m.createElement("div",null,m.createElement("span",null,L),m.createElement("span",{className:"info-icon "+(n.email&&"icon-youxiang"),onClick:function(e){return(0,k.r0)(e)}},n.email||"--"))))),title:!1,trigger:"hover",overlayClassName:"custom-info",getPopupContainer:function(){return document.querySelector(".work-order-form")}},m.createElement("span",null,m.createElement(Ze.Z,{src:R(e),defaultImg:Ve})))))}))),o&&10*S<T&&m.createElement("div",{className:"extend relate"},m.createElement("span",{className:N?"loading":"",onClick:function(){N||(D(!0),i("related-more-msg",{params:r.id&&{warningLogId:r.id},pageIndex:S+1,kind:a},(function(){D(!1),w(S+1)})))}},"\u67e5\u770b\u66f4\u591a")),m.createElement(_e.Z,{ref:h}))}));var Pe=[{icon:"icon-daichuli",className:"first"},{icon:"icon-jinhangzhong",className:"other"},{icon:"icon-yiwancheng",className:"last"}];const Ue=function(e){var t=e.options,n=e.value,a=e.isSelectState,r=e.onStateChange,i=function(e){var n=Array.isArray(e)?e[0]:e,a=Array.isArray(e)?e[1]:t.length;return Pe[n<=0?0:n===a-1?Pe.length-1:1]};return m.createElement(ye,(0,l.Z)({},e,{options:null==t?void 0:t.map((function(e,t){return(0,l.Z)({},e,{id:String(e.id),view:m.createElement("span",{className:i(e.realIndex||t).className},m.createElement("i",{className:i(e.realIndex||t).icon}),e.name)})})),changeTrigger:!0,config:(0,l.Z)({},E.$Q,{className:"status "+(n||a?"":"no-value"),dropdownClassName:"wk-status-dropdown",placeholder:"\u672a\u9009\u62e9"}),onStateChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t&&t[1]&&(t[0]="update-state"),r.apply(void 0,t)}}))};const qe=function(e){return m.createElement(ke,(0,l.Z)({},e,{config:{format:function(e){return(0,S.C4)(e)+" \u622a\u6b62"}},showTime:{minuteStep:15}}))};const ze=function(e){return m.createElement(Se,(0,l.Z)({},e,{rules:[{validator:function(t,n,a){n&&!/^(-?)(\d+)(\.\d{1,4})*$/.test(n)?a("\u6700\u591a\u652f\u6301\u8f93\u5165\u5c0f\u6570\u70b9\u540e\u56db\u4f4d\uff0c\u7b26\u53f7\u4ec5\u652f\u6301\u8f93\u5165\u8d1f\u53f7\uff0c\u4f8b\u5982-13.02"):n&&n.length>1e3?a(e.name+"\u4e0d\u80fd\u8d85\u8fc71000\u4e2a\u5b57"):a()}}]}))};var Ge=n(7732);const Ke=(0,Ee.Z)((function(e){var t=e.value;return m.createElement(m.Fragment,null,"object"===typeof t&&t?m.createElement("span",{className:"fake search-selector"},m.createElement("img",{src:t.icon||Ge}),m.createElement("span",null,t.value,0===(null==t?void 0:t.status)&&"\uff08\u672a\u6d3b\u8dc3\uff09")):m.createElement("span",null,t?/(.*)-(.*)-(.*)/.test(t)?I()(t).format("YYYY/MM/DD HH:mm"):t:"--"))}));var Ye=M.default.TextArea;const Be=(0,Ee.Z)((function(e){var t=e.value,n=void 0===t?"":t,a=e.config,r=void 0===a?{}:a,i=e.showState,o=e.onChange,c=e.onStateChange,s=(0,m.useState)(!1),u=s[0],d=s[1],f=(0,m.useRef)(null);return(0,m.useEffect)((function(){var e=null==f?void 0:f.current;u&&e.focus()}),[u]),m.createElement(m.Fragment,null,m.createElement(Ye,(0,l.Z)({ref:f,value:n,onChange:function(e){null==o||o(e)},onBlur:function(){n.trim()&&d(!1),c("update",n.trim())},onFocus:function(){return d(!0)},onPressEnter:function(e){e.preventDefault(),(null==f?void 0:f.current).blur()},autoSize:!0},r,i&&!u?(0,l.Z)({},S.He,{className:r.className+" "+S.He.className}):{})))}));const $e=function(e){var t=e.isEdit,n=[{type:"string",max:500,message:"\u6807\u9898\u4e0d\u80fd\u8d85\u8fc7500\u4e2a\u5b57"},{type:"string",whitespace:!0,message:"\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"}];return m.createElement(m.Fragment,null,t?m.createElement(Be,(0,l.Z)({},e,{name:"",rules:n,config:{className:"title"}})):m.createElement(Se,(0,l.Z)({},e,{rules:n})))};var Qe=M.default.TextArea;const Xe=(0,Ee.Z)((function(e){var t=e.value,n=e.state,a=e.showState,r=e.config,i=e.onChange,o=e.onStateChange,c=(0,m.useState)(!1),s=c[0],u=c[1];return m.createElement(Qe,(0,l.Z)({value:t,disabled:"DISABLED"===n,onChange:function(e){null==i||i(e)},onFocus:function(){return u(!0)},onBlur:function(){u(!1),o("update",t)},autoSize:!0},a&&!s?S.He:{},r))}));const Je=function(e){var t=e.isEdit;return m.createElement(m.Fragment,null,t?m.createElement(Xe,e):m.createElement(Se,e))};var et=n(97448),tt=n(33798);const nt=function(e){var t=e.options,n=void 0===t?[]:t;return m.createElement(ye,(0,l.Z)({},e,{options:null==n?void 0:n.map((function(e,t){return(0,l.Z)({},e,{view:m.createElement("span",null,m.createElement(tt.Z,{defaultIcon:et.jY[n.length][t],activeIcon:et.jY[n.length][t],style:{width:"16px",height:"16px",position:"relative",left:"-3px"}}),e.value)})})),changeTrigger:!0}))};var at;const rt=((at={TITLE:$e})[E.WD.TEXT]=Je,at[E.WD.RADIO]=ye,at[E.WD.CHECKBOX]=Re,at[E.WD.DATE_TIME]=ke,at[E.WD.NUMERIC]=ze,at[E.WD.ASSIGNEE]=Ae.Z,at[E.WD.DUE_TIME]=qe,at[E.WD.DESCRIPTION]=Te,at[E.WD.REMARK]=Se,at[E.WD.ATTACHMENT]=Ce,at[E.WD.PRIORITY]=nt,at[E.WD.MESSAGE]=He,at[E.WD.WARNING]=He,at[E.WD.STATE]=Ue,at[E.WD.CREATOR]=Ke,at[E.WD.UPDATER]=Ke,at[E.WD.CREATED_TIME]=Ke,at[E.WD.UPDATED_TIME]=Ke,at[E.WD.FINISHED_TIME]=Ke,at[E.WD.TAG]=Ke,at);var it=n(69042);const lt=function(e){var t=e.form,n=e.isEdit,a=e.editType,r=e.isRecover,i=e.allScreen,o=e.titleLength,c=e.initialValues,s=e.schema,u=e.schemaKind,d=e.moveKind,f=e.refId,p=e.workOrderId,h=e.fileList,g=e.selectedType,v=e.remarkList,k=e.highLightWords,w=e.userList,I=e.isSelectState,y=e.onAddRemark,C=e.onStateChange,b=(0,m.useState)(0),N=b[0],D=b[1],L=(0,m.useState)(0),O=L[0],x=L[1],T=s.find((function(e){return e.kind===E.WD.STATE})),R=function(){var e=document.querySelector(".TITLE");e&&(null==e?void 0:e.clientHeight)!==N&&D(null==e?void 0:e.clientHeight)},A=function(e){e.preventDefault(),e.stopPropagation()};return(0,m.useEffect)((function(){return window.addEventListener("resize",R),function(){window.removeEventListener("resize",R)}}),[N]),(0,m.useEffect)((function(){R()}),[i]),(0,m.useEffect)((function(){R()}),[c]),(0,m.useEffect)((function(){var e=document.querySelector(".TITLE"),t=new MutationObserver((function(t){e&&D&&D(null==e?void 0:e.clientHeight)}));e&&t.observe(e,{attributes:!0,childList:!0,subtree:!0})}),[]),(0,m.useEffect)((function(){o>52&&o<=130&&document.querySelectorAll(".right-part .ant-form-item-label").forEach((function(e){e.style.width=o+16+"px"}))}),[o]),(0,m.useEffect)((function(){if(/disabled|view/.test(a)){var e=document.querySelector(".work-order-form");return null==e||e.addEventListener("mousedown",A),function(){null==e||e.removeEventListener("mousedown",A)}}}),[t,a]),m.createElement(W.Z,{form:t,colon:!1,labelAlign:"left",className:"work-order-form "+(n&&"edit"),initialValues:c},m.createElement("div",{className:"left-part"},m.createElement("div",{className:"left-main-body",style:{height:"calc(100vh - "+((i?125:190)+O)+"px)"}},m.createElement("div",{className:"title-body"},s.filter((function(e){return"TITLE"===e.kind})).map((function(e,t){return e.kind&&rt[e.kind]((0,l.Z)({},e,{isEdit:n,rules:[].concat((0,S.jQ)(e.kind,e.name)?(0,S.jQ)(e.kind,e.name):[]),onTitleHeight:D,onStateChange:function(t,n,a){return C(t,e.id,n)}}))})),!/disabled|view/.test(a)&&!r&&m.createElement(it.Z,{workOrderId:p,statusOptions:(null==T?void 0:T.realOptions)||(null==T?void 0:T.options),status:t.getFieldValue(Object.keys(u).find((function(e){return u[e]===E.WD.STATE}))||""),assignee:t.getFieldValue(Object.keys(u).find((function(e){return u[e]===E.WD.ASSIGNEE}))||""),moveKind:d,userList:w,onStateChange:C,schema:s.filter((function(e){return!(0,S.l2)(e.kind)&&("STATE"===e.kind||"ASSIGNEE"===e.kind)})).map((function(e,t){return(0,l.Z)({},e,{value:c[e.id],workOrderId:p,isSelectState:I})}))})),s.filter((function(e){return(0,S.l2)(e.kind)&&"TITLE"!==e.kind})).map((function(e,t){return e.kind!==E.WD.MESSAGE&&e.kind!==E.WD.WARNING||e.kind===E.WD.MESSAGE&&c[e.id]||e.kind===E.WD.WARNING&&c[e.id]?rt[e.kind]((0,l.Z)({},e,{value:c[e.id],isEdit:n,isRecover:r,refId:f,workOrderId:p,fileList:h,totalFiles:h,isSelectState:I,rules:[].concat((0,S.jQ)(e.kind,e.name)?(0,S.jQ)(e.kind,e.name):[]),onStateChange:function(t,n,a){"update"===t?C(t,e.id,n):C(t,n,a)}})):m.createElement(m.Fragment,null)})),m.createElement(J,{remarkList:v,highLightWords:k,selectedType:g,onStateChange:C})),!r&&m.createElement("div",{className:"edit-modal-footer "+(26===O?"no-border":"")},m.createElement(ge,{workOrderId:p,fileList:h,userList:w,allScreen:i,onAddRemark:y,onStateChange:C,getFooterHeight:function(e){e!==O&&x(e)}}))),m.createElement("div",{className:"right-part"},s.filter((function(e){return!(0,S.l2)(e.kind)})).map((function(e,t){return e.kind&&rt[e.kind]((0,l.Z)({},e,{value:c[e.id],isEdit:n,workOrderId:p,isSelectState:I,rules:[].concat((0,S.jQ)(e.kind,e.name)?(0,S.jQ)(e.kind,e.name):[]),onStateChange:function(t,n,a){"update"===t||"update-state"===t?C(t,e.id,n):C(t,n,a)}}))}))))};const ot=function(e){var t=e.form,n=e.titleLength,a=e.isEdit,r=e.initialValues,i=e.schema,o=e.refId,c=e.workOrderId,s=e.fileList,u=e.isSelectState,d=e.onStateChange;return m.createElement(W.Z,{form:t,colon:!1,labelAlign:"left",labelCol:{span:n>=280?6:5},wrapperCol:{span:23-(n>=280?6:5)},className:"work-order-form",initialValues:r},i.length>0&&i.map((function(e,t){return e.kind&&rt[e.kind]((0,l.Z)({},e,{value:r[e.id],isEdit:a,refId:o,workOrderId:c,fileList:s,totalFiles:s,isSelectState:u,rules:[].concat((0,S.jQ)(e.kind,e.name)?(0,S.jQ)(e.kind,e.name):[]),onStateChange:function(t,n,a){"update"===t||"update-state"===t?d(t,e.id,n):d(t,n,a)}}))})))};const ct=function(e){var t=e.isEdit,n=e.editType,a=e.isRecover,r=e.allScreen,i=e.workOrderId,o=e.selectedType,c=e.moveKind,u=e.userList,d=e.remarkList,f=e.highLightWords,p=e.fileList,h=void 0===p?[]:p,g=e.schema,v=e.schemaKind,k=e.defaultValue,S=e.getForm,w=e.onAddRemark,I=e.onStateChange,y=(0,m.useState)(k),C=y[0],b=y[1],N=(0,m.useState)(i||""),D=N[0],L=N[1],O=(0,m.useState)(!1),x=O[0],T=O[1],R=W.Z.useForm()[0];(0,m.useEffect)((function(){return R&&S(R)}),[R]),(0,m.useEffect)((function(){s()(C,k)||(R.setFieldsValue(k),b(k))}),[R,k,t]),(0,m.useEffect)((function(){var e,t=Object.keys(v).find((function(e){return v[e]===E.WD.ATTACHMENT}));R.setFieldsValue(((e={})[""+t]=D,e))}),[D]);var A=g.reduce((function(e,t){return Math.max(e,(0,j.jD)(t.name))}),0),F={form:R,titleLength:A,isEdit:t,initialValues:C,schema:g,refId:D,workOrderId:i,fileList:h,isSelectState:x,onStateChange:function(e,t,n){"update"===e?function(e,t,n){R.validateFields([t]).then((function(a){var r;I(e,((r={})[""+t]=n,r))})).catch((function(){}))}(e,t,n):"update-state"===e?function(e,t,n){var a;I(e,((a={})[""+t]=n,a),(function(e){var n;R.setFieldsValue(((n={})[""+t]=e||R.getFieldValue(t),n))})),!x&&T(!0)}(e,t,n):e.indexOf("update-btn-")>-1?function(e,t){var n,a="";(a=e.indexOf("state")>-1?Object.keys(v).find((function(e){return v[e]===E.WD.STATE})):Object.keys(v).find((function(e){return v[e]===E.WD.ASSIGNEE})))&&R.setFieldsValue(((n={})[""+a]=t,n)),I(e,t)}(e,t):"refId"===e?L(t):I(e,t,n)}};return m.createElement(m.Fragment,null,t?m.createElement(lt,(0,l.Z)({},F,{editType:n,isRecover:a,allScreen:r,selectedType:o,moveKind:c,schemaKind:v,userList:u,remarkList:d,highLightWords:f,onAddRemark:w})):m.createElement(ot,F))};var st=["url"];const ut=function(e){var t=e.isEdit,n=e.editType,r=e.schema,i=e.schemaKind,l=e.isRecover,o=e.allScreen,c=e.workOrderId,s=e.fileList,u=e.selectedType,d=e.moveKind,f=e.remarkList,p=e.logList,h=e.defaultValue,g=e.form,v=e.getForm,S=e.userList,w=e.highLightWords,I=e.onAddRemark,y=e.onStateChange;return m.createElement(ct,{schema:r,schemaKind:i,isEdit:t,isRecover:l,editType:n,allScreen:o,workOrderId:c,fileList:s,selectedType:u,moveKind:d,remarkList:"remark"===u?f:p,defaultValue:h,getForm:v,userList:S,highLightWords:w,onAddRemark:I,onStateChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].indexOf("attach-del")>-1?_("\u6587\u4ef6",(function(){var e=t[2];t[2]&&(t[2]=function(t){var n=t.url,r=(0,a.Z)(t,st);Object.keys(i).forEach((function(e){if(i[e]===E.WD.DESCRIPTION&&g.getFieldValue(e)){var t,a,r=(0,k.Dy)(g.getFieldValue(e),n);g.setFieldsValue(((t={})[""+e]=r,t)),y("update",((a={})[""+e]=r,a))}})),e(r)}),y.apply(void 0,t)})):t[0].indexOf("del-rmk")>-1?_(t[0].indexOf("Attach")>-1?"\u6587\u4ef6":"\u5907\u6ce8",(function(){y.apply(void 0,t)})):y.apply(void 0,t)}})};const dt=function(e){var t=e.visible,n=e.editType,a=e.setVisible,r=e.otherConfig,i=void 0===r?{}:r,o=e.editLoaing,c=void 0!==o&&o,s=e.createSchema,u=e.detailSchema,d=e.createDefaultValue,f=e.workOrderDetail,p=f.code,h=f.isStar,g=f.itemIdValueList,v=f.fileList,E=f.moveKind,S=e.isEdited,w=e.isRecover,I=e.onFinish,y=e.onDelete,D=e.onFocus,L=e.onSchema,O=e.showResult,x=e.addRelationLoading,T=(0,m.useState)(!1),R=T[0],A=T[1],F=(0,m.useState)(null),_=F[0],W=F[1],j=(0,m.useState)(null),V=j[0],M=j[1],H=!!/recover|edit|view/.exec(n)&&n,P=function(){V.validateFields().then((function(e){return I(e,a)})).catch((function(){}))};return(0,m.useEffect)((function(){t&&"self"===O.menuShowType&&s.length>0&&W(s.filter((function(e){return e.isRequired||O&&O[e.id]})))}),[t,O]),m.createElement(C.Z,(0,l.Z)({title:m.createElement("div",{className:"modal-title"},m.createElement(N,{title:"new"===n?"\u521b\u5efa\u5de5\u5355":m.createElement(m.Fragment,null,m.createElement("span",{style:{cursor:"pointer"},onClick:function(e){return(0,k.r0)(e)}},p),w&&g&&m.createElement("span",{className:"tip"},"\u5de5\u5355\u5df2\u5728\u56de\u6536\u7ad9\uff0c","recover"===n?"\u70b9\u51fb\u300c\u6062\u590d\u5de5\u5355\u300d\u4e4b\u524d\uff0c\u6240\u6709\u7f16\u8f91\u64cd\u4f5c\u4e0d\u505a\u8bb0\u5f55\u53d8\u66f4":"\u4e0d\u53ef\u4fee\u6539")),className:/view/.test(n)?"edit":n},m.createElement(Z,{editType:n,isRecover:w,otherConfig:i,allScreen:R,setAllScreen:A,isStar:h,createSchema:s,onSchema:L,showResult:O,setSelfSchema:W,onFocus:D,onDelete:y,setVisible:a,onStateChange:function(e){return"finish"===e&&P()}}))),visible:t,getContainer:function(){return document.getElementById("app")},closable:"new"!==n&&!R,width:R?"100vw":H?1280:960,style:{top:R?"0px":H?"50px":"66px"},bodyStyle:H?{height:"calc(100vh - "+(R?52:164)+"px)"}:{},mask:!R,wrapClassName:"work-order-edit-modal "+(R?"allScreen":"")+" "+n+" "+(/recover|view/.test(n)?"edit":"")+" "+(null!=w&&w.isView?"isRecoverView":""),confirmLoading:x,closeIcon:m.createElement("i",{className:"icon-cem_cancel"}),destroyOnClose:!0,afterClose:function(){A(!1),a(!1,"edit"===n&&S),W(null)},onCancel:function(){return a(!1)},onOk:function(){return P()}},H?{footer:!1}:{}),m.createElement(b.default,{wrapperClassName:"spin-wrapper",size:"large",spinning:c||H&&!g},m.createElement(ut,(0,l.Z)({},e,{schema:H?"edit"===n?u:u.filter((function(e){return"DISABLED"!==e.state})):_||s,form:V,isEdit:H,selfSchema:_,allScreen:R,fileList:v,moveKind:E,defaultValue:H?(0,l.Z)({},g):d,getForm:function(e){return M(e)}}))))};const mt=function(e){var t=e.isView,n=e.editType,a=e.editLoaing,r=e.detailSchema,i=e.workOrderDetail,o=i.code,c=i.isStar,s=i.itemIdValueList,u=i.fileList,d=i.moveKind,p=i.hasDeleted,h=e.onFocus,g=e.onDelete,v=e.setVisible,E=(0,m.useState)(null),k=E[0],S=E[1],w=(0,m.useState)("disabled"===n||p?"disabled":n),I=w[0],y=w[1];return(0,m.useEffect)((function(){p&&y("disabled")}),[p]),m.createElement("div",{className:"wkOrder-page allScreen "+I+" "+(t?"view":"")},m.createElement("div",{className:"modal-title"},m.createElement(N,{title:"new"===I?"\u521b\u5efa\u5de5\u5355":m.createElement(m.Fragment,null,o,"disabled"===I&&s&&m.createElement("span",{className:"tip"},"\u5de5\u5355\u5df2\u5728\u56de\u6536\u7ad9\uff0c\u4e0d\u53ef\u4fee\u6539")),className:I},m.createElement(Z,{editType:I,otherConfig:{hideAllScreen:!0},allScreen:!1,isStar:c,onFocus:h,onDelete:function(){return g((function(){f.Z.success("\u5de5\u5355\u5220\u9664\u6210\u529f"),y("disabled")}))},setVisible:v}))),m.createElement(b.default,{wrapperClassName:"spin-wrapper",size:"large",spinning:a||!s},m.createElement(ut,(0,l.Z)({},e,{editType:I,isRecover:"disabled"===I&&{isView:!0},form:k,isEdit:"edit",schema:r,fileList:u,moveKind:d,defaultValue:(0,l.Z)({},s||{}),getForm:function(e){return S(e)}}))))};const ft=function(e){var t=e.editType,n=e.currentState,a=e.stateList,r=e.detailSchema,i=e.onMove,o=e.onStateChange,c=(0,m.useState)(!1),s=c[0],u=c[1],d=(0,m.useState)(""),p=d[0],h=d[1],g=(0,m.useState)({cb:null}),v=g[0],k=g[1],S=function(e,t){v.cb&&v.cb(e),t&&t(),u(!1),k({cb:null})},w=function(e){var t,n,i=e.stateId,l=e.stateCallbak;!0===(null==(n=(a||(null==(t=r.find((function(e){return e.kind===E.WD.STATE})))?void 0:t.options)).find((function(e){return String(e.id)===i})))?void 0:n.isRemark)?function(e,t){u(!0),h(e),k({cb:t})}(i,l):I("",i,l)},I=function(e,t,a){i(t||p,e).then((function(e){S("",a)})).catch((function(e){f.Z.warning(e.data.msg),a&&a(n)}))},C=function(e,n,a){if("update-state"===e)return"recover"!==t&&w({stateId:n[Object.keys(n)[0]],stateCallbak:function(t){a(t),!t&&o(e,n,a)}}),void o(e,n,!1);o(e,n,a)};return m.createElement(m.Fragment,null,e.location?m.createElement(mt,(0,l.Z)({},e,{onStateChange:C})):m.createElement(dt,(0,l.Z)({},e,{onStateChange:C})),m.createElement(y.Z,{isShow:s,closeShow:function(){return S(n)},handleSubmitRemark:I}))};var pt=n(6406),ht=["loading"],gt=h.Z.workOrder.editSingleOrder,vt=function(e){function t(t){var n;return(n=e.call(this,t)||this).state=void 0,n.events=void 0,n._handleSchemaParams=function(e,t,a){var r,i=null==e?void 0:e.target.checked;return t?{showResult:(0,l.Z)({},n.state.showResult,(r={},r[t]=i,r.menuShowType=a,r))}:{showResult:(0,l.Z)({},n.state.showResult,{menuShowType:a})}},n._handleSchema=function(e,t,a){var r={projectId:v.t.get(v.V.curProject).id,key:"SETTINGWORKORDER"},i=n._handleSchemaParams(e,t,a);n.setState(i,(function(){var e=(0,l.Z)({},r,{value:JSON.stringify(n.state.showResult)});n.props.setDefaultValue(e)}))},n._handleDelFile=function(e){var t=n.state.workOrderDetail.fileList.find((function(t){return t.attachmentId===e}));t&&"WORK_ORDER_COMMENT"===t.kind&&n._handleFetchRemarkList(),n.setState({workOrderDetail:(0,l.Z)({},n.state.workOrderDetail,{fileList:n.state.workOrderDetail.fileList.filter((function(t){return t.attachmentId!==e}))})})},n._handleUpdateBtnValue=function(e,t){var a,r=n.props.schemaKind,i=n.state,o=i.workOrderDetail.itemIdValueList,c=i.workOrderDetail,s=e.indexOf("state")>-1?E.WD.STATE:E.WD.ASSIGNEE,u=Object.keys(r).find((function(e){return r[e]===s}));n.setState({currentState:t,workOrderDetail:(0,l.Z)({},c,{itemIdValueList:(0,l.Z)({},o,(a={},a[""+u]=t,a))})})},n._handleStateChange=function(e,t,a){!/panel-change|related|attach-download/.test(e)&&n.setState({isEdited:!0});var r=n.props,o=r.workOrderId,c=r.editType,s=r.schemaKind,u=n.state,m=u.projectId,f=u.selectedType,p=u.remarkList,h=u.workOrderDetail,v=h.title,E=h.code,S=h.fileList;switch(e){case"attach-download":(0,g.Ve)(t).then((function(e){return e.data.result&&a&&a(e.data.result)})).catch((function(e){return console.error(e)}));break;case"attach-del":(0,g.OW)((0,l.Z)({},t,{workOrderId:o,projectId:m})).then((function(e){if(2e4===e.data.code){var r,i=null==(r=S.find((function(e){return e.id===t.attachmentIds[0]||e.attachmentId===t.attachmentIds[0]})))?void 0:r.url;a&&a({url:i}),n._handleDelFile(t.attachmentIds[0]),(null==p?void 0:p.length)>0&&p.forEach((function(e){var a;(null==(a=e.attachmentIds)?void 0:a.length)>0&&(e.attachmentIds.find((function(e){return e.id===t.attachmentIds[0]}))&&!e.content&&n._handleRemoveRemark(e.id))})),"all"===f&&n._handleFetchLog()}})).catch((function(e){return console.error(e)}));break;case"update":"edit"===c&&n._handleUpdate(t,a);break;case"upload":n.setState({workOrderDetail:(0,l.Z)({},n.state.workOrderDetail,{fileList:n.state.workOrderDetail.fileList.concat(t)})}),"edit"===c&&"all"===f&&n._handleFetchLog();break;case"update-state":a?(n._handleUpdateBtnValue(e,t[Object.keys(t)[0]]),"edit"===c&&n._handleFetchRemarkList()):"edit"===c&&n._handleUpdate(t);break;case"update-rmk":n._handleUpdateRemark(t);break;case"del-rmk":n._handleRemoveRemark(t);break;case"del-rmk-has-attach":n._handleRemoveRemark(t.id),(0,i.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._handleFetchFiles();case 2:t=e.sent,"all"===f&&n._handleFetchLog(),n.setState({workOrderDetail:(0,l.Z)({},n.state.workOrderDetail,{fileList:t})});case 5:case"end":return e.stop()}}),e)})))();break;case"del-rmk-Attach":(0,g.OW)((0,l.Z)({},t,{workOrderId:o,projectId:m})).then((function(e){2e4===e.data.code&&(n._handleDelFile(t.attachmentIds[0]),n._handleFetchRemarkList())})).catch((function(e){return console.error(e)}));break;case"panel-change":n.setState({selectedType:t}),"remark"===f&&n._handleFetchLog();break;case"related":(0,k.vt)(m,t?{warningLogId:t,relationType:"WARNING"}:{workOrderId:o,relationType:"MESSAGE"},E,v);break;case"related-msg":(0,k.vt)(m,{id:t},E,v);break;case"related-more-msg":n._handleFetchRelatedMsg(m,t.params?t.params:{workOrderId:o},s,t.kind,t.pageIndex,a);break;case"update-btn-state":case"update-btn-asn":n._handleUpdateBtnValue(e,t),n._handleFetchRemarkList()}},n._handleFinish=function(e,t){var a=n.props,r=a.createSchema,i=a.detailSchema,o=a.newOrUpdateWorkOrder,c=a.editType,s=a.workOrderId,u=a.otherConfig,d=void 0===u?{}:u,m=n.state,p=m.selectedType;if(!m.addRelationLoading){n.setState({addRelationLoading:!0});var h=(null==e?void 0:e.id)||s,g=Object.keys(e),v=(h?i.filter((function(e){return g.find((function(t){return t===e.id}))&&"DISABLED"!==e.state})):r).filter((function(e){return"TITLE"!==e.kind&&!(0,k.Wo)(e.kind)})).map((function(t){var n=e[g.find((function(e){return e===t.id}))||-1];return{kind:t.kind,schemaId:t.id,schemaValue:Array.isArray(n)?n.length>0?n.join(","):null:"object"===typeof n&&null!=n&&n.format?n.format("YYYY-MM-DD HH:mm:ss"):t.kind===E.WD.DESCRIPTION?(0,S.g3)(n):t.kind!==E.WD.WARNING&&t.kind!==E.WD.MESSAGE&&n||null}}));d.relatedAdd?d.relatedAdd({id:h,schemaEntries:v,title:e.title},(function(){n.setState({addRelationLoading:!1})})):o((0,l.Z)({id:h,schemaEntries:v,title:e.title},"recover"===c?{workOrderOperateKind:"RECOVER_WORK_ORDER"}:{})).then((function(e){e&&"edit"!==c&&f.Z.success("\u5de5\u5355"+(h?"\u6062\u590d":"\u521b\u5efa")+"\u6210\u529f")&&t&&t(!1,!0),"all"===p&&n._handleFetchLog(),n.setState({addRelationLoading:!1})})).catch((function(e){n.setState({addRelationLoading:!1})}))}},n._handleIsEqual=function(e,t,n){var a=Object.keys(e)[0];return!(!n[a]&&!e[a])&&!s()(t,n)},n._handleUpdate=function(e,t){var a=n.state,r=a.workOrderDetail,i=r.title,o=r.itemIdValueList,c=r.fileList,s=a.workOrderDetail,u=n.props.workOrderId,d=(0,l.Z)({},o,e);e.title?n.setState({workOrderDetail:(0,l.Z)({},s,{title:e.title})}):n.setState({workOrderDetail:(0,l.Z)({},s,{itemIdValueList:d,fileList:c})}),u&&n._handleIsEqual(e,d,o)&&n._handleFinish((0,l.Z)({},e,{title:e.title||i,id:u}),t)},n._handleFocus=function(e,t){var a=n.state.workOrderDetail,r=n.props.workOrderId;(e?g.Yf:g.Ly)({workOrderId:r}).then((function(r){2e4===r.data.code&&(n.setState({workOrderDetail:(0,l.Z)({},a,{isStar:!e})}),t())})).catch((function(e){return console.error(e)}))},n._handleDelete=function(e){var t=n.state.projectId,a=n.props.workOrderId;(0,g.Aj)({projectId:t,id:a}).then((function(t){return 2e4===t.data.code&&e()})).catch((function(e){return console.error(e)}))},n._handleFetchFiles=function(){var e=n.props,t=e.workOrderId;return(0,e.fetchAttachmentList)({refId:t})},n._handleFetchRelatedMsg=function(e,t,a,r,i,o){void 0===i&&(i=1),(r===E.WD.MESSAGE?g.ro:g.J)((0,l.Z)({projectId:e,pageIndex:i,pageSize:10,filterModel:{sortName:"cTime",sortOrder:"DESC"},relationType:r},t)).then((function(e){var t,i;if(2e4===e.data.code&&null!=(t=n.state.workOrderDetail)&&t.itemIdValueList&&null!=(i=e.data.result)&&i.messages){var c,s=Object.keys(n.state.workOrderDetail.itemIdValueList).find((function(e){return a[e]===r})),u=n.state.workOrderDetail.itemIdValueList[s||-1];n.setState({workOrderDetail:(0,l.Z)({},n.state.workOrderDetail,{itemIdValueList:(0,l.Z)({},n.state.workOrderDetail.itemIdValueList,(c={},c[""+s]=(0,l.Z)({},u,{messageList:null!=u&&u.messageList&&"object"===typeof u.messageList[0]?null==u?void 0:u.messageList.concat(e.data.result.messages):e.data.result.messages,total:(null==u?void 0:u.additionalValue)||e.data.result.total}),c))})}),o&&o()}}))},n._handleFetchDetail=(0,i.Z)(d().mark((function e(){var t,a,r,i,o,c,s,u,m;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props,r=a.schemaKind,i=a.userList,o=a.workOrderId,c=n.state.projectId,e.next=4,n._handleFetchFiles();case 4:return s=e.sent,u=[],m={},e.next=9,(0,g.EY)({workOrderId:o}).then((function(e){var t,a,o=e.data.result;u=(null==o?void 0:o.relationMessageList)||[],m=o.relationWarningList,o&&n.setState({workOrderDetail:(0,l.Z)({},o,{itemIdValueList:(0,l.Z)({},o.itemIdValueList.reduce((function(e,t){return e[t.id]=(0,k.Wo)(r[t.id])?(0,k.tR)(t.value,i):r[t.id]===E.WD.MESSAGE&&u.length>0?{messageList:o.relationMessageList,total:o.relationMessageList.length}:r[t.id]===E.WD.WARNING?o.relationWarningList:t.value&&"null"!==t.value?r[t.id]===E.WD.CHECKBOX?t.value.split(","):!t.value||r[t.id]!==E.WD.DATE_TIME&&r[t.id]!==E.WD.DUE_TIME?t.value:I()(t.value,"YYYY/MM/DD HH:mm"):r[t.id]===E.WD.CHECKBOX?[]:null,e}),{title:e.data.result.title})),fileList:(0,S.qq)(s)}),currentState:null==(t=o.itemIdValueList)||null==(a=t.find((function(e){return r[e.id]===E.WD.STATE})))?void 0:a.value})})).catch((function(e){return console.error(e)}));case 9:(null==(t=u)?void 0:t.length)>0&&n._handleFetchRelatedMsg(c,{workOrderId:o,relationType:"MESSAGE"},r,E.WD.MESSAGE),m&&n._handleFetchRelatedMsg(c,{warningLogId:m.id},r,E.WD.WARNING),n._handleFetchRemarkList();case 12:case"end":return e.stop()}}),e)}))),n._handleAddRemark=function(e,t,a,r){var l=n.props.workOrderId,o=n.state.projectId;(0,g.wU)({projectId:o,remarkContent:e,workOrderId:l,refId:t,remindUserIds:a}).then((function(e){2e4===e.data.code&&(0,i.Z)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._handleFetchRemarkList();case 2:r&&r(),n.setState({isEdited:!0});case 4:case"end":return e.stop()}}),e)})))()})).catch((function(e){return console.error(e)}))},n._handleFetchLog=function(){var e=n.props.workOrderId;e&&(0,g.VU)({orderId:e}).then((function(e){return n.setState({logList:e.data.result})})).catch((function(e){r.default.destroy(),f.Z.error("\u5de5\u5355\u52a8\u6001\u6709\u8bef\uff01")}))},n._handleFetchRemarkList=function(){var e=n.props.workOrderId;return(0,g.e9)({orderId:e}).then((function(e){return e.data.result&&(n.setState({remarkList:[].concat(e.data.result.filter((function(e){var t;return e.content||(null==(t=e.attachmentList)?void 0:t.length)>0})))}),n._handleFetchLog()),!0})).catch((function(e){return console.error(e)}))},n._handleUpdateRemark=function(e){var t=e.id,a=e.value,r=n.state.projectId;(0,g.xo)({projectId:r,mappingId:t,remarkContent:a}).then((function(e){return 2e4===e.data.code&&n._handleFetchRemarkList()})).catch((function(e){return console.error(e)}))},n._handleRemoveRemark=function(e){var t=n.state.projectId;(0,g.WJ)({projectId:t,mappingId:e}).then((function(e){2e4===e.data.code&&(n._handleFetchRemarkList(),n._handleFetchDetail())})).catch((function(e){return console.error(e)}))},n._handleMove=function(e,t){void 0===t&&(t="");var a=n.state.projectId,r=n.props.workOrderId;return(0,g.Lm)({projectId:a,remark:t,stateId:e,workOrderId:r})},n.state={projectId:v.t.get(v.V.curProject).id,workOrderDetail:{fileList:[]},showResult:{},remarkList:[],logList:[],isEdited:!1,selectedType:"remark",pageId:"",currentState:"",addRelationLoading:!1},n.events={onStateChange:n._handleStateChange,onFinish:n._handleFinish,onUpdate:n._handleUpdate,onFocus:n._handleFocus,onDelete:n._handleDelete,onSchema:n._handleSchema,onAddRemark:n._handleAddRemark,onMove:n._handleMove},n}(0,o.Z)(t,e);var n=t.prototype;return n._fetchStatusList=function(){var e=this.props.detailSchema,t=this.state.projectId;(0,pt.PH)({projectId:t}).then((function(t){if(2e4===t.data.code){var n=t.data.result;null==e||e.map((function(e){return e.kind===E.WD.STATE&&(e.options=n),e}))}})).catch((function(e){return console.error(e)}))},n.componentDidMount=function(){var e=this,t=this.props,n=t.fetchsWorkOrderSchema,a=t.fetchUserList,r=t.location;t.schemaKind;(0,i.Z)(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==r||!r.query.workOrderId){t.next=7;break}return t.next=3,n();case 3:return t.next=5,a();case 5:e._handleFetchDetail(),e._fetchStatusList();case 7:case"end":return t.stop()}}),t)})))()},n.componentDidUpdate=function(e,t){var n=this,a=this.props,r=a.workOrderId,l=a.location,o=a.stateList,c=a.visible,s=a.detailSchema,u=a.schemaKind,m=a.editType,f=a.highLightWords,p=a.fetchsWorkOrderSchema,h=a.fetchUserList;if(!l){e.visible!==c&&this.setState({workOrderDetail:{fileList:[]},logList:[],selectedType:"remark",currentState:""}),e.visible!==c&&c&&(this.state.isEdited&&this.setState({isEdited:!1}),(0,i.Z)(d().mark((function t(){var a,i,l;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=!1,i=null,"edit"===m){t.next=6;break}return l={projectId:v.t.get(v.V.curProject).id,key:"SETTINGWORKORDER"},t.next=6,n.props.getDefaultValue(l).then((function(e){a=e&&"self"===JSON.parse(e).menuShowType,i=e})).catch((function(e){return console.error(e)}));case 6:return t.next=8,p();case 8:return t.next=10,h();case 10:a&&n.setState({showResult:i?JSON.parse(i):Object.keys(u).reduce((function(e,t){return new RegExp(E.WD.DUE_TIME+"|"+E.WD.ATTACHMENT+"|"+E.WD.DESCRIPTION).test(u[t])&&(e[t]=!0),e}),{})}),e.workOrderId!==r&&r&&n._handleFetchDetail();case 12:case"end":return t.stop()}}),t)})))()),e.workOrderId!==r&&this.setState({remarkList:[]}),e.stateList===o&&e.detailSchema===s||(null==s||s.map((function(e){return e.kind===E.WD.STATE&&(e.options=o),e})),(null==o?void 0:o.length)>0&&(f.state=o));var g=this.state,k=g.currentState,w=g.workOrderDetail;t.currentState!==k&&(null==w?void 0:w.moveKind)===S.uz[0]&&(null==s||s.map((function(e){if(e.kind===E.WD.STATE){e.realOptions=e.realOptions||e.options;var t=e.realOptions.findIndex((function(e){return String(e.id)===k}));e.options=e.realOptions.map((function(t,n){return t.realIndex=[n,e.realOptions.length],t})).filter((function(e,n){return n===t||n===t+1||n===t-1}))}return e})))}},n.render=function(){return m.createElement(ft,(0,l.Z)({},this.props,this.state,this.events))},t}(m.Component);const Et=(0,p.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,ht);return(0,l.Z)({},n[gt],{editLoaing:t.effects[gt+"/fetchsWorkOrderSchema"]||!1})}),(function(e){return{save:function(t){return e({type:gt+"/save",payload:t})},fetchsWorkOrderSchema:function(t){return e({type:gt+"/fetchsWorkOrderSchema",payload:t})},newOrUpdateWorkOrder:function(t){return e({type:gt+"/newOrUpdateWorkOrder",payload:t})},fetchUserList:function(t){return e({type:gt+"/fetchUserList",payload:t})},uploadAttachment:function(t){return e({type:gt+"/uploadAttachment",payload:t})},fetchAttachmentList:function(t){return e({type:gt+"/fetchAttachmentList",payload:t})},setDefaultValue:function(t){return e({type:gt+"/setDefaultValue",payload:t})},getDefaultValue:function(t){return e({type:gt+"/getDefaultValue",payload:t})}}}))(vt)},60481:(e,t,n)=>{e.exports=n.p+"img/6675abce54306966e3a8.png"},92690:(e,t,n)=>{e.exports=n.p+"img/c0db547fdffcaf97d9a5.png"},1583:(e,t,n)=>{e.exports=n.p+"img/7697898a8d2c725f00c4.png"},70269:(e,t,n)=>{e.exports=n.p+"img/70af3595da3b4cc36c3f.png"},88958:(e,t,n)=>{e.exports=n.p+"img/aa245f8de9f2aa549c26.png"}}]);