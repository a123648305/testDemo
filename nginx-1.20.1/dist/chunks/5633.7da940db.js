"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5633],{15633:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ve});var r=n(63366),i=n(87462),a=n(94578),o=n(67294),l=n(55609),s=(n(9405),n(89552)),u=(n(1025),n(65400)),c=(n(75314),n(11187)),d=(n(62642),n(94704)),p=n(41919),f=n(96518),m=n(86615),h=n(55815),v=n(61409),E=n(87219),g=n(53326),y=(n(89858),n(51024)),S=(n(43378),n(62443)),N=(n(35797),n(64749)),_=n(23279),C=n.n(_),w=function(e){function t(t){var n;return(n=e.call(this,t)||this)._setEvent=function(e){return 0===e?{onMouseEnter:function(){n.setState({firstLiHover:!0})},onMouseLeave:function(){n.setState({firstLiHover:!1})}}:{}},n.state={options:[],value:{id:"",name:""},firstLiHover:!1},n}(0,a.Z)(t,e);var n=t.prototype;return n.onSel=function(e,t){var n=this,r=this.state.options;r.forEach((function(e){return e.sel=!1})),r[t].sel=!0,this.setState({options:r},(function(e){return n.props.onChange&&n.props.onChange(n.getValue())}))},n.getValue=function(){return JSON.parse(JSON.stringify(this.state.options)).filter((function(e){return e.sel}))[0]},n.UNSAFE_componentWillReceiveProps=function(e){if(e.options||e.value){var t=JSON.parse(JSON.stringify(e.options)),n=JSON.parse(JSON.stringify(e.value));t.forEach((function(e){e.id===n.id&&(e.sel=!0)})),this.setState({options:t,value:n})}},n.UNSAFE_componentWillMount=function(){var e=this.props.options,t=this.props.value?this.props.value:{};e.forEach((function(e){e.id===t.id&&(e.sel=!0)})),this.setState({options:e,value:t})},n.componentWillUnmount=function(){},n.render=function(){var e=this,t=this.state,n=t.options,r=t.firstLiHover,a=n[0]&&n[0].sel;return o.createElement("div",{className:"yt_analyse_object_select "+(this.props.triangle?"triangle":"")+" "+(r||a?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},o.createElement("div",{className:"wrap"},o.createElement("ul",null,n.length>0?n.map((function(t,n){return o.createElement("li",(0,i.Z)({className:(t.sel?"sel":"")+(t.disable?" disable":""),key:n,onClick:function(t){return e.onSel(t,n)}},e._setEvent(n)),o.createElement("span",null,t.name),o.createElement("i",{className:"check cem-icon icon-cem_arrow-thick"}))})):o.createElement("div",{className:"noData"},"\u65e0\u6570\u636e"))))},t}(o.Component),T=(n(7940),n(31059)),O=function(e){function t(t){var n;return(n=e.call(this,t)||this).sortList=function(e,t,r){r.stopPropagation(),r.nativeEvent.stopImmediatePropagation();var i=JSON.parse(JSON.stringify(n.state.value)),a=i.splice(e,1)[0];switch(t){case"top":i.unshift(a);break;case"up":i.splice(e-1,0,a);break;case"down":i.splice(e+1,0,a)}n.setState({value:i},(function(e){return n.props.onChange&&n.props.onChange(n.getValue())}))},n._setEvent=function(e){return 0===e?{onMouseEnter:function(){n.setState({firstLiHover:!0})},onMouseLeave:function(){n.setState({firstLiHover:!1})}}:{}},n.state={options:[],value:[],showSel:!1,firstLiHover:!1,searchWord:""},n}(0,a.Z)(t,e);var n=t.prototype;return n.onSel=function(e,t){var n=this,r=this.state.options,i=this.state.value;!t.sel&&this.props.limit&&i.length>=this.props.limit?c.default.warning("\u6700\u591a\u9009\u62e9"+this.props.limit+"\u4e2a\u5bf9\u8c61\uff01"):(r.forEach((function(e){e.id===t.id&&(n.props.singelSel?(e.sel=!0,i=[e]):(e.sel=!e.sel,e.sel?i.push(e):i.some((function(e,n){return(e.id===t.id||e===t.id)&&(i.splice(n,1),!0)}))))})),this.setState({options:r,value:i},(function(e){return n.props.onChange&&n.props.onChange(n.getValue())})))},n.getValue=function(){return this.state.value},n.UNSAFE_componentWillReceiveProps=function(e){if(e.options||e.value){var t=JSON.parse(JSON.stringify(e.options)),n=JSON.parse(JSON.stringify(e.value));t.forEach((function(e){n.map((function(e){return e.id})).includes(e.id)||n.includes(e.id)?e.sel=!0:e.sel=!1})),this.setState({options:t,value:n})}},n.UNSAFE_componentWillMount=function(){var e=this.props,t=e.options,n=e.value,r=void 0===n?[]:n;t.forEach((function(e){(r.map((function(e){return e.id})).includes(e.id)||r.includes(e.id))&&(e.sel=!0)})),this.setState({options:t,value:r})},n.render=function(){var e=this,t=this.state,n=t.options,r=t.value,a=t.searchWord,l=[];return r.length>0&&n.filter((function(e){return e.sel})).length>0&&r.forEach((function(e){n.filter((function(t){return t.id===e.id||t.id===e}))[0]&&l.push(n.filter((function(t){return t.id===e.id||t.id===e}))[0])})),o.createElement("div",{className:"yt_analyse_object_sort_select"},o.createElement("div",{className:"selItem "+(this.props.triangle?"triangle":"")+" "+(this.state.firstLiHover?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},o.createElement("div",{className:"wrap"},o.createElement(y.default,{value:a,placeholder:"\u8f93\u5165\u641c\u7d22\u5173\u952e\u8bcd",className:"search",allowClear:!0,onChange:function(t){return e.setState({searchWord:t.target.value})}}),o.createElement("ul",null,l.length>0&&l.filter((function(e){return!a||-1!==e.name.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())})).map((function(t,n){return o.createElement("li",(0,i.Z)({className:(t.sel?"sel":"")+(t.disable?" disable":""),key:n,onClick:function(n){return e.props.singelSel?"":e.onSel(n,t)}},e._setEvent(n)),!e.props.singelSel&&o.createElement(T.default,{className:"check-all",checked:t.sel,onChange:function(e){}}),o.createElement("span",null,t.name),!e.props.singelSel&&o.createElement("div",{className:"handle"},0!==n&&o.createElement("i",{title:"\u7f6e\u9876",onClick:function(t){e.sortList(n,"top",t)},className:"icon-cem_roof-placement"}),0!==n&&o.createElement("i",{title:"\u4e0a\u4e00\u4f4d",onClick:function(t){e.sortList(n,"up",t)},className:"icon-cem_upper"}),n!==l.length-1&&o.createElement("i",{title:"\u4e0b\u4e00\u4f4d",onClick:function(t){e.sortList(n,"down",t)},className:"icon-cem_lower"})))})),l.length>0&&n.filter((function(e){return!e.sel})).length>0&&o.createElement("div",{className:"line"}),n.filter((function(e){return!e.sel})).length>0&&n.filter((function(e){return!e.sel})).filter((function(e){return!a||-1!==e.name.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())})).map((function(t,n){return o.createElement("li",{className:(t.sel?"sel":"")+(t.disable?" disable":""),key:n,onClick:function(n){return e.onSel(n,t)}},!e.props.singelSel&&o.createElement(T.default,{className:"check-all",checked:t.sel,onChange:function(e){}}),o.createElement("span",{className:"dark"},t.name))})),0===n.length&&o.createElement("div",{className:"noData"},"\u65e0\u6570\u636e")))))},t}(o.Component);const R=function(e){function t(t){var n;return(n=e.call(this,t)||this).setShowSelFalse=function(){n.state.show&&n.cancel(),n.state.show&&n.setState({show:!1})},n.cancel=function(){n.setState({show:!1})},n.onSelChange=function(e,t){var r;n.setState(((r={})[e]=t,r),(function(){"sortSelectValue"===e&&(n.cancel(),n.props.onChange&&n.props.onChange(n.getValue()))}))},n.getName=function(){var e=n.props,t=e.list,r=e.title,i=n.state,a=i.sortSelectValue,o=i.selectValue,l=t.find((function(e){return e.id===o.id}))?t.find((function(e){return e.id===o.id})).values.map((function(e){return delete e.sel,e})):[];return n.props.singelSel?a[0]?a[0].name?a[0].name:l&&l.filter((function(e){return e.id===a[0].id||e.id===a[0]}))[0]&&l.filter((function(e){return e.id===a[0].id||e.id===a[0]}))[0].name:"\u8bf7\u9009\u62e9":r},n.state={show:!1,triangle:"select",selectValue:{id:"",name:""},sortSelectValue:[]},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;window.addEventListener("click",this.setShowSelFalse),this.props.left&&document.querySelectorAll(".analyze-object").forEach((function(t){return t.style.setProperty("--x",e.props.left+"px")}))},n.UNSAFE_componentWillMount=function(){if(this.props.left&&this.props.left<-200&&this.setState({triangle:"sortSelect"}),this.props.value&&this.props.list.length){var e=this.props.value;this.setState({selectValue:{id:e.id,name:e.name||this.props.list.find((function(t){return t.id===e.id})).name},sortSelectValue:e.values})}},n.UNSAFE_componentWillReceiveProps=function(e){e.value&&this.props.list.length&&this.setState({selectValue:{id:e.value.id,name:e.value.name||this.props.list.find((function(t){return t.id===e.value.id})).name},sortSelectValue:e.value.values})},n.changeShow=function(e){var t=this;this.state.show&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){t.setState({show:!t.state.show})}),0)},n.getValue=function(){return this.state.selectValue.id?{id:this.state.selectValue.id,values:this.state.sortSelectValue,name:this.state.selectValue.name}:{}},n.componentWillUnmount=function(){window.removeEventListener("click",this.setShowSelFalse)},n.render=function(){var e=this,t=this.props,n=t.list,r=t.className,i=(t.title,this.state),a=i.selectValue,l=i.sortSelectValue,s=i.show,u=i.triangle,c=n.map((function(e){return delete e.sel,e})),d=n.find((function(e){return e.id===a.id}))?n.find((function(e){return e.id===a.id})).values.map((function(e){return delete e.sel,e})):[];return o.createElement("div",{className:"yt_analyze_object_wrap "+r},o.createElement("div",{className:"analyze-object-select",onClick:function(t){return e.changeShow(t)}},o.createElement("div",{className:"infor "+(s?"sel":"")},o.createElement("span",{style:{color:"\u8bf7\u9009\u62e9"===this.getName()?"#8c8c8c":"#262626"}},this.getName()),o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:s?"rotate(-180deg)":""}})),s&&o.createElement(w,{options:c,value:a,onChange:function(t){return e.onSelChange("selectValue",t)},triangle:"select"===u})),s&&o.createElement(O,{singelSel:this.props.singelSel,options:d,limit:this.props.limit,value:l,onChange:function(t){return e.onSelChange("sortSelectValue",t)},triangle:"sortSelect"===u}))},t}(o.Component);var k=n(49722),I=n(61193),A=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleCheckedAll=function(e){var n=t.props,r=n.ITEMS,i=n.changeState,a=n.checkedList,o=[];e.target.checked?(a.map((function(e){return o.push(e)})),r.filter((function(e){return o.indexOf(e)<0})).map((function(e){return o.push(e)}))):a.filter((function(e){return r.indexOf(e)<0})).map((function(e){return o.push(e)})),i&&i(o)},t.handleChange=function(e){var n=t.props,r=n.changeState,i=n.checkedList,a=n.limit;Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},a?-1===i.indexOf(e)?i.length<a?i.push(e):c.default.warning("\u5f53\u524d\u6761\u4ef6\u4e0b\u6700\u591a\u652f\u6301\u9009\u62e9"+a+"\u4e2a\u5206\u6790\u6307\u6807"):i.remove(e):-1===i.indexOf(e)?i.push(e):i.remove(e),r&&r(i)},t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.ITEMS,r=t.categoryTitle,i=(t.titles,t.checkedList),a=t.type,l=i.filter((function(e){return n.indexOf(e)>=0})),s=!!l.length&&l.length===n.length,u=!!l.length&&l.length!==n.length;return o.createElement("div",{className:"vertical"===a?"new-checkbox-panel new-checkbox-panel-vertical":"new-checkbox-panel"},o.createElement(T.default,{checked:s,indeterminate:u,onChange:this.handleCheckedAll},r||"\u5168\u9009"),o.createElement(T.default.Group,{options:n,value:i,onClick:function(t){var n=t.target.value;return n&&e.handleChange(n)}}))},t}(o.Component),b=n(97189),P=function(e){function t(t){var n;return(n=e.call(this,t)||this).changeState=function(e){n.setState(e,(function(){n.updateFilter()}))},n.clickCheckbox=function(e){var t=e.aspect1,r=e.aspect2,i=n.state.limit;i&&(t&&t.length>i||r&&r.length>i)?c.default.warning("\u5f53\u524d\u6761\u4ef6\u4e0b\u6700\u591a\u652f\u6301\u9009\u62e9"+i+"\u4e2a\u5206\u6790\u6307\u6807"):n.setState(e)},n.updateFilter=function(){var e=n.state.aspectType,t=n.state,r=t.aspect1,i=t.aspect2;e&&r&&r.length>0?i=[]:i.length>0&&(r=[]),n.setState({aspect1:r,aspect2:i})},n.clickConfirmBtn=function(){n.props.onChange(),n.props.closePanel()},n.clickCancelBtn=function(){n.state.aspectShow&&n.props.closePanel()},n.orderAspect=function(e){for(var t=n.state.aspectList,r=[],i=[],a=0;a<t.length;a++){for(var o=!1,l=0;l<e.length;l++)if(t[a].name===e[l]){o=!0,r[l]=t[a];break}o||i.push(t[a])}n.setState({aspectList:r.concat(i)})},n.state={aspectShow:!1,aspectType:!t.value||t.value.aspect1.length>0,aspect1:t.value&&t.value.aspect1?t.value.aspect1:[],aspect2:t.value&&t.value.aspect2?t.value.aspect2:[],rawAspectList:[],aspectList:[],projectId:t.projectId,model:t.model,ready:!1,limit:t.limit,panelWidth:t.panelWidth},n}(0,a.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){var t=e.aspectShow,n=e.limit,r=e.panelWidth;this.setState({aspectShow:t,limit:n,panelWidth:r})},n.componentDidMount=function(){this.getValue(),window.addEventListener("click",this.clickCancelBtn)},n.componentDidUpdate=function(){this.setLeftBlockHeight()},n.componentWillUnmount=function(){window.removeEventListener("click",this.clickCancelBtn)},n.setLeftBlockHeight=function(){var e=document.querySelectorAll(".analyse-aspect-panel-body .left .new-checkbox-panel .ant-checkbox-group .ant-checkbox-wrapper"),t=document.querySelectorAll(".analyse-aspect-panel-body .right .new-checkbox-panel .ant-checkbox-group");if(e.forEach((function(e){return e.style.marginBottom="0"})),t.length>0)for(var n=t.length-1;n>=0;n--){var r=t[n].offsetHeight;r>36&&(e[n].style.marginBottom=r-36+"px")}},n.getValue=function(){var e=this.state,t=e.aspectType,n=e.aspect1,r=e.aspect2;if(e.ready)return[{id:"ASPECT1",values:t?n:[]},{id:"ASPECT2",values:t?[]:r}];var i=this.props,a=i.projectId,o=i.model;this.fetchAspects(a,o)},n.getSndIndex=function(e){var t=this.state.aspects[e];return t&&t.length>0&&this.setState({aspectType:!1,aspect1:[],aspect2:t}),t},n.setAspectFromOutside=function(e){this.setState((0,i.Z)({aspectType:e.aspect1.length>0},e))},n.fetchAspects=function(e,t){var n=this,r=t.map((function(t){return k.h.post("filter/find",{filterTypes:["ASPECT"],projectId:e,type:t})}));Promise.all(r).then((function(r){r.forEach((function(r){var i=r.data.result,a=n.state.rawAspectList;i.aspect&&n.setState({projectId:e,model:t,rawAspectList:a.concat(i.aspect)})})),n.formatData()}))},n.formatData=function(){var e=this.state,t=e.model,n=e.aspect1,r=e.aspect2,i=e.rawAspectList,a=(e.limit,this.state),o=a.aspectShow,l=a.aspectType,s=i,u={};if("BRAND"===t){var c=s.map((function(e){return e&&JSON.parse(e)})),d=0,p=I.Z.getAuthority();if(p.indexOf("ANALYZE_PRODUCT")>=0&&d++,p.indexOf("ANALYZE_SERVER")>=0&&d++,p.indexOf("ANALYZE_MARKETING")>=0&&d++,0===d)c.forEach((function(e){Object.keys(e).forEach((function(e,t){return u[t]=e}))}));else if(1===d)["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].forEach((function(e,t){p.indexOf(e)>=0&&Object.keys(c[t]).map((function(e,t){return u[t]=e}))}));else if(d>1){if(p.indexOf("ANALYZE_PRODUCT")>=0){var f=Object.keys(c[0]);1===f.length?u["\u4ea7\u54c1"]=c[0][f[0]]:f.length>1&&(u["\u4ea7\u54c1"]=c[0])}if(p.indexOf("ANALYZE_SERVER")>=0){var m=Object.keys(c[1]);1===m.length?u["\u670d\u52a1"]=c[1][m[0]]:m.length>1&&(u["\u670d\u52a1"]=c[1])}if(p.indexOf("ANALYZE_MARKETING")>=0){var h=Object.keys(c[2]);1===h.length?u["\u5e02\u573a"]=c[2][h[0]]:h.length>1&&(u["\u5e02\u573a"]=c[2])}}}else s&&s[0]&&s.forEach((function(e){u=Object.assign.apply(Object,[u].concat(JSON.parse(e)))}));var v=Object.keys(u).map((function(e,t){var n=u[e];return{id:t,name:e,contain:n.length?n:Object.keys(n).map((function(e,t){var r=n[e];return{id:t,name:e,contain:r.length?r:Object.keys(r)}}))}}));v.length<=1&&(o=!1,l=!1),this.changeState({aspectList:v,aspectShow:o,aspects:u,aspectType:l,aspect1:n,aspect2:r,ready:!0}),this.props.onChange()},n.handleClickBlock=function(e,t){var n=this.state,r=n.aspectType;if(n.aspectShow&&r!==e){var i=document.querySelectorAll(".analyse-aspect-panel-body div"),a="disabled";e?this.hanldeClass("remove",i[1],a):this.hanldeClass("remove",i[0],a),e?this.setState({aspectType:e,aspect2:[]}):this.setState({aspectType:e,aspect1:[]})}},n.hanldeClass=function(e,t,n){if("add"===e)(0,b.addClass)(t,n);else(0,b.removeClass)(t,n)},n.clearOptions=function(){this.setState({aspect1:[],aspect2:[]})},n.render=function(){var e=this,t=this.state,n=t.aspectList,r=t.aspectType,i=t.aspect1,a=t.aspect2,l=t.aspectShow,s=t.limit,c=t.panelWidth;return o.createElement("div",{className:"alert_aspect_panel_wrapper",ref:function(t){return e.panelRef=t},style:{display:l?"block":"none",width:c,right:"no_left"===this.props.className?"unset":"-246px"},onClick:function(e){return e.stopPropagation()}},o.createElement("div",{className:"analyse-aspect-panel-body"},o.createElement("div",{className:r?"left":"left disabled",onClick:function(t){return e.handleClickBlock(!0,t)}},o.createElement(A,{changeState:function(t){return e.clickCheckbox({aspect1:t})},checkedList:i,ITEMS:n.map((function(e){return e.name||e})),categoryTitle:"\u4e00\u7ea7\u6307\u6807",type:"vertical",limit:s})),o.createElement("div",{className:r?"right disabled":"right",onClick:function(t){return e.handleClickBlock(!1,t)}},o.createElement("div",null,"\u4e8c\u7ea7\u6307\u6807"),n.length>0&&n.map((function(t,n){return o.createElement(A,{changeState:function(t){return e.clickCheckbox({aspect2:t})},checkedList:JSON.parse(JSON.stringify(a)),key:"aspect1-"+n,categoryTitle:t.name,ITEMS:t.contain.map((function(e){return e.name||e})),type:"horizontal",limit:s})})))),o.createElement("div",{className:"analyse-aspect-panel-footer"},o.createElement("span",{onClick:function(){return e.clearOptions()}},"\u6e05\u7a7a\u5168\u90e8\u9009\u9879"),o.createElement("div",null,o.createElement(u.default,{onClick:function(){return e.clickCancelBtn()}},"\u53d6\u6d88"),o.createElement(u.default,{type:"primary",onClick:function(){return e.clickConfirmBtn()}},"\u786e\u5b9a"))))},t}(o.Component),L=function(e){function t(t){var n;return(n=e.call(this,t)||this).closePanel=function(){n.setState({showPanel:!1})},n.handleAspectChange=function(){n.getFormatedValue(),n.props.onChange()},n.getFormatedValue=function(){if(n.panel){var e=n.panel.getValue();if(e){var t=e.find((function(e){return"ASPECT1"===e.id})).values,r=e.find((function(e){return"ASPECT2"===e.id})).values;n.setState({formatedValue:(0===t.length&&0===r.length?"\u8bf7\u9009\u62e9":0===t.length?"\u4e8c\u7ea7\u6307\u6807\uff1a":"\u4e00\u7ea7\u6307\u6807\uff1a")+(t.length>0?t.join("\uff0c"):r.join("\uff0c"))})}}},n.handleClear=function(e){e.stopPropagation(),n.panel&&n.panel.clearOptions(),setTimeout((function(){return n.getFormatedValue()}),0)},n.getPanelWidth=function(){},n.state={showPanel:!1,formatedValue:"",showClearIcon:!1,panelWidth:840},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.getPanelWidth()},n.togglePanel=function(e){var t=this,n=this.state.showPanel;n&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){return t.setState({showPanel:!n})}),0)},n.getValue=function(){if(this.panel)return this.panel.getValue()},n.getSndIndex=function(e){return this.panel.getSndIndex(e)},n.setAspectFromOutside=function(e){if(e){var t=e.aspect1,n=e.aspect2;this.setState({formatedValue:(0===t.length&&0===n.length?"\u8bf7\u9009\u62e9":0===t.length?"\u4e8c\u7ea7\u6307\u6807\uff1a":"\u4e00\u7ea7\u6307\u6807\uff1a")+(t.length>0?t.join("\uff0c"):n.join("\uff0c"))})}return this.panel.setAspectFromOutside(e)},n.orderAspect=function(e){this.panel.orderAspect(e)},n.render=function(){var e=this,t=this.state,n=t.showPanel,r=t.formatedValue,a=(t.showClearIcon,t.panelWidth);return o.createElement("div",{className:"analyse_aspect_wrapper"},o.createElement("div",{className:"analyse-aspect-trigger analyse-aspect-trigger-input-mode",onClick:function(t){return e.togglePanel(t)},onMouseOver:function(){return e.setState({showClearIcon:!0})},onMouseLeave:function(){return e.setState({showClearIcon:!1})}},o.createElement(y.default,{ref:function(t){return e.input=t},value:r.length>8?r.substring(0,8)+"...":r,style:{color:"\u8bf7\u9009\u62e9"===r?"#8c8c8c":"#262626"}}),o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:n?"rotate(180deg)":""}})),o.createElement(P,(0,i.Z)({ref:function(t){e.panel=t},panelWidth:a,aspectShow:n,closePanel:this.closePanel},this.props,{onChange:this.handleAspectChange})))},t}(o.Component),D=n(35239),F=n(35103);const W=function(e){var t=e.screenValue,n=e.pageType,r=e.onScreenValuesChange,i=o.useState(!1),a=i[0],l=i[1];return o.createElement("div",{className:"alert_more_filter"},o.createElement("span",{className:"title",onClick:function(){return l(!a)}},"\u66f4\u591a\u7b5b\u9009\u6761\u4ef6",o.createElement("i",{className:"icon-cem_pull-down-or-take-up"})),o.createElement("div",{className:"screening_wrapper "+(a?"show_screening_wrapper":"none_screening_wrapper")},o.createElement(F.Z,{pageType:n,expandInfo:{type:n},screenValue:t,advanceAuthority:!1,mainContentSearch:!0,showList:["screening"],onScreenValuesChange:r,projectId:D.t.get(D.V.backProjectConfig).id})))};var M=["PRODUCT","MARKETING","SERVICE"],K=[{value:"LAST_SENVEN_DAYS",label:"\u8fd17\u5929",des:"\u6bcf\u6b21\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u65f6\u7684\u65f6\u95f4\u662f\u4ece\u5f53\u5929\u5f80\u524d\u63a86\u5929\u768400\uff1a00\uff1a00 ~ \u5f53\u524d\u65f6\u95f4"},{value:"LAST_THREE_DAYS",label:"\u8fd13\u5929",des:"\u6bcf\u6b21\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u65f6\u7684\u65f6\u95f4\u662f\u4ece\u524d\u5929\u768400:00:00 ~ \u5f53\u524d\u65f6\u95f4"},{value:"LAST_THIRTY_DAYS",label:"\u8fd130\u5929",des:"\u6bcf\u6b21\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u65f6\u7684\u65f6\u95f4\u662f\u4ece\u5f53\u5929\u5f80\u524d\u63a829\u5929\u768400:00:00 ~ \u5f53\u524d\u65f6\u95f4"},{value:"CURRENT_DAY",label:"\u5f53\u5929",des:"\u6bcf\u6b21\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u65f6\u7684\u65f6\u95f4\u662f\u4ece\u5f53\u5929\u768400:00:00 ~ \u5f53\u524d\u65f6\u95f4"},{value:"CURRENT_WEEK",label:"\u5f53\u5468",des:"\u5f53\u5468\u7684\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u7684\u65f6\u95f4\u662f\u4ece\u5f53\u5468\u7684\u5468\u4e00\u768400:00:00 ~ \u5f53\u524d\u65f6\u95f4\u3002<br/>\u4e0a\u5468\u4e4b\u524d\u7684\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u7684\u4e8b\u4ef6\u662f\u4ece\u8be5\u5468\u7684\u5468\u4e0000:00:00 ~ \u8be5\u5468\u7684\u5468\u65e523:59:59"},{value:"CURRENT_MONTH",label:"\u5f53\u6708",des:"\u5f53\u6708\u7684\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u7684\u65f6\u95f4\u662f\u4ece\u5f53\u6708\u76841\u65e5\u768400:00:00 ~ \u5f53\u524d\u65f6\u95f4\u3002<br/>\u4e0a\u6708\u4e4b\u524d\u7684\u8ba1\u7b97\u9884\u8b66\u6570\u503c\u7684\u4e8b\u4ef6\u662f\u4ece\u8be5\u6708\u7684\u54681\u65e500:00:00 ~ \u8be5\u6708\u7684\u6700\u540e1\u5929\u768423:59:59"}],x=function(e){var t={aspect1:[],aspect2:[]};if(e&&e.some((function(e){return"ASPECT_MODEL"===e.id}))){var n=e.find((function(e){return"ASPECT_MODEL"===e.id})).values;n&&n.some((function(e){return"ASPECT1"===e.id}))&&(t.aspect1=n.find((function(e){return"ASPECT1"===e.id})).values),n&&n.some((function(e){return"ASPECT2"===e.id}))&&(t.aspect2=n.find((function(e){return"ASPECT2"===e.id})).values)}return t},q=function(e){var t;if(e&&e.some((function(e){return"TOPIC"===e.id}))){var n=e.find((function(e){return"TOPIC"===e.id})).values;1===n[n.length-1].value&&(t={id:n[n.length-1].id,name:n[n.length-1].label,values:n[n.length-1].values})}return t},Y=function(e,t,n){var r;if(e&&e.some((function(e){return e.id===t}))){var i,a=e.find((function(e){return e.id===t})),o=a.values,l=a.label,s=null==(i=o.find((function(e){return e.id===n})).values)?void 0:i.length;if("BRAND_SERIES"===t&&"BRAND"===n&&s>1)return;o&&o.some((function(e){return e.id===n}))&&s&&(r="QUESTION_NAME"===n?l:o.find((function(e){return e.id===n})).values[0])}return r},V={17:"WARNING_NPS_ASPECT",21:"WARNING_APP_COMMENT_ASPECT",22:"WARNING_ZENDESK_ASPECT",1:"WARNING_COMMENT_ASPECT",12:"WARNING_SELF_ASPECT"},Z={21:"PRODUCT_INFO",12:"BRAND_SERIES"},U={21:"PRODUCT_LINE",12:"BRAND"};const B=function(e){function t(t){var n;return(n=e.call(this,t)||this).aspectChange=function(){var e,t,r,i,a=n.props,o=a.formRuleChange,l=a.formRule.headerFilterParamsNew,s=a.source;switch(s){case 21:case 22:i="PRODUCT_INFO";break;case 12:i="BRAND_SERIES";break;default:i="TOPIC"}var u=null!=(e=n.props.headerFilterParamsNew)&&e.some((function(e){return e.id===i}))&&null!=l&&l.some((function(e){return e.id===i}))&&n.props.headerFilterParamsNew.find((function(e){return e.id===i})).values.length<l.find((function(e){return e.id===i})).values.length?n.props.headerFilterParamsNew.find((function(e){return e.id===i})):l.find((function(e){return e.id===i})),c=null!=(t=n.props.headerFilterParamsNew)&&null!=(r=t.filter((function(e){return e.id!==i})))&&r.length?l.some((function(e){return e.id===i}))?[].concat(n.props.headerFilterParamsNew.filter((function(e){return e.id!==i})),[u]):n.props.headerFilterParamsNew:l;o({key:["headerFilterParamsNew","aspect"],value:(0,E.ZP)(c,(function(e){var t;e.find((function(e){return"ASPECT_MODEL"===e.id}))?e.find((function(e){return"ASPECT_MODEL"===e.id})).values=22===s?Array.from(new Set([].concat(n.analyseAspect&&n.analyseAspect.getValue(),(null==(t=e.find((function(e){return"ASPECT_MODEL"===e.id})))?void 0:t.values.filter((function(e){return"ASPECT1"!==e.id&&"ASPECT2"!==e.id})))||[]))):n.analyseAspect&&n.analyseAspect.getValue():e.push({id:"ASPECT_MODEL",values:n.analyseAspect&&n.analyseAspect.getValue()})})),noChange:0===n.times}),n.times++},n.objectChange=function(e){var t,r,i=n.props,a=i.formRuleChange,o=i.formRule.headerFilterParamsNew,l=null!=(t=n.props.headerFilterParamsNew)&&null!=(r=t.filter((function(e){return"TOPIC"!==e.id})))&&r.length?o.some((function(e){return"ASPECT_MODEL"===e.id}))?[].concat(n.props.headerFilterParamsNew.filter((function(e){return"ASPECT_MODEL"!==e.id})),[o.find((function(e){return"ASPECT_MODEL"===e.id}))]):n.props.headerFilterParamsNew:o;a({key:["headerFilterParamsNew"],value:(0,E.ZP)(l,(function(t){t.find((function(e){return"TOPIC"===e.id}))?t.find((function(e){return"TOPIC"===e.id})).values=[{id:e.id,value:1,values:e.values.map((function(e){return e.id}))}]:t.push({id:"TOPIC",values:[{id:e.id,value:1,values:e.values.map((function(e){return e.id}))}]})}))})},n.handleSearch=C()((function(e){17===n.props.source&&(e?n.props.fetchQuestionnaireList({name:e,pageIndex:1}).then((function(e){n.setState({questionnaireList:e})})):n.setState({questionnaireList:[]}))}),600),n.productNameChange=function(e,t){var r,i,a=n.props,o=a.formRuleChange,l=a.formRule.headerFilterParamsNew,s=a.source,u=Z[s]||"QUESTIONNAIRE_RELATED",c=null!=(r=n.props.headerFilterParamsNew)&&null!=(i=r.filter((function(e){return e.id!==u})))&&i.length?l.some((function(e){return"ASPECT_MODEL"===e.id}))?[].concat(n.props.headerFilterParamsNew.filter((function(e){return"ASPECT_MODEL"!==e.id})),[l.find((function(e){return"ASPECT_MODEL"===e.id}))]):n.props.headerFilterParamsNew:l,d=U[s]||"QUESTION_NAME",p=17===s?t.key:e;o({key:["headerFilterParamsNew"],value:(0,E.ZP)(c,(function(t){var n;t.find((function(e){return e.id===u}))?null!=(n=t.find((function(e){return e.id===u})).values)&&n.find((function(e){return e.id===d}))?(t.find((function(e){return e.id===u})).label=17===s?e:void 0,t.find((function(e){return e.id===u})).values=[{id:d,value:1,values:[p]}]):(t.find((function(e){return e.id===u})).label=17===s?e:void 0,t.find((function(e){return e.id===u})).values.push({id:d,value:1,values:[p]})):t.push({id:u,label:17===s?e:void 0,values:[{id:d,value:1,values:[p]}]})}))})},n.previewChange=function(e,t){var r=n.props.formRule,i=n.state.vptValue;if("all"===e){if(""===i)return void c.default.warning("\u8f93\u5165\u9884\u8b66\u9619\u503c\uff0c\u598250");r.ruleDetail=t.map((function(e){return{name:e,value:i}})),n.setState({vptValue:"",redIndex:[]})}else r.ruleDetail.some((function(t){return t.name===e}))?r.ruleDetail.forEach((function(n){n.name===e&&(n.value=t)})):r.ruleDetail.push({name:e,value:t});n.props.formRuleChange({key:["ruleDetail"],value:r.ruleDetail})},n.selInput=function(e,t){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.setState({selIndex:t})},n.cancelSel=function(){n.setState({selIndex:null})},n.judge=function(e,t){var r=n.state.redIndex;e?r.includes(t)&&(r.splice(r.indexOf(t),1),n.setState({redIndex:JSON.parse(JSON.stringify(r))})):(c.default.error("\u8bf7\u586b\u5199\u9884\u8b66\u9600\u503c"),n.setState({redIndex:[].concat(r,[t])}))},n.state={vptValue:"",redIndex:[],selIndex:null,questionnaireList:t.questionnaireList},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.times=0,window.addEventListener("click",this.cancelSel)},n.componentWillUnmount=function(){window.removeEventListener("click",this.cancelSel)},n.UNSAFE_componentWillReceiveProps=function(e){var t=e.redIndex,n=e.formRule,r=e.questionnaireList;if(t&&this.setState({redIndex:t}),r&&this.setState({questionnaireList:r}),n.headerFilterParamsNew&&n.headerFilterParamsNew.find((function(e){return"ASPECT_MODEL"===e.id}))){var i=x(n.headerFilterParamsNew);this.analyseAspect&&this.analyseAspect.setAspectFromOutside(i)}},n.render=function(){var e,t,n,r,a,l=this,s=this.props,d=s.formRule,p=s.formRuleChange,f=s.curScreeningMap,h=s.source,v=s.onScreenValuesChange,E=this.state,_=E.selIndex,C=E.redIndex,w=E.vptValue,T=E.questionnaireList,O=x(d.headerFilterParamsNew),k=O.aspect1.length?O.aspect1:O.aspect2.length?O.aspect2:null,I=Z[h]||"QUESTIONNAIRE_RELATED",A=U[h]||"QUESTION_NAME",b=17===h?T.map((function(e){return{label:e.title,value:e.title,key:e.id}})):12===h?null==f||null==(e=f.find((function(e){return"BRAND_SERIES"===e.id})))||null==(t=e.data.find((function(e){return"BRAND"===e.id})))?void 0:t.options.map((function(e){return{label:e.label,value:e.id}})):null==f||null==(n=f.find((function(e){return"PRODUCT_INFO"===e.id})))||null==(r=n.data.find((function(e){return e.id===A})))?void 0:r.options.map((function(e){return{label:e.label,value:e.id}}));return o.createElement("div",{className:"comment_aspect_alert_edit_wrap"},o.createElement("div",{className:"analysis_object_wrap"},22!==h&&o.createElement("div",null,o.createElement("span",null,"\u9884\u8b66\u5bf9\u8c61\uff1a"),1!==h?o.createElement(N.default,{placeholder:"\u8bf7\u9009\u62e9",options:b,getPopupContainer:function(){return document.querySelector(".analysis_object_wrap")},showSearch:!0,optionFilterProp:"label",filterOption:17!==h,onSearch:this.handleSearch,value:b&&Y(d.headerFilterParamsNew,I,A),onChange:this.productNameChange,suffixIcon:o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c",cursor:"pointer"}})}):o.createElement(R,{list:null!=f&&f.find((function(e){return"TOPIC"===e.id}))?f.find((function(e){return"TOPIC"===e.id})).data.map((function(e){return{id:e.id,name:e.label,values:e.options.map((function(e){return{id:e.id,name:e.label}}))}})):[],ref:function(e){return l.analyseObject=e},value:q(d.headerFilterParamsNew),singelSel:!0,title:"\u9884\u8b66\u5bf9\u8c61",onChange:function(e){return l.objectChange(e)}})),o.createElement("div",{style:{marginLeft:22===h?0:48}},o.createElement("span",null,"\u76d1\u6d4b\u6307\u6807\uff1a"),o.createElement(L,{className:22===h?"no_left":"",ref:function(e){return l.analyseAspect=e},limit:null,value:O,model:M,projectId:D.t.get(D.V.backProjectConfig).id,onChange:function(){return l.aspectChange()}}))),o.createElement(W,{screenValue:null!=(a=d.headerFilterParamsNew)&&a.find((function(e){return"PRODUCT_INFO"===e.id||"DEFAULT"===e.id}))?(0,g.SR)(d.headerFilterParamsNew,f):d.headerFilterParamsNew,pageType:V[h]||"",onScreenValuesChange:v}),o.createElement("div",{className:"analysis_cal_wrap"},o.createElement(m.Z.Group,{name:"calType",label:"\u8ba1\u7b97\u516c\u5f0f",options:[{label:o.createElement("span",null,"\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4",o.createElement(S.default,{content:o.createElement("div",{style:{fontSize:12,maxWidth:200}},"\u63cf\u8ff0\u7528\u6237\u5bf9\u4e00\u4e2a\u6307\u6807\u7684\u4e0d\u6ee1\u610f\u7a0b\u5ea6\uff0c\u5177\u4f53\u662f\u6307\u8d1f\u9762\u58f0\u91cf\u5360\u8be5\u6307\u6807\u7684\u5168\u90e8\u58f0\u91cf\u7684\u6bd4\u91cd\u3002")},o.createElement("i",{className:"icon-cem_file1",style:{fontSize:14,color:"#979797",marginLeft:8}}))),value:"PERCENT"},{label:"\u8d1f\u9762\u58f0\u91cf",value:"NUMBER"}]})),o.createElement("div",{className:"analysis_cal_wrap analysis_dateRangeType_wrap"},o.createElement(m.Z.Group,{name:"dateRangeType",label:"\u65f6\u95f4\u8303\u56f4",options:K.map((function(e){return{value:e.value,label:o.createElement("span",{className:"date_radio"},e.label,o.createElement(S.default,{content:o.createElement("div",{style:{maxWidth:200,fontSize:12},dangerouslySetInnerHTML:{__html:e.des}})},o.createElement("i",{className:"icon-cem_file1 hide",style:{fontSize:14,color:"#979797",marginLeft:8}})))}}))}),"NUMBER"!==d.condition.calType&&o.createElement("span",{style:{marginTop:"-20px"}},"\u53ea\u6709\u5728\u8d1f\u9762\u58f0\u91cf\u5927\u4e8e",o.createElement(y.default,{size:"small",value:d.condition.min||100,onChange:function(e){var t=e.target.value;p({key:["condition"],value:(0,i.Z)({},d.condition,{min:1===String(t).length&&"0"===t?"":t.replace(/[^\d]/g,"")})})},onBlur:function(){return(!d.condition.min||d.condition.min<10)&&c.default.error("\u8bf7\u586b\u5199\u8d1f\u9762\u58f0\u91cf\u6700\u5c0f\u503c\uff0c\u4e14\u8be5\u503c\u6700\u5c0f\u4e3a10")},style:{width:54,margin:"0 8px"}}),"\u624d\u4f1a\u89e6\u53d1\u9884\u8b66",o.createElement(S.default,{content:o.createElement("div",{style:{maxWidth:200,fontSize:12}},"\u5f53\u6211\u4eec\u57fa\u4e8e\u767e\u5206\u6bd4\u9884\u8b66\u65f6\uff0c\u4e3a\u9632\u6b62\u58f0\u91cf\u5f88\u5c0f\u7684\u521d\u671f\u8be5\u6570\u636e\u5267\u70c8\u6ce2\u52a8\uff0c\u5982\u4e00\u4f1a\u662f0%\uff0c\u4e00\u4f1a\u662f100%\u7684\u60c5\u51b5\uff0c\u4f60\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u6570\u91cf\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u8fd17\u5929\u662f100\uff0c\u4f60\u53ef\u4ee5\u4f9d\u636e\u4f60\u4eec\u7684\u5b9e\u9645\u4e1a\u52a1\u8fdb\u884c\u8c03\u6574\u3002")},o.createElement("i",{className:"icon-cem_file1",style:{fontSize:14,color:"#979797",marginLeft:8}})))),o.createElement("div",{className:"preview"},o.createElement("p",null,"\u89c4\u5219\u9884\u89c8(\u5728\u6807\u9898\u680f\u4e2d\u8f93\u5165\u53ef\u4ee5\u5b9e\u73b0\u5feb\u901f\u586b\u5145)",o.createElement(S.default,{content:o.createElement("div",{style:{maxWidth:200,fontSize:12}},"\u4ee5\u4e0b\u89c4\u5219\uff0c\u4efb\u4e00\u89e6\u53d1\u9884\u8b66\u5c31\u4f1a\u7ed9\u76f8\u5173\u7528\u6237\u63a8\u9001\u9884\u8b66\u4fe1\u606f")},o.createElement("i",{className:"icon-cem_file1",style:{fontSize:14,color:"#979797",marginLeft:8}}))),o.createElement("ul",{style:{width:k?"892px":"462px"}},o.createElement("li",{className:"monitor"},o.createElement("div",{className:"left ellipsis",style:{width:k?k.length<=5?"445px":"442px":"460px"}},"\u76d1\u6d4b\u6307\u6807",o.createElement("span",null,"\uff08\u7cfb\u7edf\u4f1a\u5bf9",""+(this.analyseObject&&"\u8bf7\u9009\u62e9"!==this.analyseObject.getName()?this.analyseObject.getName():"\u9884\u8b66\u5bf9\u8c61"),K.filter((function(e){return d.condition.dateRangeType?e.value===d.condition.dateRangeType:"LAST_SENVEN_DAYS"===e.value}))[0].label,"\u5982\u4e0b\u6307\u6807\u7684","NUMBER"!==d.condition.calType?"\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4":"\u8d1f\u9762\u58f0\u91cf","\u8fdb\u884c\u9884\u8b66\u76d1\u6d4b)")),k&&o.createElement("div",{className:"right"},o.createElement(y.default,{ref:function(e){return l.input=e},placeholder:"\u8f93\u5165\u9884\u8b66\u9608\u503c\uff0c\u598250",value:w,onChange:function(e){var t=e.target.value;"NUMBER"!==d.condition.calType&&Number(t)>100?c.default.error("\u8ba1\u7b97\u516c\u5f0f\u4e3a\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4\u65f6\uff0c\u9884\u8b66\u9608\u503c\u9700\u5c0f\u4e8e\u7b49\u4e8e100%"):l.setState({vptValue:t.length&&0===Number(t)?"0":t.startsWith("0")?String(Number(t)):t.replace(/[^\d]/g,"")})}}),o.createElement(u.default,{disabled:0===w.length,type:"primary",onClick:function(){return l.previewChange("all",k)},style:{transform:"translateY(-1px)"}},"\u6279\u91cf\u586b\u5145"))),o.createElement("div",{className:"wrap"},k?k.map((function(e,t){var n=d.ruleDetail.some((function(t){return t.name===e}))?d.ruleDetail.filter((function(t){return t.name===e}))[0].value:"";return o.createElement("li",{key:e},o.createElement("div",{className:"left"},e),o.createElement("div",{className:"right "+(C.includes(t)?"red":""),onClick:function(e){return l.selInput(e,t)}},_!==t&&(""!==n?o.createElement("span",null,"\u8d85\u8fc7",(String(n).length>35?String(n).substring(0,34)+"...":n)+("NUMBER"!==d.condition.calType?"%":""),"\u5c31\u9884\u8b66"):o.createElement("span",null,"\u8bf7\u8f93\u5165\u9884\u8b66\u9608\u503c")),_===t&&o.createElement(y.default,{value:n,autoFocus:!0,onChange:function(t){var n=t.target.value;"NUMBER"!==d.condition.calType&&Number(n)>100?c.default.error("\u8ba1\u7b97\u516c\u5f0f\u4e3a\u8d1f\u9762\u58f0\u91cf\u5360\u6bd4\u65f6\uff0c\u9884\u8b66\u9608\u503c\u9700\u5c0f\u4e8e\u7b49\u4e8e100%"):l.previewChange(e,n.length&&0===Number(n)?"0":n.startsWith("0")?String(Number(n)):n.replace(/[^\d]/g,""))},onBlur:function(){return l.judge(n,t)}})))})):o.createElement("li",null,o.createElement("div",{className:"left",style:{color:"#8C8C8C"}},"\u5f53\u524d\u65e0\u4efb\u4f55\u6307\u6807"))))))},t}(o.Component);var j=n(15861),H=n(87757),G=n.n(H),J=n(7660),z=(n(53294),n(56697)),Q=function(e,t){var n="",r=e.pageY-t.getBoundingClientRect().y,i=e.pageX-t.getBoundingClientRect().x;return r<10||r>t.offsetHeight-10&&i>t.offsetWidth-10&&(n+="s"),n},X={ANY:100,ALL:10,NONE:100},$=[{kind:"ANY",tags:[]},{kind:"NONE",tags:[]}],ee=function(e,t){var n=e.some((function(e){return e.simpleKeyword}))?[{simpleKeyword:e.find((function(e){return e.simpleKeyword})).simpleKeyword}]:[];return[{seniorKeyword:t.seniorKeyword,type:e.some((function(e){return"SIMPLE_KEYWORD"===e.type}))||e.some((function(e){return"SENIOR_KEYWORD"===e.type}))?"SENIOR_KEYWORD":void 0}].concat(e.filter((function(e){return e.questionType})),n)},te=function(e,t){var n=e.some((function(e){return e.seniorKeyword}))?[{seniorKeyword:e.find((function(e){return e.seniorKeyword})).seniorKeyword}]:[];return[{simpleKeyword:t,type:e.some((function(e){return"SIMPLE_KEYWORD"===e.type}))||e.some((function(e){return"SENIOR_KEYWORD"===e.type}))?"SIMPLE_KEYWORD":void 0}].concat(e.filter((function(e){return e.questionType})),n)},ne=[{value:"ALL",label:"\u5305\u542b\u5168\u90e8 "},{value:"ANY",label:"\u5305\u542b\u4efb\u4e00\u4e2a"},{value:"NONE",label:"\u4e0d\u5305\u542b "}];const re=function(e){var t=e.visible,n=e.kind,r=e.onOk,i=e.onCancel,a=e.words,l=e.indexObj,s=o.useState(a),u=s[0],d=s[1],p=o.useState(a.length?Array.from(new Set(a)).slice(0,X[n]).join("\n"):""),f=p[0],m=p[1],h=o.useState(a.length===X[n]?13:0),v=h[0],E=h[1],g=function(){var e=(0,j.Z)(G().mark((function e(t){return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(t.keyCode);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return o.useEffect((function(){d(a),m(a.length?Array.from(new Set(a)).slice(0,X[n]).join("\n"):"")}),[a,t]),o.useEffect((function(){var e=document.querySelector(".alert_edit_add_modal .ant-modal-body textarea");return e&&e.addEventListener("keydown",g),function(){e&&e.removeEventListener("keydown",g)}}),[u]),o.createElement(z.Z,{className:"alert_edit_add_modal",width:560,title:n?ne.find((function(e){return e.value===n})).label:"",visible:t,onOk:function(){return r(Array.from(new Set(u)).slice(0,X[n]),l)},onCancel:function(){d(a),m(a.length?Array.from(new Set(a)).slice(0,X[n]).join("\n"):""),i()}},o.createElement("p",null,"\u6ce8\u610f\uff1a\u6309\u6362\u884c\u7b26\u5206\u9694\uff0c\u6bcf\u884c\u4e00\u4e2a\u5173\u952e\u8bcd\uff0c\u6700\u591a\u53ef\u8f93\u5165",X[n],"\u4e2a\u5173\u952e\u8bcd"),o.createElement(y.default.TextArea,{placeholder:"\u8bf7\u8f93\u5165",autoSize:{minRows:8,maxRows:17},value:f,onChange:function(e){var t=e.target.value,r=t.split("\n").filter((function(e){return e.length})).map((function(e){return e.trim().substring(0,20)}));u.length===X[n]&&13===v||(m(t),d(Array.from(new Set(r)).slice(0,X[n])))},onPressEnter:function(e){E(13);var t=e.target.value,r=t.split("\n").filter((function(e){return e.length})).map((function(e){return e.trim().substring(0,20)})),i=r.length?r[r.length-1].trim().substring(0,20):"",a=Array.from(new Set(t.split("\n").filter((function(e){return e.length})).map((function(e){return e.trim().substring(0,20)}))));m(a.join("\n")),u.length===X[n]?c.default.error("\u6700\u591a\u8f93\u5165"+X[n]+"\u4e2a\u5173\u952e\u8bcd"):u.length<X[n]&&""!==i&&!u.includes(i)&&d(r)},onFocus:function(e){u.length===X[n]&&E(0)}}))};const ie=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleKeyDown=function(e){8===e.keyCode&&""===e.target.value&&n.props.onDeleteTag(e.target.parentNode.parentNode.className.split(" ")[1])},n.handleOnCancel=function(){n.setState({visible:!1,kind:"",words:[]})},n.handleOnOk=function(e,t){n.props.onAddItems(e,t),n.handleOnCancel()},n.state={visible:!1,kind:"",words:[],indexObj:{}},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=document.querySelectorAll(".keyword_rule_group_item .rc-tag-input .input-area input");t&&t.length&&t.forEach((function(t){t.addEventListener("keydown",e.handleKeyDown)}))},n.componentDidUpdate=function(e){var t=this,n=e.ruleGroupList,r=this.props.ruleGroupList;if(JSON.stringify(n)!==JSON.stringify(r)){var i=document.querySelectorAll(".keyword_rule_group_item .rc-tag-input .input-area input");i&&i.length&&i.forEach((function(e){e.addEventListener("keydown",t.handleKeyDown)}))}},n.componentWillUnmount=function(){var e=this,t=document.querySelectorAll(".keyword_rule_group_item .rc-tag-input .input-area input");t&&t.length&&t.forEach((function(t){t.removeEventListener("keydown",e.handleKeyDown)}))},n.render=function(){var e=this,t=this.props,n=t.ruleGroupList,r=t.onSelectChange,i=t.onAddTag,a=t.onDeleteTag,l=t.onAddItem,s=t.onDeleteItem,u=t.onAddGroupItem,c=t.onDeleteGroupItem,d=this.state,p=d.visible,f=d.kind,m=d.words,h=d.indexObj;return o.createElement("div",{className:"advanced_keyword_alert_edit_wrap"},n.map((function(t,n){return o.createElement("div",{key:n,className:"group_list_wrap "+(t.length>1?"multi_group_list_wrap":"")},o.createElement("div",{className:"group_list_item"},o.createElement("div",{style:{display:"flex",marginBottom:12}},o.createElement("span",{className:"list_left"},o.createElement("span",null,"\u4e14")),o.createElement("span",{className:"list_right"},t.map((function(l,u){var c="rule-"+l.kind+"-"+u+"-"+n;return o.createElement("div",{key:c,className:"keyword_rule_group_item keyword_rule_group_item_"+u},o.createElement("span",null,o.createElement(N.default,{className:"keyword_rule_item_select",dropdownClassName:"keyword_rule_item_select_dropdown",value:l.kind,options:ne,onChange:function(e){return r(c,e,t)},style:{width:120},getPopupContainer:function(e){return e.parentNode}})),o.createElement("span",null,o.createElement(J.EG,{classNameWrap:"analyse_rc_input",className:c+" rule_content "+(l.tags?"active":""),tags:l.tags.slice(0,X[l.kind]),onDelete:function(e,t,n){return a(c,e,t,n)},createTagOnPress:[13],placeholder:l.tags&&l.tags.length?"":"\u8bf7\u8f93\u5165",onAdd:function(e){return i(c,e)}})),o.createElement("span",{className:"add_item_wrap"},o.createElement("i",{className:"icon-cem_delete",onClick:function(){return s(c,t)}}),o.createElement("span",{className:"add_more",onClick:function(){e.setState({visible:!0,words:l.tags,kind:l.kind,indexObj:{index:u,groupIdx:n}})}},o.createElement("i",{className:"icon-piliangtianjia"}),"\u6279\u91cf\u6dfb\u52a0")))})))),o.createElement("span",{className:"group_list_item_add",onClick:function(){return l(n)}},o.createElement("i",{className:"icon-cem_add-to"}),o.createElement("span",null,"\u6dfb\u52a0\u65b0\u7684\u6761\u4ef6"))),o.createElement("i",{className:"icon-cem_delete",onClick:function(){return c(n)}}))})),o.createElement("span",{className:"group_list_add",onClick:function(){return u()}},o.createElement("i",{className:"icon-cem_add-to"}),o.createElement("span",null,"\u6dfb\u52a0\u65b0\u5173\u952e\u8bcd\u7ec4")),o.createElement(re,{kind:f,visible:p,words:m,indexObj:h,onCancel:this.handleOnCancel,onOk:this.handleOnOk}))},t}(o.Component);var ae,oe=!1,le="";const se=function(e){var t,n,r=e.source,a=e.formRule,l=e.keywordType,s=e.formRuleChange,u=e.ruleGroupList,d=e.onTypeChange,p=o.useState(void 0===l||l),f=p[0],m=p[1],h=o.useState((null==a||null==(t=a.rules)||null==(n=t.find((function(e){return"SIMPLE_KEYWORD"===e.type})))?void 0:n.simpleKeyword)||[]),v=h[0],E=h[1],g=o.useState(!f),y=g[0],N=g[1],_=o.useState(!1),C=_[0],w=_[1],T=function(){var e=(0,j.Z)(G().mark((function e(t){return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:8===t.keyCode&&""===t.target.value&&v&&v.length&&(v.pop(),E(v),R(v));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();o.useEffect((function(){var e=document.querySelector(".analyse_tag_input .rc-tag-input .input-area input");return e&&e.addEventListener("keydown",T),function(){e&&e.removeEventListener("keydown",T)}}),[v]),o.useEffect((function(){return window.addEventListener("mouseup",O),function(){window.removeEventListener("mouseup",O)}}),[ae]),o.useEffect((function(){var e,t;null!=a&&null!=(e=a.rules)&&e.find((function(e){return"SIMPLE_KEYWORD"===e.type}))&&E(null==a||null==(t=a.rules)?void 0:t.find((function(e){return"SIMPLE_KEYWORD"===e.type})).simpleKeyword)}),[a.rules]);var O=function(){oe=!1},R=function(e){var t,n,o={simpleKeyword:(null==(t=Array.from(new Set(e)))?void 0:t.slice(0,100))||v};s({key:["rules"],value:17===r?te(a.rules,(null==(n=Array.from(new Set(e)))?void 0:n.slice(0,100))||v):[(0,i.Z)({},o,{type:"SIMPLE_KEYWORD"}),{seniorKeyword:u}]})};return o.createElement("div",{className:"keyword_alert_edit_wrap"},o.createElement("div",{className:"title"},o.createElement("span",null,"\u9884\u8b66\u5173\u952e\u8bcd"),f?o.createElement("span",null,"\u5305\u542b\u4ee5\u4e0b\u4efb\u4e00\u5173\u952e\u8bcd\u65f6\u9884\u8b66\uff0c\u6700\u591a\u8f93\u5165100\u4e2a\u5173\u952e\u8bcd"):o.createElement("span",null,o.createElement(S.default,{content:o.createElement("a",{style:{fontSize:12,color:"#1890FF"},href:"https://skieer.feishu.cn/docs/doccnFob5ObAPb4cCGqwAp7IlNg",target:"_blank",rel:"noopener noreferrer"},"\u5982\u4f55\u914d\u7f6e\u9884\u8b66\u5173\u952e\u8bcd\uff1f")},o.createElement("i",{className:"icon-cem_file1",style:{fontSize:14,color:"#979797"}})),o.createElement("span",null,"\u6ee1\u8db3\u4efb\u4e00\u7ec4\u6761\u4ef6\uff0c\u8be5\u89c4\u5219\u5373\u751f\u6548"))),f?o.createElement("div",{className:"analyse_tag_input",onMouseMove:function(e){var t,n=document.querySelector(".analyse_tag_input"),r=Q(e,n);t=""===r?"default":r+"-resize",n&&(n.style.cursor=t,oe&&-1!==le.indexOf("s")&&(n.style.height=Math.max(100,n.offsetHeight+(e.clientY-ae))+"px",ae=e.clientY))},onMouseDown:function(e){var t=document.querySelector(".analyse_tag_input"),n=Q(e,t);""!==n&&(oe=!0,le=n,e.clientX,ae=e.clientY)}},o.createElement(J.EG,{classNameWrap:"analyse_rc_input",className:"rule_content "+(v&&v.length?"active":""),tags:v.slice(0,100),onAdd:function(e){v.length>=100?c.default.error("\u6700\u591a\u8f93\u5165100\u4e2a\u5173\u952e\u8bcd"):v.length<100&&""!==e.name.trim().substring(0,20)&&!v.includes(e.name.trim().substring(0,20))&&E([].concat(v,[e.name.trim().substring(0,20)])),R([].concat(v,[e.name.trim().substring(0,20)]))},createTagOnPress:[13],placeholder:v&&v.length?"":"\u8bf7\u8f93\u5165\u5173\u952e\u8bcd\uff0c\u6309\u56de\u8f66\u952e\u53ef\u6dfb\u52a0\u591a\u4e2a\u5173\u952e\u8bcd",onDelete:function(e,t,n){E(v.filter((function(t){return t!==e}))),R(v.filter((function(t){return t!==e})))},onInputChange:function(e){}})):o.createElement(ie,{ruleGroupList:u,onSelectChange:function(e,t,n){var o=e.split("-")[2],l=e.split("-")[3];if("NONE"!==t||1!==n.filter((function(e){return"NONE"!==e.kind})).length){u[l][o].kind=t;var d={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,d):[(0,i.Z)({},d,{type:"SENIOR_KEYWORD"})]}),N(!0)}else c.default.error("\u81f3\u5c11\u4fdd\u7559\u4e00\u4e2a\u5305\u542b\u6761\u4ef6\u7684\u5173\u952e\u8bcd")},onAddTag:function(e,t){var n=e.split("-")[1],o=e.split("-")[2],l=e.split("-")[3],d=u[l][o].tags;d.length>=X[n]&&c.default.error("\u6700\u591a\u8f93\u5165"+X[n]+"\u4e2a\u5173\u952e\u8bcd"),d.length<X[n]&&""!==t.name.trim().substring(0,20)&&!d.includes(t.name.trim().substring(0,20))&&(u[l][o].tags=[].concat(d,[t.name.trim().substring(0,20)]));var p={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,p):[(0,i.Z)({},p,{type:"SENIOR_KEYWORD"})]}),N(!0)},onDeleteTag:function(e,t,n){var o=e.split("-")[1],l=e.split("-")[2],d=e.split("-")[3],p=u[d][l].tags,f=1===u.map((function(e){return e.filter((function(e){return"NONE"!==e.kind}))})).reduce((function(e,t){return e.concat(t)}),[]).map((function(e){return e.tags})).reduce((function(e,t){return e.concat(t)}),[]).length&&u.map((function(e){return e.filter((function(e){return"NONE"!==e.kind}))})).reduce((function(e,t){return e.concat(t)}),[]).length>1||1===u.map((function(e){return e.filter((function(e){return"NONE"!==e.kind}))})).reduce((function(e,t){return e.concat(t)}),[]).length;1===p.length&&"NONE"!==o&&f?c.default.error("\u81f3\u5c11\u4fdd\u7559\u4e00\u4e2a\u5305\u542b\u7684\u5173\u952e\u8bcd"):n?u[d][l].tags.splice(n,1):u[d][l].tags.pop();var m={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,m):[(0,i.Z)({},m,{type:"SENIOR_KEYWORD"})]}),N(!0)},onAddGroupItem:function(){if(20!==u.length){var e={seniorKeyword:[].concat(u,[$])};s({key:["rules"],value:17===r?ee(a.rules,e):[(0,i.Z)({},e,{type:"SENIOR_KEYWORD"})]}),N(!0)}else c.default.error("\u6700\u591a\u6dfb\u52a020\u4e2a\u5173\u952e\u8bcd\u7ec4")},onAddItem:function(e){if(5!==u[e].length){u[e].push({kind:"ANY",tags:[]});var t={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,t):[(0,i.Z)({},t,{type:"SENIOR_KEYWORD"})]}),N(!0)}else c.default.error("\u6700\u591a\u6dfb\u52a05\u4e2a\u6761\u4ef6")},onAddItems:function(e,t){var n=t.index,o=t.groupIdx;u[o][n].tags=e;var l={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,l):[(0,i.Z)({},l,{type:"SENIOR_KEYWORD"})]}),N(!0)},onDeleteItem:function(e,t){var n=e.split("-")[1],o=e.split("-")[2],l=e.split("-")[3];if("NONE"!==n&&1===t.filter((function(e){return"NONE"!==e.kind})).length||2===t.length)c.default.error(2===t.length?"\u81f3\u5c11\u4fdd\u7559\u4e24\u4e2a\u6761\u4ef6":"\u81f3\u5c11\u4fdd\u7559\u4e00\u4e2a\u5305\u542b\u6761\u4ef6\u7684\u5173\u952e\u8bcd");else{u[l].splice(o,1);var d={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,d):[(0,i.Z)({},d,{type:"SENIOR_KEYWORD"})]}),N(!0)}},onDeleteGroupItem:function(e){if(1!==u.length){u.splice(e,1);var t={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,t):[(0,i.Z)({},t,{type:"SENIOR_KEYWORD"})]}),N(!0)}else c.default.error("\u81f3\u5c11\u4fdd\u7559\u4e00\u7ec4\u6761\u4ef6")}}),f&&o.createElement("div",{className:"add",onClick:function(){return w(!0)}},o.createElement("i",{className:"icon-piliangtianjia"}),"\u6279\u91cf\u6dfb\u52a0"),o.createElement("span",{onClick:function(e){if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),d&&d(!f),m(!f),f){var t,n=null==(t=u.find((function(e){return e.find((function(e){return"ANY"===e.kind}))})))?void 0:t.find((function(e){return"ANY"===e.kind})).tags;if(v&&!0===l&&!y){if(!n||!n.length){var o={seniorKeyword:[[{kind:"ANY",tags:v},{kind:"NONE",tags:[]}]]};s({key:["rules"],value:17===r?ee(a.rules,o):[(0,i.Z)({},o,{type:"SENIOR_KEYWORD"})]})}}else if(u.some((function(e){return e.some((function(e){return"ANY"===e.kind}))}))){n=v;var c=u.findIndex((function(e){return e.find((function(e){return"ANY"===e.kind}))})),p=u[c].findIndex((function(e){return"ANY"===e.kind}));u[c][p].tags=v;var h={seniorKeyword:u};s({key:["rules"],value:17===r?ee(a.rules,h):[(0,i.Z)({},h,{type:"SENIOR_KEYWORD"})]})}}else if(!f)if(u.some((function(e){return!e.some((function(e){return"ANY"===e.kind}))}))){E([]);s({key:["rules"],value:17===r?te(a.rules,[]):[(0,i.Z)({},{simpleKeyword:[]},{type:"SIMPLE_KEYWORD"}),{seniorKeyword:u}]})}else{var g,S=null==(g=u.find((function(e){return e.find((function(e){return"ANY"===e.kind}))})))?void 0:g.find((function(e){return"ANY"===e.kind})).tags;E(S);var N={simpleKeyword:S};s({key:["rules"],value:17===r?te(a.rules,S):[(0,i.Z)({},N,{type:"SIMPLE_KEYWORD"}),{seniorKeyword:u}]})}}},"\u5173\u952e\u8bcd"+(f?"\u9ad8\u7ea7":"\u7b80\u6613")+"\u6a21\u5f0f\u8bbe\u7f6e"),o.createElement(re,{kind:"ANY",visible:C,words:v,onCancel:function(){w(!1)},onOk:function(e){E(e),R(e),w(!1)}}))};n(59567);var ue=n(8799),ce=(n(15267),n(64713)),de=function(e){function t(t){var n;(n=e.call(this,t)||this).keywordsRef=void 0,n.onRadioChange=function(e){var t=n.props,r=t.formRule;(0,t.formRuleChange)({key:["condition"],value:(0,i.Z)({},r.condition,{satisfyType:e.target.value})})},n.onCheckboxChange=function(e,t){var r=n.props,i=r.formRule,a=r.formRuleChange,o=n.state.isSimple,l=e.target.checked,s="NPS"===t?0:1;if("KEYWORD"!==t)if(l){var u,c;if(i.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))i.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})).type=t;else i.rules.push({type:t,questionType:{type:t,min:(null==(u=i.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))?void 0:u.questionType.min)||s,max:(null==(c=i.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))?void 0:c.questionType.max)||2}});a({key:["rules"],value:i.rules})}else i.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t}))?i.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})).type=void 0:i.rules.filter((function(e){return e.type!==t})),a({key:["rules"],value:i.rules});else if(l)i.rules.some((function(e){return e.seniorKeyword}))||i.rules.some((function(e){return e.simpleKeyword}))?(i.rules.some((function(e){return e.seniorKeyword}))&&!o&&(i.rules.find((function(e){return e.seniorKeyword})).type="SENIOR_KEYWORD"),i.rules.some((function(e){return e.simpleKeyword}))&&o&&(i.rules.find((function(e){return e.simpleKeyword})).type="SIMPLE_KEYWORD")):i.rules.push({type:"SIMPLE_KEYWORD",simpleKeyword:[]}),a({key:["rules"],value:i.rules});else{var d=i.rules.filter((function(e){return"SIMPLE_KEYWORD"!==e.type&&"SENIOR_KEYWORD"!==e.type}));a({key:["rules"],value:i.rules.some((function(e){return e.seniorKeyword}))?[].concat(d,[{seniorKeyword:i.rules.find((function(e){return e.seniorKeyword})).seniorKeyword}]):i.rules.some((function(e){return e.simpleKeyword}))?[].concat(d,[{simpleKeyword:i.rules.find((function(e){return e.simpleKeyword})).simpleKeyword}]):d})}},n.onBlur=function(e,t,r){var i=n.props,a=i.formRule,o=i.formRuleChange,l=e.target.value,s="NPS"===t?0:1,u="NPS"===t?10:5;try{if(Number(l)===parseFloat(l)){var d=Number(l)>u?u:Number(l)<s?s:Number(l);if(l>u?c.default.error("\u5206\u503c\u4e0d\u80fd\u5927\u4e8e"+u):l<s&&c.default.error("\u5206\u503c\u4e0d\u80fd\u5c0f\u4e8e"+s),"max"===r){var p,f,m,h;if(a.rules.length&&a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))null!=(p=a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))&&null!=(f=p.questionType)&&f.min&&d<a.rules.find((function(e){return e.questionType&&e.questionType.type===t})).questionType.min&&(c.default.error("\u6700\u5927\u503c\u4e0d\u80fd\u5c0f\u4e8e\u6700\u5c0f\u503c"),a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})).questionType.min=d),a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})).questionType.max=d;else d<s&&c.default.error("\u6700\u5927\u503c\u4e0d\u80fd\u5c0f\u4e8e\u6700\u5c0f\u503c"),a.rules.push({questionType:{type:t,min:null!=(m=a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))&&null!=(h=m.questionType)&&h.min&&d<a.rules.find((function(e){return e.questionType&&e.questionType.type===t})).questionType.min||d<s?d:s,max:d}});o({key:["rules"],value:a.rules})}else if("min"===r){var v,E,g,y;if(a.rules.length&&a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))null!=(v=a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))&&null!=(E=v.questionType)&&E.max&&d>a.rules.find((function(e){return e.questionType&&e.questionType.type===t})).questionType.max&&(c.default.error("\u6700\u5c0f\u503c\u4e0d\u80fd\u5927\u4e8e\u6700\u5927\u503c"),a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})).questionType.max=d),a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})).questionType.min=d;else d>2&&c.default.error("\u6700\u5c0f\u503c\u4e0d\u80fd\u5927\u4e8e\u6700\u5927\u503c"),a.rules.push({questionType:{type:t,min:d,max:null!=(g=a.rules.find((function(e){var n;return(null==e||null==(n=e.questionType)?void 0:n.type)===t})))&&null!=(y=g.questionType)&&y.max&&d>a.rules.find((function(e){return e.questionType&&e.questionType.type===t})).questionType.max||d>2?d:2}});o({key:["rules"],value:a.rules})}}else c.default.error("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u683c\u5f0f")}catch(S){}};var r=t.formRule;return n.state={isSimple:!r.rules.length||!r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))},n}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.formRule,r=t.formRuleChange,i=t.questionList,a=t.questionnaireList,l=i.length?!(null!=i&&i.some((function(e){return e.questionnaireType.includes("NPS")}))):!a.some((function(e){return e.questionnaireType.includes("NPS")})),s=i.length?!(null!=i&&i.some((function(e){return e.questionnaireType.includes("SATISFACTION")}))):!a.some((function(e){return e.questionnaireType.includes("SATISFACTION")}));return o.createElement("div",{className:"research_alert_edit_wrap"},o.createElement("div",{className:"top_title"},"\u9884\u8b66\u6761\u4ef6",o.createElement("span",null,"\u5173\u952e\u8bcd\u4ec5\u5bf9NPS\u3001\u6ee1\u610f\u5ea6\u539f\u56e0\u9898\u3001\u5355\u884c\u6587\u672c\u3001\u591a\u884c\u6587\u672c\u9898\u578b\u8bbe\u7f6e\u9884\u8b66\u89c4\u5219")),o.createElement("div",{className:"choose_radio"},"\u6ee1\u8db3\u4ee5\u4e0b",o.createElement(ce.default.Group,{onChange:this.onRadioChange,value:n.condition.satisfyType||"ALL"},o.createElement(ce.default,{value:"ALL"},"\u5168\u90e8\u6761\u4ef6"),o.createElement(ce.default,{value:"ANY"},"\u4efb\u4e00\u6761\u4ef6"))),o.createElement("div",{className:"choose_checkbox"},o.createElement(T.default,{checked:n.rules.some((function(e){return"NPS"===e.type}))&&!l,onChange:function(t){return e.onCheckboxChange(t,"NPS")},disabled:l}),o.createElement("label",{className:"title"},"\u4efb\u4e00\u4e2aNPS\u5206\u503c\u9898\u7684\u5206\u6570\u5728"),o.createElement(ue.Z,{className:"min_input",controls:!1,value:n.rules.length&&n.rules.find((function(e){return e.questionType&&"NPS"===e.questionType.type}))?n.rules.find((function(e){return e.questionType&&"NPS"===e.questionType.type})).questionType.min:0,onBlur:function(t){return e.onBlur(t,"NPS","min")},disabled:l}),o.createElement("span",{className:"line"},"-"),o.createElement(ue.Z,{controls:!1,value:n.rules.length&&n.rules.find((function(e){return e.questionType&&"NPS"===e.questionType.type}))?n.rules.find((function(e){return e.questionType&&"NPS"===e.questionType.type})).questionType.max:2,onBlur:function(t){return e.onBlur(t,"NPS","max")},disabled:l})),o.createElement("div",{className:"choose_checkbox"},o.createElement(T.default,{checked:n.rules.some((function(e){return"SATISFACTION"===e.type}))&&!s,onChange:function(t){return e.onCheckboxChange(t,"SATISFACTION")},disabled:s}),o.createElement("label",{className:"title"},"\u4efb\u4e00\u4e2a\u6ee1\u610f\u5ea6\u5206\u503c\u9898\u7684\u5206\u6570\u5728"),o.createElement(ue.Z,{className:"min_input",controls:!1,value:n.rules.length&&n.rules.find((function(e){return e.questionType&&"SATISFACTION"===e.questionType.type}))?n.rules.find((function(e){return e.questionType&&"SATISFACTION"===e.questionType.type})).questionType.min:1,onBlur:function(t){return e.onBlur(t,"SATISFACTION","min")},disabled:s}),o.createElement("span",{className:"line"},"-"),o.createElement(ue.Z,{controls:!1,value:n.rules.length&&n.rules.find((function(e){return e.questionType&&"SATISFACTION"===e.questionType.type}))?n.rules.find((function(e){return e.questionType&&"SATISFACTION"===e.questionType.type})).questionType.max:2,onBlur:function(t){return e.onBlur(t,"SATISFACTION","max")},disabled:s})),o.createElement("div",{className:"keywords_checkbox"},o.createElement(T.default,{checked:n.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))||n.rules.some((function(e){return"SIMPLE_KEYWORD"===e.type})),onChange:function(t){return e.onCheckboxChange(t,"KEYWORD")}}),o.createElement(se,{source:17,formRule:n,onTypeChange:function(t){e.setState({isSimple:t})},ruleGroupList:n.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))?n.rules.find((function(e){return"SENIOR_KEYWORD"===e.type})).seniorKeyword:n.rules.find((function(e){return e.seniorKeyword}))?n.rules.find((function(e){return e.seniorKeyword})).seniorKeyword:[$],keywordType:!n.rules.length||!n.rules.some((function(e){return"SENIOR_KEYWORD"===e.type})),formRuleChange:r})))},t}(o.Component);const pe=de;var fe=n(23493),me=n.n(fe),he=n(45697),ve=n.n(he),Ee=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnSeachIconClick=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.setState({isSearching:!0})},n._handleOnSearchCloseClick=function(e){var t=n.props.onSearchClose;e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.setState({isSearching:!1},(function(){t&&t()}))},n.state={isSearching:!1},n}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.className,r=e.onSearchChange,i=(e.draggable,e.onFilterItemClose,e.defaultChecksNameChange,this.state.isSearching);return o.createElement("div",{className:"alert_edit_filter_label_wrapper "+n},o.createElement("div",{className:"label_view"},o.createElement("div",{className:"filter_normal"},i?o.createElement("div",{className:"search"},o.createElement(y.default,{className:"filter_search",onChange:r,size:"small",placeholder:"\u8bf7\u8f93\u5165",bordered:!1}),o.createElement("i",{className:"icon-cem_cancel",onClick:this._handleOnSearchCloseClick})):o.createElement("div",{className:"label"},o.createElement("span",{className:"hover_label"},t,"\uff1a"),o.createElement("i",{className:"icon-cem_small-search hover_item",onClick:this._handleOnSeachIconClick})))))},t}(o.PureComponent);const ge=Ee;function ye(e,t){var n=e?e.slice():[];return t.forEach((function(e,t){var r=n.findIndex((function(t){return t.id===e.id}));if(r>-1){var i=n.splice(r,1)[0];n.splice(t,0,i)}})),n}Ee.propTypes={label:ve().string,className:ve().string,onSearchChange:ve().func,onSearchClose:ve().func,draggable:ve().bool};const Se=function(e){function t(t){var n;return(n=e.call(this,t)||this).filterValues=void 0,n.timeout=void 0,n.handleOnAllChange=function(e){var t,r=e.target.checked,i=n.props,a=i.onChange,o=i.options,l=i.id,s=i.values,u=n.state.filterOptions;u?(t=r?s.slice().concat(u):s.filter((function(e){return!u.find((function(t){return t.id===e.id}))})),n.filterValues=r?u:[]):t=r?o:[],a&&a({id:l,valid:!0,values:t})},n.handleOnChange=function(e,t){var r=e.target.checked,i=n.props,a=i.values,o=i.onChange,l=i.id,s=a.slice();r?(s.push(t),n.filterValues&&n.filterValues.push(t)):(s=s.filter((function(e){return e.id!==t.id})),n.filterValues&&(n.filterValues=n.filterValues.filter((function(e){return e.id!==t.id})))),o&&o({id:l,values:s})},n.handleSearchChange=function(e){var t=e.target.value,r=n.props,a=(r.options,r.values),o=r.fetchQuestionnaireList;n.timeout&&clearTimeout(n.timeout),n.timeout=setTimeout((function(){clearInterval(n.timeout),o({name:t,pageIndex:1}).then((function(e){var t=e.map((function(e){return(0,i.Z)({},e,{label:e.title})}));n.filterValues=a.filter((function(e){return t.find((function(t){return t.id===e.id}))})),n.setState({filterOptions:t})}))}),500)},n.handleOnSearchClose=function(){n.filterValues=void 0,n.setState({filterOptions:void 0})},n.handleOnMoreShow=function(e){var t=n.state,r=t.filterOptions,i=t.mOptions;e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();var a=n.props.id,o=document.getElementById("more_"+a),l=document.getElementById("cbf_"+a);if(o&&l){var s=r||i;o.className.includes("show_more")?(o.classList.replace("show_more","show_less"),l.style.height="unset",s.length>20&&n.setState({count:100})):(o.classList.replace("show_less","show_more"),l.style.height="30px",s.length>20&&n.setState({count:20}))}},n.checkMoreVisable=function(){var e=n.props.id,t=document.getElementById("checkbotx_group_"+e),r=document.getElementById("more_"+e),i=document.getElementById("cbf_"+e);t&&r&&i&&(r.style.display=t.clientHeight>30?"inline-block":"none",i.style.height=r.classList.value.includes("show_more")?"30px":"unset")},n.handleOnFilterItemClose=function(e){var t=n.props,r=t.onFilterItemClose,i=t.id;e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),r&&r(i)},n.filterValues=void 0,n.timeout=null,n.state={options:t.options,filterOptions:void 0,mOptions:void 0,count:100},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this.props.id,n=document.getElementById("cbf_"+t);n&&n.addEventListener("mouseover",me()((function(){e.checkMoreVisable()}),8e3)),window.addEventListener("resize",this.checkMoreVisable),this.checkMoreVisable()},n.componentWillUnmount=function(){var e=this,t=this.props.id;window.removeEventListener("resize",this.checkMoreVisable);var n=document.getElementById("cbf_"+t);n&&n.removeEventListener("mouseover",me()((function(){e.checkMoreVisable()}),8e3))},t.getDerivedStateFromProps=function(e,t){var n=t.options,r=t.mOptions,i=e.options,a=e.values;return JSON.stringify(i)===JSON.stringify(n)&&r?null:{options:i,mOptions:ye(i,a)}},n.shouldComponentUpdate=function(e,t){var n=e.values,r=e.options,i=e.closeable,a=e.disable,o=e.loading,l=this.props,s=l.values,u=l.options,c=l.closeable,d=l.disable,p=l.loading;return JSON.stringify(t)!==JSON.stringify(this.state)||JSON.stringify(n)!==JSON.stringify(s)||JSON.stringify(u)!==JSON.stringify(r)||a!==d||i!==c||o!==p},n.componentDidUpdate=function(e,t){var n=e.options,r=this.props,i=r.options,a=r.id,o=t.filterOptions,l=this.state.filterOptions;if(JSON.stringify(n)!==JSON.stringify(i)&&this.checkMoreVisable(),JSON.stringify(o)!==JSON.stringify(l))if(o&&!l)this.checkMoreVisable();else{var s=document.getElementById("cbf_"+a),u=document.getElementById("more_"+a);s&&u&&(s.style.height="unset",u.style.display="none")}},n.render=function(){var e=this,t=this.props,n=t.className,r=t.label,i=(t.closeable,t.limit),a=t.values,l=t.id,u=t.disable,c=t.loading,d=this.state,p=d.filterOptions,f=d.mOptions,m=d.count,h=p||f,v=this.filterValues||a,E=v.length===h.length,g=!E&&v.length>0,y=i||[0,1e3],S=y[0],N=y[1];return o.createElement("div",{className:"questionaire_alert_edit_wrap"},o.createElement(s.default,{spinning:c,style:{minHeight:"100%"}},o.createElement("div",{id:"cbf_"+l,className:"alert_edit_checkbox_filter_wrapper "+n,style:{height:30}},o.createElement(ge,{label:r,className:"filter_label",draggable:"draggable"===n,allCheckable:h.length<N,onSearchChange:this.handleSearchChange,onSearchClose:this.handleOnSearchClose,onFilterItemClose:this.handleOnFilterItemClose}),o.createElement("div",{className:"filter_list"},o.createElement("div",{className:"filter_control"},o.createElement("span",{style:{display:"none"},id:"more_"+l,className:"show_more hover_item",onClick:this.handleOnMoreShow})),0===h.length?o.createElement("div",{className:"filter_empty"}):o.createElement("div",{className:"filter_content"},o.createElement(T.default,{className:"all",checked:E,indeterminate:g,disabled:u||i,onChange:this.handleOnAllChange},"\u5168\u9009"),o.createElement("div",{id:"checkbotx_group_"+l},h.slice(0,m).map((function(t){return o.createElement(T.default,{key:t.id,label:t.id,checked:v.some((function(e){return e.id===t.id})),disabled:u||!a.some((function(e){return e.id===t.id}))&&a.length===N||a.some((function(e){return e.id===t.id}))&&a.length===S,onChange:function(n){return e.handleOnChange(n,t)}},t.label)})),h.length>100&&o.createElement("span",{className:"hide_hint"},"\u2014 \u8be5\u6570\u503c\u5c55\u793a\u4e0d\u4f1a\u8d85\u8fc7100\u6761,\u9700\u8981\u67e5\u770b\u66f4\u591a\u8bf7\u641c\u7d22")))))))},t}(o.Component);var Ne=[{label:"\u6307\u6807\u9884\u8b66",value:"PROJECT_ASPECT"},{label:"\u5173\u952e\u8bcd\u9884\u8b66",value:"KEYWORDS"}],_e=[{label:"\u9ad8",value:"HIGH"},{label:"\u4e2d",value:"MIDDLE"},{label:"\u4f4e",value:"LOW"}],Ce={17:"WARNING_NPS",8:"WARNING_SERVICE",21:"WARNING_APP_COMMENT_KEYWORD",22:"WARNING_ZENDESK_KEYWORD",1:"WARNING_COMMENT_KEYWORD",12:"WARNING_SELF_KEYWORD"};const we=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={redIndex:[]},n}return(0,a.Z)(t,e),t.prototype.render=function(){var e,t,n,r,a,l,s=this,u=this.props,c=u.warningTypes,d=u.getFormRef,p=u.questionnaireList,h=u.questionnaireLoading,v=u.fetchQuestionnaireList,E=u.source,y=u.formRule,S=u.formRuleChange,N=u.curScreeningMap,_=u.currentStep,C=u.headerFilterParamsNew,w=u.onScreenValuesChange,T=null==c||null==(e=c.find((function(e){return e.value===E})))?void 0:e.hasAspect,O="KEYWORDS"===y.type&&(null==c||null==(t=c.find((function(e){return e.value===E})))?void 0:t.hasKeyword)||!(null!=c&&null!=(n=c.find((function(e){return e.value===E})))&&n.hasAspect);return o.createElement(f.Z.StepForm,{formRef:d,name:"step2",layout:"horizontal",className:"alert_edit_steps2_form",initialValues:{type:y.type||"PROJECT_ASPECT",level:y.level,calType:y.condition.calType||"PERCENT",dateRangeType:y.condition.dateRangeType||"LAST_SENVEN_DAYS",min:y.condition.min||100},onValuesChange:function(e){var t=e.type,n=e.level,r=e.calType,a=e.dateRangeType;t?S({key:["type"],value:t}):n?S({key:["level"],value:n}):r?(s.setState({redIndex:[]}),S({key:["condition","calType"],value:(0,i.Z)({},y.condition,{calType:r})})):a&&S({key:["condition","dateRangeType"],value:(0,i.Z)({},y.condition,{dateRangeType:a})})}},T&&(null==c||null==(r=c.find((function(e){return e.value===E})))?void 0:r.hasKeyword)&&o.createElement(m.Z.Group,{name:"type",label:"\u9884\u8b66\u7c7b\u578b",options:Ne}),o.createElement(m.Z.Group,{name:"level",label:"\u7d27\u6025\u7a0b\u5ea6",options:_e}),T&&"KEYWORDS"!==y.type&&1===_?o.createElement(B,{source:E,redIndex:this.state.redIndex,formRule:y,analysisChange:function(e){},questionnaireList:p,fetchQuestionnaireList:v,formRuleChange:S,calTypeChange:function(e){},curScreeningMap:N,onScreenValuesChange:function(e){w("aspect",e)},headerFilterParamsNew:C}):null,O&&17===E&&o.createElement(Se,{id:"questionnaireList",label:"\u95ee\u5377\u8c03\u7814",loading:h,options:p.map((function(e){return{id:e.id,label:e.title,questionnaireType:e.questionnaireType}})),values:y.questionnaireList||[],fetchQuestionnaireList:v,onChange:function(e){S({key:["questionnaireList"],value:e.values.map((function(e){return{id:e.id,name:e.label,questionnaireType:e.questionnaireType}}))})}}),O&&1===_&&o.createElement(W,{screenValue:null!=(a=y.headerFilterParamsNew)&&a.find((function(e){return"PRODUCT_INFO"===e.id||"DEFAULT"===e.id}))?(0,g.SR)(y.headerFilterParamsNew,N):y.headerFilterParamsNew,onScreenValuesChange:function(e){w("noAspect",e)},pageType:Ce[E]||""}),O&&17===E&&o.createElement(pe,{questionnaireList:p,questionList:y.questionnaireList||[],formRule:y,formRuleChange:S}),O&&17!==E&&o.createElement(se,{source:E,formRule:y,ruleGroupList:y.rules.length&&(null==(l=y.rules.find((function(e){var t;return null==e||null==(t=e.seniorKeyword)?void 0:t.length})))?void 0:l.seniorKeyword)||[[{kind:"ANY",tags:[]},{kind:"NONE",tags:[]}]],keywordType:!y.rules.length||!y.rules.some((function(e){return"SENIOR_KEYWORD"===e.type})),formRuleChange:S}))},t}(o.PureComponent);var Te=n(19412),Oe=n(63434),Re=[{label:"\u5fae\u4fe1\u901a\u77e5",value:"WEIXIN"},{label:"\u9489\u9489\u7fa4\u901a\u77e5",value:"DINGDING_CHAT"},{label:"\u98de\u4e66\u7fa4\u901a\u77e5",value:"FEISHU_CHAT"},{label:"\u90ae\u4ef6\u901a\u77e5",value:"EMAIL"}],ke=[{label:"\u6bcf30\u5206\u949f",value:18e5},{label:"\u6bcf\u5c0f\u65f6",value:36e5},{label:"\u6bcf\u4e09\u5c0f\u65f6",value:108e5}];const Ie=function(e){function t(t){var n;return(n=e.call(this,t)||this).onPushWayChange=function(e,t){var r,a,o=e.target.checked,l=(0,E.ZP)((null==(r=n.props.formRule)||null==(a=r.condition)?void 0:a.pushWay)||[],(function(e){if(!o)return e.filter((function(e){return e!==t}));e.push(t)}));n.props.formRuleChange({key:["condition"],value:(0,i.Z)({},n.props.formRule.condition,{pushWay:l})})},n.onWebhookChange=function(e,t){var r=n.props,a=r.formRule;(0,r.formRuleChange)({key:["condition"],value:(0,i.Z)({},a.condition,{webHookModels:a.condition&&a.condition.webHookModels?[].concat(a.condition.webHookModels.filter((function(e){return e.type!==t})),e.map((function(e){return{type:t,webhookId:e}}))):e.map((function(e){return{type:t,webhookId:e}}))})})},n.state={},n}return(0,a.Z)(t,e),t.prototype.render=function(){var e,t=this,n=this.props,r=n.getFormRef,a=n.categoryId,l=n.formPush,s=n.teamList,u=n.userList,c=n.webhookList,d=n.formPushChange,p=n.formRule,h=n.formRuleChange,v=n.fetchWebhookList,E=n.warningTypes,y=!(!p.condition||!p.condition.pushWay)&&(p.condition.pushWay.includes("DINGDING_CHAT")||p.condition.pushWay.includes("FEISHU_CHAT")),_=null==E||null==(e=E.find((function(e){return e.value===a})))?void 0:e.hasAspect;return o.createElement(f.Z.StepForm,{formRef:r,name:"step3",layout:"horizontal",className:"alert_edit_steps3_form",initialValues:{receiverTeamIdList:l.receiverTeamIdList,receiverUserIdList:l.receiverUserIdList,pushWay:p.condition&&p.condition.pushWay||[],combined:!p.condition||void 0===p.condition.combined||p.condition.combined,repeatType:!p.condition||!p.condition.repeatType||"ENABLE"===p.condition.repeatType,interval:l.interval,workType:p.condition&&p.condition.workType||"weekday"},onValuesChange:function(e){!function(e,t,n,r){Object.keys(e).forEach((function(a){var o;if("pushWay"===a||"combined"===a||"workType"===a)n({key:["condition"],value:(0,i.Z)({},t.condition,(o={},o[a]=e[a],o))});else if("repeatType"===a){var l;n({key:["condition"],value:(0,i.Z)({},t.condition,(l={},l[a]=e[a]?"ENABLE":"DISABLE",l))})}else e[a]&&r({key:a,value:e[a]})}))}(e,p,h,d)}},o.createElement("div",{className:"push_member"},o.createElement("div",null,o.createElement("span",null,"\u63a8\u9001\u7528\u6237\u7ec4:"),o.createElement(N.default,{style:{width:320},mode:"multiple",optionFilterProp:"label",options:s.map((function(e){return{label:e.name,value:e.id}})),placeholder:"\u8bf7\u9009\u62e9",allowClear:!1,showArrow:!0,suffixIcon:o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c",cursor:"pointer"}}),value:l.receiverTeamIdList&&l.receiverTeamIdList.length?l.receiverTeamIdList:void 0,onChange:function(e){return d({key:"receiverTeamIdList",value:e})}})),o.createElement("div",null,o.createElement("span",null,"\u63a8\u9001\u6210\u5458:"),o.createElement(N.default,{style:{width:320},mode:"multiple",optionFilterProp:"label",options:u.map((function(e){return{label:e.username,value:e.id}})),placeholder:"\u8bf7\u9009\u62e9",allowClear:!1,showArrow:!0,suffixIcon:o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c"}}),value:l.receiverUserIdList&&l.receiverUserIdList.length?l.receiverUserIdList:void 0,onChange:function(e){return d({key:"receiverUserIdList",value:e})}}))),o.createElement("div",{className:"push_way"},o.createElement("span",null,"\u63a8\u9001\u65b9\u5f0f:"),Re.map((function(e){var n,r;return o.createElement(T.default,{checked:null==(n=p.condition)||null==(r=n.pushWay)?void 0:r.includes(e.value),key:e.value,onChange:function(n){return t.onPushWayChange(n,e.value)}},o.createElement("span",null,e.label,"WEIXIN"===e.value&&o.createElement(S.default,{content:o.createElement("div",{style:{maxWidth:200,fontSize:12}},"\u7cfb\u7edf\u9ed8\u8ba4\u7ed9\u7ed1\u5b9a\u4e86\u5fae\u4fe1\u7684\u7528\u6237\u63a8\u9001\u5fae\u4fe1\u901a\u77e5\u3002\u5982\u672a\u7ed1\u5b9a\uff0c\u53ef\u524d\u5f80\u201c\u4e2a\u4eba\u4e2d\u5fc3/\u4e2a\u4eba\u8d44\u6599\u201d\u9875\u9762\u626b\u7801\u7ed1\u5b9a\u5fae\u4fe1\u3002",o.createElement("br",null),o.createElement("a",{href:"/personalSettings/overview",target:"_black",style:{color:"#1890FF"}},"\u7acb\u5373\u524d\u5f80"))},o.createElement("i",{className:"icon-cem_file1",style:{fontSize:14,color:"#979797",marginLeft:4}}))))}))),p.condition&&p.condition.pushWay&&o.createElement(o.Fragment,null,y&&o.createElement("div",{className:"notice"},o.createElement("span",null,"\u7fa4\u901a\u77e5"),o.createElement("a",{href:"/account/project/webhookList",target:"_blank"},"\u914d\u7f6eWebhook\u540e\uff0c\u624d\u80fd\u4f7f\u7528\u7fa4\u901a\u77e5>")),p.condition.pushWay.includes("DINGDING_CHAT")&&o.createElement("div",{className:"push_way_chats"},o.createElement("span",null,"\u9489\u9489\u7fa4Webhook"),o.createElement(N.default,{style:{width:400},mode:"multiple",showArrow:!0,options:c.filter((function(e){return"DINGDING"===e.type&&"ENABLE"===e.status})).map((function(e){return{label:e.name,value:e.id}})),placeholder:"\u8bf7\u9009\u62e9Webhook\u5730\u5740",allowClear:!1,suffixIcon:o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c"}}),onChange:function(e){return t.onWebhookChange(e,"DINGDING")},onFocus:function(){v()},value:p.condition.webHookModels&&p.condition.webHookModels.some((function(e){return"DINGDING"===e.type}))?p.condition.webHookModels.filter((function(e){return"DINGDING"===e.type})).map((function(e){return e.webhookId})):void 0})),p.condition.pushWay.includes("FEISHU_CHAT")&&o.createElement("div",{className:"push_way_chats"},o.createElement("span",null,"\u98de\u4e66\u7fa4Webhook"),o.createElement(N.default,{style:{width:400},mode:"multiple",showArrow:!0,options:c.filter((function(e){return"FEISHU"===e.type&&"ENABLE"===e.status})).map((function(e){return{label:e.name,value:e.id}})),placeholder:"\u8bf7\u9009\u62e9Webhook\u5730\u5740",allowClear:!1,suffixIcon:o.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{fontSize:"16px",color:"#8c8c8c"}}),onChange:function(e){return t.onWebhookChange(e,"FEISHU")},onFocus:function(){v()},value:p.condition.webHookModels&&p.condition.webHookModels.some((function(e){return"FEISHU"===e.type}))?p.condition.webHookModels.filter((function(e){return"FEISHU"===e.type})).map((function(e){return e.webhookId})):void 0}))),y&&o.createElement("div",{className:"line"}),(0,g.KZ)(a,p,E)&&o.createElement(m.Z.Group,{name:"combined",label:"\u5408\u5e76\u63a8\u9001",options:[{label:"\u662f",value:!0},{label:"\u5426",value:!1}]}),o.createElement(Te.Z,{name:"interval",label:"\u9884\u8b66\u95f4\u9694",options:ke,placeholder:"\u8bf7\u9009\u62e9",allowClear:!1}),o.createElement("div",{className:"workType"},o.createElement(m.Z.Group,{name:"workType",label:o.createElement("span",{className:"workType_radio"},"\u514d\u6253\u6270",o.createElement(S.default,{content:o.createElement("div",{style:{maxWidth:200,fontSize:12}},"\u5de5\u4f5c\u65f6\u95f4\uff1a\u53ea\u4f1a\u5728\u5468\u4e00\u81f3\u5468\u4e94\u7684\u65e9\u4e0a8\uff1a00~\u665a\u4e0a10\uff1a00\u63a8\u9001\u9884\u8b66\u901a\u77e5\u3002\u5728\u514d\u6253\u6270\u671f\u95f4\u89e6\u53d1\u7684\u9884\u8b66\u901a\u77e5\u4f1a\u5728\u65e9\u4e0a8\uff1a00\u7684\u65f6\u5019\u96c6\u4e2d\u63a8\u9001\u3002",o.createElement("br",null),"\u5168\u5929\u5019\uff1a7*24\u5c0f\u65f6\u90fd\u4f1a\u6536\u5230\u9884\u8b66\u901a\u77e5\u3002")},o.createElement("i",{className:"icon-cem_file1"}))),options:[{label:"\u5de5\u4f5c\u65f6\u95f4",value:"weekday"},{label:"\u5168\u5929\u5019",value:"all"}]})),_&&"KEYWORDS"!==p.type&&o.createElement(Oe.Z,{name:"repeatType",label:"\u91cd\u590d\u63d0\u9192"},"\u5355\u4e2a\u76d1\u6d4b\u6307\u6807\u89e6\u53d1\u9884\u8b66\u540e\u5f53\u5929\u4e0d\u518d\u91cd\u590d\u63a8\u9001"))},t}(o.Component);var Ae=n(5966),be=n(90672),Pe=null;const Le=function(e){var t=e.title,n=e.description,r=e.ruleNameCheck,i=e.save,a=e.getFormRef,l=C()((function(e,t){r({title:e}).then((function(e){e?t():t("\u6b64\u89c4\u5219\u540d\u79f0\u5df2\u88ab\u4f7f\u7528\uff0c\u8bf7\u5c1d\u8bd5\u5176\u4ed6\u89c4\u5219\u540d\u79f0")}))}),500);return o.createElement(f.Z.StepForm,{formRef:a,name:"step4",layout:"horizontal",className:"alert_edit_steps4_form",initialValues:{title:t,description:n},onValuesChange:function(e){Pe&&clearTimeout(Pe),Pe=setTimeout((function(){i(e)}),500)}},o.createElement(Ae.Z,{allowClear:!0,name:"title",label:"\u9884\u8b66\u89c4\u5219\u540d\u79f0",width:"md",placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u89c4\u5219\u540d\u79f0(\u4e0d\u8d85\u8fc720\u4e2a\u5b57\uff09",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89c4\u5219\u540d\u79f0"},{whitespace:!0,message:"\u8bf7\u8f93\u5165\u89c4\u5219\u540d\u79f0"},{validator:function(e,t,n){l(t,n)}},{type:"string",max:20,message:"\u89c4\u5219\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u5b57"}]}),o.createElement(be.Z,{allowClear:!0,name:"description",label:"\u9884\u8b66\u89c4\u5219\u8bf4\u660e",placeholder:"\u8bf7\u8f93\u5165\u9884\u8b66\u8bf4\u660e\u5185\u5bb9(\u4e0d\u8d85\u8fc750\u4e2a\u5b57\uff09",rules:[{type:"string",max:50,message:"\u89c4\u5219\u8bf4\u660e\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57"}]}))};var De=d.Z.Step;const Fe=function(e){function t(t){var n;(n=e.call(this,t)||this).check=function(e){var t=n.props,r=t.formRule,i=t.formPush,a=t.categoryId,o=t.title,l=t.test,s=t.description,u="",d=t.warningTypes.find((function(e){return e.value===a}));if(1===e)if(d.hasAspect)if("KEYWORDS"!==r.type){22!==a&&(0,g.xn)(r,{21:"PRODUCT_INFO",17:"QUESTIONNAIRE_RELATED",12:"BRAND_SERIES"}[a]||"TOPIC")?u="\u8bf7\u9009\u62e9\u9884\u8b66\u5bf9\u8c61":r.ruleDetail.length?"PERCENT"!==r.condition.calType||r.condition.min&&r.condition.min>=10?r.ruleDetail.some((function(e){return!e.value||!String(e.value).trim()}))&&(u="\u8bf7\u4e3a\u6bcf\u4e00\u4e2a\u6307\u6807\u8f93\u5165\u9884\u8b66\u9600\u503c"):u="\u8bf7\u586b\u5199\u8d1f\u9762\u58f0\u91cf\u6700\u5c0f\u503c\uff0c\u4e14\u8be5\u503c\u6700\u5c0f\u4e3a10":u="\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u9879\u76d1\u6d4b\u6307\u6807"}else 17===a?r.rules.some((function(e){return"SIMPLE_KEYWORD"===e.type}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))||r.rules.some((function(e){return"NPS"===e.type}))||r.rules.some((function(e){return"SATISFACTION"===e.type}))||(u="\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u9884\u8b66\u6761\u4ef6"):r.rules.some((function(e){return"SIMPLE_KEYWORD"===e.type}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))||(u="\u8bf7\u8f93\u5165\u9884\u8b66\u5173\u952e\u8bcd"),r.rules.some((function(e){return"SIMPLE_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.simpleKeyword)?void 0:t.length}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.seniorKeyword)?void 0:t.length}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.seniorKeyword)?void 0:t.some((function(e){return e.some((function(e){var t;return null==e||null==(t=e.tags)?void 0:t.length}))}))}))?u="\u8bf7\u8f93\u5165\u9884\u8b66\u5173\u952e\u8bcd":r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.seniorKeyword)?void 0:t.map((function(e){return null==e?void 0:e.filter((function(e){var t;return null==e||null==(t=e.tags)?void 0:t.length}))})).filter((function(e){return(null==e?void 0:e.length)>1})).length}))&&(u="\u81f3\u5c11\u8f93\u5165\u4e00\u7ec4\u5305\u542b\u4e24\u4e2a\u6761\u4ef6\u7684\u9884\u8b66\u5173\u952e\u8bcd");else d.hasKeyword&&(17===a?r.rules.some((function(e){return"SIMPLE_KEYWORD"===e.type}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))||r.rules.some((function(e){return"NPS"===e.type}))||r.rules.some((function(e){return"SATISFACTION"===e.type}))||(u="\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u9884\u8b66\u6761\u4ef6"):8===a&&(r.rules.some((function(e){return"SIMPLE_KEYWORD"===e.type}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))||(u="\u8bf7\u8f93\u5165\u9884\u8b66\u5173\u952e\u8bcd")),r.rules.some((function(e){return"SIMPLE_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.simpleKeyword)?void 0:t.length}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.seniorKeyword)?void 0:t.length}))||r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.seniorKeyword)?void 0:t.some((function(e){return e.some((function(e){var t;return null==e||null==(t=e.tags)?void 0:t.length}))}))}))?u="\u8bf7\u8f93\u5165\u9884\u8b66\u5173\u952e\u8bcd":r.rules.some((function(e){return"SENIOR_KEYWORD"===e.type}))&&!r.rules.some((function(e){var t;return null==(t=e.seniorKeyword)?void 0:t.map((function(e){return null==e?void 0:e.filter((function(e){var t;return null==e||null==(t=e.tags)?void 0:t.length}))})).filter((function(e){return(null==e?void 0:e.length)>1})).length}))&&(u="\u81f3\u5c11\u8f93\u5165\u4e00\u7ec4\u5305\u542b\u4e24\u4e2a\u6761\u4ef6\u7684\u9884\u8b66\u5173\u952e\u8bcd"));else 2===e?i.receiverTeamIdList.length||i.receiverUserIdList.length?r.condition.pushWay&&r.condition.pushWay.length?!r.condition.pushWay||!r.condition.pushWay.includes("DINGDING_CHAT")||r.condition.webHookModels&&r.condition.webHookModels.filter((function(e){return"DINGDING"===e.type})).length?!r.condition.pushWay||!r.condition.pushWay.includes("FEISHU_CHAT")||r.condition.webHookModels&&r.condition.webHookModels.filter((function(e){return"FEISHU"===e.type})).length||(u="\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u98de\u4e66\u7fa4Webhook"):u="\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u9489\u9489\u7fa4Webhook":u="\u81f3\u5c11\u9009\u4e00\u4e2a\u63a8\u9001\u65b9\u5f0f":u="\u81f3\u5c11\u9009\u4e00\u4e2a\u63a8\u9001\u56e2\u961f\u6216\u7528\u6237":3===e&&(!o||o&&""===o.trim()?u="\u8bf7\u8f93\u5165\u9884\u8b66\u89c4\u5219\u540d\u79f0":o&&!l?u="\u6b64\u89c4\u5219\u540d\u79f0\u5df2\u88ab\u4f7f\u7528\uff0c\u8bf7\u5c1d\u8bd5\u5176\u4ed6\u89c4\u5219\u540d\u79f0":o.trim().length>20?u="\u89c4\u5219\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u5b57":s.trim().length>50&&(u="\u89c4\u5219\u8bf4\u660e\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57"));return!u||(c.default.error(u),!1)},n.submit=function(){var e=n.props,t=e.location,r=e.warningTypes;t.state&&t.state.id&&!t.state.copy?n.props.update({id:t.state.id,warningTypes:r}).then((function(e){e&&2e4===e.data.code&&(c.default.success("\u64cd\u4f5c\u6210\u529f"),v.mW.push("/account/project/warning/overview"))})):n.props.submit({warningTypes:r}).then((function(e){e&&2e4===e.data.code&&(c.default.success("\u64cd\u4f5c\u6210\u529f"),v.mW.push("/account/project/warning/overview"))}))},n.onRadioChange=function(e){n.props.save({categoryId:e})},n.onPreStep=function(e){var t=n.state,r=t.currentStep,i=t.hasChange,a=n.props,o=a.formRule,l=o.type,s=o.headerFilterParamsNew,u=a.categoryId,c=a.warningTypes,d=a.curScreeningMap,p=c.find((function(e){return e.value===u}));if(0===e)history.back();else if(n.setState({currentStep:r-1}),1===e){var f,m,h,v,y="KEYWORDS"===l||1!==u?null==(f=n.state.headerFilterParamsNew)?void 0:f.find((function(e){return"TOPIC"===e.id})):(0,g.AT)(s,n.state.headerFilterParamsNew,"TOPIC",i),S=21===u?"PRODUCT_INFO":12===u?"BRAND_SERIES":"QUESTIONNAIRE_RELATED",N=(21===u||17===u||12===u)&&(0,g.AT)(s,n.state.headerFilterParamsNew,S,i),_={id:"ASPECT_MODEL",values:i?[].concat((null==(m=s.find((function(e){return"ASPECT_MODEL"===e.id})))?void 0:m.values.filter((function(e){return"ASPECT1"===e.id||"ASPECT2"===e.id})))||[],(null==(h=n.state.headerFilterParamsNew.find((function(e){return"ASPECT_MODEL"===e.id})))?void 0:h.values.filter((function(e){return"ASPECT1"!==e.id&&"ASPECT2"!==e.id})))||[]):null==(v=s.find((function(e){return"ASPECT_MODEL"===e.id})))?void 0:v.values},C=!p.hasAspect||21!==u&&17!==u?Array.from(new Set([].concat(i?[]:s.filter((function(e){return"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),n.state.headerFilterParamsNew.filter((function(e){return"TOPIC"!==e.id&&"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),[_,y]).filter((function(e){return e})))):[].concat(i?[]:s.filter((function(e){return e.id!==S&&"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),n.state.headerFilterParamsNew.filter((function(e){return e.id!==S&&"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),[N,s.find((function(e){return"ASPECT_MODEL"===e.id}))]).filter((function(e){return e}));n.props.formRuleChange({key:["headerFilterParamsNew"],value:(0,E.ZP)(C,(function(e){var t,n,r,i,a;e.find((function(e){return"PRODUCT_INFO"===e.id}))&&(e.find((function(e){return"PRODUCT_INFO"===e.id})).values=(null==(r=(0,g.SR)(e,d))?void 0:r.find((function(e){return"PRODUCT_INFO"===e.id})).values)||[]);e.find((function(e){return"DEFAULT"===e.id}))&&null!=(t=(0,g.SR)(e,d))&&t.find((function(e){return"DEFAULT"===e.id}))&&(e.find((function(e){return"DEFAULT"===e.id})).values=(null==(i=(0,g.SR)(e,d))?void 0:i.find((function(e){return"DEFAULT"===e.id})).values)||[]);e.find((function(e){return"BRAND_SERIES"===e.id}))&&null!=(n=(0,g.SR)(e,d))&&n.find((function(e){return"BRAND_SERIES"===e.id}))&&(e.find((function(e){return"BRAND_SERIES"===e.id})).values=(null==(a=(0,g.SR)(e,d))?void 0:a.find((function(e){return"BRAND_SERIES"===e.id})).values)||[])})).filter((function(e){var t;return(null==(t=e.values)?void 0:t.length)>0}))})}},n.onNextStep=function(e){var t=n.state,r=t.currentStep,i=t.hasChange,a=n.props,o=a.submitLoading,l=a.updateLoading,s=a.curScreeningMap,u=a.formRule,c=u.type,d=u.headerFilterParamsNew,p=a.categoryId,f=a.warningTypes.find((function(e){return e.value===p}));if(3===e)!n.check(e)||o||l||n.submit();else if(0===e)n.setState({currentStep:r+1});else if(n.check(e)){if(1===e){var m,h,v,y,S="KEYWORDS"===c||1!==p?null==(m=n.state.headerFilterParamsNew)?void 0:m.find((function(e){return"TOPIC"===e.id})):(0,g.AT)(d,n.state.headerFilterParamsNew,"TOPIC",i),N=21===p?"PRODUCT_INFO":12===p?"BRAND_SERIES":"QUESTIONNAIRE_RELATED",_=(21===p||17===p||12===p)&&(0,g.AT)(d,n.state.headerFilterParamsNew,N,i),C={id:"ASPECT_MODEL",values:i?[].concat((null==(h=d.find((function(e){return"ASPECT_MODEL"===e.id})))?void 0:h.values.filter((function(e){return"ASPECT1"===e.id||"ASPECT2"===e.id})))||[],(null==(v=n.state.headerFilterParamsNew.find((function(e){return"ASPECT_MODEL"===e.id})))?void 0:v.values.filter((function(e){return"ASPECT1"!==e.id&&"ASPECT2"!==e.id})))||[]):null==(y=d.find((function(e){return"ASPECT_MODEL"===e.id})))?void 0:y.values},w=!f.hasAspect||21!==p&&17!==p&&12!==p?Array.from(new Set([].concat(i?[]:d.filter((function(e){return"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),n.state.headerFilterParamsNew.filter((function(e){return"TOPIC"!==e.id&&"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),[C,S]).filter((function(e){return e})))):[].concat(i?[]:d.filter((function(e){return e.id!==N&&"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),n.state.headerFilterParamsNew.filter((function(e){return e.id!==N&&"ASPECT_MODEL"!==e.id&&n.props.curScreeningMap.some((function(t){return t.id===e.id}))})),[C,_]).filter((function(e){return e}));n.props.formRuleChange({key:["headerFilterParamsNew"],value:(0,E.ZP)(w,(function(e){var t,n,r,i,a,o;e.find((function(e){return"PRODUCT_INFO"===e.id}))&&null!=(t=(0,g.SR)(e,s))&&t.find((function(e){return"PRODUCT_INFO"===e.id}))&&(e.find((function(e){return"PRODUCT_INFO"===e.id})).values=(null==(i=(0,g.SR)(e,s))?void 0:i.find((function(e){return"PRODUCT_INFO"===e.id})).values)||[]);e.find((function(e){return"DEFAULT"===e.id}))&&null!=(n=(0,g.SR)(e,s))&&n.find((function(e){return"DEFAULT"===e.id}))&&(e.find((function(e){return"DEFAULT"===e.id})).values=(null==(a=(0,g.SR)(e,s))?void 0:a.find((function(e){return"DEFAULT"===e.id})).values)||[]);e.find((function(e){return"BRAND_SERIES"===e.id}))&&null!=(r=(0,g.SR)(e,s))&&r.find((function(e){return"BRAND_SERIES"===e.id}))&&(e.find((function(e){return"BRAND_SERIES"===e.id})).values=(null==(o=(0,g.SR)(e,s))?void 0:o.find((function(e){return"BRAND_SERIES"===e.id})).values)||[])})).filter((function(e){var t;return(null==(t=e.values)?void 0:t.length)>0}))})}n.setState({currentStep:r+1})}};var r=t.location;return n.state={headerFilterParamsNew:[],hasChange:!1,currentStep:r.state&&r.state.id&&!r.state.copy?1:0},n}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.categoryId,r=t.title,i=t.description,a=t.curScreeningMap,l=t.loading,c=t.location,v=t.formRule,E=t.formRuleChange,y=t.teamList,S=t.userList,N=t.webhookList,_=t.questionnaireList,C=t.questionnaireLoading,w=t.fetchQuestionnaireList,T=t.fetchWebhookList,O=t.formPush,R=t.formPushChange,k=t.ruleNameCheck,I=t.save,A=t.getFormRef1,b=t.getFormRef2,P=t.getFormRef3,L=t.getFormRef4,D=t.warningTypes,F=t.submitLoading,W=t.updateLoading,M=this.state,K=M.currentStep,x=M.headerFilterParamsNew;return o.createElement("div",{className:"warning_edit_page_view"},o.createElement(h.Z,{title:(0,g.uT)({title:c.state&&c.state.id&&!c.state.copy?c.state.title:"\u65b0\u5efa\u9884\u8b66"})}),o.createElement("div",{className:"rule_wrap"},o.createElement(s.default,{spinning:l,style:{minHeight:"100%"}},o.createElement(p.ZP,{style:{height:"100%"},className:1===K?"steps_form_container":2===K?"steps_form_container steps_form3_container":""},o.createElement(f.Z,{current:K,onFinish:function(e){return Promise.resolve(!0)},stepsRender:function(e,t){var n=t.props.children;return o.createElement(d.Z,{current:n.props.current,labelPlacement:"vertical"},e.map((function(e,t){return o.createElement(De,{key:e.key,title:0===t?"\u9009\u62e9\u6570\u636e\u7c7b\u578b":1===t?"\u9884\u8b66\u89c4\u5219\u8bbe\u7f6e":2===t?"\u63a8\u9001\u89c4\u5219\u8bbe\u7f6e":"\u9884\u8b66\u540d\u79f0\u8bbe\u7f6e",icon:3!==t?o.createElement("span",{className:"ant-steps-icon-add ant-steps-icon-"+(t+1)},t+1):""})})))},submitter:{render:function(t){return[o.createElement(u.default,{key:"gotoCancle",onClick:function(){return e.onPreStep(t.step)}},0===t.step?"\u53d6\u6d88":"\u4e0a\u4e00\u6b65"),o.createElement(u.default,{key:"gotoNext",type:"primary",onClick:function(){return e.onNextStep(t.step)},loading:3===t.step&&(c.state&&c.state.id&&!c.state.copy?W:F)},3===t.step?"\u786e\u5b9a":"\u4e0b\u4e00\u6b65")]}}},o.createElement(f.Z.StepForm,{name:"step1",layout:"horizontal",onValuesChange:function(t,n){var r=n.categoryId;r&&e.onRadioChange(r)},formRef:A,initialValues:{categoryId:n}},o.createElement(m.Z.Group,{name:"categoryId",label:"\u6570\u636e\u7c7b\u578b",options:D.filter((function(e){return e.hasAspect||e.hasKeyword}))})),o.createElement(we,{warningTypes:D,currentStep:K,source:n,getFormRef:b,formRule:v,formRuleChange:E,curScreeningMap:a,questionnaireList:_,questionnaireLoading:C,fetchQuestionnaireList:w,onScreenValuesChange:function(t,r){e.setState({hasChange:!0,headerFilterParamsNew:"aspect"===t&&D.find((function(e){return e.value===n})).hasAspect?(0,g.m3)(v.headerFilterParamsNew,r.filter((function(t){return e.props.curScreeningMap.some((function(e){return e.id===t.id}))||"ASPECT_MODEL"===t.id})),21===n?"PRODUCT_INFO":17===n?"QUESTIONNAIRE_RELATED":12===n?"BRAND_SERIES":"TOPIC",n):22===n?r.filter((function(t){return e.props.curScreeningMap.some((function(e){return e.id===t.id}))||"ASPECT_MODEL"===t.id})):r.filter((function(t){return e.props.curScreeningMap.some((function(e){return e.id===t.id}))&&"ASPECT_MODEL"!==t.id}))})},headerFilterParamsNew:x}),o.createElement(Ie,{warningTypes:D,getFormRef:P,categoryId:n,formRule:v,webhookList:N,formRuleChange:E,formPush:O,teamList:y,userList:S,formPushChange:R,fetchWebhookList:T}),o.createElement(Le,{getFormRef:L,save:I,title:r,description:i,ruleNameCheck:k}))))))},t}(o.Component);var We=n(5724),Me=n(64396),Ke=["loading"],xe=Me.Z.project.warning.edit,qe=Me.Z.IDBHeaderScreening.screening,Ye=function(e){function t(t){var n;(n=e.call(this,t)||this).formRef1=void 0,n.formRef2=void 0,n.formRef3=void 0,n.formRef4=void 0,n.events=void 0,n.warningTypes=void 0,n.routerWillLeave=function(){return!n.props.changed||"\u4fe1\u606f\u8fd8\u672a\u4fdd\u5b58\uff0c\u786e\u8ba4\u8981\u79bb\u5f00\uff1f"};var r=t.location;return n.state={loading:!0,projectId:D.t.get(D.V.backProjectConfig).id,location:r},n.events={getFormRef1:function(e){return n.formRef1=e},getFormRef2:function(e){return n.formRef2=e},getFormRef3:function(e){return n.formRef3=e},getFormRef4:function(e){return n.formRef4=e}},n.warningTypes=[],(0,We.xz)().then((function(e){var t=e[0].CHECK_OWNER.data;n.warningTypes=(0,g.rO)().map((function(e){var r,i,a,o;return{value:e.value,label:e.label,hasAspect:e.screening[0]&&(null==(r=t.find((function(t){return t.pageType===e.screening[0]&&t.projectId===n.state.projectId})))||null==(i=r.ownerChecks)?void 0:i.length)>0,hasKeyword:e.screening[1]&&(null==(a=t.find((function(t){return t.pageType===e.screening[1]&&t.projectId===n.state.projectId})))||null==(o=a.ownerChecks)?void 0:o.length)>0}}))})),n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.props.fetchUserList({projectId:this.state.projectId}),this.props.fetchWebhookList({projectId:this.state.projectId}),this.props.fetchQuestionnaireList({projectId:this.state.projectId}),this.props.location.state&&this.props.location.state.id?(setTimeout((function(t){return e.props.getWarning({id:e.props.location.state.id}).then((function(t){if(2e4===t.data.code){var n,r,i,a,o=(0,g.EH)(t.data.result,e.props.webhookList),l=o.formRule,s=o.formPush,u=o.categoryId,c=o.title,d=o.description;null==(n=e.formRef1)||n.setFieldsValue({categoryId:u}),null==(r=e.formRef2)||r.setFieldsValue({type:l.type,level:l.level,calType:l.condition.calType||"PERCENT",dateRangeType:l.condition.dateRangeType||"LAST_SENVEN_DAYS",min:l.condition.min||100}),null==(i=e.formRef3)||i.setFieldsValue({receiverTeamIdList:s.receiverTeamIdList,receiverUserIdList:s.receiverUserIdList,pushWay:l.condition&&l.condition.pushWay||[],combined:!l.condition||void 0===l.condition.combined||l.condition.combined,repeatType:!l.condition||!l.condition.repeatType||"ENABLE"===l.condition.repeatType,interval:s.interval,workType:l.condition&&l.condition.workType||"weekday"}),null==(a=e.formRef4)||a.setFieldsValue({title:c,description:d})}e.setState({loading:!1})}))}),500),this.props.saveInfo({isEdit:!!this.props.location.state.edit})):setTimeout((function(){var t,n,r,a,o,l,s=e.warningTypes.filter((function(e){return e.hasAspect||e.hasKeyword}));e.props.saveInfo({isEdit:!1,categoryId:null==(t=s[0])?void 0:t.value,formRule:(0,i.Z)({},e.props.formRule,{type:null!=(n=s[0])&&n.hasAspect?"PROJECT_ASPECT":"KEYWORDS"})}),null==(r=e.formRef1)||r.setFieldsValue({categoryId:null==(a=s[0])?void 0:a.value}),null==(o=e.formRef2)||o.setFieldsValue({type:null!=(l=s[0])&&l.hasAspect?"PROJECT_ASPECT":"KEYWORDS"}),s.length&&e.setState({loading:!1})}),500),this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave)},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return o.createElement(Fe,(0,i.Z)({warningTypes:this.warningTypes},this.props,this.state,this.events))},t}(o.PureComponent);const Ve=(0,l.connect)((function(e){var t=e.loading,n=(0,r.Z)(e,Ke);return(0,i.Z)({},n[xe],{questionnaireLoading:t.effects[xe+"/fetchQuestionnaireList"]||!1,submitLoading:t.effects[xe+"/submit"]||!1,updateLoading:t.effects[xe+"/update"]||!1,curScreeningMap:n[qe].curScreeningMap})}),(function(e){return{fetchUserList:function(t){return e({type:xe+"/fetchUserList",payload:t})},fetchWebhookList:function(t){return e({type:xe+"/fetchWebhookList",payload:t})},fetchQuestionnaireList:function(t){return e({type:xe+"/fetchQuestionnaireList",payload:t})},ruleNameCheck:function(t){return e({type:xe+"/ruleNameCheck",payload:t})},getWarning:function(t){return e({type:xe+"/getWarning",payload:t})},formRuleChange:function(t){return e({type:xe+"/formRuleChange",payload:t})},analysisChange:function(t){return e({type:xe+"/analysisChange",payload:t})},formPushChange:function(t){return e({type:xe+"/formPushChange",payload:t})},save:function(t){return e({type:xe+"/save",payload:t})},clean:function(t){return e({type:xe+"/clean",payload:t})},saveInfo:function(t){return e({type:xe+"/saveInfo",payload:t})},submit:function(t){return e({type:xe+"/submit",payload:t})},update:function(t){return e({type:xe+"/update",payload:t})}}}))(Ye)},55815:(e,t,n)=>{n.d(t,{Z:()=>c});var r=n(94578),i=n(67294),a=n(45697),o=n.n(a),l=n(43036),s=n(61409),u=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this)._handleBreadcrumbClick=function(e){var n=t.props,r=n.title,i=n.beforeJump;e!==r.length-1&&(i?new Promise((function(e,t){return i(e,t)})).then((function(){s.mW.push({pathname:r[e].url,state:r[e].state})})):s.mW.push({pathname:r[e].url,state:r[e].state}))},t}return(0,r.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,r=t.mainTitle,a=t.rightContent,o=t.className,s=t.overlay;return i.createElement("div",{className:"breadcumb-wrapper "+o},n instanceof Array?i.createElement("div",{className:"breadcrumb-left"},i.createElement("div",null,n.map((function(t,r){return i.createElement("span",{className:t.url?"":"not_clickable",key:r,onClick:function(){return t.url&&r!==n.length-1&&e._handleBreadcrumbClick(r)}},t.title,r!==n.length-1&&" / ")}))),i.createElement("span",null,r||n[n.length-1].title,s&&i.createElement(l.Z,{placement:"top",overlay:s},i.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):i.createElement("div",{className:"normal-title"},n,s&&i.createElement(l.Z,{placement:"top",overlay:s},i.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),a||"")},t}(i.Component);u.propTypes={className:o().string,title:o().oneOfType([o().string,o().arrayOf(o().shape({title:o().string,url:o().string,state:o().object}))]).isRequired,overlay:o().oneOfType([o().string,o().node]),mainTitle:o().oneOfType([o().string,o().node]),beforeJump:o().func,rightContent:o().node};const c=u}}]);