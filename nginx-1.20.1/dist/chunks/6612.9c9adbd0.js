"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6612],{13713:(e,t,n)=>{n.d(t,{u:()=>a});var r=n(35239),a=function(e){var t=e.title,n=e.url,a=r.t.get(r.V.backProjectConfig).name;return n&&-1!==n.indexOf("memberlist")?[{title:a,url:"/account/project/preview"},{title:"\u7528\u6237\u7ec4",url:"/account/project/usergroup"},{title:t,url:n}]:[{title:a,url:"/account/project/preview"},{title:t,url:n}]}},56612:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var r,a,l=n(63366),i=(n(15144),n(2307)),o=(n(1025),n(65400)),c=(n(54277),n(74048)),u=(n(48145),n(40987)),s=(n(15086),n(94055)),d=n(87462),m=n(94578),f=(n(53294),n(56697)),p=(n(89858),n(51024)),E=n(67294),h=n(55609),v=n(30381),y=n.n(v),I=n(68855),T=n(64396),O=n(55815),C=n(13713),g=(n(35797),n(64749)),k=(n(75314),n(11187)),S=(n(29809),n(97538)),R=n(23279),b=n.n(R),N=n(51474),D=n(33798);!function(e){e.CHECKBOX="\u591a\u9009",e.DATE_TIME="\u65e5\u671f",e.NUMERIC="\u6570\u5b57",e.RADIO="\u5355\u9009",e.TEXT="\u6587\u672c",e.STATE="\u72b6\u6001",e.CREATOR="\u521b\u5efa\u4eba",e.CREATED_TIME="\u521b\u5efa\u65f6\u95f4",e.ASSIGNEE="\u5904\u7406\u4eba",e.DUE_TIME="\u622a\u6b62\u65f6\u95f4",e.PRIORITY="\u4f18\u5148\u7ea7",e.UPDATER="\u66f4\u65b0\u4eba",e.UPDATED_TIME="\u66f4\u65b0\u65f6\u95f4",e.FINISHED_TIME="\u7ed3\u675f\u65f6\u95f4",e.DESCRIPTION="\u63cf\u8ff0",e.REMARK="\u5907\u6ce8",e.RICH_TEXT="\u5bcc\u6587\u672c",e.MESSAGE="\u5173\u8054\u7684\u6d88\u606f",e.WARNING="\u5173\u8054\u7684\u9884\u8b66\u901a\u77e5",e.ATTACHMENT="\u6587\u4ef6",e.TAG="\u6807\u7b7e"}(r||(r={})),function(e){e.STATE="\u5355\u9009",e.CREATOR="\u5355\u9009",e.CREATED_TIME="\u65e5\u671f",e.ASSIGNEE="\u5355\u9009",e.DUE_TIME="\u65e5\u671f",e.PRIORITY="\u5355\u9009",e.UPDATER="\u5355\u9009",e.UPDATED_TIME="\u65e5\u671f",e.FINISHED_TIME="\u65e5\u671f",e.DESCRIPTION="\u6587\u672c",e.REMARK="\u6587\u672c",e.RICH_TEXT="\u6587\u672c",e.MESSAGE="\u6587\u672c",e.WARNING="\u6587\u672c",e.ATTACHMENT="\u6587\u4ef6",e.TAG="\u6587\u672c"}(a||(a={}));var w=n(97448),A=["visible","title","onOk","onClose","fieldList"];const x=function(e){var t,n,i=e.visible,o=e.title,c=e.onOk,u=e.onClose,s=e.fieldList,m=(0,l.Z)(e,A),h=(null==(t=m.itemNode)||null==(n=t.items)?void 0:n.map((function(e){var t;return(0,d.Z)({},e,{isDefault:e.id===(null==(t=m.itemNode)?void 0:t.defaultItemId)})})))||[{value:"",isDefault:!0},{value:"",isDefault:!1}],v=S.Z.useForm()[0],y=(0,E.useState)(JSON.stringify(h)),I=y[0],T=y[1],O=(0,E.useState)({from:0,to:0}),C=(O[0],O[1]),R=(0,E.useState)(m.kind||""),x=R[0],Z=R[1],_=(0,E.useState)(0),M=_[0],P=_[1];(0,E.useEffect)((function(){document.querySelector("#option-list")&&N.default.create(document.querySelector("#option-list"),{group:"option-list",animation:150,handle:".options-handler",fallbackOnBody:!0,invertSwap:!0,delay:5,onEnd:function(e){var t=e.newIndex,n=e.oldIndex;if(t!==n){var r=JSON.parse(I);r.splice(t,0,r.splice(n,1)[0]),C({from:n,to:t}),T(JSON.stringify(r))}}})}));var F=function(){var e=JSON.parse(I);e.push({value:"",isDefault:!1}),T(JSON.stringify(e)),P(J.current.scrollHeight)},J=(0,E.useRef)(null);(0,E.useEffect)((function(){J.current&&(J.current.scrollTop=M)}),[J.current]);var Y=b()((function(){J.current&&P(J.current.scrollTop)}),100);(0,E.useEffect)((function(){JSON.parse(I).forEach((function(e,t){var n;(null==(n=e.value)?void 0:n.length)>20&&v.validateFields(["option"+t])}))}),[I]);var H=function(){var e=JSON.parse(I),t=document.documentElement.clientHeight-574,n="PRIORITY"!==x?2:3,r="PRIORITY"!==x?100:5;switch(x){case"RADIO":case"CHECKBOX":case"PRIORITY":return E.createElement("div",null,E.createElement("div",{id:"option-list",style:{maxHeight:t,overflow:"auto"},onScroll:Y,ref:J},e.map((function(t,r){var a=JSON.parse(I);return E.createElement("div",{key:r,className:"option-wrapper"},E.createElement(S.Z.Item,{label:E.createElement(E.Fragment,null,"PRIORITY"!==x&&E.createElement("i",{className:"icon-cem_move options-handler",style:{marginRight:"8px",cursor:"pointer"}}),"\u9009\u9879",r+1),name:"option"+r,rules:[{required:r<2,whitespace:r<2,message:"\u8bf7\u8f93\u5165\u9009\u9879\u540d\u79f0"},{type:"string",max:20,message:"\u6700\u591a\u8f93\u516520\u4e2a\u5b57"},{validator:function(e,t){return t&&a.some((function(e,n){return n<r&&e.value===t}))?Promise.reject(new Error("\u6b64\u9009\u9879\u540d\u79f0\u5df2\u88ab\u4f7f\u7528\uff0c\u8bf7\u5c1d\u8bd5\u5176\u4ed6\u9009\u9879\u540d\u79f0")):Promise.resolve()}}],validateFirst:!0,initialValue:t.value},E.createElement(p.default,{placeholder:"\u6700\u591a20\u4e2a\u5b57",style:{width:"400px"},prefix:"PRIORITY"===x?E.createElement(D.Z,{defaultIcon:w.jY[a.length][r],activeIcon:w.jY[a.length][r],style:{width:"16px",height:"16px",position:"relative",left:"-3px"}}):null,onBlur:function(e){return function(e,t){var n=e.target.value,r=JSON.parse(I).map((function(e,r){return r===t?(0,d.Z)({},e,{value:n.trim()}):e}));T(JSON.stringify(r))}(e,r)},suffix:"RADIO"===x||"PRIORITY"===x?t.isDefault?E.createElement("span",{style:{color:"#8C8C8C"}},"\u9ed8\u8ba4"):a[r].value&&E.createElement("a",{className:"hover_show",onClick:function(){return function(e){var t=JSON.parse(I).map((function(t,n){return n===e?(0,d.Z)({},t,{isDefault:!0}):(0,d.Z)({},t,{isDefault:!1})}));T(JSON.stringify(t))}(r)}},"\u8bbe\u4e3a\u9ed8\u8ba4"):null})),e.length>n&&E.createElement("i",{className:"icon-cem_trash",onMouseUp:function(){return function(e){var t=JSON.parse(I);t.splice(e,1);var n=t.some((function(e){return e.isDefault}))?t:t.map((function(e,t){return 0===t?(0,d.Z)({},e,{isDefault:!0}):e}));T(JSON.stringify(n))}(r)},style:{marginLeft:"12px"}}))}))),e.length<r&&E.createElement(S.Z.Item,{wrapperCol:{offset:4}},E.createElement("a",{onMouseUp:F},E.createElement("i",{className:"icon-cem_add-to",style:{marginRight:"12px"}}),"\u6dfb\u52a0\u9009\u9879")));case"DATE_TIME":case"DUE_TIME":return E.createElement(S.Z.Item,{label:"\u65e5\u671f\u683c\u5f0f"},"2020/12/01 12:00");case"TEXT":return E.createElement(S.Z.Item,{label:"\u5907\u6ce8"},"\u6587\u672c\u6700\u591a\u8f93\u51651000\u4e2a\u5b57");case"NUMERIC":return E.createElement(S.Z.Item,{label:"\u5907\u6ce8"},"\u6700\u591a\u652f\u6301\u8f93\u5165\u5c0f\u6570\u70b9\u540e\u56db\u4f4d\uff0c\u7b26\u53f7\u4ec5\u652f\u6301\u8f93\u5165\u8d1f\u53f7\uff0c\u4f8b\u5982-13.02");default:return E.createElement(E.Fragment,null)}};return E.createElement(E.Fragment,null,E.createElement(f.Z,{title:o+"\u5b57\u6bb5",visible:i,wrapClassName:"field_add_modal",width:600,centered:!0,onOk:function(){var e=JSON.parse(I);e.forEach((function(e,t){var n;v.setFieldsValue(((n={})["option"+t]=e.value,n))})),v.validateFields().then((function(t){if("RADIO"!==x&&"PRIORITY"!==x||!e.some((function(e){return e.isDefault&&!e.value}))){var n=e.filter((function(e){return e.value})),r=t.name,a=t.kind,l=t.isRequired,i={id:null==m?void 0:m.id,name:r,kind:(null==m?void 0:m.kind)||a,isRequired:!!l,itemNode:"RADIO"===x||"PRIORITY"===x?{items:n,defaultValue:n.filter((function(e){return e.isDefault}))[0].value}:"CHECKBOX"===x?{items:n}:void 0};c(i)}else k.default.error("\u9ed8\u8ba4\u503c\u9009\u9879\u5185\u5bb9\u4e3a\u7a7a\uff0c\u8bf7\u586b\u5199\u9009\u9879\u5185\u5bb9\u6216\u9009\u62e9\u5176\u4ed6\u9009\u9879\u4e3a\u9ed8\u8ba4\u503c")})).catch((function(e){}))},onCancel:function(){Z(""),u()},destroyOnClose:!0,maskClosable:!1},E.createElement(S.Z,{form:v,colon:!1,labelCol:{span:4},initialValues:{name:m.name,kind:m.isSystem?a[m.kind]:r[m.kind],isRequired:!1===(null==m?void 0:m.isRequired)?0:1},preserve:!1},E.createElement(S.Z.Item,{label:"\u5b57\u6bb5\u540d\u79f0",name:"name",rules:[{required:!0,whitespace:!0,message:"\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d\u79f0"},{type:"string",max:20,message:"\u6700\u591a\u8f93\u516520\u4e2a\u5b57"},{validator:function(e,t){return null!=s&&s.some((function(e){return e.name===t&&(null==m?void 0:m.id)!==e.id}))?Promise.reject(new Error("\u6b64\u5b57\u6bb5\u540d\u79f0\u5df2\u88ab\u4f7f\u7528\uff0c\u8bf7\u5c1d\u8bd5\u5176\u4ed6\u5b57\u6bb5\u540d\u79f0")):Promise.resolve()}}],validateFirst:!0},E.createElement(p.default,{style:{width:"400px"},placeholder:"\u6700\u591a20\u4e2a\u5b57",disabled:m.isSystem,tabIndex:0})),E.createElement(S.Z.Item,{label:"\u5b57\u6bb5\u7c7b\u578b",name:"kind",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5b57\u6bb5\u7c7b\u578b"}]},E.createElement(g.default,{tabIndex:1,style:{width:"400px"},placeholder:"\u8bf7\u9009\u62e9",options:[{value:"RADIO",label:"\u5355\u9009"},{value:"CHECKBOX",label:"\u591a\u9009"},{value:"DATE_TIME",label:"\u65e5\u671f"},{value:"TEXT",label:"\u6587\u672c"},{value:"NUMERIC",label:"\u6570\u5b57"}],onChange:function(e){return Z(e)},disabled:m.id})),E.createElement(S.Z.Item,{label:"\u662f\u5426\u5fc5\u586b",name:"isRequired",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u662f\u5426\u5fc5\u586b"}]},E.createElement(g.default,{tabIndex:2,style:{width:"400px"},placeholder:"\u8bf7\u9009\u62e9",options:[{value:1,label:"\u662f"},{value:0,label:"\u5426"}],disabled:"RADIO"===x||"PRIORITY"===x})),E.createElement(H,null)),"PRIORITY"===x&&E.createElement("span",{className:"footer-tip"},"\u9009\u9879\u987a\u5e8f\u7531\u4e0a\u81f3\u4e0b\u4e3a\uff1a\u6700\u9ad8\u4f18\u5148\u7ea7 \u81f3 \u6700\u4f4e\u4f18\u5148\u7ea7")))};var Z=n(35239),_=["loading"],M=T.Z.workOrder.field,P=p.default.Search,F=f.Z.confirm,J=function(e){function t(t){var n;return(n=e.call(this,t)||this).state=void 0,n.handleOnClick=function(e){e?n.setState({title:"\u7f16\u8f91"}):n.setState({title:"\u6dfb\u52a0"}),n.setState({record:e,visible:!0})},n.deleteOption=function(e,t){var r,a="CHECKBOX"===t.kind;F({title:"\u5220\u9664\u9009\u9879",icon:E.createElement(I.Z,{style:{color:"#FF7955"}}),content:"\u662f\u5426\u786e\u8ba4\u5220\u9664\u201c"+e+"\u201d\u9009\u9879\uff0c\u5220\u9664\u540e\uff0c\u5386\u53f2\u5de5\u5355\u4e2d\u5339\u914d\u5230\u8be5\u9009\u9879\u7684\u503c\u90fd\u4f1a\u88ab"+(a?"\u5220\u9664":"\u66ff\u6362\u6210\u9ed8\u8ba4\u503c\u201c"+(null==(r=t.itemNode)?void 0:r.defaultValue)+"\u201d")+"\u3002",okText:"\u786e\u5b9a",okType:"primary",cancelText:"\u53d6\u6d88",autoFocusButton:null,centered:!0,onOk:function(){n.props.fetchEdit((0,d.Z)({},t,{isForceUpdate:!0})),n.setState({record:void 0,visible:!1})}})},n.onOk=function(e){e.id?n.props.fetchEdit(e).then((function(t){if(6000001===(null==t?void 0:t.code)){var r=JSON.parse(t.msg).join("\u201d\uff0c\u201c");n.deleteOption(r,e)}else n.setState({record:void 0,visible:!1})})):n.props.fetchAdd(e).then((function(e){n.setState({record:void 0,visible:!1})}))},n.onClose=function(){n.setState({record:void 0,visible:!1})},n.showConfirm=function(e,t){var r=e.id,a=e.name,l=function(){switch(t){case!0:return{title:"\u786e\u8ba4\u542f\u7528",desc:"\u662f\u5426\u542f\u7528\u201c"+a+"\u201d\u5b57\u6bb5\uff1f\u542f\u7528\u540e\uff0c\u65b0\u589e\u5de5\u5355\u53ef\u4ee5\u914d\u7f6e\u8be5\u5b57\u6bb5"};case!1:return{title:"\u786e\u8ba4\u7981\u7528",desc:"\u662f\u5426\u7981\u7528\u201c"+a+"\u201d\u5b57\u6bb5\uff0c\u7981\u7528\u540e\uff0c\u65b0\u589e\u5de5\u5355\u5c06\u4e0d\u518d\u914d\u7f6e\u8be5\u5b57\u6bb5\uff0c\u4f46\u80fd\u7ee7\u7eed\u67e5\u8be2\u5339\u914d\u5230\u8be5\u5b57\u6bb5\u7684\u5386\u53f2\u5de5\u5355\u3002"};default:return{title:"\u5220\u9664",desc:"\u662f\u5426\u786e\u5b9a\u5220\u9664\u201c"+a+"\u201d\u5b57\u6bb5\uff1f\u6240\u6709\u5de5\u5355\u8be6\u60c5\u4e2d\u5339\u914d\u5230\u201c"+a+"\u201d\u5b57\u6bb5\u7684\u5185\u5bb9\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u4f46\u5de5\u5355\u672c\u8eab\u4e0d\u4f1a\u88ab\u5220\u9664\u3002"}}}();F({title:l.title,icon:E.createElement(I.Z,{style:{color:"#FF7955"}}),content:l.desc,okText:"\u786e\u5b9a",okType:"primary",cancelText:"\u53d6\u6d88",autoFocusButton:null,onOk:function(){switch(t){case!0:n.props.fetchEnable(r);break;case!1:n.props.fetchDisable(r);break;default:n.props.fetchDelete(r)}},onCancel:function(){}})},n.handleOnSearch=function(e){n.props.nameSearch(e)},n.state={visible:!1,title:"",keyword:"",record:void 0},t.save({projectId:Z.t.get(Z.V.backProjectConfig).id}),n}(0,m.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.fetchList()},n.componentWillUnmount=function(){},n.render=function(){var e=this,t=[{title:"\u540d\u79f0",dataIndex:"name",key:"name",width:"36%"},{title:"\u5f52\u5c5e",dataIndex:"isSystem",key:"isSystem",width:"150px",render:function(e){return E.createElement("span",null,e?"\u7cfb\u7edf\u9ed8\u8ba4":"\u81ea\u5b9a\u4e49\u5b57\u6bb5")}},{title:"\u7c7b\u578b",dataIndex:"kind",key:"kind",render:function(e,t){return E.createElement("span",null,t.isSystem?a[e]:r[e])}},{title:"\u662f\u5426\u5fc5\u586b",dataIndex:"isRequired",key:"isRequired",render:function(e,t){return E.createElement("span",null,e?"\u662f":"\u5426")}},{title:"\u6700\u8fd1\u4fee\u6539\u65f6\u95f4",dataIndex:"updatedAt",key:"updatedAt",render:function(e,t){return E.createElement(s.default,{title:t.updater.username},E.createElement("span",{style:{cursor:"default"}},y()(e).format("YYYY/MM/DD HH:mm")))}},{title:"\u662f\u5426\u542f\u7528",dataIndex:"state",key:"state",render:function(t,n){return!n.isSystem&&E.createElement(u.Z,{onClick:function(t){return e.showConfirm(n,"ENABLED"!==n.state)},checked:"ENABLED"===t})}},{title:"\u64cd\u4f5c",key:"action",minWidth:80,render:function(t,n){return E.createElement(c.default,{size:"middle"},(!n.isSystem||n.isEditable)&&E.createElement("a",{onClick:function(){return e.handleOnClick(n)}},"\u7f16\u8f91"),!n.isSystem&&E.createElement("a",{onClick:function(){return e.showConfirm(n)}},"\u5220\u9664"))}}],n=this.props,l=n.fieldList,m=n.name,f=n.loading,p=this.state,h=p.visible,v=p.title,I=p.keyword,T=p.record,g=null==l?void 0:l.filter((function(e){return"STATE"!==e.kind&&-1!==e.name.search(m)}));return E.createElement("div",{className:"workOrder-field-wrapper"},E.createElement(O.Z,{title:(0,C.u)({title:"\u5b57\u6bb5\u914d\u7f6e",url:""})}),E.createElement("div",{className:"workOrder-field-container"},E.createElement("div",{className:"workOrder-field-content"},E.createElement("div",{className:"workOrder-field-content_header"},E.createElement(P,{placeholder:"\u8bf7\u8f93\u5165",suffix:E.createElement("i",{className:"icon-cem_small-search",onClick:function(){return e.handleOnSearch(I)},style:{color:"#8C8C8C"}}),style:{width:160},onSearch:this.handleOnSearch,onChange:function(t){return e.setState({keyword:t.target.value})},allowClear:!0}),E.createElement(o.default,{type:"primary",onClick:function(){return e.handleOnClick()}},"\u6dfb\u52a0\u5b57\u6bb5")),E.createElement(i.Z,{dataSource:g,columns:t,getPopupContainer:function(){return document.querySelector(".workOrder-field-content")},pagination:{total:null==g?void 0:g.length,showSizeChanger:!0},scroll:{x:"100%",y:"calc(100% - 64px)"},rowKey:function(e){return e.id},loading:f}))),h&&E.createElement(x,(0,d.Z)({visible:h,onOk:this.onOk,onClose:this.onClose,title:v,fieldList:l},T)))},t}(E.Component);const Y=(0,h.connect)((function(e){var t=e.loading,n=(0,l.Z)(e,_);return(0,d.Z)({},n[M],{loading:t.effects[M+"/fetchList"]||!1})}),(function(e){return{save:function(t){return e({type:M+"/save",payload:t})},clean:function(){return e({type:M+"/clean"})},fetchAdd:function(t){return e({type:M+"/fetchAdd",payload:t})},fetchList:function(t){return e({type:M+"/fetchList",payload:t})},nameSearch:function(t){return e({type:M+"/nameSearch",payload:t})},fetchDelete:function(t){return e({type:M+"/fetchDelete",payload:t})},fetchEnable:function(t){return e({type:M+"/fetchEnable",payload:t})},fetchDisable:function(t){return e({type:M+"/fetchDisable",payload:t})},fetchEdit:function(t){return e({type:M+"/fetchEdit",payload:t})}}}))(J)},55815:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(94578),a=n(67294),l=n(45697),i=n.n(l),o=n(43036),c=n(61409),u=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this)._handleBreadcrumbClick=function(e){var n=t.props,r=n.title,a=n.beforeJump;e!==r.length-1&&(a?new Promise((function(e,t){return a(e,t)})).then((function(){c.mW.push({pathname:r[e].url,state:r[e].state})})):c.mW.push({pathname:r[e].url,state:r[e].state}))},t}return(0,r.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,r=t.mainTitle,l=t.rightContent,i=t.className,c=t.overlay;return a.createElement("div",{className:"breadcumb-wrapper "+i},n instanceof Array?a.createElement("div",{className:"breadcrumb-left"},a.createElement("div",null,n.map((function(t,r){return a.createElement("span",{className:t.url?"":"not_clickable",key:r,onClick:function(){return t.url&&r!==n.length-1&&e._handleBreadcrumbClick(r)}},t.title,r!==n.length-1&&" / ")}))),a.createElement("span",null,r||n[n.length-1].title,c&&a.createElement(o.Z,{placement:"top",overlay:c},a.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):a.createElement("div",{className:"normal-title"},n,c&&a.createElement(o.Z,{placement:"top",overlay:c},a.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),l||"")},t}(a.Component);u.propTypes={className:i().string,title:i().oneOfType([i().string,i().arrayOf(i().shape({title:i().string,url:i().string,state:i().object}))]).isRequired,overlay:i().oneOfType([i().string,i().node]),mainTitle:i().oneOfType([i().string,i().node]),beforeJump:i().func,rightContent:i().node};const s=u}}]);