"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5876],{25876:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Z});var a=n(63366),r=n(87462),l=n(94578),c=n(67294),i=n(55609),s=n(64396),o=n(35239),u=(n(1025),n(65400)),m=(n(30467),n(55673)),d=(n(58136),n(5789)),p=(n(89581),n(84996)),h=(n(15086),n(94055)),f=(n(53294),n(56697)),g=(n(89858),n(51024)),E=n(68855),y=n(30381),v=n.n(y),b=n(96889),_=n(61409),C=n(39432),S=(n(89626),n(70302));const N=function(e){var t=e.title,n=e.count,a=e.params,r=e.countData,l=function(e){var t={title:"\u5168\u90e8\u94fe\u63a5",cardSearch:!0,count:n,params:e};"countUpcoming"===e?t.title="\u5f85\u5904\u7406\u94fe\u63a5":"totalAdd"===e?t.title="\u5df2\u6dfb\u52a0\u94fe\u63a5":"totalIgnore"===e&&(t.title="\u5df2\u5ffd\u7565\u94fe\u63a5"),t.countData=r,_.mW.push({pathname:"/account/project/"+location.pathname.split("/")[3]+"/subscribe/link",state:t})};return c.createElement(S.Z,null,c.createElement("div",{className:"card_header"},c.createElement("span",{className:"card_header_title"},t,c.createElement(h.default,{placement:"top",overlayClassName:"updater_hover_style",overlay:function(e){switch(e){case"totalHis":return"\u5168\u90e8\u94fe\u63a5\u662f\u6307\u88ab\u9879\u76ee\u4e2d\u73b0\u5b58\u7684\u8ba2\u9605\u89c4\u5219\u53d1\u73b0\u8fc7\u7684\u5546\u54c1\u94fe\u63a5\u3002";case"countUpcoming":return"\u5f85\u5904\u7406\u94fe\u63a5\u662f\u6307\u7b26\u5408\u8ba2\u9605\u89c4\u5219\uff0c\u4f46\u8fd8\u6ca1\u6709\u88ab\u7ef4\u62a4\u4e3b\u9898\u503c\u7684\u5546\u54c1\u94fe\u63a5\u3002\u5982\u679c\u591a\u4e2a\u89c4\u5219\u4e2d\u6709\u76f8\u540c\u7684\u94fe\u63a5\uff0c\u5f85\u5904\u7406\u94fe\u63a5\u6570\u91cf\u53ea\u4f1a\u7edf\u8ba1\u4e00\u6b21\u3002";case"totalAdd":return"\u5df2\u6dfb\u52a0\u94fe\u63a5\u662f\u6307\u7b26\u5408\u8ba2\u9605\u89c4\u5219\uff0c\u5e76\u6dfb\u52a0\u5230\u9879\u76ee\u4e2d\u7684\u5546\u54c1\u94fe\u63a5\u3002\u5982\u679c\u591a\u4e2a\u89c4\u5219\u4e2d\u6709\u76f8\u540c\u7684\u94fe\u63a5\uff0c\u5df2\u5904\u7406\u94fe\u63a5\u6570\u91cf\u53ea\u4f1a\u7edf\u8ba1\u4e00\u6b21\u3002";case"totalIgnore":return"\u5df2\u5ffd\u7565\u94fe\u63a5\u662f\u6307\u88ab\u9879\u76ee\u4e2d\u73b0\u5b58\u7684\u8ba2\u9605\u89c4\u5219\u53d1\u73b0\u8fc7\uff0c\u4f46\u88ab\u6807\u8bb0\u4e3a\u5df2\u5ffd\u7565\u7684\u5546\u54c1\u94fe\u63a5\u3002";default:return""}}(a),mouseEnterDelay:.5},c.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:"8px"}}))),c.createElement("span",{className:"card_header_botton "+(n?"":" card_disable"),onClick:function(){return l(a)}},c.createElement("i",{className:"icon-cem_check-the-password"}),"\u67e5\u770b")),c.createElement("div",null,c.createElement("span",{className:"card_count "+(n?"":" count_disable"),onClick:function(){return l(a)}},n?C.ZP.formatNumber(n):"0")))};var k=g.default.Search;const w=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnEditClick=function(e,t){var a=n.props.location.pathname.split("/")[3],r={title:"\u65b0\u5efa\u89c4\u5219"};if(e){var l=e.id,c=e.idValuesModels,i=e.ruleName;r.id=l,r.ruleName=i,r.title=t,r.rules=c.map((function(e){var t="price"===e.id?e.values:e.values?e.values.map((function(t,n){return{id:t,name:e.names[n]}})):null;return{id:e.id,values:t}}))}_.mW.push({pathname:"/account/project/"+a+"/subscribe/edit",state:r})},n._handleSeeClick=function(e,t){var a=n.props.location.pathname.split("/")[3];sessionStorage.setItem("ruleNumbers",""+e.number),_.mW.push({pathname:"/account/project/"+a+"/subscribe/link",state:(0,r.Z)({},t,{ruleNameObj:{ruleNumbers:[e.number],ruleName:e.ruleName||e.number}})})},n.state={searchValue:"",filterRef:{}},n}(0,l.Z)(t,e);var n=t.prototype;return n.confirm=function(e){var t=this;f.Z.confirm({title:"\u5220\u9664",icon:c.createElement(E.Z,null),className:"rule_delete",content:"\u662f\u5426\u5220\u9664\u201c"+(e.ruleName||e.number)+"\u201d\u89c4\u5219\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){return t.props.onDelete(e.id)}})},n.handleFilterShow=function(e,t){var n=this.state.filterRef;n[e]?n[e]=Object.assign(n[e],t):n[e]=t,this.setState({filterRef:(0,r.Z)({},n)})},n.render=function(){var e=this,t=this.props,n=t.ruleList,a=t.total,l=t.countData,i=t.loading,s=t.numberList,o=t.pageIndex,f=this.state.filterRef,g=n&&s?(n||[]).map((function(e){var t=s.find((function(t){return String(t.id)===String(e.id)}));return(0,r.Z)({},e,t,{addNumber:t?t.addNumber:0,initNumber:t?t.initNumber:0,finishTime:t?t.time:""})})):n,E=[{title:c.createElement("span",null,"\u8ba2\u9605\u89c4\u5219",c.createElement(h.default,{overlayClassName:"updater_hover_style",overlay:"\u65b0\u89c4\u5219\u5305\u542b\u65e7\u89c4\u5219\u7684\u90e8\u5206\u94fe\u63a5\uff0c\u90a3\u4e48\u8fd9\u90e8\u5206\u94fe\u63a5\u5bf9\u5e94\u7684\u8ba2\u9605\u72b6\u6001\u8ddf\u65e7\u89c4\u5219\u4fdd\u6301\u4e00\u81f4\u3002\u4f8b\u5982\uff0c\u65e7\u89c4\u5219\u7684\u67d0\u4e00\u6761\u94fe\u63a5\u8ba2\u9605\u72b6\u6001\u4e3a\u5df2\u6dfb\u52a0\uff0c\u90a3\u4e48\u65b0\u89c4\u5219\u4e2d\u8be5\u6761\u94fe\u63a5\u7684\u8ba2\u9605\u72b6\u6001\u4e5f\u662f\u5df2\u6dfb\u52a0\u3002"},c.createElement("i",{className:"icon-cem_file1 price_tip",style:{marginLeft:4}}))),dataIndex:"ruleName",width:"30%",render:function(t,n,a){var r="-"!==t?t:n.number;return c.createElement(h.default,{overlayClassName:"smart_rule_tip",placement:"top",title:c.createElement("div",null,n.idValuesModels.map((function(t){var a=t.id+n.id;return"packageType"!==t.id?c.createElement("dl",{key:t.name},c.createElement("dt",null,t.name),c.createElement("dd",{ref:function(t){return!f[a]&&e.handleFilterShow(a,{ref:t,clientHeight:t.clientHeight,class:t.clientHeight>22?"collaspe":"",isShow:!1})},className:f[a]&&f[a].class?"showItem "+(f[a].isShow?"":f[a].class):""},c.createElement("span",null,"price"===t.id?t.names.length>1?parseFloat(t.names[0])+"-"+parseFloat(t.names[1]):"":t.names.join("\u3001")),f[a]&&f[a].class?c.createElement("span",{onClick:function(){return e.handleFilterShow(a,{isShow:!f[a].isShow})}},f[a].isShow?"\u6536\u8d77":"\u5c55\u5f00",f[a].isShow?c.createElement("i",{className:"icon-cem_pull-or-take-up"}):c.createElement("i",{className:"icon-cem_pull-down-or-take-up"})):"")):null})))},c.createElement("div",null,c.createElement("a",{onClick:function(){return e._handleSeeClick(n)},className:0===n.linkCount?"edit_disable":"rule_name"},r)))}},{title:"\u5df2\u6dfb\u52a0\u94fe\u63a5",width:"12%",dataIndex:"addNumber",render:function(t,n){return c.createElement("a",{onClick:function(){return e._handleSeeClick(n,{params:"totalAdd"})},className:n.addNumber?"":"edit_disable"},C.ZP.formatNumber(t))}},{title:"\u5f85\u5904\u7406\u94fe\u63a5",width:"12%",dataIndex:"initNumber",render:function(t,n){return c.createElement("a",{onClick:function(){return e._handleSeeClick(n,{params:"countUpcoming"})},className:n.initNumber?"":"edit_disable"},C.ZP.formatNumber(t))}},{title:"\u72b6\u6001",width:"15%",dataIndex:"status",render:function(e,t){switch(e){case"Sync_Finish":return c.createElement(p.Z,{color:"#60DDA9",text:c.createElement("span",null,v()().diff(t.syncTime,"minutes")<=1?"1 \u5206\u949f\u524d":v()(t.syncTime).fromNow(),"\u66f4\u65b0")});case"Sync":case"Enable":return c.createElement(p.Z,{color:"#5B8FF9",text:"\u6b63\u5728\u66f4\u65b0"});case"Sync_Fail":return c.createElement(p.Z,{color:"#F08A8A",text:c.createElement("span",null,v()().diff(t.syncTime,"minutes")<=1?"1 \u5206\u949f\u524d":v()(t.syncTime).fromNow(),"\uff0c\u66f4\u65b0\u5931\u8d25")});default:return}}},{title:"\u64cd\u4f5c\u4eba",width:"15%",dataIndex:"updater",render:function(e,t){return c.createElement(h.default,{title:c.createElement("div",null,c.createElement("span",{style:{marginRight:8}},e),e&&e.length>=10?c.createElement("br",null):"",c.createElement("span",null,v()(t.updateAt).format("MM/DD HH:mm:ss"))),overlayClassName:"updater_hover_style"},e)}},{title:"\u64cd\u4f5c",width:"164px",key:"option",valueType:"option",render:function(t,n){return[c.createElement("a",{key:"link",onClick:function(){return e._handleOnEditClick(n,"\u91cd\u547d\u540d")},className:"Sync"===n.status||"Enable"===n.status?"link_disable":""},"\u91cd\u547d\u540d"),c.createElement("a",{key:"link1",onClick:function(){return e._handleOnEditClick(n,"\u590d\u5236")},className:"Sync"===n.status||"Enable"===n.status?"link_disable":""},"\u590d\u5236"),c.createElement("a",{key:"link2",onClick:function(){return e.confirm(n)},className:"Sync"===n.status||"Enable"===n.status?"link_disable":""},"\u5220\u9664")]}}];return c.createElement("div",{className:"smartSubscribe_wrap"},c.createElement("div",{className:"smartSubscribe_card_wrapper"},c.createElement(m.default,{gutter:16},c.createElement(d.default,{span:6},c.createElement(N,{title:"\u5168\u90e8\u94fe\u63a5",count:l&&l.totalHis,params:"totalHis",countData:l})),c.createElement(d.default,{span:6},c.createElement(N,{title:"\u5f85\u5904\u7406\u94fe\u63a5",count:l&&l.countUpcoming,params:"countUpcoming",countData:l})),c.createElement(d.default,{span:6},c.createElement(N,{title:"\u5df2\u6dfb\u52a0\u94fe\u63a5",count:l&&l.totalAdd,params:"totalAdd",countData:l})),c.createElement(d.default,{span:6},c.createElement(N,{title:"\u5df2\u5ffd\u7565\u94fe\u63a5",count:l&&l.totalIgnore,params:"totalIgnore",countData:l})))),c.createElement(b.ZP,{columns:E,loading:i,rowKey:"id",pagination:{defaultPageSize:"10",total:a,onChange:this.props.onPageChange,current:o},dataSource:g,search:!1,scroll:{y:500},headerTitle:c.createElement(k,{placeholder:"\u641c\u7d22\u89c4\u5219",allowClear:!0,suffix:c.createElement("i",{className:"icon-cem_small-search",onClick:function(){return e.props.onSearch(e.state.searchValue)},style:{color:"#8C8C8C"}}),onSearch:this.props.onSearch,onChange:function(t){e.setState({searchValue:t.target.value})}}),toolBarRender:function(){return[c.createElement(u.default,{type:"primary",key:"primary",onClick:function(){return e._handleOnEditClick()}},"\u65b0\u5efa\u89c4\u5219")]},options:!1}))},t}(c.Component);var I=["loading"],R=s.Z.product.comment.smartSubscribe,D=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleOnWsMessage=function(e){var t=e.data;if(t.type&&"ws"===t.type){var a=t.payload,r=a.type,l=a.result;"SUBSCRIBE_RULE_PRODUCT_NUM"===r&&n.props.save({numberList:l.idLog})}},n._handleOnFilterChange=function(e){(void 0!==e.keyword||e.pageIndex)&&n.props.fetchRuleList((0,r.Z)({},e,{type:n.props.type}))},n._handleOnDelete=function(e){n.props.deleteRule(e)},n._handleOnPageChange=function(e,t){n.props.fetchRuleList({pageIndex:e,pageSize:t})},n._handleOnSearch=function(e){n.props.save({ruleName:e}),n.props.fetchRuleList({ruleName:e,pageIndex:1,pageSize:10})},n.state={type:t.location.pathname.includes("/price")?"PRICE":"DEFAULT"},n._event={onFilterChange:n._handleOnFilterChange,onDelete:n._handleOnDelete,onPageChange:n._handleOnPageChange,onSearch:n._handleOnSearch};var a=t.location.pathname;return t.save({type:a.includes("/price")?"PRICE":"DEFAULT",projectId:o.t.get(o.V.backProjectConfig).id}),window.addEventListener("message",n._handleOnWsMessage),n}(0,l.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this.state.type;setTimeout((function(){e.props.fetchSubscribeCount({type:t}),e.props.fetchRuleList({type:t}),e.props.fetchConnectCount()}),100),sessionStorage.getItem("activekeyType")&&sessionStorage.removeItem("activekeyType"),sessionStorage.getItem("salesStatus")&&sessionStorage.removeItem("salesStatus"),sessionStorage.getItem("ruleNumbers")&&sessionStorage.removeItem("ruleNumbers"),sessionStorage.getItem("dateFilter")&&sessionStorage.removeItem("dateFilter")},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return c.createElement(w,(0,r.Z)({},this.state,this.props,this._event))},t}(c.Component);const Z=(0,i.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,I);return(0,r.Z)({},n[R],{loading:t.effects[R+"/fetchRuleList"]||!1})}),(function(e){return{fetchRuleList:function(t){return e({type:R+"/fetchRuleList",payload:t})},deleteRule:function(t){return e({type:R+"/deleteRule",payload:t})},fetchConnectCount:function(){return e({type:R+"/fetchConnectCount"})},fetchSubscribeCount:function(t){return e({type:R+"/fetchSubscribeCount",payload:t})},save:function(t){return e({type:R+"/save",payload:t})},clean:function(t){return e({type:R+"/clean",payload:t})}}}))(D)}}]);