"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[99],{13713:(e,t,n)=>{n.d(t,{u:()=>r});var a=n(35239),r=function(e){var t=e.title,n=e.url,r=a.t.get(a.V.backProjectConfig).name;return n&&-1!==n.indexOf("memberlist")?[{title:r,url:"/account/project/preview"},{title:"\u7528\u6237\u7ec4",url:"/account/project/usergroup"},{title:t,url:n}]:[{title:r,url:"/account/project/preview"},{title:t,url:n}]}},99:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var a,r=n(87462),o=(n(53294),n(56697)),c=(n(75314),n(11187)),l=n(97326),i=n(94578),d=n(67294),u=n(68855),s=n(55815),m=n(13713),f=(n(7940),n(31059)),p=(n(6373),n(82891)),h=(n(54214),n(12386)),g=(n(89858),n(51024)),v=(n(15267),n(64713)),k=n(49722);!function(e){e.Queue="QUEUE",e.Any="ANY"}(a||(a={}));const S=function(e){var t=e.projectId,n=(0,d.useState)(void 0),r=n[0],o=n[1],l=(0,d.useRef)(),i=function(){(function(e){var t=e.projectId;return k.h.get("/workorder/project-extended/modelKind?projectId="+t,{})})({projectId:t}).then((function(e){2e4===e.data.code&&(o(e.data.result.modelKind),l.current=e.data.result.id)}))};return(0,d.useEffect)((function(){i()}),[]),d.createElement("div",{className:"state-set-box"},d.createElement("span",{className:"state-set-label"},"\u6a21\u5f0f\u9009\u62e9"),d.createElement(v.default.Group,{name:"radiogroup",value:r,onChange:function(e){var n=e.target.value;(function(e){var t=e.projectId,n=e.modelKind,a=e.id;return k.h.put("/workorder/project-extended/modelKind",{projectId:t,modelKind:n,id:a})})({projectId:t,modelKind:n,id:l.current}).then((function(e){2e4===e.data.code&&(o(n),c.default.success("\u64cd\u4f5c\u6210\u529f"))}))}},d.createElement(v.default,{value:a.Queue},"\u72b6\u6001\u4f9d\u6b21\u53d8\u66f4"),d.createElement(v.default,{value:a.Any},"\u72b6\u6001\u4efb\u610f\u53d8\u66f4")))};var E=n(1977),y=(n(1025),n(65400));const I=function(e){var t=e.isShow,n=e.allNames,a=e.addState,r=e.handleAddStateItem,c=e.activedID,l=(0,d.useState)(""),i=l[0],u=l[1],s=(0,d.useState)(-1),m=s[0],f=s[1],p=function(){u("")},h=[{title:"\u5df2\u5b58\u5728\u76f8\u540c\u7684\u72b6\u6001\u540d\u79f0\uff0c\u8bf7\u7528\u5176\u5b83\u540d\u79f0",func:function(){return n.includes(i)}},{title:"\u72b6\u6001\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc710\u4e2a\u5b57",func:function(){return i.length>10}}];return d.createElement(d.Fragment,null,d.createElement(o.Z,{title:null,footer:null,visible:t,closable:!1,width:600},d.createElement("div",{style:{marginTop:"10px"}},d.createElement("div",{style:{marginBottom:"20px"}},d.createElement("span",{style:{fontSize:"16px",marginLeft:"24px"}},"\u65b0\u5efa\u5de5\u5355\u72b6\u6001")),d.createElement(g.default,{placeholder:"\u72b6\u6001\u540d\u79f0",value:i,onChange:function(e){!function(e){u(e.target.value)}(e),f(-1)},style:{width:"500px",marginLeft:"26px"}}),m>-1&&h[m].func()&&d.createElement("span",{style:{display:"inline-block",width:"300px",marginLeft:"28px",color:"#FF4D4F",marginTop:"5px"}},h[m].title)),d.createElement("div",{style:{marginTop:"40px",textAlign:"right",marginRight:"25px"}},d.createElement(y.default,{onClick:function(){a(),p()}},"\u53d6\u6d88"),d.createElement(y.default,{type:"primary",onClick:function(){var e=h.map((function(e){return e.func()})).indexOf(!0);f(e),-1===e&&(a(),p(),r({name:i,id:c}))}},"\u786e\u8ba4"))))};var N=n(97448);const C=function(e){var t=(0,r.Z)({},e),n=t.projectId,a=t.handleAddStateItem,c=t.handOnChangeStartName,l=t.handOnChangeRemark,i=t.handOnChangeEndName,s=t.handOnChangeIngName,m=t.handleDeleteItem,v=t.handleStatusUpdate,k=t.startStateValue,y=t.ingStateValue,C=t.endStateValue,b=t.getWorkOrderStatusChecked,j=(0,d.useState)(new Array(y.length).fill(!1)),x=j[0],O=j[1],w=(0,d.useState)(!1),V=w[0],Z=w[1],_=(0,d.useState)(void 0),W=_[0],F=_[1],R=k.concat(y).concat(C).map((function(e){return e.name})),A=function(e){F(e),Z(!V)};return d.createElement("div",{className:"state-set-container",style:{margin:"16px 24px"}},d.createElement(S,{projectId:n}),d.createElement("div",{className:"page-state-content"},d.createElement("div",{style:{width:278*(y.length+2)+"px",height:"100%"}},k.map((function(e,t){return d.createElement("div",{className:"start-item",key:t},d.createElement("div",{className:"text-area"},"\u5f00\u59cb\u72b6\u6001"),d.createElement("div",{className:"start-item-content"},d.createElement("div",{className:"start-item-state",style:{backgroundColor:""+N.n0.startStateColor}},d.createElement(g.default,{value:e.name,bordered:!1,maxLength:10,className:"text-area",onChange:function(e){c(e.target.value,t)},onPressEnter:function(e){v("startStateValue",t),e.target.blur()},onFocus:function(e){e.target.style.backgroundColor="#fff"},onBlur:function(n){n.target.style.backgroundColor="transparent",c(e.oldName,t)}}))))})),d.createElement("div",{id:"itxst",style:{display:"flex"}},y.map((function(e,t){return d.createElement("div",{className:"mid-item",key:e.id+"+"+t,"data-id":e.id},d.createElement("div",{className:"text-area"},"\u8fdb\u884c\u4e2d\u7684\u72b6\u6001",y.length<5&&d.createElement(E.Z,{style:{fontSize:16,color:"#1890ff",marginLeft:"10px"},onClick:function(){A(e.id)}})),d.createElement("div",{className:"mid-item-content"},d.createElement("div",{className:"mid-item-state",style:{display:"flex"}},d.createElement(g.default,{value:e.name,bordered:!1,maxLength:10,className:"text-area",style:{color:"#0090FF"},onFocus:function(e){e.target.style.backgroundColor="#fff",(document.ondragstart=function(){return!1})()},onBlur:function(n){n.target.style.backgroundColor="transparent",s(e.oldName,t),(document.ondragstart=function(){return!0})()},onChange:function(e){s(e.target.value,t)},onPressEnter:function(e){v("ingStateValue",t),e.target.blur(e)}}),y.length>1&&d.createElement("div",{className:"more"},d.createElement(p.default,{overlayClassName:"del_dropdown",overlay:d.createElement(h.default,null,d.createElement(h.default.Item,null,d.createElement("p",{style:{cursor:"pointer"},onClick:function(){!function(e){b(y[e].id).then((function(t){if(t){var n=x.concat();n[e]=!1,O(n),o.Z.confirm({title:"\u5220\u9664\u72b6\u6001",icon:d.createElement(u.Z,{style:{color:"#FF7955"}}),content:"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u8be5\u72b6\u6001\u5417\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){m(e)}})}else o.Z.info({title:"\u5220\u9664\u72b6\u6001",icon:d.createElement(u.Z,{style:{color:"#FF7955"}}),content:"\u5f53\u524d\u9879\u76ee\u4e2d\u6709\u5de5\u5355\u5904\u4e8e\u8be5\u72b6\u6001\uff0c\u8bf7\u5148\u786e\u4fdd\u6ca1\u6709\u5de5\u5355\u5728\u8be5\u72b6\u6001\u4e0b\uff0c\u518d\u5220\u9664\u8be5\u72b6\u6001"})})).catch((function(e){o.Z.info({title:"\u5220\u9664\u72b6\u6001",icon:d.createElement(u.Z,{style:{color:"#FF7955"}}),content:"\u5f53\u524d\u9879\u76ee\u4e2d\u6709\u5de5\u5355\u5904\u4e8e\u8be5\u72b6\u6001\uff0c\u8bf7\u5148\u786e\u4fdd\u6ca1\u6709\u5de5\u5355\u5728\u8be5\u72b6\u6001\u4e0b\uff0c\u518d\u5220\u9664\u8be5\u72b6\u6001"})}))}(t)}},"\u5220\u9664\u72b6\u6001")))},d.createElement("span",null,"...")))),d.createElement("div",{className:"desc"},d.createElement("p",{style:{marginBottom:"10px"}},"\u5f53\u72b6\u6001\u53d8\u66f4\u5230\u300c",e.name,"\u300d\u5fc5\u987b\u586b\u5199\u4ee5\u4e0b\u5b57\u6bb5,\u4e0d\u662f\u5fc5\u586b\u5219\u4e0d\u53d7\u9650\u5236"),d.createElement(f.default,{style:{fontSize:"12px"},defaultChecked:e.isRemark,onChange:function(t){l(t.target.checked,e)}},"\u5907\u6ce8"))))}))),C.map((function(e,t){return d.createElement("div",{className:"end-item",key:t},d.createElement("div",{className:"text-area"},"\u7ed3\u675f\u72b6\u6001"),d.createElement("div",{className:"end-item-content"},d.createElement("div",{className:"end-item-state"},d.createElement(g.default,{value:e.name,bordered:!1,maxLength:10,className:"text-area",onChange:function(e){i(e.target.value,t)},onPressEnter:function(e){v("endStateValue",t),e.target.blur()},onFocus:function(e){e.target.style.backgroundColor="#fff"},onBlur:function(n){n.target.style.backgroundColor="transparent",i(e.oldName,t)}})),d.createElement("div",{className:"desc"},d.createElement("p",{style:{marginBottom:"10px"}},"\u5f53\u72b6\u6001\u53d8\u66f4\u5230\u300c",e.name,"\u300d\u5fc5\u987b\u586b\u5199\u4ee5\u4e0b\u5b57\u6bb5,\u4e0d\u662f\u5fc5\u586b\u5219\u4e0d\u53d7\u9650\u5236"),d.createElement(f.default,{style:{fontSize:"12px"},defaultChecked:e.isRemark,onChange:function(t){l(t.target.checked,e)}},"\u5907\u6ce8"))))})),d.createElement("div",null),d.createElement("div",null))),d.createElement(I,{isShow:V,allNames:R,addState:A,activedID:W,handleAddStateItem:a}))};var b=n(51474),j=n(35239),x=function(e){function t(t){var n;return(n=e.call(this,t)||this).events=void 0,n.state={projectId:j.t.get(j.V.curProject).id,startStateValue:[],ingStateValue:[],endStateValue:[]},n.events={handleAddStateItem:n._addStateItem.bind((0,l.Z)(n)),handOnChangeStartName:n._onChangeStartName.bind((0,l.Z)(n)),handOnChangeEndName:n._onChangeEndName.bind((0,l.Z)(n)),handOnChangeIngName:n._onChangeIngName.bind((0,l.Z)(n)),handOnChangeRemark:n._onChangeRemark.bind((0,l.Z)(n)),handleDeleteItem:n._deleteItem.bind((0,l.Z)(n)),handleStatusUpdate:n._submitStatusUpdate.bind((0,l.Z)(n)),getWorkOrderStatusChecked:n._getWorkOrderStatusChecked.bind((0,l.Z)(n))},n}(0,i.Z)(t,e);var n=t.prototype;return n._getWorkOrderStatusChecked=function(e){var t=this;return new Promise((function(n,a){(function(e){var t=e.projectId,n=e.id;return k.h.get("/workorder/work-order-status/check?id="+n+"&projectId="+t)})({projectId:t.state.projectId,id:e}).then((function(e){2e4===e.data.code&&e.data.result?n(!0):a(!1)})).catch((function(e){a(!1)}))}))},n.getWorkOrderStatusUpdate=function(e){var t=this;(function(e){var t=e.projectId,n=e.id,a=e.isRemark,r=e.name,o=e.state,c=e.rank;return k.h.put("/workorder/work-order-status/update",{projectId:t,id:n,isRemark:a,name:r,state:o,rank:c})})({projectId:this.state.projectId,id:e.id,isRemark:e.isRemark,name:e.name,state:e.state,rank:e.rank}).then((function(e){t.getWorkOrderStatusList()})).catch((function(e){c.default.error("\u5df2\u5b58\u5728\u76f8\u540c\u7684\u72b6\u6001\u540d\u79f0\uff0c\u8bf7\u7528\u5176\u5b83\u540d\u79f0")}))},n.getWorkOrderStatusAdd=function(e){var t=this;return function(e){var t=e.projectId,n=e.name,a=e.id;return k.h.post("/workorder/work-order-status/add",{projectId:t,name:n,id:a})}({projectId:this.state.projectId,name:e.name,id:e.id}).then((function(e){2e4===e.data.code&&t.getWorkOrderStatusList()}))},n.getWorkOrderStatusDelete=function(e){return function(e){var t=e.id,n=e.projectId;return k.h.delete("/workorder/work-order-status/delete/"+t+"?projectId="+n)}({projectId:this.state.projectId,id:e})},n.getWorkOrderStatusSort=function(e){return function(e){var t=e.projectId,n=e.workOrderStatusIds;return k.h.put("/workorder/work-order-status/sort",{projectId:t,workOrderStatusIds:n})}({projectId:this.state.projectId,workOrderStatusIds:e})},n.getWorkOrderStatusList=function(){var e=this;(function(e){var t=e.projectId;return k.h.get("/workorder/work-order-status/list?projectId="+t,{})})({projectId:this.state.projectId}).then((function(t){if(2e4===t.data.code){var n=t.data.result.filter((function(e){return e.oldName=e.name,"PENDING"===e.kind})),a=t.data.result.filter((function(e){return e.oldName=e.name,"PROCESSING"===e.kind})),r=t.data.result.filter((function(e){return e.oldName=e.name,"FINISHED"===e.kind}));e.setState({startStateValue:n,ingStateValue:a,endStateValue:r})}}))},n._onChangeRemark=function(e,t){t.isRemark=!!e,t.name="",this.getWorkOrderStatusUpdate(t)},n._onChangeStartName=function(e,t){var n=this.state.startStateValue;n[t].name=e,this.setState({startStateValue:n})},n._submitStatusUpdate=function(e,t){var n=this.state,a={startStateValue:n.startStateValue,ingStateValue:n.ingStateValue,endStateValue:n.endStateValue};this.getWorkOrderStatusUpdate(a[e][t])},n._onChangeIngName=function(e,t){var n=this.state.ingStateValue;n[t].name=e,this.setState({ingStateValue:n})},n._onChangeEndName=function(e,t){var n=this.state.endStateValue;n[t].name=e,this.setState({endStateValue:n})},n._addStateItem=function(e){this.getWorkOrderStatusAdd(e)},n._deleteItem=function(e){var t=this,n=this.state.ingStateValue;this.getWorkOrderStatusDelete(n[e].id).then((function(e){t.getWorkOrderStatusList()})).catch((function(e){o.Z.info({title:"\u5220\u9664\u72b6\u6001",icon:d.createElement(u.Z,{style:{color:"#FF7955"}}),content:"\u5f53\u524d\u9879\u76ee\u4e2d\u6709\u5de5\u5355\u5904\u4e8e\u8be5\u72b6\u6001\uff0c\u8bf7\u5148\u786e\u4fdd\u6ca1\u6709\u5de5\u5355\u5728\u8be5\u72b6\u6001\u4e0b\uff0c\u518d\u5220\u9664\u8be5\u72b6\u6001"})}))},n.componentDidMount=function(){var e=this;this.getWorkOrderStatusList();var t=document.getElementById("itxst"),n={animation:1e3,onEnd:function(t){var n=e.state,r=n.endStateValue,o=n.startStateValue,c=a.toArray().map((function(e){return{id:Number(e)}})),l=o.map((function(e){return{id:e.id}})),i=r.map((function(e){return{id:e.id}}));e.getWorkOrderStatusSort(l.concat(c).concat(i))}},a=b.default.create(t,n)},n.componentWillUnmount=function(){},n.render=function(){return d.createElement("div",{className:"page-workorde-state"},d.createElement(s.Z,{title:(0,m.u)({title:"\u5de5\u5355\u72b6\u6001\u914d\u7f6e",url:""}),overlay:"\u5de5\u5355\u72b6\u6001\u5206\u4e3a3\u79cd\u7c7b\u522b\uff1a\u5f00\u59cb\u72b6\u6001\u3001\u8fdb\u884c\u4e2d\u7684\u72b6\u6001\u3001\u7ed3\u675f\u72b6\u6001\u3002\u89c4\u5b9a\u53ea\u67091\u4e2a\u5f00\u59cb\u72b6\u6001\uff0c1\u4e2a\u7ed3\u675f\u72b6\u6001\uff0c\u8fdb\u884c\u4e2d\u7684\u72b6\u6001\u6700\u591a\u8bbe\u7f6e5\u4e2a\uff0c\u4f46\u81f3\u5c11\u4fdd\u75591\u4e2a\u3002"}),d.createElement(C,(0,r.Z)({},this.props,this.state,this.events)))},t}(d.Component);const O=x},55815:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),r=n(67294),o=n(45697),c=n.n(o),l=n(43036),i=n(61409),d=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this)._handleBreadcrumbClick=function(e){var n=t.props,a=n.title,r=n.beforeJump;e!==a.length-1&&(r?new Promise((function(e,t){return r(e,t)})).then((function(){i.mW.push({pathname:a[e].url,state:a[e].state})})):i.mW.push({pathname:a[e].url,state:a[e].state}))},t}return(0,a.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,a=t.mainTitle,o=t.rightContent,c=t.className,i=t.overlay;return r.createElement("div",{className:"breadcumb-wrapper "+c},n instanceof Array?r.createElement("div",{className:"breadcrumb-left"},r.createElement("div",null,n.map((function(t,a){return r.createElement("span",{className:t.url?"":"not_clickable",key:a,onClick:function(){return t.url&&a!==n.length-1&&e._handleBreadcrumbClick(a)}},t.title,a!==n.length-1&&" / ")}))),r.createElement("span",null,a||n[n.length-1].title,i&&r.createElement(l.Z,{placement:"top",overlay:i},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):r.createElement("div",{className:"normal-title"},n,i&&r.createElement(l.Z,{placement:"top",overlay:i},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),o||"")},t}(r.Component);d.propTypes={className:c().string,title:c().oneOfType([c().string,c().arrayOf(c().shape({title:c().string,url:c().string,state:c().object}))]).isRequired,overlay:c().oneOfType([c().string,c().node]),mainTitle:c().oneOfType([c().string,c().node]),beforeJump:c().func,rightContent:c().node};const u=d}}]);