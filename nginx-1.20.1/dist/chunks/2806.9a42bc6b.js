"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2806],{72806:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var r=n(15861),a=n(94578),i=n(87757),c=n.n(i),l=n(67294),o=n(61409),u=n(30381),s=n.n(u),m=n(49722),p=function(e,t){return e&&e[t]?e[t]:""};function d(e,t){var n=0;if(document.defaultView&&document.defaultView.getComputedStyle&&e)n=document.defaultView.getComputedStyle(e,"").getPropertyValue(t),n=Number(n.replace(/px/g,""));else if(null!=e&&e.currentStyle){var r=t.replace(/\\-(\w)/g,(function(e,t){return t.toUpperCase()}));n=e.currentStyle[r],n=Number(n.replace(/px/g,""))}return n}var g=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPriceInfo=(0,r.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getSettingData();case 2:m.h.post("/price/warning/token/find",{token:n.state.token}).then((function(e){document.querySelector("title").innerText=e.data.result.name,n.setState({compareType:e.data.result.compareType,data:e.data.result,remind:"YES"===e.data.result.remindRepetition},n.setHeight)}));case 3:case"end":return e.stop()}}),e)}))),n.getSettingData=(0,r.Z)(c().mark((function e(){var t,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state.token,e.next=3,m.h.post("/price/warning/setting/get",{token:t});case 3:r=e.sent;try{a=JSON.parse(r.data.result.detailTitle),n.setState({activeDetail:a[0]||{}})}catch(i){}case 5:case"end":return e.stop()}}),e)}))),n.setHeight=function(){var e=d(document.querySelector(".warning-notice"),"padding-top"),t=d(document.querySelector(".monitoring-price"),"margin-top"),r=document.querySelector(".info").getBoundingClientRect(),a=document.querySelector(".warning-button").getBoundingClientRect(),i=document.querySelector(".more").getBoundingClientRect(),c=document.querySelector(".title").getBoundingClientRect(),l=document.documentElement.clientHeight-r.height-2*e-a.height-i.height-2*t-c.height-10;n.setState({contentHeight:l})},n.changeRemind=function(){m.h.post("/price/warning/token/change/remind",{token:n.state.token,remindRepetition:n.state.remind?"NO":"YES"}).then((function(e){n.setState({remind:!n.state.remind,alert:!1})}))},n.handleClick=function(e){var t=n.state,r=t.token,a=t.data.compareResult,i=t.compareType;if("chart"===e||"list"===e)if(a.length>0){var c;if("PRODUCT"===i){var l=a.map((function(e){return[e.v1.ctime,e.v2.ctime]}));c=l.flat(2).reduce((function(e,t){return new Date(t)>new Date(e)?t:e}),l.flat(2)[0])}else c=a.reduce((function(e,t){return new Date(t.ctime)>new Date(e)?t.ctime:e}),a[0].ctime);o.mW.push("/weChatPush/"+e+"?token="+r+"&breakBackTime="+encodeURIComponent(c))}else o.mW.push("/weChatPush/"+e+"?token="+r);else if("back"===e){var u=n.props.location.query,s=u.listToken,m=u.listTime,p=u.type,d="/warningNoticeList?token="+s+"&sendDate="+m;p&&(d+="&type="+p),o.mW.push(d)}else{var g=n.state.data;o.mW.push("/weChatPush/"+e+"?alertValue="+g.warningPrice+"&alertType="+g.priceCompareType+"&compareType="+g.compareType+"&warningType="+g.warningType+"&token="+r)}},n.state={token:"",date:"",data:{},compareType:null,remind:"",alert:!1,showTopicMore:!1,activeDetail:{},contentHeight:150},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e,t=this;this.setState({title:document.querySelector("title").innerText});var n=this.props.location.query.token,r=null==(e=this.props.location.query)?void 0:e.sendDate;this.setState({token:n,date:r},(function(e){return t.getPriceInfo()})),document.querySelector("body").style.backgroundColor="#F8F8F8",document.querySelector("body").style.overflow="auto"},n.componentWillUnmount=function(){document.querySelector("title").innerText=this.state.title,document.querySelector("body").style.backgroundColor="unset",document.querySelector("body").style.overflow="unset"},n.renderMonitoringPrice=function(){var e=this,t=this.state,n=t.data,r=t.activeDetail,a=t.contentHeight,i=t.date,c="GT"===n.priceCompareType?"\u9ad8\u4e8e":"LT"===n.priceCompareType?"\u4f4e\u4e8e":"";"BREAK_BACK_PRICE"===n.warningType&&(c="BREAK"===n.breakBackType?"\u4f4e\u4e8e":"\u9ad8\u4e8e");var o=60*n.compareResult.length>a;return l.createElement("div",{className:"monitoring-price"},l.createElement("p",{className:"title"},"\u76d1\u63a7\u5546\u54c1\u4ef7\u683c",c,l.createElement("span",null,"\xa0",n.warningPrice)),l.createElement("div",{style:o?{height:a+"px",overflowY:"scroll"}:{}},l.createElement("ul",null,n.compareResult.map((function(e,t){var a=e.configDetailVoList.find((function(e){return"\u5e97\u94fa"===e.topicTypeValue})),i=e.configDetailVoList.find((function(e){return e.topicTypeValue===r.name}));return l.createElement("li",{key:t},l.createElement("div",{className:"left"},l.createElement("p",null,"\n                  "+(i?i.topicValue:"")+"\n                  "),l.createElement("p",null,"\n                  "+(e.sourceName?e.sourceName:"")+"\n                   | \n                  "+(a?a.topicValue:"")+"\n                  ")),l.createElement("div",{className:"right"},l.createElement("p",{className:"right_price"},e.takePrice,l.createElement("span",{style:{color:e.takePrice-n.warningPrice>0?"#15B374":"#D96969"}},"("+(e.takePrice-n.warningPrice>0?"+":"")+(Number.isInteger(e.takePrice-n.warningPrice)?e.takePrice-n.warningPrice:(e.takePrice-n.warningPrice).toFixed(2))+")")),l.createElement("p",{className:"right_time"},"\u4ef7\u683c\u91c7\u96c6\u65f6\u95f4\uff1a",s()(e.ctime).format("YYYY/MM/DD HH:mm:ss"))))})))),l.createElement("p",{className:"more"},l.createElement("span",null,"\u9884\u8b66\u63a8\u9001\u65f6\u95f4\uff1a",s()(i).format("YYYY/MM/DD HH:mm:ss")),l.createElement("span",{onClick:function(t){return e.handleClick("list")}},"\u67e5\u770b\u66f4\u591a ",l.createElement("i",null," ",">"," ")),l.createElement("span",null,"\u5171 ",n.total||n.compareResult.length," \u6761\uff0c")))},n.renderComparePrice=function(){var e=this,t=this.state,n=t.data,r=t.date;return l.createElement("div",{className:"compare-price"},l.createElement("p",{className:"title"},l.createElement("span",null,"\u76d1\u63a7\u5546\u54c1"),l.createElement("span",null,"GT"===n.priceCompareType?"\u4ef7\u683c\u9ad8\u4e8e":"LT"===n.priceCompareType?"\u4ef7\u683c\u4f4e\u4e8e":"\u5dee\u4ef7\u9ad8\u4e8e",l.createElement("br",null),l.createElement("i",null,n.warningPrice)),l.createElement("span",null,"\u6bd4\u4ef7\u5546\u54c1")),l.createElement("ul",null,n.compareResult.slice(0,2).map((function(e,t){var n=e.v1.configDetailVoList.find((function(e){return"\u578b\u53f7"===e.topicTypeValue})),r=e.v1.sourceName,a=e.v2.configDetailVoList.find((function(e){return"\u578b\u53f7"===e.topicTypeValue})),i=e.v2.sourceName;return l.createElement("li",{key:t},l.createElement("div",{className:"left"},l.createElement("p",null,n?n.topicValue:""),l.createElement("p",null,e.v1.takePrice,l.createElement("span",{style:{color:e.v1.takePrice-e.v2.takePrice>0?"#15B374":"#D96969"}},"(",(e.v1.takePrice-e.v2.takePrice>0?"+":"")+(e.v1.takePrice-e.v2.takePrice),")")),l.createElement("p",null,"\n                  "+r+"\n                   \n                  "+p(e.v1.configDetailVoList[4],"topicValue")+"\n                   \n                  "+p(e.v1.configDetailVoList[2],"topicValue")+"\n                  ")),l.createElement("div",{className:"line"},"-"),l.createElement("div",{className:"right"},l.createElement("p",null,a?a.topicValue:""),l.createElement("p",null,e.v2.takePrice),l.createElement("p",null,"\n                  "+i+"\n                   \n                  "+p(e.v2.configDetailVoList[4],"topicValue")+"\n                   \n                  "+p(e.v2.configDetailVoList[2],"topicValue")+"\n                  ")))})),l.createElement("li",{className:"bottom more"},l.createElement("span",null,r),l.createElement("span",{onClick:function(t){return e.handleClick("list")}},"\u67e5\u770b\u66f4\u591a ",l.createElement("i",null," ",">"," ")),l.createElement("span",null,"\u5171 ",n.total||n.compareResult.length," \u6761\uff0c"))))},n.render=function(){var e=this,t=this.state,n=t.data,r=t.compareType,a=(t.alert,t.remind,t.showTopicMore),i=this.props.location.query.listToken;return l.createElement("div",{className:"warning-notice"},l.createElement("div",{className:"info"},n.filter&&l.createElement(l.Fragment,null,l.createElement("ul",null,n.filter.map((function(e,t){return l.createElement("li",{key:t,style:{display:t<=2||t>2&&a?"block":"none"}},l.createElement("span",null,e.name),l.createElement("span",{className:"wrap"},e.values.map((function(t,n){return l.createElement("span",{key:n},t.name+(n===e.values.length-1?"":"\uff0c"))}))))}))),l.createElement("div",{className:"topic_more",style:{display:n.filter.length>3&&!a?"block":"none"},onClick:function(){return e.setState({showTopicMore:!0})}},"\u5c55\u5f00\u66f4\u591a",l.createElement("i",{className:"icon-cem_pull-down-or-take-up"})))),"PRODUCT"===r?this.renderComparePrice():"PRICE"===r&&this.renderMonitoringPrice(),l.createElement("ul",{className:"warning-button"},l.createElement("li",{onClick:function(){return e.handleClick("thresholdValue")}},l.createElement("i",{className:"icon-cem_warning-value-modification"}),"\u9884\u8b66\u503c\u4fee\u6539"),i&&l.createElement("li",{onClick:function(){return e.handleClick("back")}},l.createElement("i",{className:"icon-cem_return"}),"\u8fd4\u56de\u63d0\u9192\u5217\u8868"),l.createElement("li",{onClick:function(){return e.handleClick("chart")}},l.createElement("i",{className:"icon-cem_price-monitoring-chart"}),"\u4ef7\u683c\u76d1\u63a7\u56fe\u8868")))},t}(l.Component)}}]);