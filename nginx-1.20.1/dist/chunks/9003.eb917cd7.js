"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[9003],{17958:(e,t,n)=>{n.r(t),n.d(t,{default:()=>nt});var a=n(87462),i=n(94578),r=n(67294),o=n(43144),s=n(45697),l=n.n(s),c=n(92360),d=n(5133),u=n(29383),p=n(49722),f=n(95814),h=function(e){function t(t){var n;return(n=e.call(this,t)||this).inputChange=function(e){n.setState({inputVal:e.target.value})},n.keywordChange=function(e){var t=n.state,a=t.inputVal,i=t.inputValMap;"keydown"===e.type&&13===e.keyCode||"keydown"===e.type&&32===e.keyCode||"blur"===e.type?a.trim()&&(i.push(a.trim()),n.setState({inputValMap:i,inputVal:""}),n.onChange()):"keydown"===e.type&&8===e.keyCode||e.type},n.delKeyWords=function(e){var t=n.state.inputValMap;t.splice(e,1),n.setState({inputValMap:t},(function(e){return n.onChange()}))},n.onChange=function(){n.props.onChange&&n.props.onChange(n.state.inputValMap)},n.state={inputValMap:t.values?t.values:[],inputVal:""},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillReceiveProps=function(e,t){e.values&&this.setState({inputValMap:e.values})},n.render=function(){var e=this,t=this.state,n=t.inputValMap,a=t.inputVal,i=this.props,o=i.style,s=i.close;return r.createElement("div",{className:"word-segmentation",style:o||{}},s&&r.createElement("i",{className:"close",onClick:s},"\xd7"),r.createElement("div",{className:"input-wrap"},r.createElement("input",{type:"text",className:"keyword-setting",value:a,placeholder:"\u5173\u952e\u8bcd(\u8f93\u5165\u7a7a\u683c\u952e\u6216\u56de\u8f66\u4ee5\u5206\u8bcd)",onChange:this.inputChange,onBlur:this.keywordChange,onKeyDown:this.keywordChange})),n.map((function(t,n){return r.createElement("span",{className:"word",key:t+n},t,r.createElement("i",{onClick:function(){return e.delKeyWords(n)}},"\xd7"))})))},t}(r.Component);const m=h;var g=n(43036),v=n(35239),y=function(e,t,n,a,i,r){return p.h.post("/filter/expand/add",{name:e,copy:t,id:n,model:a,projectId:i,filter:r})};const C=function(e){function t(t){var n;return(n=e.call(this,t)||this).editTopic=function(e){n.editing=e,n.refs.changeNameInput.refs.input.value=e.name,n.setState({dialogVisible:!0})},n.delTopic=function(e){c.MessageBox.confirm("\u786e\u8ba4\u5220\u9664\u8be5\u7ec4\u5408\u5206\u6790, \u662f\u5426\u7ee7\u7eed?","\u63d0\u793a",{type:"warning"}).then((function(){p.h.post("/filter/delete",{id:e.id}).then((function(t){n.props.onChange(null,{id:e.id}),2e4===t.data.code?d.Z.success("\u5220\u9664\u6210\u529f"):d.Z.error("\u5220\u9664\u5931\u8d25")}))})).catch((function(){}))},n.getExpandTopicValue=function(e){return p.h.post("/filter/expand/findFilter",{id:e})},n.competeOpen=function(){n.refs.topics.offsetHeight>45?n.setState({showOpen:!0}):n.setState({showOpen:!1})},n._handleChangeName=function(){var e=n.refs.changeNameInput.refs.input.value;n.getExpandTopicValue(n.editing.id).then((function(t){var a=t.data.result;y(e,!1,a.id,n.props.model,v.t.get(v.V.curProject).id,JSON.parse(a.filter)).then((function(e){var t=e.data;2e4===t.code&&(d.Z.success("\u7ec4\u5408\u5206\u6790\u540d\u79f0\u4fee\u6539\u6210\u529f"),n.refs.changeNameInput.refs.input.value="",n.setState({dialogVisible:!1},(function(){return n.props.fresh(a.id,{name:t.result.name,id:t.result.id})})))}))}))},n.renderDialog=function(){return r.createElement(c.Dialog,{title:"\u4fee\u6539\u540d\u79f0",className:"change-name-dialog",size:"tiny",modal:!1,visible:n.state.dialogVisible,onCancel:function(e){return n.setState({dialogVisible:!1})}},r.createElement(c.Dialog.Body,null,r.createElement(c.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",ref:"changeNameInput"})),r.createElement(c.Dialog.Footer,null,r.createElement(c.Button,{type:"primary",onClick:n._handleChangeName},"\u786e\u5b9a"),r.createElement(c.Button,{type:"default",onClick:function(e){return n.setState({dialogVisible:!1})}},"\u53d6\u6d88")))},n.state={list:t.list?t.list:[],value:t.value?t.value:{},showOpen:!1,open:!1,dialogVisible:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillReceiveProps=function(e,t){(e.value||e.list)&&(this.setState({value:e.value,list:e.list}),this.competeOpen())},n.componentDidMount=function(){this.competeOpen()},n.render=function(){var e=this,t=this.state,n=t.list,a=t.showOpen,i=t.open,o=t.value,s=this.props,l=s.close,c=s.onChange;return r.createElement("div",{className:"expand-topic",style:{height:i?"":"38px"}},r.createElement("p",{className:"name"},"\u7ec4\u5408\u5206\u6790",r.createElement(g.Z,{overlay:r.createElement("div",{style:{width:"220px"}},"\u4f60\u53ef\u4ee5\u57fa\u4e8e\u7b5b\u9009\u6761\u4ef6\u751f\u6210\u4e00\u4e2a\u7ec4\u5408\u7684\u5206\u6790\u5bf9\u8c61\u3002\u5728\u5207\u6362\u5206\u6790\u5bf9\u8c61\u65f6\u4f60\u53ef\u4ee5\u4ece\u201c\u7ec4\u5408\u5206\u6790\u201d\u4e2d\u4f7f\u7528\u4f60\u521b\u5efa\u7684\u7ec4\u5408\u5206\u6790\u5bf9\u8c61\u3002"),placement:"top"},r.createElement("i",{className:"icon-cem_file1 hide",style:{color:"#8c8c8c"}}))),r.createElement("div",{className:"topics",ref:"topics"},r.createElement("div",{className:"more"},a&&r.createElement("i",{className:"open",onClick:function(t){return e.setState({open:!i})}},i?"\u6536\u8d77":"\u66f4\u591a",r.createElement("i",{className:i?"icon-cem_pull-or-take-up":"icon-cem_pull-down-or-take-up"})),l&&r.createElement("i",{className:"closeAll",onClick:l},"\xd7")),r.createElement("div",{className:"topic-wrap"},n.length>0?n.map((function(t,n){return r.createElement("span",{className:"topic "+(o.id===t.id?"sel":""),key:t+n},r.createElement(g.Z,{placement:"top",overlay:"\u5355\u51fb\u7f16\u8f91"},r.createElement("span",{onClick:function(e){return c&&c({id:t.id,name:t.name})}},t.name)),r.createElement(g.Z,{placement:"top",overlay:"\u91cd\u547d\u540d"},r.createElement("i",{onClick:function(n){return e.editTopic(t)},className:"icon-cem_screening-editor"})),r.createElement(g.Z,{placement:"top",overlay:"\u5220\u9664"},r.createElement("i",{onClick:function(){return e.delTopic(t)},className:"icon-cem icon-cem_delete"})))})):r.createElement("div",{style:{color:"#262626",lineHeight:"38px"}},"\u6682\u65e0\u4e3b\u9898\u503c"))),this.renderDialog())},t}(r.Component);var E=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={defaultChecked:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.setState((0,a.Z)({},this.props))},n.componentWillReceiveProps=function(e){this.setState((0,a.Z)({},e))},n.handleClick=function(e){var t=this.state,n=t.type,a=t.defaultChecked,i=t.selectedList,r=t.totalList;if("checkAll"===n)a?this.props.onChange([]):this.props.onChange(r);else{var o=i.indexOf(e);o>-1?i.splice(o,1):i.push(e),this.props.onChange(i)}this.setState({defaultChecked:!a})},n.render=function(){var e=this,t=this.state,n=t.type,a=t.defaultChecked,i=t.indeterminate,o=t.uniqueId,s="customized-checkobx";return a?s="customized-checkobx checked":"checkAll"===n&&i&&(s="customized-checkobx indeterminate"),r.createElement("div",{className:"customized-checkobx-wrapper"},r.createElement("div",{className:s,onClick:function(t){t.stopPropagation(),e.handleClick(o)}}))},t}(r.PureComponent);function S(e,t){var n,a,i,r;function o(e,t){var n;if(isNaN(e)&&isNaN(t)&&"number"===typeof e&&"number"===typeof t)return!0;if(e===t)return!0;if("function"===typeof e&&"function"===typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;if(i.indexOf(e)>-1||r.indexOf(t)>-1)return!1;for(n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!==typeof e[n])return!1}for(n in e){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!==typeof e[n])return!1;switch(typeof e[n]){case"object":case"function":if(i.push(e),r.push(t),!o(e[n],t[n]))return!1;i.pop(),r.pop();break;default:if(e[n]!==t[n])return!1}}return!0}if(arguments.length<1)return!0;for(n=1,a=arguments.length;n<a;n++)if(i=[],r=[],!o(arguments[0],arguments[n]))return!1;return!0}var O=n(39432),k=!0,N=function(e){function t(t){var n;return(n=e.call(this,t)||this).init=function(){n.setState((0,a.Z)({},n.props),(function(){n.state.show&&n.fetchData()}))},n.switchPage=function(e){n.setState({pageNum:e},(function(){return n.fetchData()}))},n.switchPageSize=function(e){n.setState({pageSize:e,pageIndex:1},(function(){return n.fetchData()}))},n.handleCheck=function(e){for(var t=n.state,a=t.currPageList,i=t.selectedList,r=e.length-1;r>=0;r--)-1===i.indexOf(e[r])&&i.push(e[r]);for(var o=a.length-1;o>=0;o--)if(-1===e.indexOf(a[o].id)){var s=i.indexOf(a[o].id);s>-1&&i.splice(s,1)}n.setState({currPageSelectedList:e,selectedList:i},(function(){return n.handleCheckboxStyle()}))},n.handleCheckboxStyle=function(){var e=n.state,t=e.currPageSelectedList,a=e.currPageList,i=e.checkAllStatus;if(t.length===a.length&&a.length>0)i.checked=!0,a.forEach((function(e){e.checked=!0;var t=document.getElementById(e.id);t&&t.classList.add("item-active")}));else{0===t.length?(i.indeterminate=!1,a.map((function(e){e.checked=!1;var t=document.getElementById(e.id);return t&&t.classList.remove("item-active"),e}))):i.indeterminate=!0,i.checked=!1;for(var r=a.length-1;r>=0;r--){for(var o=!1,s=t.length-1;s>=0;s--)if(t[s]===a[r].id){o=!0,a[r].checked=!0;var l=document.getElementById(a[r].id);l&&l.addClass("item-active");break}if(!o){a[r].checked=!1;var c=document.getElementById(a[r].id);c&&c.classList.remove("item-active")}}}n.setState({currPageList:a,checkAllStatus:i})},n.handleChange=function(e){n.setState({keywords:e})},n.handleKeyUp=function(e){13===e.keyCode&&n.setState({selectedList:[],pageNum:1},(function(){return n.fetchData()}))},n.handleSort=function(e){var t=e.prop,a=e.order;n.setState({sortName:t||"createdAt",sortType:a||"descending",selectedList:[],pageNum:1},(function(){return n.fetchData()}))},n.state={show:!1,queryParams:null,keywords:"",sortName:"createdAt",sortType:"descending",currPageList:[],currPageSelectedList:[],selectedList:[],pageNum:1,pageSize:20,data:[],totalRecords:0,checkAllStatus:{checked:!1,indeterminate:!1},loading:!1,columns:[{label:"",width:16,prop:"paddingLeft"},{label:"",width:56,renderHeader:function(){return r.createElement(E,{type:"checkAll",defaultChecked:n.state.checkAllStatus.checked,indeterminate:n.state.checkAllStatus.indeterminate,onChange:n.handleCheck,selectedList:n.state.currPageSelectedList,totalList:n.state.currPageList.map((function(e){return e.id}))})},render:function(e){return r.createElement(E,{type:"checkOne",defaultChecked:e.checked||!1,onChange:n.handleCheck,selectedList:n.state.currPageSelectedList,totalList:n.state.currPageList.map((function(e){return e.id})),uniqueId:e.id})}},{label:"\u94fe\u63a5\u540d\u79f0",render:function(e){var t=e.name,n=e.url;return r.createElement("div",{className:"ellipsis",title:t,onClick:function(e){e.stopPropagation(),n.startsWith("http")&&window.open(n)}},t)}},{label:"\u603b\u6570\u636e\u91cf",prop:"total",render:function(e){var t=e.total;return r.createElement("div",null,O.ZP.formatNumber(t))}},{label:"\u521b\u5efa\u65f6\u95f4",sortable:"custom",prop:"createdAt",render:function(e){var t=e.createdAt;return r.createElement("div",null,t&&t.replace("T"," "))}},{label:"",width:16,prop:"paddingRight"}]},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.init()},n.UNSAFE_componentWillReceiveProps=function(e){var t=this,n=e.queryParams&&e.queryParams.filterModel,i=this.state.queryParams&&this.state.queryParams.filterModel;S((0,a.Z)({},i,{connections:[]}),(0,a.Z)({},n,{connections:[]}))||function(){var n=t.props.show;t.setState((0,a.Z)({},e,{pageNum:1}),(function(){n?t.setState({pageNum:1,selectedList:[]},(function(){return t.fetchData()})):t.setState({pageNum:1},(function(){return t.fetchData()}))}))}(),e.show!==this.state.show&&this.setState({show:e.show})},n.fetchData=function(){var e=this,t=this.state,n=t.keywords,i=t.queryParams,r=t.sortName,o=t.sortType,s=t.pageNum,l=t.pageSize,c=t.defaultValue,d=this.state,u=d.currPageList,f=d.currPageSelectedList,h=d.selectedList,m=d.totalRecords;k&&c[0]&&c[0].values.length>0&&(i.filterModel.connections=c[0].values);var g=void 0,y=window.location.pathname;/^\/price/.test(y)&&(g="PRICE"),this.setState({loading:!0},(function(){p.h.post("/filter/connection/search",(0,a.Z)({projectId:v.t.get(v.V.curProject).id},i,{name:n,sortName:r,sort:o,pageIndex:s,pageSize:l,queryType:g})).then((function(t){if(200===t.status||304===t.status){var n=t.data.result;u=n.list,f=[];for(var a=u.length-1;a>=0;a--)h.indexOf(u[a].id)>-1?(u[a].checked=!0,f.push(u[a].id)):u[a].checked=!1;m=n.count,k&&c[0]&&c[0].values.length>0&&(f=c[0].values,h=c[0].values,k=!1),e.setState({currPageList:u,currPageSelectedList:f,selectedList:h,totalRecords:m,data:n},(function(){return e.handleCheckboxStyle()}))}})).finally((function(){e.setState({loading:!1})}))}))},n.getValue=function(){return this.state.selectedList},n.render=function(){var e=this,t=this.state,n=t.show,a=t.currPageList,i=t.currPageSelectedList,o=t.pageNum,s=t.pageSize,l=t.totalRecords,d=t.loading,p=t.columns;return r.createElement("div",{className:"advanced-filter-wrapper",style:{display:n?"block":"none"}},r.createElement("div",{className:"advanced-filter-body"},r.createElement(c.Input,{ref:function(t){return e.searchInput=t},placeholder:"\u8bf7\u8f93\u5165\u94fe\u63a5\u540d\u79f0",onChange:this.handleChange,onKeyUp:this.handleKeyUp,icon:"search"}),r.createElement(c.Loading,{loading:d},r.createElement(u.Z,{className:"connection-table",maxHeight:306,columns:p,data:a,total:l,currentPage:o,pageSize:s,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,onPage:this.switchPage,onSortChange:this.handleSort,rowClassName:function(e){return i.includes(e.id)?"item-active":""},notLimit:!1}))))},t}(r.Component),T=n(61193),b=n(61409),I=n(97189),w=function(e){function t(t){var n;return(n=e.call(this,t)||this).getFilter=function(){var e=n.state,t=e.filterListShow,a=e.filterListHide,i=n.props,r=i.type,o=i.filter,s=i.getTitles,l=[];return p.h.post("/filter/find",{type:r||"INBOX",filterTypes:o,projectId:n.state.projectId}).then((function(e){return l=n.formatData(e.data.result),s&&s(JSON.parse(JSON.stringify(l))),t=JSON.parse(JSON.stringify(l.slice(0,4))),a=JSON.parse(JSON.stringify(l.slice(4))),n.setState({allList:l,filterListShow:t,filterListHide:a},(function(e){return n.reFilterList(n.state.value,(function(e){n.sortList(n.saveList)}))})),e}))},n.handleChangeSel=function(e,t,a){var i=n.state.value;if(!i.some((function(n){return n.id===e.id&&(n.values=t,a&&a.length>0&&(n.secondValue=a.map((function(t){return{fatherId:e.child.id,id:t.id,values:t.values}}))),!0)}))){var r={id:e.id,special:e.special,values:t};a&&a.length>0&&(r.secondValue=a.map((function(t){return{fatherId:e.child.id,id:t.id,values:t.values}}))),i.push(r)}n.reFilterList(i,(function(e){n.onChange()}))},n.keyWordChange=function(e,t){var a=n.state.value;0===e.length?a.splice(a.findIndex((function(e){return e.id===t.id})),1):a.some((function(n){if(n.id===t.id)return n.values=e,!0}))||a.push({id:t.id,special:t.special,values:e}),n.setState({value:a},(function(e){return n.onChange()}))},n.expandTopicChange=function(e,t,a){if(t)n.updateExpandTopic(t.id,t.value);else{if(e.id===n.state.expandTopic.id&&!a)return void n.reFilterList([],(function(e){return n.setState({expandTopic:{id:"",name:"",value:[]}},(function(e){n.sortList(),n.props.onExpandTopicChange&&n.props.onExpandTopicChange(n.state.expandTopic)}))}));n.refs.expandTopic.getExpandTopicValue(e.id).then((function(t){var a=x(JSON.parse(t.data.result.filter));n.reFilterList(a,(function(t){return n.setState({expandTopic:{id:e.id,name:e.name,value:a}},(function(e){n.sortList(),n.props.onExpandTopicChange&&n.props.onExpandTopicChange(n.state.expandTopic)}))}))}))}},n.getExpandTopicData=function(){return n.state.expandTopic.id?n.state.expandTopic:null},n.isExpandTopicChanged=function(){return!S(n.state.value.filter((function(e){return"connections"!==e.special})),n.state.expandTopic.value.filter((function(e){return"connections"!==e.special})))},n.updateExpandTopic=function(e,t){var a=n.state.allList;a.some((function(n){if("expandTopic"===n.special)return e?(n.values.splice(n.values.findIndex((function(t){return t.id===e})),1),t&&n.values.unshift(t)):n.values.unshift(t),!0})),n.setState({allList:a},(function(e){return n.reFilterList(n.state.value,n.saveList)}))},n.saveList=function(){if(-1===location.pathname.indexOf("inbox")){var e=n.getFilterList(),t=n.getValue(),i=[],r=[];e.forEach((function(e){e.child&&e.child.values.length>0&&i.push((0,a.Z)({},e.child,{special:"connConfig"}))})),t.forEach((function(e){e.secondValue&&e.secondValue.length>0&&r.push({id:e.secondValue[0].fatherId,values:e.secondValue.reduce((function(e,t){return e.concat(t.values)}),[])})})),e=(e=e.filter((function(e){return!["KEY_WORD"].includes(e.special)}))).concat(e.splice(e.findIndex((function(e){return"expandTopic"===e.special})),1)),v.t.set(v.V.filterList,JSON.stringify({list:e.concat(i),value:t.concat(r)}));var o=new Event("setItemEvent");o.key="filter-list",window.dispatchEvent(o)}},n.onChange=function(){n.props.onFilterChange&&n.props.onFilterChange(n.getReFormatValue())},n.renderCheckBox=function(e,t){var a=n.state,i=a.searchInfo,o=a.value,s=o.filter((function(t){return t.id===e.id}))[0]?o.filter((function(t){return t.id===e.id}))[0].values:[],l=o.filter((function(t){return t.id===e.id}))[0]&&o.filter((function(t){return t.id===e.id}))[0].secondValue?o.filter((function(t){return t.id===e.id}))[0].secondValue:[],c=i.id===e.id?e.values.filter((function(e){return-1!==e.name.toLowerCase().indexOf(i.keyword.toLowerCase())})):e.values;return e.values.length>0?r.createElement(f.Z,{key:t,checkedList:s,secondInfo:e.child,secondValue:l,data:c,allListLength:e.values.length,changeState:function(t,a){return n.handleChangeSel(e,t,a)},onSearch:function(t){return n.setState({searchInfo:{isSearching:!0,id:e.id,name:e.name,keyword:""}})},title:e.name,close:function(e){return n.delFilter(t)}}):null},n.toggleAdvancedFilter=function(){n.setState({advancedFilterShow:!n.state.advancedFilterShow})},n.closeAdvancedFilter=function(){n.setState({advancedFilterShow:!1})},n.state={value:n.props.value||[],allList:[],reFilterData:[],filterListShow:[],filterListHide:[],searchInfo:{isSearching:!1,name:"",id:"",keyword:""},expandTopic:{id:"",name:"",value:[]},loading:!1,projectId:v.t.get(v.V.curProject).id,advancedFilterShow:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.formatData=function(e){var t=[];e.topics&&e.topics.titles&&e.topics.titles.length>0&&(this.setState({reFilterData:e.topics.data}),t.push.apply(t,e.topics.titles.filter((function(e){return e.special="connConfig",e.values.length>1})))),e.source&&e.source.length>0&&t.push({id:"source",name:"\u6570\u636e\u6765\u6e90",special:"source",values:e.source}),e.tag&&e.tag.length>0&&e.tag.forEach((function(e){e.special="tag",t.push(e)})),this.props.filterConfig&&this.props.filterConfig.forEach((function(e){switch(e){case"ESCORE":t.push({id:"escore",special:"escore",name:"\u60c5\u611f",values:[{id:"1",name:"\u6b63\u9762"},{id:"0",name:"\u4e2d\u6027"},{id:"-1",name:"\u8d1f\u9762"}]});break;case"MESSAGE_TYPE":t.push({id:"messageType",special:"messageType",name:"\u6d88\u606f\u7c7b\u578b",values:[{id:"PL",name:"\u8bc4\u8bba"},{id:"ZP",name:"\u8ffd\u8bc4"},{id:"TW",name:"\u63d0\u95ee"},{id:"HD",name:"\u56de\u7b54"},{id:"SX",name:"\u79c1\u4fe1"},{id:"YW",name:"\u539f\u6587"},{id:"HF",name:"\u56de\u590d"},{id:"KH",name:"\u5ba2\u670d\u56de\u590d"},{id:"DSWT",name:"\u7535\u5546\u95ee\u9898"},{id:"DSDA",name:"\u7535\u5546\u7b54\u6848"}]});break;case"KEY_WORD":t.push({id:"KEY_WORD",special:"content",name:"\u5173\u952e\u8bcd",values:[]})}})),e.expandTopics&&t.push({id:"expandTopic",name:"\u7ec4\u5408\u5206\u6790",special:"expandTopic",values:e.expandTopics});var n=t.map((function(e){return(0,a.Z)({},e,{values:e.values.length>0?(0,O.QM)(e.values):e.values})}));return JSON.parse(JSON.stringify(n))},n.sortList=function(e){for(var t=JSON.parse(JSON.stringify(this.state)),n=t.value,a=t.filterListHide,i=t.filterListShow,r=i.length;r--;)i[r]&&!n.some((function(e){return e.id===i[r].id}))&&"expandTopic"!==i[r].special&&a.unshift(i.splice(r,1)[0]);n.forEach((function(e){a.forEach((function(t,n){e.id===t.id&&i.push(a.splice(n,1)[0])}))})),i.length<4&&(i=i.concat(a.splice(0,4-i.length))),this.setState({filterListHide:a,filterListShow:i},(function(t){return e&&e()}))},n.addMoreFilter=function(e){var t=this,n=this.state,a=n.filterListShow,i=n.filterListHide;a.push.apply(a,i.splice(e,1)),this.setState({filterListShow:a,filterListHide:i},(function(){t.reFilterList(t.state.value)}))},n.delFilter=function(e){var t=this,n=this.state,a=n.filterListShow,i=n.filterListHide,r=n.value;r=r.filter((function(t){return t.id!==a[e].id})),i.push.apply(i,a.splice(e,1)),this.setState({filterListShow:a,filterListHide:i},(function(e){return t.reFilterList(r,t.onChange)}))},n.closeExpandTopic=function(e){var t=this.state,n=t.filterListShow,a=t.filterListHide;a.push.apply(a,n.splice(n.findIndex((function(e){return"expandTopic"===e.id})),1)),this.setState({filterListShow:n,filterListHide:a})},n.reFilterList=function(e,t){var n=this.state,a=n.reFilterData,i=n.allList,r=n.filterListShow,o=n.filterListHide;if(0!==i.length){i=JSON.parse(JSON.stringify(i)),e=JSON.parse(JSON.stringify(e.filter((function(e){return e.values.length>0})))).map((function(e,t){return e.index=t,e}));var s=JSON.parse(JSON.stringify(e));i.forEach((function(t){e.forEach((function(e){t.id===e.id&&(t.index=e.index)}))}));for(var l=function(){var e=[],t=s.shift(),n=i.filter((function(e){return e.id===t.id}));"connConfig"===t.special&&t.values.length!==(n.length>0?n[0].values.length:0)&&function(){for(var n=[],o=function(e){t.values.forEach((function(t){a[e].map((function(e){return e.id})).includes(t)&&(n=n.concat(a[e]))}))},s=0;s<a.length;s++)o(s);var l=(0,I.uniqueArray)(n.map((function(e){return e.id})));i.forEach((function(n){var a={name:n.name,values:[],id:n.id,special:n.special};void 0!==n.index&&(a.index=n.index);(new Date).getTime();t.id===n.id||void 0!==n.index&&t.index>n.index||"connConfig"!==n.special||!r.map((function(e){return e.id})).includes(n.id)?a.values=n.values:function(){for(var e=l.slice(),t=function(t){e.some((function(a,i){return a===n.values[t].id&&(e.splice(i,1),!0)}))&&a.values.push(n.values[t])},i=0;i<n.values.length;i++)t(i)}(),e.push(a)})),i=JSON.parse(JSON.stringify(e))}()};s.length;)l();i.forEach((function(t){e.forEach((function(e){t.id===e.id&&"connConfig"===e.special&&(e.values=e.values.filter((function(e){return-1!==t.values.map((function(e){return e.id})).indexOf(e)})))}))})),i.forEach((function(e){r.forEach((function(t){e.id===t.id&&(t.values=e.values)})),o.forEach((function(t){e.id===t.id&&(t.values=e.values)}))})),e.forEach((function(e){return delete e.index})),this.setState({filterListShow:r,filterListHide:o,value:e},(function(e){return t&&t()}))}},n.getValue=function(){return this.state.value},n.getReFormatValue=function(){var e=this.state.value,t={},n=function(e){e.secondValue&&e.secondValue.length>0&&e.secondValue.forEach((function(n){t[e.special].some((function(e){var t;return e.id===n.fatherId&&((t=e.values).push.apply(t,n.values),e.values=Array.from(new Set(e.values)),!0)}))||t[e.special].push({id:n.fatherId,values:n.values,special:e.special})}))};return JSON.parse(JSON.stringify(e)).forEach((function(e){t[e.special]?(t[e.special].push({id:e.id,values:e.values,special:e.special}),n(e)):(t[e.special]=[{id:e.id,values:e.values,special:e.special}],n(e))})),t.source&&(t.source=t.source[0].values),t.content&&(t.content=[{contain:t.content[0].values}]),t.escore&&(t.escore=t.escore[0].values),t.messageType&&(t.messageType=t.messageType[0].values),this.refs.advancedFilter&&this.refs.advancedFilter.getValue().length>0&&(t.connections=this.refs.advancedFilter.getValue()),t},n.getFullValue=function(){var e=this.state,t=e.filterListShow,n=e.value,a=[];return t.forEach((function(e){n.forEach((function(t){if(e.id===t.id&&t.values.length>0&&"KEY_WORD"!==t.id){var n=[];e.values.forEach((function(e){t.values.forEach((function(t){e.id===t&&n.push(e)}))})),a.push({id:e.id,name:e.name,values:n})}else if("KEY_WORD"===t.id&&!a.some((function(e){return"KEY_WORD"===e.id}))){var i=[];t.values.forEach((function(e){return i.push({name:e})})),a.push({id:t.id,name:"\u5173\u952e\u8bcd",values:i})}}))})),a},n.getFilterList=function(){return JSON.parse(JSON.stringify(this.state.filterListShow.concat(this.state.filterListHide)))},n.componentWillReceiveProps=function(e){var t=this;this.state.expandTopic.id||(JSON.stringify(e.value)===JSON.stringify(this.state.value)?this.setState({value:e.value}):this.reFilterList(e.value,(function(){t.sortList(t.saveList)})))},n.componentDidMount=function(){this.props.noBottom&&this.getFilter()},n.componentWillUnmount=function(){},n.render=function(){var e=this,t=this.state,n=t.filterListShow,a=t.filterListHide,i=t.searchInfo,o=t.advancedFilterShow,s=t.expandTopic,l=t.value,d=this.props.style,u={filterModel:this.getReFormatValue()};return a.forEach((function(e,t){"KEY_WORD"===e.id&&n.push(a.splice(t,1)[0]),"expandTopic"===e.id&&a.push(a.splice(t,1)[0])})),n.forEach((function(e,t){"KEY_WORD"===e.id&&n.push(n.splice(t,1)[0]),"expandTopic"===e.id&&n.unshift(n.splice(t,1)[0])})),r.createElement("div",{className:"filter-condition-wrap",style:d||{}},i.isSearching&&r.createElement("div",{className:"filter-search-wrap"},r.createElement("div",{className:"search"},r.createElement("span",null,r.createElement("i",{className:"icon-cem_search"}),r.createElement("span",null,i.name+":")),r.createElement("input",{placeholder:"\u8bf7\u8f93\u5165\u641c\u7d22\u8bcd",autoFocus:!0,value:i.keyword,onInput:function(t){e.setState({searchInfo:{isSearching:!0,id:i.id,name:i.name,keyword:t.target.value}})}})),r.createElement("i",{className:"icon-cem_delete del",onClick:function(t){return e.setState({searchInfo:{isSearching:!1,id:"",name:"",keyword:""}})}})),r.createElement(c.Loading,{loading:this.state.loading},r.createElement("div",{className:"filter-condition"},n.map((function(t,n){switch(t.id){case"KEY_WORD":return r.createElement("div",{className:"key-word-wrap",key:n},r.createElement("span",{className:"key-word-title"},"\u5173\u952e\u8bcd"),r.createElement(m,{style:{width:"calc(100% - 108px)"},values:l.filter((function(e){return e.id===t.id}))[0]?l.filter((function(e){return e.id===t.id}))[0].values:[],onChange:function(n){return e.keyWordChange(n,t)}}));case"expandTopic":return r.createElement(C,{ref:"expandTopic",close:function(t){return e.closeExpandTopic(n)},onChange:e.expandTopicChange,value:s,key:n,list:t.values,fresh:e.updateExpandTopic,model:e.props.model});default:return e.renderCheckBox(t,n)}})),a.length>0&&r.createElement("div",{className:"more-filter bottom-line"},r.createElement("span",{className:"title"},"\u6dfb\u52a0\u7b5b\u9009"),r.createElement("div",null,a.filter((function(e){return"connConfig"!==e.special||e.values.length>0})).map((function(t,n){return r.createElement("span",{key:n,className:"filter-card",onClick:function(t){return e.addMoreFilter(n)}},t.name+" +")})))))),T.Z.hasAuthority("CONNECTION_SEARCH")&&r.createElement(N,{ref:"advancedFilter",show:o,queryParams:u,defaultValue:l.filter((function(e){return"connections"===e.special}))}),!this.props.noBottom&&r.createElement("div",{className:"bottom"},r.createElement("ul",{className:"handle"},r.createElement("li",null,r.createElement("span",{className:"filter"},this.props.count," \u4e2a\u94fe\u63a5\u7b26\u5408\u6761\u4ef6")),l.length>0&&r.createElement("li",null,r.createElement("span",{className:"clear",onClick:function(t){return e.setState({value:[]},(function(t){return e.reFilterList(e.state.value,(function(t){e.onChange()}))}))}},"\u6e05\u7a7a\u9009\u9879"))),T.Z.hasAuthority("CONNECTION_SEARCH")&&r.createElement("span",{className:"advancedFilter",onClick:function(){return e.toggleAdvancedFilter()}},r.createElement("span",null,"\u9ad8\u7ea7\u7b5b\u9009"),r.createElement("i",{className:"icon-cem_screening-for-more",style:{transform:o?"":"rotate(-180deg)",top:o?"3px":""}})),r.createElement(c.Button,{type:"primary",onClick:function(t){e.saveList(),e.closeAdvancedFilter(),s.id&&e.expandTopicChange(s,null,!0),setTimeout((function(t){return e.props.onConfirm&&e.props.onConfirm()}),0)}},"\u786e\u5b9a"),r.createElement(c.Button,{onClick:function(t){s.id&&e.expandTopicChange(s),e.props.onCancel&&e.props.onCancel()}},"\u53d6\u6d88")))},t}(r.Component),x=function(e){var t=[];return Object.keys(e).forEach((function(n){"connConfig"===n||"tag"===n?e[n]&&e[n].forEach((function(e){t.push((0,a.Z)({},e,{special:n}))})):"source"===n||"escore"===n||"messageType"===n||"content"===n?e[n]&&t.push({id:"content"!==n?n:"KEY_WORD",special:n,values:"content"!==n?e[n]:e[n][0].contain}):"connections"===n&&e[n]&&t.push({id:n,special:n,values:e[n]})})),t};w.propTypes={style:l().object,value:l().array,filter:l().array,filterConfig:l().array,onFilterChange:l().func,onExpandTopicChange:l().func,onConfirm:l().func,onCancel:l().func,count:l().oneOfType([l().number,l().string]),type:l().string,noBottom:l().bool};var D=n(30381),L=n.n(D),F=n(58341),A=["\u5feb\u6377\u65f6\u95f4\u7b5b\u9009\u5668","\u56fa\u5b9a\u65f6\u95f4\u7b5b\u9009\u5668"],j=["\u4eca\u5929","\u6628\u5929","\u524d\u5929","\u8fd1365\u5929","\u672c\u5468","\u4e0a\u5468","\u8fd17\u5929","","\u672c\u6708","\u4e0a\u4e2a\u6708","\u8fd130\u5929","","\u672c\u5b63","\u4e0a\u4e2a\u5b63\u5ea6","\u8fd190\u5929","","\u4eca\u5e74","\u53bb\u5e74","\u8fd1180\u5929"],_="YYYY-MM-DD",R=["overview","product","service","marketing"],M="",V=function(e){var t=[];switch(e){case 0:t=[L()().format(_),L()().format(_)];break;case 1:t=[L()().subtract(1,"days").format(_),L()().subtract(1,"days").format(_)];break;case 2:t=[L()().subtract(2,"days").format(_),L()().subtract(2,"days").format(_)];break;case 3:t=[L()().subtract(364,"days").format(_),L()().format(_)];break;case 4:t=[L()().startOf("week").format(_),L()().format(_)];break;case 5:t=[L()().subtract(1,"weeks").startOf("week").format(_),L()().subtract(1,"weeks").endOf("week").format(_)];break;case 6:t=[L()().subtract(6,"days").format(_),L()().format(_)];break;case 8:t=[L()().startOf("month").format(_),L()().format(_)];break;case 9:t=[L()().subtract(1,"months").startOf("month").format(_),L()().subtract(1,"months").endOf("month").format(_)];break;case 10:t=[L()().subtract(29,"days").format(_),L()().format(_)];break;case 12:t=[L()().startOf("quarter").format(_),L()().format(_)];break;case 13:t=[L()().subtract(1,"quarters").startOf("quarter").format(_),L()().subtract(1,"quarters").endOf("quarter").format(_)];break;case 14:t=[L()().subtract(89,"days").format(_),L()().startOf("day").format(_)];break;case 16:t=[L()().startOf("year").format(_),L()().format(_)];break;case 17:t=[L()().subtract(1,"years").startOf("year").format(_),L()().subtract(1,"years").endOf("year").format(_)];break;case 18:t=[L()().subtract(179,"days").format(_),L()().format(_)]}return t},P=function(e){function t(t){var n;return(n=e.call(this,t)||this).getDateRange=function(e){n.setState({selectedDateRange:e})},n.handleClickQuickTime=function(e){var t=n.state,a=t.currSelector,i=t.staredQuickTimeChoice,r=V(e);n.setState({selectedQuickTimeChoice:e,selectedDateRange:r});var o={module:"ecommerceMonitor",currSelector:a,selectedQuickTimeChoice:e,staredQuickTimeChoice:i,value:[]};n.setDefaultValue(JSON.stringify(o))},n.state={show:!1,currSelector:0,selectedDateRange:[],selectedQuickTimeChoice:10,staredQuickTimeChoice:-1,params:t.params},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;document.querySelectorAll(".right ul li").forEach((function(t,n){7!==n&&11!==t&&15!==t&&(t.addEventListener("mouseover",(function(){return e.displayStar(t)})),t.addEventListener("mouseout",(function(){return e.hideStar(t)})))}))},n.UNSAFE_componentWillReceiveProps=function(e){var t=e.show,n=e.params;this.setState({show:t,params:n})},n.componentWillUnmount=function(){var e=this;document.querySelectorAll(".right ul li").forEach((function(t,n){7!==n&&11!==t&&15!==t&&(t.removeEventListener("mouseover",(function(){return e.displayStar(t)})),t.removeEventListener("mouseout",(function(){return e.hideStar(t)})))}))},n.displayStar=function(e){(0,I.hasClass)(e.children[0],"active")&&(e.children[1].getElementsByTagName("span")[0].style.display="inline-block")},n.hideStar=function(e){var t=e.children[1].getElementsByTagName("span")[0];(0,I.hasClass)(t,"star")||(t.style.display="none")},n.switchSlector=function(e){this.setState({currSelector:e})},n.getCurrDate=function(){var e=this.state,t=e.currSelector,n=e.selectedDateRange,a=e.selectedQuickTimeChoice,i=e.params,r=this.formatDate(2),o=n[0],s=n[1],l=L()(s,_).diff(L()(o,_),"days")+1;return{from:n[0],to:n[1],quickChoice:0===t?i&&i.quickChoice.indexOf("-")>-1?i.quickChoice:j[a]:r,dateGroupType:"DAY",numOfDays:l,remoteName:"cTime"}},n.clickStarIcon=function(e,t){e.stopPropagation();var n=this.state.staredQuickTimeChoice,a=this.state.selectedQuickTimeChoice;if(n!==t){if(-1!==n){var i=document.querySelectorAll(".right ul li")[n].children[1];(0,I.removeClass)(i,"star"),i.style.display="none"}n=t,(0,I.addClass)(e.target.parentNode,"star")}else n=-1,(0,I.removeClass)(e.target.parentNode,"star");this.setState({staredQuickTimeChoice:n});var r={module:"ecommerceMonitor",currSelector:0,selectedQuickTimeChoice:a,staredQuickTimeChoice:n,value:[]};this.setDefaultValue(JSON.stringify(r))},n.fetchDefaultValue=function(){var e=this,t=window.location.pathname.split("/")[1],n=R.indexOf(t)>-1?"insight":t;M="default-time-"+n;var a=[L()().subtract(29,"days").format(_),L()().format(_)];return p.h.post("/default/value/find",{key:M,projectId:v.t.get(v.V.curProject).id}).then((function(t){var n=JSON.parse(t.data.result),i=e.state.params;if(!n){var r=i?[i.from,i.to]:a;return e.setState({selectedDateRange:r}),{from:r[0],to:r[1],quickChoice:i?i.quickChoice:j[10],dateGroupType:"DAY",remoteName:"cTime"}}var o=n.currSelector,s=n.selectedQuickTimeChoice,l=n.staredQuickTimeChoice,c=(n.value,i&&-1===i.quickChoice.indexOf("-")?j.indexOf(i.quickChoice):l>-1?l:s),d=i?-1===i.quickChoice.indexOf("-")?V(c):[i.from,i.to]:V(l>-1?l:s);if(0===o)return e.setState({selectedQuickTimeChoice:c,staredQuickTimeChoice:l,selectedDateRange:d}),{from:d[0],to:d[1],quickChoice:i&&i.quickChoice.indexOf("-")>-1?i.quickChoice:j[c],dateGroupType:"DAY",remoteName:"cTime"}}))},n.setDefaultValue=function(e){p.h.post("/default/value/update",{key:M,projectId:v.t.get(v.V.curProject).id,value:e}).then((function(e){}))},n.clickConfirmBtn=function(){var e=this;this.state.selectedDateRange.length>0?this.setState({params:null,show:!1},(function(){return e.props.onChange(e.getCurrDate())})):d.Z.error("\u8bf7\u9009\u62e9\u65f6\u95f4\u8303\u56f4")},n.clickCancelBtn=function(){this.props.onCancel()},n.formatDate=function(e){for(var t=this.state.selectedDateRange,n="",a=0;a<t.length;a++){for(var i=t[a].split("-"),r=0;r<i.length;r++){if(0===r&&(n+=i[r]+(1===e?"\u5e74":".")),1===r){parseInt(i[r],10);n+=i[r]+(1===e?"\u6708":".")}if(2===r){parseInt(i[r],10);n+=i[r]+(1===e?"\u65e5":"")}}0===a&&(n+=" - ")}return n},n.render=function(){var e=this,t=this.state,n=t.show,a=t.currSelector,i=t.selectedDateRange,o=t.selectedQuickTimeChoice,s=t.staredQuickTimeChoice,l=this.formatDate(1);return r.createElement("div",{className:"time-picker-wrapper",style:{display:n?"block":"none"}},r.createElement("div",{className:"time-picker-body"},r.createElement("div",{className:"left"},r.createElement("ul",null,A.map((function(t,n){return r.createElement("li",{key:n,className:a===n?"active":"",onClick:function(){return e.switchSlector(n)}},t)})))),r.createElement("div",{className:"right"},r.createElement("ul",{style:{display:0===a?"block":"none"}},j.map((function(t,n){return r.createElement("li",{key:n,onClick:function(){return e.handleClickQuickTime(n)},style:{pointerEvents:[7,11,15].includes(n)?"none":"auto"}},r.createElement("span",{className:o===n?"active":""},t),r.createElement(c.Popover,{className:"time-picker-star-tooltip",trigger:"hover",placement:"top",width:"50",content:s===n?"\u53d6\u6d88\u9ed8\u8ba4":"\u8bbe\u4e3a\u9ed8\u8ba4"},r.createElement("span",{className:s===n?"star":"",onClick:function(t){return e.clickStarIcon(t,n)}},r.createElement("i",{className:"icon-cem icon-cem_star"}))))}))),r.createElement(F.Z,{getDateRange:this.getDateRange,style:{display:1===a?"block":"none"}}))),r.createElement("div",{className:"time-picker-footer"},r.createElement("span",null,"\u5f53\u524d\u9009\u62e9\u65f6\u95f4\uff1a"),i.length>0?r.createElement("span",null,l):null,r.createElement("div",null,r.createElement(c.Button,{type:"primary",onClick:function(){return e.clickConfirmBtn()}},"\u786e\u5b9a"),r.createElement(c.Button,{type:"default",onClick:function(){return e.clickCancelBtn()}},"\u53d6\u6d88"))))},t}(r.PureComponent);P.propTypes={show:l().bool,onChange:l().func};var Z=n(85151);function W(e){return p.h.post("/filter/find/save",{id:e})}function J(e,t,n){return p.h.post("/default/value/update",{key:e,projectId:t,value:n})}function B(e,t,n,a,i,r){return p.h.post("/filter/add",{name:e,copy:t,type:a,id:n,projectId:i,filter:r})}function q(e){return p.h.post("user/opinion/add",(0,a.Z)({},e))}var Y="empty";const H=function(e){function t(t){var n;return(n=e.call(this,t)||this).getSelectedFilterObj=function(){return n.state.selFilterObj},n._handleListSelect=function(e,t){e.stopPropagation(),n.props.onFilterChange(t),n.setState({selFilterObj:t})},n._handleListStar=function(e,t,a){e.stopPropagation(),n.lastStaredSaveId=t;var i=n.state,r=i.staredFilterId,o=i.savedKey,s=i.projectId,l=i.staredFilterIndex;if(r!==t){if(-1!==l){var c=document.querySelectorAll(".saved-condition-list .left .star")[l].children[1];(0,I.removeClass)(c,"star-active")}(0,I.addClass)(e.target.parentNode,"star-active")}else(0,I.removeClass)(e.target.parentNode,"star-active");n.setState({staredFilterIndex:a,staredFilterId:r===t?Y:t},(function(){J(o,s,n.state.staredFilterId).then((function(e){2e4!==e.data.code&&n.setState({staredFilterId:n.lastStaredSaveId})}))}))},n._handleOnEditClick=function(e,t){e.stopPropagation(),n.refs.saveNameInput.refs.input.value=t.name,n.setState({targetFilterObj:t,editDialogVisible:!0})},n._handleConfitionSaveConfirm=function(){var e=n.state,t=e.selFilterObj,a=e.projectId,i=e.targetFilterObj,r=n.props,o=r.model,s=r.onFilterRename;W(i.id).then((function(e){var r=e.data;if(2e4===r.code){var l=n.refs.saveNameInput.refs.input.value;s(t.name),B(l,!1,i.id,o,a,r.result.filter).then((function(e){2e4===e.data.code&&(d.Z.success("\u4fee\u6539\u6210\u529f"),n.setState({editDialogVisible:!1}),n.refresh(t.id))}))}}))},n._handleOnDeleteClick=function(e,t){e.stopPropagation(),n.setState({targetFilterObj:t,delDialogVisible:!0})},n._handleOnDeleteConfirm=function(e){e.stopPropagation();var t,a=n.state,i=a.targetFilterObj,r=a.savedKey,o=a.projectId,s=a.staredFilterId,l=a.filterList,c=a.selFilterObj,d=[(t=i.id,p.h.post("/filter/delete",{id:t,menuModel:{}}))];s===i.id&&d.push(J(r,o,Y)),Promise.all(d).then((function(e){2e4===e[0].data.code&&n.refresh(i.id===c.id?void 0:c.id)})),n.props.onFilterChange(i.id===c.id?l[0]:c)},n.renderDeleteDialog=function(){var e=n.state,t=e.selFilterObj,a=e.targetFilterObj;return r.createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},r.createElement(c.Dialog,{title:"\u5220\u9664",className:"delete-saved-confition-dialog",size:"tiny",modal:!1,visible:n.state.delDialogVisible,onMouseLeave:function(e){return e.stopPropagation()},onCancel:function(e){return n.setState({delDialogVisible:!1})}},r.createElement(c.Dialog.Body,null,r.createElement("span",null,a&&t&&t.id===a.id?"\u5220\u9664\u8be5\u7b5b\u9009\u5668\u540e\uff0c\u5f53\u524d\u9875\u9762\u7684\u7b5b\u9009\u5668\u5c06\u81ea\u52a8\u5207\u6362\u4e3a\u201d\u5168\u90e8\u6570\u636e\uff08\u9ed8\u8ba4\uff09\u201d\u7b5b\u9009\u5668\uff0c\u662f\u5426\u5220\u9664\uff1f":'\u662f\u5426\u5220\u9664"'+a.name+'"\u7b5b\u9009\u5668\uff1f')),r.createElement(c.Dialog.Footer,null,r.createElement(c.Button,{type:"primary",onClick:n._handleOnDeleteConfirm},"\u786e\u5b9a"),r.createElement(c.Button,{type:"default",onClick:function(e){return n.setState({delDialogVisible:!1})}},"\u53d6\u6d88"))))},n.renderEditDialog=function(){return r.createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},r.createElement(c.Dialog,{title:"\u4fee\u6539\u540d\u79f0",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:n.state.editDialogVisible,onCancel:function(e){return n.setState({editDialogVisible:!1})}},r.createElement(c.Dialog.Body,null,r.createElement(c.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",ref:"saveNameInput"})),r.createElement(c.Dialog.Footer,null,r.createElement(c.Button,{type:"primary",onClick:n._handleConfitionSaveConfirm},"\u786e\u5b9a"),r.createElement(c.Button,{type:"default",onClick:function(e){return n.setState({editDialogVisible:!1})}},"\u53d6\u6d88"))))},n.state={projectId:v.t.get(v.V.curProject).id,savedKey:t.model+"_SAVED_OBJ",filterList:void 0,selFilterObj:void 0,targetFilterObj:{},staredFilterId:Y,staredFilterIndex:-1,isEditing:!1,delDialogVisible:!1,editDialogVisible:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){},n.componentDidUpdate=function(e,t){this.state.filterList;this.props.show===e.show||this.props.show||this.setState({isEditing:!1,fullListShow:!1})},n.componentWillUnmount=function(){},n.refresh=function(e){var t=this,n=this.state,a=n.savedKey,i=n.projectId,r=(n.staredFilterId,this.props),o=r.model,s=(r.onFilterChange,r.shouldShowDefault),l=void 0,c=function(e,t){return p.h.post("/filter/list",{type:e,projectId:t})}(o,i),d=function(e,t){return p.h.post("/default/value/find",{key:e,projectId:t})}(a,i);return Promise.all([c,d]).then((function(n){var a,i,r,o,c=n[0].data;2e4===c.code&&(a=c.result.all).unshift({id:"default",name:"\u5168\u90e8\u6570\u636e\uff08\u9ed8\u8ba4\uff09"});var d=n[1].data;return 2e4===d.code&&(i=d.result||Y,r=s?-1:a.findIndex((function(e){return e.id===i})),e&&(o=a.findIndex((function(t){return t.id===e}))),l=o?a[o]:-1===r?a[0]:a[r]),t.setState({delDialogVisible:!1,selFilterObj:l,staredFilterIndex:r,filterList:a,staredFilterId:i,fullListShow:a.length>15&&t.state.fullListShow}),l}))},n.render=function(){var e=this.state,t=e.filterList,n=(e.selFilterObj,e.staredFilterId,e.isEditing,this.props);n.onFilterChange,n.show,t&&JSON.parse(JSON.stringify(t));return null},t}(r.Component);var z=function(e){var t=(JSON.parse(v.t.get(v.V.filterList))||{list:[]}).list;return Object.keys(e).reduce((function(n,i){var r=e[i],o=Object.prototype.toString.call(r);if("[object Array]"===o){var s=r[0],l=Object.prototype.toString.call(s);if("[object String]"===l){var c,d=t.find((function(e){return e.id===i}));return d?(0,a.Z)({},n,((c={})[d.name]=r.map((function(e){return d.values.find((function(t){return t.id===e})).name})).join("\uff0c"),c)):n}if("[object Object]"===l)return(0,a.Z)({},n,r.reduce((function(e,n){var i,r=t.find((function(e){return e.id===n.id}));return r?(0,a.Z)({},e,((i={})[r.name]=n.values.reduce((function(e,t){var n=r.values.find((function(e){return e.id===t}));return n?[].concat(e,[n.name]):e}),[]).join("\uff0c"),i)):e}),{}))}else if("[object Object]"===o){var u,p=t.find((function(e){return e.id===r.id}));return p?(0,a.Z)({},n,((u={})[p.name]=r.values.reduce((function(e,t){var n=p.values.find((function(e){return e.id===t}));return n?[].concat(e,[n.name]):e}),[]).join("\uff0c"),u)):n}return n}),{})},U=function(e){function t(t){var n;(n=e.call(this,t)||this).changeFilter=function(e){n.setState({selFilterId:e===n.state.selFilterId?null:e})},n.onConditionChange=function(e){var t=[];Object.keys(e).forEach((function(n){"tag"===n||"connConfig"===n?t=t.concat(e[n]):"source"!==n&&"escore"!==n&&"messageType"!==n&&"content"!==n||t.push({id:"content"!==n?n:"KEY_WORD",special:n,values:"content"!==n?e[n]:e[n][0].contain})}));var a=n.state.defFilterValue,i=!S(t.filter((function(e){return"connections"!==e.special})),a.filter((function(e){return"connections"!==e.special})));n.setState({isDefFilterChanged:i,filterConditionValue:n.refs.FilterCondition.getValue()},(function(e){n.getListCount()}))},n.onTimeChange=function(e){n.setState({time:n.refs.timePicker.getCurrDate()},(function(e){n.getListCount(),n.handleChange()}))},n.handleChange=function(){n.state.filterConditionValue;n.props.onChange&&n.props.onChange(n.getValue()),n.setState({selFilterId:null,detail:n.refs.FilterCondition.getFullValue()},(function(e){return n.competeInfoWidth()}))},n.competeInfoWidth=function(){if(n.refs.info){n.refs.info.style.whiteSpace="nowrap";var e=[];Array.from(n.refs.info.getElementsByClassName("detail-info")).forEach((function(t){t.style.width="unset",e.push(t.clientWidth),t.style.width="calc(100% - 88px)"}));var t=Math.max.apply(null,e),a=122;a+=t>700?700:t,n.refs.info.style.whiteSpace="normal",n.refs.info.style.width=a+"px"}},n.init=function(){var e=function(){var e=[n.refs.FilterCondition.getFilter()];n.state.showList.includes("time")&&e.push(n.refs.timePicker.fetchDefaultValue()),Promise.all(e).then((function(e){var t=n.state.filterConditionValue,a=n.refs.FilterCondition.state.allList.map((function(e){return e.values})).flat(1).map((function(e){return String(e.id)}));if(t.filter((function(e){return!["KEY_WORD"].includes(e.id)})).map((function(e){return e.values})).flat(1).some((function(e){return!a.includes(String(e))}))&&n.setState({showWarning:!0,filterConditionValue:[],detail:[]}),n.refs.timePicker){var i=e.filter((function(e){return e.dateGroupType}))[0];n.setState({time:i},(function(){n.getListCount()}))}else n.getListCount();e[2]&&n._handleOnFilterChange(e[2]),setTimeout((function(){return n.props.onFilterReady&&n.props.onFilterReady()}),0)}))};n.state.projectId?e():n.id=setInterval((function(){v.t.get(v.V.curProject).id&&(clearInterval(n.id),n.setState({projectId:v.t.get(v.V.curProject).id},(function(){e()})))}),50)},n._handleConfitionSave=function(e){n.setState({dialogType:e,saveNameDialogVisible:!0})},n._handleConfitionSaveAs=function(e){e.stopPropagation(),n.setState({dialogType:"saveAs",saveNameDialogVisible:!0})},n.handleSaveOpinion=function(){var e=n.state,t=e.dialogType,i=e.nameInputVal,r=n.props.currOpinonObj.id,o=i;n.setState({inputName:o});var s,l=v.t.get(v.V.curProject).id;if("save"===t)q({opinionTaskId:r,name:o,projectId:l}).then((function(e){if(2e4===e.data.code){var t=e.data.result;if(1===t.length){var a=t[0].id;d.Z.success("\u4fdd\u5b58\u6210\u529f"),n.props.refreshMenuList().then((function(e){window.location.href="/opinion/"+a})),n.setState({saveNameDialogVisible:!1,savedId:a}),n.props.updateCurrOpinonObj(),n.setState({nameInputVal:""})}else{for(var i="",r=n.state.savedOpinionName,s=0;s<t.length;s++)t[s].name===r&&(i=t[s].id);n.setState({savedId:i,opinionTaskList:t,deleteOpinionModalShow:!0,tempInputName:o,showWarning:!1})}}}));else if("rename"===t){var c=n.state.savedId,u="";u=3===location.pathname.split("/").length?location.pathname.split("/")[2]:c,(s={id:u,name:o},p.h.post("user/opinion/update",(0,a.Z)({},s))).then((function(e){2e4===e.data.code&&(d.Z.success("\u64cd\u4f5c\u6210\u529f"),n.props.refreshMenuList(),n.setState({savedOpinionName:o,saveNameDialogVisible:!1})),n.setState({nameInputVal:""})}))}},n.handleUpdate=function(){var e=n.props,t=e.currOpinonObj,i=e.currOpinonObj.id,r=n.state.savedOpinionName,o="";location.pathname.startsWith("/opinion/")&&(o=location.pathname.split("/")[2]);var s;(s={opinionTaskId:i,id:o},p.h.post("user/opinion/filter/update",(0,a.Z)({},s))).then((function(e){if(2e4===e.data.code){d.Z.success("\u66f4\u65b0\u6210\u529f");var a=JSON.parse(JSON.stringify(t));a.changed=!1,a.mode="rename",a.name=r,n.props.updateCurrOpinonObj(a),n.setState({showWarning:!1})}}))},n.handleClickOpinion=function(e){var t=n.state.selectedOpinionIds,a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),n.setState({selectedOpinionIds:t})},n.handleDeleteOpinion=function(){var e,t=n.state,i=t.selectedOpinionIds,r=t.inputName,o=n.props.currOpinonObj.id;(e={ids:i},p.h.post("user/opinion/delete",(0,a.Z)({},e))).then((function(e){if(2e4===e.data.code){n.setState({deleteOpinionModalShow:!1,selectedOpinionIds:[]});var t=v.t.get(v.V.curProject).id;q({opinionTaskId:o,name:r,projectId:t}).then((function(e){if(2e4===e.data.code){var t=e.data.result;if(1===t.length){var a=t[0].id;d.Z.success("\u64cd\u4f5c\u6210\u529f"),n.setState({saveNameDialogVisible:!1,savedOpinionName:"",savedId:a}),n.props.refreshMenuList().then((function(e){window.location.href="/opinion/"+a})),n.props.updateCurrOpinonObj(),n.setState({nameInputVal:""})}}}))}}))},n._handleOnFilterChange=function(e){if(n.setState({isDefFilterChanged:!1}),n.state.hasOutsideFilterValues){var t=K(n.props.values.filterModel);n.setState({filterObj:e,defFilterValue:t,filterConditionValue:JSON.parse(JSON.stringify(t))},(function(){n.handleChange()}))}else"default"!==e.id?W(e.id).then((function(t){var a=t.data,i=K(a.result.filter);2e4===a.code&&n.setState({filterObj:e,defFilterValue:i,filterConditionValue:JSON.parse(JSON.stringify(i)),detail:JSON.parse(JSON.stringify(i))},(function(){return n.handleChange()}))})):n.setState({filterObj:e,defFilterValue:[],detail:[],filterConditionValue:[]},(function(e){return n.handleChange()}))},n.handleRename=function(e){var t=n.state.filterObj;t.name=e,n.setState({filterObj:t})},n.onExpandTopicChange=function(e){n.setState({expandTopicData:e}),""===e.id&&n.setState({filterConditionValue:[],isDefFilterChanged:!1})},n._handleSaveExpandTopic=function(e){if(n.state.expandTopicData.id){var t=n.state.expandTopicData.name,a=n.state.expandTopicData.id,i=n.props.model,r=n.getValue();y(t,!1,a,i,n.state.projectId,r.filterModel).then((function(e){var t=e.data;2e4===t.code&&(d.Z.success("\u7ec4\u5408\u5206\u6790\u4fdd\u5b58\u6210\u529f"),n.refs.FilterCondition.updateExpandTopic(a,{name:t.result.name,id:t.result.id}),n.setState({dialogType:"save",expandTopicDialogVisible:!1}))}))}else n.setState({dialogType:"save",expandTopicDialogVisible:!0})},n._handleSaveAsExpandTopic=function(e){n.setState({dialogType:"saveAs",expandTopicDialogVisible:!0})},n._handleExpandTopicSaveConfirm=function(){var e=n.refs.saveExpandTopic.refs.input.value,t="saveAs"===n.state.dialogType,a=t?n.state.expandTopicData.id?n.state.expandTopicData.id:n.state.filterObj.id:null,i=n.props.model,r=n.getValue();y(e,t,a,i,n.state.projectId,r.filterModel).then((function(e){var t=e.data;2e4===t.code&&(d.Z.success("\u7ec4\u5408\u5206\u6790\u4fdd\u5b58\u6210\u529f"),n.refs.saveExpandTopic.refs.input.value="",n.refs.FilterCondition.updateExpandTopic(null,{name:t.result.name,id:t.result.id}),n.setState({dialogType:"save",expandTopicDialogVisible:!1}))}))},n._handlingOnComposition=function(){n.isCompositionHandling=!0},n._handleOnComposition=function(e){n.isCompositionHandling=!1,n.setState({nameInputVal:e.target.value.substring(0,14)})},n.renderDialog=function(){var e=n.state,t=e.savedOpinionName,a=e.nameInputVal,i=e.check;return r.createElement(c.Dialog,{title:"save"===n.state.dialogType?"\u4fdd\u5b58\u5178\u578b\u610f\u89c1":"\u91cd\u547d\u540d",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:n.state.saveNameDialogVisible,onCancel:function(e){return n.setState({saveNameDialogVisible:!1})}},r.createElement(c.Dialog.Body,null,r.createElement("div",{className:"form-item"},r.createElement("label",null,"\u540d\u79f0"),r.createElement(c.Input,{className:i&&a.length>=14?"error":"",placeholder:"\u8bf7\u8f93\u5165\u5178\u578b\u610f\u89c1\u540d\u79f0",defaultValue:t,maxLength:14,autoFocus:!0,onFocus:function(){return n.setState({check:!0})},onBlur:function(){return n.setState({check:!1})},onChange:function(e){!n.isCompositionHandling&&n.setState({nameInputVal:e.substring(0,14)})},onCompositionStart:n._handlingOnComposition,onCompositionUpdate:n._handlingOnComposition,onCompositionEnd:n._handleOnComposition}),i&&a.length>=14&&r.createElement("div",{className:"tip"},"\u63d0\u793a\uff1a\u6700\u591a\u53ea\u80fd\u8f93\u516514\u4e2a\u5b57\u7b26"))),r.createElement(c.Dialog.Footer,null,r.createElement("span",{className:"tips"},"*\u53ef\u4ee5\u4fdd\u5b585\u4e2a\u5178\u578b\u610f\u89c1\u8ba1\u7b97\u7ed3\u679c"),r.createElement(c.Button,{type:"primary",onClick:n.handleSaveOpinion},"\u786e\u5b9a"),r.createElement(c.Button,{type:"default",onClick:function(e){return n.setState({saveNameDialogVisible:!1})}},"\u53d6\u6d88")))},n.renderDeleteOpinionDialog=function(){var e="";if(location.pathname.startsWith("/opinion/")){var t=location.pathname.split("/")[2];e=t}var a=n.state,i=a.opinionTaskList,o=a.deleteOpinionModalShow,s=a.selectedOpinionIds,l=[{label:"\u8bf7\u9009\u62e9\u5220\u9664\u7684\u5bf9\u8c61",prop:"",align:"center",render:function(t){return r.createElement(Z.Jg,{value:t.id,disabled:!!e&&e===t.id,checked:s.includes(t.id),onChange:function(){return n.handleClickOpinion(t.id)}})}},{label:"\u540d\u79f0",prop:"name"},{label:"\u4fdd\u5b58\u65f6\u95f4",prop:"createdAt"}];return r.createElement(c.Dialog,{title:"\u63d0\u9192",className:"opinion-delete-dialog",size:"tiny",modal:!1,visible:o,onCancel:function(e){return n.setState({deleteOpinionModalShow:!1})}},r.createElement(c.Dialog.Body,null,r.createElement("div",{className:"delete-tips"},"\u6700\u591a\u4fdd\u5b585\u4e2a\u5178\u578b\u610f\u89c1\uff0c\u5982\u679c\u60f3\u8981\u4fdd\u5b58\u5f53\u524d\u5178\u578b\u610f\u89c1\uff0c\u8bf7\u4ece\u4ee5\u4e0b\u5217\u8868\u4e2d\u5148\u5220\u9664\u90e8\u5206\u5178\u578b\u610f\u89c1"),r.createElement(u.Z,{columns:l,data:i})),r.createElement(c.Dialog.Footer,null,r.createElement(c.Button,{type:"primary",onClick:n.handleDeleteOpinion},"\u786e\u5b9a"),r.createElement(c.Button,{type:"default",onClick:function(e){return n.setState({deleteOpinionModalShow:!1})}},"\u53d6\u6d88")))},n.renderExpandTopicDialog=function(){return r.createElement(c.Dialog,{title:"save"===n.state.dialogType?"\u4fdd\u5b58\u4e3a\u7ec4\u5408\u5206\u6790":"\u7ec4\u5408\u5206\u6790\u53e6\u5b58\u4e3a",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:n.state.expandTopicDialogVisible,onCancel:function(e){return n.setState({expandTopicDialogVisible:!1})}},r.createElement(c.Dialog.Body,null,r.createElement(c.Input,{className:"name-input",placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",ref:"saveExpandTopic"})),r.createElement(c.Dialog.Footer,null,r.createElement(c.Button,{type:"primary",onClick:n._handleExpandTopicSaveConfirm},"\u786e\u5b9a"),r.createElement(c.Button,{type:"default",onClick:function(e){return n.setState({expandTopicDialogVisible:!1})}},"\u53d6\u6d88")))};var i=t.values,o=i&&i.filterModel,s=o?K(i.filterModel):[];return n.state={hasOutsideFilterValues:o,showList:n.props.showList,selFilterId:n.props.defaultShow?n.props.defaultShow:null,filterConditionValue:s,expandTopicData:{},time:{},detail:o?z(i.filterModel):[],projectId:v.t.get(v.V.curProject).id,count:"",saveFilterVisible:!1,saveNameDialogVisible:!1,filterObj:void 0,defFilterValue:[],isDefFilterChanged:!1,dialogType:"save",deleteOpinionModalShow:!1,opinionTaskList:[],selectedOpinionIds:[],savedId:"",savedOpinionName:t.currOpinonObj.name,inputName:"",showWarning:!1,nameInputVal:""},n}(0,i.Z)(t,e);var n=t.prototype;return n.getListCount=function(){var e=this,t=this.getValue();if(t.dateFilter)t.dateFilter.dateGroupType=null;else{t.dateFilter={};var n=window.location.pathname;/^\/price/.test(n)&&(t.queryType="PRICE")}t.projectId=v.t.get(v.V.curProject).id,p.h.post("/filter/connection/find",t).then((function(t){e.setState({count:t.data.result.total})}))},n.getValue=function(){var e=this.props.showList,t={};return e.includes("condition")&&Object.assign(t,{filterModel:this.refs.FilterCondition?this.refs.FilterCondition.getReFormatValue():{}}),e.includes("time")&&(t.dateFilter=JSON.parse(JSON.stringify(this.state.time))),t},n.componentDidMount=function(){this.init()},n.UNSAFE_componentWillReceiveProps=function(e){var t=this,n=e.values,a=this.props.values;if(n&&n.filterModel&&!S(n,a)){var i=K(n.filterModel)||[];this.setState({filterConditionValue:i}),setTimeout((function(){t.refs.FilterCondition&&t.setState({detail:t.refs.FilterCondition.getFullValue()},(function(){return t.competeInfoWidth()}))}),2500),this.refs.timePicker&&this.refs.timePicker.fetchDefaultValue().then((function(e){setTimeout((function(){t.setState({time:e},(function(){t.getListCount()}))}),1e3)}))}if(!S(this.props.currOpinonObj,e.currOpinonObj)){e.currOpinonObj.name;if(this.hasUpdateName||!e.currOpinonObj.name)return;this.setState({savedOpinionName:e.currOpinonObj.name}),this.hasUpdateName=!0}},n._saveConfition=function(e,t,n){var i=this,r=this.state.filterObj,o=this.getValue(),s=this.props.model,l=this.state.projectId;B(e,t,n,s,l,(0,a.Z)({},o.filterModel)).then((function(t){var n=t.data;2e4===n.code&&(d.Z.success("\u7b5b\u9009\u6761\u4ef6\u4fdd\u5b58\u6210\u529f"),r.name=e,r.id=n.result.id,i.setState({dialogType:"save",saveNameDialogVisible:!1,filterObj:r},(function(){return i.refs.SavedConfition.refresh(n.result.id)})))})).catch((function(e){return console.log(e)}))},n.render=function(){var e=this,t=this.state,n=t.selFilterId,a=t.showList,i=t.filterConditionValue,o=t.expandTopicData,s=t.detail,l=t.count,c=(t.isDefFilterChanged,t.filterObj),d=t.saveFilterVisible,u=t.hasOutsideFilterValues,p=t.projectId,f=t.savedOpinionName,h=(t.dialogType,t.showWarning),m=this.list,g=this.props,v=g.filterCondition,y=g.title,C=g.model,E=g.values,S=g.currOpinonObj,O=(o.id?o.name:c&&c.name,E&&E.dateFilter?E.dateFilter:void 0);!!this.refs.FilterCondition&&this.refs.FilterCondition.isExpandTopicChanged();return p?r.createElement("div",{className:"filter-new"},r.createElement("div",{className:"wrap"},a.includes("opinion")&&r.createElement("div",{ref:"save-filter",className:"save-filter"},r.createElement("span",null,o.id?"\u7ec4\u5408\u5206\u6790\uff1a":this.hasOpinionId?"\u5178\u578b\u610f\u89c1\uff1a":"\u5178\u578b\u610f\u89c1"),r.createElement("div",{className:"save-filter-wrap"},r.createElement("span",{style:{cursor:"default"}},f),r.createElement(H,{shouldShowDefault:u,ref:"SavedConfition",show:d,model:C,onFilterChange:this._handleOnFilterChange,onFilterRename:this.handleRename}))),r.createElement("div",{className:"button-zone"},a.includes("opinion")&&!o.id&&r.createElement("div",null,S.changed&&r.createElement("span",{className:"modified"},"\u5df2\u4fee\u6539"),!this.hasOpinionId&&r.createElement("a",null,r.createElement("span",{className:"save",onClick:function(t){return e._handleConfitionSave("save")}},"\u4fdd\u5b58\u5178\u578b\u610f\u89c1")),this.hasOpinionId&&r.createElement("span",{className:"save",onClick:function(t){return e._handleConfitionSave("rename")},style:{marginLeft:"10px"}},"\u91cd\u547d\u540d"),this.hasOpinionId&&"update"===S.mode&&r.createElement("span",{className:"save",onClick:function(t){return e.handleUpdate()},style:{marginLeft:"10px"}},"\u66f4\u65b0"))),!o.id&&r.createElement("div",{className:"info"},r.createElement("span",{className:"detail"},"\u8be6\u60c5"),r.createElement("div",{className:"info-wrap"},r.createElement("div",null,"\u5f53\u524d\u9875\u9762\u7b5b\u9009\u6761\u4ef6"),s&&s.length>0?r.createElement("ul",{ref:"info"},s.map((function(e,t){return r.createElement("li",{key:t},r.createElement("div",{className:"name"},e.name),r.createElement("div",{className:"detail-info"},e.values&&e.values.slice(0,100).map((function(t,n){return r.createElement("span",{key:n},t.name+(n===e.values.length-1?"":"\uff0c"))}))))}))):r.createElement("div",{className:"noData"},"\u6682\u65e0\u7b5b\u9009\u5185\u5bb9"))),o.id&&r.createElement("div",{className:"info"},r.createElement("span",{className:"detail",onClick:function(){return e.refs.FilterCondition.expandTopicChange(e.state.expandTopicData)}},"\u5173\u95ed\u7f16\u8f91")),r.createElement("ul",{className:"all-filter-name-wrap"},m.filter((function(e){return a.includes(e.id)})).map((function(t){return r.createElement("li",{key:t.id,className:n===t.id?"sel":"",onClick:function(n){return e.changeFilter(t.id)}},r.createElement("i",{className:t.icon}),r.createElement("span",null,t.name),r.createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:n===t.id?"rotate(180deg) translateY(-1px)":""}}))})))),h&&"condition"===n&&r.createElement("div",{className:"msg_filter_tip"},r.createElement("i",{className:"icon-cem_warning"}),"\u7b5b\u9009\u5668\u4f7f\u7528\u7684\u67d0\u4e9b\u7b5b\u9009\u6761\u4ef6\u88ab\u5220\u9664\uff0c\u5df2\u4e0d\u53ef\u7528\uff0c\u9700\u8981\u4f60\u66f4\u65b0\u7b5b\u9009\u6761\u4ef6"),r.createElement(w,{style:{display:"condition"===n?"block":"none"},ref:"FilterCondition",value:i,type:C||"PRICE_WARNING",filter:v&&v.filter?v.filter:["CONN_CONFIG"],filterConfig:v&&v.filterConfig?v.filterConfig:[],onFilterChange:this.onConditionChange,onExpandTopicChange:this.onExpandTopicChange,onConfirm:this.handleChange,onCancel:function(t){return e.setState({selFilterId:null})},count:l}),a.includes("time")&&r.createElement("div",{className:"date"},r.createElement(P,{ref:"timePicker",show:"time"===n,onChange:this.onTimeChange,onCancel:function(t){return e.setState({selFilterId:null})},params:O})),this.renderDialog(),this.renderExpandTopicDialog(),this.renderDeleteOpinionDialog()):r.createElement("div",null)},(0,o.Z)(t,[{key:"list",get:function(){var e="\u65f6\u95f4";return this.state&&this.state.time.from&&(e=this.state.time.quickChoice?this.state.time.quickChoice:this.state.time.from.replace(/-/g,"/")+"-"+this.state.time.to.replace(/-/g,"/")),[{name:"\u7b5b\u9009",id:"condition",icon:"icon-cem_screen"},{name:e,id:"time",icon:"icon-cem_time-controller"}]}},{key:"hasOpinionId",get:function(){return location.pathname.match(/^\/opinion\/[0-9a-z]+/)}}]),t}(r.Component),K=function(e){var t=[];return Object.keys(e).forEach((function(n){"connConfig"===n||"tag"===n?e[n]&&e[n].forEach((function(e){t.push((0,a.Z)({},e,{special:n}))})):"source"===n||"escore"===n||"messageType"===n||"content"===n?e[n]&&t.push({id:"content"!==n?n:"KEY_WORD",special:n,values:"content"!==n?e[n]:e[n][0].contain}):"connections"===n&&e[n]&&t.push({id:n,special:n,values:e[n]})})),t};U.propTypes={title:l().oneOfType([l().string,l().node]),showList:l().array,defaultShow:l().string,filterCondition:l().shape({filter:l().array,filterConfig:l().array}),onChange:l().func,onFilterReady:l().func,model:l().string,values:l().object};var G=n(78327),Q=n(25713),X=n(94644),$=n(60496),ee=n(55609),te=n(15861),ne=n(87757),ae=n.n(ne);function ie(e){var t=e.projectId,n=e.filterModel,a=e.dateFilter;return p.h.post("/widget/data/find/ASPECT_TREND_LINE",{projectId:t,filterModel:n,dateFilter:a})}function re(e){var t=e.projectId,n=e.dateFilter,a=e.filterModel,i=e.analysisObject;return p.h.post("/analysis/data",{projectId:t,dateFilter:n,filterModel:a,analysisObject:i})}var oe=n(87219);function se(e){switch(e){case"connConfig":default:return"TARGET_ANALYSIS";case"source":return"TARGET_SOURCE_ANALYSIS";case"tag":return"TARGET_TAG_ANALYSIS";case"expandTopic":return"TARGET_EXPAND_TOPIC_ANALYSIS"}}const le=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).lineChartRef=r.createRef(),t.barChartRef=r.createRef(),t.fetchAspectLineData=function(e){var n=t.state,i=n.dateType,r=n.filterModel,o=n.dateFilter,s=n.projectId,l=n.compareObj,c=n.emotion,d=e.dateType||i,u=void 0!==e.compareObj?e.compareObj:l,p={projectId:s,dateFilter:(0,oe.ZP)(o,(function(e){e.dateGroupType=d})),filterModel:(0,oe.ZP)(r,(function(e){u&&e.analysis.values.push(u)}))};t.setState({fetchingAspectLineData:!0},(function(){ie(p).then((function(n){var i=n.data,r=2e4===i.code&&i.result&&i.result.list&&i.result.list.length>0,o=0;r&&(o=i.result.list[0].data.reduce((function(e,t){return e+t[c]}),0),o=O.ZP.getApproximateNum(o)),t.setState((0,a.Z)({},e,{fetchingAspectLineData:!1,aspectLineData:r?i.result.list:"empty",msgTotal:o}))})).catch((function(){t.setState({fetchingAspectLineData:!1,aspectLineData:"error"})}))}))},t.fetchAspectBarData=function(e){var n=t.state,i=n.projectId,r=n.dateFilter,o=n.topicObj,s=n.topicOpts,l=n.filterModel,c=e.topicObj||o,d=s.find((function(e){return e.value===c})),u="";d&&(u=d.type);var p={projectId:i,dateFilter:r,filterModel:(0,oe.ZP)(l,(function(e){e.analysis.type=se(u)})),analysisObject:c};t.setState({fetchingAspectBarData:!0},(function(){re(p).then((function(n){var i=n.data;2e4===i.code&&t.setState((0,a.Z)({},e,{fetchingAspectBarData:!1,aspectBarData:i.result?i.result.list:"empty"}))})).catch((function(){t.setState({fetchingAspectLineData:!1,aspectLineData:"error"})}))}))},t.handleOnFilterChange=function(e){void 0!==e.dateType||void 0!==e.compareObj?t.fetchAspectLineData(e):void 0!==e.topicObj&&t.fetchAspectBarData(e)},t.handleOnChartClick=function(e,n){var a=t.props.onChartClick;"bar"===e?t.lineChartRef.current.resetChartRender():"line"===e&&t.barChartRef.current.resetChartRender(),a&&a(n)},t}return(0,i.Z)(t,e),t.prototype.resetChartRender=function(){this.lineChartRef.current.resetChartRender(),this.barChartRef.current.resetChartRender()},t}(r.PureComponent);var ce=n(70715);const de=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).dimensions=void 0,t.source=void 0,t.chartRef=void 0,t.mColor=void 0,t.margin=0,t.chartLength=0,t.dateType="DAY",t.getChartRef=function(e){return t.chartRef=e},t.setValue=function(e,n){t.chartLength=e.length;var a=60;t.dimensions=["\u65e5\u671f"],t.source=e.reduce((function(e,i,r){return t.dimensions.push(i.title+("positive"===n?"\u6b63\u9762":"\u8d1f\u9762")+"\u58f0\u91cf",i.title+"\u6307\u6807"+("positive"===n?"\u6ee1\u610f\u5ea6":"\u5dee\u8bc4\u7387")),i.data.forEach((function(t,i){var o=t[n],s=t.positive+t.negative===0?0:t[n]/(t.positive+t.negative);a=Math.max(a,(0,O.jD)(o,12)+40),0===r?e.push([t.title,o,s]):e[i].push(o,s)})),e}),[]),t.margin=a,t.mColor=1===t.chartLength?"positive"===n?["#15B374","#108657"]:["#D96969","#C44A4A"]:"positive"===n?["#15B374","#108657","#cdb446","#a89230"]:["#D96969","#c44a4a","#cdb446","#a89230"]},t.getOption=function(e,n,a,i){var r=Array.from({length:t.chartLength}).map((function(e,n){return[{type:"bar",barMaxWidth:24,name:t.dimensions[2*n+1],data:t.source.map((function(e,i){return{value:e[2*n+1],itemStyle:{color:0!==n&&1!==n&&2!==n&&3!==n||-1===a||a===i?t.mColor[2*n%t.mColor.length]:"#d8d8d8"}}}))},{type:"line",yAxisIndex:1,name:t.dimensions[2*n+2],data:t.source.map((function(e,i){return{value:e[2*n+2],symbolSize:a>-1&&a===n?8:4,itemStyle:{color:0!==n&&1!==n&&2!==n&&3!==n||-1===a||a===i?t.mColor[(2*n+1)%t.mColor.length]:"#d8d8d8"}}})),lineStyle:{color:n<4&&a>-1?"#d8d8d8":t.mColor[(2*n+1)%t.mColor.length]}}]}));return{color:t.mColor,title:{text:e,subtext:n,subtextStyle:{lineHeight:32,color:"#262626",fontSize:24}},grid:{top:140,left:20,right:t.margin,bottom:40,containLabel:!0},dataset:[{source:t.source,dimensions:t.dimensions}],legend:{top:70,left:20,itemWidth:10,itemHeight:10,textStyle:{lineHeight:12},data:t.dimensions.slice(1).map((function(e,t){return{name:e,icon:t%2===0?ce.W4.square:ce.W4.lineRing}}))},dataZoom:{show:"slider",bottom:16,xAxisIndex:0,height:16,handleSize:"100%",showDetail:!1},tooltip:{trigger:"axis",formatter:function(e){var n=e[0],a=e.map((function(e,t){var n=t%2===0?e.data.value:(100*e.data.value).toFixed(2)+"%";return e.marker+" "+e.seriesName+"\uff1a"+n}));return(0,ce.Zi)((0,O.yV)(t.dateType,n.axisValue))+"</br>"+a.join("</br>")}},xAxis:{type:"category",axisLabel:{formatter:function(e){return(0,O.yV)(t.dateType,e)}},data:t.source.map((function(e){return e[0]}))},yAxis:[{type:"value",name:"\u6570\u91cf",splitNumber:3,nameTextStyle:{color:"#262626"}},{type:"value",name:"\u6bd4\u4f8b",splitNumber:3,nameTextStyle:{color:"#262626"},axisLabel:{formatter:function(e){return(100*e).toFixed(2)+"%"}}}],series:2===t.chartLength?[].concat(r[0],r[1]):[].concat(r[0])}},t}return(0,i.Z)(t,e),t.prototype.renderChart=function(e,t,n,a,i){this.setValue(e,n,i),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,a,i,n))},t}(r.PureComponent);var ue=n(8201),pe=n(98191),fe=n(50976),he=n(49975),me=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleOnDateChange=function(e){n.dateType=e,n.props.onFilterChange({dateType:e}),n.props.onDateTypeChange({id:e})},n.handleOnChartClick=function(e){var t=e.componentType,a=(e.componentSubType,e.name),i=e.dataIndex,r=e.seriesIndex;"series"===t&&n.setState({clickedDataIndex:n.state.clickedDataIndex===i?-1:i,seriesIndex:r},(function(){var e=0===n.state.clickedDataIndex?"first":n.state.clickedDataIndex===n.source.length-1?"last":"",t=-1===n.state.clickedDataIndex?null:{name:a,sideType:e};n.props.onChartClick("line",t)}))},n.handleOnMoreClick=function(e){var t=n.props,a=t.title,i=t.value;"image"===e&&n.chartRef?(0,X._v)(n.chartRef,a):"data"===e&&(0,ue.P)(i)&&(0,X.aT)([[n.dimensions].concat(n.source)],a)},n.state={clickedDataIndex:-1,seriesIndex:-1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidUpdate=function(e,t){var n=this,a=e.value,i=this.props.value,r=t.clickedDataIndex,o=this.state,s=o.clickedDataIndex,l=o.seriesIndex;if((0,ue.P)(i)&&JSON.stringify(a)!==JSON.stringify(i)&&this.renderChart(),!(0,ue.P)(i)&&this.chartRef&&(this.chartRef=void 0),r!==s&&this.chartRef){var c=this.chartRef.getOption().series.map((function(e,t){var a=t<=0?0:t;return{data:e.data.map((function(e,i){return{value:e.value,symbolSize:s>-1&&s===i?8:4,itemStyle:{color:0!==t&&1!==t&&2!==t&&3!==t||-1===s||s===i&&l===t?n.mColor[a]:"#d8d8d8"}}})),lineStyle:{color:t%2!==0&&s>-1?"#d8d8d8":n.mColor[a]}}}));this.chartRef.setOption({series:c})}},n.componentDidMount=function(){this.renderChart()},n.renderChart=function(){var t=this.props,n=t.value,a=t.title,i=t.emotion,r=t.total,o=this.state.clickedDataIndex;(0,ue.P)(n)&&this.chartRef&&e.prototype.renderChart.call(this,n,a,i,r,o)},n.resetChartRender=function(){this.setState({clickedDataIndex:-1,seriesIndex:-1})},n.render=function(){var e=this.props,t=e.value,n=e.loading,a=e.title,i=e.filterObjOpts,o=e.onFilterChange,s=e.compareObj,l=e.dateRange,c=e.dateType;return r.createElement(ue.Z,{className:"yt_overview_aspect_line_chart_wrapper",data:t,loading:n,renderTitle:r.createElement(pe.Z,{title:a,data:t,onMoreClick:this.handleOnMoreClick},r.createElement($.Z,{preTitle:"\u5bf9\u6bd4\u5bf9\u8c61",options:i,objName:"compareObj",activeObj:s,sufTitle:"\u65e0",onChange:o}),r.createElement(he.Z,{defaultValue:c,noHour:!0,dateRange:l,onChange:this.handleOnDateChange}))},r.createElement(fe.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{click:this.handleOnChartClick}}))},t}(de);const ge=me;me.propTypes={title:l().string,value:l().any,onFilterChange:l().func,emotion:l().string,compareObj:l().string,dateRange:l().number,dateType:l().dateType,filterObjOpts:l().array,onChartClick:l().func,onDateTypeChange:l().func};var ve=n(97326),ye=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).dimensions=void 0,t.source=void 0,t.chartRef=void 0,t.margin=0,t.mColor=ce.Fq,t.getChartRef=function(e){return t.chartRef=e},t.setValue=function(e){t.dimensions=["\u6307\u6807","\u58f0\u91cf","\u7d2f\u8ba1\u58f0\u91cf\u5360\u6bd4"];var n=(0,O.jD)("100%",12)+30;t.source=e.reduce((function(e,t,a){return e[a].push(t.count),n=Math.max(n,(0,O.jD)(t.count,12)+30),e[a].push(t.percentage),e}),e.map((function(e){return[e.title]}))),t.margin=n},t.getOption=function(e){return{title:{text:e},tooltip:{trigger:"axis",formatter:function(e){return e.reduce((function(e,t,n){var a=t.marker,i=t.value,r=t.name;return 0===n?(e.push((0,ce.Zi)(r)),e.push(a+" \u58f0\u91cf\uff1a"+i)):e.push(a+" \u7d2f\u8ba1\u5360\u6bd4\uff1a"+(100*i).toFixed(2)+"%"),e}),[]).join("</br>")}},legend:{left:20,top:50,itemWidth:10,itemHeight:10,data:[{name:"\u58f0\u91cf",icon:ce.W4.square},{name:"\u7d2f\u8ba1\u58f0\u91cf\u5360\u6bd4",icon:ce.W4.lineRing}]},grid:{bottom:70,left:t.margin,right:t.margin,top:110},dataZoom:[{show:"slider",bottom:20,xAxisIndex:[0,1],height:15,handleSize:"100%",showDetail:!1}],dataset:[{source:t.source,dimensions:t.dimensions}],xAxis:[0,1].map((function(e){return{type:"category",data:t.source.map((function(e){return e[0]})),position:"bottom",show:!e}})),yAxis:[0,1].map((function(e){return{type:"value",name:e?"":"\u5404\u5546\u54c1\u6307\u6807\u6392\u884c",nameTextStyle:{color:"#262626"},axisLabel:{formatter:function(t){return e?(100*t).toFixed(0)+"%":t}}}})),series:[{type:"bar",yAxisIndex:0,barMaxWidth:40,data:t.source.map((function(e){return{value:e[1],itemStyle:{color:"#1574B3"}}})),markLine:{symbolSize:0,data:[{name:"\u5747\u503c",type:"average",label:{backgroundColor:"rgba(140, 140, 140, 0.3)",textShadowColor:"#1574b3",textShadowBlur:2,padding:[2,4],color:"#fff"}}]}},{type:"line",yAxisIndex:1,data:t.source.map((function(e){return{value:e[2],itemStyle:{color:"#CDB446"}}}))}]}},t}return(0,i.Z)(t,e),t.prototype.renderChart=function(e,t){this.setValue(e),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t))},t}(r.PureComponent);var Ce=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleOnMoreClick=function(e){var t=n.props,a=t.title,i=t.value;"image"===e&&n.chartRef?(0,X._v)(n.chartRef,a):"data"===e&&(0,ue.P)(i)&&(0,X.aT)([[n.dimensions].concat(n.source.map((function(e){return[e[0],e[1],(100*e[2]).toFixed(2)+"%"]})))],a)},n.handleOnChartClick=function(e){var t=e.componentSubType,a=e.componentType,i=e.dataIndex;"series"===a&&"bar"===t&&n.setState({clickedDataIndex:n.state.clickedDataIndex===i?-1:i},(function(){var e=n.props,t=e.onChartClick,a=e.value,r=e.topicObj;t&&t("bar",-1===n.state.clickedDataIndex?null:{analysis:{id:r,values:[a[i].id],type:a[i].type}})}))},n.handleOnSwitch=function(t){n.setState({showZero:t},(function(){var a=n.props,i=a.value,r=a.title;e.prototype.renderChart.call((0,ve.Z)(n),t?i:i.filter((function(e){return e.count})),r)}))},n.state={showZero:!1,clickedDataIndex:-1},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.renderChart()},n.componentDidUpdate=function(e,t){var n=this,a=e.value,i=this.props.value,r=t.clickedDataIndex,o=this.state.clickedDataIndex;if((0,ue.P)(i)&&JSON.stringify(a)!==JSON.stringify(i)&&this.renderChart(),!(0,ue.P)(i)&&this.chartRef&&(this.chartRef=void 0),r!==o&&this.chartRef){var s=this.chartRef.getOption().series.map((function(e,t){return{data:e.data.map((function(e,a){return{value:e.value,itemStyle:{color:-1===o||o===a?n.mColor[t%n.mColor.length]:"#d8d8d8"}}}))}}));this.chartRef.setOption({series:s})}},n.renderChart=function(){var t=this.props,n=t.value,a=t.title,i=this.state.showZero;(0,ue.P)(n)&&this.chartRef&&e.prototype.renderChart.call(this,i?n:n.filter((function(e){return e.count})),a)},n.resetChartRender=function(){this.setState({clickedDataIndex:-1})},n.render=function(){var e=this.state.showZero,t=this.props,n=t.value,a=t.loading,i=t.title,o=t.topicOpts,s=t.topicObj,l=t.onFilterChange;return r.createElement(ue.Z,{className:"yt_overview_aspect_bar_chart_wrapper",data:n,loading:a,renderTitle:r.createElement(pe.Z,{title:i,data:n,onMoreClick:this.handleOnMoreClick,titleOverlay:r.createElement("span",null,"\u6b64\u56fe\u7684\u5206\u6790\u65b9\u6cd5\u662f\u7edf\u8ba1\u5206\u6790\u4e2d\u5e38\u7528\u7684\u67cf\u62c9\u56fe\uff0c",r.createElement("a",{style:{color:"#0747a6"},href:"https://www.yuque.com/docs/share/5cc9676c-e68a-4304-8f36-f2bcdd347edb?#",target:"_blank"},"\u4e86\u89e3\u66f4\u591a"))},r.createElement($.Z,{options:o,objName:"topicObj",preTitle:"\u5206\u6790\u5bf9\u8c61",sufTitle:"\u65e0",activeObj:s,onChange:l}),r.createElement(c.Checkbox,{checked:e,onChange:this.handleOnSwitch,className:"zero_switch"},"\u663e\u793a'0'"))},r.createElement(fe.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{click:this.handleOnChartClick}}))},t}(ye);const Ee=Ce;Ce.propTypes={value:l().any,topicOpts:l().array,topicObj:l().string,loading:l().bool,title:l().string,onFilterChange:l().func,onChartClick:l().func};var Se=function(e){function t(t){var n;(n=e.call(this,t)||this).getFilterListShowAndHide=function(e){var t=JSON.parse(JSON.stringify(e));n.props.messageRelationConfig&&n.props.messageRelationConfig.unshow&&n.props.messageRelationConfig.unshow.forEach((function(e){t.some((function(n){return n.id===e&&(t.splice(t.findIndex((function(t){return t.id===e})),1),!0)}))}));var a=[],i=[];if(n.props.saveFilterListShow&&v.t.get(n.props.saveFilterListShow)&&v.t.get(n.props.saveFilterListShow).some((function(e){return e.projectId===n.state.projectId}))){var r=v.t.get(n.props.saveFilterListShow).filter((function(e){return e.projectId===n.state.projectId}))[0];t.forEach((function(e){r.filterListShow.some((function(t){return t.id===e.id}))?a.push(e):i.push(e)}))}else a=JSON.parse(JSON.stringify(t.slice(0,4))),i=JSON.parse(JSON.stringify(t.slice(4)));return{filterListShow:a,filterListHide:i}};var a=t.params,i=a.projectId,r=a.filterModel,o=a.dateFilter,s=a.analysisObjs,l=r&&r.aspect&&r.aspect.emotion&&r.aspect.emotion[0]||"positive",c=[],d=[];try{var u=JSON.parse(v.t.get(v.V.filterList)||localStorage.getItem("filter-list")),p=r.analysis.values[0],f=r.analysis.id;u.list.find((function(e){return e.id===f}))&&(c=u.list.find((function(e){return e.id===f})).values.reduce((function(e,t){return t.id!==p&&s.includes(t.id)&&e.push({title:t.name,value:t.id}),e}),[{title:"\u65e0",value:""}])),d=u.list.reduce((function(e,t){return"escore"!==t.id&&t.id!==f&&e.push({title:t.name,value:t.id,type:t.special}),e}),[])}catch(h){}return n.state={aspectLineData:void 0,fetchingAspectLineData:!1,compareObj:"",dateType:o.dateGroupType,msgTotal:0,dateRange:o.numOfDays,aspectBarData:void 0,fetchingAspectBarData:!1,topicObj:d.length>0?d[0].value:"",emotion:l,filterObjOpts:c,topicOpts:d,filterModel:r,dateFilter:o,projectId:i},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.fetchAspectBarData({});var t=this.state,n=t.projectId,i=t.filterObjOpts;(!i||i.length<=0)&&(0,te.Z)(ae().mark((function t(){return ae().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.h.post("/filter/find",{type:"OVERVIEW",filterTypes:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"],projectId:n}).then((function(t){var n,i,r;r=e.formatData(t.data.result);var o=e.getFilterListShowAndHide(r);n=o.filterListShow,i=o.filterListHide;var s=JSON.parse(JSON.stringify(n.concat(i))),l=[];s.forEach((function(e){e.child&&e.child.values.length>0&&l.push((0,a.Z)({},e.child,{special:"connConfig"}))})),(s=(s=s.filter((function(e){return!["input"].includes(e.type)}))).concat(s.splice(s.findIndex((function(e){return"expandTopic"===e.special})),1))).length>0&&v.t.set(v.V.filterList,JSON.stringify({list:s.concat(l),value:[]}));var c=e.props.params,d=c.filterModel,u=c.analysisObjs,p=d.analysis.values[0],f=d.analysis.id;e.setState({filterObjOpts:s.concat(l).find((function(e){return e.id===f}))?s.concat(l).find((function(e){return e.id===f})).values.reduce((function(e,t){return t.id!==p&&u.includes(t.id)&&e.push({title:t.name,value:t.id}),e}),[{title:"\u65e0",value:""}]):s.concat(l),topicOpts:s.concat(l).reduce((function(e,t){return"escore"!==t.id&&t.id!==f&&e.push({title:t.name,value:t.id,type:t.special}),e}),[])})}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},n.formatData=function(e){var t=this,n=[],i={};e.topics&&e.topics.titles&&e.topics.titles.length>0&&(i.connConfig=e.topics.data,n.push.apply(n,e.topics.titles.filter((function(t){return t.special="connConfig",t.filterType=e.topics.data?"connConfig":void 0,t.values.length>1})))),e.aspects&&e.aspects.titles&&e.aspects.titles.length>0&&(i.aspects=e.aspects.data,n.push.apply(n,e.aspects.titles.filter((function(t){return t.special="vocAspect",t.filterType=e.aspects.data?"aspects":void 0,t.values.length>1})))),e.brandsSeries&&e.brandsSeries.titles&&e.brandsSeries.titles.length>0&&(i.brandsSeries=e.brandsSeries.data,n.push.apply(n,e.brandsSeries.titles.filter((function(t){return t.special="brandsSeries",t.filterType=e.brandsSeries.data?"brandsSeries":void 0,t.values.length>1})))),this.setState({reFilterData:i}),e.dimension&&n.push.apply(n,e.dimension.filter((function(e){return e.special="dimension",e.type=-1!==["BRAND_INTERACTION_ANALYSIS","BRAND_CONTENT_ANALYSIS","BRAND_CHANNEL_ANALYSIS"].indexOf(t.props.type)?"radio":"",e.values.length>1}))),e.source&&e.source.length>0&&n.push({id:"source",name:"\u6570\u636e\u6765\u6e90",special:"source",values:e.source}),e.tag&&e.tag.length>0&&e.tag.forEach((function(e){e.special="tag",n.push(e)})),e.userFilter&&n.push({id:"userFilter",special:"userFilter",name:"\u7528\u6237",type:"associateInput",values:e.userFilter}),this.props.filterConfig&&this.props.filterConfig.forEach((function(e){switch(e){case"ESCORE":n.push({id:"escore",special:"escore",name:"\u901a\u7528\u60c5\u611f",values:[{id:"1",name:"\u6b63\u9762"},{id:"0",name:"\u4e2d\u6027"},{id:"-1",name:"\u8d1f\u9762"}]});break;case"MULTI_KEY_WORD":n.push({id:"MULTI_KEY_WORD",special:"content",name:"\u5173\u952e\u8bcd",type:"multi_input",values:[]});break;case"KEY_WORD":n.push({id:"KEY_WORD",special:"content",name:"\u5173\u952e\u8bcd",type:"input",values:[]});break;case"USEFUL_DATA":n.push({id:"usefulData",special:"usefulData",name:"\u6570\u636e\u6709\u6548\u6027",values:[{id:"USEFUL",name:"\u6709\u6548\u6570\u636e"},{id:"UNUSEFULL",name:"\u65e0\u6548\u6570\u636e"}]});break;case"ASPECT_ESCORE":n.push({id:"aspectEscore",special:"aspectEscore",name:"\u6307\u6807\u60c5\u611f",values:[{id:"1",name:"\u6b63\u9762"},{id:"0",name:"\u4e2d\u6027"},{id:"-1",name:"\u8d1f\u9762"}]});break;case"IS_BUSINESS":n.push({id:"isBusiness",special:"isBusiness",name:"\u4e1a\u52a1\u6570\u636e",values:[{id:"BUSINESS",name:"\u662f"},{id:"UN_BUSINESS",name:"\u5426"}]});break;case"IS_MARKETING":n.push({id:"isMarketing",special:"isMarketing",name:"\u8425\u9500\u6570\u636e",values:[{id:"MARKETING",name:"\u662f"},{id:"UN_MARKETING",name:"\u5426"},{id:"NULL_MARKETING",name:"\uff08\u7a7a\uff09"}]})}})),e.expandTopics&&n.push({id:"expandTopic",name:"\u7ec4\u5408\u5206\u6790",special:"expandTopic",values:e.expandTopics,type:"expandTopic"});var r=n.map((function(e){return(0,a.Z)({},e,{values:e.values.length>0?(0,O.QM)(e.values):e.values})}));return JSON.parse(JSON.stringify(r))},n.render=function(){var e=this.state,t=e.aspectLineData,n=e.fetchingAspectLineData,a=e.compareObj,i=e.dateType,o=e.emotion,s=e.filterObjOpts,l=e.dateRange,c=e.msgTotal,d=e.aspectBarData,u=e.fetchingAspectBarData,p=e.topicOpts,f=e.topicObj,h=this.props.onLineDateTypeChange;return r.createElement("div",{className:"yt_detail_chart_view_wrapper"},r.createElement(ge,{ref:this.lineChartRef,title:"\u6307\u6807\u58f0\u91cf\u53ca\u8d70\u52bf",emotion:o,total:c,value:t,loading:n,filterObjOpts:s,compareObj:a,dateType:i,dateRange:l,onChartClick:this.handleOnChartClick,onDateTypeChange:h,onFilterChange:this.handleOnFilterChange}),r.createElement(Ee,{ref:this.barChartRef,value:d,title:"\u6307\u6807\u5206\u5e03",loading:u,topicOpts:p,onChartClick:this.handleOnChartClick,topicObj:f,onFilterChange:this.handleOnFilterChange}))},t}(le);const Oe=Se;Se.propTypes={params:l().any,onChartClick:l().func,onLineDateTypeChange:l().func};var ke=["#1550B3","#CC6A77","#119073","#CDB446","#D969BF","#2684FF","#C8662B","#9369D9","#0E97AD","#1BBF69","#D07B49","#61799B","#1EA082","#A9A557","#D8727F"],Ne=[{title:"\u5bfc\u51fa\u56fe\u7247",type:"wImage"},{title:"\u5bfc\u51fa\u6570\u636e",type:"wExcel"}],Te={DAY:"\u5929",WEEK:"\u5468",MONTH:"\u6708"},be=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnWsMessage=function(e){var t=e.data;if(t.type&&"ws"===t.type){var a=t.payload,i=a.type,r=a.result;"OPINION_TASK_RESULT"===i&&n.props.dispatch({type:"opinionChart/handleOpinion",payload:r})}},n.changeChart=function(e){(0,n.props.dispatch)({type:"opinionChart/save",payload:{wordCloud:e}})},n.myChartClick=function(e){var t=n.props.opinionChart,a=(t.json_bar,t.queryParams.dateFilter),i=a.from,r=a.to,o=n.state.dateType,s=null;e&&e.name?s={time:e.name,type:o,sideType:e.sideType,sideTime:"first"===e.sideType?i:"last"===e.sideType?r:""}:e&&e.analysis&&(s={analysis:e.analysis}),n.clickTimeId&&clearTimeout(n.clickTimeId),n.clickTimeId=setTimeout((function(){n.props.refreshMessage(s),n.refs.wordCloud&&n.refs.wordCloud.resetState(),n.clickTimeId=void 0}),1e3)},n.resetWordcloudState=function(){setTimeout((function(){n.refs.wordCloud&&n.refs.wordCloud.resetState(),n.setState({activeOpinionIndex:-1})}),0)},n.resetBarchartState=function(){setTimeout((function(){n.refs.bar&&n.refs.bar.resetChartRender()}),0)},n.handleMyWordChartClick=function(e,t){var a=n.props.opinionChart,i=a.queryTimeType,r=a.clusterType,o=n.state.activeOpinionIndex===t?null:e?{opinion:e.name,type:i,clusterType:r}:null;n.props.refreshMessage(o),n.clickTimeId&&clearTimeout(n.clickTimeId),n.clickTimeId=setTimeout((function(){n.refs.bar&&n.refs.bar.resetState(),n.setState({activeOpinionIndex:t}),n.clickTimeId=void 0}),100)},n.onWindowResize=function(){setTimeout((function(){n.resize()}),300)},n.resize=function(){if(n.flexWrapper){var e=n.flexWrapper.offsetWidth*n.rate;n.flexSpan.style.fontSize=e+"px"}n.refs.bar&&n.refs.bar.refs.chart.myChart.resize()},n.changeQueryTime=function(e){e.name;var t=e.id,a=n.props,i=a.opinionChart.queryParams,r=a.dispatch,o=JSON.parse(JSON.stringify(i));o.dateFilter.dateGroupType=t,n.setState({dateType:t}),r({type:"opinionChart/save",payload:{queryTimeType:t,queryParams:o}})},n.renderOpinionOverlay=function(){return r.createElement("div",null,r.createElement("div",null,"\u8be5\u6570\u636e\u4e3a\u60a8\u663e\u793a\uff1a\u7531\u4e8e\u6240\u9009\u7684\u6d88\u606f\u4e2d\u4e0d\u5149\u4f1a\u6709\u4e0e\u4e2d\u5fc3\u6307\u6807\u60c5\u611f\u76f8\u5173\u7684\u89c2\u70b9\uff0c\u8fd8\u4f1a\u6709\u5176\u4ed6\u76f8\u5173\u6307\u6807\u548c\u60c5\u611f\u7684\u89c2\u70b9\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u4e3b\u63a7\u5236\u662f\u5426\u5c55\u793a\u4ec5\u5c55\u793a\u4e2d\u5fc3\u6307\u6807\u60c5\u611f\u76f8\u5173\u7684\u89c2\u70b9\uff1b\u540c\u65f6\u5bf9\u4e8e\u805a\u7c7b\u7684\u89c2\u70b9\u7c97\u7ec6\u7a0b\u5ea6\u4e5f\u53ef\u4ee5\u7531\u7528\u6237\u9009\u62e9\u3002"),r.createElement("div",{style:{margin:"5px 0"}},"\u7b97\u6cd5\u8bf4\u660e\uff1a\u5178\u578b\u610f\u89c1\u7684\u83b7\u5f97\u5927\u81f4\u7ecf\u5386\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a\u2460\u4ece\u6d88\u606f\u4e2d\u62bd\u53d6\u89c2\u70b9\u2192\u2461\u5bf9\u89c2\u70b9\u805a\u7c7b\u2192\u2462\u9009\u4e3e\u4e2d\u5fc3\u89c2\u70b9\u3002\u5728\u4ee5\u4e0a\u6b65\u9aa4\u4e0a\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u2460\u4e4b\u540e\u9009\u62e9\u5373\u5c06\u805a\u7c7b\u7684\u89c2\u70b9\u662f\u5426\u4e0e\u4e2d\u5fc3\u6307\u6807\u60c5\u611f\u76f8\u5173\uff1b\u5728\u2461\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u805a\u7c7b\u7684\u7c97\u7ec6\u7a0b\u5e8f\uff0c\u53c2\u6570\u8bbe\u7f6e\u8d8a\u5c0f\uff0c\u805a\u7c7b\u7684\u89c2\u70b9\u8d8a\u7ec6\uff1b\u5728\u2462\u53ef\u80fd\u4f1a\u9009\u4e3e\u51fa\u4e0e\u4e2d\u5fc3\u6307\u6807\u7684\u60c5\u611f\u76f8\u5173\u7684\u89c2\u70b9\uff0c\u8fd9\u662f\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u6392\u9664\u8be5\u4e2d\u5fc3\u89c2\u70b9\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u7ed9\u51fa\u7b2c\u4e8c\u5907\u9009\u7684\u89c2\u70b9\u3002"),r.createElement("div",null,"\u540d\u8bcd\u8fa8\u6790\uff1a\u5178\u578b\u610f\u89c1\u5373\u89c2\u70b9\uff0c\u662f\u4e00\u4e2a\u805a\u7c7b\u51fa\u7684\u89c2\u70b9\u7c07\u4e2d\u7684\u4ee3\u8868\u3002"))},n._handleMoreClick=function(e){var t=n.props.opinionChart,a=t.json_word,i=t.json_bar,r=t.queryTimeType;if("wImage"===e)(0,X._v)(n.refs.wordCloud.refs.chart.myChart,"\u5178\u578b\u610f\u89c1");else if("bImage"===e)(0,X._v)(n.refs.bar.refs.chart.myChart,"\u6570\u636e\u8d8b\u52bf");else if("bExcel"===e){var o=i.reduce((function(e,t){return[].concat(e,[[t.time,t.count]])}),[["\u65e5\u671f/\u6309"+Te[r],"\u8bcd\u9891"]]);(0,X.aT)([o],"\u6570\u636e\u8d8b\u52bf")}else if("wExcel"===e){var s=a.reduce((function(e,t){return t?[].concat(e,[[t.name,t.value]]):e}),[["\u8bcd\u540d","\u8bcd\u9891"]]);(0,X.aT)([s],"\u5178\u578b\u610f\u89c1")}},n._handleCommonChange=function(e){var t=n.props,a=t.dispatch,i=t.opinionChart,r=i.refreshing,o=i.reloaded,s=i.allData,l=i.type,c=(i.hasRecord,e.clusterType);r&&3!==l&&!o||4===l?a({type:"opinionChart/save",payload:{clusterType:c,json_word:s[c]}}):(a({type:"opinionChart/save",payload:{clusterType:c}}),a({type:"opinionChart/getWordCloudList"}));n.setState({optionPage:1})},n.renderWordOverlay=function(e){return r.createElement("div",{onClick:function(e){e.stopPropagation()}},r.createElement("span",null,e),r.createElement("span",{onClick:function(t){n._handleWordHideClick(e)}},"\u9690\u85cf"))},n._handleWordHideClick=function(e){var t=n.props,a=t.opinionChart.json_word,i=t.dispatch,r=a.filter((function(t){return t&&t.name!==e})),o=Math.ceil(a.length/30);r=[].concat(r,Array(30*o-r.length).fill(void 0)),xe(r),i({type:"opinionChart/save",payload:{json_word:r}})},n.goOpinion=function(){var e=n.props.taskId;window.open("/opinion?id="+e+"&source=detail")},n._handleOnOptionWordListPageChange=function(e){n.setState({optionPage:e})},n.state={activeOpinionIndex:-1,optionPage:1,dateType:"DAY"},n}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this.props,t=e.type,n=e.dispatch,a=e.opinionChart,i=a.opinion,r=(a.hasRecord,e.taskId);if(location.search.length>0&&"/tab/detail"===location.pathname){var o=JSON.parse(decodeURIComponent(location.search).split("?")[1]);n({type:"opinionChart/save",payload:{queryParams:o,queryTimeType:o.dateFilter.dateGroupType,type:t,currTaskId:r}})}if(i&&(2===t||3===t)&&n({type:"opinionChart/getWordCloudList"}),this.flexWrapper){var s=this.flexWrapper.offsetWidth;this.rate=.03,this.flexSpan.style.fontSize=s*this.rate+"px"}window.addEventListener("resize",this.onWindowResize)},a.UNSAFE_componentWillReceiveProps=function(e,t){var n=this.props,a=n.dispatch,i=(n.opinionChart.opinion,this.props.taskId),r=e.taskId;i!==r&&a({type:"opinionChart/save",payload:{currTaskId:r}}),this.props.type!==e.type&&a({type:"opinionChart/save",payload:{type:e.type}}),JSON.stringify(this.props.params)!==JSON.stringify(e.params)&&a({type:"opinionChart/save",payload:{queryParams:e.params,queryTimeType:e.params.dateFilter&&e.params.dateFilter.dateGroupType||"DAY"}})},a.componentWillMount=function(){(0,this.props.dispatch)({type:"opinionChart/save",payload:{count:0,average:0,json_bar:"\u6ca1\u6709\u6570\u636e\u53ef\u7528",json_word:[]}}),window.addEventListener("resize",this.onWindowResize),window.addEventListener("message",this._handleOnWsMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage)},a.shouldComponentUpdate=function(e,t){var n=this.props.opinionChart,a=n.clusterType,i=n.json_word,r=n.json_bar,o=n.opinionTaskValid,s=n.queryTimeType,l=n.refreshing,c=n.wordCloud,d=n.allData,u=n.loading,p=e.opinionChart,f=p.clusterType,h=p.json_word,m=p.json_bar,g=p.opinionTaskValid,v=p.queryTimeType,y=p.refreshing,C=p.wordCloud,E=p.allData,O=p.loading;return!(a===f&&o===g&&s===v&&l===y&&c===C&&u===O&&S(i,h)&&S(r,m)&&S(d,E))||this.state.optionPage!==t.optionPage},a.render=function(){var e=this,t=this.props,a=t.opinionChart,i=a.type,o=a.wordCloud,s=(a.json_bar,a.average,a.queryTimeType,a.json_word),l=a.queryParams,d=a.opinion,u=a.clusterType,p=a.refreshing,f=(a.allData,a.opinionTaskValid),h=a.invalidReason,m=(a.hasRecord,a.clusterTypeOptions),v=a.loading,y=t.params,C=this.state,E=C.optionPage,S=C.activeOpinionIndex;return r.createElement("div",{className:"detailChart"},4===i&&y.analysisObjs&&r.createElement(Oe,{ref:"bar",params:y,onChartClick:this.myChartClick,onLineDateTypeChange:this.changeQueryTime}),d&&r.createElement("div",{className:"detailChart-bottom"},r.createElement("div",{className:"title"},r.createElement("span",null,r.createElement("span",{style:{marginLeft:5,fontSize:14}},"\u5178\u578b\u610f\u89c1",4===i&&"\uff08"+(l&&l.seriesName)+"\uff09"),r.createElement(g.Z,{placement:"bottom",overlayClassName:4===i?"popover-detial-wrapper":"popover-opinion-wrapper",overlay:this.renderOpinionOverlay()},r.createElement("i",{className:"icon-cem_file1"}))),r.createElement("span",null,4!==i&&r.createElement(g.Z,{overlay:"\u5f53\u524d\u56fe\u8868\u663e\u793a\u7684\u662f\u524d5000\u6761\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1\u7ed3\u7b97\u7ed3\u679c\uff0c\u7cfb\u7edf\u6b63\u5728\u8ba1\u7b97\u5168\u90e8\u6d88\u606f\u7684\u5178\u578b\u610f\u89c1\uff0c\u8ba1\u7b97\u597d\u4e4b\u540e\u4f1a\u81ea\u52a8\u5237\u65b0\u56fe\u8868",placement:"top",overlayClassName:"alert-log-tips"},r.createElement("i",{className:p?"icon-cem_refresh refreshing":"icon-cem_refresh",style:{display:p?"inline-block":"none"}})),r.createElement("span",{className:"clustering"},r.createElement("span",{className:p?"":"disapper"},"\u805a\u7c7b\u9897\u7c92\uff1a"),r.createElement($.Z,{activeObj:u,onChange:this._handleCommonChange,options:m,objName:"clusterType"})),r.createElement("i",{className:"icon-cem_cloud "+(o?"active":""),onClick:this.changeChart.bind(this,!0)}),r.createElement("i",{className:"icon-cem_listing "+(o?"":"active"),onClick:this.changeChart.bind(this,!1)}),r.createElement("span",{style:{color:"#e5e5e5",marginRight:8}},"|"),r.createElement(Q.Z,{options:Ne,onClick:this._handleMoreClick}))),r.createElement(c.Loading,{className:"chart-table",loading:v,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},s?f?o?r.createElement(G.Z,{index:4===i?1:0,ref:"wordCloud",json:s,activeOpinionIndex:S,myChartClick:this.handleMyWordChartClick}):r.createElement(r.Fragment,null,r.createElement("div",{className:"oppion-word"},0!==s.length||v?s.slice(30*(E-1),30*E).map((function(t,n){var a=30*(E-1)+n+1;return r.createElement("div",{key:a},t?r.createElement(g.Z,{overlayClassName:"popover-detail-wrodcloud-list-wrapper",placement:"top",overlay:e.renderWordOverlay(t.name)},r.createElement("span",{className:"option-item "+(-1===S||a===S?"":"inactive-option-item"),onClick:function(n){e.handleMyWordChartClick(t,a)}},r.createElement("span",null,r.createElement("span",{style:{backgroundColor:""+(a<7?ke[a%ke.length]:"#8c8c8c")}},a)),r.createElement("span",null,t.name),r.createElement("span",null,we(t.value,2)),r.createElement("span",null,"("+t.ratio+")"))):null)})):r.createElement("div",{className:"no-data"},r.createElement("img",{src:n(3381)}),r.createElement("span",null,"\u6ca1\u6709\u6570\u636e\u53ef\u7528"))),s.length>30?r.createElement(c.Pagination,{className:"oppion-word-pagination",layout:"prev, pager, next",total:s.length,pageSize:30,currentPage:E,small:!0,onCurrentChange:this._handleOnOptionWordListPageChange}):null):r.createElement("div",{className:"no-data"},0!==h&&r.createElement(r.Fragment,null,r.createElement("img",{src:n(6714)}),r.createElement("span",null,"\u5f53\u524d",1===h?"\u6d88\u606f\u4e2d\u5c11\u4e8e20\u4e2a\u89c2\u70b9":2===h?"\u5c0f\u4e8e50\u6761\u6d88\u606f":"\u5927\u4e8e50\u4e07\u6761\u6d88\u606f","\uff0c\u65e0\u6cd5\u542f\u52a8\u5178\u578b\u610f\u89c1"),r.createElement("span",null,"\u8bf7\u91cd\u65b0\u9009\u62e9\u7b5b\u9009\u6761\u4ef6"))):null)))},(0,o.Z)(t,[{key:"formatterData",get:function(){var e=this.props.opinionChart.count,t=String(e);if(t.length>3){var n=t.split(""),a="",i=n.length,r=i-(3+(i%3===0?3:i%3));r>=3&&r<6&&i>6?a="K":r>=6&&(a="M");for(var o=0,s=i;s>0;s--)0!==o&&o%3===0&&n.splice(s,0,","),o++;return n.slice(0,n.indexOf(",")+4).join("")+a}return e}}]),t}(r.Component);const Ie=(0,ee.connect)((function(e){var t=e.opinionChart;e.loading;return{opinionChart:t}}),null,null,{withRef:!0})(be);var we=function(e,t){return e?e/1e4<1?e:e/1e8<1?(e/1e4).toFixed(t||0)+"\u4e07":(e/1e8).toFixed(t||0)+"\u4ebf":0},xe=function(e){var t=e.reduce((function(e,t){return t?e+t.value:e}),0);e.forEach((function(e){e&&(e.ratio=(e.value/t*100).toFixed(2)+"%")}))},De=(n(75314),n(11187)),Le=n(38425),Fe=n(52314),Ae=n(12234),je=n(94184),_e=n.n(je);r.PureComponent;var Re=n(66746),Me=(n(73098),n(49357));L().locale("zh-cn");var Ve=[{title:"\u5bfc\u51fa\u6570\u636e",type:"excel"}],Pe=function(e){function t(t){var i;return(i=e.call(this,t)||this).openItem=function(e,t){i.getAspects(),i.setState({openItem:i.state.openItem===e?null:e,emotion:t})},i.getPageTable=function(e){var t=i.state,n=t.info,a=t.isInitial;if(i.setState({isLoading:!0,pageIndex:e},(function(){return i.searchTable(n)})),!a)if(location.pathname.includes("opinion")){var r=document.getElementsByClassName("content-sidebar")&&document.getElementsByClassName("content-sidebar")[0];r&&(r.scrollTop=760)}else{var o=document.getElementsByClassName("content")&&document.getElementsByClassName("content")[0];o&&(o.scrollTop=620)}},i.searchTable=function(e){var t=i.state,n=t.params,r=t.pageSize,o=t.pageIndex,s=t.info,l=t.searchValue;if(n.filterModel.taskId||n.dateFilter){n.filterModel.aspect||(n.filterModel.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]});var c=i.props,d=c.params,u=(c.type,JSON.parse(JSON.stringify(n))),f=JSON.parse(JSON.stringify(d)),h=f.filterModel.aspect.emotion,m=[];1===h.length?m="positive"===h[0]?["\u6b63\u9762"]:["\u8d1f\u9762"]:2===h.length&&(m=["\u6b63\u9762","\u8d1f\u9762"]),i.setState({seriesName:m});var g="",y="/inbox/aspect/find";if(!e||e.content)u=f,e&&void 0!==e.hide&&!1===e.hide?g=void 0:e&&e.content&&(g=e.content[0].contain[0]);else if(e.opinion)y="/opinion/result/message",u={projectId:f.projectId,type:"EMOTION_ASPECT_LEVEL_BAR",filterModel:{taskId:f.taskId,clusterLevel:e&&e.clusterType||20,opinion:e.opinion}},e&&e.opinion&&(g=void 0);else if(e?e.type:s.type){if(u=f,"DAY"===(e?e.type:s.type))u.dateFilter.from=e?e.time:s.time,u.dateFilter.to=e?e.time:s.time;else if("WEEK"===(e?e.type:s.type)){var C=(s?s.time:e.time).split("-"),E=C[0],S=C[1],O=""+Number(E),k=L()(O).week(S);"first"===e.sideType?u.dateFilter.from=e.sideTime:u.dateFilter.from=k.startOf("week").format("YYYY-MM-DD"),"last"===e.sideType?u.dateFilter.to=e.sideTime:u.dateFilter.to=k.endOf("week").format("YYYY-MM-DD")}else if("MONTH"===(e?e.type:s.type)){var N=L()(e.time);"first"===e.sideType?u.dateFilter.from=e.sideTime:u.dateFilter.from=N.startOf("month").format("YYYY-MM-DD"),"last"===e.sideType?u.dateFilter.to=e.sideTime:u.dateFilter.to=N.endOf("month").format("YYYY-MM-DD")}i.setState({mParams:{from:u.dateFilter.from,to:u.dateFilter.to}}),u.dateFilter.dateGroupType=e?e.type:s.type,u.dateFilter.aspect_bar=!0}else e.analysis&&((u=f).filterModel.analysis=e.analysis);u.filterModel.project=[f.projectId],g=void 0===g?"":""===g?l:g;var b=[];u.filterModel.content&&u.filterModel.content[0]&&(b=u.filterModel.content[0].contain),u.filterModel.content=[{contain:[].concat(b,g?g.trim().split(" "):[])}],u.pageIndex=JSON.stringify(e)!==JSON.stringify(s)?1:o,u.pageSize=r,i.setState({listLoading:!0},(function(){return p.h.post(y,u).then((function(t){var n=t.data.result;if(n.result){var r=n.result.map((function(e){return Array.isArray(e.aspects)?e.aspects=i.cleanData(e.aspects):e.aspects=[],e}));p.h.post("feedback/find",{projectId:v.t.get(v.V.curProject).id,commentIds:r.map((function(e){return e.commentId}))}).then((function(t){T.Z.hasAuthority("MESSAGE_ORDER_NO")&&p.h.post("order/find",{projectId:v.t.get(v.V.curProject).id,messageIds:r.map((function(e){return e.oid}))}).then((function(e){var t=e.data,n=t.code,a=t.result;2e4===n&&a.length>0&&a.forEach((function(e,t){r[t].oids=e.oid}))})).catch((function(e){}));var a=t.data,o=a.code,s=a.result;2e4===o&&s&&(r.forEach((function(e){e.feedback=s.find((function(t){return t.commentId===e.commentId}))||{status:!1,count:0,modelTime:"",submitTypes:[]}})),setTimeout((function(){i.setState({pageIndex:u.pageIndex,listLoading:!1,isLoading:!1,searchValue:g,info:e||void 0,data:r,params:u,count:{total:n.count,aspectTotal:n.aspectTotal},isInitial:!1})}),1e3))}))}else i.setState({pageIndex:u.pageIndex,listLoading:!1,isLoading:!1,searchValue:g,info:e||void 0,data:r,params:(0,a.Z)({},u,{aspect:u.filterModel.opinion}),count:{total:n.count,aspectTotal:0},isInitial:!1})}))}))}},i.getAspects=function(e){var t=new FormData;t.append("widgetId","");var n=i.state.params.projectId;t.append("projectId",n),p.h.post("/inbox/aspect",t).then((function(e){var t=JSON.parse(e.data.result);i.setState({aspects:t,selectedIndex:Object.keys(t)[0]})}))},i.addAspect=function(e,t,n){i.setState({loadingId:e.commentId});var a=i.state,r=a.emotion,o=(a.data,a.info);p.h.post("inbox/messages/add",{commentId:e.commentId,index:e.index,routing:e.routing,score:r?8:3,aspect1:t,aspect2:n,flag:"aspect"}).then((function(e){i.searchTable(o),i.setState({loadingId:null})}))},i.deleteAsp=function(e,t){var n=t.aspectId,a=i.state,r=a.data,o=a.info;i.setState({loadingId:e.commentId}),p.h.post("inbox/messages/delete",{id:n,commentId:e.commentId,index:e.index,routing:e.routing,flag:"aspect",originScore:t.escore,aspectName:t.aspect2}).then((function(t){r.forEach((function(t){t.commentId===e.commentId&&t.aspects.forEach((function(e,a){e.aspectId===n&&t.aspects.splice(a,1)}))})),i.setState({data:r,loadingId:null},(function(){return i.searchTable(o)}))}))},i.transformAsp=function(e,t){var n=i.state,a=(n.emotion,n.data),r=n.info,o=a.filter((function(t){return t.commentId===e.commentId})),s=o[0].aspects?o[0].aspects.filter((function(e){return e.escore===(8===t.escore?3:8)})):[],l=8===t.escore?3:8;s.some((function(e){return e.aspect2===t.aspect2}))?d.Z.warning("\u6307\u6807\u5df2\u5b58\u5728"):(i.setState({loadingId:e.commentId}),p.h.post("inbox/messages/update",{id:t.aspectId,index:e.index,commentId:e.commentId,routing:e.routing,score:l,flag:"aspect",originScore:t.escore,aspectName:t.aspect2}).then((function(n){a.forEach((function(n){n.commentId===e.commentId&&n.aspects.forEach((function(e){e.aspectId===t.aspectId&&(e.escore=l)}))})),i.setState({data:a,loadingId:null},(function(){return i.searchTable(r)}))})))},i.selectChange=function(e){i.setState({selectedIndex:e})},i.renderExtend=function(e){var t=i.state,n=t.aspects,a=t.selectedIndex,o=t.emotion,s=t.isLoading,l=e.aspects.filter((function(e){return e.escore===(o?8:3)})).map((function(e){return e.aspect2}));return r.createElement(Fe.X,{className:"detail-extend"},r.createElement("div",null,r.createElement(c.Select,{value:i.state.selectedIndex,onChange:i.selectChange},n&&Object.keys(n).map((function(t,n){return r.createElement(c.Select.Option,{label:t,value:t,key:t+e.commentId})}))),r.createElement("i",{className:"icon-cem_delete close",onClick:function(){return i.openItem(e.commentId)}})),r.createElement("div",{className:o?"asp asp-positive":"asp asp-negative"},n&&n[a].filter((function(e){return-1===l.indexOf(e)})).map((function(t,n){return r.createElement("span",{key:n,style:{cursor:s?"not-allowed":""},onClick:function(){return s?"":i.addAspect(e,a,t)}},r.createElement("i",{className:"text"},t))}))))},i._handleFeedbackCountChange=function(e){i.setState({data:i.state.data.map((function(t){return t.feedback.commentId===e.commentId?(0,a.Z)({},t,{count:e.count,feedback:e}):(0,a.Z)({},t,{count:e.count,feedback:(0,a.Z)({},t.feedback,{count:e.count})})}))})},i._handleMsgClick=function(e){var t=i.props.params,n=t.dateFilter,a=t.leftName,r=t.projectId,o={dateFilter:n,filterModel:{project:[r]},projectId:r,msgId:e,filterTip:"\u4ea7\u54c1\u6d1e\u5bdf/"+(a||"\u5178\u578b\u610f\u89c1")+"/\u6d88\u606f\u8be6\u60c5"};window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(o)))},i.renderAllMessage=function(e){var t=i.state,a=t.openItem,o=(t.sourceEmotion,t.params,t.loadingId),s=t.seriesName,l=t.listLoading,d=t.currentHighLight,u=t.tagHoverInfo,p=i.state.lock,f=!1;T.Z.hasAuthority("REVIEW_MESSAGE_LOCK")||(p=!0);var h=(document.documentElement.clientWidth-64-36-76-68-24-32-200)/2;return r.createElement("div",{ref:"blogs",className:"message-list"},r.createElement(c.Loading,{loading:l},e.length>0?e.map((function(e,t){var l=e;f=f||s.includes("\u6b63\u9762")||!p;var m=_e()("asp","asp-negative",{"negative-border":f});return r.createElement(c.Loading,{loading:o===e.commentId,key:l.commentId+t},r.createElement("div",{className:"blog-container "+(p?"lock":"unlock")},r.createElement(Fe.X,{className:"blog-title"},r.createElement(Fe.J,{className:"base-info source"},r.createElement("span",{className:"source-img"},r.createElement("img",{src:l.userImage?l.userImage.startsWith("http")?l.userImage:location.protocol+"//"+l.userImage:n(88958),"data-url":l.userImage,alt:"\u5934\u50cf"}))),r.createElement(Fe.J,{className:"base-info product"},l.username),r.createElement(Fe.J,{className:"base-info  pull-right"},!!e.oids&&"\u5929\u732b"===e.sourceName&&r.createElement("span",null,"\u8ba2\u5355\u7f16\u53f7:",r.createElement("span",{className:"copyValues",onClick:function(){return(0,O.zp)("copyValues")}},e.oids),r.createElement("i",{className:"icon-fuzhi",onClick:function(){return(0,O.zp)("copyValues")},style:{color:"#7262FD",cursor:"pointer",marginRight:"10px"}})),null!=e.score&&0!==e.score&&r.createElement(c.Rate,{className:"rate",disabled:!0,key:e.score,value:e.score,colors:["#FF8373","#FF8373","#FF8373"],showText:!1}),r.createElement("span",{className:"time"},L()(l.createTime).format("YYYY-MM-DD HH:mm")),r.createElement("span",{className:"type"},l.type?l.type.substring(0,1):""))),r.createElement(Fe.X,{className:"blog-body",dangerouslySetInnerHTML:{__html:i.renderContent(l.content,u.id===l.commentId&&d,u.type)}}),r.createElement(Fe.X,{className:"blog-foot detail-footer"},r.createElement(Fe.J,{className:"asp asp-positive",col:"md-6"},l.aspects.filter((function(e){return 8===e.escore})).map((function(e,t){return r.createElement(g.Z,{key:"aspects_"+t,mouseEnterDelay:.6,overlay:r.createElement("div",{className:"aspects_tip"},r.createElement("p",null,r.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),r.createElement("span",null,e.aspect1)),r.createElement("p",null,r.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),r.createElement("span",null,e.aspect2)),r.createElement("p",null,r.createElement("span",null,"\u6307\u6807\u60c5\u611f"),r.createElement("span",null,"\u6b63\u9762"))),placement:"bottom"},r.createElement("span",{key:e.aspect2,onMouseEnter:function(){var t;return(null==(t=e.highLightInfoList)?void 0:t.length)>0&&i.setState({currentHighLight:[].concat(e.highLightInfoList),tagHoverInfo:{id:e.msgId,type:"aspect"}})},onMouseLeave:function(){return i.setState({currentHighLight:[],tagHoverInfo:{}})}},r.createElement("i",{className:"text"},e.aspect2)))})),!p&&r.createElement("span",{className:"add-bar",onClick:function(){return i.openItem(l.commentId,!0)}},r.createElement(Ae.l,{name:"add-to"}))),r.createElement(Fe.J,{className:m,col:"md-6"},l.aspects.filter((function(e){return 3===e.escore})).map((function(e,t){return r.createElement(g.Z,{key:"aspects_"+t,mouseEnterDelay:.6,overlay:r.createElement("div",{className:"aspects_tip"},r.createElement("p",null,r.createElement("span",null,"\u4e00\u7ea7\u6307\u6807"),r.createElement("span",null,e.aspect1)),r.createElement("p",null,r.createElement("span",null,"\u4e8c\u7ea7\u6307\u6807"),r.createElement("span",null,e.aspect2)),r.createElement("p",null,r.createElement("span",null,"\u6307\u6807\u60c5\u611f"),r.createElement("span",null,"\u8d1f\u9762"))),placement:"bottom"},r.createElement("span",{key:e.aspect2,onMouseEnter:function(){var t;return(null==(t=e.highLightInfoList)?void 0:t.length)>0&&i.setState({currentHighLight:[].concat(e.highLightInfoList),tagHoverInfo:{id:e.msgId,type:"negative"}})},onMouseLeave:function(){return i.setState({currentHighLight:[],tagHoverInfo:{}})}},r.createElement("i",{className:"text"},e.aspect2)))})),!p&&r.createElement("span",{className:"add-bar",onClick:function(){return i.openItem(l.commentId,!1)}},r.createElement(Ae.l,{name:"add-to"})))),a===l.commentId&&i.renderExtend(l),r.createElement("div",{className:"blog-body message-detail"},r.createElement("span",{className:"title line ellipsis",style:{maxWidth:h},title:l.title?l.title:""},"- "+(l.title?l.title:"")),r.createElement("div",null,r.createElement("span",{className:"source line ellipsis"},"\u6765\u6e90\uff1a",l.sourceName),r.createElement("span",{className:"connect line ellipsis",style:{maxWidth:h},title:l.title},"\u94fe\u63a5\uff1a",l.connectionName),r.createElement("a",{href:l.url,target:"_blank",className:"line ellipsis"},"\u6570\u636e\u6e90"),r.createElement("span",{className:"feedback",onClick:function(){return i._handleOnFeedback(l)}},"\u53cd\u9988"),r.createElement(Re.Z,{ref:function(e){return i.drawerRef=e}})))))})):r.createElement("div",{className:"no-data"},r.createElement("img",{src:n(3381)}),r.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e"))))},i.handleLock=function(e){i.setState({lock:!i.state.lock,openItem:null})},i.exportData=function(e){var t=JSON.parse(JSON.stringify(e));t.name=t.leftName,t.leftName="",Le.Z.exportData((0,a.Z)({},t,{type:"COMMENT"}),(function(e){var t=e;2e4===t.code?d.Z.success(t.msg+"\uff0c\u8bf7\u5230\u4e2a\u4eba\u4e2d\u5fc3\u7684\u4e0b\u8f7d\u5217\u8868\u6216\u8005\u70b9\u51fb\u53f3\u4e0a\u89d2\u201c\u5c0f\u94c3\u94db\u201d\u4e0b\u8f7d\u3002"):d.Z.error(t.msg)}))},i.handleReset=function(){i.setState({info:void 0},(function(){var e=i.props.params,t=JSON.parse(JSON.stringify(e));t.filterModel.project=[t.projectId];var n="\u6b63\u9762"===t.seriesName;i.setState({params:t,sourceEmotion:n,searchValue:""},(function(){return i.searchTable(i.info)}))})),i.props.resetMessage()},i.addAspectBorder=function(e){var t=document.querySelectorAll(".blog-foot")[e].children[0]&&document.querySelectorAll(".blog-foot")[e].children[0].children||[],n=document.querySelectorAll(".blog-foot")[e].children[1]&&document.querySelectorAll(".blog-foot")[e].children[1].children||[];if(t.length>0)for(var a=0;a<t.length;a++)t[a].style.borderColor="#00B76E";if(n.length>0)for(var i=0;i<n.length;i++)n[i].style.borderColor="#D96969"},i._handleOnInputChange=function(e){var t=i.state.info;i.setState({searchValue:e},(function(){!e&&i.state.hasSearched&&i.setState({hasSearched:!1},(function(){return i.searchTable(t||null)}))}))},i._handleSearchButtonClick=function(){var e=i.state,t=e.searchValue,n=e.params,a=e.info;a&&void 0!==a.hide&&delete a.hide,n.filterModel.content||t?i.setState({hasSearched:!0},(function(){return i.searchTable(a||null)})):d.Z.warning("\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u8bcd")},i._handleOnFeedback=function(e){var t=i.props.params,a=JSON.parse(JSON.stringify(t));i.drawerRef.show({aspectList:e.aspects,callback:function(t){p.h.post("/data_feedback/save",{feedbackDetails:t,messageId:e.commentId,projectId:a.projectId,messageContent:e.content,historyTag:JSON.stringify(e.aspects.filter((function(e){return e.escore})).map((function(e){return{aspect1:e.aspect1,aspect2:e.aspect2,aspect:e.aspect2,escore:e.escore,highLightInfoList:e.highLightInfoList}})))}).then((function(e){2e4===e.data.code&&De.default.success({style:{marginTop:"85px"},className:"feedback_success_message",content:r.createElement("div",{className:"feedback_success_tip"},r.createElement("img",{src:n(43134)}),r.createElement("p",null,"\u6307\u6807\u53cd\u9988\u6210\u529f\uff0c\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01"))})}))}})},i.state={data:null,isLoading:!0,loadingId:null,info:void 0,searchValue:"",params:{},pageIndex:1,pageSize:20,count:{},sourceEmotion:null,emotion:"",lock:!0,listLoading:!1,aspects:null,selectedIndex:null,lastClickedTime:0,lastClickedMsgId:0,seriesName:[],hasSearched:!1,isInitial:!0,mParams:void 0,currentHighLight:[],tagHoverInfo:{}},i}(0,i.Z)(t,e);var o=t.prototype;return o.cleanData=function(e){for(var t=[],n=function(n){t.some((function(t){return e[n].aspect1===t.aspect1&&e[n].aspect2===t.aspect2&&e[n].escore===t.escore}))||t.push(e[n])},a=0;a<e.length;a++)n(a);return t},o.renderContent=function(e,t,n){var a=(0,O.Lh)(e||""),i=this.state.params,r=i.filterModel.content&&i.filterModel.content[0]&&i.filterModel.content[0].contain,o="aspect"===n?'<a class="highlight-green">':'<a class="highlight-red">';if(t){var s=a.split(""),l=(Array.isArray(t)?t:t.split(",")).map((function(e){return e&&"string"===typeof e&&((e=e.split("-"))[1]=Number(e[0])+Number(e[1])),e})).sort((function(e,t){return t[1]-e[1]}));l.forEach((function(e){(0,Me.W5)(s,e,o)})),a=s.join("")}return r&&r.length>0&&r.forEach((function(e){var t=new RegExp(e,"g"),n='<span class="highlight-yellow">'+e+"</span>";a=a.replace(t,n)})),a},o.componentWillMount=function(){var e=this.props.params,t=this.state.seriesName;if(e){var n=JSON.parse(JSON.stringify(e));n.filterModel.project=[n.projectId];var a="\u6b63\u9762"===n.seriesName;t.push(n.seriesName),this.setState({params:n,sourceEmotion:a,seriesName:t})}else this.setState({params:{},sourceEmotion:"",seriesName:""})},o.componentDidMount=function(){this.props.params&&this.searchTable(this.state.info)},o.UNSAFE_componentWillReceiveProps=function(e){var t=e.params,n=this.state.seriesName;if(t){var a=JSON.parse(JSON.stringify(t));a.filterModel.project=[a.projectId];var i="\u6b63\u9762"===a.seriesName;n.push(a.seriesName),this.setState({params:a,sourceEmotion:i,seriesName:n})}},o.removeAspectBorder=function(e){var t=document.querySelectorAll(".blog-foot")[e].children[0]&&document.querySelectorAll(".blog-foot")[e].children[0].children||[],n=document.querySelectorAll(".blog-foot")[e].children[1]&&document.querySelectorAll(".blog-foot")[e].children[1].children||[];if(t.length>0)for(var a=0;a<t.length;a++)t[a].style.borderColor="transparent";if(n.length>0)for(var i=0;i<n.length;i++)n[i].style.borderColor="transparent"},o.render=function(){var e=this,t=this.state,n=t.params,a=t.data,i=(t.isLoading,t.pageIndex),o=t.count,s=t.pageSize,l=t.info,d=t.searchValue,u=t.mParams,p=this.props.type;this.state.lock;T.Z.hasAuthority("REVIEW_MESSAGE_LOCK");var f=!(!l||!l.opinion&&!l.hide),h="";if(u)h=u.from+" ~ "+u.to;else if(l){if(l.opinion)h=l.opinion;else if(l.content)h=l.content[0].contain[0];else if(l.time){var m=(0,O.LV)(l.time,"WEEK");h="WEEK"===l.type?m.from+" ~ "+m.to:n.dateFilter.from+" ~ "+n.dateFilter.to}}else n.dateFilter&&(h=n.dateFilter.from+" ~ "+n.dateFilter.to);return r.createElement("div",{className:"message-detail-wrapper"},r.createElement("div",{className:"message-top"},r.createElement("div",{className:"left"},r.createElement("span",{style:{marginLeft:5,fontSize:14}},"\u6d88\u606f\u8be6\u60c5"),h&&r.createElement("div",{style:{display:"inline-block"}},r.createElement("span",null,h),r.createElement("span",{onClick:this.handleReset},"\u6e05\u9664\u9009\u62e9"))),r.createElement("div",{className:"total"},4!==p||o.total&&!o.aspectTotal?r.createElement("span",null,"\u5171",r.createElement("i",null," ",o.total||0," "),"\u6761\u6d88\u606f"):r.createElement("span",null,"\u5171",r.createElement("i",null," ",o.total," "),"\u6761\u6d88\u606f\uff0c",r.createElement("i",null," ",o.aspectTotal," "),"\u4e2a\u3010",n.aspect,"\u3011",n.seriesName,"\u6307\u6807")),r.createElement("div",{className:"right"},r.createElement(c.Input,{value:d,disabled:f,className:"keyword-input-wrapper "+(f?"disable":""),onKeyDown:function(t){f||13!==t.keyCode||e._handleSearchButtonClick()},placeholder:"\u8bf7\u8f93\u5165\u5173\u952e\u8bcd",onChange:this._handleOnInputChange,append:r.createElement("i",{onClick:f?void 0:this._handleSearchButtonClick,className:"icon-cem_search "+(f?"disable":"")})}),r.createElement(Q.Z,{options:Ve,onClick:function(t){return"excel"===t&&e.exportData(n)}}))),a&&this.renderAllMessage(a),!!o.total&&r.createElement("div",{className:"pager-container"},r.createElement(c.Pagination,{pageSize:s,className:"pagination",small:!0,total:o.total,layout:"prev, pager, next",currentPage:i,onCurrentChange:this.getPageTable})))},t}(r.Component),Ze=[{type:"sImage",title:"\u5bfc\u51fa\u56fe\u7247"},{type:"sExcel",title:"\u5bfc\u51fa\u6570\u636e"}],We=[{type:"wImage",title:"\u5bfc\u51fa\u56fe\u7247"},{type:"wExcel",title:"\u5bfc\u51fa\u6570\u636e"}];const Je=function(e){var t=e.getScallterChartRef,a=e.getWordcloudChartRef,i=e.onChartClick,o=e.onMoreClick,s=e.onChartMouseOut,l=e.onChartMouseOver,d=e.wcLoading,u=e.loading,p=e.onWordcloudChartFinish,f=e.data,h=f.sOption,m=f.wOption,g=f.chartData;return r.createElement("div",{className:"opinion-chart-wrapper"},r.createElement("div",{className:"scatter"},r.createElement(c.Loading,{loading:d||u,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d",style:{height:"100%",width:"100%"}},g.wordAgeList&&g.wordAgeList.length>0?r.createElement(r.Fragment,null,r.createElement(fe.Z,{option:h,style:{height:"100%"},theme:"yunting_multi_color",onChartReady:t,onEvents:{mouseout:s,mouseover:l}}),r.createElement("div",{className:"tip"},r.createElement(c.Popover,{width:"376",trigger:"hover",content:"\u8be5\u56fe\u8868\u4e3a\u60a8\u663e\u793a\u9009\u4e2d\u7684\u6d88\u606f\u4e2d\u7684\u8bcd\u7684\u65b0\u65e7\u7a0b\u5ea6\u548c\u706b\u70ed\u7a0b\u5ea6\uff0c\u60a8\u53ef\u4ee5\u4ece\u4e2d\u66f4\u76f4\u89c2\u7684\u4e86\u89e3\u7528\u6237\u7684\u5173\u6ce8\u70b9\u7684\u51fa\u73b0\u65f6\u95f4\u548c\u5173\u6ce8\u7a0b\u5ea6\u3002\u57fa\u4e8e\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\uff0c\u7cfb\u7edf\u4f1a\u5bf9\u6d88\u606f\u8fdb\u884c\u5206\u8bcd\u5904\u7406\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5206\u51fa\u6765\u7684\u8bcd\uff0c\u7cfb\u7edf\u4f1a\u8ba1\u7b97\u5176\u7b2c\u4e00\u6b21\u5b58\u5728\u7cfb\u7edf\u4e2d\u7684\u65f6\u957f\u2014\u2014\u5373\u8bcd\u9f84\uff0c\u8bcd\u9f84\u53ef\u4ee5\u6807\u8bc6\u8be5\u8bcd\u7684\u65b0\u65e7\u7a0b\u5ea6\uff0c\u5c24\u5176\u662f\u8bcd\u9f84\u8f83\u5c0f\u7684\u8bcd\u4e00\u822c\u662f\u65b0\u521b\u5efa\u51fa\u6765\u7684\u8bcd\u6c47\u6216\u8005\u8fd1\u671f\u6d41\u884c\u7684\u8bcd\u6c47\u3002\u540c\u65f6\uff0c\u7cfb\u7edf\u4f1a\u7edf\u8ba1\u5177\u4f53\u8bcd\u51fa\u73b0\u7684\u6b21\u6570\u2014\u2014\u8bcd\u9891\uff0c\u8bcd\u9891\u53ef\u4ee5\u6807\u8bc6\u8be5\u8bcd\u7684\u706b\u70ed\u7a0b\u5ea6\u3002",popperClass:"card_pop"},r.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),r.createElement("div",{className:"buttons"},r.createElement(Q.Z,{onClick:o,options:Ze}))):r.createElement("div",{className:"no-data"},r.createElement("img",{src:n(3381)}),r.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))),r.createElement("div",{className:"wordcloud"},r.createElement(c.Loading,{loading:d||u,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d",style:{height:"100%",width:"100%"}},g.list&&g.list.length>0?r.createElement(r.Fragment,null,r.createElement(fe.Z,{option:m,style:{height:"100%",width:"100%"},theme:"yunting_multi_color",onChartReady:a,onEvents:{click:i,mouseout:s,mouseover:l,finished:p}}),r.createElement("div",{className:"buttons"},r.createElement(Q.Z,{onClick:o,options:We}))):r.createElement("div",{className:"no-data"},r.createElement("img",{src:n(3381)}),r.createElement("span",null,"\u6682\u65e0\u53ef\u7528\u6570\u636e")))))};var Be=function(e){function t(t){var n;return(n=e.call(this,t)||this)._resize=function(){n.scatterChartRef&&n.scatterChartRef.resize()},n._fetchData=function(){var e=n.props,t=e.detail,i=e.params;t&&t.projectId&&n.props.fetchWordData((0,a.Z)({projectId:t.projectId,taskId:t.taskId,filterType:"OPINION_TASK"},i))},n._handleOnMoreClick=function(e){var t=n.props.data.chartData;if("sImage"===e)(0,X._v)(n.scatterChartRef,"\u8bcd\u9f84-\u8bcd\u9891\u6563\u70b9\u56fe");else if("wImage"===e)(0,X._v)(n.wordcloudChartRef,"\u8bcd\u4e91\u56fe");else if("sExcel"===e){var a=t.wordAgeList.reduce((function(e,t){return[].concat(e,[[t.keyword,t.age,t.count]])}),[["\u8bcd\u540d","\u8bcd\u9f84","\u8bcd\u9891"]]);(0,X.aT)([a],"\u8bcd\u9f84-\u8bcd\u9891\u6563\u70b9\u56fe")}else if("wExcel"===e){var i=t.list.reduce((function(e,t){return[].concat(e,[[t.name,t.total]])}),[["\u8bcd\u540d","\u8bcd\u9891"]]);(0,X.aT)([i],"\u8bcd\u9f84-\u8bcd\u9891\u6563\u70b9\u56fe")}},n._handleOnChartClick=function(e){var t=e.componentType,a=e.componentSubType,i=e.data.name,r=n.state.selectedWordName,o=n.props.refreshMessage;if("series"===t&&"wordCloud"===a){var s=void 0;r&&r===i?n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",""):(s=i,n.dispatchEchartsAction(n.wordcloudChartRef,"highlight",""),n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",i)),n.setState({selectedWordName:s},(function(){i&&(n.clickTimeId&&clearInterval(n.clickTimeId),n.clickTimeId=setTimeout((function(){o({hide:!!s,content:[{contain:[s?i:""]}]}),n.clickTimeId=void 0}),100))}))}},n._handleOnChartMouseOut=function(e){var t=e.componentType,a=e.componentSubType,i=e.name,r=n.state.selectedWordName;"series"===t&&"wordCloud"===a?(n.dispatchTooltipAction(n.scatterChartRef,"hideTip",i),r&&r!==i&&n.dispatchEchartsAction(n.wordcloudChartRef,"highlight",i)):"series"===t&&"scatter"===a&&n.dispatchTooltipAction(n.wordcloudChartRef,"hideTip",i)},n._handleOnChartMouseOver=function(e){var t=e.componentType,a=e.componentSubType,i=e.name;"series"===t&&"wordCloud"===a?(n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",i),n.dispatchTooltipAction(n.scatterChartRef,"showTip",i),n.dispatchEchartsAction(n.wordcloudChartRef,"downplay",i)):"series"===t&&"scatter"===a&&n.dispatchTooltipAction(n.wordcloudChartRef,"showTip",i)},n.reset=function(){var e=n.state.selectedWordName;e&&n._handleOnChartClick({componentType:"series",componentSubType:"wordCloud",data:{name:e}})},n.dispatchEchartsAction=function(e,t,n){setTimeout((function(){var a={type:t,seriesName:"opinionWordCloud"};n&&(a.name=n),e.dispatchAction(a)}),0)},n.dispatchTooltipAction=function(e,t,n){setTimeout((function(){e.dispatchAction({type:t,name:n,seriesIndex:0})}),0)},n._handleOnWordcloudChartFinish=function(){n.wcTimeoutId&&clearTimeout(n.wcTimeoutId),n.wcTimeoutId=setTimeout((function(){n.setState({wcLoading:!1}),n.wcTimeoutId=void 0}),100)},n.scatterChartRef=void 0,n.wordcloudChartRef=void 0,n.wcTimeoutId=void 0,n.event={onMoreClick:n._handleOnMoreClick,onChartClick:n._handleOnChartClick,onChartMouseOut:n._handleOnChartMouseOut,onChartMouseOver:n._handleOnChartMouseOver,onChartReady:n._handleOnChartReady,onWordcloudChartFinish:n._handleOnWordcloudChartFinish,getScallterChartRef:function(e){return n.scatterChartRef=e},getWordcloudChartRef:function(e){return n.wordcloudChartRef=e}},n.state={selectedWordName:void 0,wcLoading:!0,loading:!0},n}(0,i.Z)(t,e);var n=t.prototype;return n.clearLoading=function(){this.setState({wcLoading:!1,loading:!1})},n.startLoading=function(){this.setState({wcLoading:!0,loading:!0})},n.componentDidMount=function(){this._fetchData(),window.addEventListener("resize",this._resize)},n.componentWillUnmount=function(){var e=this.props.resetData;window.removeEventListener("resize",this._resize),e({topChartData:{chartData:[],sOption:{},wOption:{}}})},n.componentDidUpdate=function(e){if(e.fetchWordDataEffecting&&!this.props.fetchWordDataEffecting){var t=this.state.wcLoading,n=this.props.data.chartData,a=n.wordAgeList,i=n.list;this.setState({loading:!1,wcLoading:(0!==a.length||0!==i.length)&&t})}JSON.stringify(e.detail)!==JSON.stringify(this.props.detail)&&this._fetchData()},n.render=function(){return r.createElement(Je,(0,a.Z)({},this.state,this.props,this.event,this.ref))},t}(r.PureComponent);const qe=(0,ee.connect)((function(e){var t=e.detail,n=e.loading;return{data:t.topChartData,fetchWordDataEffecting:n.effects["detail/fetchWordData"]||!1}}),(function(e){return{fetchWordData:function(t){return e({type:"detail/fetchWordData",payload:t})},resetData:function(t){return e({type:"detail/save",payload:t})}}}),null,{withRef:!0})(Be);var Ye=n(97911),He=function(e){if(Array.isArray(e)){var t=[];return e.includes("\u6b63\u9762\u60c5\u611f")&&t.push("positive"),e.includes("\u8d1f\u9762\u60c5\u611f")&&t.push("negative"),t}return[]},ze=function(e){if(Array.isArray(e)){var t=[];return e.includes("positive")&&t.push("\u6b63\u9762\u60c5\u611f"),e.includes("negative")&&t.push("\u8d1f\u9762\u60c5\u611f"),t}return[]},Ue=function(e){function t(t){var n;return(n=e.call(this,t)||this).changeState=function(e){n.setState(e,(function(){n.updateFilter()}))},n.clickCheckbox=function(e){var t=e.aspect1,a=e.aspect2,i=n.state.limit;i&&(t&&t.length>i||a&&a.length>i)?d.Z.warning("\u5f53\u524d\u6761\u4ef6\u4e0b\u6700\u591a\u652f\u6301\u9009\u62e9"+i+"\u4e2a\u5206\u6790\u6307\u6807"):n.setState(e)},n.clickEmotion=function(e){n.setState({emotion:e})},n.updateFilter=function(){var e=n.state.aspectType,t=n.state,a=t.aspect1,i=t.aspect2;e&&a&&a.length>0?i=[]:i.length>0&&(a=[]),n.setState({aspect1:a,aspect2:i})},n.clickCancelBtn=function(){n.state.aspectShow&&n.props.closePanel()},n.orderAspect=function(e){for(var t=n.state.aspectList,a=[],i=[],r=0;r<t.length;r++){for(var o=!1,s=0;s<e.length;s++)if(t[r].name===e[s]){o=!0,a[s]=t[r];break}o||i.push(t[r])}n.setState({aspectList:a.concat(i)})},n.toggleCheckAll=function(){var e=n.state,t=e.aspect2CheckStatus.allChecked,a=e.allAspect2,i=[];t||(i=JSON.parse(JSON.stringify(a))),n.setState({aspect2:i,aspect2CheckStatus:{allChecked:!t,indeterminate:!1}})},n.handleClickAspect2=function(e){var t=n.state.allAspect2;n.clickCheckbox({aspect2:e}),n.setState({aspect2CheckStatus:{allChecked:t.length===e.length&&e.length>0,indeterminate:0!==e.length&&t.length!==e.length}})},n.state={aspectShow:!1,aspectType:!0,aspect1:[],aspect2:[],emotion:[],rawAspectList:[],aspectList:[],projectId:t.projectId,model:t.model,ready:!1,limit:t.limit,panelWidth:t.panelWidth,allAspect2:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}},n}(0,i.Z)(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){var t=e.aspectShow,n=e.limit,a=e.panelWidth;this.setState({aspectShow:t,limit:n,panelWidth:a})},n.componentDidMount=function(){this.getValue(),window.addEventListener("click",this.clickCancelBtn)},n.componentDidUpdate=function(){this.setLeftBlockHeight()},n.componentWillUnmount=function(){window.removeEventListener("click",this.clickCancelBtn)},n.setLeftBlockHeight=function(){var e=document.querySelectorAll(".analyse-aspect-panel-body .left .new-checkbox-panel .wt-checkbox-group .wt-checkbox"),t=document.querySelectorAll(".analyse-aspect-panel-body .right .new-checkbox-panel .wt-checkbox-group"),n=document.querySelector(".analyse-aspect-panel-body .right");if(document.querySelector(".analyse-aspect-panel-body .emotion").style.height=n.offsetHeight+"px",e.forEach((function(e){return e.style.marginBottom="0"})),t.length>0)for(var a=t.length-1;a>=0;a--){var i=t[a].offsetHeight;i>36&&(e[a].style.marginBottom=i-36+"px")}},n.getValue=function(){var e=this.state,t=e.aspectType,n=e.aspect1,a=e.aspect2,i=e.emotion;if(e.ready)return{aspect1:t?n:[],aspect2:t?[]:a,emotion:He(i)};var r=this.props,o=r.projectId,s=r.model;this.fetchAspects(o,s)},n.getSndIndex=function(e){var t=this.state.aspects[e];return t&&t.length>0&&this.setState({aspectType:!1,aspect1:[],aspect2:t}),t},n.setAspectFromOutside=function(e){var t=this.state.allAspect2,n=e.aspect1,i=e.aspect2,r=e.emotion;e&&this.setState((0,a.Z)({aspectType:n.length>0},e,{emotion:r&&ze(r),aspect2CheckStatus:{allChecked:t.length===i.length&&i.length>0,indeterminate:0!==i.length&&t.length!==i.length}}))},n.fetchAspects=function(e,t){var n=this,a=t.map((function(t){return p.h.post("filter/find",{filterTypes:["ASPECT"],projectId:e,type:t})}));Promise.all(a).then((function(a){a.forEach((function(a){var i=a.data.result,r=n.state.rawAspectList;i.aspect&&n.setState({projectId:e,model:t,rawAspectList:r.concat(i.aspect)})})),n.formatData()}))},n.formatData=function(){var e=this.state,t=e.model,n=e.aspect1,a=e.aspect2,i=e.rawAspectList,r=(e.limit,this.state),o=r.aspectShow,s=r.aspectType,l=i,c={};if("BRAND"===t){var d=l.map((function(e){return e&&JSON.parse(e)})),u=0,p=T.Z.getAuthority();if(p.indexOf("ANALYZE_PRODUCT")>=0&&u++,p.indexOf("ANALYZE_SERVER")>=0&&u++,p.indexOf("ANALYZE_MARKETING")>=0&&u++,0===u)d.forEach((function(e){Object.keys(e).forEach((function(e,t){return c[t]=e}))}));else if(1===u)["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].forEach((function(e,t){p.indexOf(e)>=0&&Object.keys(d[t]).map((function(e,t){return c[t]=e}))}));else if(u>1){if(p.indexOf("ANALYZE_PRODUCT")>=0){var f=Object.keys(d[0]);1===f.length?c["\u4ea7\u54c1"]=d[0][f[0]]:f.length>1&&(c["\u4ea7\u54c1"]=d[0])}if(p.indexOf("ANALYZE_SERVER")>=0){var h=Object.keys(d[1]);1===h.length?c["\u670d\u52a1"]=d[1][h[0]]:h.length>1&&(c["\u670d\u52a1"]=d[1])}if(p.indexOf("ANALYZE_MARKETING")>=0){var m=Object.keys(d[2]);1===m.length?c["\u5e02\u573a"]=d[2][m[0]]:m.length>1&&(c["\u5e02\u573a"]=d[2])}}}else l&&l[0]&&l.forEach((function(e){c=Object.assign.apply(Object,[c].concat(JSON.parse(e)))}));var g=Object.keys(c).map((function(e,t){var n=c[e];return{id:t,name:e,contain:n.length?n:Object.keys(n).map((function(e,t){var a=n[e];return{id:t,name:e,contain:a.length?a:Object.keys(a)}}))}}));g.length<=1&&(o=!1,s=!1);var v=[];Object.keys(c).forEach((function(e){v=v.concat(c[e])})),this.changeState({aspectList:g,aspectShow:o,aspects:c,aspectType:s,aspect1:n,aspect2:a,ready:!0,allAspect2:v})},n.handleClickBlock=function(e,t){var n=this.state,a=n.aspectType;if(n.aspectShow&&a!==e){var i=document.querySelectorAll(".analyse-aspect-panel-body div"),r="disabled";e?this.hanldeClass("remove",i[1],r):this.hanldeClass("remove",i[0],r),e?this.setState({aspectType:e,aspect2:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}}):this.setState({aspectType:e,aspect1:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}})}},n.hanldeClass=function(e,t,n){if("add"===e)(0,I.addClass)(t,n);else(0,I.removeClass)(t,n)},n.clickConfirmBtn=function(){this.props.onChange(),this.props.closePanel()},n.clearOptions=function(){this.setState({aspect1:[],aspect2:[],emotion:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}})},n.render=function(){var e=this,t=this.state,n=t.aspectList,a=t.aspectType,i=t.aspect1,o=t.aspect2,s=t.emotion,l=t.aspectShow,d=t.limit,u=t.panelWidth,p=t.aspect2CheckStatus,f=p.allChecked,h=p.indeterminate;return r.createElement("div",{className:"opinion-analyse-aspect-panel-wrapper",style:{display:l?"block":"none",width:u},onClick:function(e){return e.stopPropagation()}},r.createElement("div",{className:"analyse-aspect-panel-body"},r.createElement("div",{className:"emotion"},r.createElement(Ye.Z,{changeState:function(t){return e.clickEmotion(t)},checkedList:s,ITEMS:["\u6b63\u9762\u60c5\u611f","\u8d1f\u9762\u60c5\u611f"].map((function(e){return e.name||e})),categoryTitle:"\u5168\u90e8\u60c5\u611f",type:"vertical"})),r.createElement("div",{className:a?"left":"left disabled",onClick:function(t){return e.handleClickBlock(!0,t)}},r.createElement(Ye.Z,{changeState:function(t){return e.clickCheckbox({aspect1:t})},checkedList:i,ITEMS:n.map((function(e){return e.name||e})),categoryTitle:"\u4e00\u7ea7\u6307\u6807",type:"vertical",limit:d})),r.createElement("div",{className:a?"right disabled":"right",onClick:function(t){return e.handleClickBlock(!1,t)}},r.createElement("div",null,r.createElement(Z.Jg,{checked:f,indeterminate:h,onChange:this.toggleCheckAll},"\u4e8c\u7ea7\u6307\u6807")),n.length>0&&n.map((function(t,n){return r.createElement(Ye.Z,{changeState:e.handleClickAspect2,checkedList:JSON.parse(JSON.stringify(o)),key:"aspect1-"+n,categoryTitle:t.name,ITEMS:t.contain.map((function(e){return e.name||e})),type:"horizontal",limit:d})})))),r.createElement("div",{className:"analyse-aspect-panel-footer"},r.createElement("span",{onClick:function(){return e.clearOptions()}},"\u6e05\u7a7a\u5168\u90e8\u9009\u9879"),r.createElement("div",null,r.createElement(c.Button,{type:"primary",onClick:function(){return e.clickConfirmBtn()}},"\u786e\u5b9a"),r.createElement("span",{className:"cancelBtn",onClick:function(){return e.clickCancelBtn()}},"\u53d6\u6d88"))))},t}(r.Component),Ke=function(e){function t(t){var n;return(n=e.call(this,t)||this).closePanel=function(){n.setState({showPanel:!1})},n.state={showPanel:!1},n}(0,i.Z)(t,e);var n=t.prototype;return n.togglePanel=function(e){var t=this,n=this.state.showPanel;n&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout((function(){return t.setState({showPanel:!n})}),0)},n.getValue=function(){if(this.panel)return this.panel.getValue()},n.getSndIndex=function(e){return this.panel.getSndIndex(e)},n.setAspectFromOutside=function(e){return this.panel.setAspectFromOutside(e)},n.orderAspect=function(e){this.panel.orderAspect(e)},n.render=function(){var e=this,t=this.state.showPanel;return r.createElement("div",{className:"opinion-analyse-aspect-wrapper"},r.createElement("div",{className:"analyse-aspect-trigger",style:{color:t?"#0847A6":"#8C8C8C"},onClick:function(t){return e.togglePanel(t)}},r.createElement("span",null,"\u6307\u6807\u60c5\u611f"),r.createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":"",color:t?"#0847A6":"#8C8C8C"}})),r.createElement(Ue,(0,a.Z)({ref:function(t){e.panel=t},aspectShow:t,closePanel:this.closePanel},this.props)))},t}(r.Component),Ge=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleAnalyseAspectChange=function(){var e=n.analyseAspect.getValue();n.setState((0,a.Z)({},e)),n.props.onAspectChange(JSON.parse(JSON.stringify(e)))},n.state={aspect:t.aspect,opinionTotal:t.opinionTotal,messageTotal:t.messageTotal},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.state.aspect;this.analyseAspect&&this.analyseAspect.setAspectFromOutside(e)},n.UNSAFE_componentWillReceiveProps=function(e){var t=this.props.aspect,n=e.aspect;JSON.stringify(t)!==JSON.stringify(n)&&this.analyseAspect&&this.analyseAspect.setAspectFromOutside(n),this.setState((0,a.Z)({},e))},n.render=function(){var e=this,t=this.state,n=t.opinionTotal,a=t.messageTotal,i=v.t.get(v.V.curProject).id;return r.createElement("div",{className:"cards-wrapper"},r.createElement("div",{className:"card"},r.createElement("div",{style:{textAlign:"center",fontWeight:"bold"}},r.createElement("span",{className:"card-content"},r.createElement("span",null,"\u6d88\u606f\u6570\uff1a"),r.createElement("span",null,O.ZP.formatNumber(a))),r.createElement(c.Popover,{width:"300",trigger:"hover",content:"\u8be5\u6570\u636e\u4e3a\u60a8\u663e\u793a\uff1a\u7b26\u5408\u5934\u90e8\u7b5b\u9009\u3001\u65f6\u95f4\u8303\u56f4\u548c\u5206\u6790\u5bf9\u8c61\u7684\u6307\u6807\u60c5\u611f\u7684\u6709\u6548\u6d88\u606f\u6570\u3002",popperClass:"card_pop"},r.createElement("i",{className:"icon-cem_file1",style:{marginLeft:"8px",fontSize:"18px",color:"#8c8c8c"}})))),r.createElement("div",{className:"card"},r.createElement("div",{style:{textAlign:"center",fontWeight:"bold"}},r.createElement("span",{className:"card-content"},r.createElement("span",null,"\u89c2\u70b9\u6570\uff1a"),r.createElement("span",null,O.ZP.formatNumber(n))),r.createElement(c.Popover,{width:"376",trigger:"hover",content:"\u8be5\u6570\u636e\u4e3a\u60a8\u663e\u793a\uff1a\u9009\u4e2d\u7684\u6d88\u606f\u6570\u4e2d\u5305\u542b\u7684\u89c2\u70b9\u6570\u3002\u5728\u4e00\u4e2a\u6709\u6548\u8bc4\u8bba\u4e2d\uff0c\u7528\u6237\u4f1a\u8868\u8fbe\u81f3\u5c111\u4e2a\u89c2\u70b9\u3002\u5982\u8bc4\u8bba\u3010\u670d\u52a1\u597d\uff0c\u8d28\u91cf\u597d\uff0c\u8bb2\u89e3\u5230\u4f4d\u3002\u3011\uff0c\u8fd9\u91cc\u8868\u8ff0\u4e863\u4e2a\u89c2\u70b9\u3002\u57fa\u4e8e\u6211\u4eec\u7684\u5178\u578b\u610f\u89c1\u7b97\u6cd5\uff0c\u6211\u4eec\u4f1a\u5c06\u4f9d\u636e\u7528\u6237\u7684\u8868\u8ff0\u5c06\u4e00\u4e2a\u6d88\u606f\u7ec6\u5316\u5904\u7406\u4e3a\u89c2\u70b9\u3002",popperClass:"card_pop"},r.createElement("i",{className:"icon-cem_file1",style:{marginLeft:"8px",fontSize:"18px",color:"#8c8c8c"}})))),r.createElement("div",{className:"card"},r.createElement("div",null,r.createElement(Ke,{ref:function(t){return e.analyseAspect=t},limit:null,model:["PRODUCT","MARKETING","SERVICE"],projectId:i,onChange:this.handleAnalyseAspectChange}))))},t}(r.PureComponent),Qe=n(55815),Xe=function(e){if(Object.keys(e).length>0){var t=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach((function(e){t[e]||delete t[e]})),delete t.aspect,t}return{}},$e=function(e){return e?{from:e.from,to:e.to,quickChoice:e.quickChoice,dateGroupType:e.dateGroupType,remoteName:e.remoteName}:null},et=function(e){if(!e.analysis)return e;var t=JSON.parse(JSON.stringify(e)),n=t.analysis,a=n.id,i=n.type,r=n.values;switch(i){case"CONN_CONFIG":t.connConfig=[{id:a,special:"connConfig",values:r}];break;case"SOURCE":t.source=r}return t},tt=function(e){function t(t){var n;(n=e.call(this,t)||this).fetchOpinionDetail=function(e){var t=n.props.dispatch;t({type:"opinionChart/reset"});var i=v.t.get(v.V.curProject).id;p.h.post("/user/opinion/find",(0,a.Z)({},e)).then((function(e){var r=e.data;if(2e4===r.code){var o=r.result,s=o.id,l=o.name,c=(o.sequence,o.date),d=o.filter,u=o.messageTotal,p=o.opinionTotal,f=o.status;if(!c||!d)return n.opinionChart&&n.opinionChart.getWrappedInstance().clearLoading(),void t({type:"opinionChart/save",payload:{loading:!1}});d&&!d.aspect&&(d.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]});var h=function(e){if(e){var t=JSON.parse(JSON.stringify(e)),n=t.quickChoice;if(-1===t.quickChoice.indexOf("-")){var i=j.indexOf(n),r=V(i),o=r[0],s=r[1];return(0,a.Z)({},t,{from:o,to:s})}return t}}(c),m={projectId:i,taskId:s||"",leftName:"",analyseName:"",type:"EMOTION_ASPECT_LEVEL_BAR",aspect:"",aspectTotal:u||0,seriesName:"",dateFilter:h,filterModel:d||{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}}};n.setState({type:2,params:m,detail:{projectId:i,taskId:s,taskName:window.location.host.substr(0,1).toUpperCase()+"-"+r.result.sequence},currOpinonObj:{id:s,name:l,messageTotal:u,opinionTotal:p,status:f,filter:{filterModel:d||{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:h},mode:s&&!l?"save":"rename"}},(function(){var e=p>=20&&u>=50&&u<=5e5&&"DISABLE"!==f,a=0;e||(p<20?a=1:u<50?a=2:u>5e5&&(a=3)),t({type:"opinionChart/save",payload:{opinionTaskValid:e,invalidReason:a,refreshing:e&&"FINISH"!==f,messageTotal:u,reloaded:e}}),e&&t({type:"opinionChart/resetClusterOptions"}),n.refreshData()}))}}))},n.createOpinionTask=function(e){var t=n.props.dispatch,i=n.state,r=(i.currOpinonObj,i.type),o=i.detail;t({type:"opinionChart/reset"}),4!==r&&o.taskId&&n.opinionChart&&n.opinionChart.getWrappedInstance().startLoading(),e.filterModel.aspect||(e.filterModel.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]}),p.h.post("/opinion/add",(0,a.Z)({projectId:v.t.get(v.V.curProject).id,filterType:"OPINION_TASK"},e,{temp:4===r?"1":""})).then((function(i){if(2e4===i.data.code&&i.data.result){var s=n.state.currOpinonObj,l=i.data.result,c=l.id,d=l.messageTotal,u=l.opinionTotal,p=(l.name,l.sequence),f=l.status,h=l.filter,m=l.date,g=3===r?(0,a.Z)({},n.state.params,{taskId:c,filterModel:e.taskId?h:e.filterModel,dateFilter:e.taskId?m:e.dateFilter,aspectTotal:u}):(0,a.Z)({},n.state.params,{taskId:c});e.taskId&&(s.filter={filterModel:h,dateFilter:m}),n.setState({currOpinonObj:(0,a.Z)({},s,{status:f,id:c,sequence:p,messageTotal:d,opinionTotal:u}),params:g,detail:(0,a.Z)({},o,{taskId:c})},(function(){if(n.refreshData(!0),"FINISH"===f)return t({type:"opinionChart/save",payload:{opinionTaskValid:!0,invalidReason:0,refreshing:!1,clusterType:20,messageTotal:d,loading:!0}}),void setTimeout((function(){t({type:"opinionChart/getWordCloudList"})}),200);var e=u>=20&&d>=50&&d<=5e5&&"DISABLE"!==f,a=0;e||(u<20?a=1:d<50?a=2:d>5e5&&(a=3)),t({type:"opinionChart/save",payload:{opinionTaskValid:e,invalidReason:a,refreshing:e&&"FINISH"!==f,clusterType:20,messageTotal:d,loading:e&&"FINISH"!==f}})}))}}))},n.onFilterChange=function(){var e=n.state,t=e.currOpinonObj,i=e.params,r=e.type,o={filterModel:Xe(i.filterModel),dateFilter:$e(i.dateFilter)};delete o.filterModel.aspect;var s=n.filter&&n.filter.getValue(),l=s.filterModel,c=s.dateFilter;if(!S(o,{filterModel:Xe(l),dateFilter:c})){t.changed=!0,t.mode=1===r?"save":"update";var d=i.filterModel.aspect;n.createOpinionTask({filterModel:(0,a.Z)({aspect:d},l),dateFilter:c}),i.dateFilter=c,i.filterModel=(0,a.Z)({aspect:d},l),t.filter={dateFilter:c,filterModel:(0,a.Z)({aspect:d},l)},n.setState({currOpinonObj:t,params:i})}},n.handleOnFilterReady=function(){},n.onAspectChange=function(e){var t=n.state,a=t.currOpinonObj,i=t.params,r=t.params,o=r.filterModel,s=r.dateFilter,l=t.type;if(!S(e,a.filter.filterModel.aspect)){var c=JSON.parse(JSON.stringify(o));c.aspect=e,a.changed=!0,a.mode=1===l?"save":"update",a.filter.filterModel=c,i.filterModel=c,n.createOpinionTask({filterModel:c,dateFilter:s}),n.setState({currOpinonObj:a,params:i})}},n.refreshData=function(e){var t=n.state,i=t.detail,r=t.params,o=t.type,s=n.props.dispatch;4!==o&&i.taskId&&s({type:"detail/fetchWordData",payload:(0,a.Z)({projectId:i.projectId,taskId:i.taskId,filterType:"OPINION_TASK"},r)}),4!==o&&!e&&s({type:"opinionChart/getWordCloudList"}),n.message.searchTable()},n.refreshMenuList=function(){return(0,n.props.dispatch)({type:"menu/fetchMenuList"})},n.updateCurrOpinonObj=function(e){var t=n.state.currOpinonObj;e?n.setState({currOpinonObj:e}):(t.mode="update",n.setState({currOpinonObj:t}))};var i=4,r=location.pathname;return r.startsWith("/opinion")&&(i=3===r.split("/").length?2:location.search?3:1),n.state={params:{analyseName:"",aspect:"",aspectTotal:0,leftName:"",projectId:v.t.get(v.V.curProject)&&v.t.get(v.V.curProject).id||"",seriesName:"",taskId:"",type:"EMOTION_ASPECT_LEVEL_BAR",filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},detail:{projectId:"",taskId:"",taskName:""},type:i,currOpinonObj:{id:"",name:"",status:status,filter:{filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},messageTotal:0,opinionTotal:0,changed:!1,mode:"update"}},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=v.t.get(v.V.curProject).id,n=decodeURIComponent(window.location.search).substr(1),a=location.pathname;if(a.startsWith("/opinion"))if(3===a.split("/").length){var i=a.split("/")[2];this.fetchOpinionDetail({id:i})}else{var r=location.search;if(location.search){var o=r.indexOf("id=")+3,s=r.indexOf("&"),l=r.substring(o,s),c=this.state.currOpinonObj;c.changed=!0,this.setState({type:3,currOpinonObj:c},(function(){return e.createOpinionTask({taskId:l,filterModel:{},dateFilter:{}})}))}else this.fetchOpinionDetail({projectId:t})}else{var d=this.props.dispatch,u=JSON.parse(n),p=u.filterModel,f=u.dateFilter,h=!1,m=v.t.get(v.V.opinionDetail);if(m&&m.uri&&m.uri===n){h=!0;var g=v.t.get(v.V.opinionDetail),y=g.data[20];u.taskId=g.taskId,d({type:"opinionChart/save",payload:{hasRecord:!0,allData:g.data,json_word:y,loading:!1}})}this.setState({params:u,type:4},(function(){h?e.message.searchTable():(e.createOpinionTask({filterModel:p,dateFilter:f}),d({type:"opinionChart/save",payload:{loading:!0}}))}))}},n.render=function(){var e=this,t=this.state,n=t.params,a=t.detail,i=t.currOpinonObj,o=t.currOpinonObj,s=o.messageTotal,l=o.opinionTotal,c=(o.filter,o.filter.filterModel.aspect),d=t.type,u=n&&n.filterModel||{},p=n&&n.dateFilter||null;return r.createElement("div",{className:"detail-wrapper"},4!==d&&r.createElement(r.Fragment,null,r.createElement(U,{ref:function(t){return e.filter=t},model:"MARKETING",title:"\u5178\u578b\u610f\u89c1",values:4!==d?{dateFilter:p,filterModel:JSON.parse(JSON.stringify(et(u)))}:{},showList:["condition","time","opinion"],filterCondition:Object.assign({filter:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"],filterConfig:["KEY_WORD","ESCORE"]}),currOpinonObj:JSON.parse(JSON.stringify(i)),onChange:this.onFilterChange,onFilterReady:this.handleOnFilterReady,refreshMenuList:this.refreshMenuList,updateCurrOpinonObj:this.updateCurrOpinonObj}),r.createElement(Ge,{messageTotal:s,opinionTotal:l,aspect:JSON.parse(JSON.stringify(c)),onAspectChange:this.onAspectChange})),4===d&&r.createElement(Qe.Z,{title:"\u8be6\u60c5\uff1a"+n.analyseName+"\uff0c"+n.aspect+"\uff0c"+n.seriesName}),r.createElement("div",{className:4!==d?"content-sidebar":"content"},4!==d&&r.createElement(qe,{ref:function(t){return e.opinionChart=t},detail:a,params:{filterModel:u,dateFilter:p},refreshMessage:function(t){e.detailChart&&e.detailChart.getWrappedInstance().resetWordcloudState(),e.message&&e.message.searchTable(t)}}),r.createElement(Ie,{params:n,taskId:i.id&&i.id||n.taskId,ref:function(t){return e.detailChart=t},type:d,refreshMessage:function(t){e.opinionChart&&e.opinionChart.getWrappedInstance().reset(),e.message&&e.message.searchTable(t)}}),r.createElement(Pe,{params:n,ref:function(t){return e.message=t},resetMessage:function(){e.detailChart&&e.detailChart.getWrappedInstance().resetWordcloudState(),e.detailChart&&e.detailChart.getWrappedInstance().resetBarchartState(),e.opinionChart&&e.opinionChart.getWrappedInstance().reset()},type:d})))},t}(r.Component);const nt=(0,ee.connect)()(tt)}}]);