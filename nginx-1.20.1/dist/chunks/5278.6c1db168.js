(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5278],{97911:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var t=n(85354),l=n.n(t),t=n(67294),r=n.n(t),u=n(85151),a=n(5133),i=function(i){function e(){for(var s,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(s=i.call.apply(i,[this].concat(t))||this).handleCheckedAll=function(e){var t=s.props,n=t.ITEMS,i=t.changeState,t=t.checkedList,l=[];e.target.checked?(t.map(function(e){return l.push(e)}),n.filter(function(e){return l.indexOf(e)<0}).map(function(e){return l.push(e)})):t.filter(function(e){return n.indexOf(e)<0}).map(function(e){return l.push(e)}),i&&i(l)},s.handleChange=function(e){var t=s.props,n=t.changeState,i=t.checkedList,t=t.limit;Array.prototype.remove=function(e){e=this.indexOf(e);-1<e&&this.splice(e,1)},t?-1===i.indexOf(e)?i.length<t?i.push(e):a.Z.warning("当前条件下最多支持选择"+t+"个分析指标"):i.remove(e):-1===i.indexOf(e)?i.push(e):i.remove(e),n&&n(i)},s}return l()(e,i),e.prototype.render=function(){var t=this,e=this.props,n=e.ITEMS,i=e.categoryTitle,l=e.titles,s=e.checkedList,a=e.type,o=(e.limit,s.filter(function(e){return 0<=n.indexOf(e)})),e=!!o.length&&o.length===n.length,o=!!o.length&&o.length!==n.length;return r().createElement("div",{className:"vertical"===a?"new-checkbox-panel new-checkbox-panel-vertical":"new-checkbox-panel"},r().createElement(u.Jg,{checked:e,indeterminate:o,onChange:this.handleCheckedAll},i||"全选"),r().createElement(u.CS,{checkedList:s,onChange:function(e){return t.handleChange(e)}},n&&n.map(function(e,t){return r().createElement(u.Jg,{key:t,value:e},l?l[e]:e)})))},e}(t.Component)},87729:(e,t,n)=>{"use strict";n.d(t,{Uq:()=>m,ZP:()=>v});var i=n(85354),l=n.n(i),t=n(67294),u=n.n(t),i=n(67154),a=n.n(i),i=n(45697),i=n.n(i),r=n(92360),s=n(36144),o=n(35239),c=function(t){function e(e){var n=t.call(this,e)||this;return n._setEvent=function(e){return 0===e?{onMouseEnter:function(){n.setState({firstLiHover:!0})},onMouseLeave:function(){n.setState({firstLiHover:!1})}}:{}},n.setDefaultValue=function(){var t=n.getValue();s.h.post("/default/value/update",{projectId:o.t.get(o.V.curProject).id,key:"PRODUCT_ANALYSIS_OBJ",value:JSON.stringify(t)}).then(function(e){n.setState({defaultSelectValue:t,shouldUpdataDefaultSelectValue:!1})})},n.state={options:[{}],sel:[{name:""},{name:""}],defaultSelectValue:n.props.defaultSelectValue,shouldUpdataDefaultSelectValue:!0,value:{},firstLiHover:!1},n}l()(e,t);var n=e.prototype;return n.onSel=function(e,t){var n=this,i=this.state.options;i.forEach(function(e){return e.sel=!1}),i[t].sel=!0,this.setState({options:i},function(e){return n.props.onChange&&n.props.onChange(n.getValue())})},n.getValue=function(){return JSON.parse(JSON.stringify(this.state.options)).filter(function(e){return e.sel})[0]},n.UNSAFE_componentWillReceiveProps=function(e){var t,n;(e.options||e.value)&&(t=JSON.parse(JSON.stringify(e.options)),n=JSON.parse(JSON.stringify(e.value)),t.forEach(function(e){e.id===n.id&&(e.sel=!0)}),this.setState({options:t,value:n}),this.state.shouldUpdataDefaultSelectValue&&this.setState({defaultSelectValue:e.defaultSelectValue}))},n.UNSAFE_componentWillMount=function(){var e=this.props.options,t=this.props.value||{};e.forEach(function(e){e.id===t.id&&(e.sel=!0)}),this.setState({options:e,value:t})},n.componentWillUnmount=function(){},n.render=function(){var n=this,e=this.state,t=e.options,i=e.defaultSelectValue,e=t[0]&&t[0].sel;return u().createElement("div",{className:"selItem "+(this.props.triangle?"triangle":"")+" "+(this.state.firstLiHover||e?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},u().createElement("div",{className:"wrap"},u().createElement("ul",null,0<t.length?t.map(function(e,t){return u().createElement("li",a()({className:(e.sel?"sel":"")+(e.disable?" disable":""),key:t,onClick:function(e){return n.onSel(e,t)}},n._setEvent(t)),u().createElement("span",null,e.name),!n.props.noCollect&&e.sel&&u().createElement("i",{className:"default icon-cem_star",style:{color:i.id===e.id?"#D5B437":"#8C8C8C",opacity:i.id===e.id?"1":""},onClick:i.id===e.id?null:n.setDefaultValue}),u().createElement("i",{className:"check cem-icon icon-cem_arrow-thick"}))}):u().createElement("div",{className:"noData"},"无数据"))))},e}(t.Component);c.propTypes={noCollect:i().bool,options:i().array,value:i().object,onChange:i().func};var p=n(5133),f=n(85151),h=function(e){function t(){var s=e.call(this)||this;return s.sortList=function(e,t,n){n.stopPropagation(),n.nativeEvent.stopImmediatePropagation();var i=JSON.parse(JSON.stringify(s.state.value)),l=i.splice(e,1)[0];switch(t){case"top":i.unshift(l);break;case"up":i.splice(e-1,0,l);break;case"down":i.splice(e+1,0,l)}s.setState({value:i},function(e){return s.props.onChange&&s.props.onChange(s.getValue())})},s._setEvent=function(e){return 0===e?{onMouseEnter:function(){s.setState({firstLiHover:!0})},onMouseLeave:function(){s.setState({firstLiHover:!1})}}:{}},s.state={options:[],value:[],showSel:!1,firstLiHover:!1,searchWord:""},s}l()(t,e);var n=t.prototype;return n.onSel=function(e,n){var t=this,i=this.state.options,l=this.state.value;!n.sel&&this.props.limit&&l.length>=this.props.limit?p.Z.warning("最多选择"+this.props.limit+"个对象！"):(i.forEach(function(e){e.id===n.id&&(t.props.singelSel?(e.sel=!0,l=[e]):(e.sel=!e.sel,e.sel?l.push(e):l.some(function(e,t){return e.id===n.id&&(l.splice(t,1),!0)})))}),this.setState({options:i,value:l},function(e){return t.props.onChange&&t.props.onChange(t.getValue())}))},n.getValue=function(){return this.state.value},n.UNSAFE_componentWillReceiveProps=function(e){var t,n;(e.options||e.value)&&(t=JSON.parse(JSON.stringify(e.options)),n=JSON.parse(JSON.stringify(e.value)),t.forEach(function(e){n.map(function(e){return e.id}).includes(e.id)?e.sel=!0:e.sel=!1}),this.setState({options:t,value:n}))},n.UNSAFE_componentWillMount=function(){var e=this.props,t=e.options,e=e.value,n=void 0===e?[]:e;t.forEach(function(e){n.map(function(e){return e.id}).includes(e.id)&&(e.sel=!0)}),this.setState({options:t,value:n})},n.componentWillUnmount=function(){},n.render=function(){var i=this,e=this.state,n=e.options,t=e.value,l=e.searchWord,s=[];return 0<t.length&&0<n.filter(function(e){return e.sel}).length&&t.forEach(function(t){n.filter(function(e){return e.id===t.id})[0]&&s.push(n.filter(function(e){return e.id===t.id})[0])}),u().createElement("div",{className:"analyze-object-sort-select"},u().createElement("div",{className:"selItem "+(this.props.triangle?"triangle":"")+" "+(this.state.firstLiHover?"selPadHover":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},u().createElement("div",{className:"wrap"},u().createElement("div",null,u().createElement(r.Input,{value:l,placeholder:"输入搜索关键词",className:"search",icon:"close",onChange:function(e){return i.setState({searchWord:e})},onIconClick:function(){return i.setState({searchWord:""})}})),u().createElement("ul",null,0<s.length&&s.filter(function(e){return!l||-1!==e.name.toLocaleLowerCase().indexOf(l.trim().toLocaleLowerCase())}).map(function(t,n){return u().createElement("li",a()({className:(t.sel?"sel":"")+(t.disable?" disable":""),key:n,onClick:function(e){return i.props.singelSel?"":i.onSel(e,t)}},i._setEvent(n)),!i.props.singelSel&&u().createElement(f.Jg,{className:"check-all",checked:t.sel,onChange:function(e){}}),u().createElement("span",null,t.name),!i.props.singelSel&&u().createElement("div",{className:"handle"},0!==n&&u().createElement("i",{title:"置顶",onClick:function(e){i.sortList(n,"top",e)},className:"icon-cem_roof-placement"}),0!==n&&u().createElement("i",{title:"上一位",onClick:function(e){i.sortList(n,"up",e)},className:"icon-cem_upper"}),n!==s.length-1&&u().createElement("i",{title:"下一位",onClick:function(e){i.sortList(n,"down",e)},className:"icon-cem_lower"})))}),0<s.length&&0<n.filter(function(e){return!e.sel}).length&&u().createElement("div",{className:"line"}),0<n.filter(function(e){return!e.sel}).length&&n.filter(function(e){return!e.sel}).filter(function(e){return!l||-1!==e.name.toLocaleLowerCase().indexOf(l.trim().toLocaleLowerCase())}).map(function(t,e){return u().createElement("li",{className:(t.sel?"sel":"")+(t.disable?" disable":""),key:e,onClick:function(e){return i.onSel(e,t)}},!i.props.singelSel&&u().createElement(f.Jg,{className:"check-all",checked:t.sel,onChange:function(e){}}),u().createElement("span",{className:"dark"},t.name))}),0===n.length&&u().createElement("div",{className:"noData"},"无数据")))))},t}(t.Component);h.propTypes={options:i().array,value:i().array,onChange:i().func,singelSel:i().bool};var d={trend:"1个对象多个指标，1个指标多个对象",emotion:"10个分析对象，10个分析指标"},i=function(t){function e(e){var s=t.call(this,e)||this;return s.stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},s.setShowSelFalse=function(){s.state.show&&s.cancel(),s.state.show&&s.setState({show:!1})},s.cancel=function(){s.setState({show:!1})},s.getList=function(e){e&&"filter-list"!==e.key||s.setState({list:o.t.get(o.V.filterList)?JSON.parse(o.t.get(o.V.filterList)).list.filter(function(e){return 0<e.values.length&&"escore"!==e.id&&"messageType"!==e.id}):[],allFilterValue:o.t.get(o.V.filterList)?JSON.parse(o.t.get(o.V.filterList)).value:[]},function(){o.t.get(o.V.filterList)&&JSON.parse(o.t.get(o.V.filterList)).list.filter(function(e){return 0===e.values.length}).map(function(e){return e.id}).includes(s.state.selectValue&&s.state.selectValue.id)?s.setDefaultValue():s.state.selectValue&&s.state.selectValue.id&&s.competeSortSelectValue(s.props.onChange)})},s.competeSortSelectValue=function(e){var t=s.state,n=t.selectValue,i=t.allFilterValue,l=t.list,t=[];i.some(function(e){return e.id===n.id})?t=i.filter(function(e){return e.id===n.id})[0].values.map(function(e){return{id:e}}):l.some(function(e){return e.id===n.id})&&(t=l.some(function(e){return e.id===n.id})?l.filter(function(e){return e.id===n.id})[0].values.slice(0,!s.props.limit||10<s.props.limit?10:s.props.limit):[]),s.setState({sortSelectValue:t},function(){return e&&e(s.getValue())})},s.onSelChange=function(e,t){var n;s.setState(((n={})[e]=t,n),function(){"sortSelectValue"===e||"selectValue"===e&&s.competeSortSelectValue(),s.getSecondLevelList()})},s.getSecondLevelList=function(){var t=s.getValue(),e=s.state.list.filter(function(e){return e.id===t.id})[0]?s.state.list.filter(function(e){return e.id===t.id})[0].values:[],n=e.filter(function(e){return 0===t.values.length||t.values.includes(e.id)});return{list:e,valueList:n,id:t.id,name:t.name}},s.state={list:[],allFilterValue:[],defaultSelectValue:{},selectValue:{},sortSelectValue:[],show:!1,triangle:"select"},s}l()(e,t);var n=e.prototype;return n.UNSAFE_componentWillMount=function(){this.props.left&&this.props.left<-200&&this.setState({triangle:"sortSelect"})},n.componentDidMount=function(){var t=this;this.getList(),setTimeout(function(){return t.getDefault()},300),window.addEventListener("setItemEvent",this.getList),window.addEventListener("click",this.setShowSelFalse),this.props.left&&document.querySelectorAll(".filter-link-analyze-object").forEach(function(e){return e.style.setProperty("--x",t.props.left+"px")})},n.componentWillUnmount=function(){window.removeEventListener("setItemEvent",this.getList),window.removeEventListener("click",this.setShowSelFalse)},n.setDefaultValue=function(){var t,n=this,i=this.state.defaultSelectValue;t=i&&this.state.list.some(function(e){return e.id===i.id})?i:this.props.defaultSelValue&&this.state.list.some(function(e){return e.id===n.props.defaultSelValue.id})?this.state.list.filter(function(e){return e.id===n.props.defaultSelValue.id})[0]:this.state.list[0];var e=this.state.list.some(function(e){return e.id===t.id})?this.state.list.filter(function(e){return e.id===t.id})[0].values.slice(0,1):[];this.setState({selectValue:t,sortSelectValue:e},function(){n.competeSortSelectValue(n.props.onChange)})},n.getDefault=function(){var t=this;s.h.post("/default/value/find",{projectId:o.t.get(o.V.curProject).id,key:"PRODUCT_ANALYSIS_OBJ"}).then(function(e){e.data.result?t.setState({defaultSelectValue:JSON.parse(e.data.result)},function(){return t.setDefaultValue()}):t.setDefaultValue()})},n.saveValue=function(){var t=this,e=JSON.parse(o.t.get(o.V.filterList));0<e.value.length&&e.value.some(function(e){return e.id===t.state.selectValue.id})?e.value.forEach(function(e){e.id===t.state.selectValue.id&&(e.values=t.state.sortSelectValue.map(function(e){return e.id}))}):e.value.push({id:this.state.selectValue.id,special:e.list.filter(function(e){return e.id===t.state.selectValue.id})[0].special,values:this.state.sortSelectValue.map(function(e){return e.id})}),o.t.set(o.V.filterList,JSON.stringify(e));e=new Event("setItemEvent");e.key="save-value",window.dispatchEvent(e)},n.getValue=function(){var t=this;if(this.state.selectValue&&this.state.selectValue.id){var n=(n=JSON.parse(o.t.get(o.V.filterList)).list.filter(function(e){return e.id===t.state.selectValue.id})[0])?n.values.map(function(e){return e.id}):[],e=this.state.sortSelectValue.filter(function(e){return n.includes(e.id)}).map(function(e){return e.id});return{id:this.state.selectValue.id,values:e,name:this.state.selectValue.name,type:this.state.selectValue.special}}return{}},n.changeShow=function(e){var t=this;this.state.show&&this.stop(e),setTimeout(function(){t.setState({show:!t.state.show})},0)},n.render=function(){var t=this,e=this.state,n=e.list,i=e.selectValue,l=e.sortSelectValue,s=e.defaultSelectValue,a=e.show,o=e.triangle,e=n.map(function(e){return{id:e.id,name:e.name,special:e.special}}),n=n.filter(function(e){return i&&"undefined"!==i.id&&e.id===i.id})[0]?n.filter(function(e){return e.id===i.id})[0].values.map(function(e){return delete e.sel,e}):[];return u().createElement("div",{className:"filter-link-analyze-object",style:this.props.style||{}},u().createElement("div",{className:"analyze-object-select",onClick:function(e){return t.changeShow(e)}},u().createElement("div",{className:"infor "+(a?"sel":"")},u().createElement("span",null,"分析对象"),u().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:a?"rotate(-180deg)":""}})),a&&u().createElement(c,{options:e,defaultSelectValue:s,value:i,onChange:function(e){return t.onSelChange("selectValue",e)},triangle:"select"===o})),a&&u().createElement(h,{options:n,limit:this.props.limit,value:l,onChange:function(e){return t.onSelChange("sortSelectValue",e)},triangle:"sortSelect"===o}),a&&u().createElement("div",{className:"footer",onClick:function(e){return t.stop(e)}},this.props.type&&u().createElement("p",{className:"tips"},u().createElement("span",null,"图表支持："),d[this.props.type]),0<e.length&&u().createElement("div",{className:"control"},u().createElement(r.Button,{type:"primary",disabled:!(e.length&&n.length&&i.id&&l.length),onClick:function(){t.cancel(),t.props.onChange&&t.props.onChange(t.getValue())}},"确定"),u().createElement("span",{className:"cancel",onClick:function(){return t.cancel()}},"取消"))))},e}(t.Component),m=function(t){function e(e){var i=t.call(this,e)||this;return i.stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},i.setShowSelFalse=function(){i.state.show&&i.cancel(),i.state.show&&i.setState({show:!1})},i.cancel=function(){i.setState({show:!1})},i.getFilterList=function(){s.h.post("/filter/find",{type:"PRODUCT",filterTypes:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"],projectId:i.props.projectId}).then(function(e){var t;i.setState({list:(e=e.data.result,t=[],e.topics&&e.topics.titles&&0<e.topics.titles.length&&t.push.apply(t,e.topics.titles.filter(function(e){return e.special="connConfig",1<e.values.length})),e.source&&0<e.source.length&&t.push({id:"source",name:"数据来源",special:"source",values:e.source}),e.tag&&0<e.tag.length&&e.tag.forEach(function(e){e.special="tag",t.push(e)}),e.expandTopics&&t.push({id:"expandTopic",name:"组合分析",special:"expandTopic",values:e.expandTopics}),JSON.parse(JSON.stringify(t)))},function(){return i.getDefault()})})},i.onSelChange=function(e,t){var n;i.setState(((n={})[e]=t,n),function(){"sortSelectValue"===e&&(i.cancel(),i.props.onChange&&i.props.onChange(i.getValue()))})},i.getSecondLevelList=function(){var t=i.getValue(),e=i.state.list.filter(function(e){return e.id===t.id})[0].values,n=e.filter(function(e){return 0===t.values.length||t.values.includes(e.id)});return{list:e,valueList:n,id:t.id,name:t.name}},i.state={list:[],defaultSelectValue:{},selectValue:{},sortSelectValue:[],show:!1,triangle:"select"},i}l()(e,t);var n=e.prototype;return n.UNSAFE_componentWillMount=function(){var e;this.props.left&&this.props.left<-200&&this.setState({triangle:"sortSelect"}),this.props.value&&(e=this.props.value,this.setState({selectValue:{id:e.id,special:{CONN_CONFIG:"connConfig",SOURCE:"source",ESCORE:"escore",TAG:"tag"}[e.type],name:e.name},sortSelectValue:e.values}))},n.componentDidMount=function(){var t=this;this.getFilterList(),window.addEventListener("click",this.setShowSelFalse),this.props.left&&document.querySelectorAll(".analyze-object").forEach(function(e){return e.style.setProperty("--x",t.props.left+"px")})},n.componentWillUnmount=function(){window.removeEventListener("click",this.setShowSelFalse)},n.setDefaultValue=function(){return"暂不设置"},n.getDefault=function(){var t=this;s.h.post("/default/value/find",{projectId:o.t.get(o.V.curProject).id,key:"PRODUCT_ANALYSIS_OBJ"}).then(function(e){e.data.result?t.setState({defaultSelectValue:JSON.parse(e.data.result)},function(){return t.setDefaultValue()}):t.setDefaultValue()})},n.saveValue=function(){var t=this,e=JSON.parse(o.t.get(o.V.filterList));0<e.value.length&&e.value.some(function(e){return e.id===t.state.selectValue.id})?e.value.forEach(function(e){e.id===t.state.selectValue.id&&(e.values=t.state.sortSelectValue.map(function(e){return e.id}))}):e.value.push({id:this.state.selectValue.id,special:e.list.filter(function(e){return e.id===t.state.selectValue.id})[0].special,values:this.state.sortSelectValue.map(function(e){return e.id})}),o.t.set(o.V.filterList,JSON.stringify(e));e=new Event("setItemEvent");e.key="save-value",window.dispatchEvent(e)},n.getValue=function(){return this.state.selectValue.id?{id:this.state.selectValue.id,values:this.state.sortSelectValue,name:this.state.selectValue.name,type:this.state.selectValue.special}:{}},n.changeShow=function(e){var t=this;this.state.show&&this.stop(e),setTimeout(function(){t.setState({show:!t.state.show})},0)},n.render=function(){var t=this,e=this.state,n=e.list,i=e.selectValue,l=e.sortSelectValue,s=e.defaultSelectValue,a=e.show,o=e.triangle,r=n.map(function(e){return{id:e.id,name:e.name,special:e.special}}),e=n.filter(function(e){return e.id===i.id})[0]?n.filter(function(e){return e.id===i.id})[0].values.map(function(e){return delete e.sel,e}):[],n=this.props.singelSel?l[0]?l[0].name||e&&e.filter(function(e){return e.id===l[0].id})[0]&&e.filter(function(e){return e.id===l[0].id})[0].name:"请选择":"分析对象";return u().createElement("div",{className:"analyze-object",style:this.props.style||{}},u().createElement("div",{className:"analyze-object-select",onClick:function(e){return t.changeShow(e)}},u().createElement("div",{className:"infor "+(a?"sel":"")},u().createElement("span",null,n),u().createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:a?"rotate(-180deg)":""}})),a&&u().createElement(c,{noCollect:!0,options:r,defaultSelectValue:s,value:i,onChange:function(e){return t.onSelChange("selectValue",e)},triangle:"select"===o})),a&&u().createElement(h,{singelSel:this.props.singelSel,options:e,limit:this.props.limit,value:l,onChange:function(e){return t.onSelChange("sortSelectValue",e)},triangle:"sortSelect"===o}))},e}(t.Component);const v=i}}]);