(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[4444],{50707:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});n(53294);var a=n(56697),l=(n(9405),n(89552)),r=(n(1025),n(65400)),s=(n(57780),n(73818)),i=(n(75314),n(11187)),c=n(87462),o=n(94578),u=(n(1131),n(28465)),p=n(67294),m=n(96651),d=n(39432),h=u.Z.Dragger,f={visible:!1,steps:1,file:null,tags:[],allSetTags:[],newSetTags:[],fileTest:!0,fileResult:null,dragenter:!1,uploading:!1},g=function(e){function t(t){var a;return(a=e.call(this,t)||this).show=function(){a.state.visible?a.setState((0,c.Z)({},Object.assign({},f))):a.setState({visible:!0})},a.readFile=function(e){"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(i.default.warning("\u53ea\u652f\u6301 xlsx \u683c\u5f0f,\u8bf7\u91cd\u65b0\u4e0a\u4f20"),a.setState({fileTest:!1})):a.setState({file:e,fileTest:!0},(function(e){}))},a.onFormChange=function(e,t){var n;a.setState({form:(0,c.Z)({},a.state.form,(n={},n[e]=t,n))})},a.downLoadFile=function(){var e=document.createElement("a");e.style.display="none",e.href="/api/"+(0,d.AV)()+"/contact/v2/download/template",document.body.appendChild(e),e.click(),e.remove()},a.upload=function(){a.setState({uploading:!0},(function(){var e=a.xhr=new XMLHttpRequest;e.open("POST","/api/"+(0,d.AV)()+"/contact/v2/import"),e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){var t=JSON.parse(e.responseText);2e4===t.code?(a.setState({steps:a.state.steps+1,fileResult:t.result,uploading:!1}),a.props.onBatchAdd&&a.props.onBatchAdd(t.result.successfulList)):(a.setState({fileResult:null,uploading:!1}),i.default.error(t.msg))}else a.setState({fileResult:null,uploading:!1}),i.default.error("\u4e0a\u4f20\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5\u6587\u4ef6\u683c\u5f0f\u6216\u8054\u7cfb\u7ba1\u7406\u5458")},e.upload.onprogress=function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);a.setState({percent:t})}},e.onabort=function(e){i.default.error("\u4e0a\u4f20\u5df2\u4e2d\u65ad")};var t=new FormData;t.append("file",a.state.file),t.append("allSetTags",a.state.allSetTags),t.append("newSetTags",a.state.newSetTags),t.append("uploadType",a.props.uploadType?a.props.uploadType:"ALL"),e.send(t)}))},a.step1=function(){var e=a.state,t=(e.steps,e.dragenter,e.fileTest),l=e.file,r={name:"file",multiple:!0,action:"",accept:".xls, .xlsx,",showUploadList:!1,beforeUpload:function(e){return a.readFile(e),!1},onChange:function(e){},onDrop:function(e){}};return p.createElement(h,(0,c.Z)({},r,{className:"upload_wrap"}),!l&&p.createElement(p.Fragment,null,p.createElement("div",{className:"upload"},p.createElement("div",{className:"add"},p.createElement("img",{src:n(25026)})),p.createElement("b",null,p.createElement("span",null,"\u70b9\u51fb"),"\u6216\u5c06EXCEL\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc\u4e0a\u4f20"),p.createElement("p",{className:"download_template",onClick:function(e){return a.downLoadFile()}},"\u4e0b\u8f7d\u6807\u51c6\u6a21\u677f"),p.createElement("div",{className:"accept",style:{color:t?"":"#D96969"}},"\uff08\u53ea\u652f\u6301xlsx\u683c\u5f0f\uff0c\u5355\u6b21\u4e0a\u4f20\u4e0d\u8d85\u8fc75000\u6761\uff0c\u82e5\u8d85\u8fc75000\u6761\uff0c\u8bf7\u5206\u6279\u4e0a\u4f20\uff09"))),l&&p.createElement("p",{className:"file_name"},p.createElement("img",{src:n(18614)}),p.createElement("div",null,l.name),p.createElement("span",null,"\u91cd\u65b0\u4e0a\u4f20")))},a.step2=function(){var e=a.props.tags;return p.createElement("div",{className:"step2_wrap"},p.createElement("h3",null,"\u4f60\u53ef\u4ee5\u7ed9\u5bfc\u5165\u7684\u300c\u6240\u6709\u5ba2\u6237\u300d\u6253\u4e0a\u6807\u7b7e"),p.createElement("div",null,p.createElement(m.Z,{options:e,valueProps:"name",placeholder:"\u8bf7\u9009\u62e9\u6216\u8005\u8f93\u5165\u6807\u7b7e\u540e\u6309\u56de\u8f66",style:{width:400},onChange:function(e){a.setState({allSetTags:e})}})),p.createElement("h3",null,"\u4ec5\u7ed9\u5bfc\u5165\u7684\u300c\u65b0\u5ba2\u6237\u300d\u6253\u4e0a\u6807\u7b7e"),p.createElement("div",null,p.createElement(m.Z,{options:e,placeholder:"\u8bf7\u9009\u62e9\u6216\u8005\u8f93\u5165\u6807\u7b7e\u540e\u6309\u56de\u8f66",style:{width:400},onChange:function(e){a.setState({newSetTags:e})},valueProps:"name"})),p.createElement("p",null,"\u6ce8\uff1a\u4f60\u53ef\u4ee5\u8df3\u8fc7\u6b64\u6b65"))},a.step3=function(){var e=a.state.fileResult,t=e.successCount,n=e.failedCount,l=e.fileName;return p.createElement("div",{className:"result_wrapper"},p.createElement(s.ZP,{status:"success",title:p.createElement("p",{className:"result_text"},"\u6210\u529f\u5bfc\u5165",t,"\u4e2a\u6709\u6548\u5ba2\u6237\uff0c\u5bfc\u5165\u5931\u8d25",n,"\u4e2a\u5ba2\u6237"),subTitle:p.createElement("a",{className:"result_faile_text",href:"/api/"+(0,d.AV)()+"/contact/v2/download/excel?fileName="+l,target:"_blank",rel:"noreferrer"},"\u67e5\u770b\u5931\u8d25\u65e5\u5fd7")}),p.createElement("p",{className:"result_tip_text"},"\u7cfb\u7edf\u5df2\u5c06\u8fd9\u4e9b\u5ba2\u6237\u4fdd\u5b58\u5230\u5ba2\u6237\u5217\u8868\u5f53\u4e2d\uff0c\u65b9\u4fbf\u4f60\u4e0b\u6b21\u67e5\u627e"))},a.pre=function(){a.setState({steps:a.state.steps-1})},a.next=function(){a.setState({steps:a.state.steps+1})},a._handleOnCancel=function(){var e=a.state.steps;a.setState((0,c.Z)({},Object.assign({},f))),3===e&&a.props.onCancel()},a.rendStepsContext=function(e){switch(e){case 1:return a.step1();case 2:return a.step2();case 3:return a.step3(1);default:return null}},a.renderFooter=function(){var e=a.state,t=e.steps,n=e.file,l=e.uploading;return 3===t?null:p.createElement(p.Fragment,null,t<3&&p.createElement(r.default,{onClick:1===t?a._handleOnCancel:a.pre},1===t?"\u53d6\u6d88":"\u4e0a\u4e00\u6b65"),p.createElement(r.default,{type:"primary",disabled:!n||l,onClick:2===t?a.upload:a.next},2===t?"\u786e\u5b9a\u4e0a\u4f20":"\u4e0b\u4e00\u6b65"))},a.state=(0,c.Z)({},Object.assign({},f)),a}(0,o.Z)(t,e);var u=t.prototype;return u.componentDidMount=function(){},u.render=function(){var e=this.state,t=e.steps,n=e.visible,r=e.uploading;return p.createElement("div",{className:"np_add_contact_batch_add"},p.createElement(a.Z,{className:"batch_add_dialog",title:"\u6279\u91cf\u4e0a\u4f20",visible:n,onCancel:this._handleOnCancel,width:960,footer:this.renderFooter()},p.createElement(l.default,{spinning:r},p.createElement("div",{className:"steps_warper"},p.createElement("div",{className:1===t?"setps_item sel":"setps_item"},p.createElement("div",{className:"steps_item_circle"},p.createElement("span",null,"1"),p.createElement("p",null,"\u9009\u62e9\u8868\u683c"))),p.createElement("div",{className:2===t?"setps_item sel":"setps_item"},p.createElement("div",{className:"steps_item_circle"},p.createElement("span",null,"2"),p.createElement("p",null,"\u6253\u4e0a\u6807\u7b7e"))),p.createElement("div",{className:3===t?"setps_item sel":"setps_item"},p.createElement("div",{className:"steps_item_circle"},p.createElement("span",null,"3"),p.createElement("p",null,"\u5bfc\u5165\u7ed3\u679c")))),this.rendStepsContext(t))))},t}(p.Component)},36260:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});n(53294);var a=n(56697),l=n(15861),r=(n(89858),n(51024)),s=(n(62713),n(14321)),i=(n(29809),n(97538)),c=(n(35797),n(64749)),o=n(87757),u=n.n(o),p=n(67294),m=n(96651),d=c.default.Option;const h=function(e){var t=e.visible,n=e.tags,o=e.formData,h=e.schemaFields,f=e.onOK,g=e.onCancel,v=i.Z.useForm()[0],E=function(){var e=(0,l.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.validateFields();case 3:t=e.sent,f(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return(0,p.useEffect)((function(){o&&v.setFieldsValue(o)}),[o]),p.createElement(a.Z,{className:"yt-customer-sendQue-dialog yt-customer-edit-dialog",title:o?"\u7f16\u8f91\u5ba2\u6237":"\u65b0\u589e\u5ba2\u6237",visible:t,width:480,onOk:E,onCancel:g},p.createElement(i.Z,{labelCol:{span:5,offset:1},wrapperCol:{offset:1},labelAlign:"right",form:v},p.createElement(i.Z.Item,{label:p.createElement("div",{className:"user-label"},p.createElement("span",null,"\u7528\u6237\u540d"),p.createElement("span",null,"\u6807\u8bc6")),name:"unique",colon:!1,rules:[{required:!0,whitespace:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}]},p.createElement(r.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off",disabled:o})),p.createElement(i.Z.Item,{label:"\u59d3\u540d",name:"name",colon:!1},p.createElement(r.default,{maxLength:20,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),p.createElement(i.Z.Item,{label:"\u624b\u673a",name:"phoneNumber",colon:!1},p.createElement(r.default,{maxLength:11,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),p.createElement(i.Z.Item,{label:"\u90ae\u7bb1",name:"email",colon:!1,rules:[{whitespace:!0,message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1",type:"email"}]},p.createElement(r.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),p.createElement(i.Z.Item,{label:"\u6807\u7b7e",name:"newTags",colon:!1},p.createElement(m.Z,{options:n,placeholder:"\u8bf7\u9009\u62e9",style:{width:320},valueProps:"name"})),p.createElement(i.Z.Item,{label:"\u5907\u6ce8",name:"remark",colon:!1},p.createElement(r.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),h&&h.map((function(e){return function(e){var t=e.name,n=(e.code,e.id),a=e.type,l=e.showValues,o=l?JSON.parse(l):[];return p.createElement(p.Fragment,null,"RADIO"===a&&p.createElement(i.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},p.createElement(c.default,{style:{width:320},placeholder:"\u8bf7\u9009\u62e9"},o&&o.map((function(e,t){return p.createElement(d,{value:e.value,key:t},e.value)})))),"CHECKBOX"===a&&p.createElement(i.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},p.createElement(c.default,{style:{width:320},placeholder:"\u8bf7\u9009\u62e9",mode:"multiple"},o&&o.map((function(e,t){return p.createElement(d,{value:e.value,key:t},e.value)})))),"DATE_TIME"===a&&p.createElement(i.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},p.createElement(s.default,{style:{width:320},format:"YYYY/MM/DD"})),"TIME"===a&&p.createElement(i.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},p.createElement(s.default,{style:{width:320},format:"YYYY/MM/DD HH:mm",showTime:{format:"HH:mm"}})),"NUMERIC"===a&&p.createElement(i.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item",rules:[{validator:function(e,t){return t?/^(\-)?\d+(\.\d{1,4})?$/g.test(t)?Promise.resolve():Promise.reject(new Error("\u8bf7\u8f93\u5165\u6570\u5b57\uff0c\u6700\u591a\u652f\u6301\u8f93\u5165\u5c0f\u6570\u70b9\u540e\u56db\u4f4d")):Promise.resolve()}}]},p.createElement(r.default,{maxLength:30,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})),"TEXT"===a&&p.createElement(i.Z.Item,{label:t,name:n,colon:!1,className:"customer_form_item"},p.createElement(r.default,{maxLength:100,placeholder:"\u8bf7\u8f93\u5165",style:{width:320},autoComplete:"off"})))}(e)}))))}},96651:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});n(35797);var a=n(64749),l=n(67294),r=a.default.Option;const s=function(e){var t=e.options,n=e.style,s=e.valueProps,i=e.onChange,c=e.placeholder,o=e.value;return l.createElement("div",{className:"customer_tag_select"},l.createElement(a.default,{placeholder:c,mode:"tags",style:n,showArrow:!0,onChange:i,allowClear:!0,value:o},t&&t.map((function(e,t){return l.createElement(r,{key:t,value:s?e[s]:e.id},e.name)}))))}},62817:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});n(1025);var a=n(65400),l=n(63366),r=n(15861),s=n(94578),i=n(87462),c=n(87757),o=n.n(c),u=n(67294),p=n(45697),m=n.n(p),d=n(55609),h=n(50707),f=n(36260),g=n(64396),v=n(30381),E=n.n(v),y=["email","id","name","phoneNumber","remark","newTags","unique"],C=g.Z.research.addContact,N=function(e){function t(t){var n;return(n=e.call(this,t)||this).onEditCustomerInfo=function(){var e=(0,r.Z)(o().mark((function e(t){var a,r,s,c,u,p,m,d,h,f,g,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(h in a=t.email,t.id,r=t.name,s=t.phoneNumber,c=t.remark,u=t.newTags,p=t.unique,m=(0,l.Z)(t,y),d=[],m)m[h]&&d.push({scemaId:h,schemaValue:m[h]instanceof E()?E()(m[h]).format("YYYY/MM/DD"):m[h]instanceof Array?m[h].join(","):m[h]});return f={contactMappingModels:d,email:a,name:r,phoneNumber:s,remark:c,newTags:u,unique:p},g=n.props.addContact,e.next=7,g(f);case 7:(v=e.sent)&&n.setState({visible:!1}),n.props.onAdd&&n.props.onAdd((0,i.Z)({},f,{id:v}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.addCutsomerBefore=(0,r.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.fetchSchemaList();case 2:e.sent&&n.setState({visible:!0});case 4:case"end":return e.stop()}}),e)}))),n.state={visible:!1,batchVisible:!1},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.getTagList()},n.render=function(){var e=this,t=this.state,n=t.visible,l=(t.batchVisible,this.props),r=l.schemaFields,s=l.tagList,i=l.onBatchAdd;return u.createElement("div",{className:"np_add_contact"},u.createElement(a.default,{type:"ghost",onClick:function(){return e.addCutsomerBefore()}},"\u65b0\u589e\u5ba2\u6237"),u.createElement(a.default,{type:"/nps/contact"===location.pathname?"primary":"ghost",onClick:function(){e.batchRef.show()}},"\u6279\u91cf\u5bfc\u5165"),n&&u.createElement(f.Z,{visible:!0,formData:void 0,tags:s,onOK:function(t){return e.onEditCustomerInfo(t)},onCancel:function(){e.setState({visible:!1})},schemaFields:r}),u.createElement(h.Z,{ref:function(t){return e.batchRef=t},tags:s,onCancel:function(){return e.props.getTagList()},onBatchAdd:i}))},t}(u.Component);const b=(0,d.connect)((function(e){var t=(0,i.Z)({},e);return(0,i.Z)({},t[C])}),(function(e){return{getTagList:function(t){return e({type:C+"/getTagList",payload:t})},fetchSchemaList:function(t){return e({type:C+"/fetchSchemaList",payload:t})},addContact:function(t){return e({type:C+"/addContact",payload:t})}}}))(N);N.propTypes={required:m().array,onAdd:m().func,onBatchAdd:m().func,uploadType:m().string}},74444:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>we});var a=n(63366),l=n(87462),r=n(97326),s=n(94578),i=n(67294),c=(n(1025),n(65400)),o=n(43144),u=n(30381),p=n.n(u),m=n(35303),d=n(28092);const h=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={},n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.steps,n=e.current;return i.createElement("div",{className:"step-wrapper"},i.createElement("ul",{className:"step-indicator"},t.map((function(e,a){return i.createElement(i.Fragment,{key:e},i.createElement("li",{className:"step-indicator-item "+(a===n-1?"active":""),"data-flag":a+","+n},i.createElement("span",{className:"step-indicator-item_number"},a+1),i.createElement("span",{className:"step-indicator-item_label"},e)),a!==t.length-1?i.createElement("li",{className:"step-indicator-line"}):"")}))))},t}(i.Component);n(53294);var f=n(56697),g=n(8201),v=n(92360),E=n(61409),y=n(79361),C=n.n(y),N=n(57522),b=n(53920),S=n(32473),w=n(61193);const T=function(e){var t=e.questionnaireId,n=e.title,a=e.questionnaireType,l=i.useState(void 0),r=(l[0],l[1],i.useState(void 0)),s=r[0],c=r[1],o=(0,i.useState)(""),u=o[0],p=o[1],m=(0,S.Z)(b.Rs,{manual:!0,onSuccess:function(e){var t=e.data;2e4===t.code&&p(t.result)},onError:function(e){}}),d=(m.data,m.error,m.run);(0,i.useEffect)((function(){t&&d(t)}),[t]);return i.createElement("div",{className:"distribute_qr"},i.createElement("div",{className:"distribute_qr__title"},"\u94fe\u63a5\u6295\u653e"),i.createElement("div",{className:"distribute_qr__main"},i.createElement("div",{className:"qr_wrap",ref:function(e){return c(e)}},i.createElement(C(),{size:140,value:u})),i.createElement("div",{className:"link"},i.createElement("div",{className:"question_title"},n),i.createElement("div",{className:"copy"},i.createElement("p",{id:"copyArea"},u),i.createElement(v.Button,{type:"primary",className:"copy-btn",onClick:function(){var e=document.createElement("p");e.innerText=u,e.style.opacity=0,document.body.appendChild(e);var t=document.createRange();t.selectNode(e);var n=window.getSelection();n.rangeCount>0&&n.removeAllRanges(),n.addRange(t),document.execCommand("copy"),document.body.removeChild(e),v.Message.success("\u590d\u5236\u6210\u529f")}},"\u590d\u5236\u94fe\u63a5")),i.createElement("div",{className:"btn-group"},i.createElement(v.Button,{type:"ghost",className:"download",onClick:function(){var e=document.createElement("a");e.download=n+"_\u4e8c\u7ef4\u7801",e.href=s.querySelector("canvas").toDataURL("image/jpeg"),document.body.appendChild(e),e.click(),e.remove()}},"\u4e0b\u8f7d\u4e8c\u7ef4\u7801"),w.Z.hasAuthority("QUESTIONNAIRE_UPDATE")&&i.createElement(v.Button,{type:"ghost",className:"edit",onClick:function(){(0,N.Z)({dialogType:"danger",titleText:"\u63d0\u793a",showClose:!1,content:i.createElement("div",{style:{color:"#262626",padding:"0px 40px 8px 63px",width:"460px"}},"\u95ee\u5377\u300c\u5df2\u53d1\u5e03\u300d\uff0c\u4f60\u4e0d\u80fd\u518d\u5bf9\u9898\u578b\u548c\u9009\u9879\u505a\u589e\u5220\uff0c\u4f46\u53ef\u4ee5\u5bf9\u6587\u6848\u505a\u8c03\u6574\u3002"),onCancel:function(){},onOk:function(){return window.open("/research/questionnaireEdit?id="+t)},okText:"\u7f16\u8f91\u95ee\u5377"})}},"\u7f16\u8f91\u95ee\u5377"),w.Z.hasAuthority("QUESTIONNAIRE_DATA_ANALYSIS")&&i.createElement(v.Button,{type:"ghost",className:"view",onClick:function(){E.mW.push({pathname:"/research/manage/analysis",state:{questionnaireId:t,title:n,questionnaireType:a}})}},"\u67e5\u770b\u6570\u636e")))))};var _=n(29383),k={WHOLE:"\u5168\u90e8",PRIORITY:"\u4f18\u5148"},D={SMS:"\u77ed\u4fe1",EMAIL:"\u90ae\u4ef6"},Z=function(e){var t=(new Date(e).getTime()-(new Date).getTime())/1e3/60;return t<0?"\u5df2\u5206\u53d1":(Math.floor(t/60/24)||"")+(Math.floor(t/60/24)?"\u5929":"")+(Math.floor(t%1440/60)||"")+(Math.floor(t%1440/60)?"\u5c0f\u65f6":"")+(Math.floor(t%60)||0)+"\u5206\u949f"};const L=function(e){var t=e.list,n=e.pageChange,a=e.pageSizeChange,l=e.tableConfig,r=(e.questionnaireId,e.title,e.deleteMission),s=e.fetchingMissionList,o=(e.questionnaireType,e.toggleResendModal),u=l.pageSize,p=l.pageIndex,m=l.total,d=i.useState(void 0),h=(d[0],d[1],[{label:"\u53d1\u9001\u65f6\u95f4",minWidth:150,prop:"sendTime"},{label:"\u5206\u53d1\u72b6\u6001",minWidth:120,render:function(e){return i.createElement("div",null,Z(e.sendTime)+" "+("\u5df2\u5206\u53d1"===Z(e.sendTime)?"":"\u540e\u53d1\u9001"))}},{label:"\u5206\u53d1\u6e20\u9053\u5ba2\u6237\u6570",minWidth:160,prop:"sendCount"},{label:"\u5206\u53d1\u6e20\u9053",minWidth:150,render:function(e){return!e.channel.includes("SCENE_API")&&i.createElement("div",null,k[e.sendType]+"\uff1a"+e.channel.map((function(e){return D[e]})).join("\u3001"))}},{label:"\u514d\u6253\u6270\u7b56\u7565",minWidth:280,render:function(e){var t=e.noDisturbRule&&JSON.parse(e.noDisturbRule),n=t&&t.timeNumber,a=t&&{HOUR:"\u5c0f\u65f6\u5185",DAY:"\u5929\u5185"}[t.timeUnit],l=t&&{UNREAD:"\u6536\u5230\u8fc7",READED:"\u6253\u5f00\u8fc7",SUBMIT:"\u63d0\u4ea4\u8fc7"}[t.questionnaireType];return""+(t&&"\u540c\u4e00\u7528\u6237"+n+a+l+"\u8be5\u95ee\u5377\uff0c\u5219\u4e0d\u518d\u53d1\u9001")}},{label:"\u64cd\u4f5c",prop:"target",width:140,render:function(e){return i.createElement("div",{className:"handel"},"\u5df2\u5206\u53d1"!==Z(e.sendTime)&&i.createElement("span",{onClick:function(){return(0,N.Z)({dialogType:"danger",titleText:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u5206\u53d1\u4efb\u52a1\uff1f",showClose:!1,content:i.createElement("div",{style:{color:"#8C8C8C",padding:"16px 50px"}},"\u6b64\u53d1\u9001\u4efb\u52a1\u5c06\u5728",i.createElement("span",{style:{color:"#262626"}},Z(e.sendTime)),"\u540e\u53d1\u9001\u3002",i.createElement("br",null),"\u5220\u9664\u540e\uff0c\u7cfb\u7edf\u4e0d\u4f1a\u6267\u884c\u5206\u53d1\u4efb\u52a1"),onCancel:function(){},onOk:function(){return r({id:e.id})}})}},"\u5220\u9664"))}}]);return i.createElement("div",{className:"distribute_Table"},i.createElement("div",{className:"title"},i.createElement("h3",null,"\u77ed\u4fe1\u3001\u90ae\u4ef6\u6295\u653e"),i.createElement("div",null,i.createElement(c.default,{className:"sendBtn",type:"ghost",onClick:o},"\u81ea\u52a8\u91cd\u53d1\u95ee\u5377"))),i.createElement(_.Z,{columns:h,data:t,pageSize:u,currentPage:p,total:m,onPage:n,pageSizeSelectorShow:!0,onPageSizeChange:a,loading:s}))};const x=function(e){var t=e.reSendDays,n=e.isOpen,a=e.configChange,l=i.useState(t),r=l[0],s=l[1],c=i.useState(!0),o=c[0],u=c[1];i.useEffect((function(){s(t)}),[t,n]);var p=function(){return Number(r)>0&&Number(r)<=30};return i.createElement("div",{className:"distribute_setting"},i.createElement("div",{className:"distribute_setting-toggle"},i.createElement("span",null,"\u662f\u5426\u5f00\u542f"),i.createElement(v.Radio.Group,{value:n,onChange:function(e){u(!0),e&&p()||!e?a({key:"isOpen",value:e}).then((function(e){2e4===e.data.code&&v.Message.success("\u4fee\u6539\u6210\u529f")})):a({key:"isOpen",value:e,resetReSendDays:!0}).then((function(e){2e4===e.data.code&&v.Message.success("\u4fee\u6539\u6210\u529f")}))}},i.createElement(v.Radio,{value:!0},"\u5f00\u542f"),i.createElement(v.Radio,{value:!1},"\u7981\u7528"))),i.createElement("div",{className:"distribute_setting-input "+(n?"active":"disabled")},"\u5ba2\u6237\u6253\u5f00\u95ee\u5377\u4f46\u6ca1\u6709\u56de\u7b54\u4efb\u4f55\u9898\u76ee\uff0c\u5219",i.createElement(v.Input,{className:"input-control "+(!o&&"warn"),value:r,disabled:!n,onBlur:function(){p()?t!==r&&a({key:"reSendDays",value:r}).then((function(e){return 2e4===e.data.code&&v.Message.success("\u4fee\u6539\u6210\u529f")})):(u(!1),v.Message.warning("\u8bf7\u8f93\u51650 ~ 30\u7684\u6570"))},onChange:function(e){u(!0),s(e.trim().replace(/[^0-9]/gi,""))}}),"\u5929\u540e\uff0c\u81ea\u52a8\u91cd\u53d1\u95ee\u53771\u6b21"))};const I=function(e){function t(t){var n;return(n=e.call(this,t)||this).toggleResendModal=function(){var e=!n.state.showResend;n.setState({showResend:e})},n.state={showResend:!1},n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=(e.location,e.questionnaireId),n=e.title,a=e.pageChange,l=e.pageSizeChange,r=e.missionList,s=e.tableConfig,o=e.reSendDays,u=e.isOpen,p=e.configChange,m=e.deleteMission,d=e.fetchingMissionList,h=e.questionnaireType;return i.createElement(g.Z,{data:r},i.createElement(T,{questionnaireId:t,title:n,questionnaireType:h}),i.createElement(L,{title:n,list:r,pageChange:a,pageSizeChange:l,tableConfig:s,questionnaireId:t,questionnaireType:h,deleteMission:m,fetchingMissionList:d,toggleResendModal:this.toggleResendModal}),i.createElement(f.Z,{style:{borderRadius:"2px"},width:512,title:"\u81ea\u52a8\u91cd\u53d1\u8bbe\u7f6e",visible:this.state.showResend,onCancel:this.toggleResendModal,footer:[i.createElement(c.default,{key:"submit",type:"primary",onClick:this.toggleResendModal,style:{borderRadius:"2px"}},"\u5173\u95ed")]},i.createElement(x,{reSendDays:o,isOpen:u,configChange:p})))},t}(i.Component);var R=n(55609),O=n(35239),A=n(64396),P=["loading"],M=A.Z.research.distribute,q=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={},n._event={},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props,t=e.save,n=e.fetchDefaultConfig,a=e.fetchMissionList,l=e.location,r=l.state,s=l.search,i=s.startsWith("?"+encodeURIComponent('{"'))?JSON.parse(decodeURIComponent(s).substr(1)):{},c=r||i,o=c.id,u=c.questionnaireId,p=c.questionnaireType,m=c.questionnaireTypes,d=c.title;t({projectId:O.t.get(O.V.curProject).id,questionnaireId:o||u,questionnaireType:p||m,title:d}),n(),a()},n.componentWillUnmount=function(){this.props.clear()},n.render=function(){return i.createElement(I,(0,l.Z)({},this.state,this.props,this._event))},t}(i.Component);const z=(0,R.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,P);return(0,l.Z)({},n[M],{fetchingMissionList:t.effects[M+"/fetchMissionList"]||!1})}),(function(e){return{configChange:function(t){return e({type:M+"/configChange",payload:t})},fetchMissionList:function(t){return e({type:M+"/fetchMissionList",payload:t})},deleteMission:function(t){return e({type:M+"/deleteMission",payload:t})},fetchDefaultConfig:function(t){return e({type:M+"/fetchDefaultConfig",payload:t})},pageChange:function(t){return e({type:M+"/pageChange",payload:t})},pageSizeChange:function(t){return e({type:M+"/pageSizeChange",payload:t})},save:function(t){return e({type:M+"/save",payload:t})},submit:function(t){return e({type:M+"/submit",payload:t})},clear:function(){return e({type:M+"/clear"})}}}))(q);var F=n(77043),U=n.n(F),H=n(62817),B=(n(35797),n(64749)),V=(n(89858),n(51024)),W=n(87219),Y=n(43036),j=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={defaultChecked:!1},n}(0,s.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return(0,l.Z)({},e)};var n=t.prototype;return n.handleClick=function(e){var t=this.state,n=t.type,a=t.defaultChecked,l=t.selectedList,r=t.totalList;if("checkAll"===n)a?this.props.onChange([]):this.props.onChange(r);else{var s=l.indexOf(e);s>-1?l.splice(s,1):l.push(e),this.props.onChange(l)}this.setState({defaultChecked:!a})},n.render=function(){var e=this,t=this.state,n=t.type,a=t.defaultChecked,l=t.indeterminate,r=t.uniqueId,s="customized-checkobx";return a?s="customized-checkobx checked":"checkAll"===n&&l&&(s="customized-checkobx indeterminate"),i.createElement("div",{className:"customized-checkobx-wrapper"},i.createElement("div",{className:s,onClick:function(t){t.stopPropagation(),e.handleClick(r)}}))},t}(i.PureComponent),J=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this).renderPopover=function(e,t){return e?i.createElement(Y.Z,{placement:"top",overlay:t},i.createElement("span",{className:"col-nps-contact-invalid"},i.createElement("i",{className:"icon-cem_invalid-save"}))):""},t.handleConfirm=function(){var e=t.props,n=e.saveState,a=e.npsDispatch,r=a.contact,s=a.contact,i=s.selectedList,c=s.checkAllStatus.manualChecked,o=r.completeData;if(n({contact:(0,l.Z)({},r,{loading:!0})}),c){for(var u=o.filter((function(e){if(i.length){var t=i.indexOf(e.id);if(t>-1)return i.splice(t,1),!1}return!0})),p=[],m=0;m<o.length;m++){for(var d=!1,h=0;h<u.length;h++)if(o[m].id===u[h].id){d=!0;break}d||p.push(o[m])}t.handleConfirmAction(p)}else{var f=o.filter((function(e){if(i.length){var t=i.indexOf(e.id);if(t>-1)return i.splice(t,1),!0}return!1}));t.handleConfirmAction(f)}},t.handleConfirmAction=function(e){var n=t.props,a=n.saveState,r=n.npsDispatch,s=r.contact,i=r.selectedContact,c=r.selectedContact.pageIndex,o=n.afterConfirm,u=(0,W.ZP)(i.list,(function(t){e.forEach((function(e){t.find((function(t){return t.id===e.id}))||t.push(e)}))}));a({selectedContact:(0,l.Z)({},i,{list:u},u.reduce((function(e,t){return t.phoneNumber&&(e.validPhoneNum+=1),t.email&&(e.validEmailNum+=1),e}),{validEmailNum:0,validPhoneNum:0})),contact:(0,l.Z)({},s,{selectedList:e.map((function(e){return e.id})),modalShow:!1,loading:!1,searchText:"",tags:[],pageIndex:1,pageSize:10,checkAllStatus:{manualChecked:!1,autoChecked:!1,indeterminate:!1}})}),setTimeout((function(){o(c)}),0)},t.handleNameChange=function(e){var n=t.props,a=n.saveState,r=n.fetchContacts,s=n.npsDispatch.contact;e!==s.name&&(a({contact:(0,l.Z)({},s,{name:e,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),t.nameTimer&&clearTimeout(t.nameTimer),t.nameTimer=setTimeout((function(){r().then((function(){return t.nameRef.focus()}))}),800))},t.handlePhoneNumberChange=function(e){var n=t.props,a=n.saveState,r=n.fetchContacts,s=n.npsDispatch.contact;e!==s.phoneNumber&&(a({contact:(0,l.Z)({},s,{phoneNumber:e,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),t.phoneNumberTimer&&clearTimeout(t.phoneNumberTimer),t.phoneNumberTimer=setTimeout((function(){r().then((function(){return t.phoneRef.focus()}))}),800))},t.handleEmailChange=function(e){var n=t.props,a=n.saveState,r=n.fetchContacts,s=n.npsDispatch.contact;e!==s.email&&(a({contact:(0,l.Z)({},s,{email:e,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),t.emailTimer&&clearTimeout(t.emailTimer),t.emailTimer=setTimeout((function(){r().then((function(){return t.emailRef.focus()}))}),800))},t.handleSwitchPage=function(e){var n=t.props,a=n.fetchContacts,r=n.saveState,s=n.npsDispatch.contact;r({contact:(0,l.Z)({},s,{pageIndex:e})}),a()},t.handleSwitchPageSize=function(e){var n=t.props,a=n.fetchContacts,r=n.saveState,s=n.npsDispatch.contact;r({contact:(0,l.Z)({},s,{pageIndex:1,pageSize:e})}),a()},t.handleRuleTypeChange=function(e,n){var a=t.props,r=a.saveState,s=a.fetchContacts,i=a.npsDispatch,c=i.contact,o=i.contact.rules;o[n].type=e,r({contact:(0,l.Z)({},c,{rules:o})}),o[n].values.length>0&&s()},t.handleRuleValueChange=function(e,n){var a=t.props,r=a.saveState,s=a.fetchContacts,i=a.npsDispatch,c=i.contact,o=i.contact.rules;o[n].values=e,r({contact:(0,l.Z)({},c,{rules:o,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),s()},t.handleAddRule=function(){var e=t.props,n=e.saveState,a=e.npsDispatch,r=a.contact,s=a.contact.rules;s.push({type:"CONTAIN",values:[]}),n({contact:(0,l.Z)({},r,{rules:s})})},t.handleDeleteRule=function(e){var n=t.props,a=n.saveState,r=n.fetchContacts,s=n.npsDispatch,i=s.contact,c=s.contact.rules,o=c[e].values;c.splice(e,1),o.length>0?(a({contact:(0,l.Z)({},i,{rules:c,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),r()):a({contact:(0,l.Z)({},i,{rules:c})})},t}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.npsDispatch,a=n.selectedContact,l=(a.list,a.validPhoneNum,a.validEmailNum,a.currpageList,a.pageIndex,a.pageSize,n.tags),r=(n.selectedTags,n.tagChecked,n.contact),s=n.contact,o=s.name,u=s.phoneNumber,p=s.email,d=s.data,h=s.total,f=s.modalShow,g=s.selectedList,E=s.checkAllStatus,y=s.loading,C=s.rules,N=(n.channel,t.saveState,t.handleCheck),b=t.handleCheckAll,S=t.handleCloseModal,w=t.visible,T=t.halfVisible,k=[{label:"",prop:"paddingLeft",width:16},{label:"",prop:"checkbox",renderHeader:function(e){return i.createElement(j,{type:"checkAll",defaultChecked:E.autoChecked,indeterminate:E.indeterminate,onChange:b})},render:function(t){return i.createElement(j,{type:"checkOne",ref:function(n){return e["checkOne"+t.id]=n},defaultChecked:t.checked||!1,onChange:N,selectedList:g,totalList:d,uniqueId:t.id})},align:"left",width:50},{label:"\u59d3\u540d",prop:"name",align:"left",minWidth:90,renderHeader:function(){return i.createElement("div",{className:"thead-with-search"},i.createElement("span",null,"\u59d3\u540d"),i.createElement(Y.Z,{overlay:i.createElement(V.default,{size:"small",maxLength:25,placeholder:"\u8bf7\u8f93\u5165\u59d3\u540d",ref:function(t){return e.nameRef=t},defaultValue:o,onChange:function(t){return e.handleNameChange(t.target.value)},onPressEnter:function(t){return e.handleNameChange(t.target.value)},suffix:i.createElement("i",{className:"icon-cem_search"}),disabled:y}),overlayClassName:"popup-search",placement:"bottom"},i.createElement("i",{className:"icon-cem_search"})))}},{label:"\u624b\u673a",prop:"phoneNumber",align:"left",minWidth:120,renderHeader:function(){return i.createElement("div",{className:"thead-with-search"},i.createElement("span",null,"\u624b\u673a"),i.createElement(Y.Z,{overlay:i.createElement(V.default,{size:"small",maxLength:25,placeholder:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7",ref:function(t){return e.phoneRef=t},suffix:i.createElement("i",{className:"icon-cem_search"}),defaultValue:u,onChange:function(t){return e.handlePhoneNumberChange(t.target.value)},onPressEnter:function(t){return e.handlePhoneNumberChange(t.target.value)},disabled:y}),overlayClassName:"popup-search",placement:"bottom"},i.createElement("i",{className:"icon-cem_search"})))},render:function(t){var n=t.phoneNumber,a=t.status,l=a&&a.includes("INVALID_PHONE_NUMBER"),r=n;return w||(r=r?r.substring(0,3)+"*****"+r.substring(8):""),i.createElement("span",{className:l?"col-nps-invalid":""},i.createElement(Y.Z,{placement:"top",overlay:T?n:r},i.createElement("span",{className:"col-nps-contact-invalid"},r)),e.renderPopover(l,"\u6b64\u624b\u673a\u53f7\u7801\u4e3a\u65e0\u6548\u624b\u673a\uff0c\u65e0\u6cd5\u63a5\u6536\u77ed\u4fe1"))}},{label:"\u90ae\u7bb1",prop:"email",align:"left",minWidth:160,renderHeader:function(){return i.createElement("div",{className:"thead-with-search"},i.createElement("span",null,"\u90ae\u7bb1"),i.createElement(Y.Z,{overlay:i.createElement(V.default,{size:"small",maxLength:25,placeholder:"\u8bf7\u8f93\u5165\u90ae\u7bb1",ref:function(t){return e.emailRef=t},suffix:i.createElement("i",{className:"icon-cem_search"}),defaultValue:p,onChange:function(t){return e.handleEmailChange(t.target.value)},onPressEnter:function(t){return e.handleEmailChange(t.target.value)},disabled:y}),overlayClassName:"popup-search",placement:"bottom"},i.createElement("i",{className:"icon-cem_search"})))},render:function(t){var n=t.email,a=t.status,l=a&&a.includes("INVALID_EMAIL"),r=n;if(!w){var s=r&&r.includes("@")?r.split("@"):"";r=s&&s[0].substring(0,4)+"*****@"+s[1]}return i.createElement("span",{className:l?"col-nps-invalid":""},i.createElement(Y.Z,{placement:"top",overlay:T?n:r},i.createElement("span",{className:"col-nps-contact-invalid"},r)),e.renderPopover(l,"\u6b64\u90ae\u7bb1\u4e3a\u65e0\u6548\u90ae\u7bb1\uff0c\u65e0\u6cd5\u63a5\u6536\u90ae\u4ef6"))}},{label:"\u6807\u7b7e",prop:"tags",align:"left",minWidth:160,render:function(e){return e.tags.reduce((function(e,t,n,a){return t.name?(n<3?e.push(i.createElement(Y.Z,{placement:"top",overlayClassName:"popup-tags",overlay:t.name},i.createElement("span",{key:t.id,title:t.name,className:"tag"},t.name.length>6?t.name.substring(0,6)+"...":t.name))):3===n&&e.push(i.createElement(Y.Z,{overlayClassName:"popup-tags",overlay:a.slice(3).map((function(e){return i.createElement("span",{key:e.id,title:e.name,style:{userSelect:"none"},className:"tag"},e.name)})),placement:"top"},i.createElement("span",{key:"more",className:"tag"},"..."))),e):[]}),[])}},{label:"",prop:"paddingRight",width:16}],D=[{label:"\u5305\u542b",value:"CONTAIN"},{label:"\u4e0d\u5305\u542b",value:"NOTCONTAIN"}];return i.createElement(v.Dialog,{title:"\u9009\u62e9\u5df2\u6709\u8054\u7cfb\u4eba",size:"small",customClass:"contact-modal",visible:f,onCancel:function(){return S()},lockScroll:!1},i.createElement(v.Dialog.Body,null,i.createElement("div",{className:"rule-config-wrapper"},i.createElement("div",null,"\u4ee5\u4e0b\u6761\u4ef6\u9010\u5c42\u751f\u6548\u8fc7\u6ee4\u8981\u9009\u62e9\u7684\u6570\u636e"),C.map((function(t,n){return i.createElement("div",{className:"rule-item",key:n},i.createElement("span",{style:{marginRight:0===n?"38px":"16px"}},n+1),n>0&&i.createElement("span",null,"\u4e14"),i.createElement(B.default,{value:t.type,disabled:0===n,onChange:function(t){return e.handleRuleTypeChange(t,n)}},D.map((function(e,t){return i.createElement(B.default.Option,{key:t,label:e.label,value:e.value},e.label)}))),i.createElement(m.RS,{tokenSeparators:[" ",","],maxTagCount:5,placeholder:"\u8bf7\u9009\u62e9\u6807\u7b7e",value:t.values,onChange:function(t){return e.handleRuleValueChange(t,n)}},l.map((function(e,t){return i.createElement(m.Wx,{key:e.name,label:e.name,value:e.name},e.name)}))),n>0&&i.createElement("div",{className:"clear-btn",onClick:function(){return e.handleDeleteRule(n)}},i.createElement("i",{className:"icon-cem_cancel"})))})),C.length<5&&i.createElement("div",{className:"add-more"},i.createElement("i",{className:"icon-cem_unfolding-data",onClick:this.handleAddRule}),i.createElement("span",null,"\u8fd8\u53ef\u6dfb\u52a0",5-C.length,"\u4e2a\u89c4\u5219"))),i.createElement(v.Loading,{loading:y,text:"\u62fc\u547d\u52a0\u8f7d\u4e2d"},i.createElement(_.Z,{columns:k,rowClassName:function(e){return g.includes(e.id)?"item active":"item"},rowKey:function(e){return e.id},onRowClick:this.handleRowClick,data:d,total:h,currentPage:r.pageIndex,pageSize:r.pageSize,pagePosition:"down",onPage:this.handleSwitchPage,pageSizeSelectorShow:!0,onPageSizeChange:this.handleSwitchPageSize,selectedCount:g.length,notLimit:!0}))),i.createElement(v.Dialog.Footer,{className:"dialog-footer"},i.createElement(c.default,{onClick:function(){return S()}},"\u53d6\u6d88"),i.createElement(c.default,{type:"primary",onClick:function(){return e.handleConfirm()}},"\u786e\u5b9a")))},t}(i.PureComponent),Q=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this).handleReset=function(){var e=t.props,n=e.saveState,a=e.npsDispatch.contact;n({selectedContact:{list:[],currpageList:[],pageIndex:1,pageSize:20},contact:(0,l.Z)({},a,{selectedList:[]})})},t.handleDelete=function(e){var n=t.props,a=n.saveState,r=n.npsDispatch,s=r.contact,i=r.contact.selectedList,c=r.selectedContact,o=r.selectedContact,u=o.list,p=o.currpageList,m=n.handleCheckboxStyle,d=JSON.parse(JSON.stringify(u)),h=JSON.parse(JSON.stringify(p)),f=d.map((function(e){return e.id})).indexOf(e);d.splice(f,1);var g=h.map((function(e){return e.id})).indexOf(e);h.splice(g,1);var v=JSON.parse(JSON.stringify(i)),E=v.indexOf(e);v.splice(E,1);var y=d.filter((function(e){return e.phoneNumber})).length,C=d.filter((function(e){return e.email})).length;a({selectedContact:(0,l.Z)({},c,{list:d,validPhoneNum:y,validEmailNum:C,currpageList:h}),contact:(0,l.Z)({},s,{selectedList:v})}),m()},t.handleOpenModal=function(){var e=t.props,n=e.saveState,a=e.fetchContacts,r=e.npsDispatch.contact;n({contact:(0,l.Z)({},r,{modalShow:!0,checkAllStatus:{manualChecked:!1,autoChecked:!1,indeterminate:!1}})}),a()},t.handleCloseModal=function(){var e=t.props,n=e.saveState,a=e.npsDispatch.contact;n({contact:(0,l.Z)({},a,{modalShow:!1,searchText:"",tags:[],pageIndex:1,pageSize:10,checkAllStatus:{manualChecked:!1,autoChecked:!1,indeterminate:!1}})})},t.handleManualSwitchPage=function(e){var n=t.props,a=n.npsDispatch,r=a.selectedContact,s=a.selectedContact,i=s.list,c=s.pageSize,o=n.saveState,u=i.slice((e-1)*c,e*c);o({selectedContact:(0,l.Z)({},r,{currpageList:u,pageIndex:e})})},t.handleManualSwitchPageSize=function(e){var n=t.props,a=n.npsDispatch,r=a.selectedContact,s=a.selectedContact.list,i=n.saveState,c=s.slice(0,e);i({selectedContact:(0,l.Z)({},r,{currpageList:c,pageSize:e,pageIndex:1})})},t.handleAddContact=function(e){var n=t.props,a=n.npsDispatch,r=a.selectedContact,s=a.selectedContact,i=s.list,c=s.validPhoneNum,o=s.validEmailNum,u=s.pageIndex,p=n.saveState,m=n.fetchTags,d=Array.isArray(e)?e.filter((function(e){return e.phoneNumber})).length:e.phoneNumber&&e.phoneNumber.length>0?1:0,h=Array.isArray(e)?e.filter((function(e){return e.email})).length:e.email&&e.email.length>0?1:0,f=Array.isArray(e)?e.concat(i):[e].concat(i);p({selectedContact:(0,l.Z)({},r,{list:U()(f,"id"),validPhoneNum:c+d,validEmailNum:o+h})}),setTimeout((function(){t.handleManualSwitchPage(u)}),0),m()},t.handleRowClick=function(e){var n=e.id;t["checkOne"+e.id].handleClick(n)},t.renderPopover=function(e,t){return e?i.createElement(Y.Z,{placement:"top",overlay:t},i.createElement("span",{className:"col-nps-contact-invalid"},i.createElement("i",{className:"icon-cem_invalid-save"}))):""},t}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.npsDispatch,a=n.selectedContact,r=a.list,s=a.validPhoneNum,o=a.validEmailNum,u=a.currpageList,p=a.pageIndex,m=a.pageSize,d=(n.tags,n.selectedTags,n.tagChecked,n.contact,n.contact),h=(d.name,d.phoneNumber,d.email,d.data,d.total,d.modalShow,d.selectedList,d.checkAllStatus,d.loading,d.rules,n.channel,t.saveState,t.handleCheck,t.handleCheckAll,w.Z.hasAuthority("NPS_CONTACT_VISIBLE")),f=w.Z.hasAuthority("NPS_CONTACT_VISIBLE")||w.Z.hasAuthority("NPS_CONTACT_HALF_VISIBLE"),g=[{label:"",prop:"paddingLeft",width:16},{label:"\u59d3\u540d",prop:"name",align:"left",minWidth:240,render:function(e){return e.name||"--"}},{label:"\u624b\u673a",prop:"phoneNumber",align:"left",minWidth:240,render:function(t){var n=t.phoneNumber,a=t.status,l=a&&a.includes("INVALID_PHONE_NUMBER"),r=n;return h||(r=r?r.substring(0,3)+"*****"+r.substring(8):""),i.createElement("span",{className:l?"col-nps-invalid":""},i.createElement(Y.Z,{placement:"top",overlay:f?n:r},i.createElement("span",{className:"col-nps-contact-invalid"},r||"--")),e.renderPopover(l,"\u6b64\u624b\u673a\u53f7\u7801\u4e3a\u65e0\u6548\u624b\u673a\uff0c\u65e0\u6cd5\u63a5\u6536\u77ed\u4fe1"))}},{label:"\u90ae\u7bb1",prop:"email",align:"left",minWidth:320,render:function(t){var n=t.email,a=t.status,l=a&&a.includes("INVALID_EMAIL"),r=n;if(!h){var s=r&&r.includes("@")?r.split("@"):"";r=s&&s[0].substring(0,4)+"*****@"+s[1]}return i.createElement("span",{className:l?"col-nps-invalid":""},i.createElement(Y.Z,{placement:"top",overlay:f?n:r},i.createElement("span",{className:"col-nps-contact-invalid"},r||"--")),r&&e.renderPopover(l,"\u6b64\u90ae\u7bb1\u4e3a\u65e0\u6548\u90ae\u7bb1\uff0c\u65e0\u6cd5\u63a5\u6536\u90ae\u4ef6"))}},{label:"\u64cd\u4f5c",prop:"operation",align:"left",width:90,render:function(t){return i.createElement("div",{className:"operations"},i.createElement("span",{onClick:function(){return e.handleDelete(t.id)}},"\u79fb\u9664"))}},{label:"",prop:"paddingRight",width:16}];return i.createElement("div",{className:"contact-wrapper "+(r.length?"":"contact-wrapper--empty")},i.createElement("div",{className:"contact-header"},i.createElement("span",{className:"contact-header_title"},"\u6536\u4ef6\u5ba2\u6237"),i.createElement("span",{onClick:this.handleReset},"\u5168\u90e8\u6e05\u7a7a"),r.length>0&&i.createElement(i.Fragment,null,i.createElement("span",{className:"divider"},"|"),i.createElement("span",{className:"statics"},"\u5df2\u9009\u4e2d\u8054\u7cfb\u4eba ",i.createElement("span",null,r.length)," \u4e2a\uff0c\u5176\u4e2d\u624b\u673a\u53f7",i.createElement("span",null," ",s," "),"\u4e2a\uff0c\u90ae\u7bb1",i.createElement("span",null," ",o," "),"\u4e2a")),i.createElement("div",{className:"btns"},i.createElement(c.default,{type:"ghost",onClick:this.handleOpenModal},"\u9009\u62e9\u5df2\u6709\u5ba2\u6237"),i.createElement(H.Z,{onAdd:this.handleAddContact,onBatchAdd:this.handleAddContact}))),i.createElement(_.Z,{columns:g,data:u,total:r.length,emptyText:"\u6682\u65e0\u6570\u636e\uff0c\u8bf7\u5148\u9009\u62e9\u8054\u7cfb\u4eba",currentPage:p,pageSize:m,pagePosition:"down",onPage:this.handleManualSwitchPage,pageSizeSelectorShow:!0,onPageSizeChange:this.handleManualSwitchPageSize,notLimit:!0}),i.createElement(J,(0,l.Z)({},this.props,{handleCloseModal:this.handleCloseModal,visible:h,halfVisible:f,afterConfirm:this.handleManualSwitchPage})))},t}(i.PureComponent),X=(n(15267),n(64713)),K=(n(7940),n(31059)),G=n(51474),$=n(23279),ee=n.n($),te=n(19335),ne=["loading"],ae=A.Z.research.distributeStep,le="#\u8054\u7cfb\u4eba\u59d3\u540d#";var re=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleScroll=function(){var e=n.props,t=e.fetchTemplateList,a=e.hasMore,l=e.listLoading,r=e.pageIndex,s=n.scrollContainer,i=s.scrollTop,c=s.offsetHeight,o=s.scrollHeight-i-c;n.setState({bottomDistance:o}),o<30?(n.setState({tipShow:!0}),a&&!l&&t&&t({pageIndex:r+1})):n.setState({tipShow:!1})},n._handleOnClose=function(){n.setState({visible:!1,detail:void 0,type:"",tipShow:!1,value:""})},n._handleOnConfirm=function(){var e=n.props,t=e.save,a=e.channelList,l=e.template.list,r=n.state,s=r.type,i=r.value,c=l.find((function(e){return e.id===i}));t({channelList:(0,W.ZP)(a,(function(e){var t=e.find((function(e){return e.channel===s}));t&&(t.templateId=c.id,t.templateName=c.name,t.checked=!0)}))}),n._handleOnClose()},n._handleOnTemplateChange=function(e){n.setState({value:e})},n.state={visible:!1,type:"",tipShow:!1,detail:void 0,value:""},n}(0,s.Z)(t,e);var a=t.prototype;return a.show=function(e){var t=this,n=e.type,a=e.id;this.setState({visible:!0,type:n,value:a},(function(){return t.props.fetchTemplateList({channel:n,pageIndex:1})}))},a.render=function(){var e,t=this,a=this.state,l=a.visible,r=a.type,s=a.tipShow,c=a.value,o=this.props,u=o.template,p=u.list,m=void 0===p?[]:p,d=u.total,h=u.hasMore,f=o.loading,g=o.questionnaireType,E=m.find((function(e){return e.id===c}));return i.createElement(te.Z,{className:"yt_template_drawer_wrapper",maskClosable:!0,keyboard:!1,closeable:!0,visible:l,onClose:this._handleOnClose,width:520,placement:"right",title:("SMS"===r?"\u77ed\u4fe1":"\u90ae\u4ef6")+"\u6a21\u677f\u9009\u62e9",bodyStyle:{paddingBottom:80},footer:i.createElement("div",{className:"footer"},i.createElement("span",{className:"manage",onClick:function(){return window.open("/research/setting?type="+r.toLowerCase())}},i.createElement("i",{className:"icon-cem_more-two"}),"\u7ba1\u7406\u6a21\u677f"),i.createElement("div",null,i.createElement(v.Button,{onClick:this._handleOnClose},"\u53d6\u6d88"),i.createElement(v.Button,{type:"primary",onClick:this._handleOnConfirm},"\u786e\u5b9a")))},i.createElement("div",{className:"template-list-wrapper"},i.createElement("div",{className:"template-list-body",ref:function(e){return t.scrollContainer=e},onScroll:ee()(this._handleScroll,500)},0===d?i.createElement("div",{className:"noDataTip"},i.createElement("img",{src:n(22750)})):i.createElement(i.Fragment,null,i.createElement("div",{className:"template-item title"},"\u6a21\u677f\u540d\u79f0"),i.createElement(v.Radio.Group,{style:{width:"100%"},value:c,onChange:this._handleOnTemplateChange},m.map((function(e){return i.createElement(v.Radio,{value:e.id,key:e.id,className:"template-item"},e.name)}))))),i.createElement("div",{className:"template-list-footer"},i.createElement("div",null,"\u5171 ",i.createElement("span",null,d)," \u9879"),i.createElement("div",{style:{opacity:f||s?1:0,transition:"opacity 0.3s"}},h?"\u52a0\u8f7d\u66f4\u591a\u6570\u636e\u4e2d\u2026":"\u6ca1\u6709\u66f4\u591a\u6570\u636e"))),E&&i.createElement("div",{className:"preview",style:{display:l?"block":"none"}},i.createElement("div",{className:"mobile"},r&&i.createElement("img",{src:n(52921)("./iPhone_"+r.toLowerCase()+".png")}),E.id?"SMS"===r?i.createElement("div",{className:"msg",dangerouslySetInnerHTML:{__html:"\u3010"+E.signatureName+"\u3011"+E.content+"\u3002\u95ee\u5377\u94fe\u63a5\uff1a<span style='color: #0847A6'>https://cast.vip/u712sw</span>\uff0c\u9000\u8ba2\u56deT"}}):i.createElement("div",{className:"email"},i.createElement("div",{className:"title"},""+E.name),i.createElement("div",null,i.createElement("span",null,"\u5ba2\u6237\u4f53\u9a8c\u4e2d\u5fc3"),i.createElement("span",null,"\u8be6\u60c5")),i.createElement("div",null,i.createElement("span",null,Array.isArray(g)&&1===g.length?"NPS"===g[0]?"NPS":"SATISFACTION"===g[0]?"\u6ee1\u610f\u5ea6":"":"","\u8c03\u67e5\u95ee\u5377"),i.createElement("span",null,E.signatureName)),i.createElement("div",{dangerouslySetInnerHTML:{__html:(e=E.content.replace(/#\u8054\u7cfb\u4eba\u59d3\u540d#/g,"Tony"),'<span style="color: #262626">'+e.replace(/ /g,"&nbsp;").replace(/\n/g,"</br>").replace(new RegExp(le,"g"),'<span style="color: #0847A6">#\u8054\u7cfb\u4eba\u59d3\u540d#</span>')+"</span>")}}),i.createElement("img",{src:E.img||n(60226)}),i.createElement("div",null,"\u5982\u679c\u65e0\u6cd5\u6b63\u5e38\u8bbf\u95ee\uff0c\u8bf7\u8bbf\u95ee\u94fe\u63a5",i.createElement("span",null,"https://beta.yuntingai.com/"),i.createElement("br",null),i.createElement("span",null,"price/realTimePrice"))):"")))},t}(i.PureComponent);const se=(0,R.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,ne);return{template:n[ae].template,channelList:n[ae].channelList,loading:t.effects[ae+"/fetchTemplateList"]||!1}}),(function(e){return{fetchTemplateList:function(t){return e({type:ae+"/fetchTemplateList",payload:t})},save:function(t){return e({type:ae+"/save",payload:t})}}}),null,{withRef:!0})(re);const ie=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnChannelChange=function(e,t){var a=e.target.checked,l=n.props,r=l.onChange,s=l.channelList;!t.templateName&&a?n.drawerRef.wrappedInstance.show({type:t.channel,id:t.templateId}):r&&r({channelList:(0,W.ZP)(s,(function(e){var n=e.find((function(e){return e.channel===t.channel}));n&&(n.checked=a)}))})},n._handleOnTemplateChange=function(e){n.drawerRef.wrappedInstance.show({type:e.channel,id:e.templateId})},n._handleOnRadioChange=function(e){var t=e.target.value,a=n.props.onChange;a&&a({sendType:t})},n.state={contactList:void 0,contactCount:{SMS:0,EMAIL:0}},n}(0,s.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return JSON.stringify(e.list)!==JSON.stringify(t.contactList)?{contactList:e.list,contactCount:e.list.reduce((function(e,t){return t.phoneNumber&&(e.SMS+=1),t.email&&(e.EMAIL+=1),e}),{EMAIL:0,SMS:0})}:{}};var n=t.prototype;return n.componentDidMount=function(){var e=this,t=document.getElementById("draggable_zone");t&&G.default.create(t,{group:"draggable_zone",animation:150,filter:".undraggable",draggable:".draggable",handle:".icon-cem_move",onEnd:function(t){var n=e.props,a=n.onChange,l=n.channelList,r=t.newIndex,s=t.oldIndex;r!==s&&a&&a({channelList:(0,W.ZP)(l,(function(e){var t=e.splice(s,1)[0];e.splice(r,0,t)}))})}})},n.render=function(){var e=this,t=this.props,n=t.channelList,a=t.sendType,r=t.questionnaireType,s=this.state.contactCount;return i.createElement(i.Fragment,null,i.createElement("div",{className:"channel-select"},i.createElement("h3",{className:"channel-header"},i.createElement("span",{className:"label"},"\u9009\u62e9\u6e20\u9053"),i.createElement("span",null,"\u8bf7\u9009\u62e9\u672c\u6b21\u5206\u53d1\u7684\u6e20\u9053")),i.createElement("section",{className:"channel-main"},i.createElement("div",{className:"channel-main__table"},i.createElement("div",{className:"row-item thead"},i.createElement("span",{className:"col1"},"\u6e20\u9053"),i.createElement("span",{className:"col2"},"\u6a21\u677f"),i.createElement("span",{className:"col3"},"\u5ba2\u6237\u6570"),i.createElement("span",{className:"col4"},"\u64cd\u4f5c")),i.createElement("div",{id:"draggable_zone"},n.map((function(t){return i.createElement("div",{className:"row-item draggable",key:t.channel},i.createElement("i",{className:"icon-cem_move"}),i.createElement("span",{className:"col1"},i.createElement(K.default,{checked:t.checked,onChange:function(n){return e._handleOnChannelChange(n,t)}},t.channelName)),i.createElement("span",{className:"col2"},t.templateName),i.createElement("span",{className:"col3"},s[t.channel]),i.createElement("span",{className:"col4 operator",onClick:function(){return e._handleOnTemplateChange(t)}},t.templateName?"\u5207\u6362\u6a21\u677f":""))})))),i.createElement("div",{className:"channel-main__rule"},i.createElement("span",null,"\u6e20\u9053\u7b56\u7565"),i.createElement(X.default.Group,{className:"rule-radio",value:a,onChange:function(t){return e._handleOnRadioChange(t)}},i.createElement(X.default,{value:"WHOLE"},"\u5168\u90e8\u53d1\u9001"),i.createElement(X.default,{value:"PRIORITY"},"\u4f18\u5148\u53d1\u9001")),i.createElement(Y.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:"\u4e0a\u8ff0\u6e20\u9053\u5c06\u6309\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u4f9d\u6b21\u53d1\u9001\uff0c\u5982\u679c\u53d1\u9001\u6210\u529f\u5219\u4e0d\u518d\u91cd\u590d\u53d1\u9001\uff0c\u53ef\u62d6\u62fd\u6392\u5e8f"},i.createElement("i",{className:"icon-cem_file1"}))))),i.createElement(se,(0,l.Z)({ref:function(t){return e.drawerRef=t},questionnaireType:r},this.props)))},t}(i.PureComponent);var ce=n(45697),oe=n.n(ce),ue=[{label:"\u7acb\u5373\u53d1\u9001",value:1},{label:"\u5b9a\u65f6\u53d1\u9001",value:2}],pe=function(e){var t=e.timeType,n=e.onChange,a=e.sendTime;return i.createElement("div",{className:"yt_dispatch_time_settings"},i.createElement("div",{className:"time_config"},i.createElement("span",{className:"label"},"\u5206\u53d1\u65f6\u95f4"),i.createElement("div",{className:"config"},i.createElement(v.Select,{className:"select",value:t,options:ue,onChange:function(e){n&&n({timeType:e,sendTime:1===e?"":a})}},ue.map((function(e){return i.createElement(v.Select.Option,{value:e.value,key:e.value,label:e.label})}))),i.createElement("div",{className:"tips"},1===t?"\u5168\u90e8\u5206\u53d1\u9700\u89811~3\u5206\u949f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85":"\u9009\u62e9\u5b9a\u65f6\u53d1\u9001\u65f6\u95f4"),1===t?"":i.createElement(i.Fragment,null,i.createElement(v.DatePicker,{className:"m_date_picker",isShowTime:!0,onFocus:function(){setTimeout((function(){var e=document.querySelector(".el-picker-panel__link-btn");e&&(e.style.display="none")}),0)},value:a?p()(a)._d:"",format:"yyyy-MM-dd HH:mm",placeholder:"\u9009\u62e9\u5206\u53d1\u65f6\u95f4",onChange:function(e){n&&n({sendTime:e?p()(e).format("YYYY-MM-DD HH:mm"):""})},disabledDate:function(e){return e.getTime()<Date.now()-864e5}}),a?p()().diff(p()(a))>0?i.createElement("div",{className:"tips",style:{color:"#d96969"}},"\u9009\u62e9\u65f6\u95f4\u4e0d\u80fd\u5148\u4e8e\u5f53\u524d\u65f6\u523b"):i.createElement("div",{className:"tips"},"\u6b64\u95ee\u5377\u5c06\u5728",i.createElement("span",null,a),"\u53d1\u7ed9\u9009\u5b9a\u7684\u5ba2\u6237"):""))))};const me=pe;pe.propTypes={timeType:oe().number,onChange:oe().func,sendTime:oe().string};n(48145);var de=n(40987),he=(n(59567),n(8799)),fe=function(e){var t=e.sendRuleStatus,n=e.noDisturbRule,a=i.useState(n&&n.timeNumber||1),l=a[0],r=a[1],s=i.useState(n&&n.timeUnit||"HOUR"),c=s[0],o=s[1],u=i.useState(n&&n.questionnaireType||"UNREAD"),p=u[0],m=u[1],d=i.useState(t||!1),h=d[0],f=d[1],g=B.default.Option;return i.createElement("div",{className:"yt_dispatch_nodisturb_settings"},i.createElement("div",{className:"time_config"},i.createElement("span",{className:"label"},"\u514d\u6253\u6270\u8bbe\u7f6e"),i.createElement("div",{className:"config"},i.createElement("span",null,"\u540c\u4e00\u7528\u6237"),i.createElement(he.Z,{className:"config-control",defaultValue:l,onChange:function(e){return function(e){r(e),f(!1)}(e)},parser:function(e){return parseInt(e)}}),i.createElement(B.default,{className:"config-control",defaultValue:c,onChange:function(e){return function(e){o(e),f(!1)}(e)}},i.createElement(g,{value:"HOUR"},"\u5c0f\u65f6\u5185"),i.createElement(g,{value:"DAY"},"\u5929\u5185")),i.createElement(B.default,{className:"config-control",defaultValue:p,onChange:function(e){return function(e){m(e),f(!1)}(e)}},i.createElement(g,{value:"UNREAD"},"\u6536\u5230\u8fc7"),i.createElement(g,{value:"READED"},"\u6253\u5f00\u8fc7"),i.createElement(g,{value:"SUBMIT"},"\u63d0\u4ea4\u8fc7")),i.createElement("span",null,"\u8be5\u95ee\u5377\uff0c\u5219\u4e0d\u518d\u53d1\u9001\u3002"),i.createElement(de.Z,{checked:h,onChange:function(t){return f(n=t),void e.onChange({sendRuleStatus:n?"NORMAL":"SUSPEND",sendRuleConfig:{timeNumber:""+l,timeUnit:c,questionnaireType:p}});var n},checkedChildren:"\u5f00\u542f",unCheckedChildren:"\u5173\u95ed"}))))};const ge=fe;fe.propTypes={onChange:oe().func};var ve=function(e){function t(t){var n;return(n=e.call(this,t)||this).submitDisturb=function(e){(0,n.props.saveState)({sendRuleStatus:e.sendRuleStatus,sendRuleConfig:e.sendRuleConfig})},n.state={},n}return(0,s.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.npsDispatch,n=t.channel,a=t.selectedContact.list,l=t.sendType,r=t.channelList,s=t.timeType,c=t.sendTime,o=e.saveState,u=e.questionnaireType,p=e.pageOrigin,m="customer"!==p&&this.props.location.state.sendRuleStatus,d="customer"===p?"":this.props.location.state.noDisturbRule;return i.createElement(i.Fragment,null,i.createElement("div",{className:"channel-panel"},i.createElement(ie,{questionnaireType:u,channel:n,list:a,sendType:l,channelList:r,onChange:o,handleSwitchChannel:this.handleSwitchChannel})),i.createElement("div",{className:"time-panel"},i.createElement("div",{className:"time-header"},"\u5206\u53d1\u65f6\u95f4"),i.createElement(me,{timeType:s,sendTime:c,onChange:o}),i.createElement(ge,{onChange:this.submitDisturb,sendRuleStatus:m,noDisturbRule:d})))},t}(i.Component);const Ee=function(e){var t=e.contactQuantity,n=e.reback;return i.createElement("div",{className:"result-wrapper"},i.createElement("i",{className:"icon-cem_complete1"}),i.createElement("div",null,"\u8bbe\u7f6e\u6210\u529f"),i.createElement("div",null,"\u901a\u8fc7\u6b64\u5206\u53d1\u4efb\u52a1\uff0c\u95ee\u5377\u5c06\u9646\u7eed\u53d1\u7ed9",i.createElement("span",null,t,"\u4e2a"),"\u5ba2\u6237\uff0c \u9700\u89811~3\u5206\u949f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85"),i.createElement("div",null,i.createElement(c.default,{type:"default",onClick:function(){return E.mW.push({pathname:"/research/manage"})}},"\u95ee\u5377\u7ba1\u7406"),i.createElement(c.default,{type:"primary",onClick:function(){return n()}},"\u7ee7\u7eed\u5206\u53d1")))};var ye=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleParant=function(e,t,n){if(e)return i.createElement(d.Z,{leftNavState:"distribute",qsId:t.query.id,pageQuery:t.query,navMode:d.h.questionnaireDistribute},n);var a=t.state;if(t.search){var l=decodeURIComponent(t.search).substr(1),r=JSON.parse(l);a=Object.assign({},a,r)}return i.createElement(d.Z,{leftNavState:"distribute",qsId:a.id||a.questionnaireId,pageQuery:a,navTitle:a.title,navMode:d.h.distribute},n)},n.syncStep=function(e){(0,n.props.saveState)({step:e})},n.goNext=function(){var e=n.props.npsDispatch.step;n.syncStep(e+1)},n.goPrev=function(){var e=n.props.npsDispatch.step;n.syncStep(e-1)},n.resend=function(){n.state.fromCustomList?n.goPrev():n.syncStep(1)};var a=t.pageOrigin;return n.state={fromCustomList:"customer"===a},n}(0,s.Z)(t,e);var n=t.prototype;return n.sendResearch=function(){(0,this.props.sendNps)(),this.goNext()},n.render=function(){var e,t=this,n=this.props,a=n.location,l=n.title,r=(void 0===l&&(null==(e=a.state)||e.title),n.handleTagsChange),s=n.npsDispatch,o=s.selectedTags,u=s.tags,p=s.selectedContact.list,d=s.step,f=(n.questionnaireId,n.questionnaireType,n.pageOrigin,this.state.fromCustomList),g=a&&a.pathname.indexOf("questionnaireEdit")>-1;return i.createElement(i.Fragment,null,this._handleParant(g,a,i.createElement("div",{className:"research_distribute "+(g?"isEdit":"")},d<4?i.createElement(i.Fragment,null,i.createElement("div",{className:"content"},i.createElement(h,{steps:["\u6295\u653e\u65b9\u5f0f","\u9009\u62e9\u5ba2\u6237","\u7acb\u5373\u5206\u53d1"],current:d}),1===d&&i.createElement(z,this.props),2===d&&i.createElement(Q,this.props),3===d&&i.createElement(ve,this.props)),i.createElement("div",{className:"footbar"},2===d&&i.createElement("div",{className:"tag"},i.createElement("span",{className:"description"},"\u53d1\u9001\u540e\u6253\u4e0a\u6807\u7b7e"),i.createElement(m.RS,{className:"select-wrapper",placeholder:"\u9009\u62e9\u6216\u65b0\u5efa\u6807\u7b7e",tags:!0,tokenSeparators:[" ",","],value:o.length>0?o.map((function(e){return e.name})):[],onChange:r},u.map((function(e){return i.createElement(m.Wx,{key:e.name,label:e.name,value:e.name},e.name)})))),d>1&&i.createElement(c.default,{type:"ghost",disabled:f,onClick:function(){return t.goPrev()}},"\u4e0a\u4e00\u6b65"),3===d?i.createElement(c.default,{className:"send-btn",disabled:this.isNextDisabled,type:"primary",onClick:function(){return t.sendResearch()}},"\u53d1\u9001"):i.createElement(c.default,{disabled:this.isNextDisabled,type:"primary",onClick:function(){return t.goNext()}},"\u4e0b\u4e00\u6b65"))):i.createElement("div",{className:"result-content"},i.createElement(Ee,{reback:function(){return t.resend()},contactQuantity:p.length})))))},(0,o.Z)(t,[{key:"isNextDisabled",get:function(){if(!this.props.questionnaireId)return!0;var e=this.props.npsDispatch.step;if(1===e)return!1;var t=this.props.npsDispatch,n=t.selectedContact.list,a=t.channelList,l=t.sendTime,r=t.timeType,s=t.isNextEnabled,i=t.sendRuleStatus,c=t.sendRuleConfig,o=t.sendType;if(2===e)return!n.length;if(3===e){var u=!a.reduce((function(e,t){return t.checked||e}),!1),m=!s||!(1===r||2===r&&l&&p()().diff(p()(l))<0);return u&&m&&(!c||!i||!o)}return!0}}]),t}(i.Component);const Ce=ye;var Ne=["loading"],be=A.Z.research.distributeStep,Se=function(e){function t(t){var n;(n=e.call(this,t)||this)._handleMessage=function(e){"updateTemplate"===e.data&&n.props.fetchTemplateList({pageIndex:1})},n.routerWillLeave=function(){var e=n.props.npsDispatch.step;return 2!==e&&3!==e||"\u4fe1\u606f\u8fd8\u672a\u4fdd\u5b58\uff0c\u786e\u8ba4\u8981\u79bb\u5f00\uff1f"},n.handleSwitchChannel=function(e){var t=n.props,a=t.npsDispatch.channel,l=t.saveState;a!==e&&l({channel:e})},n.handleClickTemplate=function(e){var t=n.props,a=t.npsDispatch,r=a.template,s=a.template.list;(0,t.saveState)({template:(0,l.Z)({},r,{detail:s[e]})})},n.handleTagsChange=function(e){var t=n.props,a=t.npsDispatch.tags,l=t.saveState,r=[];e.filter((function(e){return e.trim().length>0})).forEach((function(e){for(var t=!1,n=null,l=0;l<a.length;l++)a[l].name===e&&(t=!0,n=a[l]);t||(n={id:"",name:e}),r.push(n)})),l({selectedTags:r})};var a=t.location,s=a.state,i=void 0===s?{}:s,c=a.search,o=c.startsWith("?"+encodeURIComponent('{"'))?JSON.parse(decodeURIComponent(c).substr(1)):{},u=Object.assign({},o,i);if(!Object.keys(u).length)return E.mW.replace({pathname:"/research/manage"}),(0,r.Z)(n);var p=u.title,m=u.questionnaireType,d=u.pageOrigin,h=u.questionnaireId,f=u.id,g=h||f;return n.state={questionnaireType:m,questionnaireId:g,pageOrigin:d,title:p},n._events={handleTagsChange:n.handleTagsChange,router:n.props.router,route:n.props.route},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props,t=e.router,n=(e.location.state,e.fetchParams),a=e.init,l=e.saveState;a();var r=this.state,s=r.id,i=r.questionnaireId,c=r.pageOrigin;if(n({dispatchId:s,projectId:O.t.get(O.V.curProject).id,questionnaireId:i}),(null==t?void 0:t.setRouteLeaveHook)&&t.setRouteLeaveHook(this.props.route,this.routerWillLeave),window.addEventListener("message",this._handleMessage,!1),c&&"customer"===c){var o=O.t.get("customerPage");l(o)}},n.componentWillUnmount=function(){this.props.clear(),this.routerWillLeave(),window.removeEventListener("message",this._handleMessage)},n.render=function(){return i.createElement(Ce,(0,l.Z)({},this.state,this.props,this._events))},t}(i.Component);const we=(0,R.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,Ne);return{npsDispatch:n[be],templateListLoading:t.effects[be+"/fetchTemplateList"]||!1,sendRuleStatus:n[be].sendRuleStatus,sendRuleConfig:n[be].sendRuleConfig,template:n[be].template,channelList:n[be].channelList,loading:t.effects[be+"/fetchTemplateList"]||!1}}),(function(e){return{saveState:function(t){return e({type:be+"/save",payload:t})},fetchParams:function(t){return e({type:be+"/fetchParams",payload:t})},fetchNpsDetail:function(t){return e({type:be+"/fetchNpsDetail",payload:t})},sendNps:function(){return e({type:be+"/sendNps"})},fetchContacts:function(t){return e({type:be+"/fetchContacts",payload:t})},handleCheckAll:function(){return e({type:be+"/handleCheckAll"})},handleCheck:function(t){return e({type:be+"/handleCheck",payload:t})},fetchTags:function(){return e({type:be+"/fetchTags"})},init:function(){return e({type:be+"/init"})},handleCheckboxStyle:function(){return e({type:be+"/handleCheckboxStyle"})},clear:function(){return e({type:be+"/clear"})},fetchTemplateList:function(t){return e({type:be+"/fetchTemplateList",payload:t})},save:function(t){return e({type:be+"/save",payload:t})}}}),null)(Se)},19335:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var a=n(63366),l=n(87462),r=n(94578),s=n(67294),i=n(24444),c=n(45697),o=n.n(c),u=["visible","headerStyle","closeable","bodyStyle","drawerStyle","footer","footerStyle","closable","push","title"],p=s.createContext(null),m={distance:180},d=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))||this).state={push:!1},t.parentDrawer=void 0,t.destroyClose=void 0,t.push=function(){t.props.push&&t.setState({push:!0})},t.pull=function(){t.props.push&&t.setState({push:!1})},t.onDestroyTransitionEnd=function(){t.getDestroyOnClose()&&(t.props.visible||(t.destroyClose=!0,t.forceUpdate()))},t.getDestroyOnClose=function(){return t.props.destroyOnClose&&!t.props.visible},t.getPushDistance=function(){var e,n=t.props.push;return e="boolean"===typeof n?n?m.distance:0:n.distance,parseFloat(String(e||0))},t.getPushTransform=function(e){var n=t.getPushDistance();return"left"===e||"right"===e?"translateX("+("left"===e?n:-n)+"px)":"top"===e||"bottom"===e?"translateY("+("top"===e?n:-n)+"px)":void 0},t.renderHeader=function(){var e=t.props,n=e.title,a=e.headerStyle,l=e.closeable,r=e.onClose;return n||l?s.createElement("div",{className:n?"yt-drawer-header":"yt-drawer-header-no-title",style:a},n&&s.createElement("div",{className:"yt-drawer-title"},n),l&&s.createElement("i",{className:"yt-drawer-close iconfont icon-cem_cancel",onClick:r})):""},t.renderBody=function(){var e=t.props,n=e.visible,a=e.drawerStyle,r=e.bodyStyle;if(t.destroyClose&&!n)return"";t.destroyClose=!1;var i={};return t.getDestroyOnClose()&&(i.opacity=0,i.transition="opacity .3s"),s.createElement("div",{className:"yt-drawer-wrapper-body",style:(0,l.Z)({},i,a),onTransitionEnd:t.onDestroyTransitionEnd},t.renderHeader(),s.createElement("div",{className:"yt-drawer-body",style:r},t.props.children),t.renderFooter())},t.renderFooter=function(){var e=t.props,n=e.footer,a=e.footerStyle;return n?s.createElement("div",{className:"yt-drawer-footer",style:a},n):""},t.getRcDrawerStyle=function(){var e=t.props,n=e.zIndex,a=e.placement,r=e.mask,s=e.style,i=t.state.push,c=r?{}:t.getOffsetStyle();return(0,l.Z)({zIndex:n,transform:i?t.getPushTransform(a):void 0},c,s)},t}(0,r.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.visible&&this.parentDrawer&&this.parentDrawer.push()},n.componentDidUpdate=function(e){var t=this.props.visible;e.visible!==t&&this.parentDrawer&&(t?this.parentDrawer.push():this.parentDrawer.pull())},n.componentWillUnmount=function(){this.parentDrawer&&(this.parentDrawer.pull(),this.parentDrawer=null)},n.getOffsetStyle=function(){var e=this.props,t=e.placement,n=e.width,a=e.height,l=e.visible,r=e.mask;if(!l&&!r)return{};var s={};return"left"===t||"right"===t?s.width=n:s.height=a,s},n.render=function(){var e=this,t=this.props,n=t.visible,r=(t.headerStyle,t.closeable,t.bodyStyle,t.drawerStyle,t.footer,t.footerStyle,t.closable,t.push,t.title,(0,a.Z)(t,u)),c=(0,l.Z)({open:n},r);return s.createElement(p.Consumer,null,(function(t){return e.parentDrawer=t,s.createElement(p.Provider,{value:e},s.createElement(i.Z,(0,l.Z)({handler:!1,prefixCls:"yt-drawer"},c,{open:e.props.visible,getContainer:e.parentDrawer?e.parentDrawer:null,style:e.getRcDrawerStyle()}),e.renderBody()))}))},t}(s.Component);d.defaultProps={closable:!0,placement:"right",maskClosable:!1,mask:!0,level:null,keyboard:!0,push:m};const h=d;d.propTypes={visible:o().bool,className:o().string,width:o().number,onClose:o().func,maskClosable:o().bool,level:o().object,keyboard:o().bool,push:o().oneOfType([o().object,o().bool]),placement:o().oneOf(["left","top","right","bottom"]),title:o().oneOfType([o().string,o().node]),headerStyle:o().object,closeable:o().bool,bodyStyle:o().object,drawerStyle:o().object,footer:o().oneOfType([o().string,o().node]),footerType:o().object}},52921:(e,t,n)=>{var a={"./iPhone_email.png":58089,"./iPhone_sms.png":59910};function l(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}l.keys=function(){return Object.keys(a)},l.resolve=r,e.exports=l,l.id=52921},58089:(e,t,n)=>{"use strict";e.exports=n.p+"img/b93514ccc4928b8e0b64.png"},59910:(e,t,n)=>{"use strict";e.exports=n.p+"img/45362923f120e9ad3ac6.png"},22750:(e,t,n)=>{"use strict";e.exports=n.p+"img/70b47d1aa403726c605d.png"},60226:(e,t,n)=>{"use strict";e.exports=n.p+"img/fefa3aff75a6b5063862.png"},18614:(e,t,n)=>{"use strict";e.exports=n.p+"img/5d7b073242753bb9c9c4.png"},25026:(e,t,n)=>{"use strict";e.exports=n.p+"img/9a82c3ea753a1f86b24d.png"}}]);