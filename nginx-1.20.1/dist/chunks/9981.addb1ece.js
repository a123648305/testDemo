"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[9981],{13713:(e,t,n)=>{n.d(t,{u:()=>i});var l=n(35239),i=function(e){var t=e.title,n=e.url,i=l.t.get(l.V.backProjectConfig).name;return n&&-1!==n.indexOf("memberlist")?[{title:i,url:"/account/project/preview"},{title:"\u7528\u6237\u7ec4",url:"/account/project/usergroup"},{title:t,url:n}]:[{title:i,url:"/account/project/preview"},{title:t,url:n}]}},79981:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var l,i,r,a=n(63366),o=(n(54038),n(36671)),c=(n(1025),n(65400)),s=(n(35797),n(64749)),u=(n(9405),n(89552)),d=(n(29809),n(97538)),f=(n(7940),n(31059)),m=(n(89626),n(70302)),p=(n(14574),n(56590)),h=(n(48145),n(40987)),E=n(87462),v=(n(75314),n(11187)),g=n(94578),y=n(67294),b=n(55609),D=n(35239),T=n(64396),k=n(55815),I=n(13713);!function(e){e.UPDATE_MANAGER="\u5de5\u5355\u5904\u7406\u4eba\u88ab\u66f4\u65b0",e.UPDATE_CONTENT="\u5de5\u5355\u5185\u5bb9\u88ab\u66f4\u65b0",e.UPDATE_STATUS="\u5de5\u5355\u72b6\u6001\u88ab\u66f4\u65b0",e.UPDATED_MESSAGE="\u5173\u8054\u7684\u6d88\u606f\u3001\u9884\u8b66\u901a\u77e5\u88ab\u66f4\u65b0",e.ADDED_REMARK="\u5df2\u6dfb\u52a0\u5907\u6ce8",e.UPDATED_REMARK="\u5907\u6ce8\u88ab\u66f4\u65b0",e.DELETED_REMARK="\u5907\u6ce8\u88ab\u5220\u9664",e.REMINDED="\u88ab\u522b\u4eba@"}(l||(l={})),function(e){e.WE_CHAT=" \u5fae\u4fe1\u901a\u77e5",e.EMAIL="\u90ae\u4ef6\u901a\u77e5",e.DING_DING="\u9489\u9489\u7fa4\u901a\u77e5",e.FEI_SHU="\u98de\u4e66\u7fa4\u901a\u77e5"}(i||(i={})),function(e){e.UPDATE_MANAGER="\u65b0\u589e\u3001\u53d8\u66f4\u5904\u7406\u4eba\u65f6\uff0c\u5de5\u5355\u521b\u5efa\u4eba\u3001\u5f53\u524d\u5904\u7406\u4eba\uff0c\u5173\u6ce8\u5de5\u5355\u7684\u4eba\u6536\u5230\u901a\u77e5",e.UPDATE_CONTENT="\u6807\u9898\u3001\u4f18\u5148\u7ea7\u3001\u622a\u6b62\u65f6\u95f4\u3001\u63cf\u8ff0\u3001\u4e0a\u4f20\u6587\u4ef6\u7b49\u5185\u5bb9\u66f4\u65b0\u65f6\uff0c\u5de5\u5355\u521b\u5efa\u4eba\u3001\u5f53\u524d\u5904\u7406\u4eba\u3001\u5173\u6ce8\u5de5\u5355\u7684\u4eba\u6536\u5230\u901a\u77e5",e.UPDATE_STATUS="\u4fee\u6539\u72b6\u6001\u3001\u5de5\u5355\u5df2\u5b8c\u6210\u65f6\uff0c\u5de5\u5355\u521b\u5efa\u4eba\u3001\u5f53\u524d\u5904\u7406\u4eba\u3001\u5173\u6ce8\u5de5\u5355\u7684\u4eba\u6536\u5230\u901a\u77e5",e.UPDATED_MESSAGE="\u5de5\u5355\u65b0\u589e\u5173\u8054\u6d88\u606f\u3001\u9884\u8b66\u901a\u77e5\uff0c\u6216\u53d6\u6d88\u5173\u8054\u65f6\uff0c\u5de5\u5355\u521b\u5efa\u4eba\u3001\u5f53\u524d\u5904\u7406\u4eba\u3001\u5173\u6ce8\u5de5\u5355\u7684\u4eba\u6536\u5230\u901a\u77e5",e.ADDED_REMARK="\u5de5\u5355\u4e2d\u6dfb\u52a0\u4e86\u5907\u6ce8\u65f6\uff0c\u5de5\u5355\u521b\u5efa\u4eba\u3001\u5f53\u524d\u5904\u7406\u4eba\u3001\u5173\u6ce8\u5de5\u5355\u7684\u4eba\u6536\u5230\u901a\u77e5",e.UPDATED_REMARK="\u5907\u6ce8\u88ab\u7f16\u8f91\u65f6\uff0c\u5de5\u5355\u521b\u5efa\u4eba\u3001\u5f53\u524d\u5904\u7406\u4eba\u3001\u5173\u6ce8\u5de5\u5355\u7684\u4eba\u6536\u5230\u901a\u77e5",e.DELETED_REMARK="\u5907\u6ce8\u88ab\u5220\u9664\u65f6\uff0c\u5de5\u5355\u521b\u5efa\u4eba\u3001\u5f53\u524d\u5904\u7406\u4eba\u3001\u5173\u6ce8\u5de5\u5355\u7684\u4eba\u6536\u5230\u901a\u77e5",e.REMINDED="\u88ab\u522b\u4eba@\u65f6\uff0c\u6536\u5230\u901a\u77e5"}(r||(r={}));var A=["loading"],R=T.Z.workOrder.notice,N=function(e){function t(t){var n;return(n=e.call(this,t)||this).formRef=y.createRef(),n.state=void 0,n.sendChange=function(e){n.setState({dingding:null==e?void 0:e.includes("DING_DING"),feishu:null==e?void 0:e.includes("FEI_SHU")})},n.noticeUpdate=function(e,t){var l=D.t.get(D.V.backProjectConfig).id;if("save"===t){var i,r,a;if(null==(i=n.formRef.current)||!i.getFieldValue("sendChannels").length)return void v.default.error("\u81f3\u5c11\u9009\u4e00\u4e2a\u63a8\u9001\u56e2\u961f\u6216\u7528\u6237");n.props.fetchSend((0,E.Z)({projectId:l},null==(r=n.formRef.current)?void 0:r.getFieldsValue())),n.setState({initialValues:null==(a=n.formRef.current)?void 0:a.getFieldsValue(),isRevise:!1})}else{var o={projectId:l,sendItem:{isOpened:e,item:t}};n.props.fetchSend(o)}},n.state={isRevise:!1,initialValues:void 0},t.save({projectId:D.t.get(D.V.backProjectConfig).id}),n}(0,g.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;Promise.all([this.props.fetchWeebhookList("DINGDING"),this.props.fetchWeebhookList("FEISHU"),this.props.fetchList()]).then((function(){var t,n,l,i,r=e.props,a=r.noticeList,o=r.feishuList,c=r.dingdingList,s=null==a?void 0:a.channelStatusList,u=null==s||null==(t=s.find((function(e){return"DING_DING"===e.channelType})))||null==(n=t.webhookIds)?void 0:n.filter((function(e){return null==c?void 0:c.map((function(e){return e.id})).includes(e)})),d=null==s||null==(l=s.find((function(e){return"FEI_SHU"===e.channelType})))||null==(i=l.webhookIds)?void 0:i.filter((function(e){return null==o?void 0:o.map((function(e){return e.id})).includes(e)})),f={sendChannels:null==s?void 0:s.filter((function(e){return e.isOpened})).map((function(e){return e.channelType})),dingdingWebhookIds:u,feishuWebhookIds:d};e.setState({dingding:null==s?void 0:s.some((function(e){return"DING_DING"===e.channelType&&e.isOpened})),feishu:null==s?void 0:s.some((function(e){return"FEI_SHU"===e.channelType&&e.isOpened})),initialValues:f},(function(){var t;null==(t=e.formRef.current)||t.setFieldsValue(f)}))}))},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){var e=this,t=this.props,n=t.noticeList,a=t.whLoading,E=t.dingdingList,v=t.feishuList,g=null==E?void 0:E.map((function(e){return{value:e.id,label:e.name}})),b=null==v?void 0:v.map((function(e){return{value:e.id,label:e.name}})),D=null==n?void 0:n.messageStatusList.filter((function(e){return l[e.messageType]})),T=null==n?void 0:n.channelStatusList.map((function(e){return{value:e.channelType,label:i[e.channelType]}})),A=this.state,R=A.isRevise,N=A.initialValues,_=A.dingding,C=A.feishu;return y.createElement("div",{className:"workOrder-notice-wrapper"},y.createElement(k.Z,{title:(0,I.u)({title:"\u901a\u77e5\u914d\u7f6e",url:""})}),y.createElement("div",{className:"workOrder-notice-container"},y.createElement(m.Z,{title:"\u901a\u77e5\u5185\u5bb9",bordered:!1},y.createElement(p.default,{itemLayout:"horizontal",dataSource:D,renderItem:function(t){return y.createElement(p.default.Item,null,y.createElement(p.default.Item.Meta,{title:y.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4}},y.createElement("span",null,l[t.messageType]),y.createElement(h.Z,{defaultChecked:t.isOpened,onChange:function(n){return e.noticeUpdate(n,t.messageType)}})),description:r[t.messageType]}))}})),y.createElement(m.Z,{title:"\u63a8\u9001\u65b9\u5f0f",extra:n&&!R&&y.createElement("a",{style:{color:"#1890ff"},onClick:function(){return e.setState({isRevise:!0})}},"\u4fee\u6539"),bordered:!1},n?y.createElement(d.Z,{labelCol:{span:3},wrapperCol:{span:21},colon:!1,ref:this.formRef},y.createElement(d.Z.Item,{label:"\u63a8\u9001\u65b9\u5f0f",name:"sendChannels",className:"title-tip"},y.createElement(f.default.Group,{onChange:this.sendChange,options:T,disabled:!R})),(_||C)&&R&&y.createElement(d.Z.Item,{label:"\u7fa4\u901a\u77e5",className:"title-tip"},y.createElement("a",{href:"/account/project/webhookList",target:"_blank",style:{color:"#1890ff"}},"\u914d\u7f6eWebhook\u540e\uff0c\u624d\u80fd\u4f7f\u7528\u7fa4\u901a\u77e5"," ",y.createElement("i",{className:"icon-cem_arrow-thick",style:{fontSize:12}}))),_&&y.createElement(d.Z.Item,{label:"\u9489\u9489\u7fa4Webhook",name:"dingdingWebhookIds",shouldUpdate:!0},y.createElement(s.default,{disabled:!R,style:{width:400},placeholder:"\u8bf7\u9009\u62e9Webhook\u5730\u5740",options:g,mode:"multiple",dropdownRender:function(e){return a?y.createElement("div",{style:{textAlign:"center"}},y.createElement(u.default,null)):e}})),C&&y.createElement(d.Z.Item,{label:"\u98de\u4e66\u7fa4Webhook",name:"feishuWebhookIds",shouldUpdate:!0},y.createElement(s.default,{disabled:!R,style:{width:400},placeholder:"\u8bf7\u9009\u62e9Webhook\u5730\u5740",options:b,mode:"multiple",dropdownRender:function(e){return a?y.createElement("div",{style:{textAlign:"center"}},y.createElement(u.default,null)):e}})),R&&y.createElement(d.Z.Item,{label:" "},y.createElement(c.default,{type:"primary",htmlType:"submit",onClick:function(t){return e.noticeUpdate(t,"save")}},"\u4fdd\u5b58"),y.createElement(c.default,{onClick:function(){e.formRef.current.setFieldsValue(N),e.setState({isRevise:!1})}},"\u53d6\u6d88"))):y.createElement(o.default,{image:o.default.PRESENTED_IMAGE_SIMPLE}))))},t}(y.Component);const _=(0,b.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,A);return(0,E.Z)({},n[R],{loading:t.effects[R+"/fetchList"]||!1,whLoading:t.effects[R+"/fetchWeebhookList"]||!1})}),(function(e){return{save:function(t){return e({type:R+"/save",payload:t})},clean:function(){return e({type:R+"/clean"})},fetchList:function(t){return e({type:R+"/fetchList",payload:t})},fetchSend:function(t){return e({type:R+"/fetchSend",payload:t})},fetchWeebhookList:function(t){return e({type:R+"/fetchWeebhookList",payload:t})}}}))(N)},55815:(e,t,n)=>{n.d(t,{Z:()=>u});var l=n(94578),i=n(67294),r=n(45697),a=n.n(r),o=n(43036),c=n(61409),s=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),i=0;i<n;i++)l[i]=arguments[i];return(t=e.call.apply(e,[this].concat(l))||this)._handleBreadcrumbClick=function(e){var n=t.props,l=n.title,i=n.beforeJump;e!==l.length-1&&(i?new Promise((function(e,t){return i(e,t)})).then((function(){c.mW.push({pathname:l[e].url,state:l[e].state})})):c.mW.push({pathname:l[e].url,state:l[e].state}))},t}return(0,l.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,l=t.mainTitle,r=t.rightContent,a=t.className,c=t.overlay;return i.createElement("div",{className:"breadcumb-wrapper "+a},n instanceof Array?i.createElement("div",{className:"breadcrumb-left"},i.createElement("div",null,n.map((function(t,l){return i.createElement("span",{className:t.url?"":"not_clickable",key:l,onClick:function(){return t.url&&l!==n.length-1&&e._handleBreadcrumbClick(l)}},t.title,l!==n.length-1&&" / ")}))),i.createElement("span",null,l||n[n.length-1].title,c&&i.createElement(o.Z,{placement:"top",overlay:c},i.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}})))):i.createElement("div",{className:"normal-title"},n,c&&i.createElement(o.Z,{placement:"top",overlay:c},i.createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:8}}))),r||"")},t}(i.Component);s.propTypes={className:a().string,title:a().oneOfType([a().string,a().arrayOf(a().shape({title:a().string,url:a().string,state:a().object}))]).isRequired,overlay:a().oneOfType([a().string,a().node]),mainTitle:a().oneOfType([a().string,a().node]),beforeJump:a().func,rightContent:a().node};const u=s}}]);