"use strict";(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[136],{70136:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var a=n(63366),r=n(87462),i=n(94578),o=n(67294),l=n(19586),c=n(8201),u=n(50976),s=n(25713),d=n(92360);const h=function(e){var t=e.options,n=e.onChange,a=e.activeObj,r=e.objName;return o.createElement("div",{className:"yt-radio-select-button-wrapper"},o.createElement(d.Radio.Group,{value:a,onChange:function(e){var t;n(((t={})[r]=e,t))}},t.map((function(e){return o.createElement(d.Radio.Button,{key:e.title,value:e.value},e.title)}))))};var p=n(39432),f=n(70715),m=(0,p.jD)(" ",12);var g=function(e,t,n){var a,i,o;n<700?(a=1,i=n/2,o=n):700<=n&&n<1200?(a=2,i=n/4,o=n/2):n>=1200&&(a=3,i=n/5,o=n/3);var l=.6*o*.5,c=.4*o-16-32,u=Math.ceil(e.length/a),s=Array.from({length:u}),d=Array.from({length:a}),h=s.reduce((function(t,n,r){return[].concat(t,d.reduce((function(t,n,u){var s=r*a+u,d=e[s];if(d){var h={type:"text",style:{text:d.dimensions[1],x:24+u*o,y:80+i*r,font:"14px "+f.I8}},g={itemWidth:12,itemHeight:12,itemGap:8,icon:f.W4.square,type:"scroll",orient:"vertical",align:"left",pageIconSize:10,top:110+i*r,left:.6*o+u*o,height:.72*i,data:d.source[0].slice(1),formatter:function(e){var t=function(e){var t=e,n=(0,p.jD)(e,12);if(n>72)for(var a=0,r=e.length;a<r;a++)if(t=e.substring(0,r-1-(a+1)),(n=(0,p.jD)(t+"...",12))<=72){t+="...";break}return{label:t,labelWidth:n}}(e.split("$_$")[1]),n=t.label,a=t.labelWidth,r=d.source[0].indexOf(e),i=(100*d.source[1][r]).toFixed(2)+"%",o=(0,p.jD)(i,12),l=((c-a-o)/m).toFixed(0)-0;return"{a|"+n+"}"+Array.from({length:l}).map((function(){return" "})).join("")+"{b|"+i+"}"},textStyle:{rich:{a:{padding:4,color:"#262626"},b:{color:"#8c8c8c"}}}};return[].concat(t,[{title:h,legend:g,serie:{type:"pie",datasetIndex:s,seriesLayoutBy:"row",hoverOffset:4,itemStyle:{borderColor:"#ffffff",borderWidth:2,color:function(e){var t=e.dataIndex;return f.Fq[t%f.Fq.length]}},label:{show:!1},labelLine:{show:!1},center:[l+o*u,.5*(i-60)+i*r+80+30],radius:[.45*l,.65*l]}}])}return t}),[]))}),[]);return{title:{text:"\u54c1\u724c\u8bc4\u8bba\u6570\u5206\u5e03"},dataset:e.map((function(e){return(0,r.Z)({},e,{sourceHeader:!0})})),tooltip:{formatter:function(e){var t=e.marker,n=e.data,a=e.percent;return[t+" "+n[0].split("$_$")[1],"\u6570\u91cf\uff1a"+n[2],"\u5360\u6bd4\uff1a"+a+"%"].join("</br>")}},legend:h.map((function(e){return e.legend})),graphic:h.map((function(e){return e.title})),series:h.map((function(e){return e.serie})),ext:{rowNum:u,colNum:a,childHeight:i}}},v=[{title:"\u5bfc\u51fa\u56fe\u7247",type:"image"},{title:"\u5bfc\u51fa\u6570\u636e",type:"data"}],y=[{title:"\u578b\u53f7",value:"BRAND_MODEL"},{title:"\u5e97\u94fa",value:"BRAND_SHOP"}];const C=function(e){var t=e.data,n=e.loading,a=e.dataType,r=e.contentWidth,i=e.onFilterChange,l=e.onMoreClick,d=o.useState(""),p=d[0],f=d[1],m=o.useState(void 0),C=m[0],b=m[1];return o.useEffect((function(){if(C)if((0,c.P)(t)){var e=r-24-6,n=g(t,0,e);f(n.title.text),C.clear(),C.resize({width:e,height:80+n.ext.rowNum*n.ext.childHeight}),C.setOption(n)}else b(void 0)}),[t,C,a,r]),o.createElement(c.Z,{data:t,className:"yt-brand-dist-chart-wrapper",renderTitle:p&&o.createElement("div",{className:"title"},o.createElement("span",null,o.createElement(h,{onChange:i,objName:"bdType",options:y,activeObj:a}),o.createElement(s.Z,{onClick:function(e){return function(e,t,n,a){var r=void 0;"image"===t?r=e:"data"===t&&(r=[[].concat(n.reduce((function(e,t){return[].concat(e,[t.dimensions],t.source.map((function(e,t){return e.map((function(e,n){return 0===t&&0!==n?e.split("-")[1]:1===t&&0!==n?(100*e).toFixed(2)+"%":e}))})),[[""]])}),[]))]);a({type:t,obj:r,name:e.getOption().title[0].text})}(C,e,t,l)},options:v,style:{float:"right"}})))},t&&o.createElement(o.Fragment,null,o.createElement(u.Z,{theme:"yunting_multi_color",showLoading:n,loadingOption:{text:"",color:"#20a0ff"},option:{},style:{width:"100%",height:0},onChartReady:function(e){return b(e)}})))};var b=n(41103);const D=function(e){var t=e.bdData,n=e.bdType,a=e.onBrandDistFilterChange,r=e.pieChartData,i=e.barChartData,c=e.barChartLoading,u=e.contentWidth,s=e.isInitial,d=e.getFilterRef,h=e.onHeadFilterChange,p=e.onHeadFilterReady,f=e.onMoreClick;return o.createElement("div",{className:"yt-price-brand-analysis-wrapper"},o.createElement(l.Z,{title:"\u54c1\u724c\u5206\u6790",ref:d,showList:["condition","time"],filter:["CONN_CONFIG","SOURCE"],onChange:h,onFilterReady:p}),o.createElement("div",{className:"content",id:"content"},o.createElement(b.Z,{isInitial:s,loading:c,title:"\u54c1\u724c\u8bc4\u8bba\u6570\u5206\u5e03",otherChartType:"bar",pieChartData:r,otherChartData:i}),o.createElement(C,{data:t,contentWidth:u,dataType:n,onMoreClick:f,onFilterChange:a})))};var E=n(35239),w=n(55609),x=n(94644),k=n(64396),F=["loading"],_=k.Z.price.priceBranding,O=function(e){function t(t){var n;return(n=e.call(this,t)||this)._handleOnBrandDistFilterChange=function(e){n.props.fetchBrandDistributionData((0,r.Z)({},e))},n._handleOnMoreClick=function(e){"image"===e.type?(0,x._v)(e.obj,e.name):"data"===e.type&&(0,x.aT)(e.obj,e.name)},n._handelOnHeadFilterReady=function(){var e=n.filter.getValue();n._handelOnHeadFilterChange(e)},n._handelOnHeadFilterChange=function(e){n.props.fetchDatas((0,r.Z)({projectId:E.t.get(E.V.curProject).id},e))},n._handleWindowResize=function(){n.setState({contentWidth:document.getElementById("content").offsetWidth})},n.state={},n.event={onMoreClick:n._handleOnMoreClick,onBrandDistFilterChange:n._handleOnBrandDistFilterChange,onHeadFilterReady:n._handelOnHeadFilterReady,onHeadFilterChange:n._handelOnHeadFilterChange,getFilterRef:function(e){return n.filter=e}},n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return o.createElement(D,(0,r.Z)({},this.props,this.state,this.event))},t}(o.PureComponent);const S=(0,w.connect)((function(e){var t=e.loading,n=(0,a.Z)(e,F);return(0,r.Z)({},n[_],{bdLoading:t.effects[_+"/fetchBrandDistributionData"]||!1,barChartLoading:t.effects[_+"/fetchBarChartData"]||!1})}),(function(e){return{fetchDatas:function(t){return e({type:_+"/fetchDatas",payload:t})},fetchBrandDistributionData:function(t){return e({type:_+"/fetchBrandDistributionData",payload:t})}}}))(O)},38177:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(94578),r=n(67294),i=n(45697),o=n.n(i),l=n(92360),c=n(43036),u=function(e){function t(t){var n;return(n=e.call(this,t)||this).getPercentage=function(){for(var e=n.props.data,t=0,a=0,r=0,i=0,o=0,l=0;l<e.length;l++){var c=e[l].value;t+=c,l<100&&(o+=c,l<50&&(i+=c,l<30&&(r+=c,l<10&&(a+=c))))}n.setState({percentage:{10:0===t?0:a/t,30:0===t?0:r/t,50:0===t?0:i/t,100:0===t?0:o/t}})},n.toggleDisplay=function(){var e=n.state.show;n.setState({show:!e})},n.switchTopValue=function(e){n.setState({topValue:e})},n.handleConfirm=function(){var e=n.props.onConfirm,t=n.state.topValue;e&&e(t),n.setState({show:!1})},n.state={show:!1,topValue:t.topValue||0,percentage:{10:0,30:0,50:0,100:0}},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.getPercentage()},n.render=function(){var e=this,t=this.state,n=t.show,a=t.topValue,i=t.percentage,o=this.props.data,u=o[0]?o[0].value:0,s=o[a<=o.length?a-1:o.length-1].value||0,d=[10,30,50,100];return r.createElement(l.Dialog,{title:"\u89c6\u56fe\u8fc7\u6ee4",size:"tiny",visible:n,customClass:"data_filter_wrapper",onCancel:this.toggleDisplay,lockScroll:!0},r.createElement(l.Dialog.Body,null,r.createElement("div",{className:"input_set"},r.createElement(l.Input,{value:u,disabled:!0}),r.createElement("span",null,"-"),r.createElement(l.Input,{value:s,disabled:!0})),r.createElement("div",{className:"bar_set"},d.map((function(t){return r.createElement(c.Z,{placement:"top",overlay:"Top"+t+"\u5360\u603b\u6570\u636e\u91cf\u7684"+(100*i[t]).toFixed(2)+"%",key:t},r.createElement("div",{className:a===t?"bar active":"bar",style:{height:100*i[t]+"px"},onClick:function(){return e.switchTopValue(t)}}))}))),r.createElement("div",{className:"desc_set"},d.map((function(e){return r.createElement("span",{key:e},"top"+e)})))),r.createElement(l.Dialog.Footer,{className:"dialog-footer"},r.createElement(l.Button,{onClick:this.toggleDisplay},"\u53d6\u6d88"),r.createElement(l.Button,{type:"primary",onClick:this.handleConfirm},"\u786e\u5b9a")))},t}(r.Component);u.propTypes={data:o().arrayOf(o().shape({name:o().string.isRequired,value:o().number.isRequired})),topValue:o().number.isRequired,onConfirm:o().func.isRequired}},41103:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(50361),r=n.n(a),i=n(67294),o=n(50976),l=n(30133),c=n(31705),u=n(38177),s=n(94644),d=n(87462),h=n(39432);const p=function(e){var t=e.isInitial,n=e.loading,a=e.title,p=e.otherChartType,f=e.pieChartData,m=e.otherChartData,g=e.type,v=e.formatedData,y=e.topValue,C=e.save,b=i.useState(void 0),D=b[0],E=b[1],w=i.useState(void 0),x=w[0],k=w[1];i.useEffect((function(){if(!t&&!n&&D&&f&&f.length>0&&m){var e=function(e){var t=e.title,n=e.otherChartType,a=e.pieChartData,r=e.otherChartData,i=e.type,o=a.length>0?a.reduce((function(e,t){return e+t.count}),0):0,l=a.map((function(e){var t=0===o?0:e.count/o*100;return e.percentage=Number.isInteger(t)?t:t.toFixed(2),e})),c={type:"pie",id:"pie",radius:["57%","68%"],center:["9%","60%"],legendHoverLink:!1,hoverAnimation:!0,hoverOffset:3,label:{show:!0,position:"center",formatter:["{a|"+h.ZP.formatNumber(o)+"}","{b|"+(i&&"PRODUCT"===i?"\u8bc4\u8bba\u6570":"\u9500\u91cf")+"}"].join("\n"),rich:{a:{fontSize:24,lineHeight:32,color:"#262626",padding:[4,0]},b:{fontSize:14,lineHeight:20,color:"#8C8C8C",padding:[4,0]}}},itemStyle:{borderWidth:1,borderColor:"#fff"},data:l.map((function(e){return{name:e.name,value:e.count}}))},u=r.map((function(e){var t=0;return e.data.length>0&&e.data.forEach((function(e){t+=e.count})),e.total=t,e}));u.sort((function(e,t){return t.total-e.total}));var s="bar"===n?{barMaxWidth:32,large:!0}:{smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{opacity:1}},p=u.map((function(e){var t=e.name,a=e.data;return(0,d.Z)({},s,{name:t,type:n,stack:"stack",data:a.length>0?a.map((function(e){return{name:e.date,value:e.count}})):[]})}));return{title:{text:t,textStyle:{fontSize:14,lineHeight:20},left:0,top:0},tooltip:{confine:!0,enterable:l&&l.length>17,axisPointer:{type:"none"},formatter:function(e){return Array.isArray(e)?(e.sort((function(e,t){return e.value-t.value})),e[0].name+e.map((function(e){return"<br/>"+e.marker+e.seriesName+"\uff1a"+e.value})).reverse().join("")):e.marker+" "+e.name+"\uff1a"+e.value+"\uff08"+e.percent+"%\uff09"},extraCssText:"max-height: 400px; overflow: auto"},legend:{type:"scroll",orient:"vertical",left:"20%",top:"26%",itemWidth:12,itemHeight:12,itemGap:16,pageIconSize:12,formatter:function(e){return"{a|"+(e.length>9?e.substring(0,9)+"...":e)+"}{b|"+l.filter((function(t){return t.name===e}))[0].percentage+"%}"},textStyle:{rich:{a:{width:102,padding:[0,4]},b:{width:48,color:"#8C8C8C",align:"right"}}},data:l.length>0?l.map((function(e){return{name:e.name,icon:"rect"}})):[]},xAxis:{type:"category",boundaryGap:"bar"===n,data:u.length>0?u[0].data.map((function(e){return e.date})):[]},yAxis:{gridIndex:0},grid:{show:!1,top:"26%",left:"40%",right:"2%",bottom:0,containLabel:!0,tooltip:{trigger:"axis"}},series:[].concat(p,[c])}}({title:a,otherChartType:p,pieChartData:r()(f),otherChartData:r()(m),type:g});D.clear(),D.setOption(e)}}),[t,n,f,m,D,g]);var F=["SPU","SHOP"];return i.createElement("div",{className:"double-chart-wrapper"},t?i.createElement(l.Z,null):0===f.length?i.createElement("div",{className:"empty-block"},"\u6682\u65e0\u6570\u636e"):i.createElement(i.Fragment,null,i.createElement(o.Z,{theme:"yunting_multi_color",option:{},showLoading:n,style:{width:"100",height:"252px",display:f.length>0?"block":"none"},loadingOption:{text:"",color:"#1574B3"},onChartReady:function(e){return E(e)}}),i.createElement(c.Z,{onDownChartClick:function(){return function(e,t){(0,s._v)(e,t)}(D,a)},onDownExcelClick:function(){return function(e,t){if(e.length>0){for(var n=e.map((function(e){return e.name})),a=[],r=0;r<e[0].data.length;r++){var i=[];i.push(e[0].data[r].date);for(var o=0;o<e.length;o++)i.push(e[o].data[r].count);a.push(i)}n.splice(0,0,"\u65e5\u671f"),a.splice(0,0,n),(0,s.aT)([a],t)}}(m,a)},otherOptions:F.includes(g)?[{label:"\u89c6\u56fe\u8fc7\u6ee4",clickFun:function(){return x.toggleDisplay()}}]:[]}),F.includes(g)&&i.createElement(u.Z,{data:v,topValue:y,ref:k,onConfirm:function(e){return C({firstTopValue:e})}})))}}}]);