(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8603],{38603:(e,t,a)=>{"use strict";a.d(t,{Z:()=>B});function f(e,t,a){if(0===e.list.length)return"empty";var n={npsValue:+(100*e.npsValue).toFixed(0),circleNpsValue:null===e.circleNpsValue?null:+(100*e.circleNpsValue).toFixed(0)};n.rate=n.circleNpsValue&&null!==n.npsValue?((n.npsValue-n.circleNpsValue)/n.circleNpsValue*100).toFixed(2)+"%":"--";var l,e=e.list;return{axisPointer:{link:{xAxisIndex:"all"}},title:{text:t},tooltip:{formatter:function(e){return(e||[]).map(function(e){return'<span style="font-weight: bold;font-size: 12px">'+e.name+"</span><br/>"+e.marker+e.seriesName+"："+(null===e.data?"-":e.data)}).join("<br/><br/>")}},xAxis:[{type:"category",data:e.map(function(e){return(0,u.yV)(a,e.time)}),boundaryGap:!1,position:"bottom",axisLine:{onZero:!1}},{type:"category",data:e.map(function(e){return(0,u.yV)(a,e.time)}),gridIndex:1,show:!1,boundaryGap:!1}],yAxis:[{type:"value",name:"NPS分值",nameTextStyle:{color:"#262626",padding:[0,0,10,0]},minInterval:1,splitNumber:3},{type:"value",axisLine:{show:!1},axisLabel:{show:!1},gridIndex:1,name:"答题数量",nameTextStyle:{color:"#262626"}}],dataZoom:[{type:"slider",show:!0,xAxisIndex:[0,1],height:16,top:335}],grid:[{left:470,right:50,top:80,height:"32%",tooltip:{trigger:"axis"}},{left:470,right:50,top:265,gridIndex:1,height:"15%",tooltip:{trigger:"axis"}}],graphic:[{type:"text",left:"245",top:"30%",silent:!0,style:{text:70<(t=n.npsValue)?"卓越":50<t&&t<=70?"优秀":10<t&&t<=50?"良好":5<t&&t<=10?"糟糕":"糟糕透顶",fill:"#262626",font:"26px "+s.I8}},{type:"text",left:"245",top:"43%",silent:!0,style:{text:"当前表现",fill:"#8C8C8C",font:"14px "+s.I8}}].concat((l=n,[].concat(p.map(function(e,t){var a=null===l.circleNpsValue?"--":l.circleNpsValue;return 1===t&&(a=l.rate),d(t,a)})))),series:[{data:e.map(function(e){return null!==e.npsValue?(100*e.npsValue).toFixed(0):null}),type:"line",smooth:!0,symbol:"circle",symbolSize:2.5,itemStyle:{},markLine:{symbolSize:0,data:[{type:"average",name:"平均线"}],lineStyle:{color:"#BFBFBF"},label:{show:!1,formatter:"均值"},tooltip:{show:!1}},lineStyle:{color:"#0074B8"},name:"NPS分值"},{data:e.map(function(e){return e.questionnaireTotal}),type:"line",symbol:"circle",symbolSize:2,smooth:!0,xAxisIndex:1,yAxisIndex:1,areaStyle:{color:"#E7F1F7"},itemStyle:{color:"#1574B3"},lineStyle:{color:"#1574B3"},name:"答题数量"},{tooltip:{formatter:function(e){var t=e.seriesName,a=e.data.value,e="";return a<-50?e=c[0]:-50<=a&&a<0?e=c[1]:0<=a&&a<50?e=c[2]:a<=100&&(e=c[3]),['<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+e+';"></span>'+'<span style="font-weight: bold">'+t+"</span>","NPS值："+a].join("<br/>")}},name:"NPS",type:"gauge",min:-100,max:100,center:["130","52%"],splitNumber:5,radius:"50%",axisLine:{show:!0,lineStyle:{color:[[.525,"#bfbfbf"],[.55,"#D07B49"],[.75,"#CDB446"],[.85,"#15B374"],[1,"#119073"]],width:18}},splitLine:{show:!0,length:26,lineStyle:{color:"#e5e5e5"}},axisTick:{show:!0,length:6},axisLabel:{color:"#262626",fontSize:"12px"},detail:{offsetCenter:[0,"90%"],formatter:["{a|"+(null===n.npsValue?"--":n.npsValue)+"}","{b|NPS}"].join("\n"),rich:{a:{color:"#262626",fontSize:40,lineHeight:60,fontFamily:s.I8},b:{color:"#262626",fontSize:12,fontFamily:s.I8}}},title:{show:!1},pointer:{show:!(null===n.npsValue),length:"60%",width:6},itemStyle:{color:"auto"},data:[{value:n.npsValue}]}]}}var n=a(37316),l=a.n(n),t=a(67154),r=a.n(t),n=a(85354),i=a.n(n),t=a(67294),E=a.n(t),n=a(64396),t=a(55609),o=a(35239),D=a(10291),S=a(17582),b=a(61210),h=a(50976),y=a(8201),v=a(60496),g=a(98191),x=a(43036),s=a(70715),N=a(94644),u=a(39432),p=["上期","环比"],c=["#D96969","#D07B49","#CDB446","#15B374"],d=function(e,t){return{type:"group",left:"245",top:0===e?"57%":"65%",silent:!0,children:[{type:"text",style:{text:p[e],fill:"#8C8C8C",font:"14px "+s.I8}}].concat(m(t))}},m=function(e,t){return[{type:"text",left:50,style:{text:e,fill:"#262626",font:"14px "+s.I8}}]};const C=function(e){var l=e.data,t=e.dateOptions,a=e.defaultDateType,n=e.setDefaultValue,r=e.flavorObj,i=e.className,o=e.fetchNpsData,e=E().useState(void 0),s=e[0],u=e[1],e=E().useState(void 0),p=e[0],c=e[1],e=E().useState(void 0),d=e[0],m=e[1];return E().useEffect(function(){var e,t;p&&s&&(e=p,(t=s).clear(),t.setOption(e))},[p,s]),E().useEffect(function(){var e;l&&(e=f(l,"NPS分析",d),c(e))},[l]),E().useEffect(function(){r&&m(t.some(function(e){return e.value===r.npsAnalyze})?r.npsAnalyze:a)},[r,a,t]),E().createElement(y.Z,{data:p,className:"yt_research_analyze_line_chart_wrap "+(i||""),renderTitle:E().createElement(g.Z,{data:p,onMoreClick:function(e){var t,a,n;t=s,a=l,n=void 0,"image"===(e=e)?(0,N._v)(n=t,"nps分析"):"data"===e&&((n=a.list.map(function(e){return[e.time,+(100*e.npsValue).toFixed(0),e.questionnaireTotal]})).unshift(["日期","nps值","答题数量"]),(0,N.aT)(n=[n],"nps分析"))},title:"NPS分析",titleOverlay:E().createElement("div",null,E().createElement("div",null,"净推荐值(NPS)=(推荐者数/总样本"),E().createElement("div",null,"数)x100%-(贬损者数/总样本数)x100%，"),E().createElement("div",null,"然后取百分号前面的整数。")," ",E().createElement("div",null,"环比 = （当期 - 上期） ÷ 上期"))},E().createElement("div",null,E().createElement(v.Z,{onChange:function(e){m(e),o({dateGroupType:e})},activeObj:d,options:t,flavor:(r||{}).npsAnalyze,onFlavorChange:function(e){return n({key:"npsAnalyze",value:e})}})))},E().createElement(h.Z,{theme:"yunting_multi_color",loadingOption:{text:"加载中",color:"#20a0ff"},option:{},opts:{devicePixelRatio:2},style:{width:"100%",height:"100%"},onChartReady:function(e){return u(e)}}),E().createElement("div",{className:"reasearch_popover"},E().createElement(x.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:E().createElement("div",{className:"overlay"},E().createElement("div",null,E().createElement("span",null,"卓越："),E().createElement("span",null,"NPS值大于70。如亚马逊，它拥有大量忠诚客户。")),E().createElement("div",null,E().createElement("span",null,"优秀："),E().createElement("span",null,"NPS的得分值在50以上被认为是不错的。")),E().createElement("div",null,E().createElement("span",null,"良好："),E().createElement("span",null,"NPS值大于10，此时已经开始脱离平庸公司的范畴")),E().createElement("div",null,E().createElement("span",null,"糟糕："),E().createElement("span",null,"大部分公司的NPS值还是在5-10之间徘徊。所以我们将处于这一区间的值定义为糟糕。")),E().createElement("div",null,E().createElement("span",null,"糟糕透顶："),E().createElement("span",null,"NPS值小于5时，我们只能用这样的词来形容了。")))},E().createElement("i",{className:"icon-cem_file1"}))))};var T=a(29383);a(98245);var V=[{title:"NPS分值对比",value:0},{title:"答卷数量对比",value:1}];function P(a,t,n){a&&t&&new Promise(function(e){var t,l;e((t=a,l=n,e=Math.max.apply(Math,t.map(function(e){return e[l?"questionnaireTotal":"npsValue"]})),{title:{text:"各省NPS值对比和答题数"},tooltip:{formatter:function(e){var t=e.marker,a=e.data;if(a){var n=a.name,e=a.value,a=a.other;return[t+'<span style="font-size: 16px; line-height: 30px">'+n+"</span>",(0===l?"NPS值：":"答卷数量：")+(0===l&&-101===e?"无":e),(0===l?"答卷数量：":"NPS值：")+(0!==l&&-101===a?"无":a)].join("<br/>")}}},visualMap:{bottom:20,min:0===l?-100:0,max:0===l?100:0===e?1:e,text:0===l?void 0:["高","低"],inRange:{color:0===l?["#bfbfbf","#D07B49","#CDB446","#15B374","#119073"]:["white","#1474B3"]},outOfRange:{color:["white"]},pieces:0===l?[{label:"> 70（卓越）",min:70},{label:"50 - 70（优秀）",min:50,max:70},{label:"10 - 50（良好）",min:10,max:50},{label:"5 - 10（糟糕）",min:5,max:10},{label:"< 5（糟糕透顶）",max:5,min:-100}]:void 0,itemWidth:16,itemHeight:12,itemGap:6,type:"piecewise",top:350,left:40},series:[{type:"map",map:"china",left:70,label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{emphasis:{areaColor:"#CDB446"}},data:t.map(function(e){return{name:e.province.replace("省",""),value:0===l?null!==e.npsValue?+(100*e.npsValue).toFixed(0):-101:e.questionnaireTotal,other:0===l?e.questionnaireTotal:null!==e.npsValue?+(100*e.npsValue).toFixed(0):-101}})}]}))}).then(function(e){t.clear(),t.setOption(e)})}const w=function(e){var r=e.data,t=e.flavorObj,a=e.loading,n=e.setDefaultValue,e=E().useState(void 0),i=e[0],l=e[1],e=E().useState((t||{}).mapAnalyze||0),o=e[0],s=e[1];return E().useEffect(function(){P(r,i,o)},[r,i,o]),E().useEffect(function(){s((t||{}).mapAnalyze||0)},[t]),E().createElement(y.Z,{className:"research_analyze_map",renderTitle:E().createElement(g.Z,{data:r,onMoreClick:function(e){var t,a,n,l;t=i,n=r,l=0===(a=e)?"NPS分值对比":"答卷数量对比",e=void 0,"image"===a?(0,N._v)(e=t,l):"data"===a&&((e=n.map(function(e){return[e.province,null===e.npsValue?"无":+(100*e.npsValue).toFixed(0),e.questionnaireTotal]})).unshift(["省份","NPS分值","答题数量"]),(0,N.aT)(e=[e],"各省NPS值对比和答题数"))},title:"各省NPS值对比和答题数",titleOverlay:E().createElement("div",null,E().createElement("div",null,"收集到NPS的分值题就算回收了1个答题"),E().createElement("div",null,"客户的城市是依据答题访问问卷时获得的IP"),E().createElement("div",null,"地址解析得出"))},E().createElement(v.Z,{onChange:function(e){s(e)},activeObj:o,options:V,flavor:(t||{}).mapAnalyze||null,onFlavorChange:function(e){return n({key:"mapAnalyze",value:e})}})),data:r,defTitle:"各省NPS值对比",loading:a},E().createElement("div",{className:"chart"},E().createElement(h.Z,{theme:"yunting_pos_neu_neg",option:{},style:{width:"100%",height:"100%"},onChartReady:function(e){return l(e)}})),E().createElement("div",{className:"table"},E().createElement(T.Z,{columns:[{label:"省份",prop:"province"},{label:"NPS分值",prop:"npsValue",render:function(e){return E().createElement("div",null,null===e.npsValue?"无":+(100*e.npsValue).toFixed(0))}},{label:"答题数量",prop:"questionnaireTotal"}],data:r,currentPage:1,total:34})))};var O=a(54898);const _=function(e){var t=e.custTimeType,a=e.custDataType,n=e.fetchingNpsCustomerData,l=e.npsCustomerData,r=e.graphicData,i=e.onFilterChange,o=e.fetchingNpsConcerns,s=e.doubleBarChartData,u=e.graphPieChartData,p=(e.fBarCompareType,e.wordChartData),c=e.npsAnalyzeData,d=e.mapData,m=e.dateOptions,f=e.defaultDateType,h=e.flavorObj,y=e.setDefaultValue,v=e.fetchNpsData,g=e.relativeData,x=e.relativeRefreshTime,N=e.relativeDataLoading,e=e.handleOnRefresh;return E().createElement("div",{className:"yt_research_nps_analysis_wrapper"},E().createElement(C,{data:c,dateOptions:m,defaultDateType:f,setDefaultValue:y,flavorObj:h,fetchNpsData:v}),E().createElement(D.Z,{loading:n,title:"NPS客户分类",titleOverlay:E().createElement("div",null,E().createElement("div",null,"推荐者(Promoter)：NPS分值为9分~10分的客户，他们具有狂热忠诚度，铁杆粉丝，反复光顾，向朋友推荐"),E().createElement("div",null,"被动者(Passive)：NPS分值为7分~8分的客户，他们总体满意但不忠诚，容易转向竞争对手"),E().createElement("div",null,"贬损者(Detractors)：NPS分值为0分~6分的客户，他们使用不满意不忠诚，不断抱怨或投诉")),type:"NPS",dateOptions:m,customerData:l,graphicData:r,dataType:a,timeType:t,defaultDataType:h&&h.fCustDataType,defaultDateType:f,setDefaultValue:y,flavorObj:h&&h,onFilterChange:i}),E().createElement(w,{data:d,setDefaultValue:y,flavorObj:h}),E().createElement(S.Z,{title:"推荐者和贬损者关注点对比",positiveTitle:"推荐者提及数量最多的词",negativeTitle:"贬损者提及最多的词",defaultDataType:h&&h.fBarCompareType,setDefaultValue:y,doubleBarChartData:s,graphPieChartData:u,loading:o}),E().createElement(b.Z,{loading:o,data:p,title:"词频分析"}),E().createElement(O.Z,{title:"词组关联关系分析",data:g,loading:N,refreshTime:x,onRefresh:e}))};var F=n.Z.research.analyze.nps,n=function(t){function e(e){var a=t.call(this,e)||this;return a._handleOnWsMessage=function(e){var t=e.data;t.type&&"ws"===t.type&&(t=(e=t.payload).type,e=e.result,"QUESTIONNAIRE_TEXT_RESULT"===t&&"NPS_REASON"===e.textType&&a.props.save({relativeData:e.data.length?e.data:"empty",relativeRefreshTime:e.createdAt,relativeDataLoading:!1}))},a._handleOnFilterChange=function(e){e.dateGroupType&&a.props.fetchNpsCustomerData({dateGroupType:e.dateGroupType})},a._handleOnRefresh=function(){a.props.createWordRelativeData({})},a.state={},a.event={onFilterChange:a._handleOnFilterChange,handleOnRefresh:a._handleOnRefresh},a}i()(e,t);var a=e.prototype;return a.active=function(e){var t=e.filterArgs,a=(e.title,e.questionnaireId),n=e.questionnaireBoardId,e=t[0],t=(t[1],t[2]);this.props.fetchDatas({filterModel:e.filterValue,dateFilter:e.dateFilter,dateOptions:t.dateOptions,defaultDateType:t.defaultDateType,projectId:o.t.get(o.V.curProject).id,questionnaireId:a,questionnaireBoardId:n,pageType:"research_nps"})},a.componentDidMount=function(){window.addEventListener("message",this._handleOnWsMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage),this.props.clear()},a.render=function(){return E().createElement(_,r()({},this.props,this.state,this.event))},e}(E().PureComponent);const B=(0,t.connect)(function(e){var t=e.loading,e=l()(e,["loading"]);return r()({},e[F],{fetchNpsData:t.effects[F+"/fetchNpsData"]||!1,fetchingNpsCustomerData:t.effects[F+"/fetchNpsCustomerData"]||!1,fetchingNpsConcerns:t.effects[F+"/fetchNpsConcerns"]||!1})},function(t){return{save:function(e){return t({type:F+"/save",payload:e})},fetchDatas:function(e){return t({type:F+"/fetchDatas",payload:e})},fetchNpsCustomerData:function(e){return t({type:F+"/fetchNpsCustomerData",payload:e})},fetchNpsData:function(e){return t({type:F+"/fetchNpsData",payload:e})},setDefaultValue:function(e){return t({type:F+"/setDefaultValue",payload:e})},createWordRelativeData:function(e){return t({type:F+"/createWordRelativeData",payload:e})},clear:function(e){return t({type:F+"/clear",payload:e})}}},null,{withRef:!0})(n)}}]);