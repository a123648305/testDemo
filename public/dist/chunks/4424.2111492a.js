(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[4424],{31353:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var n=a(37316),r=a.n(n),i=a(67154),l=a.n(i),t=a(85354),o=a.n(t),n=a(67294),_=a.n(n),i=a(55609),I=a(48577),k=a(67133),O=a(19731),N=a(89604),c=(a(43378),a(62443)),s=a(70715),d=a(39432),f=a(87300),t=function(n){function e(){for(var i,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(i=n.call.apply(n,[this].concat(t))||this).chartRef=void 0,i.source=void 0,i.dimensions=void 0,i.getChartRef=function(e){return i.chartRef=e},i.setValue=function(e){i.dimensions=["性别","标签数量","年龄段","标签数量"];try{var t=["性别","标签数量"],a=e.gender.reduce(function(e,t){return e.push([t.name,t.count]),e},[t]),n=["年龄段","标签数量"],r=e.age.reduce(function(e,t){return e.push([t.name,t.count]),e},[n]);i.dataset=[{dimensions:t,source:a},{dimensions:n,source:r}]}catch(e){}},i.getOption=function(e,o,t,a,n,c){return{title:{text:o},dataset:i.dataset.map(function(e){return l()({},e,{sourceHeader:!1})}),graphic:[{type:"text",top:52,left:20,style:{text:"性别分布",font:"14px "+s.I8,fill:"#262626"},cursor:"default"},{type:"text",top:52,left:"50%",style:{text:"年龄段分布",font:"14px "+s.I8,fill:"#262626"},cursor:"default"}],tooltip:{trigger:"item",showDelay:20,hideDelay:55,confine:!0,enterable:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n        box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",position:function(e,t,a,n,r){var i=r.contentSize,l=r.viewSize,o=e[0]<l[0]/2?0:-1,r=e[1]<l[1]/2?-.5:-1,l=e[0]<l[0]/2?20:-20;return[e[0]+o*i[0]+l,e[1]+r*i[1]]},formatter:function(e,t,a){var n=e.marker,r=e.name,i=e.value,l=e.percent;return setTimeout(function(){a(t,(0,f.r)(r+"</span>",["<div style='display: flex;justify-content: space-between;align-items: center;color: #8c8c8c;'><div><span style='vertical-align: bottom'>"+n+"</span>标签数量</div><div style='color: #262626;margin-left: 12px;'>"+(0,d.hE)(i)+"（"+l.toFixed(2)+"%）</div></div>"],[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return c(e,o)}}],"yt_new_tooltip_wrapper"))},0)}},series:[{name:"性别分布",type:"pie",smooth:!0,datasetIndex:0,hoverOffset:0,minAngle:30,center:["25%","55%"],radius:["45%","135"],label:{show:t,position:"outside",color:"#262626",formatter:function(e){var t=e.name,a=e.value,e=e.percent;return[""+t,"{value|"+(0,d.hE)(a)+"（"+e.toFixed(2)+"%）}"].join("\n")},rich:{value:{fontSize:12,lineHeight:18,color:"#262626",align:"left"}}},labelLine:{show:t,smooth:!0,length:13},data:i.dataset[0].source.slice(1).map(function(e,t){return{value:e[1],name:e[0],itemStyle:{color:-1===a||a===t?s.OW[t]:"#bfbfbf"}}})},{name:"年龄段分布",type:"pie",smooth:!0,datasetIndex:1,hoverOffset:0,minAngle:30,center:["75%","55%"],radius:["45%","135"],label:{show:t,position:"outside",color:"#262626",formatter:function(e){var t=e.name,a=e.value,e=e.percent;return[""+t,"{value|"+(0,d.hE)(a)+"（"+e.toFixed(2)+"%）}"].join("\n")},rich:{value:{fontSize:12,lineHeight:18,color:"#262626",align:"left"}}},labelLine:{show:t,smooth:!0,length:13,length2:13},data:i.dataset[1].source.slice(1).map(function(e,t){return{value:e[1],name:e[0],itemStyle:{color:-1===n||n===t?s.OW[t]:"#bfbfbf"}}})}]}},i}return o()(e,n),e.prototype.renderChart=function(e,t,a,n,r,i){this.setValue(e),this.chartRef.clear(),this.chartRef.setOption(this.getOption(e,t,a,n,r,i))},e}(_().PureComponent),n=a(45697),n=a.n(n),u=a(8201),p=a(98191),h=a(50976),m=a(94644),y=a(81408),t=function(i){function e(e){var f=i.call(this,e)||this;return f.resizeListener=function(){var e=document.querySelector(".yt_explore_scene_relation_pie_chart");e&&f.setState({width:e.offsetWidth})},f._handleOnJumpMsg=function(e,t){var a=f.props,n=a.projectId,r=a.dateFilter,i=a.headerFilterParamsNew,l=a.filterValues,o=e.name,c=e.seriesName,s=f.state,a=s.clickedAgeIndex,e=s.clickedGenderIndex,s=s.filter,i=-1<a||-1<e?s.headerFilterParamsNew:i,l=-1<a||-1<e?s.filterValues:l,n={filterValues:(0,y.gt)(l,c,o,!0),projectId:n,dateFilter:r,headerFilterParamsNew:(0,y.gt)(i,c,o),filterModel:{project:[n],messageCategory:["COMMENT"]},filterTip:null};window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(n)))},f.onChartClick=function(e){var t,a,n=e.componentType,r=e.name,i=e.seriesName,l=e.dataIndex,o=f.state,c=o.clickedGenderIndex,s=o.clickedAgeIndex,e=f.props,o=e.headerFilterParamsNew,d=e.fetchPieData,e=e.filterValues;"series"===n&&("性别分布"===i?(t={headerFilterParamsNew:l===c?o:(0,y.gt)(o,i,r),findKey:l===c?null:"gender",filterValues:l===c?e:(0,y.gt)(e,i,r)},f.setState({clickedGenderIndex:l===c?-1:l,filter:t},function(){d(t)}),-1<s&&f.setState({clickedAgeIndex:-1})):"年龄段分布"===i&&(a={headerFilterParamsNew:l===s?o:(0,y.gt)(o,i,r),findKey:l===s?null:"age",filterValues:l===s?e:(0,y.gt)(e,i,r)},f.setState({clickedAgeIndex:l===s?-1:l,filter:a},function(){d(a)}),-1<c&&f.setState({clickedGenderIndex:-1})))},f.onExportImage=function(){f.chartRef&&(0,m._v)(f.chartRef,f.props.title)},f.onExportExcel=function(){var e=f.props,t=e.title,e=e.data;(0,u.P)(e)&&(e=[].concat(f.dataset[0].source,[[""]],f.dataset[1].source),(0,m.aT)([e],t))},f.state={showLabel:!0,clickedGenderIndex:-1,clickedAgeIndex:-1,filter:void 0,width:0},f}o()(e,i);var t=e.prototype;return t.componentDidMount=function(){var n=this;this.renderChart(),this.internalId=setInterval(function(){var e,t,a;n.chartRef&&(clearInterval(n.internalId),n.renderChart(),t=(e=n.chartRef._dom.children)[0],a=e[1],t.addEventListener("mouseleave",function(e){n.chartLeaveTimeout=setTimeout(function(){n.chartLeaveTimeout&&(a.style.display="none")},2e3)}),a&&a.addEventListener("mouseenter",function(e){n.chartLeaveTimeout=void 0}))},200),window.addEventListener("resize",this.resizeListener)},t.componentDidUpdate=function(e,t){var a=e.data,n=this.props.data,r=t.showLabel,i=t.clickedGenderIndex,l=t.clickedAgeIndex,o=this.state,e=o.showLabel,t=o.clickedGenderIndex,o=o.clickedAgeIndex;JSON.stringify(a)!==JSON.stringify(n)&&(0,u.P)(n)&&(this.renderChart(),(a=document.querySelector(".yt_explore_scene_relation_pie_chart"))&&this.setState({width:a.offsetWidth})),r===e&&i===t&&l===o||this.renderChart(),!(0,u.P)(n)&&this.chartRef&&(this.chartRef=void 0)},t.componentWillUnmount=function(){window.removeEventListener("resize",this.resizeListener)},t.renderChart=function(){var e=this.props,t=e.title,a=e.data,n=this.state,r=n.showLabel,e=n.clickedGenderIndex,n=n.clickedAgeIndex;(0,u.P)(a)&&this.chartRef&&i.prototype.renderChart.call(this,a,t,r,e,n,this._handleOnJumpMsg)},t.render=function(){var e=this,t=this.props,a=t.data,n=t.loading,r=t.title,t=this.state,i=t.showLabel,t=t.width;return _().createElement(u.Z,{className:"yt_explore_scene_relation_pie_chart",data:a,loading:n,renderTitle:_().createElement(p.Z,{title:r,data:a},_().createElement(c.default,{placement:"top",content:"显示图表标签",mouseEnterDelay:.6},_().createElement("i",{className:"icon-tubiaobiaoqian "+(i?"active":""),onClick:function(){e.setState({showLabel:!i})}})),_().createElement(c.default,{placement:"top",content:"导出数据",mouseEnterDelay:.6},_().createElement("i",{className:"icon-daochu",onClick:this.onExportExcel})),_().createElement(c.default,{placement:"top",content:"导出图片",mouseEnterDelay:.6},_().createElement("i",{className:"icon-xiazaitupian",onClick:this.onExportImage})))},(0,u.P)(a)&&this.chartRef&&_().createElement("span",{style:{position:"absolute",top:48,left:84,transition:"all 0.3s",zIndex:1,color:"#8c8c8c"}},_().createElement(c.default,{placement:"top",mouseEnterDelay:.3,content:_().createElement("div",{style:{maxWidth:362,fontSize:12}},"「性别」即消息中提到使用者性别相关的信息。例如「我买给女朋友的」，使用人是「女朋友」，性别为「女」。")},_().createElement("i",{className:"icon-cem_file1"}))),(0,u.P)(a)&&this.chartRef&&_().createElement("span",{style:{position:"absolute",top:48,left:.5*t+70+8,transition:"all 0.3s",zIndex:1,color:"#8c8c8c"}},_().createElement(c.default,{placement:"top",mouseEnterDelay:.3,content:_().createElement("div",{style:{maxWidth:362,fontSize:12}},"「年龄段」即消息中提到使用者年龄段相关的信息。例如「我买给女朋友的」，使用人是「女朋友」，年龄段为「中青年」。")},_().createElement("i",{className:"icon-cem_file1"}))),_().createElement(h.Z,{onChartReady:this.getChartRef,theme:"yt_multi_color_10",option:{},style:{width:"100%",height:"100%"},onEvents:{click:this.onChartClick}}))},e}(t);t.propTypes={title:n().string,loading:n().bool,data:n().array};const L=t;const g=function(e){var t=e.pageType,a=e.dateOptions,n=e.trendData,r=e.timeType,i=e.fTimeType,l=e.fetchingTrendData,o=e.pieData,c=e.fetchingPieData,s=e.fetchPieData,d=e.barData,f=e.fetchingBarData,u=e.analyzeLineData,p=e.analyzeBarData,h=e.fetchingAnalyzeLineData,m=e.fetchingAnalyzeBarData,y=e.alzName,g=e.alzOptions,v=e.alzTimeType,D=e.alzFTimeType,x=e.projectId,C=e.dateFilter,T=e.filterValues,E=e.headerFilterParamsNew,z=e.filterReady,b=e.filterChange,w=e.onFilterChange,F=e.onFlavorChange,e=e.onMsgClick;return _().createElement("div",{className:"yt_explore_scene_relation_wrapper"},_().createElement(I.Z,{onReady:z,onChange:b,pageType:t,advanceAuthority:!1,touchData:["电商评论"],selectValue:"电商评论",valueConf:["fullInfo"],showList:["fullDate","screening","save","sourceSearch"],hasHour:!0},_().createElement("div",{className:"content"},_().createElement(O.Z,{title:"标签数量",data:n,loading:l,timeType:r,fTimeType:i,timeOptions:a,onFilterChange:w,onFlavorChange:F,onMsgClick:e,titleOverlay:_().createElement("div",null,_().createElement("p",null,"场景标签提及率 = 提及了场景标签去重后的消息数量 ÷ 消息总量"),_().createElement("p",null,"标签数量计算说明：如果一条消息中出现一个场景标签就计1，同一个场景标签在一个消息中不重复计数。"))}),_().createElement(L,{data:o,projectId:x,dateFilter:C,headerFilterParamsNew:E,loading:c,fetchPieData:s,title:"使用人性别和年龄段分布",onMsgClick:e,filterValues:T}),_().createElement(k.Z,{title:"使用人的角色与关系",tips:"「角色与关系」即站在购买人的角度描述使用人的角色与使用者的关系。例如「我买给女朋友的」，使用人的角色与关系是「女朋友」。",data:d,loading:f,onMsgClick:e}),_().createElement(N.Z,{analyzeLineData:u,analyzeBarData:p,fetchingAnalyzeLineData:h,fetchingAnalyzeBarData:m,timeOptions:a,alzTimeType:v,alzFTimeType:D,alzOptions:g,alzName:y,onFilterChange:w,onFlavorChange:F,onMsgClick:e}))))};var v=a(35239),D=a(97194),x=a(2786),C=a(64396).Z.explore.scene.relation,a=function(t){function e(e){var p=t.call(this,e)||this;return p._handleFilterReady=function(e,t){var a=(0,D.X)(e.dateFilter.numOfDays,!0),n=a.dateOptions,a=a.defaultDateType;p.props.fetchParams({projectId:v.t.get(v.V.curProject).id,headerFilterParamsNew:e.headerFilterParamsNew,dateFilter:e.dateFilter,dateOptions:n,defaultDateType:a,filterValues:t.fullInfo.filterValue})},p._handleFilterChange=function(e,t,a){var n=(0,D.X)(e.dateFilter.numOfDays,!0),r=n.dateOptions,n=n.defaultDateType;p.props.fetchDatas(l()({},e,{dateOptions:r,defaultDateType:n,timeType:n,alzTimeType:n,filterValues:t.fullInfo.filterValue}))},p._handleOnFilterChange=function(e){var t=p.props,a=t.oLineData,n=t.oBarData,t=t.alzOptions;e.timeType&&p.props.fetchTrendData(e),e.alzName&&(t=(0,y.dR)(l()({oLineData:a,oBarData:n,alzOptions:t},e)),p.props.save(l()({},e,t))),e.alzTimeType&&p.props.fetchAnalyzeLineData(e)},p._handleOnFlavorChange=function(e){e.fTimeType||e.alzFTimeType,p.props.setDefaultValue(e)},p._handleOnMsgClick=function(e,t){var a=p.props,n=a.projectId,r=a.dateFilter,i=a.headerFilterParamsNew,l=a.filterValues,o=a.oLineData,c=a.alzTimeType,s=a.alzName,d=a.alzOptions,f={id:y.$x[y.$5[d.find(function(e){return e.name===s}).idKey]],label:y.$5[d.find(function(e){return e.name===s}).idKey],values:[s]},u=e.name,a=e.componentSubType,e=e.data,l={projectId:n,dateFilter:(0,x.X_)(a,r,u,o[0].data.map(function(e){return e.name}),c),headerFilterParamsNew:"bar"===a&&"使用人的角色与关系"===t?(0,y.gt)(i,"关系",u):"line"===a?(0,y.gt)(i,y.$5[d.find(function(e){return e.name===s}).idKey],s):"bar"===a&&"共同提及的其他场景标签"===t?(0,y.gt)(i,e[0],u.split(":")[1],"",f):i,filterModel:{project:[n],messageCategory:["COMMENT"]},filterTip:null,filterValues:"bar"===a&&"使用人的角色与关系"===t?(0,y.gt)(l,"关系",u,!0):"line"===a?(0,y.gt)(l,y.$5[d.find(function(e){return e.name===s}).idKey],s,!0):"bar"===a&&"共同提及的其他场景标签"===t?(0,y.gt)(l,e[0],u.split(":")[1],!0,f):l};window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(l)))},p.event={filterReady:p._handleFilterReady,filterChange:p._handleFilterChange,onFilterChange:p._handleOnFilterChange,onFlavorChange:p._handleOnFlavorChange,onMsgClick:p._handleOnMsgClick},p}o()(e,t);var a=e.prototype;return a.componentWillUnmount=function(){this.props.clean()},a.render=function(){return _().createElement(g,l()({},this.props,this.state,this.event))},e}(_().Component);const T=(0,i.connect)(function(e){var t=e.loading,e=r()(e,["loading"]);return l()({},e[C],{fetchingTrendData:t.effects[C+"/fetchTrendData"]||!1,fetchingPieData:t.effects[C+"/fetchPieData"]||!1,fetchingBarData:t.effects[C+"/fetchBarData"]||!1,fetchingAnalyzeLineData:t.effects[C+"/fetchAnalyzeLineData"]||!1,fetchingAnalyzeBarData:t.effects[C+"/fetchAnalyzeBarData"]||!1})},function(t){return{save:function(e){return t({type:C+"/save",payload:e})},clean:function(e){return t({type:C+"/clean",payload:e})},setDefaultValue:function(e){return t({type:C+"/setDefaultValue",payload:e})},fetchParams:function(e){return t({type:C+"/fetchParams",payload:e})},fetchDatas:function(e){return t({type:C+"/fetchDatas",payload:e})},fetchTrendData:function(e){return t({type:C+"/fetchTrendData",payload:e})},fetchPieData:function(e){return t({type:C+"/fetchPieData",payload:e})},fetchBarData:function(e){return t({type:C+"/fetchBarData",payload:e})},fetchAnalyzeLineData:function(e){return t({type:C+"/fetchAnalyzeLineData",payload:e})},fetchAnalyzeBarData:function(e){return t({type:C+"/fetchAnalyzeBarData",payload:e})}}})(a)}}]);