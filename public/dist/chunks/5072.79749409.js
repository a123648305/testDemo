(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5072],{75072:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var t=n(37316),a=n.n(t),t=n(67154),o=n.n(t),t=n(85354),r=n.n(t),t=n(67294),u=n.n(t),i=n(55815),l=n(35239),d=n(2271),p=n(61918),h=n(8201);function c(e){switch(e){case"NOT_PROVIDED":return u().createElement("span",{style:{color:"#8c8c8c"}},"--");case"APPLICABLE":return u().createElement("i",{style:{color:"#262626"},className:"icon-cem_right1"});case"NOT_APPLICABLE":return u().createElement("i",{style:{color:"#262626"},className:"icon-cem_ban"});default:return e+"%"}}const s=function(t){function e(e){var r=t.call(this,e)||this;return r._handleOnPageChange=function(e){var t=r.state,n=t.dataList,a=t.filteredDataList,t=t.pageSize;r.setState({pageIndex:e,clusterDataList:(a||n).slice((e-1)*t,e*t)})},r._handleOnPageSizeChange=function(e){var t=r.state,n=t.dataList,t=t.filteredDataList;r.setState({pageSize:e,pageIndex:1,clusterDataList:(t||n).slice(0,e)})},r._handleOnSearch=function(e){var t=r.state,n=t.dataList,a=t.pageSize,t=e?function(e,t){for(var n=new RegExp(t.toLocaleLowerCase()),a=[],r=0;r<e.length;r++)(n.test(e[r].detail.toLocaleLowerCase())||n.test(e[r].ytName.toLocaleLowerCase()))&&a.push(e[r]);return a}(n,e):void 0;r.setState({keyword:e,pageIndex:1,filteredDataList:t,clusterDataList:(t||n).slice(0,a)})},r.state={dataList:[],oriData:e.data,columns:[],prefixColumns:[{label:"",width:16,fixed:"left"}],columnRenders:{},pageIndex:1,pageSize:10,keyword:"",clusterDataList:[],filteredDataList:void 0},r}return r()(e,t),e.getDerivedStateFromProps=function(e,t){if((0,h.P)(e.data)&&JSON.stringify(t.oriData)!==JSON.stringify(e.data)){var a=!0,r=[{label:"指标",prop:"ytName",width:80,fixed:"",checked:!0},{label:"指标描述",prop:"detail",width:200,fixed:"",checked:!0},{label:"整体指标准确性",prop:"overallRate",width:80,fixed:"",checked:!0}],i={overallRate:function(e){return c(e.overallRate)}},n=e.data.map(function(e,n){return a&="NOT_PROVIDED"===e.overallRate,o()({id:e.id,nlpName:e.nlpName,ytName:e.ytName,detail:e.detail,overallRate:e.overallRate},e.categoryRates.reduce(function(e,t){return e[t.category]=t.rate,0===n&&(r.push({label:t.categoryName,prop:t.category,width:80,fixed:"",checked:!0}),i[t.category]=function(e){return c(e[t.category])}),e},{}))});return a&&r.splice(2,1),{oriData:e.data,dataList:n,columns:r,columnRenders:i,clusterDataList:n.slice((t.pageIndex-1)*t.pageSize,t.pageIndex*t.pageSize)}}return null},e.prototype.render=function(){var e=this.state,t=e.dataList,n=e.columns,a=e.columnRenders,r=e.prefixColumns,i=e.pageIndex,o=e.pageSize,l=e.clusterDataList,c=e.filteredDataList,s=this.props,e=s.loading,s=s.data,s=s instanceof Array?l:s,t=c||t;return u().createElement("div",{className:"yt_aspect_content_list_wrapper"},u().createElement("div",{className:"title_header"},u().createElement(p.Z,{placeholder:"搜索指标或描述",onSearch:this._handleOnSearch,onClear:this._handleOnSearch})),u().createElement(d.Z,{data:s,loading:e,rowKeyProp:"id",prefixColumns:r,columnRenders:a,columns:n,total:(0,h.P)(s)?t.length:0,onPageChange:this._handleOnPageChange,onPageSizeChange:this._handleOnPageSizeChange,pageIndex:i,pageSize:o,savedKey:"ASPECT_GLOBAL_LIST"}))},e}(u().PureComponent);var m=n(61409);const f=function(e){var t=e.aspectList,e=e.loading;return u().createElement("div",{className:"yt_project_aspect_system_wrapper"},u().createElement(i.Z,{title:[{title:"所有项目",url:"/account/project"},{title:l.t.get(l.V.backProjectConfig).name,url:"/account/project/preview"},{url:"",title:"全局指标"}],overlay:u().createElement(m.rU,{className:"yt-feedback-read-more",to:"https://www.yuque.com/docs/share/e029a655-b744-47bf-a287-20817c1ac654?# 《全局指标体系说明》",target:"_blank"},"了解更多")}),u().createElement("div",{className:"content"},u().createElement(s,{data:t,loading:e})))};var t=n(55609),g=n(64396).Z.productExperience.aspectSystem.global,n=function(t){function e(e){e=t.call(this,e)||this;return e.event={},e}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.props.fetchAspectData({projectId:l.t.get(l.V.backProjectConfig).id})},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return u().createElement(f,o()({},this.props,this.state,this.event))},e}(u().Component);const v=(0,t.connect)(function(e){var t=e.loading,e=a()(e,["loading"]);return o()({},e[g],{loading:t.effects[g+"/fetchAspectData"]||!1})},function(t){return{save:function(e){return t({type:g+"/save",payload:e})},clean:function(e){return t({type:g+"/clean",payload:e})},fetchAspectData:function(e){return t({type:g+"/fetchAspectData",payload:e})}}})(n)},61918:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),u=n.n(t),t=n(45697),n=n.n(t),t=function(e){var t=e.className,n=e.onClear,a=e.onSearch,r=e.placeholder,i=e.style,o=e.defValue,l=e.signal,e=u().useState(o),c=e[0],s=e[1];u().useEffect(function(){s(o)},[o,l]);return u().createElement("div",{style:i,className:"yt_search_input_wrapper "+(t||"")},u().createElement("input",{placeholder:r,value:c,onKeyDown:function(e){13===e.keyCode&&a(c)},onChange:function(e){return s(e.target.value)},autoComplete:"off"}),c&&u().createElement("i",{className:"icon-cem_log-off",onClick:function(){s(""),n&&n("")}}),u().createElement("i",{className:"icon-cem_small-search",onClick:function(){return a(c)}}))};t.propTypes={className:n().string,onSearch:n().func.isRequired,placeholder:n().string,style:n().object,defValue:n().string,signal:n().any,onClear:n().func};const a=t},2271:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var a=n(37316),p=n.n(a),t=n(67154),h=n.n(t),a=n(93913),r=n.n(a),t=n(85354),i=n.n(t),a=n(23279),o=n.n(a),t=n(67294),m=n.n(t),f=n(92360),s=n(35303),a=n(45697),t=n.n(a),u=[{label:"10项/页",value:10},{label:"20项/页",value:20},{label:"40项/页",value:40},{label:"100项/页",value:100}];const g=function(e){var t=e.onPageChange,n=e.onSizeChange,a=e.total,r=void 0===a?0:a,i=e.pageIndex,o=e.pageSize,l=e.currLength,c=e.layout,a=e.className,e=0===r?0:(i-1)*o+1,l=0===r?0:e+l-1;return 0===r?null:m().createElement("div",{className:"yt-awp-pagination "+(a||"")},m().createElement("span",{className:"total_num"},m().createElement("span",null,e+" - "+l+" "),"项，共",m().createElement("span",null," "+r+" "),"项"),m().createElement("div",{style:{textAlign:"right",float:"right"},className:"new_pagination"},m().createElement(f.Pagination,{small:!0,pageSize:o,currentPage:i,pageCount:Math.ceil(r/o),layout:0===r?"":"prev, pager, next",onCurrentChange:t}),void 0===c||c.includes("sizes")?m().createElement(s.RS,{multiple:!1,tags:!1,showSearch:!1,optionFilterProp:"label",optionLabelProp:"label",animation:"slide-up",dropdownClassName:"custom-pagination-dropdown",value:o||10,onChange:n},u.map(function(e,t){return m().createElement(s.Wx,{key:t,label:e.label,value:e.value},e.label)})):null))};t().propTypes={onPageChange:t().func,onSizeChange:t().func,total:t().number,pageIndex:t().number,pageSize:t().number,currLength:t().number,layout:t().string,className:t().string};var v=n(8201),a=n(48926),l=n.n(a),a=n(87757),c=n.n(a),d=n(36144);function y(){return(y=l()(c().mark(function e(t){var n,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectId,a=t.key,e.abrupt("return",d.h.post("/default/value/find",{projectId:n,key:a}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _(){return(_=l()(c().mark(function e(t){var n,a,r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectId,a=t.value,r=t.key,e.abrupt("return",d.h.post("/default/value/update",{projectId:n,key:r,value:a}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}var C=n(39432),b=n(43036),E=n(51474),w=n(87219),a=function(t){function e(e){var s=t.call(this,e)||this;return s._setShowFalse=function(){s.setState({show:!1})},s._handleParentClick=function(e){s.state.show&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},s._handleOnTriggerClick=function(){setTimeout(function(){s.setState({show:!s.state.show})},0)},s._renderOptionItem=function(t,e,n,a,r,i){var o=s.state.maxLabelWidth,l=s.props,c=l.value,l=l.savedKey,c=c.find(function(e){return e.prop===t.prop});return m().createElement("div",{className:"opt_item "+(e?"draggable":""),key:t.prop},e&&m().createElement("i",{className:"icon-cem_move my_handle"}),m().createElement("div",{className:"opt_content",style:{width:o,marginLeft:e?0:12}},m().createElement("div",{className:"item_label",onClick:function(e){e.stopPropagation(),s._handleOnItemClick(t.prop)}},m().createElement("span",{className:"icon_checkbox "+(c&&c.checked?"checkbox_checked":"")}),m().createElement("span",null,t.label)),m().createElement("div",{className:"item_control",style:{display:"product_setting_link"===l?"none":"block"}},m().createElement(b.Z,{placement:"top",overlay:n},m().createElement("span",{onClick:function(e){return a(e,t.prop)}},m().createElement("i",{className:(e?"icon-cem_up":"icon-cem_up-and-down")+" fun_icon_a"}))),m().createElement(b.Z,{placement:"top",overlay:r},m().createElement("span",{onClick:function(e){return i(e,t.prop)},style:{marginLeft:4}},m().createElement("i",{className:"icon-cem_down fun_icon_b"}))))))},s._handleOnItemClick=function(t){var e=s.props,n=e.value,e=e.onChange;e&&e((0,w.ZP)(n,function(e){e=e.find(function(e){return e.prop===t});e&&(e.checked=!e.checked)}))},s._handleOnFilxedLeftClick=function(e,t){e.stopPropagation(),s._handleOnFixedChange(t,"left")},s._handleOnCancelFixedClick=function(e,t){e.stopPropagation(),s._handleOnFixedChange(t,"")},s._handleOnFixedRightClick=function(e,t){e.stopPropagation(),s._handleOnFixedChange(t,"right")},s._handleOnFixedChange=function(t,n){var e=s.props,a=e.value,e=e.onChange;e&&e((0,w.ZP)(a,function(e){e=e.find(function(e){return e.prop===t});e&&(e.fixed=n)}))},s.state={show:!1,value:[],leftOpts:[],normalOpts:[],rightOpts:[],maxLabelWidth:e.value.reduce(function(e,t){return Math.max((0,C.jD)(t.label,14)+56+16+16,e)},0)},s}i()(e,t),e.getDerivedStateFromProps=function(a,e){if(JSON.stringify(a.value)===JSON.stringify(e.value))return null;var t=a.value.reduce(function(e,t){var n=1;return"left"===t.fixed&&(n=0),e[n="right"===t.fixed?2:n].push(a.value.find(function(e){return e.prop===t.prop})),e},[[],[],[]]),n=t[0],e=t[1],t=t[2];return{value:a.value,leftOpts:n,normalOpts:e,rightOpts:t,maxLabelWidth:a.value.reduce(function(e,t){return Math.max((0,C.jD)(t.label,14)+56+16+16,e)},0)}};var n=e.prototype;return n.componentDidMount=function(){var o=this;window.addEventListener("click",this._setShowFalse);var e=document.querySelectorAll("#draggable_zone");e.length&&e.forEach(function(e){E.ZP.create(e,{group:"draggable_zone",animation:150,filter:".undraggable",draggable:".draggable",handle:".my_handle",onEnd:function(e){var t=o.props,n=t.value,a=t.onChange,r=e.newIndex,i=e.oldIndex;r!==i&&(t=n.filter(function(e){return"left"===e.fixed}),e=n.filter(function(e){return"right"===e.fixed}),n=(0,w.ZP)(n.filter(function(e){return!e.fixed}),function(e){var t=e.splice(i,1)[0];e.splice(r,0,t)}),a&&a([].concat(t,n,e)))}})})},n.componentWillUnmount=function(){window.removeEventListener("click",this._setShowFalse)},n.render=function(){var t=this,e=this.state,n=e.show,a=e.leftOpts,r=e.normalOpts,i=e.rightOpts,o=this.props,e=o.className,o=o.title;return m().createElement("div",{className:"yt_columns_selector_wrapper "+(e||""),onClick:this._handleParentClick},m().createElement("div",{className:"trigger "+(n?"sel":""),onClick:this._handleOnTriggerClick},o||"列",m().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:n?"rotate(-180deg)":""}})),m().createElement("div",{className:"options "+(n?"active":"")},0<a.length&&m().createElement(m().Fragment,null,m().createElement("div",{className:"opt_label"},"固定在左侧"),a.map(function(e){return t._renderOptionItem(e,!1,"不固定",t._handleOnCancelFixedClick,"固定在列尾",t._handleOnFixedRightClick)})),(0<a.length||0<i.length)&&m().createElement("div",{className:"opt_label"},"不固定"),m().createElement("div",{id:"draggable_zone",style:{visibility:0<r.length}},r.map(function(e){return t._renderOptionItem(e,!0,"固定在列头",t._handleOnFilxedLeftClick,"固定在列尾",t._handleOnFixedRightClick)})),0<i.length&&m().createElement(m().Fragment,null,m().createElement("div",{className:"opt_label"},"固定在右侧"),i.map(function(e){return t._renderOptionItem(e,!1,"不固定",t._handleOnCancelFixedClick,"固定在列头",t._handleOnFilxedLeftClick)}))))},e}(m().PureComponent);const x=a;a.propTypes={className:t().string,title:t().string,value:t().arrayOf(t().shape({label:t().string,prop:t().string,fixed:t().string,checked:t().bool})),onChange:t().func};var S=n(35239),a=function(t){function e(e){var n=t.call(this,e)||this;return n._handleOnResize=function(){var e=document.querySelector(".yt-listview-wrapper");e&&n.setState({tableWidth:e.clientWidth-5})},n._handleOnColumnsChange=function(e){n.setState({columns:e},function(){n.props.savedKey&&!function(){return _.apply(this,arguments)}({projectId:S.t.get(S.V.curProject).id,key:n.props.savedKey,value:JSON.stringify(e.map(function(e){return{prop:e.prop,checked:e.checked,fixed:e.fixed}}))}).then(function(e){e.data})})},n.handleRoKey=function(e){var t=n.props.rowKeyProp;return t&&e&&e[t]?e[t]:JSON.stringify(e)},n.state={talbeWidth:0,columns:e.columns||[],loadingSave:!0},n}i()(e,t),e.getDerivedStateFromProps=function(e,t){};var n=e.prototype;return n.componentDidMount=function(){var n=this;window.addEventListener("resize",o()(this._handleOnResize,150)),this._handleOnResize();var e=this.props,t=e.savedKey,r=e.columns;t&&!function(){return y.apply(this,arguments)}({projectId:S.t.get(S.V.curProject).id,key:t}).then(function(e){var t,a=e.data;if(2e4===a.code)try{t=r.map(function(t,e){var n=JSON.parse(a.result).filter(function(e){e=e.prop;return t.prop===e});return n&&0<n.length?h()({},t,n[0]):t}).filter(function(e){return e})}catch(e){}finally{n.setState({columns:t||n.state.columns,loadingSave:!1})}})},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleOnResize)},n.componentDidUpdate=function(e,t){var r=this;JSON.stringify(e.columns)!==JSON.stringify(this.props.columns)&&0<this.props.columns.length&&this.setState({columns:this.props.columns.reduce(function(e,t,n){var a=r.state.columns.findIndex(function(e){e=e.prop;return t.prop===e});return e.splice(-1<a?a:n,0,h()({},t,r.state.columns[a])),e},[]).filter(function(e){return e})})},n.render=function(){var e=this.props,t=e.data,n=e.total,a=void 0===n?0:n,r=e.loading,i=e.savedKey,o=e.pageIndex,l=e.pageSize,c=e.onPageChange,s=e.onPageSizeChange,u=e.className,d=void 0===u?"":u,n=p()(e,["data","total","loading","savedKey","pageIndex","pageSize","onPageChange","onPageSizeChange","className"]),u=this.state,e=u.columns,u=u.loadingSave;return m().createElement(v.Z,{data:t,className:"yt-listview-wrapper "+d,loading:i&&u||r},(0,v.P)(t)&&m().createElement(m().Fragment,null,m().createElement(f.Table,h()({},n,{columns:(i?this:this.props).columns,data:t,rowKey:this.handleRoKey})),c&&m().createElement(g,{onPageChange:c,onSizeChange:s,total:a,currLength:t.length,pageIndex:o,pageSize:l}),i&&m().createElement(x,{className:"column_selector",value:e,savedKey:i,onChange:this._handleOnColumnsChange})))},r()(e,[{key:"columns",get:function(){var t,e=this.state,n=e.tableWidth,a=e.columns,r=this.props,e=r.columnRenders,i=void 0===e?{}:e,e=r.headerRenders,o=void 0===e?{}:e,r=r.prefixColumns,l=0,c=0,s=0,a=[].concat(void 0===r?[]:r,JSON.parse(JSON.stringify(a.filter(function(e){e=e.checked;return void 0===e||e}))));return a.forEach(function(e){s+=e.width,e.fixed?l+=e.width:c+=e.width;var t=i[e.prop];t&&(e.render=t);t=o[e.prop];t&&(e.renderHeader=t)}),s<n&&(t=n-l,a.forEach(function(e){void 0!==e.checked&&!e.checked||e.fixed||(e.width=e.width/c*t)})),a}}]),e}(m().PureComponent);a.propTypes={className:t().string,savedKey:t().string.isRequired,rowKeyProp:t().string,data:t().any.isRequired,total:t().number,fixedHeight:t().bool,loading:t().bool,pageIndex:t().number,pageSize:t().number,onPageChange:t().func,onPageSizeChange:t().func,columnRenders:t().shape(((n={})[t().string]=t().func,n)),headerRenders:t().shape(((n={})[t().string]=t().func,n)),prefixColumns:t().arrayOf(t().shape({label:t().string,prop:t().string,fixed:t().oneOf(["","left","right"]),width:t().number,checked:t().bool})),columns:t().arrayOf(t().shape({label:t().string,prop:t().string,fixed:t().oneOf(["","left","right"]),width:t().number,checked:t().bool})).isRequired};const k=a}}]);