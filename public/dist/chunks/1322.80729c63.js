(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1322],{91322:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>q});var a=n(37316),i=n.n(a),r=n(67154),l=n.n(r),t=n(85354),o=n.n(t),a=n(67294),d=n.n(a),s=n(92360),c=n(55815),h=n(8201),m=n(23570),g=n(71339),f=n(43036),u=n(39432),v=n(35303),r=n(93913),p=n.n(r),t=n(55609),y=n(61918),C=n(2271),S=n(87219),a=n(64396),_=n(33722),E=a.Z.research.setting.edit;function b(e,t){for(var n=new RegExp(t.toLocaleLowerCase()),a=[],r=0;r<e.length;r++)n.test(e[r].title.toLocaleLowerCase())&&a.push(e[r]);return a}var N={visible:!1,curPageList:void 0,pageIndex:1,pageSize:10,queList:[],filterQueList:void 0,filterTotal:void 0,oriQueList:[],keyword:""},r=function(t){function e(e){var o=t.call(this,e)||this;return o.showDialog=function(e){o.setState(l()({visible:!0},e),function(){o.props.fetchQuestionnaireList({})})},o._handleOnCancel=function(){o.setState(JSON.parse(JSON.stringify(N)))},o._handleOnConfrim=function(){var e=o.state.queList;o.props.save({questionnaireList:e.filter(function(e){return e.checked}),queList:[]}),o._handleOnCancel()},o._handleOnPageIndexChange=function(e){var t=o.state,n=t.queList,a=t.pageSize,t=t.filterQueList;o.setState({pageIndex:e,curPageList:(t||n).slice((e-1)*a,e*a)})},o._handleOnPageSizeChange=function(e){var t=o.state,n=t.queList,t=t.filterQueList;o.setState({pageIndex:1,pageSize:e,curPageList:(t||n).slice(0,e)})},o._handleOnAllChange=function(e){var t=o.state,n=t.queList,a=t.pageIndex,r=t.pageSize,i=t.filterQueList,t=t.keyword,n=n.map(function(t){return l()({},t,{checked:!i||i.some(function(e){return e.id===t.id})?e:t.checked})}),t=i?b(n,t):void 0;o.setState({queList:n,curPageList:t||n.slice((a-1)*r,a*r),filterQueList:t})},o._handleOnChange=function(t,n){var e=o.state,a=e.queList,r=e.pageIndex,i=e.pageSize,l=e.filterQueList,e=e.keyword,a=(0,S.ZP)(a,function(e){e.find(function(e){return e.id===t}).checked=n}),e=l?b(a,e):void 0;o.setState({queList:a,curPageList:e||a.slice((r-1)*i,r*i),filterQueList:e})},o._handleOnSearch=function(e){var t=o.state,n=t.queList,a=t.pageSize,t=e?b(n,e):void 0;o.setState({keyword:e,curPageList:(t||n).slice(0,a),pageIndex:1,filterQueList:t,filterTotal:t?t.length:void 0})},o.state=JSON.parse(JSON.stringify(N)),o}return o()(e,t),e.getDerivedStateFromProps=function(e,t){var n=t.pageIndex,a=t.pageSize,t=t.oriQueList,e=e.queList;return JSON.stringify(t)!==JSON.stringify(e)?{oriQueList:e,queList:e,curPageList:e.slice((n-1)*a,n*a)}:null},e.prototype.render=function(){var e=this.state,t=e.visible,n=e.curPageList,a=e.pageIndex,r=e.pageSize,i=e.filterTotal,l=this.props,o=l.queTotal,e=l.type,l=l.loading;return d().createElement(s.Dialog,{className:"yt_board_edit_select_dialog_wrapper",size:"tiny",visible:t,title:d().createElement("div",null,"关联问卷",d().createElement("span",{className:"tips"},"注：仅展示含有","NPS"===e?"NPS":"满意度","客观题的问卷")),closeOnClickModal:!1,onCancel:this._handleOnCancel},d().createElement(s.Dialog.Body,null,d().createElement(y.Z,{placeholder:"请输入问卷名",onSearch:this._handleOnSearch,onClear:this._handleOnSearch}),d().createElement(C.Z,{columns:this.columns,data:n,total:void 0!==i?i:o,rowKeyProp:"id",pageIndex:a,pageSize:r,loading:l,onPageChange:this._handleOnPageIndexChange,onPageSizeChange:this._handleOnPageSizeChange})),d().createElement(s.Dialog.Footer,null,d().createElement(s.Button,{onClick:this._handleOnCancel},"取消"),d().createElement(s.Button,{type:"primary",onClick:this._handleOnConfrim},"确定")))},p()(e,[{key:"columns",get:function(){var a=this,e=this.state,t=e.queList,n=e.filterQueList,r=!1,t=n?t.filter(function(e){var t=e.id;return n.some(function(e){return e.id===t})}):t,i=!!t.length&&t.reduce(function(e,t){t=t.checked;return!r&&t&&(r=!0),t&&e},!0);return[{prop:"select",renderHeader:function(e){return d().createElement(s.Checkbox,{checked:i,indeterminate:!i&&r,onChange:a._handleOnAllChange})},width:50,render:function(t,e,n){return d().createElement(s.Checkbox,{checked:t.checked,onChange:function(e){return a._handleOnChange(t.id,e)}})}},{label:"问卷名称",prop:"title"},{label:"客观题回答数",prop:"submitted"},{label:"最近一次修改",prop:"updatedAt",render:function(e){return(0,_.Go)(e.updatedAt)}}]}}]),e}(d().PureComponent);const O=(0,t.connect)(function(e){var t=e.loading,n=i()(e,["loading"])[E],a=n.queList,r=n.queTotal,e=n.questionnaireList;return{type:n.type,queList:a,queTotal:r,questionnaireList:e,loading:t.effects[E+"/fetchQuestionnaireList"]||!1}},function(t){return{fetchQuestionnaireList:function(e){return t({type:E+"/fetchQuestionnaireList",payload:e})},save:function(e){return t({type:E+"/save",payload:e})}}},null,{withRef:!0})(r),x=function(n){function e(e){var a=n.call(this,e)||this;a._handleOnPageChange=function(e){var t=a.props,n=(t.save,t.questionnaireList);a.setState({pageIndex:e},function(){a.setState({questionnaireData:n.slice((a.state.pageIndex-1)*a.state.pageSize,a.state.pageIndex*a.state.pageSize)})})},a._handleOnPageSizeChange=function(e){var t=a.props,n=(t.save,t.questionnaireList);a.setState({pageSize:e,pageIndex:1},function(){a.setState({questionnaireData:n.slice((a.state.pageIndex-1)*a.state.pageSize,a.state.pageIndex*a.state.pageSize)})})},a._handleOnNameChange=function(e,t,n){e=e.target;a.nameRef=t,a.setState({inputText:n}),a.props.formChange({key:"name",value:e.value})},a._handleOnNameBlur=function(e){a.state.inputText&&a.setState({inputText:""})},a._getRef=function(e){e&&(a.dialogRef=e.wrappedInstance)},a._handleOnAdd=function(){a.dialogRef&&a.dialogRef.showDialog()};var t=e.onDeleteQues;return a.dialogRef=void 0,a.state={inputText:e.inputText,columns:[{label:"",width:16},{label:"问卷名称",prop:"title",width:333.5,render:function(e){return d().createElement("span",{className:"ellipisis"},e.title)}},{label:"分值题回答数",prop:"submitted",width:294.814,render:function(e){return d().createElement("span",{className:"ellipisis"},(0,u.hE)(e.submitted))}},{label:"操作",width:38.686,render:function(e){return d().createElement("span",{className:"operator",onClick:function(){t(e.id),1!==a.state.pageIndex&&a._handleOnPageChange(1)}},"移出")}},{label:"",width:16}],pageSize:10,pageIndex:1,questionnaireData:[]},a.nameRef=void 0,a}o()(e,n);var t=e.prototype;return t.componentDidUpdate=function(e,t){var n=e.inputText,a=e.questionnaireList,r=this.props,e=r.inputText,r=r.questionnaireList;JSON.stringify(n)!==JSON.stringify(e)&&this.setState({inputText:e}),JSON.stringify(a)!==JSON.stringify(r)&&this.setState({questionnaireData:r.slice(0,this.state.pageSize)})},t.render=function(){var e=this.props,t=e.type,n=e.fetchingDetail,a=e.teamList,r=e.userList,i=e.form,l=e.questionnaireList,o=e.formChange,s=this.state,c=s.inputText,u=s.columns,p=s.pageIndex,e=s.pageSize,s=s.questionnaireData;return d().createElement(h.Z,{loading:n,data:i,className:"research_dashboard_edit_content_wrapper"},d().createElement("div",{className:"type_wrap"},d().createElement("span",null,"看板类型"),d().createElement("div",null,d().createElement("div",null,d().createElement("i",{className:"SATISFACTION"===t?"icon-cem_satisfaction-score":"icon-cem_npsboard"}),"SATISFACTION"===t?"满意度看板":"NPS看板"),d().createElement("div",{className:"desc"},"SATISFACTION"===t?"基于「满意度」提供的客户体验价值分析视角，分析抽取问卷中的的满意度题型，含分值题和原因题":"基于「NPS」提供的客户体验价值分析视角，分析抽取问卷中的的NPS题型，含分值题和原因题"))),d().createElement("div",{className:"name_wrap"},d().createElement("span",null,"看板名称"),d().createElement("div",null,d().createElement(m.Z,{placeholder:"请输入看板名称",className:c?"input_error":"",onChange:this._handleOnNameChange,onBlur:this._handleOnNameBlur,maxLength:10,defaultValue:i.name}),c&&d().createElement("p",{className:"tip_text"},c))),d().createElement("div",{className:"user_wrap"},d().createElement("span",null,"谁能可见"),d().createElement("div",null,d().createElement("span",null,d().createElement("span",null,"团队"),d().createElement("span",null,d().createElement(v.RS,{multiple:!0,tags:!1,onChange:function(e){return o({key:"teamIdList",value:e})},value:i.teamIdList,optionLabelProp:"label",optionFilterProp:"label"},a.map(function(e,t){return d().createElement(v.Wx,{key:t,value:e.id,label:e.name},e.name)})))),d().createElement("span",null,d().createElement("span",null,"用户"),d().createElement("span",null,d().createElement(v.RS,{multiple:!0,tags:!1,onChange:function(e){return o({key:"userIdList",value:e})},value:i.userIdList,optionLabelProp:"label",optionFilterProp:"label"},r.map(function(e,t){return d().createElement(v.Wx,{key:t,value:e.id,label:e.username},e.username)})))))),d().createElement("div",{className:"list_wrap"},d().createElement("span",null,"关联问卷",d().createElement(f.Z,{overlay:d().createElement("div",{style:{maxWidth:260}},d().createElement("div",null,"此看板仅关联「","SATISFACTION"===t?"满意度":"NPS","」题型，包括分值题和原因题 如果处于「未发布」状态的问卷原本有","SATISFACTION"===t?"满意度":"NPS","题，在发布前又删除了","SATISFACTION"===t?"满意度":"NPS","题，则系统会自动取消相关问卷与此看板的关联")),placement:"top"},d().createElement("span",null,d().createElement("i",{className:"icon-cem_file1",style:{marginLeft:4}})))),d().createElement("div",null,d().createElement("div",{className:"top_zone"},"已选中",l.length,"个与「","SATISFACTION"===t?"满意度":"NPS","」有关的问卷",d().createElement("div",{className:"add_ques_btn",onClick:this._handleOnAdd},d().createElement("i",{className:"icon-cem_add-to"}),"添加问卷")),d().createElement(g.Z,{loading:!1,columns:u,data:l&&l instanceof Array?s:[],total:l?l.length:0,pageSize:e,pageIndex:p,onPageChange:this._handleOnPageChange,onPageSizeChange:this._handleOnPageSizeChange}))),d().createElement(O,{ref:this._getRef}))},e}(d().PureComponent);const L=function(e){var t=e.id,n=e.onCancel,a=e.onSubmit;return d().createElement("div",{className:"yt_research_dashboard_edit_wrapper"},d().createElement(c.Z,{title:[{title:"配置",url:""},{title:"看板设置",url:"/research/setting"},{title:(t?"编辑":"新建")+"看板",url:""}]}),d().createElement("div",{className:"content"},d().createElement(x,e),d().createElement("div",{className:"button_zone"},d().createElement(s.Button,{onClick:n},"取消"),d().createElement(s.Button,{type:"primary",onClick:a},"保存"))))};var k=n(61409),P=n(35239),w=n(61193),I=n(5133),z=a.Z.research.setting.edit,T=a.Z.public.menu,a=function(t){function e(e){var a=t.call(this,e)||this;return a.routerWillLeave=function(){return!a.props.hasChange||"信息还未保存，确认要离开？"},a.test=function(){var e=a.props.form.name,t="";return a.setState({isTest:!0}),e.length||a.setState({inputText:t="此处为必填项，请输入看板名称"}),!t},a._handleOnCancel=function(){k.mW.push({pathname:"/research/setting"})},a._handleOnSubmit=function(e){var t=a.props.type;a.test()&&a.props.submit().then(function(e){e=e.data;2e4===e.code?(I.Z.success(e.msg),a.props.save({hasChange:!1}),a.props.fetchMenuList({}),k.mW.push({pathname:"/research/setting"}),"NPS"===t?a.props.cleanNps({}):a.props.cleanSta({})):I.Z.error(e.msg)})},a._handleOnDeleteQues=function(t){var e=a.props,n=e.questionnaireList;(0,e.formChange)({key:"questionnaireList",value:n.filter(function(e){return e.id!==t})})},a.state={isTest:!1,inputText:""},a._event={onCancel:a._handleOnCancel,onSubmit:a._handleOnSubmit,onDeleteQues:a._handleOnDeleteQues},a}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){var e=this.props.location.state,t=e.id,e=e.type;t?this.props.fetchDetail({id:t}):(e&&this.props.save({type:e}),this.props.formChange({key:"userIdList",value:[w.Z.getUser()&&w.Z.getUser().userId],hasChange:!1})),this.props.fetchUserList({projectId:P.t.get(P.V.curProject).id}),this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave)},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return d().createElement(L,l()({},this.state,this.props,this._event))},e}(d().PureComponent);const q=(0,t.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return l()({},e[z],{fetchingDetail:t.effects[z+"/fetchDetail"]||!1})},function(t){return{save:function(e){return t({type:z+"/save",payload:e})},fetchUserList:function(e){return t({type:z+"/fetchUserList",payload:e})},fetchDetail:function(e){return t({type:z+"/fetchDetail",payload:e})},formChange:function(e){return t({type:z+"/formChange",payload:e})},submit:function(e){return t({type:z+"/submit",payload:e})},clean:function(){return t({type:z+"/clean"})},cleanNps:function(e){return t({type:"researchAnalyzeNps/clear",payload:e})},cleanSta:function(e){return t({type:"researchAnalyzeSatisfaction/clear",payload:e})},fetchMenuList:function(e){return t({type:T+"/fetchMenuList",payload:e})}}})(a)},25022:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),c=n.n(t),u=n(92360),p=n(35303),t=n(45697),t=n.n(t),d=[{label:"10项/页",value:10},{label:"20项/页",value:20},{label:"40项/页",value:40},{label:"100项/页",value:100}];const a=function(e){var t=e.onPageChange,n=e.onSizeChange,a=e.total,r=void 0===a?0:a,i=e.pageIndex,l=e.pageSize,o=e.layout,s=e.className,a=e.currLength,e=0===r?0:(i-1)*l+1,a=0===r?0:a?e+a-1:e+l-1;return 0===r?null:c().createElement("div",{className:"yt-awp-pagination "+(s||"")},c().createElement("span",{className:"total_num"},c().createElement("span",null,e+" - "+a+" "),"项，共",c().createElement("span",null," "+r+" "),"项"),c().createElement("div",{style:{textAlign:"right",float:"right"},className:"new_pagination"},c().createElement(u.Pagination,{small:!0,pageSize:l,currentPage:i,pageCount:Math.ceil(r/l),layout:0===r?"":"prev, pager, next",onCurrentChange:t}),void 0===o||o.includes("sizes")?c().createElement(p.RS,{multiple:!1,tags:!1,showSearch:!1,optionFilterProp:"label",optionLabelProp:"label",animation:"slide-up",dropdownClassName:"custom-pagination-dropdown",value:l||10,onChange:n},d.map(function(e,t){return c().createElement(p.Wx,{key:t,label:e.label,value:e.value},e.label)})):null))};t().propTypes={onPageChange:t().func,onSizeChange:t().func,total:t().number,pageIndex:t().number,pageSize:t().number,layout:t().string,className:t().string}},71339:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),p=n.n(t),d=n(92360),h=n(25022),t=n(45697),n=n.n(t),t=function(e){var t=e.data,n=e.total,a=void 0===n?0:n,r=e.loading,i=e.pageIndex,l=e.columns,o=e.pageSize,s=e.onPageChange,n=e.onPageSizeChange,c=e.onSortChange,u=e.defaultSort,e=e.className,e=void 0===e?"":e;return p().useEffect(function(){var e=document.getElementsByClassName("is-sortable")[0];u&&e&&e.classList.add(u.order)},[u]),p().createElement("div",{className:"yt-awp-content-list "+e},p().createElement(d.Loading,{loading:r,className:"awp-content-loading"},p().createElement(d.Table,{defaultSort:u,columns:l,style:{width:"100%"},data:t,onSortChange:function(e){return c(e)}})),s&&p().createElement(h.Z,{onPageChange:s,onSizeChange:n,total:a,currLength:t.length,pageIndex:i,pageSize:o}))};t.propTypes={data:n().array,total:n().number,loading:n().bool,pageIndex:n().number,columns:n().array,pageSize:n().number,onPageChange:n().func,onPageSizeChange:n().func,onSortChange:n().func,defaultSort:n().any,className:n().string};const a=t},61918:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),u=n.n(t),t=n(45697),n=n.n(t),t=function(e){var t=e.className,n=e.onClear,a=e.onSearch,r=e.placeholder,i=e.style,l=e.defValue,o=e.signal,e=u().useState(l),s=e[0],c=e[1];u().useEffect(function(){c(l)},[l,o]);return u().createElement("div",{style:i,className:"yt_search_input_wrapper "+(t||"")},u().createElement("input",{placeholder:r,value:s,onKeyDown:function(e){13===e.keyCode&&a(s)},onChange:function(e){return c(e.target.value)},autoComplete:"off"}),s&&u().createElement("i",{className:"icon-cem_log-off",onClick:function(){c(""),n&&n("")}}),u().createElement("i",{className:"icon-cem_small-search",onClick:function(){return a(s)}}))};t.propTypes={className:n().string,onSearch:n().func.isRequired,placeholder:n().string,style:n().object,defValue:n().string,signal:n().any,onClear:n().func};const a=t},2271:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var a=n(37316),d=n.n(a),t=n(67154),h=n.n(t),a=n(93913),r=n.n(a),t=n(85354),i=n.n(t),a=n(23279),l=n.n(a),t=n(67294),m=n.n(t),g=n(92360),c=n(35303),a=n(45697),t=n.n(a),u=[{label:"10项/页",value:10},{label:"20项/页",value:20},{label:"40项/页",value:40},{label:"100项/页",value:100}];const f=function(e){var t=e.onPageChange,n=e.onSizeChange,a=e.total,r=void 0===a?0:a,i=e.pageIndex,l=e.pageSize,o=e.currLength,s=e.layout,a=e.className,e=0===r?0:(i-1)*l+1,o=0===r?0:e+o-1;return 0===r?null:m().createElement("div",{className:"yt-awp-pagination "+(a||"")},m().createElement("span",{className:"total_num"},m().createElement("span",null,e+" - "+o+" "),"项，共",m().createElement("span",null," "+r+" "),"项"),m().createElement("div",{style:{textAlign:"right",float:"right"},className:"new_pagination"},m().createElement(g.Pagination,{small:!0,pageSize:l,currentPage:i,pageCount:Math.ceil(r/l),layout:0===r?"":"prev, pager, next",onCurrentChange:t}),void 0===s||s.includes("sizes")?m().createElement(c.RS,{multiple:!1,tags:!1,showSearch:!1,optionFilterProp:"label",optionLabelProp:"label",animation:"slide-up",dropdownClassName:"custom-pagination-dropdown",value:l||10,onChange:n},u.map(function(e,t){return m().createElement(c.Wx,{key:t,label:e.label,value:e.value},e.label)})):null))};t().propTypes={onPageChange:t().func,onSizeChange:t().func,total:t().number,pageIndex:t().number,pageSize:t().number,currLength:t().number,layout:t().string,className:t().string};var v=n(8201),a=n(48926),o=n.n(a),a=n(87757),s=n.n(a),p=n(36144);function y(){return(y=o()(s().mark(function e(t){var n,a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectId,a=t.key,e.abrupt("return",p.h.post("/default/value/find",{projectId:n,key:a}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function C(){return(C=o()(s().mark(function e(t){var n,a,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectId,a=t.value,r=t.key,e.abrupt("return",p.h.post("/default/value/update",{projectId:n,key:r,value:a}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}var S=n(39432),_=n(43036),E=n(51474),b=n(87219),a=function(t){function e(e){var c=t.call(this,e)||this;return c._setShowFalse=function(){c.setState({show:!1})},c._handleParentClick=function(e){c.state.show&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},c._handleOnTriggerClick=function(){setTimeout(function(){c.setState({show:!c.state.show})},0)},c._renderOptionItem=function(t,e,n,a,r,i){var l=c.state.maxLabelWidth,o=c.props,s=o.value,o=o.savedKey,s=s.find(function(e){return e.prop===t.prop});return m().createElement("div",{className:"opt_item "+(e?"draggable":""),key:t.prop},e&&m().createElement("i",{className:"icon-cem_move my_handle"}),m().createElement("div",{className:"opt_content",style:{width:l,marginLeft:e?0:12}},m().createElement("div",{className:"item_label",onClick:function(e){e.stopPropagation(),c._handleOnItemClick(t.prop)}},m().createElement("span",{className:"icon_checkbox "+(s&&s.checked?"checkbox_checked":"")}),m().createElement("span",null,t.label)),m().createElement("div",{className:"item_control",style:{display:"product_setting_link"===o?"none":"block"}},m().createElement(_.Z,{placement:"top",overlay:n},m().createElement("span",{onClick:function(e){return a(e,t.prop)}},m().createElement("i",{className:(e?"icon-cem_up":"icon-cem_up-and-down")+" fun_icon_a"}))),m().createElement(_.Z,{placement:"top",overlay:r},m().createElement("span",{onClick:function(e){return i(e,t.prop)},style:{marginLeft:4}},m().createElement("i",{className:"icon-cem_down fun_icon_b"}))))))},c._handleOnItemClick=function(t){var e=c.props,n=e.value,e=e.onChange;e&&e((0,b.ZP)(n,function(e){e=e.find(function(e){return e.prop===t});e&&(e.checked=!e.checked)}))},c._handleOnFilxedLeftClick=function(e,t){e.stopPropagation(),c._handleOnFixedChange(t,"left")},c._handleOnCancelFixedClick=function(e,t){e.stopPropagation(),c._handleOnFixedChange(t,"")},c._handleOnFixedRightClick=function(e,t){e.stopPropagation(),c._handleOnFixedChange(t,"right")},c._handleOnFixedChange=function(t,n){var e=c.props,a=e.value,e=e.onChange;e&&e((0,b.ZP)(a,function(e){e=e.find(function(e){return e.prop===t});e&&(e.fixed=n)}))},c.state={show:!1,value:[],leftOpts:[],normalOpts:[],rightOpts:[],maxLabelWidth:e.value.reduce(function(e,t){return Math.max((0,S.jD)(t.label,14)+56+16+16,e)},0)},c}i()(e,t),e.getDerivedStateFromProps=function(a,e){if(JSON.stringify(a.value)===JSON.stringify(e.value))return null;var t=a.value.reduce(function(e,t){var n=1;return"left"===t.fixed&&(n=0),e[n="right"===t.fixed?2:n].push(a.value.find(function(e){return e.prop===t.prop})),e},[[],[],[]]),n=t[0],e=t[1],t=t[2];return{value:a.value,leftOpts:n,normalOpts:e,rightOpts:t,maxLabelWidth:a.value.reduce(function(e,t){return Math.max((0,S.jD)(t.label,14)+56+16+16,e)},0)}};var n=e.prototype;return n.componentDidMount=function(){var l=this;window.addEventListener("click",this._setShowFalse);var e=document.querySelectorAll("#draggable_zone");e.length&&e.forEach(function(e){E.ZP.create(e,{group:"draggable_zone",animation:150,filter:".undraggable",draggable:".draggable",handle:".my_handle",onEnd:function(e){var t=l.props,n=t.value,a=t.onChange,r=e.newIndex,i=e.oldIndex;r!==i&&(t=n.filter(function(e){return"left"===e.fixed}),e=n.filter(function(e){return"right"===e.fixed}),n=(0,b.ZP)(n.filter(function(e){return!e.fixed}),function(e){var t=e.splice(i,1)[0];e.splice(r,0,t)}),a&&a([].concat(t,n,e)))}})})},n.componentWillUnmount=function(){window.removeEventListener("click",this._setShowFalse)},n.render=function(){var t=this,e=this.state,n=e.show,a=e.leftOpts,r=e.normalOpts,i=e.rightOpts,l=this.props,e=l.className,l=l.title;return m().createElement("div",{className:"yt_columns_selector_wrapper "+(e||""),onClick:this._handleParentClick},m().createElement("div",{className:"trigger "+(n?"sel":""),onClick:this._handleOnTriggerClick},l||"列",m().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:n?"rotate(-180deg)":""}})),m().createElement("div",{className:"options "+(n?"active":"")},0<a.length&&m().createElement(m().Fragment,null,m().createElement("div",{className:"opt_label"},"固定在左侧"),a.map(function(e){return t._renderOptionItem(e,!1,"不固定",t._handleOnCancelFixedClick,"固定在列尾",t._handleOnFixedRightClick)})),(0<a.length||0<i.length)&&m().createElement("div",{className:"opt_label"},"不固定"),m().createElement("div",{id:"draggable_zone",style:{visibility:0<r.length}},r.map(function(e){return t._renderOptionItem(e,!0,"固定在列头",t._handleOnFilxedLeftClick,"固定在列尾",t._handleOnFixedRightClick)})),0<i.length&&m().createElement(m().Fragment,null,m().createElement("div",{className:"opt_label"},"固定在右侧"),i.map(function(e){return t._renderOptionItem(e,!1,"不固定",t._handleOnCancelFixedClick,"固定在列头",t._handleOnFilxedLeftClick)}))))},e}(m().PureComponent);const N=a;a.propTypes={className:t().string,title:t().string,value:t().arrayOf(t().shape({label:t().string,prop:t().string,fixed:t().string,checked:t().bool})),onChange:t().func};var O=n(35239),a=function(t){function e(e){var n=t.call(this,e)||this;return n._handleOnResize=function(){var e=document.querySelector(".yt-listview-wrapper");e&&n.setState({tableWidth:e.clientWidth-5})},n._handleOnColumnsChange=function(e){n.setState({columns:e},function(){n.props.savedKey&&!function(){return C.apply(this,arguments)}({projectId:O.t.get(O.V.curProject).id,key:n.props.savedKey,value:JSON.stringify(e.map(function(e){return{prop:e.prop,checked:e.checked,fixed:e.fixed}}))}).then(function(e){e.data})})},n.handleRoKey=function(e){var t=n.props.rowKeyProp;return t&&e&&e[t]?e[t]:JSON.stringify(e)},n.state={talbeWidth:0,columns:e.columns||[],loadingSave:!0},n}i()(e,t),e.getDerivedStateFromProps=function(e,t){};var n=e.prototype;return n.componentDidMount=function(){var n=this;window.addEventListener("resize",l()(this._handleOnResize,150)),this._handleOnResize();var e=this.props,t=e.savedKey,r=e.columns;t&&!function(){return y.apply(this,arguments)}({projectId:O.t.get(O.V.curProject).id,key:t}).then(function(e){var t,a=e.data;if(2e4===a.code)try{t=r.map(function(t,e){var n=JSON.parse(a.result).filter(function(e){e=e.prop;return t.prop===e});return n&&0<n.length?h()({},t,n[0]):t}).filter(function(e){return e})}catch(e){}finally{n.setState({columns:t||n.state.columns,loadingSave:!1})}})},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleOnResize)},n.componentDidUpdate=function(e,t){var r=this;JSON.stringify(e.columns)!==JSON.stringify(this.props.columns)&&0<this.props.columns.length&&this.setState({columns:this.props.columns.reduce(function(e,t,n){var a=r.state.columns.findIndex(function(e){e=e.prop;return t.prop===e});return e.splice(-1<a?a:n,0,h()({},t,r.state.columns[a])),e},[]).filter(function(e){return e})})},n.render=function(){var e=this.props,t=e.data,n=e.total,a=void 0===n?0:n,r=e.loading,i=e.savedKey,l=e.pageIndex,o=e.pageSize,s=e.onPageChange,c=e.onPageSizeChange,u=e.className,p=void 0===u?"":u,n=d()(e,["data","total","loading","savedKey","pageIndex","pageSize","onPageChange","onPageSizeChange","className"]),u=this.state,e=u.columns,u=u.loadingSave;return m().createElement(v.Z,{data:t,className:"yt-listview-wrapper "+p,loading:i&&u||r},(0,v.P)(t)&&m().createElement(m().Fragment,null,m().createElement(g.Table,h()({},n,{columns:(i?this:this.props).columns,data:t,rowKey:this.handleRoKey})),s&&m().createElement(f,{onPageChange:s,onSizeChange:c,total:a,currLength:t.length,pageIndex:l,pageSize:o}),i&&m().createElement(N,{className:"column_selector",value:e,savedKey:i,onChange:this._handleOnColumnsChange})))},r()(e,[{key:"columns",get:function(){var t,e=this.state,n=e.tableWidth,a=e.columns,r=this.props,e=r.columnRenders,i=void 0===e?{}:e,e=r.headerRenders,l=void 0===e?{}:e,r=r.prefixColumns,o=0,s=0,c=0,a=[].concat(void 0===r?[]:r,JSON.parse(JSON.stringify(a.filter(function(e){e=e.checked;return void 0===e||e}))));return a.forEach(function(e){c+=e.width,e.fixed?o+=e.width:s+=e.width;var t=i[e.prop];t&&(e.render=t);t=l[e.prop];t&&(e.renderHeader=t)}),c<n&&(t=n-o,a.forEach(function(e){void 0!==e.checked&&!e.checked||e.fixed||(e.width=e.width/s*t)})),a}}]),e}(m().PureComponent);a.propTypes={className:t().string,savedKey:t().string.isRequired,rowKeyProp:t().string,data:t().any.isRequired,total:t().number,fixedHeight:t().bool,loading:t().bool,pageIndex:t().number,pageSize:t().number,onPageChange:t().func,onPageSizeChange:t().func,columnRenders:t().shape(((n={})[t().string]=t().func,n)),headerRenders:t().shape(((n={})[t().string]=t().func,n)),prefixColumns:t().arrayOf(t().shape({label:t().string,prop:t().string,fixed:t().oneOf(["","left","right"]),width:t().number,checked:t().bool})),columns:t().arrayOf(t().shape({label:t().string,prop:t().string,fixed:t().oneOf(["","left","right"]),width:t().number,checked:t().bool})).isRequired};const x=a}}]);