(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3004],{38177:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var n=a(85354),r=a.n(n),t=a(67294),o=a.n(t),n=a(45697),n=a.n(n),c=a(92360),u=a(43036),i=function(t){function e(e){var c=t.call(this,e)||this;return c.getPercentage=function(){for(var e=c.props.data,t=0,a=0,n=0,r=0,i=0,l=0;l<e.length;l++){var o=e[l].value;t+=o,l<100&&(i+=o,l<50&&(r+=o,l<30&&(n+=o,l<10&&(a+=o))))}c.setState({percentage:{10:0===t?0:a/t,30:0===t?0:n/t,50:0===t?0:r/t,100:0===t?0:i/t}})},c.toggleDisplay=function(){var e=c.state.show;c.setState({show:!e})},c.switchTopValue=function(e){c.setState({topValue:e})},c.handleConfirm=function(){var e=c.props.onConfirm,t=c.state.topValue;e&&e(t),c.setState({show:!1})},c.state={show:!1,topValue:e.topValue||0,percentage:{10:0,30:0,50:0,100:0}},c}r()(e,t);var a=e.prototype;return a.componentDidMount=function(){this.getPercentage()},a.render=function(){var t=this,e=this.state,a=e.show,n=e.topValue,r=e.percentage,i=this.props.data,l=i[0]?i[0].value:0,e=i[n<=i.length?n-1:i.length-1].value||0,i=[10,30,50,100];return o().createElement(c.Dialog,{title:"视图过滤",size:"tiny",visible:a,customClass:"data_filter_wrapper",onCancel:this.toggleDisplay,lockScroll:!0},o().createElement(c.Dialog.Body,null,o().createElement("div",{className:"input_set"},o().createElement(c.Input,{value:l,disabled:!0}),o().createElement("span",null,"-"),o().createElement(c.Input,{value:e,disabled:!0})),o().createElement("div",{className:"bar_set"},i.map(function(e){return o().createElement(u.Z,{placement:"top",overlay:"Top"+e+"占总数据量的"+(100*r[e]).toFixed(2)+"%",key:e},o().createElement("div",{className:n===e?"bar active":"bar",style:{height:100*r[e]+"px"},onClick:function(){return t.switchTopValue(e)}}))})),o().createElement("div",{className:"desc_set"},i.map(function(e){return o().createElement("span",{key:e},"top"+e)}))),o().createElement(c.Dialog.Footer,{className:"dialog-footer"},o().createElement(c.Button,{onClick:this.toggleDisplay},"取消"),o().createElement(c.Button,{type:"primary",onClick:this.handleConfirm},"确定")))},e}(t.Component);i.propTypes={data:n().arrayOf(n().shape({name:n().string.isRequired,value:n().number.isRequired})),topValue:n().number.isRequired,onConfirm:n().func.isRequired}},41103:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var f=a(67294),g=a.n(f),v=a(50976),y=a(30133),E=a(31705),C=a(38177),D=a(94644),t=a(67154),b=a.n(t),w=a(39432);const n=function(e){var t=e.isInitial,a=e.loading,n=e.title,r=e.otherChartType,i=e.pieChartData,l=e.otherChartData,o=e.type,c=e.formatedData,u=e.topValue,s=e.save,p=g().useState(void 0),d=p[0],h=p[1],e=g().useState(void 0),m=e[0],p=e[1];g().useEffect(function(){var e;!t&&!a&&d&&i&&0<i.length&&l&&(e=function(e){var t=e.title,a=e.otherChartType,n=e.pieChartData,r=e.otherChartData,i=e.type,l=0<n.length?n.reduce(function(e,t){return e+t.count},0):0;n.forEach(function(e){var t=0===l?0:e.count/l*100;e.percentage=Number.isInteger(t)?t:t.toFixed(2)});e={type:"pie",id:"pie",radius:["57%","68%"],center:["9%","60%"],legendHoverLink:!1,hoverAnimation:!0,hoverOffset:3,label:{show:!0,position:"center",formatter:["{a|"+w.ZP.formatNumber(l)+"}","{b|"+(i&&"PRODUCT"===i?"评论数":"销量")+"}"].join("\n"),rich:{a:{fontSize:24,lineHeight:32,color:"#262626",padding:[4,0]},b:{fontSize:14,lineHeight:20,color:"#8C8C8C",padding:[4,0]}}},itemStyle:{borderWidth:1,borderColor:"#fff"},data:n.map(function(e){return{name:e.name,value:e.count}})};r.forEach(function(e){var t=0;0<e.data.length&&e.data.forEach(function(e){t+=e.count}),e.total=t}),r.sort(function(e,t){return t.total-e.total});var o="bar"===a?{barMaxWidth:32,large:!0}:{smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{opacity:1}},i=r.map(function(e){var t=e.name,e=e.data;return b()({},o,{name:t,type:a,stack:"stack",data:0<e.length?e.map(function(e){return{name:e.date,value:e.count}}):[]})});return{title:{text:t,textStyle:{fontSize:14,lineHeight:20},left:0,top:0},tooltip:{confine:!0,enterable:n&&17<n.length,axisPointer:{type:"none"},formatter:function(e){return Array.isArray(e)?(e.sort(function(e,t){return e.value-t.value}),e[0].name+e.map(function(e){return"<br/>"+e.marker+e.seriesName+"："+e.value}).reverse().join("")):e.marker+" "+e.name+"："+e.value+"（"+e.percent+"%）"},extraCssText:"max-height: 400px; overflow: auto"},legend:{type:"scroll",orient:"vertical",left:"20%",top:"26%",itemWidth:12,itemHeight:12,itemGap:16,pageIconSize:12,formatter:function(t){return"{a|"+(9<t.length?t.substring(0,9)+"...":t)+"}{b|"+n.filter(function(e){return e.name===t})[0].percentage+"%}"},textStyle:{rich:{a:{width:102,padding:[0,4]},b:{width:48,color:"#8C8C8C",align:"right"}}},data:0<n.length?n.map(function(e){return{name:e.name,icon:"rect"}}):[]},xAxis:{type:"category",boundaryGap:"bar"===a,data:0<r.length?r[0].data.map(function(e){return e.date}):[]},yAxis:{gridIndex:0},grid:{show:!1,top:"26%",left:"40%",right:"2%",bottom:0,containLabel:!0,tooltip:{trigger:"axis"}},series:[].concat(i,[e])}}({title:n,otherChartType:r,pieChartData:i,otherChartData:l,type:o}),d.clear(),d.setOption(e))},[t,a,i,l,d,o]);e=["SPU","SHOP"];return g().createElement("div",{className:"double-chart-wrapper"},t?g().createElement(y.Z,null):0===i.length?g().createElement("div",{className:"empty-block"},"暂无数据"):g().createElement(f.Fragment,null,g().createElement(v.Z,{theme:"yunting_multi_color",option:{},showLoading:a,style:{width:"100",height:"252px",display:0<i.length?"block":"none"},loadingOption:{text:"",color:"#1574B3"},onChartReady:function(e){return h(e)}}),g().createElement(E.Z,{onDownChartClick:function(){(0,D._v)(d,n)},onDownExcelClick:function(){return function(e,t){if(0<e.length){for(var a=e.map(function(e){return e.name}),n=[],r=0;r<e[0].data.length;r++){var i=[];i.push(e[0].data[r].date);for(var l=0;l<e.length;l++)i.push(e[l].data[r].count);n.push(i)}a.splice(0,0,"日期"),n.splice(0,0,a),(0,D.aT)([n],t)}}(l,n)},otherOptions:e.includes(o)?[{label:"视图过滤",clickFun:function(){return m.toggleDisplay()}}]:[]}),e.includes(o)&&g().createElement(C.Z,{data:c,topValue:u,ref:p,onConfirm:function(e){return s({firstTopValue:e})}})))}},93004:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var n=a(37316),r=a.n(n),t=a(67154),i=a.n(t),n=a(85354),l=a.n(n),t=a(67294),E=a.n(t),C=a(19586),D=a(41103),h=a(50976),m=a(92360),f=a(70715),g=a(30133),v=a(31705),y=a(38177),b=a(94644);const w=function(e){var t=e.pieChartloading,r=e.pieChartData,i=e.type,a=e.isInitial,n=e.handleChartClick,l=e.formatedData,o=e.topValue,c=e.save,u=E().useState(void 0),s=u[0],p=u[1],e=E().useState(void 0),d=e[0],u=e[1],e=r&&0<r.length?function(e,i){var l=[],o=[],c=[];e.forEach(function(t,e){l.push(t.name);var a,n,r=void 0;"MODEL"===i?(c.find(function(e){return e.name===t.brand})||c.push({name:t.brand,color:void 0}),a=c.findIndex(function(e){return e.name===t.brand}),n=Math.floor(a/f.Fq.length),r=f.Fq[a%f.Fq.length],c[a].color||(c[a].color="#"+(parseInt(r.substring(1),16)+1118481*n).toString(16))):(n=Math.floor(e/f.Fq.length),r=f.Fq[e%f.Fq.length],r="#"+(parseInt(r.substring(1),16)+65793*n).toString(16)),o.push({obj:t,name:t.brand,value:t.count,spu:"SPU"===i?t.spu:"",itemStyle:{color:r}})});e=10/e.length<1&&10/e.length;return{title:{text:("MODEL"===i?"评论数":"销量")+"排名 - "+("MODEL"===i?"型号":"SHOP"===i?"店铺":"SPU"),left:20},tooltip:{formatter:function(e){var t=e.marker,e=e.data.obj;return("MODEL"===i?[t+" 品牌："+e.brand,"型号："+e.name,"评论数："+e.count]:[t+" "+("SHOP"===i?"店铺":"SPU")+"："+e.name,"销量："+e.count]).join("</br>")}},grid:{top:"MODEL"===i?"20%":"12%",left:"6%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:l.reverse(),axisLabel:{formatter:function(e){return 9<e.length?e.substring(0,9)+"...":e}}},dataZoom:[{type:"slider",show:!!e,yAxisIndex:[0],start:e?100-100*e:0,end:100,width:18,showDetail:!1,left:20}],series:[{type:"bar",barMaxWidth:"22",data:o.reverse(),large:!0,largeThreshold:400,progressive:0}],opt:{brandData:c}}}(r,i):{};return E().createElement("div",{className:"price-product-ranking-chart"},a?E().createElement(g.Z,null):0===r.length?E().createElement("div",{className:"empty-block"},"暂无数据"):E().createElement(m.Loading,{loading:t,style:{height:"100%"}},E().createElement(h.Z,{theme:"yunting_multi_color",option:e,style:{width:"calc(100% - 480px)",height:"500px"},onChartReady:function(e){return p(e)},onEvents:{click:"SPU"===i?n:null}}),E().createElement("div",{className:"table-wrap"},E().createElement("div",{className:"table-header"},"MODEL"===i&&E().createElement("div",null,"品牌"),E().createElement("div",null,"MODEL"===i?"型号":"SPU"===i?"SPU":"店铺"),"MODEL"===i&&E().createElement("div",null,"评论数"),"MODEL"!==i&&E().createElement("div",null,"销量")),E().createElement("ul",null,r.map(function(e){return E().createElement("li",{key:e.name},"MODEL"===i&&E().createElement("div",null,e.brand),E().createElement("div",null,e.name),E().createElement("div",null,e.count))}))),"MODEL"===i&&e.opt&&E().createElement("div",{className:"chart_fake_legend"},e.opt.brandData.map(function(e){return E().createElement("span",{key:e.name},E().createElement("span",{className:"chart_fake_legend_icon",style:{background:e.color}}),e.name)})),E().createElement(v.Z,{onDownChartClick:function(){var e;e=("MODEL"===i?"评论数":"销量")+"排名 - "+("MODEL"===i?"型号":"店铺")+"图",(0,b._v)(s,e)},onDownExcelClick:function(){var e,t,a,n;t=("MODEL"===i?"评论数":"销量")+"排名 - "+("MODEL"===i?"型号":"店铺")+"数据",a=i,0<(e=r).length&&(n=[[],[]],e.forEach(function(e){n[0].push(e.name),n[1].push(e.count)}),n[0].unshift("MODEL"===a?"型号":"店铺"),n[1].unshift("销量"),(0,b.aT)([n],t))},otherOptions:"MODEL"!==i?[{label:"视图过滤",clickFun:function(){return d.toggleDisplay()}}]:[]}),"MODEL"!==i&&E().createElement(y.Z,{data:l,topValue:o,ref:u,onConfirm:function(e){return c({sndTopValue:e})}})))};const o=function(e){var t=e.isInitial,a=e.type,n=e.pieChartloading,r=e.lineChartloading,i=e.pieChartData,l=e.lineChartData,o=e.handleFilterReady,c=e.handleFilterChange,u=e.handleChartClick,s=e.getFilterRef,p=e.saleData,d=e.filteredItems,h=e.firstTopValue,m=e.sndTopValue,f=e.save,g=i.slice(0,h),v=l.filter(function(e){e=e.spu;return d.includes(e)}),y=i.slice(0,m),e=i.map(function(e){return{name:e.name,value:e.count}});return E().createElement("div",{className:"price-product-analysis-wrapper"},E().createElement(C.Z,{ref:s,title:("MODEL"===a?"产品":"SHOP"===a?"店铺":"SPU")+"分析",showList:["condition","time"],filter:["CONN_CONFIG","SOURCE"],onFilterReady:o,onChange:c}),E().createElement("div",{className:"price-product-analysis-body"},E().createElement("div",null,E().createElement(D.Z,{isInitial:t,loading:r,title:"MODEL"===a?"评论数分布 - 型号":"销量分布 - "+("SHOP"===a?"店铺":"SPU"),otherChartType:"line",pieChartData:"MODEL"!==a?g:i,otherChartData:"MODEL"!==a?v:l,type:a,topValue:h,formatedData:e,save:f})),E().createElement(w,{saleData:p,pieChartData:y,pieChartloading:n,type:a,isInitial:t,handleChartClick:u,topValue:m,formatedData:e,save:f})))};var c=a(35239),n=a(55609),u=a(64396).Z.price.productShop,t=function(t){function e(e){var i=t.call(this,e)||this;return i._handleFilterReady=function(){var e=i.props.fetchData,t=i.filter.getValue(),a=t.filterModel,t=t.dateFilter;e({projectId:c.t.get(c.V.curProject).id,filterModel:a,dateFilter:t})},i._handleFilterChange=function(e){var t=i.props,a=t.fetchData,n=t.init,r=e.filterModel,t=e.dateFilter,e=c.t.get(c.V.curProject).id;n(),a({projectId:e,filterModel:r,dateFilter:t})},i._handleChartClick=function(e){var t=i.props.type,a=i.props[t].dateFilter,t=e.data.spu;window.windowPool=[];e=window.open("/price/realTimePrice/priceDetail");window.windowPool.push({window:e,parameter:{source:3,data:{spu:t,dateFilter:a}}})},e.saveType({type:e.pageType}),i.event={handleFilterReady:i._handleFilterReady,handleFilterChange:i._handleFilterChange,handleChartClick:i._handleChartClick,getFilterRef:function(e){return i.filter=e}},i}return l()(e,t),e.prototype.render=function(){var e=this.props,t=e.type,a=e.pageType,n=this.props,r=n.save,e=n.pieChartloading,n=n.lineChartloading;return t&&t===a?E().createElement(o,i()({},this.props[t],this.event,{type:t,pieChartloading:e,lineChartloading:n,save:r})):null},e}(t.Component);const s=(0,n.connect)(function(e){var t=e.loading,e=r()(e,["loading"]);return i()({},e[u],{pieChartloading:t.effects[u+"/fetchPieChartData"]||!1,lineChartloading:t.effects[u+"/fetchLineChartData"]||!1})},function(t){return{fetchData:function(e){return t({type:u+"/fetchData",payload:e})},saveType:function(e){return t({type:u+"/saveType",payload:e})},init:function(e){return t({type:u+"/init",payload:e})},save:function(e){return t({type:u+"/save",payload:e})}}})(t)}}]);