(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[4074],{54074:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var a=n(37316),i=n.n(a),r=n(67154),v=n.n(r),t=n(85354),o=n.n(t),a=n(67294),_=n.n(a),r=n(55609),D=n(26198),f=n(8201),h=n(50976),g=n(83680),y=n(24062),T=n(98191),C=n(39432),O=n(70715),E=n(94644),F=n(90126),t=n(30381),R=n.n(t);function b(e,t,n,a){var i,r,o=[];try{if(e&&e instanceof Array){r=(i=e).some(function(e){return 0<e.total})?i.find(function(e){return 0<e.total}).dateList.map(function(e){return e.date}):i[0].dateList.map(function(e){return e.date}),o=i.reduce(function(e,t){return e.forEach(function(n){n.dateList=r.map(function(t){var e=n.dateList.find(function(e){return e.date===t});return e?v()({},e):{date:t,count:0}})}),e.push(v()({},t)),e},[]),"DAY"!==t&&(o=o.map(function(e){return v()({},e,{dateList:e.dateList.map(function(e){return v()({},e,{date:(0,C.yV)(t,e.date)})})})}));var l=[],s=[];try{l=o&&o.map(function(e){return e&&e.name}),s=o&&o[0]&&o[0].dateList.map(function(e){return[e.date]})}catch(e){}var c="all"===a?["机型ID","机型","声量"]:"negative"===a?["机型ID","机型","负面声量"]:["机型ID","机型","正面声量"],u=o&&o.map(function(e){return[e.id,e.name,e.total]}),d=o&&o.reduce(function(e,t){return e+t.total},0),p=o&&o.map(function(e){return[e.id,e.name,0===d?0:e.total/d]}),m=["日期"].concat(l),f=o&&o.reduce(function(e,t){return t.dateList&&t.dateList.forEach(function(t){return e.some(function(e){return e[0]===t.date})&&e.find(function(e){return e[0]===t.date}).push(t.count)}),e},[].concat(s)),h=f.reduce(function(n,e,a){var i=e.reduce(function(e,t,n){return 0!==n?e+t:e},0);return e.forEach(function(e,t){0!==t&&(n[a][t]=0===i?0:e/i)}),n},JSON.parse(JSON.stringify(f)));return{length:o.length,datasets:[{dimensions:c,source:"RATIO"===n?p:u},{dimensions:m,source:"RATIO"===n?h:f}]}}}catch(e){}}R().locale("zh-cn");var N=[{title:"数量",value:"COUNT"},{title:"占比",value:"RATIO"}],a=n(45697),t=n.n(a),a=function(e){var i=e.title,t=e.loading,l=e.data,n=e.dateRange,a=e.timeType,r=e.fTimeType,s=e.formulaType,o=e.fFormulaType,c=e.onFilterChange,u=e.onFlavorChange,d=e.onClick,e=_().useState(void 0),p=e[0],m=e[1];return _().useEffect(function(){var e,r,o,t,n;p&&((0,f.P)(l)?(r=i,o=s,t=(e=l).datasets,n=e.length,e=t&&t[1].dimensions.slice(1),n=Array.from({length:n}),n={title:{text:r},grid:[{left:"4%",right:"69.4%",top:"30%",bottom:"3%",height:"55%",containLabel:!0},{left:"34%",top:"30%",right:"4%",bottom:"3%",height:"55%",containLabel:!0}],dataZoom:[{show:"slider",left:"35%",right:"4%",bottom:15,xAxisIndex:1,height:16,handleSize:"100%",showDetail:!1}],dataset:t&&t.map(function(e){return v()({},e,{sourceHeader:!1})}),tooltip:{trigger:"item",formatter:function(e){var t=e.name,n=e.marker,a=e.seriesName,i=e.seriesIndex,i=e.data[i],i="RATIO"===o?0===i?"0.00%":(100*i).toFixed(2)+"%":C.ZP.getApproximateNum(i);return'<span class="yt_echart_tooltip_title">'+("舆情声量走势对比"===r?"声量":"各机型负面声量对比图"===r?"负面声量":"正面声量")+("RATIO"===o?"占比":"")+'<span style="color: #8C8C8C;font-weight: 500;">（'+t+"）</span></span><br />"+n+" "+a+"："+i}},legend:{top:40,left:"33%",right:40,itemWidth:14,itemHeight:12,type:"scroll",pageIconSize:12,data:e,icon:O.W4.lineRing},xAxis:[{type:"category",gridIndex:0,boundaryGap:[0,.01],data:e,axisLabel:{formatter:function(e){return 7<e.length?e.substring(0,7)+"...":e}},axisTick:{show:!0,alignWithLabel:!0}},{type:"category",gridIndex:1,boundaryGap:!1,axisTick:{show:!0}}],yAxis:t&&t.map(function(e,t){return{minInterval:"RATIO"===o?void 0:1,gridIndex:t,axisLabel:{showMinLabel:!1,formatter:function(e){return"RATIO"===o?(100*e).toFixed(0)+"%":(0,C.uf)(e)}}}}),series:[{type:"bar",datasetIndex:0,barMaxWidth:"36",xAxisIndex:0,yAxisIndex:0,tooltip:{trigger:"item",formatter:function(e){var t=e.marker,n=e.data,e=n.value;return t+" "+n.name+"："+("RATIO"===o?0===e?0:(100*e).toFixed(2)+"%":e)}},data:t&&t[0].source.map(function(e,t){return{value:e[2],name:e[1],itemStyle:{color:O.Fq[t]}}})}].concat(n.map(function(e,t){return{type:"line",xAxisIndex:1,yAxisIndex:1,datasetIndex:1,areaStyle:{opacity:.1},itemStyle:{color:O.Fq[t]}}}))},p.clear(),p.setOption(n)):m(void 0))},[l,p]),_().createElement(f.Z,{data:l,className:"yt_bar_line_chart_wrapper",loading:t,renderTitle:_().createElement(T.Z,{title:i,data:l,onMoreClick:function(e){var t,n,a;t=p,n=l,a=i,"image"===(e=e)?(0,E._v)(t,a):"data"!==e||(e=n.datasets)&&(n=[e[0].dimensions].concat(e[0].source),e=[e[1].dimensions].concat(e[1].source),e=[].concat(n,[[""]],e),(0,E.aT)([e],a))}},s&&_().createElement(y.Z,{options:N,objName:"舆情声量走势对比"===i?"formulaType":"各机型负面声量对比图"===i?"negativeFormulaType":"positiveFormulaType",activeObj:s,flavor:o,onFlavorChange:u,onChange:c}),!!n&&_().createElement(g.Z,{dateRange:n,objName:Object.keys(a)[0],defaultValue:Object.values(a)[0],collectValue:r,updateCollectValue:function(e){var t;return u(((t={})[Object.keys(a)[0]]=e,t))},onChange:function(e){var t;return c(((t={})[Object.keys(a)[0]]=e,t))}}))},_().createElement(h.Z,{theme:"yunting_multi_color",className:"yt_echarts_style",option:{},style:{width:"100%",height:"100%"},onChartReady:function(e){return m(e)},onEvents:{click:d}}))};const S=a;a.propTypes={title:t().string,loading:t().bool,data:t().oneOfType([t().string,t().object]),dateRange:t().number,timeType:t().string,fTimeType:t().string,formulaType:t().string,fFormulaType:t().string,onFilterChange:t().func,onFlavorChange:t().func,onClick:t().func};const l=function(e){var t=e.loading,n=e.volumeData,a=e.timeType,i=e.fTimeType,r=e.formulaType,o=e.fFormulaType,l=e.negativeLoading,s=e.negativeVolData,c=e.negativeTimeType,u=e.fNegativeTimeType,d=e.negativeFormulaType,p=e.fNegativeFormulaType,m=e.positiveLoading,f=e.positiveVolData,h=e.positiveTimeType,v=e.fPositiveTimeType,g=e.positiveFormulaType,y=e.fPositiveFormulaType,T=e.dateRange,C=e.onVolumeClick,O=e.onFilterChange,E=e.onFlavorChange,e=e.onFilterReady;return _().createElement("div",{className:"yt_social_models_comparison_wrapper"},_().createElement(D.Z,{onChange:O,onReady:e,pageType:"SOCIAL_SERIES_COMPARE"}),_().createElement("div",{className:"content",id:"social_models_comparison_content"},_().createElement(S,{title:"舆情声量走势对比",dateRange:T,loading:t,data:n&&0<n.length&&b(n,a,r,"all"),timeType:{timeType:a},fTimeType:i,formulaType:r,fFormulaType:o,onFilterChange:O,onFlavorChange:E,onClick:function(e,t){return C(e,t,"all")}}),_().createElement(S,{title:"各机型负面声量对比图",dateRange:T,loading:l,data:s&&0<s.length&&b(s,c,d,"negative"),timeType:{negativeTimeType:c},fTimeType:u,formulaType:d,fFormulaType:p,onFilterChange:O,onFlavorChange:E,onClick:function(e,t){return C(e,t,"negative")}}),_().createElement(S,{title:"各机型正面声量对比图",dateRange:T,loading:m,data:f&&0<f.length&&b(f,h,g,"positive"),timeType:{positiveTimeType:h},fTimeType:v,formulaType:g,fFormulaType:y,onFilterChange:O,onFlavorChange:E,onClick:function(e,t){return C(e,t,"positive")}})))};var w=n(35239),Y=n(87219),s=n(64396).Z.social.models.comparison,n=function(t){function e(e){var g=t.call(this,e)||this;return g._handleOnFilterReady=function(e){g.props.fetchParams(v()({},e,{projectId:w.t.get(w.V.curProject).id,dateRange:e.dateFilter.numOfDays+Math.random()}))},g._handleOnVolumeClick=function(e,t,r){var n=e.componentType,a=e.seriesType,i=e.dataIndex,o=e.seriesName,l=e.name,s=g.props,c=s.projectId,u=s.filterValue,d=s.volumeData,p=s.timeType,m=s.negativeVolData,f=s.negativeTimeType,h=s.positiveVolData,v=s.positiveTimeType,e=u.some(function(e){return"VOC_ASPECT"===e.id})&&u.find(function(e){return"VOC_ASPECT"===e.id}).values,s=u.some(function(e){return"TAG_RULE"===e.id})&&u.find(function(e){return"TAG_RULE"===e.id}).values,u=u.some(function(e){return"DEFAULT"===e.id})&&u.find(function(e){return"DEFAULT"===e.id}),i=("bar"===a?d[i]:d.find(function(e){return e.name===o})).id,a="bar"===a?g.props.dateFilter:(0,Y.ZP)(g.props.dateFilter,function(e){var t="all"===r?p:"negative"===r?f:v,n="all"===r?d[0].dateList.map(function(e){return e.date}):"negative"===r?m[0].dateList.map(function(e){return e.date}):h[0].dateList.map(function(e){return e.date}),a=function(e,t){switch(t){case"HOUR":return{from:R()(e.replace("时","")).format("YYYY-MM-DD HH:00:00"),to:R()(e.replace("时","")).format("YYYY-MM-DD HH:59:59")};case"YEAR":var n=R()(e.replace("年",""));return{from:n.startOf("year").format("YYYY-MM-DD"),to:n.endOf("year").format("YYYY-MM-DD")};case"QUARTER":var a=e.split("第"),a=R()().year(a[0]).quarter(a[1].replace("季",""));return{from:a.startOf("quarter").format("YYYY-MM-DD"),to:a.endOf("quarter").format("YYYY-MM-DD")};case"MONTH":var i=R()(e,"YYYY-MM");return{from:i.startOf("month").format("YYYY-MM-DD"),to:i.endOf("month").format("YYYY-MM-DD")};case"WEEK":a=e.split("第"),i=a[0],a=a[1],a=R()().year(i).week(a.replace("周",""));return{from:a.startOf("week").format("YYYY-MM-DD"),to:a.endOf("week").format("YYYY-MM-DD")};case"DAY":default:return{from:e,to:e}}}(l,t),i=a.from,a=a.to;"DAY"!==t&&"HOUR"!==t&&(String(l)===String(n[0])?i=e.from:String(l)===String(n[n.length-1])&&(a=e.to)),e.from=i,e.to=a});"series"===n&&(i={dateFilter:a,projectId:c,filterModel:{brandsSeries:[{id:"series",special:"brandsSeries",values:[i]}],project:[w.t.get(w.V.curProject).id],messageType:["QUE_ANS_QUESTION","QUE_ANS_ANSWER","WEIBO","WEIBO_REPORT","COMMON_POST","NEWS_TEXT","COMPLAINT"],escore:"all"===r?["1","0","-1"]:"negative"===r?["-1"]:["1"]},filterTip:"舆情看板/机型分析/机型对比/"+("all"===r?"舆情声量走势对比":"negative"===r?"各机型负面声量对比图":"各机型正面声量对比图")},s&&(i.filterModel.tag=s.map(function(e){return{id:e.id,special:"tag",values:e.values}})),u&&u.values.some(function(e){return"SOURCE"===e.id})&&(i.filterModel.source=u.values.find(function(e){return"SOURCE"===e.id}).values),e&&(i.filterModel.vocAspect=(0,F.ou)(e)),window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(i))))},g._handleOnFilterChange=function(e){var t=g.props,n=t.save,a=t.fetchVolumeData,i=t.fetchNegativeVolumeData,t=t.fetchPositiveVolumeData;e.filterValue&&(JSON.stringify(e.dateFilter)!==JSON.stringify(g.props.dateFilter)?n(v()({},e,{dateRange:e.dateFilter.numOfDays+Math.random()})):(a(n=v()({},e,{filtedObjs:(0,F.ZT)(g.props,e)})),i(n),t(n))),(e.timeType||e.formulaType)&&a(v()({},e,{projectId:w.t.get(w.V.curProject).id})),(e.negativeTimeType||e.negativeFormulaType)&&i(v()({},e,{projectId:w.t.get(w.V.curProject).id})),(e.positiveTimeType||e.positiveFormulaType)&&t(v()({},e,{projectId:w.t.get(w.V.curProject).id}))},g._handleOnFlavorChange=function(e){g.props.updateFlavors(e)},g.state={},g.event={onVolumeClick:g._handleOnVolumeClick,onFilterReady:g._handleOnFilterReady,onFilterChange:g._handleOnFilterChange,onFlavorChange:g._handleOnFlavorChange},g}o()(e,t);var n=e.prototype;return n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return _().createElement(l,v()({},this.props,this.state,this.event))},e}(_().PureComponent);const c=(0,r.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return v()({},e[s],{loading:t.effects[s+"/fetchVolumeData"]||!1,negativeLoading:t.effects[s+"/fetchNegativeVolumeData"]||!1,positiveLoading:t.effects[s+"/fetchPositiveVolumeData"]||!1})},function(t){return{fetchParams:function(e){return t({type:s+"/fetchParams",payload:e})},updateFlavors:function(e){return t({type:s+"/updateFlavors",payload:e})},fetchVolumeData:function(e){return t({type:s+"/fetchVolumeData",payload:e})},fetchNegativeVolumeData:function(e){return t({type:s+"/fetchNegativeVolumeData",payload:e})},fetchPositiveVolumeData:function(e){return t({type:s+"/fetchPositiveVolumeData",payload:e})},save:function(e){return t({type:s+"/save",payload:e})},clean:function(e){return t({type:s+"/clean",payload:e})}}})(n)},83680:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var a=n(85354),i=n.n(a),r=n(67294),c=n.n(r),t=n(45697),a=n.n(t),o=n(35239),t=n(94184),u=n.n(t),l=[{name:"按天",id:"DAY"},{name:"按周",id:"WEEK"},{name:"按月",id:"MONTH"},{name:"按季",id:"QUARTER"},{name:"按年",id:"YEAR"}],s=function(n){function e(e){var t=Object.prototype.hasOwnProperty.call(e,"dateRange"),i=n.call(this,e)||this;return i.handleToggleDisplay=function(e){var t=i.state.panelShow;setTimeout(function(){return i.setState({panelShow:!t})},0)},i.handleParentClick=function(e){i.state.panelShow&&i.props.showFlavor&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},i.handleCollapse=function(){return i.setState({panelShow:!1})},i.handleSwitchValue=function(t){var e,n=i.state.dateOptions,a=i.props.onChange;t!==i.state.value&&(e=(0<n.filter(function(e){return e.id===t}).length?n.filter(function(e){return e.id===t}):n)[0].id,i.setState({value:t},function(){return a&&a(e)}))},i.DATE_DIMENSIONS=t?[{id:"HOUR",name:"按时"}].concat(l):l,i.state={value:"",dateRange:parseInt(e.dateRange),dateOptions:t?[{id:"HOUR",name:"按时"}].concat(l):l,panelShow:!1},i}i()(e,n);var t=e.prototype;return t.componentDidMount=function(){var e=this.props,t=(e.uniqueId,e.dateRange),n=e.onChange,e=this.state.value;this.projectId=o.t.get(o.V.curProject).id,window.addEventListener("click",this.handleCollapse),Object.prototype.hasOwnProperty.call(this.props,"dateRange")?this.getCurrDateOptions(parseInt(t)):n&&n(e)},t.componentWillUnmount=function(){window.removeEventListener("click",this.handleCollapse)},t.componentDidUpdate=function(e,t){var n=this,a=this.props,i=a.dateRange,a=a.defaultValue;e.dateRange!==i&&this.setState({dateRange:parseInt(i)},function(){return n.getCurrDateOptions(parseInt(i))}),e.defaultValue!==a&&this.setState({value:a})},t.getCurrDateOptions=function(e,t){var n,a,i,r,o,l,s;1<=e&&(l=this.props,n=l.onChange,a=l.noHour,i=l.collectValue,r=l.defaultValue,o=this.DATE_DIMENSIONS,l=[],s="",s=1===e?(l=o.slice(a?1:0,a?2:1),(a?o.filter(function(e){return"按天"===e.name}):o.filter(function(e){return"按时"===e.name}))[0].id):1<e&&e<=7?(l=o.slice(a?1:0,a?3:2),o.filter(function(e){return"按天"===e.name})[0].id):7<e&&e<=30?(l=o.slice(a?1:0,a?4:3),o.filter(function(e){return"按天"===e.name})[0].id):30<e&&e<=60?(l=o.slice(1,a?5:4),o.filter(function(e){return"按天"===e.name})[0].id):60<e&&e<=180?(l=o.slice(1,a?5:4),o.filter(function(e){return"按周"===e.name})[0].id):(l=o.slice(1,a?6:5),o.filter(function(e){return"按月"===e.name})[0].id),l.some(function(e){return e.id===i})?s=i:t&&l.some(function(e){return e.id===r})&&(s=r),this.setState({dateOptions:l,value:s},function(){n&&n(s)}))},t.render=function(){var a=this,e=this.props,t=e.style,i=e.showFlavor,r=e.collectValue,o=e.updateCollectValue,n=this.state,l=n.dateOptions,s=n.value,e=n.panelShow,n=l.filter(function(e){return e.id===s})[0]&&l.filter(function(e){return e.id===s})[0].name;return c().createElement("div",{className:"date_dimension_selector_wrapper",style:t,onClick:this.handleParentClick},c().createElement("div",{className:e?"date_dimension_btn active":"date_dimension_btn",onClick:this.handleToggleDisplay},c().createElement("span",null,n),c().createElement("i",{className:"icon icon-cem_arrow-launches",style:{transform:e?"rotate(-180deg)":""}})),c().createElement("ul",{className:"date_dimension_panel",style:{display:e?"inline-block":"none"}},l.map(function(e){var t=e.name,n=e.id;return c().createElement("li",{className:u()(s===n?"date_dimension_item active":"date_dimension",i&&"flavor_style"),key:n,onClick:function(){return a.handleSwitchValue(n)}},c().createElement("span",null,t),c().createElement("i",{className:r===n?"icon-cem_star stared":"icon-cem_star",onClick:function(e){e.stopPropagation(),o(n===r?"":n)}}))})))},e}(r.Component);s.propTypes={noHour:a().bool,dateRange:a().number,defaultValue:a().oneOf(["HOUR","DAY","WEEK","MONTH","QUARTER","YEAR"]),onChange:a().func.isRequired,style:a().object,collectValue:a().string,updateCollectValue:a().func}},24062:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var t=n(85354),a=n.n(t),t=n(67294),f=n.n(t),t=n(45697),t=n.n(t),i=n(39432),h=n(43036),n=function(t){function e(e){var n=t.call(this,e)||this;return n.getPanelWidth=function(){var e=n.props,t=e.flavor,e=e.options,e=Math.max.apply(null,e.map(function(e){return(0,i.jD)(e.title,14)}))+2+10+32;return 100<(e+=void 0!==t?24:0)?e:100},n._setPadShowFalse=function(){n.state.show&&n.setState({show:!1})},n._handleParentClick=function(e){n.state.show&&n.props.showFlavor&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},n._handleTriggerOnClick=function(){var e=n.state.show;setTimeout(function(){n.setState({show:!e})},0)},n.state={show:!1,firstLiHover:!1,panelWidth:n.getPanelWidth()},n}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},n.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},n.componentDidUpdate=function(e){var t=e.options,e=this.props.options;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({panelWidth:this.getPanelWidth()})},n.render=function(){var e=this.state,t=e.show,n=e.panelWidth,a=this.props,i=a.activeObj,r=void 0===i?"":i,o=a.onChange,l=a.options,s=a.objName,c=a.preTitle,u=a.sufTitle,d=void 0===u?"":u,e=a.showTitle,i=void 0===e||e,u=a.overlay,e=a.divider,e=void 0===e?"right":e,p=a.flavor,m=a.onFlavorChange,a=l.find(function(e){return e.value===r}),a=""===r?d:a&&a.title;return f().createElement("div",{className:"single_select_button_wrapper single_select_diviver_"+e,onClick:this._handleParentClick},f().createElement("div",{className:"button_content"},f().createElement("span",{onClick:this._handleTriggerOnClick},f().createElement("span",{className:"button-trigger "+(t?"sel":"")},i&&f().createElement(f().Fragment,null,c&&f().createElement("span",{className:"pre-title"},c,"："),f().createElement("span",{className:"button-title"},a)),f().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),u&&f().createElement("span",{style:{marginLeft:4}},f().createElement(h.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:u},f().createElement("i",{className:"icon-cem_file1"})))),f().createElement("div",{className:"button-panel "+(t?"active":""),style:{minWidth:n}},l.map(function(n,e){return f().createElement("div",{className:"panel-item "+(n.value===r?"sel":"")+" "+(n.disabled?"disabled":""),key:n.value,onClick:function(){var e;n.disabled||o(s?((e={})[s]=n.value,e):n.value)}},n.title,f().createElement("i",{className:p===n.value?"icon-cem_star":"icon-cem_star-filling star_hide",onClick:function(e){var t;e.stopPropagation(),m(p===n.value?((t={})[s]="",t):((t={})[s]=n.value,t))}}))}))))},e}(f().PureComponent);n.propTypes={activeObj:t().any,onChange:t().func.isRequired,options:t().array.isRequired,objName:t().any,preTitle:t().string,sufTitle:t().string,showTitle:t().bool,overlay:t().string,divider:t().oneOf(["both","left","right"]),flavor:t().string,onFlavorChange:t().func};const r=n}}]);