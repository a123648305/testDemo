(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8577],{12319:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-793b65"},87569:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-386841"},521:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-068d63"},23318:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-35b064"},64313:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-3d3186"},8332:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-885c5e"},58577:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var a=n(37316),l=n.n(a),r=n(67154),T=n.n(r),t=n(85354),o=n.n(t),S=n(67294),_=n.n(S),a=n(55609),c=n(30133);const i=function(){return _().createElement("div",{className:"yt-aspect-warning-page-skeleton-wrapper"},_().createElement(c.Z,{paragraph:["30%","80%"]}),_().createElement("div",{className:"awp-skeleton-content"},_().createElement("div",{className:"awp-list-warpper"},_().createElement(c.Z,{paragraph:["30%","80%"]}),[1,2,3,4,5].map(function(e){return _().createElement(c.Z,{key:e,paragraph:["100%","100%"]})}))))};var s,k=n(61918),N=n(55815),w=n(66165),P=n(92360);const C=function(e){var t=e.onChange,n=_().useState("添加标签"),a=n[0],l=n[1],e=_().useState(!1),n=e[0],r=e[1];return _().useEffect(function(){}),_().createElement("div",{className:"yt-editable-input",onClick:function(){s&&s.focus(),r(!0),l("")}},_().createElement(P.Input,{ref:function(e){return s=e},value:a,disabled:!n,placeholder:"输入标签(Enter确认)",onChange:function(e){return l(e)},onBlur:function(){r(!1),l("添加标签")},onKeyPress:function(e){"Enter"===e.key&&(r(!1),l("添加标签"),t(a))}}))};var x=n(43036),O=n(5133),L=void 0;const y=function(e){var t,n,a,l=e.data,r=l.name,o=l.type,c=e.onCheck,l=e.onDelete,i=e.onUpdate,s=e.checked,u=e.allData,e=_().useState(s),d=e[0],m=e[1],e=_().useState(!0),p=e[0],g=e[1],e=_().useState(r),f=e[0],h=e[1],e=_().useState(!1),v=e[0],E=e[1],e=_().useState(void 0),C=e[0],y=e[1],e=_().useState(!1),b=e[0],S=e[1],e=_().useState({controlStyle:{},editStyle:{},deleteStyle:{}}),k=e[0],N=e[1];return _().useEffect(function(){m(s)},[s]),_().createElement("label",{className:"el-checkbox yt-editable-checkbox",onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),!v&&p&&(L=setTimeout(function(){L&&clearTimeout(L);var e=!d;m(e),c(e)},100))}},_().createElement("span",{className:"el-checkbox__input "+(d?"is-checked":"")},_().createElement("span",{className:"el-checkbox__inner"}),_().createElement("input",{className:"el-checkbox__original",type:"checkbox"})),_().createElement("input",{value:f,className:"ec-label",readOnly:p,ref:function(e){return y(e)},onBlur:function(){setTimeout(function(){g(!0),b&&k.deletePopoverStyle.visible||(S(!1),k.controlStyle.display&&(N({controlStyle:{},editStyle:{},deletePopoverStyle:{}}),h(r)))},100)},onChange:function(e){e=e.target;h(e.value)},onKeyPress:function(e){"Enter"===e.key&&(f?u.find(function(e){return e.name===f})?O.Z.error("标签不能重复"):(g(!0),N({controlStyle:{},editStyle:{},deletePopoverStyle:{}}),i(f)):O.Z.error("标签不能为空"))},style:{background:p?"transparent":"#E9EAEC"}}),"CUSTOM"===o?_().createElement("span",{className:"ec-control",style:k.controlStyle},!p&&_().createElement(x.Z,{placement:"top",overlay:"确定"},_().createElement("i",{onMouseDown:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),f?u.find(function(e){return e.name===f})?O.Z.error("标签不能重复"):(g(!0),N({controlStyle:{},editStyle:{},deletePopoverStyle:{}}),i(f)):O.Z.error("标签不能为空")},style:{fontWeight:"normal"},className:"icon-cem_complete"})),p&&_().createElement(x.Z,{placement:"top",overlay:"编辑"},_().createElement("i",{className:"icon-cem_screening-editor",onMouseOver:function(){return E(!0)},onMouseOut:function(){return E(!1)},style:k.editStyle,onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),setTimeout(function(){C&&C.focus(),N({controlStyle:{display:"inline"},editStyle:{visibility:"hidden"},deletePopoverStyle:{}}),g(!1)},110)}})),_().createElement(x.Z,T()({placement:"top",overlay:p?b?(t=l,n=N,a=S,_().createElement("div",{className:"yt-editable-checkbox-delete-wrapper",onMouseLeave:function(){a(!1),n({controlStyle:{},editStyle:{},deletePopoverStyle:{}})}},_().createElement("span",null,"确定删除该标签？"),_().createElement("div",{className:"ecd-button-zone"},_().createElement("span",{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),setTimeout(function(){t(),a(!1),n({controlStyle:{},editStyle:{},deletePopoverStyle:{}})},0)}},"确定"),_().createElement("span",{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),setTimeout(function(){a(!1),n({controlStyle:{},editStyle:{},deletePopoverStyle:{}})},0)}},"取消")))):"删除":"取消"},k.deletePopoverStyle),_().createElement("i",{className:"icon-cem_delete",onMouseOver:function(){return E(!0)},onMouseOut:function(){return E(!1)},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),setTimeout(function(){C&&C.focus(),k.controlStyle.display?(N({controlStyle:{},editStyle:{},deletePopoverStyle:{}}),h(r)):(N({controlStyle:{display:"inline"},editStyle:{visibility:"hidden"},deletePopoverStyle:{visible:!0}}),S(!0))},110)}}))):"")};var u=void 0;const b=function(e){var t=e.keyword,n=e.onCloseClick,a=e.onChange,l=_().useState(t),e=l[0],r=l[1];return _().useEffect(function(){r(t)},[t]),_().createElement(P.Input,{placeholder:"请输入关键字",value:e,icon:e&&"close",onIconClick:function(){r(""),n()},onChange:function(e){r(e),u&&clearTimeout(u),u=setTimeout(function(){a(e),u=void 0},500)}})};const d=function(e){var t=e.show,n=e.loading,a=e.preTitle,l=e.onClick,r=e.data,o=e.value,c=e.onTagAdd,i=e.onTagDelete,s=e.onTagUpdate,u=e.onChange,d=e.keyword,m=e.getTagListRef,p=0===o.length||r&&r.length===o.length?"全部":r&&o.map(function(t){return r.find(function(e){return e.id===t}).name}).join(","),g=r&&r.length===o.length,e=_().useState(""),f=e[0],h=e[1],e=_().useState(r),v=e[0],E=e[1];_().useEffect(function(){var e=f?r.filter(function(e){return e.name.includes(f)}):r;E(e)},[f,r]);return _().createElement("div",{className:"yt-editable-tag-selector-wrapper "+(t?"yt-editable-tag-selector-wrapper-show":"")},_().createElement("div",{className:"ets-trigger",onClick:l},a&&_().createElement("span",{className:"ets-trigger-pre-title"},a,"："),_().createElement("span",{className:"ets-trigger-title"},p),_().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),_().createElement("div",{className:"ets-option-panel "+(t?"ets-show":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},_().createElement("div",{className:"ets-list",ref:m},_().createElement(P.Loading,{loading:n,style:{height:260}},r?_().createElement(_().Fragment,null,_().createElement("div",{className:"ets-search"},_().createElement(b,{keyword:f,onChange:h,onCloseClick:function(){return h("")}})),_().createElement("div",{className:"ets-list-content"},v.reduce(function(e,n){return e.push(_().createElement(y,{key:n.id,allData:v,data:n,onDelete:function(){return i(n)},onUpdate:function(e){return s(n.id,e)},checked:g||o.includes(n.id),onCheck:function(e){var t;t=n.id,u(e?o.concat([t]):o.filter(function(e){return e!==t}))}})),e},[d?null:_().createElement(P.Checkbox,{className:"ets-all-checkbox",checked:g,key:"all",onChange:function(e){u(e?r.map(function(e){return e.id}):[])}},"全选")]))):"暂无数据")),_().createElement("div",{className:"ets-add"},_().createElement("div",{className:"ets-add-diviver"}),_().createElement(C,{onChange:c}))))};var r=n(64396),m=r.Z.research.npsContacts,t=function(t){function e(e){var n=t.call(this,e)||this;return n._setPadShowFalse=function(){n.state.show&&n.setState({show:!1,keyword:""})},n._handleOnClick=function(e){var t=n.state.show;t&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){n.setState({show:!t})},0)},n._handleOnTagAdd=function(e){n.tagListRef&&(n.tagListRef.scrollTop=n.tagListRef.scrollHeight),n.props.addTag({name:e})},n._handleOnTagDelete=function(e){n.props.deleteTag(e),O.Z.success("删除成功")},n._handleOnTagUpdate=function(e,t){n.props.updateTag({id:e,name:t})},n.tagListRef=void 0,n.state={show:!1},n.event={onClick:n._handleOnClick,onTagAdd:n._handleOnTagAdd,onTagDelete:n._handleOnTagDelete,onTagUpdate:n._handleOnTagUpdate,getTagListRef:function(e){return n.tagListRef=e}},n}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},n.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},n.render=function(){return _().createElement(d,T()({},this.props,this.state,this.event))},e}(_().PureComponent);const A=(0,a.connect)(function(e){var t=e.loading,e=l()(e,["loading"]);return{data:e[m].tagList,value:e[m].contactsData.fetchParams.tags,loading:t.effects[m+"/fetchTagList"]}},function(t){return{deleteTag:function(e){return t({type:m+"/deleteTag",payload:e})},updateTag:function(e){return t({type:m+"/updateTag",payload:e})},addTag:function(e){return t({type:m+"/addTag",payload:e})}}})(t);function p(e,t){return e?_().createElement(x.Z,{placement:"top",overlay:t},_().createElement("span",{className:"col-nps-contact-invalid"},_().createElement("i",{className:"icon-cem_invalid-save"}))):""}var g=n(71339),f=n(61193);const D=function(e){var t=e.option,n=t.width,a=t.height,l=e.onClick,r=e.delExcArr,o=e.delAllChecked,t=e.onCheckboxChange;return _().createElement("div",{className:"nps-contacts-list",style:{height:a}},_().createElement(g.Z,T()({},e,{columns:function(e,n,a,t,l){var e=e-5-24-40-16-64-16-160-160,r=f.Z.hasAuthority("NPS_CONTACT_VISIBLE"),o=r||f.Z.hasAuthority("NPS_CONTACT_HALF_VISIBLE");o&&(e-=100);e=[{label:"",width:16},{label:_().createElement("span",{className:"col-del"},_().createElement(P.Checkbox,{checked:a,onChange:l},"全选")),width:64,render:function(t){return _().createElement("span",{className:"col-del"},_().createElement(P.Checkbox,{checked:a&&!n.includes(t.id)||!a&&n.includes(t.id),onChange:function(e){return l(e,t.id)}}))}},{label:"姓名",prop:"name",width:160},{label:"邮箱",prop:"email",width:.25*e,render:function(e){var t=e.email,n=e.status,a=n&&n.includes("INVALID_EMAIL"),e=t;return r||(e=(n=t&&t.includes("@")?t.split("@"):"")&&n[0].substring(0,4)+"*****@"+n[1]),_().createElement("span",{className:a?"col-nps-invalid":""},_().createElement(x.Z,{placement:"top",overlay:o?t:e},_().createElement("span",{className:"col-nps-contact-invalid"},e)),p(a,"此邮箱为无效邮箱，无法接收邮件"))}},{label:"手机",prop:"phoneNumber",width:160,render:function(e){var t=e.phoneNumber,n=e.status,e=n&&n.includes("INVALID_PHONE_NUMBER"),n=t;return r||(n=t?t.substring(0,3)+"*****"+t.substring(8):""),_().createElement("span",{className:e?"col-nps-invalid":""},_().createElement(x.Z,{placement:"top",overlay:o?t:n},_().createElement("span",{className:"col-nps-contact-invalid"},n)),p(e,"此手机号码为无效手机，无法接收短信"))}},{label:"标签",prop:"tags",width:.75*e,render:function(e){e=e.tags;return _().createElement("div",{className:"col-nps-contact-tags"},e.reduce(function(e,t,n,a){return t.name&&(n<5?e.push(_().createElement(x.Z,{placement:"top",overlayClassName:"popup-tags",overlay:t.name},_().createElement("span",{key:t.id,title:t.name,className:"tag"},6<t.name.length?t.name.substring(0,6)+"...":t.name))):5===n&&e.push(_().createElement(x.Z,{overlayClassName:"popup-tags",overlay:a.slice(5).map(function(e){return _().createElement("span",{key:e.id,title:e.name,style:{userSelect:"none"}},e.name)}),placement:"top"},_().createElement("span",{key:"more"},"...")))),e},[]))}},{label:"",width:16}];return o&&e.splice(e.length-1,0,{label:"操作",width:100,render:function(e){return _().createElement("span",{className:"col-nps-contact-control"},_().createElement("span",{onClick:function(){return t("edit",e)}},"编辑"),_().createElement("span",{onClick:function(){return t("delete",e)}},"删除"))}}),e}(n,r,o,l,t)})))};var h=n(35303),v={name:[{validator:function(e,t,n){""===t&&n(new Error("请输入联系人姓名")),n()}}],phoneNumber:[{validator:function(e,t,n){t&&!/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/.test(t)?n(new Error("手机号码格式不正确")):n()},trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],tags:[]};const I=function(t){function e(e){var o=t.call(this,e)||this;return o.showDialog=function(e){o.state.visible?o.setState({visible:!1,callback:void 0,contact:void 0,type:""},function(){o.setState(T()({visible:!0},e))}):o.setState(T()({visible:!0},e))},o.renderTitle=function(e){return"add"===e?"新增联系人":"edit"===e?"编辑联系人":"delete"===e?"确定删除联系人？":"tag"===e?"批量添加标签":void 0},o._handleOnChange=function(e){var t=o.state.contact;o.setState({contact:T()({},t,e)})},o.renderBody=function(e,t){var n=o.props,a=n.tags,l=n.addedTags,r=n.onTagsChange;return"add"===e||"edit"===e?_().createElement(P.Form,{ref:function(e){return o.formRef=e},model:t,rules:v,labelWidth:"98",className:"cd-from-body"},_().createElement(P.Form.Item,{prop:"name",label:"联系人姓名"},_().createElement(P.Input,{value:t.name,onChange:function(e){return o._handleOnChange({name:e})}})),_().createElement(P.Form.Item,{prop:"email",label:"邮箱"},_().createElement(P.Input,{value:t.email,onChange:function(e){return o._handleOnChange({email:e})}})),_().createElement(P.Form.Item,{prop:"phoneNumber",label:"手机号"},_().createElement(P.Input,{maxLength:11,value:t.phoneNumber,onChange:function(e){return o._handleOnChange({phoneNumber:e})}})),_().createElement(P.Form.Item,{prop:"tags",label:"标签"},_().createElement(h.RS,{multiple:!0,value:t.tags.map(function(e){return e.name}),onChange:function(e){return o._handleOnChange({tags:e.map(function(e){return{name:e}})})}},a.map(function(e){return _().createElement(h.Wx,{key:e.id,label:e.name,value:e.name},e.name)})))):"delete"===e?_().createElement("span",{className:"cd-delete"},"删除后，不会删除已回收与之相关的答卷"):"tag"===e?_().createElement("div",{className:"add-tag"},_().createElement("label",null,"标签"),_().createElement(h.RS,{tags:!0,tokenSeparators:[" ",","],placeholder:"请选择或输入标签",value:l,onChange:function(e){return r(e.filter(function(e){return 0<e.trim().length}))}},a.map(function(e){return _().createElement(h.Wx,{key:e.id,label:e.name,value:e.name},e.name)}))):void 0},o._handleOnCancel=function(){o.setState({visible:!1,callback:void 0,contact:void 0,type:""})},o._handleOnConfrim=function(){var e=o.state,t=e.callback,n=e.contact,a=e.type;"delete"===a||"tag"===a?(o.setState({visible:!1,callback:void 0,contact:void 0,type:""}),t&&t(a,n)):o.formRef.validate(function(e){return n.email||n.phoneNumber?void(e&&(t&&t(a,n),o.setState({visible:!1,callback:void 0,contact:void 0,type:""}))):(O.Z.error("手机号码和邮箱请至少填充一项"),!1)})},o.state={visible:!1,type:"",callback:void 0,contact:void 0},o}return o()(e,t),e.prototype.render=function(){var e=this.state,t=e.visible,n=e.type,e=e.contact;return _().createElement(P.Dialog,{className:"delete"===n?"simple-dialog-wrapper simple-dialog-warning":"yt-contact-dialog-wrapper",size:"tiny",visible:t,title:this.renderTitle(n),closeOnClickModal:!1,onCancel:this._handleOnCancel},_().createElement(P.Dialog.Body,null,this.renderBody(n,e)),_().createElement(P.Dialog.Footer,null,_().createElement(P.Button,{onClick:this._handleOnCancel},"取消"),_().createElement(P.Button,{type:"primary",onClick:this._handleOnConfrim},"确定")))},e}(_().PureComponent),Z=function(t){function e(e){var n=t.call(this,e)||this;return n.showDialog=function(e){n.state.visible?n.setState({visible:!1,callback:void 0},function(){n.setState(T()({visible:!0},e))}):n.setState(T()({visible:!0},e))},n._handleOnCancel=function(){n.setState({visible:!1,data:void 0,callback:void 0})},n._handleOnConfrim=function(){var e=n.state,t=e.callback,e=e.data;t&&t(e),n.setState({visible:!1,data:void 0,callback:void 0})},n.state={visible:!1,data:void 0,callback:void 0},n}return o()(e,t),e.prototype.render=function(){var e=this.state.visible;return _().createElement(P.Dialog,{className:"yt-nps-template-delete-dialog-wrapper",size:"tiny",visible:e,title:"确认要删除这些联系人吗？",closeOnClickModal:!1,onCancel:this._handleOnCancel},_().createElement(P.Dialog.Body,null,"删除后，不会删除已回收与之相关的答卷"),_().createElement(P.Dialog.Footer,null,_().createElement(P.Button,{onClick:this._handleOnCancel},"取消"),_().createElement(P.Button,{type:"primary",onClick:this._handleOnConfrim},"确定")))},e}(_().PureComponent);const E=function(e){var t=e.loading,n=e.data,a=n.total,l=n.list,r=e.tags,o=e.contentWidth,c=e.pageIndex,i=e.pageSize,s=e.keyword,u=e.delExcArr,d=e.delAllChecked,m=e.addedTags,p=e.onContactAddSuccess,g=e.onSearch,f=e.onTagChange,h=e.onPageSizeChange,v=e.onPageChange,E=e.onBtnClick,C=e.onAllDelClick,y=e.getContactDialogRef,b=e.onCheckboxChange,n=e.onTagsChange,e=e.gtDeleteDialogRef;return _().createElement("div",{className:"yt-nps-contacts-page-warpper"},_().createElement(N.Z,{title:"联系人",rightContent:_().createElement("span",{style:{display:"flex"}},d||0<u.length?_().createElement(S.Fragment,null,_().createElement(P.Button,{onClick:function(){return E("tag")}},"批量添加标签"),_().createElement(P.Button,{style:{margin:"0 10px"},onClick:C},"批量删除")):null,_().createElement(w.ZP,{onAdd:p,onBatchAdd:p}))}),_().createElement("div",{className:"yt-nps-contacts-content-wrapper"},_().createElement("div",{className:"content"},_().createElement("div",{className:"filter-wrapper"},_().createElement(k.Z,{style:{width:200},placeholder:"姓名、邮箱、手机",defValue:s,onSearch:g}),_().createElement(A,{preTitle:"标签",onChange:f})),_().createElement(D,{data:l,total:a,delAllChecked:d,delExcArr:u,pageIndex:c,pageSize:i,loading:t,onClick:E,onCheckboxChange:b,option:{width:o},onPageSizeChange:h,onPageChange:v}))),_().createElement(I,{ref:y,tags:r,addedTags:m,onTagsChange:n}),_().createElement(Z,{ref:e}))};const R=function(e){var t=e.initLoading,n=e.data;return _().createElement("div",{id:"nps-content",style:{height:"100%"}},t||!n?_().createElement(i,null):_().createElement(E,e))};var B=r.Z.research.npsContacts,r=function(t){function e(e){var c=t.call(this,e)||this;return c._handleWindowResize=function(){c.setState({contentWidth:document.getElementById("nps-content").offsetWidth})},c._handleOnContactAddSuccess=function(){c.props.fetchContactsList({pageIndex:1}),c.props.fetchTagList()},c._handleOnSearch=function(e){var t=c.props,n=t.delAllChecked,t=t.fetchContactsList;n&&c._handleOnCheckboxChange(!1),t({keyword:e,pageIndex:1})},c._handleOnTagChange=function(e){var t=c.props,n=t.delAllChecked;(0,t.fetchContactsList)({tags:e,pageIndex:1}),n&&c._handleOnCheckboxChange(!1)},c._handleOnPageSizeChange=function(e){return c.props.fetchContactsList({pageSize:e,pageIndex:1})},c._handleOnPageChange=function(e){return c.props.fetchContactsList({pageIndex:e})},c._handleOnBtnClick=function(e,t){var n=c.props,a=n.addContact,l=n.deleteContact,r=n.updateContact,o=n.tagContacts;"add"!==e&&"edit"!==e&&"delete"!==e&&"tag"!==e||c.contactDialog.showDialog({contact:t||{name:"",phoneNumber:"",email:"",tags:[]},type:e,callback:function(e,t){"add"===e?a(T()({},t,{tags:t.tags.map(function(e){return e.name})})):"edit"===e?r(T()({},t,{tags:t.tags.map(function(e){return e.name})})):"delete"===e?l(t):"tag"===e&&o()}})},c._handleOnCheckboxChange=function(e,t){var n=c.props,a=n.delExcArr,l=n.updateDelArr,n=n.delAllChecked;l(t?{delExcArr:n?e?a.filter(function(e){return e!==t}):a.concat([t]):e?a.concat([t]):a.filter(function(e){return e!==t})}:{delAllChecked:e,delExcArr:[]})},c._handleOnAllDelClick=function(){c.deleteDialog.showDialog({callback:function(){c.props.deleteAllContact()}})},c._handleOnTagsChange=function(e){c.props.updateTags({addedTags:e})},c.contactDialog=void 0,c.state={},c.event={onContactAddSuccess:c._handleOnContactAddSuccess,onSearch:c._handleOnSearch,onTagChange:c._handleOnTagChange,onPageSizeChange:c._handleOnPageSizeChange,onPageChange:c._handleOnPageChange,onBtnClick:c._handleOnBtnClick,onCheckboxChange:c._handleOnCheckboxChange,onAllDelClick:c._handleOnAllDelClick,onTagsChange:c._handleOnTagsChange,gtDeleteDialogRef:function(e){return c.deleteDialog=e},getContactDialogRef:function(e){return c.contactDialog=e}},c}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.props.fetchTagList(),this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return _().createElement(R,T()({},this.props,this.state,this.event))},e}(_().PureComponent);const F=(0,a.connect)(function(e){var t=e.loading,e=l()(e,["loading"]);return T()({},e[B].contactsData.fetchParams,{tags:e[B].tagList,data:e[B].contactsData.data,delAllChecked:e[B].delAllChecked,delExcArr:e[B].delExcArr,initLoading:e[B].initLoading,loading:t.effects[B+"/fetchContactsList"]||!1,addedTags:e[B].addedTags})},function(t){return{fetchTagList:function(e){return t({type:B+"/fetchTagList",payload:e})},fetchContactsList:function(e){return t({type:B+"/fetchContactsList",payload:e})},addContact:function(e){return t({type:B+"/addContact",payload:e})},deleteContact:function(e){return t({type:B+"/deleteContact",payload:e})},updateContact:function(e){return t({type:B+"/updateContact",payload:e})},updateDelArr:function(e){return t({type:B+"/save",payload:e})},deleteAllContact:function(e){return t({type:B+"/deleteAllContact",payload:e})},clean:function(e){return t({type:B+"/clean",payload:e})},tagContacts:function(){return t({type:B+"/tagContacts"})},updateTags:function(e){return t({type:B+"/save",payload:e})}}})(r)},66165:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>y});var n=r(85354),a=r.n(n),l=r(67154),o=r.n(l),c=r(67294),i=r.n(c),s=r(45697),t=r.n(s),n=r(55609),u=r(92360),d=r(5133),m=r(36144),p=r(35303),l=r(64396),g=l.Z.research.addContact,s=function(t){function e(e){var a=t.call(this,e)||this;return a.onFormChange=function(e,t){var n;a.setState({form:o()({},a.state.form,((n={})[e]=t,n))})},a.commit=function(){a.form.validate(function(e){if(!a.props.required&&!a.state.form.email&&!a.state.form.phoneNumber)return d.Z.error("手机号码和邮箱请至少填充一项"),!1;if(e&&a.props.defaultValue)m.h.post("/contact/update",a.state.form).then(function(e){2e4===e.data.code&&(a.props.onCancel(),a.props.onAdd&&a.props.onAdd(a.state.form))});else{if(!e)return!1;m.h.post("/contact/add",a.state.form).then(function(e){2e4===e.data.code&&(a.setState({form:{name:"",email:"",phoneNumber:"",tags:[]}}),a.props.onCancel(),a.props.onAdd&&a.props.onAdd(e.data.result))})}})},a.state={form:a.props.defaultValue||{name:"",email:"",phoneNumber:"",tags:[]},rules:{phoneNumber:[{required:e.required&&e.required.includes("phone"),message:"请输入手机号",trigger:"blur"},{validator:function(e,t,n){t&&!/^1[3|4|5|7|8|9][0-9]{9}$/.test(t)?n(new Error("请输入正确手机号码")):n()},trigger:"blur"}],email:[{required:e.required&&e.required.includes("email"),message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]}},a}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.props.getTagList()},n.render=function(){var t=this,e=this.state,n=e.form,a=e.rules,e=this.props.onCancel,l=this.onFormChange;return i().createElement("div",{className:"np_add_contact_add"},i().createElement(u.Dialog,{className:"form",title:this.props.defaultValue?"编辑联系人":"新增联系人",visible:this.props.visible,onCancel:e},i().createElement(u.Dialog.Body,null,i().createElement(u.Form,{ref:function(e){return t.form=e},model:n,rules:a,labelPosition:"left",labelWidth:"86"},i().createElement(u.Form.Item,{label:"联系人姓名",prop:"name"},i().createElement(u.Input,{value:n.name,onChange:function(e){return l("name",e)}})),i().createElement(u.Form.Item,{label:"邮箱",prop:"email"},i().createElement(u.Input,{value:n.email,onChange:function(e){return l("email",e)}})),i().createElement(u.Form.Item,{label:"手机号",prop:"phoneNumber"},i().createElement(u.Input,{value:n.phoneNumber,onChange:function(e){return l("phoneNumber",e)}})),i().createElement(u.Form.Item,{label:"标签",prop:"tags"},i().createElement(p.RS,{className:"muti_select",tags:!0,tokenSeparators:[" ",","],onChange:function(e){return l("tags",e.filter(function(e){return 0<e.trim().length}))},value:n.tags,optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入标签后按回车"},(this.props.tagList||[]).map(function(e,t){return i().createElement(p.Wx,{key:t,value:e.name,label:e.name},e.name)}))))),i().createElement(u.Dialog.Footer,{className:"dialog-footer"},i().createElement(u.Button,{onClick:e},"取消"),i().createElement(u.Button,{type:"primary",onClick:this.commit},"确定"))))},e}(i().Component);const f=(0,n.connect)(function(e){e=o()({},e);return o()({},e[g])},function(t){return{getTagList:function(e){return t({type:g+"/getTagList",payload:e})}}})(s);s.propTypes={visible:t().bool,onAdd:t().func,onCancel:t().func,defaultValue:t().shape({id:t().string.isRequired,name:t().string,email:t().string,phoneNumber:t().oneOfType([t().string,t().number]),tags:t().array})};var s=r(81506),h=r.n(s),v={visible:!1,steps:1,file:null,tags:[],newTags:[],fileTest:!0,fileResult:null,dragenter:!1,uploading:!1},E=function(t){function e(e){var a=t.call(this,e)||this;return a.show=function(){a.state.visible?a.setState(o()({},Object.assign({},v))):a.setState({visible:!0})},a.dragInit=function(){var e=a.state.timer,t=h()(a).drag;document.addEventListener("dragover",function(){clearTimeout(e),e=setTimeout(function(){t.style.display="none"},200),a.setState({timer:e}),t.style.display="block"}),t.ondragenter=function(e){a.setState({dragenter:!0})},t.ondragover=function(){return!1},t.ondragleave=function(){a.setState({dragenter:!1})},t.ondrop=function(e){e=e.dataTransfer.files[0];return"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(d.Z.warning("只支持 xlsx 格式,请重新上传"),a.setState({fileTest:!1,dragenter:!1})):a.setState({file:e,fileTest:!0,dragenter:!1},function(e){}),!1}},a.readFile=function(e){e=e.target.files[0];"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(d.Z.warning("只支持 xlsx 格式,请重新上传"),a.setState({fileTest:!1})):a.setState({file:e,fileTest:!0},function(e){})},a.onFormChange=function(e,t){var n;a.setState({form:o()({},a.state.form,((n={})[e]=t,n))})},a.downLoadFile=function(){var e=document.createElement("a");e.style.display="none",e.href="https://yunting-1251101074.coscd.myqcloud.com/联系人模板.xlsx",document.body.appendChild(e),e.click(),e.remove()},a.upload=function(){a.setState({uploading:!0},function(){var t=a.xhr=new XMLHttpRequest;t.open("POST","/api/contact/import"),t.onreadystatechange=function(){var e;4===t.readyState&&(a.setState({steps:a.state.steps+1}),200===t.status?2e4===(e=JSON.parse(t.responseText)).code?(a.props.onBatchAdd&&a.props.onBatchAdd(e.result.successfulList),a.setState({fileResult:e.result,uploading:!1})):(a.setState({fileResult:null,uploading:!1}),d.Z.error(e.msg)):(a.setState({fileResult:null,uploading:!1}),d.Z.error("上传出错，请检查文件格式或联系管理员")))},t.upload.onprogress=function(e){e.lengthComputable&&(e=Math.floor(e.loaded/e.total*100),a.setState({percent:e}))},t.onabort=function(e){d.Z.error("上传已中断")};var e=new FormData;e.append("file",a.state.file),e.append("tags",JSON.stringify(a.state.tags)),e.append("newTags",JSON.stringify(a.state.newTags)),e.append("uploadType",a.props.uploadType||"ALL"),t.send(e)})},a.step1=function(){setTimeout(function(){return a.wrap.appendChild(a.drag)},10);var e=a.state,t=(e.steps,e.dragenter),n=e.fileTest,e=e.file;return i().createElement("div",null,i().createElement("div",{ref:function(e){return a.wrap=e},className:"wrap",style:{backgroundColor:t?"#e9eaec":"",borderColor:n?"":"red"}},i().createElement("input",{style:{display:"none"},ref:function(e){return a.file=e},accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",type:"file",onChange:function(e){return a.readFile(e)}}),!e&&i().createElement(c.Fragment,null,i().createElement("div",{className:"upload"},i().createElement("div",{className:"add",onClick:function(e){return a.file.click()}},i().createElement("i",{className:"icon-cem_upload-files"})),i().createElement("b",null,i().createElement("span",{onClick:function(e){return a.file.click()}},"点击"),"或将EXCEL文件拖拽到这里上传"),i().createElement("p",null,i().createElement("span",{onClick:function(e){return a.downLoadFile()}},"下载标准模板")),i().createElement("div",{className:"accept",style:{color:n?"":"#D96969"}},"（只支持 xlsx 格式）"))),e&&i().createElement("p",{className:"file_name"},i().createElement("img",{src:r(8332)}),i().createElement("div",null,e.name),i().createElement("span",{onClick:function(){return a.file.click()}},"重新上传"))))},a.step2=function(){var e=a.state,t=e.tags,e=e.newTags;return i().createElement("div",{className:"step2_wrap"},i().createElement("h3",null,"你可以给导入的「所有客户」打上标签"),i().createElement("div",null,i().createElement(p.RS,{className:"muti_select",tags:!0,tokenSeparators:[" ",","],onChange:function(e){return a.setState({tags:e.filter(function(e){return 0<e.trim().length})})},value:t,optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入标签后按回车"},(a.props.tagList||[]).map(function(e,t){return i().createElement(p.Wx,{key:t,value:e.name,label:e.name},e.name)}))),i().createElement("h3",null,"仅给导入的「新客户」打上标签"),i().createElement("div",null,i().createElement(p.RS,{className:"muti_select",tags:!0,tokenSeparators:[" ",","],onChange:function(e){return a.setState({newTags:e.filter(function(e){return 0<e.trim().length})})},value:e,optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入标签后按回车"},(a.props.tagList||[]).map(function(e,t){return i().createElement(p.Wx,{key:t,value:e.name,label:e.name},e.name)}))),i().createElement("p",null,"注：你可以跳过此步"))},a.step3=function(){var e=a.state.fileResult;a.props.uploadType;return i().createElement("div",{className:"step3_wrap"},i().createElement("i",{className:e?"icon-cem_complete1":"icon-cem_close-window",style:{color:e?"#15B374":"#D96969"}}),i().createElement("h3",null,e?"成功导入"+e.successfulCount+"个有效联系人":"上传失败，请再次尝试"),e&&a.getResultGraph(e),i().createElement("p",null,e?"系统已将这些联系人保存到联系人模块当中，方便你下次使用":"出现错误，上传失败，可以再次尝试"),!e&&i().createElement(u.Button,{type:"primary",onClick:function(){return a.setState({file:null,steps:1})}},"重新上传"))},a.getResultGraph=function(e){var t=e.onlyPhoneNumberCount,n=e.onlyEmailCount,a=e.successfulCount,l=e.failedCount,e=e.bothSuccessfulCount;return i().createElement("div",{className:"result-graph-wrapper"},i().createElement("div",{className:"description total"},i().createElement("img",{src:r(87569)}),i().createElement("div",null,i().createElement("div",null,"共导入"),i().createElement("div",null,a+l,"行"))),0<l&&i().createElement("div",{className:"description invalid"},i().createElement("img",{src:r(23318)}),i().createElement("div",null,i().createElement("div",null,"无效（导入不成功）"),i().createElement("div",null,l,"行"))),0<e&&i().createElement("div",{className:"description both"},i().createElement("div",null,i().createElement("div",null,"手机号+邮箱"),i().createElement("div",null,e,"行")),i().createElement("img",{src:r(521)})),0<t||0<e?i().createElement("div",{className:0<e?"ring valid-phoneNo collapse":"ring valid-phoneNo"},"手机号",0<t&&i().createElement("div",{className:"description phoneNo"},i().createElement("div",null,i().createElement("div",null,"仅手机号"),i().createElement("div",null,t,"行")),i().createElement("img",{src:r(64313)}))):null,0<n||0<e?i().createElement("div",{className:0<e?"ring valid-email collapse":"ring valid-email"},"邮箱",0<n&&i().createElement("div",{className:"description email"},i().createElement("div",null,i().createElement("div",null,"仅邮箱"),i().createElement("div",null,n,"行")),i().createElement("img",{src:r(12319)}))):null)},a.pre=function(){a.setState({steps:a.state.steps-1})},a.next=function(){a.setState({steps:a.state.steps+1})},a._handleOnCancel=function(){a.setState(o()({},Object.assign({},v)))},a.state=o()({},Object.assign({},v)),a}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.dragInit()},n.render=function(){var t=this,e=this.state,n=e.steps,a=e.file,l=e.visible,e=e.uploading;return i().createElement("div",{className:"np_add_contact_batch_add"},i().createElement(u.Dialog,{className:"form",title:"批量上传",visible:l,onCancel:this._handleOnCancel},i().createElement(u.Loading,{loading:e},i().createElement(u.Dialog.Body,null,i().createElement("header",null,i().createElement("div",{className:1===n?"sel":""},i().createElement("p",null,i().createElement("span",null,"1"),"选择表格")),i().createElement("div",{className:2===n?"sel":""},i().createElement("p",null,i().createElement("span",null,"2"),"打上标签")),i().createElement("div",{className:3===n?"sel":""},i().createElement("p",null,i().createElement("span",null,"3"),"导入结果"))),this["step"+n]()),i().createElement(u.Dialog.Footer,{className:"dialog-footer"},n<3&&i().createElement(u.Button,{onClick:1===n?this._handleOnCancel:this.pre},1===n?"取消":"上一步"),i().createElement(u.Button,{type:"primary",disabled:!a||3<n||e,onClick:3===n?this._handleOnCancel:2===n?this.upload:this.next},3===n?"确定":2===n?"确定上传":"下一步")))),i().createElement("div",{ref:function(e){return t.drag=e},className:"drag",style:{zIndex:1===n?"":"-1"}}))},e}(i().Component);E.propTypes={};var C=l.Z.research.addContact,l=function(t){function e(e){e=t.call(this,e)||this;return e.state={visible:!1,batchVisible:!1},e}return a()(e,t),e.prototype.render=function(){var t=this,e=this.state,n=e.visible;e.batchVisible;return i().createElement("div",{className:"np_add_contact"},i().createElement(u.Button,{onClick:function(){return t.setState({visible:!0})}},"新增客户"),i().createElement(u.Button,{type:"/nps/contact"===location.pathname?"primary":"",onClick:function(){t.batchRef.show()}},"批量导入"),i().createElement(f,o()({},this.props,{visible:n,onCancel:function(){return t.setState({visible:!1})}})),i().createElement(E,o()({ref:function(e){return t.batchRef=e}},this.props)))},e}(i().Component);const y=(0,n.connect)(function(e){e=o()({},e);return o()({},e[C])},function(t){return{getTagList:function(e){return t({type:C+"/getTagList",payload:e})}}})(l);l.propTypes={required:t().array,onAdd:t().func,onBatchAdd:t().func,uploadType:t().string}},25022:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),s=n.n(t),u=n(92360),d=n(35303),t=n(45697),t=n.n(t),m=[{label:"10项/页",value:10},{label:"20项/页",value:20},{label:"40项/页",value:40},{label:"100项/页",value:100}];const a=function(e){var t=e.onPageChange,n=e.onSizeChange,a=e.total,l=void 0===a?0:a,r=e.pageIndex,o=e.pageSize,c=e.layout,i=e.className,a=e.currLength,e=0===l?0:(r-1)*o+1,a=0===l?0:a?e+a-1:e+o-1;return 0===l?null:s().createElement("div",{className:"yt-awp-pagination "+(i||"")},s().createElement("span",{className:"total_num"},s().createElement("span",null,e+" - "+a+" "),"项，共",s().createElement("span",null," "+l+" "),"项"),s().createElement("div",{style:{textAlign:"right",float:"right"},className:"new_pagination"},s().createElement(u.Pagination,{small:!0,pageSize:o,currentPage:r,pageCount:Math.ceil(l/o),layout:0===l?"":"prev, pager, next",onCurrentChange:t}),void 0===c||c.includes("sizes")?s().createElement(d.RS,{multiple:!1,tags:!1,showSearch:!1,optionFilterProp:"label",optionLabelProp:"label",animation:"slide-up",dropdownClassName:"custom-pagination-dropdown",value:o||10,onChange:n},m.map(function(e,t){return s().createElement(d.Wx,{key:t,label:e.label,value:e.value},e.label)})):null))};t().propTypes={onPageChange:t().func,onSizeChange:t().func,total:t().number,pageIndex:t().number,pageSize:t().number,layout:t().string,className:t().string}},71339:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),d=n.n(t),m=n(92360),p=n(25022),t=n(45697),n=n.n(t),t=function(e){var t=e.data,n=e.total,a=void 0===n?0:n,l=e.loading,r=e.pageIndex,o=e.columns,c=e.pageSize,i=e.onPageChange,n=e.onPageSizeChange,s=e.onSortChange,u=e.defaultSort,e=e.className,e=void 0===e?"":e;return d().useEffect(function(){var e=document.getElementsByClassName("is-sortable")[0];u&&e&&e.classList.add(u.order)},[u]),d().createElement("div",{className:"yt-awp-content-list "+e},d().createElement(m.Loading,{loading:l,className:"awp-content-loading"},d().createElement(m.Table,{defaultSort:u,columns:o,style:{width:"100%"},data:t,onSortChange:function(e){return s(e)}})),i&&d().createElement(p.Z,{onPageChange:i,onSizeChange:n,total:a,currLength:t.length,pageIndex:r,pageSize:c}))};t.propTypes={data:n().array,total:n().number,loading:n().bool,pageIndex:n().number,columns:n().array,pageSize:n().number,onPageChange:n().func,onPageSizeChange:n().func,onSortChange:n().func,defaultSort:n().any,className:n().string};const a=t},61918:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),u=n.n(t),t=n(45697),n=n.n(t),t=function(e){var t=e.className,n=e.onClear,a=e.onSearch,l=e.placeholder,r=e.style,o=e.defValue,c=e.signal,e=u().useState(o),i=e[0],s=e[1];u().useEffect(function(){s(o)},[o,c]);return u().createElement("div",{style:r,className:"yt_search_input_wrapper "+(t||"")},u().createElement("input",{placeholder:l,value:i,onKeyDown:function(e){13===e.keyCode&&a(i)},onChange:function(e){return s(e.target.value)},autoComplete:"off"}),i&&u().createElement("i",{className:"icon-cem_log-off",onClick:function(){s(""),n&&n("")}}),u().createElement("i",{className:"icon-cem_small-search",onClick:function(){return a(i)}}))};t.propTypes={className:n().string,onSearch:n().func.isRequired,placeholder:n().string,style:n().object,defValue:n().string,signal:n().any,onClear:n().func};const a=t}}]);