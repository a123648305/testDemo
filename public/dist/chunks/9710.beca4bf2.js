(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[9710],{84849:(e,n,t)=>{"use strict";t.d(n,{e:()=>function(l){return new Promise(function(e,n){var t=l.value||{},a=o()({},l,{titleText:"偏好设置",content:s().createElement(r,o()({},l,{getValue:function(e){t=e}})),top:"50%"});a.onOk=function(){return e(t)},a.onCancel=n,(0,i.Z)(a)})}});var a=t(67154),o=t.n(a),n=t(67294),s=t.n(n),a=t(45697),n=t.n(a),a=t(2258),u=t.n(a),m=t(92360),p=t(43036),d=[{value:"YES",label:"统一推送"},{value:"NO",label:"逐一推送"}],f=[{value:30,label:"每30分钟"},{value:60,label:"每1小时"},{value:180,label:"每3小时"}],h=[{value:"WORK",label:"工作时间"},{value:"ALL",label:"全天候"}],a=function(e){var n=e.value,t=e.list,a=e.getValue,l=s().useState(n),r=l[0],i=l[1];s().useEffect(function(){a(r)},[r]);var c=r.remindRepetition,e=r.unify,n=r.warningInterval,l=r.workType;return s().createElement("div",{className:"yt_modal_warning_rule_wrapper"},s().createElement("div",{className:"section"},s().createElement("span",null,"是否统一推送"," ",s().createElement(p.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:s().createElement("div",{style:{width:"142px"}},"「统一推送」是指将触发预警的规则统一推送给推送成员。",s().createElement("br",null),"「逐一推送」是指将触发预警的规则单个逐一推送给推送成员")},s().createElement("i",{className:"icon-cem_file1"}))),s().createElement("span",null,s().createElement(u(),{className:"content_item_select",value:e,onChange:function(e){return i(o()({},r,{unify:e}))},inputIcon:s().createElement("i",{className:"icon-cem_arrow-launches",style:{color:"#8C8C8C"}}),optionLabelProp:"label"},d.map(function(e){return s().createElement(u().Option,{value:e.value,key:e.value,label:e.label},e.label)})))),s().createElement("div",{className:"section time"},s().createElement("span",null,"预警间隔"),s().createElement("span",null,s().createElement(u(),{className:"content_item_select",value:n,onChange:function(e){return i(o()({},r,{warningInterval:e}))},inputIcon:s().createElement("i",{className:"icon-cem_arrow-launches",style:{color:"#8C8C8C"}}),optionLabelProp:"label"},f.map(function(e){return s().createElement(u().Option,{value:e.value,key:e.value,label:e.label},e.label)})),s().createElement("span",null,"更新数据计算"))),t.map(function(t){return s().createElement("div",{className:"section",key:t.id},s().createElement("span",null,t.title," ",s().createElement(p.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:s().createElement("div",null,s().createElement("a",{target:"_blank",rel:"noopener noreferrer",style:{color:"#0847a6",cursor:"pointer"},href:"tableTitle"===t.id?"https://www.yuque.com/docs/share/43c35680-898f-45ac-b713-b9194950d7da?#《移动端价格表格展示设置》":"https://www.yuque.com/docs/share/9da3cbc0-c4fa-41da-8f94-99fc27cf928e?#《关于「提醒详情页」字段的说明》"},"了解更多"))},s().createElement("i",{className:"icon-cem_file1"}))),s().createElement("span",null,s().createElement(u(),{className:"content_item_select",value:r[t.id],onChange:function(e){var n;i(o()({},r,((n={})[t.id]=e,n)))},inputIcon:s().createElement("i",{className:"icon-cem_arrow-launches",style:{color:"#8C8C8C"}}),multiple:"detailTitle"!==t.id,tags:!1,optionLabelProp:"label"},(t.config||[]).map(function(e){return{label:e.name,value:e.id}}).map(function(e){return s().createElement(u().Option,{value:e.value,key:e.value,label:e.label},e.label)}))))}),s().createElement("div",{className:"section"},s().createElement("span",null,"提醒时间"," ",s().createElement(p.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:s().createElement("div",null,"「工作时间」是指只会在周一至周五的早上8：00~晚上10：00给用户推送预警提醒。在免打扰期间触发的预警会在早上8：00的时候集中推送给用户",s().createElement("br",null),"「全天候」是指微信用户7天 x 24小时都会在微信收到触发的预警提醒")},s().createElement("i",{className:"icon-cem_file1"}))),s().createElement("span",null,s().createElement(u(),{className:"content_item_select",value:l,onChange:function(e){return i(o()({},r,{workType:e}))},inputIcon:s().createElement("i",{className:"icon-cem_arrow-launches",style:{color:"#8C8C8C"}}),optionLabelProp:"label"},h.map(function(e){return s().createElement(u().Option,{value:e.value,key:e.value,label:e.label},e.label)})))),s().createElement("div",{className:"section repeat"},s().createElement("span",null,"重复提醒"),s().createElement("span",null,s().createElement(m.Checkbox,{checked:"NO"===c,onChange:function(e){i(o()({},r,{remindRepetition:e?"NO":"YES"}))}},"单个规则触发预警后当天不再重复推送"))))};const r=a;a.propTypes={value:n().object,getValue:n().func};var i=t(57522)},99710:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>z});var a=t(37316),l=t.n(a),r=t(67154),h=t.n(r),i=t(93913),c=t.n(i),o=t(85354),s=t.n(o),n=t(23279),u=t.n(n),a=t(67294),v=t.n(a),g=t(92360),E=t(29383),m=t(61409),r=t(55609),p=t(35239),y=t(84849),i=t(64396),C=t(55815),_=t(61918),b=t(60496),o=t(45697),n=t.n(o),d=t(39432),f=t(43036),w=t(51474),N=t(87219),o=function(n){function e(e){var o=n.call(this,e)||this;return o._setShowFalse=function(){o.setState({show:!1})},o._handleParentClick=function(e){o.state.show&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},o._handleOnTriggerClick=function(){setTimeout(function(){o.setState({show:!o.state.show})},0)},o._renderOptionItem=function(n,e,t,a,l,r){var i=o.state.maxLabelWidth,c=o.props.value.find(function(e){return e.value===n.value});return v().createElement("div",{className:"opt_item "+(e?"draggable":""),key:n.value},e&&v().createElement("i",{className:"icon-cem_move my_handle"}),v().createElement("div",{className:"opt_content",style:{width:i,marginLeft:e?0:12}},v().createElement("div",{className:"item_label",onClick:function(e){e.stopPropagation(),o._handleOnItemClick(n.value)}},v().createElement("span",{className:"icon_checkbox "+(c&&c.checked?"checkbox_checked":"")}),v().createElement("span",null,n.label)),v().createElement("div",{className:"item_control"},v().createElement(f.Z,{placement:"top",overlay:t},v().createElement("span",{onClick:function(e){return a(e,n.value)}},v().createElement("i",{className:(e?"icon-cem_up":"icon-cem_up-and-down")+" fun_icon_a"}))),v().createElement(f.Z,{placement:"top",overlay:l},v().createElement("span",{onClick:function(e){return r(e,n.value)},style:{marginLeft:4}},v().createElement("i",{className:"icon-cem_down fun_icon_b"}))))))},o._handleOnItemClick=function(n){var e=o.props,t=e.value,e=e.onChange;e&&e((0,N.ZP)(t,function(e){e=e.find(function(e){return e.value===n});e&&(e.checked=!e.checked)}))},o._handleOnFilxedLeftClick=function(e,n){e.stopPropagation(),o._handleOnFixedChange(n,"left")},o._handleOnCancelFixedClick=function(e,n){e.stopPropagation(),o._handleOnFixedChange(n,"")},o._handleOnFixedRightClick=function(e,n){e.stopPropagation(),o._handleOnFixedChange(n,"right")},o._handleOnFixedChange=function(n,t){var e=o.props,a=e.value,e=e.onChange;e&&e((0,N.ZP)(a,function(e){e=e.find(function(e){return e.value===n});e&&(e.fixed=t)}))},o.state={show:!1,value:[],leftOpts:[],normalOpts:[],rightOpts:[],maxLabelWidth:e.options.reduce(function(e,n){return Math.max((0,d.jD)(n.label,14)+56+16+16,e)},0)},o}s()(e,n),e.getDerivedStateFromProps=function(a,e){if(JSON.stringify(a.value)===JSON.stringify(e.value))return null;var n=a.value.reduce(function(e,n){var t=1;return"left"===n.fixed&&(t=0),e[t="right"===n.fixed?2:t].push(a.options.find(function(e){return e.value===n.value})),e},[[],[],[]]),t=n[0],e=n[1],n=n[2];return{value:a.value,leftOpts:t,normalOpts:e,rightOpts:n}};var t=e.prototype;return t.componentDidMount=function(){var i=this;window.addEventListener("click",this._setShowFalse);var e=document.getElementById("draggable_zone");e&&w.ZP.create(e,{group:"draggable_zone",animation:150,filter:".undraggable",draggable:".draggable",handle:".my_handle",onEnd:function(e){var t,n=i.props,a=n.value,n=n.onChange,l=e.newIndex,r=e.oldIndex;l!==r&&(t=a.filter(function(e){return"left"===e.fixed}),n&&n((0,N.ZP)(a,function(e){var n=e.splice(r+t.length,1)[0];e.splice(l+t.length,0,n)})))}})},t.componentWillUnmount=function(){window.removeEventListener("click",this._setShowFalse)},t.render=function(){var n=this,e=this.state,t=e.show,a=e.leftOpts,l=e.normalOpts,r=e.rightOpts,i=this.props,e=i.className,i=i.title;return v().createElement("div",{className:"yt_columns_selector_wrapper "+(e||""),onClick:this._handleParentClick},v().createElement("div",{className:"trigger "+(t?"sel":""),onClick:this._handleOnTriggerClick},i||"列",v().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:t?"rotate(-180deg)":""}})),v().createElement("div",{className:"options "+(t?"active":"")},0<a.length&&v().createElement(v().Fragment,null,v().createElement("div",{className:"opt_label"},"固定在左侧"),a.map(function(e){return n._renderOptionItem(e,!1,"不固定",n._handleOnCancelFixedClick,"固定在列尾",n._handleOnFixedRightClick)})),(0<a.length||0<r.length)&&v().createElement("div",{className:"opt_label"},"不固定"),v().createElement("div",{id:"draggable_zone",style:{visibility:0<l.length}},l.map(function(e){return n._renderOptionItem(e,!0,"固定在列头",n._handleOnFilxedLeftClick,"固定在列尾",n._handleOnFixedRightClick)})),0<r.length&&v().createElement(v().Fragment,null,v().createElement("div",{className:"opt_label"},"固定在右侧"),r.map(function(e){return n._renderOptionItem(e,!1,"不固定",n._handleOnCancelFixedClick,"固定在列头",n._handleOnFilxedLeftClick)}))))},e}(v().PureComponent);const k=o;o.propTypes={className:n().string,title:n().string,options:n().shape({label:n().string,value:n().string}),value:n().arrayOf({value:n().string,fixed:n().string,checked:n().bool}),onChange:n().func};var o=t(30381),O=t.n(o),o=function(e){var n=e.value,t=e.onChange,a=e.options,l=v().useRef(void 0),r=a.find(function(e){return e.value===n}),e=v().useState(!1),i=e[0],c=e[1];return v().useEffect(function(){function e(){i&&c(!1)}return window.addEventListener("click",e),function(){return window.removeEventListener("click",e)}}),r?v().createElement("div",{className:"yt_table_item_selector_wrapper"},r.title,v().createElement(f.Z,{ref:l,visible:i,placement:"bottom",overlayClassName:"yt_table_item_selector_overlay",overlay:v().createElement(v().Fragment,null,a.map(function(e){return v().createElement("div",{className:"item "+(e.value===n?"sel":""),key:e.value,onClick:function(){return t&t(e.value)}},e.title)}))},v().createElement("i",{className:"icon-cem_pull-down-or-take-up "+(i?"active":""),style:{transform:i?"rotate(-180deg)":""},onClick:function(e){e.stopPropagation(),c(!i)}}))):"差价高于"};const P=o;o.propTypes={value:n().string,onChange:n().func,options:n().shape({title:n().string,value:n().string})};var x,T=t(23570),o=function(e){var n=e.value,t=e.onChange,a=e.prefix,l=void 0===a?"":a,e=v().useState(!1),a=e[0],r=e[1];return v().createElement("div",{className:"yt_talbe_item_input_wrapper"},a?v().createElement(T.Z,{autoFocus:!0,className:"item_input",defaultValue:n,onBlur:function(e){e.stopPropagation();e=e.target;r(!1),t&&t(e.value)},onKeyDown:function(e){e.stopPropagation();var n=e.keyCode,e=e.target;13===n&&(r(!1),t&&t(e.value))}}):v().createElement(v().Fragment,null,l,n," ",v().createElement("i",{className:"icon-cem_screening-editor",onClick:function(){return r(!0)}})))};const S=o;o.propTypes={value:n().string,prefix:n().oneOfType([n().string,n().node]),onChange:n().func};const W=function(e){var r=e.date,n=e.className,t=v().useState(""),e=t[0],i=t[1];return v().useEffect(function(){return r&&(x=setInterval(function(){var e,n,t,a,l,n=(e=r,n=new Date,t=new Date(e),a=parseInt((t.getTime()-n.getTime())/1e3),l=parseInt(a/86400),e=parseInt(a/3600%24),t=parseInt(a/60%60),n=parseInt(a%60),a<0?"- -":(l?l+"天":"")+(e?e+"小时":"")+(t?t+"分":"")+n+"秒");"- -"==n&&(x&&clearInterval(x),x=void 0),i(n)},1e3)),function(){x&&clearInterval(x),x=void 0}},[r]),v().createElement("div",{className:"yt_time_notice_wrapper "+n,style:{display:e?"block":"none"}},v().createElement("i",{className:"icon-cem_ordinary"}),"系统将于",O()(r).format("MM月DD日HH点mm分"),"进行下一轮预警处理，距离现在还有（",e,"）")};o=function(e){function n(){document.querySelector(".price_warning_dialog")&&document.querySelector(".price_warning_dialog").remove()}e.value,e.list,e.getValue;return v().createElement("div",{className:"yt_modal_price_warning_wrapper"},v().createElement("div",{className:"section"},v().createElement("div",{onClick:function(){n(),setTimeout(function(){return m.mW.push({pathname:"/priceWarning/add",state:{type:2}})},100)}},v().createElement("p",null,"固定金额比价"),v().createElement("div",{className:"info"},v().createElement("span",null,"即将选定的商品与固定的金额进行比较，当选定的商品高于或低于特定金额时发出预警"))),v().createElement("div",{onClick:function(){n(),setTimeout(function(){return m.mW.push({pathname:"/priceWarning/add",state:{type:1}})},100)}},v().createElement("p",null,"同类商品比价"),v().createElement("div",{className:"info"},v().createElement("span",null,"基于「满即将选定的一组商品与另一组商品进行比较」如比较相同的sku在不同的渠道价格的价格的比较，当高于或者低于选定的对比商品时就触发预警」")))))};const I=o;o.propTypes={value:n().object,getValue:n().func};var L=t(57522);var F=t(11912),Z=i.Z.monitoring.warning,a=function(n){function e(e){var t=n.call(this,e)||this;return t.handleResize=u()(function(){var e=document.getElementById("table_zone");e&&t.setState({tableWidth:e.clientWidth})},150),t.toEdit=function(e,n){"edit"===n?m.mW.push({pathname:"/priceWarning/add",state:{id:e.id,copy:!1}}):m.mW.push({pathname:"/priceWarning/add",state:{id:e.id,copy:!0}})},t.delete=function(n){g.MessageBox.confirm("删除后无法恢复, 是否继续?","提示",{type:"warning"}).then(function(e){t.props.deleteWarning({id:n.id})})},t.toPushLog=function(e){m.mW.push({pathname:"/priceWarning/weChatPush",state:{warningPriceId:e.id}})},t.addWarning=function(e){m.mW.push("/priceWarning/add")},t.handleOnHelpClick=function(){window.open("https://www.yuque.com/docs/share/f5e65ec4-657e-40a5-9532-5d29891e4c58?# 《竞品比价功能说明》")},t.handleOnParamChange=function(e){var n=t.props.keyword;t.props.fetchWarningList(h()({keyword:n},e))},t.handleOnTypeChange=function(e,n){e!==n.priceCompareType&&t.props.fetchWarningChange({id:n.id,priceCompareType:e})},t.handleOnPriceChange=function(e,n){e!==n.money&&t.props.fetchWarningChange({id:n.id,warningPrice:e})},t.handleOnColumnChange=function(e){t.props.setDefaultValue({activeColumnProps:e}),t.props.save({activeColumnProps:e})},t.state={tableWidth:0},t}s()(e,n);var t=e.prototype;return t.componentDidMount=function(){this.props.fetchParams({projectId:p.t.get(p.V.curProject).id}),window.addEventListener("rezise",this.handleResize),this.handleResize()},t.componentWillUnmount=function(){window.removeEventListener("rezise",this.handleResize)},t.render=function(){var n=this,e=this.props,t=e.preferList,a=e.preferValue,l=e.submitPreferValue,r=e.save,i=e.data,c=e.messageListFetching,o=e.from,s=e.to,u=e.count,m=e.pageIndex,p=e.pageSize,d=e.priceCompareType,f=e.compareType,e=e.activeColumnProps;return v().createElement("div",{className:"price-warning"},v().createElement(C.Z,{title:"竞品比价"}),v().createElement("div",{className:"content"},v().createElement("div",{className:"table"},v().createElement("div",{className:"button_zone"},v().createElement("div",null,v().createElement(_.Z,{placeholder:"搜索预警名称",onSearch:function(e){return n.handleOnParamChange({keyword:e})}}),v().createElement(b.Z,{activeObj:f,preTitle:"比价模式",options:F.OB,type:"button",divider:"none",objName:"compareType",onChange:this.handleOnParamChange,style:{marginRight:12}}),v().createElement(b.Z,{activeObj:d,preTitle:"比价方式",options:F.Ij,type:"button",divider:"none",objName:"priceCompareType",onChange:this.handleOnParamChange})),v().createElement("div",null,v().createElement(g.Button,{type:"primary",className:"create_rule",onClick:function(){return new Promise(function(e,n){var t=h()({},a,{titleText:"选择模板",content:v().createElement(I,a),top:"50%",noFoot:!0,className:"price_warning_dialog"});t.onOk=function(){return e()},t.onCancel=n,(0,L.Z)(t)});var a}},"创建规则"),v().createElement("span",{className:"divider"}),v().createElement("i",{className:"icon-cem_collection-settings fun_icon",onClick:function(){(0,y.e)({value:a||{},list:t,onCancel:function(){}}).then(function(e){r({preferValue:e}),l({}).then(function(e){e.data&&2e4===e.data.code&&g.Message.success("修改成功")})})},style:{marginRight:12}}),v().createElement("i",{className:"icon-cem_question fun_icon",onClick:this.handleOnHelpClick}))),i&&0<i.length&&v().createElement(W,{date:i[0].nextRemindTime,className:"notice_zone"}),v().createElement("div",{className:"table_zone",id:"table_zone"},v().createElement(E.Z,{loading:c,columns:this.columns,data:i,from:o,to:s,total:u,currentPage:m,pageSize:p,pageSizeSelectorShow:!0,onPageSizeChange:function(e){return n.handleOnParamChange({pageSize:e,pageIndex:1})},onPage:function(e){return n.handleOnParamChange({pageIndex:e})}}),v().createElement(k,{className:"column_selector",options:F.SE,value:e,onChange:this.handleOnColumnChange})))))},c()(e,[{key:"columns",get:function(){var n,r=this,e=this.state.tableWidth,i=0,c=0,o=0,t=this.props.activeColumnProps.reduce(function(e,n,t,a){var l;return n.checked&&(o+=n.width,n.fixed?i+=n.width:c+=n.width,l=h()({},n,{prop:n.value}),"lastRemindTime"===n.value||"createdAt"===n.value||"updatedAt"===n.value?l.render=function(e,n){return e[n.prop]?O()(e[n.prop]).format("YYYY-MM-DD HH:mm"):""}:"priceCompareType"===n.value?l.render=function(n){return v().createElement(P,{value:n.priceCompareType,options:F.C0,onChange:function(e){return r.handleOnTypeChange(e,n)}})}:"compareType"===n.value?l.render=function(n){var e=F.OB.find(function(e){return e.value===n.compareType});return e?e.title:""}:"money"===n.value?l.render=function(n){return v().createElement(S,{prefix:"￥",value:n.money,onChange:function(e){return r.handleOnPriceChange(e,n)}})}:"operator"===n.value&&(l.render=function(e){return v().createElement(v().Fragment,null,v().createElement("span",{className:"operation_columns",onClick:function(){return r.toEdit(e,"edit")}},"编辑"),v().createElement("span",{className:"operation_columns",onClick:function(){return r.toEdit(e,"copy")}},"复制"),v().createElement("span",{className:"operation_columns",onClick:function(){return r.delete(e)}},"删除"),v().createElement("span",{style:{margin:0},className:"operation_columns",onClick:function(){return r.toPushLog(e)}},"查看推送日志"))}),e.push(l)),e},[]);return t.push({width:50,fixed:"right"}),o<e-50&&(n=e-50-i,t.forEach(function(e){e.fixed||(e.width=e.width/c*n)})),t}}]),e}(a.Component);const z=(0,r.connect)(function(e){var n=e.loading,e=l()(e,["loading"]);return h()({},e[Z],{messageListFetching:n.effects[Z+"/fetchSettingList"]||n.effects[Z+"/fetchParams"]||!1})},function(n){return{fetchParams:function(e){return n({type:Z+"/fetchParams",payload:e})},fetchSettingList:function(e){return n({type:Z+"/fetchSettingList",payload:e})},fetchPreferValue:function(e){return n({type:Z+"/fetchPreferValue",payload:e})},submitPreferValue:function(e){return n({type:Z+"/submitPreferValue",payload:e})},fetchWarningList:function(e){return n({type:Z+"/fetchWarningList",payload:e})},fetchWarningChange:function(e){return n({type:Z+"/fetchWarningChange",payload:e})},deleteWarning:function(e){return n({type:Z+"/deleteWarning",payload:e})},setDefaultValue:function(e){return n({type:Z+"/setDefaultValue",payload:e})},save:function(e){return n({type:Z+"/save",payload:e})},clean:function(e){return n({type:Z+"/clean",payload:e})}}})(a)},61918:(e,n,t)=>{"use strict";t.d(n,{Z:()=>a});var n=t(67294),u=t.n(n),n=t(45697),t=t.n(n),n=function(e){var n=e.className,t=e.onClear,a=e.onSearch,l=e.placeholder,r=e.style,i=e.defValue,c=e.signal,e=u().useState(i),o=e[0],s=e[1];u().useEffect(function(){s(i)},[i,c]);return u().createElement("div",{style:r,className:"yt_search_input_wrapper "+(n||"")},u().createElement("input",{placeholder:l,value:o,onKeyDown:function(e){13===e.keyCode&&a(o)},onChange:function(e){return s(e.target.value)},autoComplete:"off"}),o&&u().createElement("i",{className:"icon-cem_log-off",onClick:function(){s(""),t&&t("")}}),u().createElement("i",{className:"icon-cem_small-search",onClick:function(){return a(o)}}))};n.propTypes={className:t().string,onSearch:t().func.isRequired,placeholder:t().string,style:t().object,defValue:t().string,signal:t().any,onClear:t().func};const a=n}}]);