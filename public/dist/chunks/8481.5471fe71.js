(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8481],{8481:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var t=a(67154),n=a.n(t),t=a(85354),l=a.n(t),t=a(67294),d=a.n(t),u=a(92360),i=a(5133),h=a(35108),c=a(36144),g=a(19586),r=a(35239),o=a(97189),m=a(21694),s=function(t){function e(e){var s=t.call(this,e)||this;return s.fetchData=function(t){var e=t?"data/price/chart/export":"/price/list/monitors/all/v2",a=r.t.get(r.V.curProject).id;t||s.setState({loading:!0});var l=s.filter.getValue();c.h.post(e,n()({type:"ALL",id:a},l)).then(function(e){200!==e.status&&304!==e.status||(t?i.Z.success("操作成功，请到个人中心的下载列表或者点击右上角“小铃铛”下载。"):(e=e.data.result,s.setState({platforms:e.part1,goods:e.part2.data,firstColumnName:e.part2.topic3Name,loading:!1},function(){return s.formatData()})))}).catch(function(e){return i.Z.error(e.toString())})},s.formatData=function(){for(var e=s.state.goods,t=0;t<e.length;t++){e[t].noStockCityList=[];var a=e[t].cityStockModelList;if(a&&0<a.length)for(var l=a.filter(function(e){return"无货"===e.stockState}).map(function(e){return e.city}),n=0;n<l.length;n++)for(var i=0;i<m.Q1.length;i++)m.Q1[n].fullName===l[n]&&e[t].noStockCityList.push(m.Q1[i].simplifiedName)}s.setState({goods:e})},s.refreshTable=function(){s.setState({goods:[],columnWidth:[],isFirst:!1},function(){return s.fetchData(!1)})},s.getTableWidth=function(){var e=s.state,t=(e.tableWidth,e.tableHeight,document.getElementsByClassName("mainContent")[0].clientWidth-48),e=document.documentElement.clientHeight-46-48-48-30;s.setState({tableWidth:t,tableHeight:e})},s.onScrollEnd=function(){for(var e=s.state.activeIndex,t=document.getElementsByClassName("Htag"),a=document.getElementsByClassName("Mtag"),l=t.length-1;0<=l;l--)t[l].style.display=-1<e.indexOf(2)?"block":"none";for(var n=a.length-1;0<=n;n--)a[n].style.display=-1<e.indexOf(3)?"block":"none";return!0},s.onColumnResizeEndCallback=function(e,t){var a=s.state.columnWidth;a[t]=e,s.setState({columnWidth:a})},s.onRowClick=function(e){e!==s.state.highlightedRowIndex&&s.setState({highlightedRowIndex:e})},s.handleClass=function(e,t){var a;switch(e){case"upFlag":a="increasing";break;case"downFlag":a="decreasing";break;case"maxFlag":a="maximumPrice";break;case"minFlag":a="minimumPrice"}for(var l=document.querySelectorAll("."+e),n=l.length-1;0<=n;n--)("add"===t?(0,o.addClass):(0,o.removeClass))(l[n],a);var i=document.getElementsByClassName("Htag"),s=document.getElementsByClassName("Mtag");if("maxFlag"===e)for(var c=i.length-1;0<=c;c--)i[c].style.display="add"===t?"block":"none";if("minFlag"===e)for(var r=s.length-1;0<=r;r--)s[r].style.display="add"===t?"block":"none"},s._handleOnFilterReady=function(){s.fetchData(!1),s.setState({isFirst:"default"===s.filter.state.filterObj.id})},s.state={loading:!1,isFirst:!0,platforms:[],goods:[],firstColumnName:"",columnWidth:[],tableWidth:0,tableHeight:0,pageIndex:1,pageSize:20,activeIndex:[0,1],highlightedRowIndex:-1},s}l()(e,t);var a=e.prototype;return a.componentDidMount=function(){this.getTableWidth(),window.addEventListener("resize",this.getTableWidth)},a.UNSAFE_componentWillUpdate=function(e,t){t=t.activeIndex;if(-1<t.indexOf(2))for(var a=document.getElementsByClassName("Htag"),l=a.length-1;0<=l;l--)a[l].style.display="block";if(-1<t.indexOf(3))for(var n=document.getElementsByClassName("Mtag"),i=n.length-1;0<=i;i--)n[i].style.display="block"},a.componentWillUnmount=function(){window.removeEventListener("resize",this.getTableWidth)},a.clickTableLegend=function(e){var t=this.state.activeIndex,a=document.querySelectorAll(".item")[e].children[0];if(-1===t.indexOf(e))switch(t.push(e),e){case 0:a.className+=" green",this.handleClass("upFlag","add");break;case 1:a.className+=" red",this.handleClass("downFlag","add");break;case 2:a.className+=" yellowTriangle",this.handleClass("maxFlag","add");break;case 3:a.className+=" blueTriangle",this.handleClass("minFlag","add")}else{var l=t.indexOf(e);switch(t.splice(l,1),e){case 0:a.className="square",this.handleClass("upFlag","remove");break;case 1:a.className="square",this.handleClass("downFlag","remove");break;case 2:a.className="triangle",this.handleClass("maxFlag","remove");break;case 3:a.className="triangle",this.handleClass("minFlag","remove")}}},a.render=function(){var a=this,e=this.state,t=e.loading,l=e.isFirst,i=e.platforms,s=e.goods,n=e.firstColumnName,c=e.columnWidth,r=e.tableWidth,o=e.tableHeight,m=e.activeIndex;return d().createElement("div",{className:"chartWrapper"},d().createElement(g.Z,{ref:function(e){return a.filter=e},showList:["condition","save"],defaultShow:"condition",filterCondition:{filter:["CONN_CONFIG","SOURCE","TAG"]},model:"PRICE_MONITOR_CHART",onChange:this.refreshTable,onFilterReady:this._handleOnFilterReady}),d().createElement(u.Loading,{loading:t},l?d().createElement("div",{className:"noFiltersTip"},"请先选择筛选条件"):d().createElement("div",{className:"body"},d().createElement("div",{className:"operation"},d().createElement("ul",{className:"desc"},d().createElement("li",{className:"item",onClick:function(){return a.clickTableLegend(0)}},d().createElement("div",{className:"square green"}),d().createElement("span",null,"涨价")),d().createElement("li",{className:"item",onClick:function(){return a.clickTableLegend(1)}},d().createElement("div",{className:"square red"}),d().createElement("span",null,"降价")),d().createElement("li",{className:"item",onClick:function(){return a.clickTableLegend(2)}},d().createElement("div",{className:"triangle"}),d().createElement("span",null,"最高价")),d().createElement("li",{className:"item",onClick:function(){return a.clickTableLegend(3)}},d().createElement("div",{className:"triangle"}),d().createElement("span",null,"最低价"))),0<s.length&&d().createElement("span",{className:"downloadBtn",onClick:function(){return a.fetchData(!0)}},d().createElement("i",{className:"cem-icon icon-cem_download"}),"下载")),0<s.length?d().createElement("div",{className:"priceMonitorTableWrapper"},d().createElement(h.Table,{ref:function(e){return a.table=e},rowHeight:24,rowsCount:s.length,groupHeaderHeight:24,headerHeight:24,width:r,height:o,onRowClick:function(e,t){return a.onRowClick(t)},onScrollEnd:this.onScrollEnd,onColumnResizeEndCallback:this.onColumnResizeEndCallback,isColumnResizing:!1},d().createElement(h.ColumnGroup,{fixed:!0},d().createElement(h.Column,{allowCellsRecycling:!0,fixed:!0,header:d().createElement("div",{className:"customizedCell headerCell",title:n},n),cell:function(e){e=e.rowIndex;return d().createElement("div",{className:"customizedCell",style:{textAlign:"left"},title:s[e].topic3Value},s[e].topic3Value)},columnKey:0,flexGrow:1,width:c[0]||150,isResizable:!0})),i.map(function(e,t){for(var a=e.topic2Values,l=0,n=0;n<i.length;n++)n<t&&(l+=i[n].topic2Values.length);return d().createElement(h.ColumnGroup,{key:t,header:d().createElement("div",{className:"customizedCell headerCell"},e.topic1Value)},a.map(function(e,t){var a=l+t;return d().createElement(h.Column,{header:d().createElement("div",{className:"customizedCell headerCell",title:e},e),cell:function(e){var e=e.rowIndex,e=s[e].detail[a],t="customizedCell";if(e){switch(e.flag){case 0:break;case 1:t+=" upFlag",-1<m.indexOf(0)&&(t+=" increasing");break;case 2:t+=" downFlag",-1<m.indexOf(1)&&(t+=" decreasing")}e.max&&(t+=" maxFlag",-1<m.indexOf(2)&&(t+=" maximumPrice")),e.min&&(t+=" minFlag",-1<m.indexOf(3)&&(t+=" minimumPrice"))}return d().createElement("div",{className:t},e?e.noStockCityList&&0<e.noStockCityList.length?e.noStockCityList.join("").concat("缺货"):e.price:"-",e?d().createElement("span",{className:e.max?"Htag":e.min?"Mtag":""},e.max?"H":e.min?"M":""):null)},flexGrow:1,width:c[a+1]||150,key:t,columnKey:a+1,isResizable:!0,allowCellsRecycling:!0,pureRendering:!0})}))}))):d().createElement("div",{className:"noDataTip"},"暂无数据"))))},e}(d().Component)},21694:(e,t,a)=>{"use strict";a.d(t,{U7:()=>l,QQ:()=>n,Se:()=>i,Q1:()=>s});var l=[{title:"价格上升",value:"UP"},{title:"价格下降",value:"DOWN"},{title:"全部",value:"ALL"}],n=[{title:"1小时内",value:1},{title:"2小时内",value:2},{title:"4小时内",value:4},{title:"12小时内",value:12},{title:"当天",value:0}],i=[{title:"已更新",value:"UPDATED"},{title:"未更新",value:"UN_UPDATED"},{title:"手动更新中",value:"UPDATING"}],s=[{fullName:"北京",simplifiedName:"京"},{fullName:"上海",simplifiedName:"沪"},{fullName:"广州",simplifiedName:"穗"},{fullName:"深圳",simplifiedName:"深"}]}}]);