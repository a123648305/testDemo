(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[8167],{12475:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var t=n(67154),l=n.n(t),t=n(85354),a=n.n(t),t=n(67294),u=n.n(t),p=n(92360),r=n(5133),m=n(29383),o=n(36144),d=n(55815),i=function(t){function e(e){var i=t.call(this,e)||this;return i.getIpList=function(e){var t=i.state,n=(t.startTime,t.endTime,t.selUsers,t.selTypes,t.currentPage),t=t.pageSize;o.h.post("ip/page",{pageNum:n,pageSize:t}).then(function(t){i.setState({data:[],pageSize:t.data.result.size,totalNumber:t.data.result.totalElements},function(e){i.setState({data:t.data.result.content})})})},i.addIps=function(e){var t,n=i.state,a=n.form;n.id;0!==a.ips.length?(t=/(?=(\b|\D))(((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))\.){3}((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))(?=(\b|\D))/,"string"==typeof a.ips&&(a.ips=a.ips.split(/[\s\n]/)),a.ips.some(function(e){return!t.test(e)})?r.Z.warning("含有非法IP"):o.h.post("/ip/add",l()({},a)).then(function(e){i.setState({dialogVisible:!1,form:{name:"",ips:""}}),i.getIpList()})):r.Z.warning("请输入IP地址")},i.getPage=function(e){i.setState({currentPage:e},function(e){return i.getIpList()})},i.deleteIp=function(e){var t=i.state,n=t.data;t.onValue&&n&&1===n.length?r.Z.warning("请先关闭IP白名单"):o.h.post("ip/delete",{ids:[e]}).then(function(e){i.getIpList()})},i.handleSwitch=function(e){var t=i.state,n=t.data,a=t.onValue;if(!a&&n&&0===n.length)return i.setState({onValue:!1}),void r.Z.warning("请至少添加一个IP到白名单");o.h.post("ip/update",{ipWhiteListEnable:e?1:0}).then(function(e){i.setState({onValue:!a}),r.Z.success("操作成功")})},i.getState=function(e){o.h.get("/ip/enable").then(function(e){return i.setState({onValue:e.data.result})})},i.state={columns:[{label:"",prop:"paddingLeft",width:16},{label:"IP地址",prop:"ip"},{label:"IP描述",prop:"description"},{label:"日期",prop:"createAt"},{label:"操作",width:180,render:function(e,t,n){return u().createElement("span",null,u().createElement("a",{className:"operation_columns",onClick:function(){return i.deleteIp(i.state.data[n].id)}},"删除"))}},{label:"",prop:"paddingRight",width:16}],data:[],form:{name:"",ips:""},onValue:!1,currentPage:1,pageSize:20,totalNumber:0},i}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.getIpList(),this.getState()},n.projectOnChange=function(e,t){var n;this.setState({form:Object.assign(this.state.form,((n={})[e]=t,n))})},n.render=function(){var t=this,e=this.state,n=e.totalNumber,a=e.currentPage,i=e.pageSize,l=e.dialogVisible,r=e.form,o=e.onValue,s=e.columns,c=e.data,e=document.documentElement.clientHeight-54-48-24;return u().createElement("div",{className:"white-list-wrap common-wrapper"},u().createElement(d.Z,{title:"IP白名单",rightContent:u().createElement(p.Button,{type:"primary",onClick:function(){return t.setState({dialogVisible:!0})}},"添加IP白名单")}),u().createElement("div",{className:"common-padding-12"},u().createElement("div",{style:{minHeight:e,backgroundColor:"#fff",paddingTop:"20px"}},u().createElement("div",{className:"filter"},u().createElement("div",null,u().createElement("div",{className:"switch-bar"},"是否开启    ",u().createElement(p.Switch,{value:o,onColor:"#0747A6",offColor:"#CCCCCC",onText:"",offText:"",onChange:this.handleSwitch})))),u().createElement("div",{className:"white-list"},u().createElement(m.Z,{columns:s,data:c,start:1===a?1:20*(a-1)+1,end:n,total:n,pageSize:i,currentPage:a,onPage:this.getPage})))),u().createElement(p.Dialog,{title:"添加IP白名单",visible:l,className:"add-project-modal",onCancel:function(){return t.setState({dialogVisible:!1})}},u().createElement(p.Dialog.Body,null,u().createElement(p.Form,{labelPosition:"left",model:r},u().createElement(p.Form.Item,{label:"IP地址",prop:"ips"},u().createElement(p.Input,{value:this.state.form.ips,type:"textarea",onChange:function(e){return t.projectOnChange("ips",e)},placeholder:"可多行输入,相邻IP用空格间隔"}),u().createElement("i",null,"*")),u().createElement(p.Form.Item,{label:"IP描述",prop:"name"},u().createElement(p.Input,{value:this.state.form.name,onChange:function(e){return t.projectOnChange("name",e)}})))),u().createElement(p.Dialog.Footer,{className:"dialog-footer"},u().createElement(p.Button,{type:"primary",onClick:this.addIps},"确 定"),u().createElement(p.Button,{onClick:function(){return t.setState({dialogVisible:!1})}},"取 消"))))},e}(t.Component)}}]);