(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[7762],{12319:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-793b65"},87569:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-386841"},521:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-068d63"},23318:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-35b064"},64313:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-3d3186"},8332:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-885c5e"},18902:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-b93514"},92634:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-453629"},12839:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-70b47d"},19119:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-fefa3a"},66165:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>N});var n=r(85354),a=r.n(n),l=r(67154),c=r.n(l),i=r(67294),s=r.n(i),o=r(45697),t=r.n(o),n=r(55609),u=r(92360),m=r(5133),p=r(36144),d=r(35303),l=r(64396),h=l.Z.research.addContact,o=function(t){function e(e){var a=t.call(this,e)||this;return a.onFormChange=function(e,t){var n;a.setState({form:c()({},a.state.form,((n={})[e]=t,n))})},a.commit=function(){a.form.validate(function(e){if(!a.props.required&&!a.state.form.email&&!a.state.form.phoneNumber)return m.Z.error("手机号码和邮箱请至少填充一项"),!1;if(e&&a.props.defaultValue)p.h.post("/contact/update",a.state.form).then(function(e){2e4===e.data.code&&(a.props.onCancel(),a.props.onAdd&&a.props.onAdd(a.state.form))});else{if(!e)return!1;p.h.post("/contact/add",a.state.form).then(function(e){2e4===e.data.code&&(a.setState({form:{name:"",email:"",phoneNumber:"",tags:[]}}),a.props.onCancel(),a.props.onAdd&&a.props.onAdd(e.data.result))})}})},a.state={form:a.props.defaultValue||{name:"",email:"",phoneNumber:"",tags:[]},rules:{phoneNumber:[{required:e.required&&e.required.includes("phone"),message:"请输入手机号",trigger:"blur"},{validator:function(e,t,n){t&&!/^1[3|4|5|7|8|9][0-9]{9}$/.test(t)?n(new Error("请输入正确手机号码")):n()},trigger:"blur"}],email:[{required:e.required&&e.required.includes("email"),message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]}},a}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.props.getTagList()},n.render=function(){var t=this,e=this.state,n=e.form,a=e.rules,e=this.props.onCancel,l=this.onFormChange;return s().createElement("div",{className:"np_add_contact_add"},s().createElement(u.Dialog,{className:"form",title:this.props.defaultValue?"编辑联系人":"新增联系人",visible:this.props.visible,onCancel:e},s().createElement(u.Dialog.Body,null,s().createElement(u.Form,{ref:function(e){return t.form=e},model:n,rules:a,labelPosition:"left",labelWidth:"86"},s().createElement(u.Form.Item,{label:"联系人姓名",prop:"name"},s().createElement(u.Input,{value:n.name,onChange:function(e){return l("name",e)}})),s().createElement(u.Form.Item,{label:"邮箱",prop:"email"},s().createElement(u.Input,{value:n.email,onChange:function(e){return l("email",e)}})),s().createElement(u.Form.Item,{label:"手机号",prop:"phoneNumber"},s().createElement(u.Input,{value:n.phoneNumber,onChange:function(e){return l("phoneNumber",e)}})),s().createElement(u.Form.Item,{label:"标签",prop:"tags"},s().createElement(d.RS,{className:"muti_select",tags:!0,tokenSeparators:[" ",","],onChange:function(e){return l("tags",e.filter(function(e){return 0<e.trim().length}))},value:n.tags,optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入标签后按回车"},(this.props.tagList||[]).map(function(e,t){return s().createElement(d.Wx,{key:t,value:e.name,label:e.name},e.name)}))))),s().createElement(u.Dialog.Footer,{className:"dialog-footer"},s().createElement(u.Button,{onClick:e},"取消"),s().createElement(u.Button,{type:"primary",onClick:this.commit},"确定"))))},e}(s().Component);const f=(0,n.connect)(function(e){e=c()({},e);return c()({},e[h])},function(t){return{getTagList:function(e){return t({type:h+"/getTagList",payload:e})}}})(o);o.propTypes={visible:t().bool,onAdd:t().func,onCancel:t().func,defaultValue:t().shape({id:t().string.isRequired,name:t().string,email:t().string,phoneNumber:t().oneOfType([t().string,t().number]),tags:t().array})};var o=r(81506),g=r.n(o),v={visible:!1,steps:1,file:null,tags:[],newTags:[],fileTest:!0,fileResult:null,dragenter:!1,uploading:!1},E=function(t){function e(e){var a=t.call(this,e)||this;return a.show=function(){a.state.visible?a.setState(c()({},Object.assign({},v))):a.setState({visible:!0})},a.dragInit=function(){var e=a.state.timer,t=g()(a).drag;document.addEventListener("dragover",function(){clearTimeout(e),e=setTimeout(function(){t.style.display="none"},200),a.setState({timer:e}),t.style.display="block"}),t.ondragenter=function(e){a.setState({dragenter:!0})},t.ondragover=function(){return!1},t.ondragleave=function(){a.setState({dragenter:!1})},t.ondrop=function(e){e=e.dataTransfer.files[0];return"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(m.Z.warning("只支持 xlsx 格式,请重新上传"),a.setState({fileTest:!1,dragenter:!1})):a.setState({file:e,fileTest:!0,dragenter:!1},function(e){}),!1}},a.readFile=function(e){e=e.target.files[0];"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(m.Z.warning("只支持 xlsx 格式,请重新上传"),a.setState({fileTest:!1})):a.setState({file:e,fileTest:!0},function(e){})},a.onFormChange=function(e,t){var n;a.setState({form:c()({},a.state.form,((n={})[e]=t,n))})},a.downLoadFile=function(){var e=document.createElement("a");e.style.display="none",e.href="https://yunting-1251101074.coscd.myqcloud.com/联系人模板.xlsx",document.body.appendChild(e),e.click(),e.remove()},a.upload=function(){a.setState({uploading:!0},function(){var t=a.xhr=new XMLHttpRequest;t.open("POST","/api/contact/import"),t.onreadystatechange=function(){var e;4===t.readyState&&(a.setState({steps:a.state.steps+1}),200===t.status?2e4===(e=JSON.parse(t.responseText)).code?(a.props.onBatchAdd&&a.props.onBatchAdd(e.result.successfulList),a.setState({fileResult:e.result,uploading:!1})):(a.setState({fileResult:null,uploading:!1}),m.Z.error(e.msg)):(a.setState({fileResult:null,uploading:!1}),m.Z.error("上传出错，请检查文件格式或联系管理员")))},t.upload.onprogress=function(e){e.lengthComputable&&(e=Math.floor(e.loaded/e.total*100),a.setState({percent:e}))},t.onabort=function(e){m.Z.error("上传已中断")};var e=new FormData;e.append("file",a.state.file),e.append("tags",JSON.stringify(a.state.tags)),e.append("newTags",JSON.stringify(a.state.newTags)),e.append("uploadType",a.props.uploadType||"ALL"),t.send(e)})},a.step1=function(){setTimeout(function(){return a.wrap.appendChild(a.drag)},10);var e=a.state,t=(e.steps,e.dragenter),n=e.fileTest,e=e.file;return s().createElement("div",null,s().createElement("div",{ref:function(e){return a.wrap=e},className:"wrap",style:{backgroundColor:t?"#e9eaec":"",borderColor:n?"":"red"}},s().createElement("input",{style:{display:"none"},ref:function(e){return a.file=e},accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",type:"file",onChange:function(e){return a.readFile(e)}}),!e&&s().createElement(i.Fragment,null,s().createElement("div",{className:"upload"},s().createElement("div",{className:"add",onClick:function(e){return a.file.click()}},s().createElement("i",{className:"icon-cem_upload-files"})),s().createElement("b",null,s().createElement("span",{onClick:function(e){return a.file.click()}},"点击"),"或将EXCEL文件拖拽到这里上传"),s().createElement("p",null,s().createElement("span",{onClick:function(e){return a.downLoadFile()}},"下载标准模板")),s().createElement("div",{className:"accept",style:{color:n?"":"#D96969"}},"（只支持 xlsx 格式）"))),e&&s().createElement("p",{className:"file_name"},s().createElement("img",{src:r(8332)}),s().createElement("div",null,e.name),s().createElement("span",{onClick:function(){return a.file.click()}},"重新上传"))))},a.step2=function(){var e=a.state,t=e.tags,e=e.newTags;return s().createElement("div",{className:"step2_wrap"},s().createElement("h3",null,"你可以给导入的「所有客户」打上标签"),s().createElement("div",null,s().createElement(d.RS,{className:"muti_select",tags:!0,tokenSeparators:[" ",","],onChange:function(e){return a.setState({tags:e.filter(function(e){return 0<e.trim().length})})},value:t,optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入标签后按回车"},(a.props.tagList||[]).map(function(e,t){return s().createElement(d.Wx,{key:t,value:e.name,label:e.name},e.name)}))),s().createElement("h3",null,"仅给导入的「新客户」打上标签"),s().createElement("div",null,s().createElement(d.RS,{className:"muti_select",tags:!0,tokenSeparators:[" ",","],onChange:function(e){return a.setState({newTags:e.filter(function(e){return 0<e.trim().length})})},value:e,optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入标签后按回车"},(a.props.tagList||[]).map(function(e,t){return s().createElement(d.Wx,{key:t,value:e.name,label:e.name},e.name)}))),s().createElement("p",null,"注：你可以跳过此步"))},a.step3=function(){var e=a.state.fileResult;a.props.uploadType;return s().createElement("div",{className:"step3_wrap"},s().createElement("i",{className:e?"icon-cem_complete1":"icon-cem_close-window",style:{color:e?"#15B374":"#D96969"}}),s().createElement("h3",null,e?"成功导入"+e.successfulCount+"个有效联系人":"上传失败，请再次尝试"),e&&a.getResultGraph(e),s().createElement("p",null,e?"系统已将这些联系人保存到联系人模块当中，方便你下次使用":"出现错误，上传失败，可以再次尝试"),!e&&s().createElement(u.Button,{type:"primary",onClick:function(){return a.setState({file:null,steps:1})}},"重新上传"))},a.getResultGraph=function(e){var t=e.onlyPhoneNumberCount,n=e.onlyEmailCount,a=e.successfulCount,l=e.failedCount,e=e.bothSuccessfulCount;return s().createElement("div",{className:"result-graph-wrapper"},s().createElement("div",{className:"description total"},s().createElement("img",{src:r(87569)}),s().createElement("div",null,s().createElement("div",null,"共导入"),s().createElement("div",null,a+l,"行"))),0<l&&s().createElement("div",{className:"description invalid"},s().createElement("img",{src:r(23318)}),s().createElement("div",null,s().createElement("div",null,"无效（导入不成功）"),s().createElement("div",null,l,"行"))),0<e&&s().createElement("div",{className:"description both"},s().createElement("div",null,s().createElement("div",null,"手机号+邮箱"),s().createElement("div",null,e,"行")),s().createElement("img",{src:r(521)})),0<t||0<e?s().createElement("div",{className:0<e?"ring valid-phoneNo collapse":"ring valid-phoneNo"},"手机号",0<t&&s().createElement("div",{className:"description phoneNo"},s().createElement("div",null,s().createElement("div",null,"仅手机号"),s().createElement("div",null,t,"行")),s().createElement("img",{src:r(64313)}))):null,0<n||0<e?s().createElement("div",{className:0<e?"ring valid-email collapse":"ring valid-email"},"邮箱",0<n&&s().createElement("div",{className:"description email"},s().createElement("div",null,s().createElement("div",null,"仅邮箱"),s().createElement("div",null,n,"行")),s().createElement("img",{src:r(12319)}))):null)},a.pre=function(){a.setState({steps:a.state.steps-1})},a.next=function(){a.setState({steps:a.state.steps+1})},a._handleOnCancel=function(){a.setState(c()({},Object.assign({},v)))},a.state=c()({},Object.assign({},v)),a}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.dragInit()},n.render=function(){var t=this,e=this.state,n=e.steps,a=e.file,l=e.visible,e=e.uploading;return s().createElement("div",{className:"np_add_contact_batch_add"},s().createElement(u.Dialog,{className:"form",title:"批量上传",visible:l,onCancel:this._handleOnCancel},s().createElement(u.Loading,{loading:e},s().createElement(u.Dialog.Body,null,s().createElement("header",null,s().createElement("div",{className:1===n?"sel":""},s().createElement("p",null,s().createElement("span",null,"1"),"选择表格")),s().createElement("div",{className:2===n?"sel":""},s().createElement("p",null,s().createElement("span",null,"2"),"打上标签")),s().createElement("div",{className:3===n?"sel":""},s().createElement("p",null,s().createElement("span",null,"3"),"导入结果"))),this["step"+n]()),s().createElement(u.Dialog.Footer,{className:"dialog-footer"},n<3&&s().createElement(u.Button,{onClick:1===n?this._handleOnCancel:this.pre},1===n?"取消":"上一步"),s().createElement(u.Button,{type:"primary",disabled:!a||3<n||e,onClick:3===n?this._handleOnCancel:2===n?this.upload:this.next},3===n?"确定":2===n?"确定上传":"下一步")))),s().createElement("div",{ref:function(e){return t.drag=e},className:"drag",style:{zIndex:1===n?"":"-1"}}))},e}(s().Component);E.propTypes={};var C=l.Z.research.addContact,l=function(t){function e(e){e=t.call(this,e)||this;return e.state={visible:!1,batchVisible:!1},e}return a()(e,t),e.prototype.render=function(){var t=this,e=this.state,n=e.visible;e.batchVisible;return s().createElement("div",{className:"np_add_contact"},s().createElement(u.Button,{onClick:function(){return t.setState({visible:!0})}},"新增客户"),s().createElement(u.Button,{type:"/nps/contact"===location.pathname?"primary":"",onClick:function(){t.batchRef.show()}},"批量导入"),s().createElement(f,c()({},this.props,{visible:n,onCancel:function(){return t.setState({visible:!1})}})),s().createElement(E,c()({ref:function(e){return t.batchRef=e}},this.props)))},e}(s().Component);const N=(0,n.connect)(function(e){e=c()({},e);return c()({},e[C])},function(t){return{getTagList:function(e){return t({type:C+"/getTagList",payload:e})}}})(l);l.propTypes={required:t().array,onAdd:t().func,onBatchAdd:t().func,uploadType:t().string}},7762:(e,t,u)=>{"use strict";u.r(t),u.d(t,{default:()=>Z});var n=u(37316),a=u.n(n),l=u(67154),f=u.n(l),r=u(93913),c=u.n(r),t=u(85354),i=u.n(t),w=u(67294),L=u.n(w),_=u(92360),g=u(55815),x=u(35303),s=u(51474),o=u(87219),I=u(43036),n=u(23279),m=u.n(n),p=u(19335),l=u(55609),r=u(64396),d=r.Z.research.distributeEdit,h="#联系人姓名#";t=function(t){function e(e){var i=t.call(this,e)||this;return i._handleScroll=function(){var e=i.props,t=e.fetchTemplateList,n=e.hasMore,a=e.listLoading,l=e.pageIndex,r=i.scrollContainer,c=r.scrollTop,e=r.offsetHeight,e=r.scrollHeight-c-e;i.setState({bottomDistance:e}),e<30?(i.setState({tipShow:!0}),n&&!a&&t&&t({pageIndex:l+1})):i.setState({tipShow:!1})},i._handleOnClose=function(){i.setState({visible:!1,detail:void 0,type:"",tipShow:!1,value:""})},i._handleOnConfirm=function(){var e=i.props,t=e.save,n=e.channelList,a=e.template.list,e=i.state,l=e.type,r=e.value,c=a.find(function(e){return e.id===r});t({channelList:(0,o.ZP)(n,function(e){e=e.find(function(e){return e.channel===l});e&&(e.templateId=c.id,e.templateName=c.name,e.checked=!0)})}),i._handleOnClose()},i._handleOnTemplateChange=function(e){i.setState({value:e})},i.state={visible:!1,type:"",tipShow:!1,detail:void 0,value:""},i}i()(e,t);var n=e.prototype;return n.show=function(e){var t=this,n=e.type,e=e.id;this.setState({visible:!0,type:n,value:e},function(){return t.props.fetchTemplateList({channel:n,pageIndex:1})})},n.render=function(){var t=this,e=this.state,n=e.visible,a=e.type,l=e.tipShow,r=e.value,c=this.props,i=c.template,s=c.loading,o=i.list,e=i.total,c=i.hasMore,i=o.find(function(e){return e.id===r});return L().createElement(p.Z,{className:"yt_template_drawer_wrapper",maskClosable:!0,keyboard:!1,closeable:!0,visible:n,onClose:this._handleOnClose,width:520,placement:"right",title:("SMS"===a?"短信":"邮件")+"模板选择",bodyStyle:{paddingBottom:80},footer:L().createElement("div",{className:"footer"},L().createElement("span",{className:"manage",onClick:function(){return window.open("/research/setting?type="+a.toLowerCase())}},L().createElement("i",{className:"icon-cem_more-two"}),"管理模板"),L().createElement("div",null,L().createElement(_.Button,{onClick:this._handleOnClose},"取消"),L().createElement(_.Button,{type:"primary",onClick:this._handleOnConfirm},"确定")))},L().createElement("div",{className:"template-list-wrapper"},L().createElement("div",{className:"template-list-body",ref:function(e){return t.scrollContainer=e},onScroll:m()(this._handleScroll,500)},0===e?L().createElement("div",{className:"noDataTip"},L().createElement("img",{src:u(12839)})):L().createElement(L().Fragment,null,L().createElement("div",{className:"template-item title"},"模板名称"),L().createElement(_.Radio.Group,{style:{width:"100%"},value:r,onChange:this._handleOnTemplateChange},o.map(function(e){return L().createElement(_.Radio,{value:e.id,key:e.id,className:"template-item"},e.name)})))),L().createElement("div",{className:"template-list-footer"},L().createElement("div",null,"共 ",L().createElement("span",null,e)," 项"),L().createElement("div",{style:{opacity:s||l?1:0,transition:"opacity 0.3s"}},c?"加载更多数据中…":"没有更多数据"))),i&&L().createElement("div",{className:"preview",style:{display:n?"block":"none"}},L().createElement("div",{className:"mobile"},a&&L().createElement("img",{src:u(52921)("./iPhone_"+a.toLowerCase()+".png")}),i.id?"SMS"===a?L().createElement("div",{className:"msg",dangerouslySetInnerHTML:{__html:"【"+i.signatureName+"】"+i.content+"。问卷链接：<span style='color: #0847A6'>https://cast.vip/u712sw</span>，退订回T"}}):L().createElement("div",{className:"email"},L().createElement("div",{className:"title"},""+i.name),L().createElement("div",null,L().createElement("span",null,"客户体验中心"),L().createElement("span",null,"详情")),L().createElement("div",null,L().createElement("span",null,"NPS调查问卷"),L().createElement("span",null,i.signatureName)),L().createElement("div",{dangerouslySetInnerHTML:{__html:'<span style="color: #262626">'+i.content.replace(/#联系人姓名#/g,"Tony").replace(/ /g,"&nbsp;").replace(/\n/g,"</br>").replace(new RegExp(h,"g"),'<span style="color: #0847A6">'+h+"</span>")+"</span>"}}),L().createElement("img",{src:i.img||u(19119)}),L().createElement("div",null,"如果无法正常访问，请访问链接",L().createElement("span",null,"https://beta.yuntingai.com/"),L().createElement("br",null),L().createElement("span",null,"price/realTimePrice"))):"")))},e}(L().PureComponent);const v=(0,l.connect)(function(e){var t=e.loading,e=a()(e,["loading"]);return{template:e[d].template,channelList:e[d].channelList,loading:t.effects[d+"/fetchTemplateList"]||!1}},function(t){return{fetchTemplateList:function(e){return t({type:d+"/fetchTemplateList",payload:e})},save:function(e){return t({type:d+"/save",payload:e})}}},null,{withRef:!0})(t),E=function(t){function e(e){var l=t.call(this,e)||this;return l._handleOnChannelChange=function(t,n){var e=l.props,a=e.onChange,e=e.channelList;!n.templateName&&t?l.drawerRef.wrappedInstance.show({type:n.channel,id:n.templateId}):a&&a({channelList:(0,o.ZP)(e,function(e){e=e.find(function(e){return e.channel===n.channel});e&&(e.checked=t)})})},l._handleOnTemplateChange=function(e){l.drawerRef.wrappedInstance.show({type:e.channel,id:e.templateId})},l.state={contactList:void 0,contactCount:{SMS:0,EMAIL:0}},l}i()(e,t),e.getDerivedStateFromProps=function(e,t){if(JSON.stringify(e.list)!==JSON.stringify(t.contactList))return{contactList:e.list,contactCount:e.list.reduce(function(e,t){return t.phoneNumber&&(e.SMS+=1),t.email&&(e.EMAIL+=1),e},{EMAIL:0,SMS:0})}};var n=e.prototype;return n.componentDidMount=function(){var r=this,e=document.getElementById("draggable_zone");e&&s.ZP.create(e,{group:"draggable_zone",animation:150,filter:".undraggable",draggable:".draggable",handle:".icon-cem_move",onEnd:function(e){var t=r.props,n=t.onChange,t=t.channelList,a=e.newIndex,l=e.oldIndex;a!==l&&n&&n({channelList:(0,o.ZP)(t,function(e){var t=e.splice(l,1)[0];e.splice(a,0,t)})})}})},n.render=function(){var n=this,e=this.props,t=e.channelList,a=e.onChange,e=e.sendType,l=this.state.contactCount;return L().createElement("div",{className:"channel-choose"},L().createElement("div",{className:"channel_config"},L().createElement("span",{className:"label"},"分发渠道"),L().createElement("div",{className:"config"},L().createElement("span",null,"请选择本次分发的渠道"),L().createElement("div",{className:"colum_item title"},L().createElement("span",{className:"col1"},"渠道"),L().createElement("span",{className:"col2"},"模板"),L().createElement("span",{className:"col4"},"客户数"),L().createElement("span",{className:"col3"},"操作")),L().createElement("div",{id:"draggable_zone"},t.map(function(t){return L().createElement("div",{className:"colum_item draggable",key:t.channel},L().createElement("i",{className:"icon-cem_move"}),L().createElement("span",{className:"col1"},L().createElement(_.Checkbox,{checked:t.checked,onChange:function(e){return n._handleOnChannelChange(e,t)}},t.channelName)),L().createElement("span",{className:"col2"},t.templateName),L().createElement("span",{className:"col4"},l[t.channel]),L().createElement("span",{className:"col3 operator",onClick:function(){return n._handleOnTemplateChange(t)}},t.templateName?"切换模板":""))})))),L().createElement("div",{className:"channel_config"},L().createElement("span",{className:"label"},"渠道策略"),L().createElement("div",{className:"config"},L().createElement(_.Radio.Group,{value:e,onChange:function(e){return a&&a({sendType:e})}},L().createElement(_.Radio,{value:"WHOLE"},"全部发送"),L().createElement(_.Radio,{value:"PRIORITY"},"优先发送")),L().createElement(I.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:"上述渠道将按从上到下顺序依次发送，如果发送成功则不再重复发送，可拖拽排序"},L().createElement("i",{className:"icon-cem_file1",style:{marginLeft:4,color:"#8c8c8c"}})))),L().createElement(v,{ref:function(e){return n.drawerRef=e}}))},e}(L().PureComponent);var P=u(66165),D=u(29383),A=function(t){function e(e){e=t.call(this,e)||this;return e.state={defaultChecked:!1},e}i()(e,t),e.getDerivedStateFromProps=function(e,t){return f()({},e)};var n=e.prototype;return n.handleClick=function(e){var t=this.state,n=t.type,a=t.defaultChecked,l=t.selectedList,t=t.totalList;"checkAll"===n?a?this.props.onChange([]):this.props.onChange(t):(-1<(t=l.indexOf(e))?l.splice(t,1):l.push(e),this.props.onChange(l)),this.setState({defaultChecked:!a})},n.render=function(){var t=this,e=this.state,n=e.type,a=e.defaultChecked,l=e.indeterminate,r=e.uniqueId,e="customized-checkobx";return a?e="customized-checkobx checked":"checkAll"===n&&l&&(e="customized-checkobx indeterminate"),L().createElement("div",{className:"customized-checkobx-wrapper"},L().createElement("div",{className:e,onClick:function(e){e.stopPropagation(),t.handleClick(r)}}))},e}(L().PureComponent),O=u(61193),C=function(a){function e(){for(var u,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(u=a.call.apply(a,[this].concat(t))||this).handleReset=function(){var e=u.props,t=e.saveState,e=e.npsDispatch.contact;t({selectedContact:{list:[],currpageList:[],pageIndex:1,pageSize:20},contact:f()({},e,{selectedList:[]})})},u.handleDelete=function(e){var t=u.props,n=t.saveState,a=t.npsDispatch,l=a.contact,r=a.contact.selectedList,c=a.selectedContact,i=a.selectedContact,s=i.list,a=i.currpageList,i=t.handleCheckboxStyle,t=JSON.parse(JSON.stringify(s)),s=JSON.parse(JSON.stringify(a)),a=t.map(function(e){return e.id}).indexOf(e);t.splice(a,1);a=s.map(function(e){return e.id}).indexOf(e);s.splice(a,1);a=JSON.parse(JSON.stringify(r)),r=a.indexOf(e);a.splice(r,1);e=t.filter(function(e){return e.phoneNumber}).length,r=t.filter(function(e){return e.email}).length;n({selectedContact:f()({},c,{list:t,validPhoneNum:e,validEmailNum:r,currpageList:s}),contact:f()({},l,{selectedList:a})}),i()},u.handleOpenModal=function(){var e=u.props,t=e.saveState,n=e.fetchContacts,e=e.npsDispatch.contact;t({contact:f()({},e,{modalShow:!0,checkAllStatus:{manualChecked:!1,autoChecked:!1,indeterminate:!1}})}),n()},u.handleCloseModal=function(){var e=u.props,t=e.saveState,e=e.npsDispatch.contact;t({contact:f()({},e,{modalShow:!1,searchText:"",tags:[],pageIndex:1,pageSize:10,checkAllStatus:{manualChecked:!1,autoChecked:!1,indeterminate:!1}})})},u.handleConfirm=function(){var e=u.props,t=e.saveState,n=e.npsDispatch,e=n.contact,n=n.contact,a=n.selectedList,n=n.checkAllStatus.manualChecked,l=e.completeData;if(t({contact:f()({},e,{loading:!0})}),n){for(var r=l.filter(function(e){if(a.length){e=a.indexOf(e.id);if(-1<e)return a.splice(e,1),!1}return!0}),c=[],i=0;i<l.length;i++){for(var s=!1,o=0;o<r.length;o++)if(l[i].id===r[o].id){s=!0;break}s||c.push(l[i])}u.handleConfirmAction(c)}else{n=l.filter(function(e){if(a.length){e=a.indexOf(e.id);if(-1<e)return a.splice(e,1),!0}return!1});u.handleConfirmAction(n)}},u.handleConfirmAction=function(t){var e=u.props,n=e.saveState,a=e.npsDispatch,l=a.contact,e=a.selectedContact,r=a.selectedContact.pageIndex,a=(0,o.ZP)(e.list,function(e){t.forEach(function(t){e.find(function(e){return e.id===t.id})||e.push(t)})});n({selectedContact:f()({},e,{list:a},a.reduce(function(e,t){return t.phoneNumber&&(e.validPhoneNum+=1),t.email&&(e.validEmailNum+=1),e},{validEmailNum:0,validPhoneNum:0})),contact:f()({},l,{selectedList:t.map(function(e){return e.id}),modalShow:!1,loading:!1,searchText:"",tags:[],pageIndex:1,pageSize:10,checkAllStatus:{manualChecked:!1,autoChecked:!1,indeterminate:!1}})}),setTimeout(function(){u.handleManualSwitchPage(r)},0)},u.handleNameChange=function(e){var t=u.props,n=t.saveState,a=t.fetchContacts,t=t.npsDispatch.contact;n({contact:f()({},t,{name:e,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),u.nameTimer&&clearTimeout(u.nameTimer),u.nameTimer=setTimeout(function(){a().then(function(){return u.nameRef.focus()})},1500)},u.handlePhoneNumberChange=function(e){var t=u.props,n=t.saveState,a=t.fetchContacts,t=t.npsDispatch.contact;n({contact:f()({},t,{phoneNumber:e,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),u.phoneNumberTimer&&clearTimeout(u.phoneNumberTimer),u.phoneNumberTimer=setTimeout(function(){a().then(function(){return u.phoneRef.focus()})},1500)},u.handleEmailChange=function(e){var t=u.props,n=t.saveState,a=t.fetchContacts,t=t.npsDispatch.contact;n({contact:f()({},t,{email:e,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),u.emailTimer&&clearTimeout(u.emailTimer),u.emailTimer=setTimeout(function(){a().then(function(){return u.emailRef.focus()})},1500)},u.handleSwitchPage=function(e){var t=u.props,n=t.fetchContacts,a=t.saveState,t=t.npsDispatch.contact;a({contact:f()({},t,{pageIndex:e})}),n()},u.handleSwitchPageSize=function(e){var t=u.props,n=t.fetchContacts,a=t.saveState,t=t.npsDispatch.contact;a({contact:f()({},t,{pageIndex:1,pageSize:e})}),n()},u.handleRuleTypeChange=function(e,t){var n=u.props,a=n.saveState,l=n.fetchContacts,r=n.npsDispatch,n=r.contact,r=r.contact.rules;r[t].type=e,a({contact:f()({},n,{rules:r})}),0<r[t].values.length&&l()},u.handleRuleValueChange=function(e,t){var n=u.props,a=n.saveState,l=n.fetchContacts,r=n.npsDispatch,n=r.contact,r=r.contact.rules;r[t].values=e,a({contact:f()({},n,{rules:r,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),l()},u.handleAddRule=function(){var e=u.props,t=e.saveState,n=e.npsDispatch,e=n.contact,n=n.contact.rules;n.push({type:"CONTAIN",values:[]}),t({contact:f()({},e,{rules:n})})},u.handleDeleteRule=function(e){var t=u.props,n=t.saveState,a=t.fetchContacts,l=t.npsDispatch,r=l.contact,t=l.contact.rules,l=t[e].values;t.splice(e,1),0<l.length?(n({contact:f()({},r,{rules:t,pageIndex:1,dataAllFetched:!1,selectedList:[]})}),a()):n({contact:f()({},r,{rules:t})})},u.handleManualSwitchPage=function(e){var t=u.props,n=t.npsDispatch,a=n.selectedContact,l=n.selectedContact,n=l.list,l=l.pageSize,t=t.saveState,l=n.slice((e-1)*l,e*l);t({selectedContact:f()({},a,{currpageList:l,pageIndex:e})})},u.handleManualSwitchPageSize=function(e){var t=u.props,n=t.npsDispatch,a=n.selectedContact,n=n.selectedContact.list,t=t.saveState,n=n.slice(0,e);t({selectedContact:f()({},a,{currpageList:n,pageSize:e,pageIndex:1})})},u.handleAddContact=function(e){var t=u.props,n=t.npsDispatch,a=n.selectedContact,l=n.selectedContact,r=l.list,c=l.validPhoneNum,i=l.validEmailNum,s=l.pageIndex,o=t.saveState,n=t.fetchTags,l=Array.isArray(e)?e.filter(function(e){return e.phoneNumber}).length:e.phoneNumber&&0<e.phoneNumber.length?1:0,t=Array.isArray(e)?e.filter(function(e){return e.email}).length:e.email&&0<e.email.length?1:0;o({selectedContact:f()({},a,{list:Array.isArray(e)?r.concat(e):r.concat([e]),validPhoneNum:c+l,validEmailNum:i+t})}),setTimeout(function(){u.handleManualSwitchPage(s)},0),n()},u.handleRowClick=function(e){var t=e.id;u["checkOne"+e.id].handleClick(t)},u.renderPopover=function(e,t){return e?L().createElement(I.Z,{placement:"top",overlay:t},L().createElement("span",{className:"col-nps-contact-invalid"},L().createElement("i",{className:"icon-cem_invalid-save"}))):""},u}return i()(e,a),e.prototype.render=function(){var l=this,e=this.props,t=e.npsDispatch,n=t.selectedContact,a=n.list,r=n.validPhoneNum,c=n.validEmailNum,i=n.currpageList,s=n.pageIndex,o=n.pageSize,u=t.tags,m=(t.selectedTags,t.tagChecked,t.contact),p=t.contact,d=p.name,h=p.phoneNumber,f=p.email,g=p.data,v=p.total,n=p.modalShow,E=p.selectedList,C=p.checkAllStatus,N=p.loading,p=p.rules,y=(t.channel,e.saveState,e.goNext,e.handleCheck),b=e.handleCheckAll,S=O.Z.hasAuthority("NPS_CONTACT_VISIBLE"),k=O.Z.hasAuthority("NPS_CONTACT_VISIBLE")||O.Z.hasAuthority("NPS_CONTACT_HALF_VISIBLE"),t=[{label:"",prop:"paddingLeft",width:16},{label:"姓名",prop:"name",align:"left",minWidth:240},{label:"手机",prop:"phoneNumber",align:"left",minWidth:240,render:function(e){var t=e.phoneNumber,n=e.status,e=n&&n.includes("INVALID_PHONE_NUMBER"),n=t;return S||(n=n?n.substring(0,3)+"*****"+n.substring(8):""),L().createElement("span",{className:e?"col-nps-invalid":""},L().createElement(I.Z,{placement:"top",overlay:k?t:n},L().createElement("span",{className:"col-nps-contact-invalid"},n)),l.renderPopover(e,"此手机号码为无效手机，无法接收短信"))}},{label:"邮箱",prop:"email",align:"left",minWidth:360,render:function(e){var t=e.email,n=e.status,a=n&&n.includes("INVALID_EMAIL"),e=t;return S||(e=(n=e&&e.includes("@")?e.split("@"):"")&&n[0].substring(0,4)+"*****@"+n[1]),L().createElement("span",{className:a?"col-nps-invalid":""},L().createElement(I.Z,{placement:"top",overlay:k?t:e},L().createElement("span",{className:"col-nps-contact-invalid"},e)),l.renderPopover(a,"此邮箱为无效邮箱，无法接收邮件"))}},{label:"操作",prop:"operation",align:"left",width:90,render:function(e){return L().createElement("div",{className:"operations"},L().createElement("span",{onClick:function(){return l.handleDelete(e.id)}},"移除"))}},{label:"",prop:"paddingRight",width:16}],e=[{label:"",prop:"paddingLeft",width:16},{label:"",prop:"checkbox",renderHeader:function(e){return L().createElement(A,{type:"checkAll",defaultChecked:C.autoChecked,indeterminate:C.indeterminate,onChange:b})},render:function(t){return L().createElement(A,{type:"checkOne",ref:function(e){return l["checkOne"+t.id]=e},defaultChecked:t.checked||!1,onChange:y,selectedList:E,totalList:g,uniqueId:t.id})},align:"left",width:50},{label:"姓名",prop:"name",align:"left",minWidth:90,renderHeader:function(){return L().createElement("div",{className:"thead-with-search"},L().createElement("span",null,"姓名"),L().createElement(I.Z,{overlay:L().createElement(_.Input,{placeholder:"请输入姓名",ref:function(e){return l.nameRef=e},value:d,onChange:l.handleNameChange,icon:"search",disabled:N}),overlayClassName:"popup-search",placement:"bottom"},L().createElement("i",{className:"icon-cem_search"})))}},{label:"手机",prop:"phoneNumber",align:"left",minWidth:120,renderHeader:function(){return L().createElement("div",{className:"thead-with-search"},L().createElement("span",null,"手机"),L().createElement(I.Z,{overlay:L().createElement(_.Input,{placeholder:"请输入手机号",ref:function(e){return l.phoneRef=e},icon:"search",value:h,onChange:function(e){return l.handlePhoneNumberChange(e)},disabled:N}),overlayClassName:"popup-search",placement:"bottom"},L().createElement("i",{className:"icon-cem_search"})))},render:function(e){var t=e.phoneNumber,n=e.status,e=n&&n.includes("INVALID_PHONE_NUMBER"),n=t;return S||(n=n?n.substring(0,3)+"*****"+n.substring(8):""),L().createElement("span",{className:e?"col-nps-invalid":""},L().createElement(I.Z,{placement:"top",overlay:k?t:n},L().createElement("span",{className:"col-nps-contact-invalid"},n)),l.renderPopover(e,"此手机号码为无效手机，无法接收短信"))}},{label:"邮箱",prop:"email",align:"left",minWidth:160,renderHeader:function(){return L().createElement("div",{className:"thead-with-search"},L().createElement("span",null,"邮箱"),L().createElement(I.Z,{overlay:L().createElement(_.Input,{placeholder:"请输入邮箱",ref:function(e){return l.emailRef=e},icon:"search",value:f,onChange:l.handleEmailChange,disabled:N}),overlayClassName:"popup-search",placement:"bottom"},L().createElement("i",{className:"icon-cem_search"})))},render:function(e){var t=e.email,n=e.status,a=n&&n.includes("INVALID_EMAIL"),e=t;return S||(e=(n=e&&e.includes("@")?e.split("@"):"")&&n[0].substring(0,4)+"*****@"+n[1]),L().createElement("span",{className:a?"col-nps-invalid":""},L().createElement(I.Z,{placement:"top",overlay:k?t:e},L().createElement("span",{className:"col-nps-contact-invalid"},e)),l.renderPopover(a,"此邮箱为无效邮箱，无法接收邮件"))}},{label:"标签",prop:"tags",align:"left",minWidth:160,render:function(e){return e.tags.reduce(function(e,t,n,a){return t.name?(n<3?e.push(L().createElement(I.Z,{placement:"top",overlayClassName:"popup-tags",overlay:t.name},L().createElement("span",{key:t.id,title:t.name,className:"tag"},6<t.name.length?t.name.substring(0,6)+"...":t.name))):3===n&&e.push(L().createElement(I.Z,{overlayClassName:"popup-tags",overlay:a.slice(3).map(function(e){return L().createElement("span",{key:e.id,title:e.name,style:{userSelect:"none"},className:"tag"},e.name)}),placement:"top"},L().createElement("span",{key:"more",className:"tag"},"..."))),e):[]},[])}},{label:"",prop:"paddingRight",width:16}],T=[{label:"包含",value:"CONTAIN"},{label:"不包含",value:"NOTCONTAIN"}];return L().createElement("div",{className:"contact-wrapepr"},L().createElement("div",{className:"contact-header"},L().createElement("span",null,"收件客户"),L().createElement("span",{onClick:this.handleReset},"全部清空"),0<a.length&&L().createElement(w.Fragment,null,L().createElement("span",{className:"divider"},"|"),L().createElement("span",{className:"statics"},"已选中联系人 ",L().createElement("span",null,a.length)," 个，其中手机号",L().createElement("span",null," ",r," "),"个，邮箱",L().createElement("span",null," ",c," "),"个")),L().createElement("div",{className:"btns"},L().createElement(_.Button,{type:"default",onClick:this.handleOpenModal},"选择已有客户"),L().createElement(P.ZP,{onAdd:this.handleAddContact,onBatchAdd:this.handleAddContact}))),L().createElement(D.Z,{columns:t,data:i,total:a.length,emptyText:"暂无数据，请先选择联系人",currentPage:s,pageSize:o,pagePosition:"down",onPage:this.handleManualSwitchPage,pageSizeSelectorShow:!0,onPageSizeChange:this.handleManualSwitchPageSize,notLimit:!0}),L().createElement(_.Dialog,{title:"选择已有联系人",size:"small",customClass:"contact-modal",visible:n,onCancel:function(){return l.handleCloseModal()},lockScroll:!1},L().createElement(_.Dialog.Body,null,L().createElement("div",{className:"rule-config-wrapper"},L().createElement("div",null,"以下条件逐层生效过滤要选择的数据"),p.map(function(e,t){return L().createElement("div",{className:"rule-item",key:t},L().createElement("span",{style:{marginRight:0===t?"38px":"16px"}},t+1),0<t&&L().createElement("span",null,"且"),L().createElement(_.Select,{value:e.type,disabled:0===t,onChange:function(e){return l.handleRuleTypeChange(e,t)}},T.map(function(e,t){return L().createElement(_.Select.Option,{key:t,label:e.label,value:e.value},e.label)})),L().createElement(x.RS,{tokenSeparators:[" ",","],maxTagCount:5,placeholder:"请选择标签",value:e.values,onChange:function(e){return l.handleRuleValueChange(e,t)}},u.map(function(e,t){return L().createElement(x.Wx,{key:e.name,label:e.name,value:e.name},e.name)})),0<t&&L().createElement("div",{className:"clear-btn",onClick:function(){return l.handleDeleteRule(t)}},L().createElement("i",{className:"icon-cem_cancel"})))}),p.length<5&&L().createElement("div",{className:"add-more"},L().createElement("i",{className:"icon-cem_unfolding-data",onClick:this.handleAddRule}),L().createElement("span",null,"还可添加",5-p.length,"个规则"))),L().createElement(_.Loading,{loading:N,text:"拼命加载中"},L().createElement(D.Z,{columns:e,rowClassName:function(e){return E.includes(e.id)?"item active":"item"},rowKey:function(e){return e.id},onRowClick:this.handleRowClick,data:g,total:v,currentPage:m.pageIndex,pageSize:m.pageSize,pagePosition:"down",onPage:this.handleSwitchPage,pageSizeSelectorShow:!0,onPageSizeChange:this.handleSwitchPageSize,selectedCount:E.length,notLimit:!0}))),L().createElement(_.Dialog.Footer,{className:"dialog-footer"},L().createElement(_.Button,{onClick:function(){return l.handleCloseModal()}},"取消"),L().createElement(_.Button,{type:"primary",onClick:function(){return l.handleConfirm()}},"确定"))))},e}(w.PureComponent),n=u(45697),t=u.n(n),n=u(30381),N=u.n(n),y=[{label:"立即发送",value:1},{label:"定时发送",value:2}],n=function(e){var t=e.timeType,n=e.onChange,a=e.sendTime;return L().createElement("div",{className:"yt_dispatch_time_select_step_wrapper"},L().createElement("div",{className:"time_config"},L().createElement("span",{className:"label"},"分发时间"),L().createElement("div",{className:"config"},L().createElement(_.Select,{className:"select",value:t,options:y,onChange:function(e){n&&n({timeType:e,sendTime:1===e?"":a})}},y.map(function(e){return L().createElement(_.Select.Option,{value:e.value,key:e.value,label:e.label})})),L().createElement("div",{className:"tips"},1===t?"全部分发需要1~3分钟，请耐心等待":"选择定时发送时间"),1===t?"":L().createElement(L().Fragment,null,L().createElement(_.DatePicker,{className:"m_date_picker",isShowTime:!0,onFocus:function(){setTimeout(function(){var e=document.querySelector(".el-picker-panel__link-btn");e&&(e.style.display="none")},0)},value:a?N()(a)._d:"",format:"yyyy-MM-dd HH:mm",placeholder:"选择分发时间",onChange:function(e){n&&n({sendTime:e?N()(e).format("YYYY-MM-DD HH:mm"):""})},disabledDate:function(e){return e.getTime()<Date.now()-864e5}}),a?0<N()().diff(N()(a))?L().createElement("div",{className:"tips",style:{color:"#d96969"}},"选择时间不能先于当前时刻"):L().createElement("div",{className:"tips"},"此问卷将在",L().createElement("span",null,a),"发给选定的客户"):""))))};const b=n;n.propTypes={timeType:t().number,onChange:t().func,sendTime:t().string};var S=u(61409);const k=function(e){var t=e.contactQuantity,n=e.jumpState;return L().createElement("div",{className:"result-wrapper"},L().createElement("i",{className:"icon-cem_complete1"}),L().createElement("div",null,"设置成功"),L().createElement("div",null,"通过此分发任务，问卷将陆续发给",L().createElement("span",null,t,"个"),"客户， 需要1~3分钟，请耐心等待"),L().createElement("div",null,L().createElement(_.Button,{type:"default",onClick:function(){return location.href="/research/manage"}},"问卷管理"),L().createElement(_.Button,{type:"primary",onClick:function(){return S.mW.push({pathname:"/research/manage/distribute",state:n})},style:{color:"white"}},"继续分发")))};var T=u(35239),R=r.Z.research.distributeEdit,M=["选择客户","选择渠道","立即分发"],r=function(a){function e(e){var c=a.call(this,e)||this;c._handleMessage=function(e){"updateTemplate"===e.data&&c.props.fetchTemplateList({pageIndex:1})},c.routerWillLeave=function(){var e=c.props.npsDispatch.step;return 2!==e&&3!==e||"信息还未保存，确认要离开？"},c.goNext=function(){var e=c.props,t=e.npsDispatch.step;(0,e.saveState)({step:t+1})},c.goPrev=function(){var e=c.props,t=e.npsDispatch.step;(0,e.saveState)({step:t-1})},c.handleSwitchChannel=function(e){var t=c.props,n=t.npsDispatch.channel,t=t.saveState;n!==e&&t({channel:e})},c.handleClickTemplate=function(e){var t=c.props,n=t.npsDispatch,a=n.template,n=n.template.list;(0,t.saveState)({template:f()({},a,{detail:n[e]})})},c.handleTagsChange=function(e){var t=c.props,l=t.npsDispatch.tags,t=t.saveState,r=[];e.filter(function(e){return 0<e.trim().length}).forEach(function(e){for(var t=!1,n=null,a=0;a<l.length;a++)l[a].name===e&&(t=!0,n=l[a]);r.push(n=!t?{id:"",name:e}:n)}),t({selectedTags:r})};var t=e.location.state,n=t.questionnaireId,e=t.title,t=t.questionnaireType;return c.state={titles:[{title:"问卷管理",url:"/research/manage"},{title:e,url:"/research/manage/distribute",state:{id:n,title:e,questionnaireType:t}},{title:"问卷分发",url:""},{title:"分发设置",url:""}]},c}i()(e,a);var t=e.prototype;return t.componentDidMount=function(){var e=this.props,t=e.location.state,n=e.fetchParams;(0,e.init)();e=t.id,t=t.questionnaireId;n({dispatchId:e,projectId:T.t.get(T.V.curProject).id,questionnaireId:t}),this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave),window.addEventListener("message",this._handleMessage,!1)},t.componentWillUnmount=function(){this.props.clear(),window.removeEventListener("message",this._handleMessage)},t.render=function(){var e=this.props,t=e.npsDispatch,n=t.channel,a=t.selectedTags,l=t.step,r=t.selectedContact.list,c=t.sendType,i=t.channelList,s=t.timeType,o=t.sendTime,u=e.saveState,m=e.sendNps,p=e.fetchContacts,d=e.handleCheckAll,h=e.handleCheck,t=e.handleCheckboxStyle,e=this.state.titles;return L().createElement("div",{className:"nps-dispatch-wrapper without-boxshadow"},L().createElement(g.Z,{title:e}),L().createElement("div",{className:"nps-dispatch-body"},L().createElement("div",{className:"nps-dispatch-content"},4!==l&&L().createElement(w.Fragment,null,L().createElement("ul",{className:"step-indicator"},M.map(function(e,t){return L().createElement("li",{key:t,className:t===l-1?"step-indicator-item active":"step-indicator-item"},L().createElement("div",null,t+1),L().createElement("span",null,e),t<2&&L().createElement("span",null))})),1===l&&L().createElement(C,f()({},this.props,{fetchContacts:p,handleCheckAll:d,handleCheck:h,handleCheckboxStyle:t})),2===l&&L().createElement(E,{channel:n,list:r,sendType:c,channelList:i,onChange:u,handleSwitchChannel:this.handleSwitchChannel}),3===l&&L().createElement(b,{timeType:s,sendTime:o,onChange:u})),4===l&&L().createElement(k,{jumpState:e[1].state,contactQuantity:r.length}))),4!==l&&L().createElement("div",{className:"buttom_zone"},1===l?L().createElement("dvi",{className:"tag"},L().createElement("span",null,"发送后打上标签"),L().createElement("span",null,L().createElement(x.RS,{className:"select-wrapper",placeholder:"选择或新建标签",tags:!0,tokenSeparators:[" ",","],value:0<a.length?a.map(function(e){return e.name}):[],onChange:this.handleTagsChange},this.props.npsDispatch.tags.map(function(e){return L().createElement(x.Wx,{key:e.name,label:e.name,value:e.name},e.name)})))):L().createElement(_.Button,{onClick:this.goPrev},"上一步"),L().createElement(_.Button,{type:"primary",disabled:this.isNextDisabled,onClick:3===l?m:this.goNext},"下一步")))},c()(e,[{key:"isNextDisabled",get:function(){var e=this.props.npsDispatch,t=e.selectedContact.list,n=e.channelList,a=e.step,l=e.sendTime,r=e.timeType,e=e.isNextEnabled;return 1===a?!t.length:2===a?!n.reduce(function(e,t){return t.checked||e},!1):3!==a||(!e||!(1===r||2===r&&l&&N()().diff(N()(l))<0))}}]),e}(w.Component);const Z=(0,l.connect)(function(e){var t=e.loading;return{npsDispatch:a()(e,["loading"])[R],templateListLoading:t.effects[R+"/fetchTemplateList"]||!1}},function(t){return{saveState:function(e){return t({type:R+"/save",payload:e})},fetchParams:function(e){return t({type:R+"/fetchParams",payload:e})},fetchNpsDetail:function(e){return t({type:R+"/fetchNpsDetail",payload:e})},sendNps:function(){return t({type:R+"/sendNps"})},fetchContacts:function(e){return t({type:R+"/fetchContacts",payload:e})},handleCheckAll:function(){return t({type:R+"/handleCheckAll"})},handleCheck:function(e){return t({type:R+"/handleCheck",payload:e})},fetchTags:function(){return t({type:R+"/fetchTags"})},init:function(){return t({type:R+"/init"})},handleCheckboxStyle:function(){return t({type:R+"/handleCheckboxStyle"})},clear:function(){return t({type:R+"/clear"})},fetchTemplateList:function(e){return t({type:R+"/fetchTemplateList",payload:e})}}},null)(r)},52921:(e,t,n)=>{var a={"./iPhone_email.png":18902,"./iPhone_sms.png":92634};function l(e){e=r(e);return n(e)}function r(e){if(n.o(a,e))return a[e];e=new Error("Cannot find module '"+e+"'");throw e.code="MODULE_NOT_FOUND",e}l.keys=function(){return Object.keys(a)},l.resolve=r,(e.exports=l).id=52921}}]);