(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5585],{89578:(e,t,n)=>{"use strict";n.r(t)},52110:(e,t,n)=>{var s=n(92360).Message;e.exports=function(e){"use strict";var t,n,w,o,a,i=window.document,r=window,b=e;b&&void 0===b.draggable&&(t=b.util.dom,n="getSelection"in r?function(){r.getSelection().removeAllRanges()}:function(){i.selection.empty()},w=2,o=100,a=80,b.draggable=function(e){this.jm=e,this.e_canvas=null,this.canvas_ctx=null,this.shadow=null,this.shadow_w=0,this.shadow_h=0,this.active_node=null,this.target_node=null,this.target_direct=null,this.client_w=0,this.client_h=0,this.offset_x=0,this.offset_y=0,this.hlookup_delay=0,this.hlookup_timer=0,this.capture=!1,this.moved=!1},b.draggable.prototype={init:function(){this._create_canvas(),this._create_shadow(),this._event_bind()},resize:function(){this.jm.view.e_nodes.appendChild(this.shadow),this.e_canvas.width=this.jm.view.size.w-4,this.e_canvas.height=this.jm.view.size.h-4},_create_canvas:function(){var e=i.createElement("canvas");this.jm.view.e_panel.appendChild(e);var t=e.getContext("2d");this.e_canvas=e,this.canvas_ctx=t},_create_shadow:function(){var e=i.createElement("jmnode");e.style.visibility="hidden",e.style.zIndex="3",e.style.cursor="move",e.style.opacity="0.7",this.shadow=e},reset_shadow:function(e){var t=this.shadow.style;this.shadow.innerHTML=e.innerHTML,t.left=e.style.left,t.top=e.style.top,t.width=e.style.width,t.height=e.style.height,t.backgroundImage=e.style.backgroundImage,t.backgroundSize=e.style.backgroundSize,t.transform=e.style.transform,this.shadow_w=this.shadow.clientWidth,this.shadow_h=this.shadow.clientHeight},show_shadow:function(){this.moved||(this.shadow.style.visibility="visible")},hide_shadow:function(){this.shadow.style.visibility="hidden"},_magnet_shadow:function(e){e&&(this.canvas_ctx.lineWidth=w,this.canvas_ctx.strokeStyle="rgba(0,0,0,0.3)",this.canvas_ctx.lineCap="round",this._clear_lines(),this._canvas_lineto(e.sp.x,e.sp.y,e.np.x,e.np.y))},_clear_lines:function(){this.canvas_ctx.clearRect(0,0,this.jm.view.size.w,this.jm.view.size.h)},_canvas_lineto:function(e,t,n,i){this.canvas_ctx.beginPath(),this.canvas_ctx.moveTo(e,t),this.canvas_ctx.lineTo(n,i),this.canvas_ctx.stroke()},_lookup_close_node:function(){var e,t,n,i,o=this,a=this.jm.get_root(),r=a.get_location(),a=a.get_size(),a=r.x+a.w/2,s=this.shadow_w,d=this.shadow_h,l=this.shadow.offsetLeft,c=this.shadow.offsetTop,h=a<=l+s/2?b.direction.right:b.direction.left,u=this.jm.mind.nodes,_=null,f=Number.MAX_VALUE,p=0,m=null,v=null,g=null,y={};for(t in Object.keys(u).forEach(function(e){u[e].data.level+1===o.active_node.data.level&&!1!==u[e]._data.layout.visible&&(y[e]=u[e])}),y)!(_=y[t]).isroot&&_.direction!=h||_.id==this.active_node.id||(i=_.get_size(),e=_.get_location(),i=h==b.direction.right?(p=Math.abs(l-e.x-i.w)+Math.abs(c+d/2-e.y-i.h/2),n={x:e.x+i.w-w,y:e.y+i.h/2},{x:l+w,y:c+d/2}):(p=Math.abs(l+s-e.x)+Math.abs(c+d/2-e.y-i.h/2),n={x:e.x+w,y:e.y+i.h/2},{x:l+s-w,y:c+d/2}),p<f&&(m=_,v=n,g=i,f=p));return m?{node:m,direction:h,sp:g,np:v}:null},lookup_close_node:function(){var e=this._lookup_close_node();e&&this.active_node.data.level===e.node.data.level+1&&(this._magnet_shadow(e),this.target_node=e.node,this.target_direct=e.direction)},_event_bind:function(){var n=this,i=!1,e=this.jm.view.container;t.add_event(e,"mousedown",function(e){var t=e||event;setTimeout(function(){i&&n.dragstart.call(n,t)},30)}),t.add_event(e,"mousemove",function(e){i=!0;e=e||event;n.drag.call(n,e)}),t.add_event(e,"mouseup",function(e){i=!1;e=e||event;n.dragend.call(n,e)}),t.add_event(e,"touchstart",function(e){e=e||event;n.dragstart.call(n,e)}),t.add_event(e,"touchmove",function(e){e=e||event;n.drag.call(n,e)}),t.add_event(e,"touchend",function(e){e=e||event;n.dragend.call(n,e)})},dragstart:function(e){var t,n,i;this.jm.get_editable()&&(this.capture||(this.active_node=null,n=this.jm.view,"jmnode"!=(t=e.target||event.srcElement).tagName.toLowerCase()||(n=n.get_binded_nodeid(t))&&((n=this.jm.get_node(n)).isroot||(this.reset_shadow(t),this.active_node=n,this.offset_x=(e.clientX||e.touches[0].clientX)-t.offsetLeft,this.offset_y=(e.clientY||e.touches[0].clientY)-t.offsetTop,this.client_hw=Math.floor(t.clientWidth/2),this.client_hh=Math.floor(t.clientHeight/2),0!=this.hlookup_delay&&r.clearTimeout(this.hlookup_delay),0!=this.hlookup_timer&&r.clearInterval(this.hlookup_timer),(i=this).hlookup_delay=r.setTimeout(function(){i.hlookup_delay=0,i.hlookup_timer=r.setInterval(function(){i.lookup_close_node.call(i)},a)},o),this.capture=!0))))},drag:function(e){var t;this.jm.get_editable()&&this.capture&&(e.preventDefault(),this.show_shadow(),this.moved=!0,n(),t=(e.clientX||e.touches[0].clientX)-this.offset_x,e=(e.clientY||e.touches[0].clientY)-this.offset_y,this.client_hw,this.client_hh,this.shadow.style.left=t+"px",this.shadow.style.top=e+"px",n())},dragend:function(e){var t,n,i;this.jm.get_editable()&&(this.capture&&(0!=this.hlookup_delay&&(r.clearTimeout(this.hlookup_delay),this.hlookup_delay=0,this._clear_lines()),0!=this.hlookup_timer&&(r.clearInterval(this.hlookup_timer),this.hlookup_timer=0,this._clear_lines()),this.moved&&(t=this.active_node,n=this.target_node,i=this.target_direct,1!==t.parent.children.length?this.move_node(t,n,i):t.parent!==n&&n&&s.warning("一个枝干必须要有一个末级指标，如果不需要该枝干，删除即可")),this.hide_shadow()),this.moved=!1,this.capture=!1)},move_node:function(e,t,n){var i=this.shadow.offsetTop;if(t&&e&&!b.node.inherited(e,t)){for(var o,a=t.children,r=a.length,s=null,d=Number.MAX_VALUE,l=null,c="_last_";r--;)(s=a[r]).direction!=n||s.id==e.id||0<(o=s.get_location().y-i)&&o<d&&(d=o,l=s,c="_first_");l&&(c=l.id),this.jm.move_node(e.id,c,t.id,n)}this.active_node=null,this.target_node=null,this.target_direct=null},jm_event_handle:function(e,t){e===b.event_type.resize&&this.resize()}},e=new b.plugin("draggable",function(e){var n=new b.draggable(e);n.init(),e.add_event_listener(function(e,t){n.jm_event_handle.call(n,e,t)})}),b.register_plugin(e))}},86277:(e,t,n)=>{function i(){}var o,a,r,c,s,d,p,l,h,u;o="undefined"!=typeof window?window:n.g,l="jsMind",h="0.4.6",n="hizzgdev@163.com",u="undefined"==typeof console?{log:i,debug:i,error:i,warn:i,info:i}:console,e.exports||void 0===o[l]?(a=o.document,r=function(e){return a.createElement(e)},c=function(e,t){e.hasChildNodes()?e.firstChild.nodeValue=t:e.appendChild(a.createTextNode(t))},s=function(e,t){t instanceof HTMLElement?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),d={container:"",editable:!1,theme:null,mode:"full",support_html:!0,view:{engine:"canvas",hmargin:100,vmargin:50,line_width:2,line_color:"#555"},layout:{hspace:30,vspace:20,pspace:13},default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!0},shortcut:{enable:!0,handles:{},mapping:{addchild:45,addbrother:13,editnode:113,delnode:46,toggle:32,left:37,up:38,right:39,down:40}}},(p=function e(t){(e.current=this).version=h;var n={};e.util.json.merge(n,d),e.util.json.merge(n,t),n.container?(this.options=n,this.inited=!1,this.mind=null,this.event_handles=[],this.init()):u.error("the options.container should not be null or empty.")}).direction={left:-1,center:0,right:1},p.event_type={show:1,resize:2,edit:3,select:4},p.key={meta:8192,ctrl:4096,alt:2048,shift:1024},(p.node=function(e,t,n,i,o,a,r,s){e?"number"==typeof t?(void 0===s&&(s=!0),this.id=e,this.index=t,this.topic=n,this.data=i||{},this.isroot=o,this.parent=a,this.direction=r,this.expanded=!!s,this.children=[],this._data={}):u.error("invalid node index"):u.error("invalid nodeid")}).compare=function(e,t){e=e.index,t=t.index;return 0<=e&&0<=t?e-t:-1==e&&-1==t?0:-1==e?1:-1==t?-1:0},p.node.inherited=function(e,t){if(e&&t){if(e.id===t.id)return!0;if(e.isroot)return!0;for(var n=e.id,i=t;!i.isroot;)if((i=i.parent).id===n)return!0}return!1},p.node.prototype={get_location:function(){var e=this._data.view;return{x:e.abs_x,y:e.abs_y}},get_size:function(){var e=this._data.view;return{w:e.width,h:e.height}}},(p.mind=function(){this.name=null,this.author=null,this.version=null,this.root=null,this.selected=null,this.nodes={}}).prototype={get_node:function(e){return e in this.nodes?this.nodes[e]:(u.warn("the node[id="+e+"] can not be found"),null)},set_root:function(e,t,n){null==this.root?(this.root=new p.node(e,0,t,n,!0),this._put_node(this.root)):u.error("root node is already exist")},add_node:function(e,t,n,i,o,a,r){if(!p.util.is_node(e)){var s=this.get_node(e);return s?this.add_node(s,t,n,i,o,a,r):(u.error("the parent_node[id="+e+"] can not be found."),null)}s=o||-1,a=null;return a=e.isroot?(o=p.direction.right,new p.node(t,s,n,i,!1,e,o,r)):new p.node(t,s,n,i,!1,e,e.direction,r),this._put_node(a)?(e.children.push(a),this._reindex(e)):(u.error("fail, the nodeid '"+a.id+"' has been already exist."),a=null),a},insert_node_before:function(e,t,n,i){if(!p.util.is_node(e)){var o=this.get_node(e);return o?this.insert_node_before(o,t,n,i):(u.error("the node_before[id="+e+"] can not be found."),null)}o=e.index-.5;return this.add_node(e.parent,t,n,i,o)},get_node_before:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.get_node_before(t):(u.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;t=e.index-2;return 0<=t?e.parent.children[t]:null},insert_node_after:function(e,t,n,i){if(!p.util.is_node(e)){var o=this.get_node(e);return o?this.insert_node_after(o,t,n,i):(u.error("the node_after[id="+e+"] can not be found."),null)}o=e.index+.5;return this.add_node(e.parent,t,n,i,o)},get_node_after:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.get_node_after(t):(u.error("the node[id="+e+"] can not be found."),null)}if(e.isroot)return null;t=e.index;return e.parent.children.length>=t?e.parent.children[t]:null},move_node:function(e,t,n,i){if(p.util.is_node(e))return n=n||e.parent.id,this._move_node(e,t,n,i);var o=this.get_node(e);return o?this.move_node(o,t,n,i):(u.error("the node[id="+e+"] can not be found."),null)},_flow_node_direction:function(e,t){void 0===t?t=e.direction:e.direction=t;for(var n=e.children.length;n--;)this._flow_node_direction(e.children[n],t)},_move_node_internal:function(e,t){return e&&t&&("_last_"==t?(e.index=-1,this._reindex(e.parent)):"_first_"==t?(e.index=0,this._reindex(e.parent)):null!=(t=t?this.get_node(t):null)&&null!=t.parent&&t.parent.id==e.parent.id&&(e.index=t.index-.5,this._reindex(e.parent))),e},_move_node:function(e,t,n,i){if(e&&n){if(e.parent.id!=n){for(var o=e.parent.children,a=o.length;a--;)if(o[a].id==e.id){o.splice(a,1);break}this._reindex(e.parent),e.parent=this.get_node(n),e.parent.children.push(e)}e.parent.isroot?i==p.direction.left?e.direction=i:e.direction=p.direction.right:e.direction=e.parent.direction,this._move_node_internal(e,t),this._flow_node_direction(e)}return e},remove_node:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(u.error("the node[id="+e+"] can not be found."),!1)}if(!e)return u.error("fail, the node can not be found"),!1;if(e.isroot)return u.error("fail, can not remove root node"),!1;null!=this.selected&&this.selected.id==e.id&&(this.selected=null);for(var n=e.children,i=n.length;i--;)this.remove_node(n[i]);n.length=0;for(var o,a=e.parent.children,r=a.length;r--;)if(a[r].id==e.id){a.splice(r,1);break}for(o in this._reindex(e.parent),delete this.nodes[e.id],e)delete e[o];return!(e=null)},_put_node:function(e){return e.id in this.nodes?(u.warn("the nodeid '"+e.id+"' has been already exist."),!1):(this.nodes[e.id]=e,!0)},_reindex:function(e){if(e instanceof p.node){e.children.sort(p.node.compare);for(var t=0;t<e.children.length;t++)e.children[t].index=t+1}}},p.format={node_tree:{example:{meta:{name:l,author:n,version:h},format:"node_tree",data:{id:"root",topic:"jsMind Example"}},get_mind:function(e){var t=p.format.node_tree,n=new p.mind;return n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version,t._parse(n,e.data),n},get_data:function(e){var t=p.format.node_tree,n={};return n.meta={name:e.name,author:e.author,version:e.version},n.format="node_tree",n.data=t._buildnode(e.root),n},_parse:function(e,t){var n=p.format.node_tree,i=n._extract_data(t);if(e.set_root(t.id,t.topic,i),"children"in t)for(var o=t.children,a=0;a<o.length;a++)n._extract_subnode(e,e.root,o[a])},_extract_data:function(e){var t,n={};for(t in e)"id"!=t&&"topic"!=t&&"children"!=t&&"direction"!=t&&"expanded"!=t&&(n[t]=e[t]);return n},_extract_subnode:function(e,t,n){var i=p.format.node_tree,o=i._extract_data(n),a=null;t.isroot&&(a="left"==n.direction?p.direction.left:p.direction.right);var r=e.add_node(t,n.id,n.topic,o,null,a,n.expanded);if("children"in n)for(var s=n.children,d=0;d<s.length;d++)i._extract_subnode(e,r,s[d])},_buildnode:function(e){var t=p.format.node_tree;if(e instanceof p.node){var n={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&e.parent.isroot&&(n.direction=e.direction==p.direction.left?"left":"right"),null!=e.data){var i,o=e.data;for(i in o)n[i]=o[i]}var a=e.children;if(0<a.length){n.children=[];for(var r=0;r<a.length;r++)n.children.push(t._buildnode(a[r]))}return n}}},node_array:{example:{meta:{name:l,author:n,version:h},format:"node_array",data:[{id:"root",topic:"jsMind Example",isroot:!0}]},get_mind:function(e){var t=p.format.node_array,n=new p.mind;return n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version,t._parse(n,e.data),n},get_data:function(e){var t=p.format.node_array,n={};return n.meta={name:e.name,author:e.author,version:e.version},n.format="node_array",n.data=[],t._array(e,n.data),n},_parse:function(e,t){var n=p.format.node_array,i=t.slice(0);i.reverse();t=n._extract_root(e,i);t?n._extract_subnode(e,t,i):u.error("root node can not be found")},_extract_root:function(e,t){for(var n=p.format.node_array,i=t.length;i--;)if("isroot"in t[i]&&t[i].isroot){var o=t[i],a=n._extract_data(o);return e.set_root(o.id,o.topic,a),t.splice(i,1),o.id}return null},_extract_subnode:function(e,t,n){for(var i,o,a=p.format.node_array,r=n.length,s=null,d=null,l=0;r--;)(s=n[r]).parentid==t&&(d=a._extract_data(s),o=null,(i=s.direction)&&(o="left"==i?p.direction.left:p.direction.right),e.add_node(t,s.id,s.topic,d,null,o,s.expanded),n.splice(r,1),l++,0<(o=a._extract_subnode(e,s.id,n))&&(r=n.length,l+=o));return l},_extract_data:function(e){var t,n={};for(t in e)"id"!=t&&"topic"!=t&&"parentid"!=t&&"isroot"!=t&&"direction"!=t&&"expanded"!=t&&(n[t]=e[t]);return n},_array:function(e,t){p.format.node_array._array_node(e.root,t)},_array_node:function(e,t){var n=p.format.node_array;if(e instanceof p.node){var i={id:e.id,topic:e.topic,expanded:e.expanded};if(e.parent&&(i.parentid=e.parent.id),e.isroot&&(i.isroot=!0),e.parent&&e.parent.isroot&&(i.direction=e.direction==p.direction.left?"left":"right"),null!=e.data){var o,a=e.data;for(o in a)i[o]=a[o]}t.push(i);for(var r=e.children.length,s=0;s<r;s++)n._array_node(e.children[s],t)}}},freemind:{example:{meta:{name:l,author:n,version:h},format:"freemind",data:'<map version="1.0.1"><node ID="root" TEXT="freemind Example"/></map>'},get_mind:function(e){var t=p.format.freemind,n=new p.mind;n.name=e.meta.name,n.author=e.meta.author,n.version=e.meta.version;e=e.data,e=t._parse_xml(e),e=t._find_root(e);return t._load_node(n,null,e),n},get_data:function(e){var t=p.format.freemind,n={};n.meta={name:e.name,author:e.author,version:e.version},n.format="freemind";var i=[];return i.push('<map version="1.0.1">'),t._buildmap(e.root,i),i.push("</map>"),n.data=i.join(" "),n},_parse_xml:function(e){var t=null;return window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e)),t},_find_root:function(e){for(var t=e.childNodes,n=null,i=null,o=0;o<t.length;o++)if(1==(i=t[o]).nodeType&&"map"==i.tagName){n=i;break}if(n)for(var a=n.childNodes,n=null,o=0;o<a.length;o++)if(1==(i=a[o]).nodeType&&"node"==i.tagName){n=i;break}return n},_load_node:function(e,t,n){var i=p.format.freemind,o=n.getAttribute("ID"),a=n.getAttribute("TEXT");if(null==a)for(var r,s=n.childNodes,d=0;d<s.length;d++)if(1==(r=s[d]).nodeType&&"richcontent"===r.tagName){a=r.textContent;break}var l=i._load_attributes(n),c=!("expanded"in l)||"true"==l.expanded;delete l.expanded;var h=n.getAttribute("POSITION"),u=null;h&&(u="left"==h?p.direction.left:p.direction.right),t?e.add_node(t,o,a,l,null,u,c):e.set_root(o,a,l);for(var _,f=n.childNodes,d=0;d<f.length;d++)1==(_=f[d]).nodeType&&"node"==_.tagName&&i._load_node(e,o,_)},_load_attributes:function(e){for(var t=e.childNodes,n=null,i={},o=0;o<t.length;o++)1==(n=t[o]).nodeType&&"attribute"===n.tagName&&(i[n.getAttribute("NAME")]=n.getAttribute("VALUE"));return i},_buildmap:function(e,t){var n=p.format.freemind,i=null;e.parent&&e.parent.isroot&&(i=e.direction===p.direction.left?"left":"right"),t.push("<node"),t.push('ID="'+e.id+'"'),i&&t.push('POSITION="'+i+'"'),t.push('TEXT="'+e.topic+'">'),t.push('<attribute NAME="expanded" VALUE="'+e.expanded+'"/>');var o=e.data;if(null!=o)for(var a in o)t.push('<attribute NAME="'+a+'" VALUE="'+o[a]+'"/>');for(var r=e.children,s=0;s<r.length;s++)n._buildmap(r[s],t);t.push("</node>")}}},p.util={is_node:function(e){return!!e&&e instanceof p.node},ajax:{_xhr:function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return e},_eurl:function(e){return encodeURIComponent(e)},request:function(e,t,n,i,o){var a,r=p.util.ajax,s=null,d=[];for(a in t)d.push(r._eurl(a)+"="+r._eurl(t[a]));0<d.length&&(s=d.join("&"));var l=r._xhr();l&&(l.onreadystatechange=function(){var e;4==l.readyState&&(200==l.status||0==l.status?"function"==typeof i&&(e=p.util.json.string2json(l.responseText),i(null!=e?e:l.responseText)):"function"==typeof o?o(l):u.error("xhr request failed.",l))},l.open(n=n||"GET",e,!0),l.setRequestHeader("If-Modified-Since","0"),"POST"==n?(l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),l.send(s)):l.send())},get:function(e,t){return p.util.ajax.request(e,{},"GET",t)},post:function(e,t,n){return p.util.ajax.request(e,t,"POST",n)}},dom:{add_event:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}},file:{read:function(e,t){var n=new FileReader;n.onload=function(){"function"==typeof t&&t(this.result,e.name)},n.readAsText(e)},save:function(e,t,n){var i="function"==typeof o.Blob?new Blob([e],{type:t}):((i=new(o.BlobBuilder||o.MozBlobBuilder||o.WebKitBlobBuilder||o.MSBlobBuilder)).append(e),i.getBlob(t));navigator.msSaveBlob?navigator.msSaveBlob(i,n):(t=(o.URL||o.webkitURL).createObjectURL(i),"download"in(i=r("a"))?(i.style.visibility="hidden",i.href=t,i.download=n,a.body.appendChild(i),(n=a.createEvent("MouseEvents")).initEvent("click",!0,!0),i.dispatchEvent(n),a.body.removeChild(i)):location.href=t)}},json:{json2string:function(e){if(JSON)try{return JSON.stringify(e)}catch(e){return u.warn(e),u.warn("can not convert to string"),null}},string2json:function(e){if(JSON)try{return JSON.parse(e)}catch(e){return u.warn(e),u.warn("can not parse to json"),null}},merge:function(e,t){for(var n in t)!(n in e)||"object"!=typeof e[n]||"[object object]"!=Object.prototype.toString.call(e[n]).toLowerCase()||e[n].length?e[n]=t[n]:p.util.json.merge(e[n],t[n]);return e}},uuid:{newid:function(){return((new Date).getTime().toString(16)+Math.random().toString(16).substr(2)).substr(2,16)}},text:{is_empty:function(e){return!e||0==e.replace(/\s*/,"").length}}},p.prototype={init:function(){var e,t,n;this.inited||(this.inited=!0,t={mode:(e=this.options).mode,hspace:e.layout.hspace,vspace:e.layout.vspace,pspace:e.layout.pspace},n={container:e.container,support_html:e.support_html,engine:e.view.engine,hmargin:e.view.hmargin,vmargin:e.view.vmargin,line_width:e.view.line_width,line_color:e.view.line_color},this.data=new p.data_provider(this),this.layout=new p.layout_provider(this,t),this.view=new p.view_provider(this,n),this.shortcut=new p.shortcut_provider(this,e.shortcut),this.data.init(),this.layout.init(),this.view.init(),this.shortcut.init(),this._event_bind(),p.init_plugins(this))},enable_edit:function(){this.options.editable=!0},disable_edit:function(){this.options.editable=!1},enable_event_handle:function(e){this.options.default_event_handle["enable_"+e+"_handle"]=!0},disable_event_handle:function(e){this.options.default_event_handle["enable_"+e+"_handle"]=!1},get_editable:function(){return this.options.editable},set_theme:function(e){var t=this.options.theme;this.options.theme=e||null,t!=this.options.theme&&(this.view.reset_theme(),this.view.reset_custom_style())},_event_bind:function(){this.view.add_event(this,"mousedown",this.mousedown_handle),this.view.add_event(this,"click",this.click_handle),this.view.add_event(this,"dblclick",this.dblclick_handle)},mousedown_handle:function(e){var t;this.options.default_event_handle.enable_mousedown_handle&&(t=e.target||event.srcElement,(e=this.view.get_binded_nodeid(t))?"jmnode"==t.tagName.toLowerCase()&&this.select_node(e):this.select_clear())},click_handle:function(e){this.options.default_event_handle.enable_click_handle&&(e=e.target||event.srcElement,!this.view.is_expander(e)||(e=this.view.get_binded_nodeid(e))&&this.toggle_node(e))},dblclick_handle:function(e){var t;this.options.default_event_handle.enable_dblclick_handle&&this.get_editable()&&(t=e.target||event.srcElement,"root"!==(e=this.view.get_binded_nodeid(t))&&e&&"jmnode"===t.tagName.toLowerCase()&&this.begin_edit(e))},begin_edit:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.begin_edit(t):(u.error("the node[id="+e+"] can not be found."),!1)}this.get_editable()?this.view.edit_node_begin(e):u.error("fail, this mind map is not editable.")},end_edit:function(){this.view.edit_node_end()},toggle_node:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.toggle_node(t):void u.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.toggle_node(e),this.view.relayout(),this.view.restore_location(e))},expand_node:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.expand_node(t):void u.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.expand_node(e),this.view.relayout(),this.view.restore_location(e))},collapse_node:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.collapse_node(t):void u.error("the node[id="+e+"] can not be found.")}e.isroot||(this.view.save_location(e),this.layout.collapse_node(e),this.view.relayout(),this.view.restore_location(e))},expand_all:function(){this.layout.expand_all(),this.view.relayout()},collapse_all:function(){this.layout.collapse_all(),this.view.relayout()},expand_to_depth:function(e){this.layout.expand_to_depth(e),this.view.relayout()},_reset:function(){this.view.reset(),this.layout.reset(),this.data.reset()},_show:function(e){var t=e||p.format.node_array.example;this.mind=this.data.load(t),this.mind?(u.debug("data.load ok"),this.view.load(),u.debug("view.load ok"),this.layout.layout(),u.debug("layout.layout ok"),this.view.show(!0),u.debug("view.show ok"),this.invoke_event_handle(p.event_type.show,{data:[e]})):u.error("data.load error")},show:function(e){this._reset(),this._show(e)},get_meta:function(){return{name:this.mind.name,author:this.mind.author,version:this.mind.version}},get_data:function(e){return this.data.get_data(e||"node_tree")},get_root:function(){return this.mind.root},get_node:function(e){return this.mind.get_node(e)},add_node:function(e,t,n,i){if(this.get_editable()){var o=this.mind.add_node(e,t,n,i);return o&&(this.view.add_node(o),this.layout.layout(),this.view.show(!1),this.view.reset_node_custom_style(o),this.expand_node(e),this.invoke_event_handle(p.event_type.edit,{evt:"add_node",data:[e.id,t,n,i],node:t})),o}return u.error("fail, this mind map is not editable"),null},insert_node_before:function(e,t,n,i){if(this.get_editable()){var o=p.util.is_node(e)?e.id:e,e=this.mind.insert_node_before(e,t,n,i);return e&&(this.view.add_node(e),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(p.event_type.edit,{evt:"insert_node_before",data:[o,t,n,i],node:t})),e}return u.error("fail, this mind map is not editable"),null},insert_node_after:function(e,t,n,i){if(this.get_editable()){var o=p.util.is_node(e)?e.id:e,e=this.mind.insert_node_after(e,t,n,i);return e&&(this.view.add_node(e),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(p.event_type.edit,{evt:"insert_node_after",data:[o,t,n,i],node:t})),e}return u.error("fail, this mind map is not editable"),null},remove_node:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.remove_node(t):(u.error("the node[id="+e+"] can not be found."),!1)}if(this.get_editable()){if(e.isroot)return u.error("fail, can not remove root node"),!1;var n=e.id,i=e.parent.id,t=this.get_node(i);return this.view.save_location(t),this.view.remove_node(e),this.mind.remove_node(e),this.layout.layout(),this.view.show(!1),this.view.restore_location(t),this.invoke_event_handle(p.event_type.edit,{evt:"remove_node",data:[n],node:i}),!0}return u.error("fail, this mind map is not editable"),!1},update_node:function(e,t){if(this.get_editable())if(p.util.text.is_empty(t))u.warn("fail, topic can not be empty");else{var n=this.get_node(e);if(n){if(n.topic===t)return u.info("nothing changed"),void this.view.update_node(n);n.topic=t,this.view.update_node(n),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(p.event_type.edit,{evt:"update_node",data:[e,t],node:e})}}else u.error("fail, this mind map is not editable")},move_node:function(e,t,n,i){var o;this.get_editable()?(o=this.mind.move_node(e,t,n,i))&&(this.view.update_node(o),this.layout.layout(),this.view.show(!1),this.invoke_event_handle(p.event_type.edit,{evt:"move_node",data:[e,t,n,i],node:e})):u.error("fail, this mind map is not editable")},select_node:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.select_node(t):void u.error("the node[id="+e+"] can not be found.")}this.layout.is_visible(e)&&(this.mind.selected=e,this.view.select_node(e),this.invoke_event_handle(p.event_type.select,{evt:"select_node",data:[],node:e.id}))},get_selected_node:function(){return this.mind?this.mind.selected:null},select_clear:function(){this.mind&&(this.mind.selected=null,this.view.select_clear())},is_node_visible:function(e){return this.layout.is_visible(e)},find_node_before:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.find_node_before(t):void u.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var n=null;if(e.parent.isroot)for(var i,o=e.parent.children,a=null,r=0;r<o.length;r++)i=o[r],e.direction===i.direction&&(e.id===i.id&&(n=a),a=i);else n=this.mind.get_node_before(e);return n},find_node_after:function(e){if(!p.util.is_node(e)){var t=this.get_node(e);return t?this.find_node_after(t):void u.error("the node[id="+e+"] can not be found.")}if(e.isroot)return null;var n=null;if(e.parent.isroot){for(var i,o=e.parent.children,a=!1,r=0;r<o.length;r++)if(i=o[r],e.direction===i.direction){if(a){n=i;break}e.id===i.id&&(a=!0)}}else n=this.mind.get_node_after(e);return n},set_node_style:function(e,t){if(!this.get_editable())return u.error("fail, this mind map is not editable"),null;e=this.mind.get_node(e);e&&(t&&(e.data.style=Object.assign(e.data.style,t)),this.view.reset_node_custom_style(e))},set_node_color:function(e,t,n){if(!this.get_editable())return u.error("fail, this mind map is not editable"),null;e=this.mind.get_node(e);e&&(t&&(e.data.style["background-color"]=t),n&&(e.data.style["foreground-color"]=n),this.view.reset_node_custom_style(e))},set_node_font_style:function(e,t,n,i){if(!this.get_editable())return u.error("fail, this mind map is not editable"),null;e=this.mind.get_node(e);e&&(t&&(e.data.style["font-size"]=t),n&&(e.data.style["font-weight"]=n),i&&(e.data.style["font-style"]=i),this.view.reset_node_custom_style(e),this.view.update_node(e),this.layout.layout(),this.view.show(!1))},set_node_background_image:function(e,t,n,i,o){if(!this.get_editable())return u.error("fail, this mind map is not editable"),null;e=this.mind.get_node(e);e&&(t&&(e.data.style["background-image"]=t),n&&(e.data.style.width=n),i&&(e.data.style.height=i),o&&(e.data.style["background-rotation"]=o),this.view.reset_node_custom_style(e),this.view.update_node(e),this.layout.layout(),this.view.show(!1))},set_node_background_rotation:function(e,t){if(!this.get_editable())return u.error("fail, this mind map is not editable"),null;e=this.mind.get_node(e);if(e){if(!e.data.style["background-image"])return u.error("fail, only can change rotation angle of node with background image"),null;e.data.style["background-rotation"]=t,this.view.reset_node_custom_style(e),this.view.update_node(e),this.layout.layout(),this.view.show(!1)}},resize:function(){this.view.resize()},add_event_listener:function(e){"function"==typeof e&&this.event_handles.push(e)},clear_event_listener:function(){this.event_handles=[]},invoke_event_handle:function(e,t){var n=this;o.setTimeout(function(){n._invoke_event_handle(e,t)},0)},_invoke_event_handle:function(e,t){for(var n=this.event_handles.length,i=0;i<n;i++)this.event_handles[i](e,t)}},(p.data_provider=function(e){this.jm=e}).prototype={init:function(){u.debug("data.init")},reset:function(){u.debug("data.reset")},load:function(e){var t=null,n=null;return"node_array"==(t="object"==typeof e?e.format||"node_tree":"freemind")?n=p.format.node_array.get_mind(e):"node_tree"==t?n=p.format.node_tree.get_mind(e):"freemind"==t?n=p.format.freemind.get_mind(e):u.warn("unsupported format"),n},get_data:function(e){var t=null;return"node_array"==e?t=p.format.node_array.get_data(this.jm.mind):"node_tree"==e?t=p.format.node_tree.get_data(this.jm.mind):"freemind"==e?t=p.format.freemind.get_data(this.jm.mind):u.error("unsupported "+e+" format"),t}},(p.layout_provider=function(e,t){this.opts=t,this.jm=e,this.isside="side"==this.opts.mode,this.bounds=null,this.cache_valid=!1}).prototype={init:function(){u.debug("layout.init")},reset:function(){u.debug("layout.reset"),this.bounds={n:0,s:0,w:0,e:0}},layout:function(){u.debug("layout.layout"),this.layout_direction(),this.layout_offset()},layout_direction:function(){this._layout_direction_root()},_layout_direction_root:function(){var e=this.jm.mind.root,t=null;"layout"in e._data?t=e._data.layout:e._data.layout=t={};var n=e.children,e=n.length;if(t.direction=p.direction.center,t.side_index=0,this.isside)for(var i=e;i--;)this._layout_direction_side(n[i],p.direction.right,i);else for(var o,i=e;i--;)(o=n[i]).direction==p.direction.left?this._layout_direction_side(o,p.direction.left,i):this._layout_direction_side(o,p.direction.right,i)},_layout_direction_side:function(e,t,n){var i=null;"layout"in e._data?i=e._data.layout:e._data.layout=i={};var o=e.children,e=o.length;i.direction=t,i.side_index=n;for(var a=e;a--;)this._layout_direction_side(o[a],t,a)},layout_offset:function(){var e=this.jm.mind.root,t=e._data.layout;t.offset_x=0,t.offset_y=0,t.outer_height=0;for(var n,i=e.children,o=i.length,a=[],r=[];o--;)((n=i[o])._data.layout.direction==p.direction.right?r:a).unshift(n);t.left_nodes=a,t.right_nodes=r,t.outer_height_left=this._layout_offset_subnodes(a),t.outer_height_right=this._layout_offset_subnodes(r),this.bounds.e=e._data.view.width/2,this.bounds.w=0-this.bounds.e,this.bounds.n=0,this.bounds.s=Math.max(t.outer_height_left,t.outer_height_right)},_layout_offset_subnodes:function(e){for(var t=0,n=e.length,i=n,o=null,a=0,r=null,s=0,d=null;i--;)r=(o=e[i])._data.layout,null==d&&(d=o.parent._data),a=this._layout_offset_subnodes(o.children),o.expanded||(a=0,this.set_visible(o.children,!1)),a=Math.max(o._data.view.height,a),r.outer_height=a,r.offset_y=s-a/2,r.offset_x=this.opts.hspace*r.direction+d.view.width*(d.layout.direction+r.direction)/2,o.parent.isroot||(r.offset_x+=this.opts.pspace*r.direction),s=s-a-this.opts.vspace,t+=a;1<n&&(t+=this.opts.vspace*(n-1));for(var i=n,l=t/2;i--;)(o=e[i])._data.layout.offset_y+=l;return t},_layout_offset_subnodes_height:function(e){for(var t=0,n=e.length,i=n,o=null,a=0,r=null,s=0,d=null;i--;)r=(o=e[i])._data.layout,null==d&&(d=o.parent._data),a=this._layout_offset_subnodes_height(o.children),o.expanded||(a=0),a=Math.max(o._data.view.height,a),r.outer_height=a,r.offset_y=s-a/2,s=s-a-this.opts.vspace,t+=a;1<n&&(t+=this.opts.vspace*(n-1));for(var i=n,l=t/2;i--;)(o=e[i])._data.layout.offset_y+=l;return t},get_node_offset:function(e){var t,n=e._data.layout,i=null;return"_offset_"in n&&this.cache_valid?i=n._offset_:n._offset_=i={x:-1,y:-1},-1!=i.x&&-1!=i.y||(t=n.offset_x,n=n.offset_y,e.isroot||(t+=(e=this.get_node_offset(e.parent)).x,n+=e.y),i.x=t,i.y=n),i},get_node_point:function(e){var t=e._data.view,n=this.get_node_offset(e),i={};return i.x=n.x+t.width*(e._data.layout.direction-1)/2,i.y=n.y-t.height/2,i},get_node_point_in:function(e){return this.get_node_offset(e)},get_node_point_out:function(e){var t,n=e._data.layout,i=null;return"_pout_"in n&&this.cache_valid?i=n._pout_:n._pout_=i={x:-1,y:-1},-1!=i.x&&-1!=i.y||(e.isroot?(i.x=0,i.y=0):(t=e._data.view,n=this.get_node_offset(e),i.x=n.x+(t.width+this.opts.pspace)*e._data.layout.direction,i.y=n.y)),i},get_expander_point:function(e){var t=this.get_node_point_out(e),n={};return e._data.layout.direction==p.direction.right?n.x=t.x-this.opts.pspace:n.x=t.x,n.y=t.y-Math.ceil(this.opts.pspace/2),n},get_min_size:function(){var e,t,n,i=this.jm.mind.nodes;for(n in i)e=i[n],(t=this.get_node_point_out(e)).x>this.bounds.e&&(this.bounds.e=t.x),t.x<this.bounds.w&&(this.bounds.w=t.x);return{w:this.bounds.e-this.bounds.w,h:this.bounds.s-this.bounds.n}},toggle_node:function(e){e.isroot||(e.expanded?this.collapse_node(e):this.expand_node(e))},expand_node:function(e){e.expanded=!0,this.part_layout(e),this.set_visible(e.children,!0),this.jm.invoke_event_handle(p.event_type.show,{evt:"expand_node",data:[],node:e.id})},collapse_node:function(e){e.expanded=!1,this.part_layout(e),this.set_visible(e.children,!1),this.jm.invoke_event_handle(p.event_type.show,{evt:"collapse_node",data:[],node:e.id})},expand_all:function(){var e,t,n,i=this.jm.mind.nodes,o=0;for(t in i)(e=i[t]).expanded||(e.expanded=!0,o++);0<o&&(n=this.jm.mind.root,this.part_layout(n),this.set_visible(n.children,!0))},collapse_all:function(){var e,t,n,i=this.jm.mind.nodes,o=0;for(t in i)(e=i[t]).expanded&&!e.isroot&&(e.expanded=!1,o++);0<o&&(n=this.jm.mind.root,this.part_layout(n),this.set_visible(n.children,!0))},expand_to_depth:function(e,t,n){if(!(e<1))for(var i,o=t||this.jm.mind.root.children,a=n||1,r=o.length;r--;)i=o[r],a<e&&(i.expanded||this.expand_node(i),this.expand_to_depth(e,i.children,a+1)),a==e&&i.expanded&&this.collapse_node(i)},part_layout:function(e){var t=this.jm.mind.root;t?(t=t._data.layout,e.isroot?(t.outer_height_right=this._layout_offset_subnodes_height(t.right_nodes),t.outer_height_left=this._layout_offset_subnodes_height(t.left_nodes)):e._data.layout.direction==p.direction.right?t.outer_height_right=this._layout_offset_subnodes_height(t.right_nodes):t.outer_height_left=this._layout_offset_subnodes_height(t.left_nodes),this.bounds.s=Math.max(t.outer_height_left,t.outer_height_right),this.cache_valid=!1):u.warn("can not found root node")},set_visible:function(e,t){for(var n=e.length,i=null;n--;)(i=e[n])._data.layout,i.expanded?this.set_visible(i.children,t):this.set_visible(i.children,!1),i.isroot||(i._data.layout.visible=t)},is_expand:function(e){return e.expanded},is_visible:function(e){e=e._data.layout;return!("visible"in e&&!e.visible)}},(p.graph_canvas=function(e){this.opts=e.opts,this.e_canvas=r("canvas"),this.e_canvas.className="jsmind",this.canvas_ctx=this.e_canvas.getContext("2d"),this.size={w:0,h:0}}).prototype={element:function(){return this.e_canvas},set_size:function(e,t){this.size.w=e,this.size.h=t,this.e_canvas.width=e,this.e_canvas.height=t},clear:function(){this.canvas_ctx.clearRect(0,0,this.size.w,this.size.h)},draw_line:function(e,t,n){var i=this.canvas_ctx;i.strokeStyle=this.opts.line_color,i.lineWidth=this.opts.line_width,i.lineCap="round",this._bezier_to(i,t.x+n.x,t.y+n.y,e.x+n.x,e.y+n.y)},copy_to:function(e,t){e.drawImage(this.e_canvas,0,0),t&&t()},_bezier_to:function(e,t,n,i,o){e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(t+2*(i-t)/3,n,t,o,i+2,o),e.stroke()},_line_to:function(e,t,n,i,o){e.beginPath(),e.moveTo(t,n),e.lineTo(i,o),e.stroke()}},(p.graph_svg=function(e){this.view=e,this.opts=e.opts,this.e_svg=p.graph_svg.c("svg"),this.e_svg.setAttribute("class","jsmind"),this.size={w:0,h:0},this.lines=[]}).c=function(e){return a.createElementNS("http://www.w3.org/2000/svg",e)},p.graph_svg.prototype={element:function(){return this.e_svg},set_size:function(e,t){this.size.w=e,this.size.h=t,this.e_svg.setAttribute("width",e),this.e_svg.setAttribute("height",t)},clear:function(){for(var e=this.lines.length;e--;)this.e_svg.removeChild(this.lines[e]);this.lines.length=0},draw_line:function(e,t,n){var i=p.graph_svg.c("path");i.setAttribute("stroke",this.opts.line_color),i.setAttribute("stroke-width",this.opts.line_width),i.setAttribute("fill","transparent"),this.lines.push(i),this.e_svg.appendChild(i),this._bezier_to(i,t.x+n.x,t.y+n.y,e.x+n.x,e.y+n.y)},copy_to:function(e,t){var n=new Image;n.onload=function(){e.drawImage(n,0,0),t&&t()},n.src="data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(this.e_svg))},_bezier_to:function(e,t,n,i,o){e.setAttribute("d","M"+t+" "+n+" C "+(t+2*(i-t)/3)+" "+n+", "+t+" "+o+", "+i+" "+o)},_line_to:function(e,t,n,i,o){e.setAttribute("d","M "+t+" "+n+" L "+i+" "+o)}},(p.view_provider=function(e,t){this.opts=t,this.jm=e,this.layout=e.layout,this.container=null,this.e_panel=null,this.e_nodes=null,this.size={w:0,h:0},this.selected_node=null,this.editing_node=null,this.graph=null}).prototype={init:function(){var e,t;u.debug("view.init"),this.container=!(e=this.opts.container)||"object"!=typeof e||1!==e.nodeType||"object"!=typeof e.style||"object"!=typeof e.ownerDocument?(e=this.opts.container,a.getElementById(e)):this.opts.container,this.container?(this.e_panel=r("div"),this.e_nodes=r("jmnodes"),this.e_editor=r("input"),this.graph=new("svg"===this.opts.engine.toLowerCase()?p.graph_svg:p.graph_canvas)(this),this.e_panel.className="jsmind-inner",this.e_panel.appendChild(this.graph.element()),this.e_panel.appendChild(this.e_nodes),this.e_editor.className="jsmind-editor",this.e_editor.type="text",this.actualZoom=1,this.zoomStep=.1,this.minZoom=.5,this.maxZoom=2.1,p.util.dom.add_event((t=this).e_editor,"keydown",function(e){e=e||event;13==e.keyCode&&(t.edit_node_end(),e.stopPropagation())}),p.util.dom.add_event(this.e_editor,"blur",function(e){t.edit_node_end()}),this.container.appendChild(this.e_panel)):u.error("the options.view.container was not be found in dom")},add_event:function(t,e,n){p.util.dom.add_event(this.e_nodes,e,function(e){e=e||event;n.call(t,e)})},get_binded_nodeid:function(e){if(null==e)return null;var t=e.tagName.toLowerCase();return"jmnodes"==t||"body"==t||"html"==t?null:"jmnode"==t||"jmexpander"==t?e.getAttribute("nodeid"):this.get_binded_nodeid(e.parentElement)},is_expander:function(e){return"jmexpander"==e.tagName.toLowerCase()},reset:function(){u.debug("view.reset"),this.selected_node=null,this.clear_lines(),this.clear_nodes(),this.reset_theme()},reset_theme:function(){var e=this.jm.options.theme;this.e_nodes.className=e?"theme-"+e:""},reset_custom_style:function(){var e,t=this.jm.mind.nodes;for(e in t)this.reset_node_custom_style(t[e])},load:function(){u.debug("view.load"),this.init_nodes()},expand_size:function(){var e=this.layout.get_min_size(),t=e.w+2*this.opts.hmargin,n=e.h+2*this.opts.vmargin,i=this.e_panel.clientWidth,e=this.e_panel.clientHeight;e<n&&(e=n),this.size.w=i=i<t?t:i,this.size.h=e},init_nodes_size:function(e){e=e._data.view;e.width=e.element.clientWidth,e.height=e.element.clientHeight},init_nodes:function(){var e,t=this.jm.mind.nodes,n=a.createDocumentFragment();for(e in t)this.create_node_element(t[e],n);for(e in this.e_nodes.appendChild(n),t)this.init_nodes_size(t[e])},add_node:function(e){this.create_node_element(e,this.e_nodes),this.init_nodes_size(e)},create_node_element:function(e,t){var n=null;"view"in e._data?n=e._data.view:e._data.view=n={};var i,o=r("jmnode");e.isroot?o.className="root":(i=r("jmexpander"),c(i,"-"),i.setAttribute("nodeid",e.id),i.style.visibility="hidden",t.appendChild(i),n.expander=i),e.topic&&(this.opts.support_html?s:c)(o,e.topic),o.setAttribute("nodeid",e.id),o.style.visibility="hidden",this._reset_node_custom_style(o,e.data),t.appendChild(o),n.element=o},remove_node:function(e){null!=this.selected_node&&this.selected_node.id==e.id&&(this.selected_node=null),null!=this.editing_node&&this.editing_node.id==e.id&&(e._data.view.element.removeChild(this.e_editor),this.editing_node=null);for(var t,n,i=e.children,o=i.length;o--;)this.remove_node(i[o]);e._data.view&&(t=e._data.view.element,n=e._data.view.expander,this.e_nodes.removeChild(t),this.e_nodes.removeChild(n),e._data.view.element=null,e._data.view.expander=null)},update_node:function(e){var t=e._data.view,n=t.element;e.topic&&(this.opts.support_html?s:c)(n,e.topic),t.width=n.clientWidth,t.height=n.clientHeight},select_node:function(e){this.selected_node&&(this.selected_node._data.view.element.className=this.selected_node._data.view.element.className.replace(/\s*selected\b/i,""),this.reset_node_custom_style(this.selected_node)),e&&((this.selected_node=e)._data.view.element.className+=" selected",this.clear_node_custom_style(e))},select_clear:function(){this.select_node(null)},get_editing_node:function(){return this.editing_node},is_editing:function(){return!!this.editing_node},edit_node_begin:function(e){var t;e.topic?(null!=this.editing_node&&this.edit_node_end(),t=(this.editing_node=e)._data.view.element,e=e.topic,getComputedStyle(t),this.e_editor.value=e,t.appendChild(this.e_editor),t.style.zIndex=5,this.e_editor.focus(),this.e_editor.select()):u.warn("don't edit image nodes")},edit_node_end:function(){var e,t,n;null!=this.editing_node&&(e=this.editing_node,this.editing_node=null,t=e._data.view.element,n=this.e_editor.value,t.style.zIndex="auto",t.removeChild(this.e_editor),p.util.text.is_empty(n)||e.topic===n?(this.opts.support_html?s:c)(t,e.topic):this.jm.update_node(e.id,n))},get_view_offset:function(){var e=this.layout.bounds;return{x:(this.size.w-e.e-e.w)/2,y:this.size.h/2}},resize:function(){this.graph.set_size(1,1),this.e_nodes.style.width="1px",this.e_nodes.style.height="1px",this.expand_size(),this._show()},_show:function(){this.graph.set_size(this.size.w-4,this.size.h-4),this.e_nodes.style.width=this.size.w-4+"px",this.e_nodes.style.height=this.size.h-4+"px",this.show_nodes(),this.show_lines(),this.jm.invoke_event_handle(p.event_type.resize,{data:[]})},zoomIn:function(){return this.setZoom(this.actualZoom+this.zoomStep)},zoomOut:function(){return this.setZoom(this.actualZoom-this.zoomStep)},setZoom:function(e){if(e<this.minZoom||e>this.maxZoom)return!1;this.actualZoom=e;for(var t=0;t<this.e_panel.children.length;t++)this.e_panel.children[t].style.transform="scale("+e+")",this.e_panel.children[t].style.transformOrigin="left top";return this.show(!0),!0},_center_root:function(){var e,t=this.e_panel.clientWidth,n=this.e_panel.clientHeight;this.size.w>t&&(e=this.get_view_offset(),this.e_panel.scrollLeft=e.x-t/2),this.size.h>n&&(this.e_panel.scrollTop=(this.size.h-n)/2)},show:function(e){u.debug("view.show"),this.expand_size(),this._show(),e&&this._center_root()},relayout:function(){this.expand_size(),this._show()},save_location:function(e){e=e._data.view;e._saved_location={x:parseInt(e.element.style.left)-this.e_panel.scrollLeft,y:parseInt(e.element.style.top)-this.e_panel.scrollTop}},restore_location:function(e){e=e._data.view;this.e_panel.scrollLeft=parseInt(e.element.style.left)-e._saved_location.x,this.e_panel.scrollTop=parseInt(e.element.style.top)-e._saved_location.y},clear_nodes:function(){var e=this.jm.mind;if(null!=e){var t,n=e.nodes,i=null;for(t in n)(i=n[t])._data.view.element=null,i._data.view.expander=null;this.e_nodes.innerHTML=""}},show_nodes:function(){var e,t,n,i,o,a=this.jm.mind.nodes,r=null,s=null,d=null,l=this.get_view_offset();for(o in a)r=(d=(e=a[o])._data.view).element,s=d.expander,this.layout.is_visible(e)?(this.reset_node_custom_style(e),t=this.layout.get_node_point(e),d.abs_x=l.x+t.x,d.abs_y=l.y+t.y,r.style.left=l.x+t.x+"px",r.style.top=l.y+t.y+"px",r.style.display="",r.style.visibility="visible",!e.isroot&&0<e.children.length&&(i=e.expanded?"-":"+",n=this.layout.get_expander_point(e),s.style.left=l.x+n.x+2+"px",s.style.top=l.y+n.y+"px",s.style.display="",s.style.visibility="visible",c(s,i)),e.isroot||0!=e.children.length||(s.style.display="none",s.style.visibility="hidden")):(r.style.display="none",s.style.display="none")},reset_node_custom_style:function(e){this._reset_node_custom_style(e._data.view.element,e.data)},_reset_node_custom_style:function(t,e){var n=e.style,i=void 0===n?{}:n;"hover_border_color"in i&&t.style.setProperty("--hover_border_color",i.hover_border_color),"background-color"in i&&(t.style.setProperty("--hover_bgc_color",i["background-color"]),t.style.backgroundColor=i["background-color"]),"color"in i&&(t.style.color=i.color),"width"in i&&(t.style.width=i.width+"px"),"height"in i&&(t.style.height=i.height+"px"),"font-size"in i&&(t.style.fontSize=i["font-size"]+"px"),"font-weight"in i&&(t.style.fontWeight=i["font-weight"]),"font-style"in i&&(t.style.fontStyle=i["font-style"]),"border-radius"in i&&(t.style.borderRadius=i["border-radius"]),"border"in i&&(t.style.border=i.border),"background-image"in i&&((e=i["background-image"]).startsWith("data")&&i.width&&i.height?((n=new Image).onload=function(){var e=r("canvas");e.width=t.clientWidth,e.height=t.clientHeight;e.getContext&&(e.getContext("2d").drawImage(this,2,2,t.clientWidth,t.clientHeight),e=e.toDataURL(),t.style.backgroundImage="url("+e+")")},n.src=e):t.style.backgroundImage="url("+e+")",t.style.backgroundSize="99%","background-rotation"in i&&(t.style.transform="rotate("+i["background-rotation"]+"deg)"))},clear_node_custom_style:function(e){e=e._data.view.element;e.style.backgroundColor="",e.style.color=""},clear_lines:function(){this.graph.clear()},show_lines:function(){this.clear_lines();var e,t,n,i,o=this.jm.mind.nodes,a=this.get_view_offset();for(i in o)(e=o[i]).isroot||"visible"in e._data.layout&&!e._data.layout.visible||(t=this.layout.get_node_point_in(e),n=this.layout.get_node_point_out(e.parent),this.graph.draw_line(n,t,a))}},(p.shortcut_provider=function(e,t){this.jm=e,this.opts=t,this.mapping=t.mapping,this.handles=t.handles,this._newid=null,this._mapping={}}).prototype={init:function(){for(var e in p.util.dom.add_event(a,"keydown",this.handler.bind(this)),this.handles.addchild=this.handles.addchild||this.handle_addchild,this.handles.addbrother=this.handle_addbrother,this.handles.editnode=this.handle_editnode,this.handles.delnode=this.handle_delnode,this.handles.toggle=this.handle_toggle,this.handles.up=this.handle_up,this.handles.down=this.handle_down,this.handles.left=this.handle_left,this.handles.right=this.handle_right,this.mapping)this.mapping[e]&&e in this.handles&&(this._mapping[this.mapping[e]]=this.handles[e]);"function"==typeof this.opts.id_generator?this._newid=this.opts.id_generator:this._newid=p.util.uuid.newid},enable_shortcut:function(){this.opts.enable=!0},disable_shortcut:function(){this.opts.enable=!1},handler:function(e){if(9==e.which&&e.preventDefault(),!this.jm.view.is_editing()){var t=e||event;if(!this.opts.enable)return!0;t=t.keyCode+(t.metaKey<<13)+(t.ctrlKey<<12)+(t.altKey<<11)+(t.shiftKey<<10);t in this._mapping&&this._mapping[t].call(this,this.jm,e)}},handle_addchild:function(e,t){var n,i=e.get_selected_node();i&&(n=this._newid(),e.add_node(i,n,"New Node")&&(e.select_node(n),e.begin_edit(n)))},handle_addbrother:function(e,t){var n,i=e.get_selected_node();i&&!i.isroot&&(n=this._newid(),e.insert_node_after(i,n,"New Node")&&(e.select_node(n),e.begin_edit(n)))},handle_editnode:function(e,t){var n=e.get_selected_node();n&&e.begin_edit(n)},handle_delnode:function(e,t){var n=e.get_selected_node();n&&!n.isroot&&(e.select_node(n.parent),e.remove_node(n))},handle_toggle:function(e,t){var n=t||event,t=e.get_selected_node();t&&(e.toggle_node(t.id),n.stopPropagation(),n.preventDefault())},handle_up:function(e,t){var n=t||event,i=e.get_selected_node();i&&((t=e.find_node_before(i))||(i=e.find_node_before(i.parent))&&0<i.children.length&&(t=i.children[i.children.length-1]),t&&e.select_node(t),n.stopPropagation(),n.preventDefault())},handle_down:function(e,t){var n=t||event,i=e.get_selected_node();i&&((t=e.find_node_after(i))||(i=e.find_node_after(i.parent))&&0<i.children.length&&(t=i.children[0]),t&&e.select_node(t),n.stopPropagation(),n.preventDefault())},handle_left:function(e,t){this._handle_direction(e,t,p.direction.left)},handle_right:function(e,t){this._handle_direction(e,t,p.direction.right)},_handle_direction:function(e,t,n){var i=t||event,o=e.get_selected_node(),a=null;if(o){if(o.isroot){for(var r=o.children,s=[],d=0;d<r.length;d++)r[d].direction===n&&s.push(d);a=r[s[Math.floor((s.length-1)/2)]]}else o.direction===n?0<(t=(s=o.children).length)&&(a=s[Math.floor((t-1)/2)]):a=o.parent;a&&e.select_node(a),i.stopPropagation(),i.preventDefault()}}},p.plugin=function(e,t){this.name=e,this.init=t},p.plugins=[],p.register_plugin=function(e){e instanceof p.plugin&&p.plugins.push(e)},p.init_plugins=function(e){o.setTimeout(function(){p._init_plugins(e)},0)},p._init_plugins=function(e){for(var t=p.plugins.length,n=null,i=0;i<t;i++)"function"==typeof(n=p.plugins[i].init)&&n(e)},p.show=function(e,t){e=new p(e);return e.show(t),e},e.exports=p):u.log(l+" has been already exist.")},86737:e=>{e.exports=function(e){"use strict";var i,o,f,p,m,r=window,a=e;a&&void 0===a.screenshot&&(i=r.document,o=function(e){return i.createElement(e)},f=function(e,t){return e.getPropertyValue(t)},p=function(e){var t=f(e,"visibility"),e=f(e,"display");return"hidden"!==t&&"none"!==e},m={rect:function(e,t,n,i,o,a){e.moveTo(t+(a=o<2*(a=i<2*a?i/2:a)?o/2:a),n),e.arcTo(t+i,n,t+i,n+o,a),e.arcTo(t+i,n+o,t,n+o,a),e.arcTo(t,n+o,t,n,a),e.arcTo(t,n,t+i,n,a)},text_multiline:function(e,t,n,i,o,a,r){var s,d="",l=t.length,c=t.split("");e.textAlign="left",e.textBaseline="top";for(var h=0;h<l;h++)s=d+c[h],e.measureText(s).width>o&&0<h?(e.fillText(d,n,i),d=c[h],i+=r):d=s;e.fillText(d,n,i)},text_ellipsis:function(e,t,n,i,o,a){a=i+a/2,t=m.fittingString(e,t,o);e.textAlign="left",e.textBaseline="middle",e.fillText(t,n,a,o)},fittingString:function(e,t,n){var i=e.measureText(t).width,o=e.measureText("…").width;if(i<=n||i<=o)return t;for(var a=t.length;n-o<=i&&0<a--;)t=t.substring(0,a),i=e.measureText(t).width;return t+"…"},image:function(e,t,n,i,o,a,r,s,d){var l=new Image;l.onload=function(){e.save(),e.translate(n,i),e.save(),e.beginPath(),m.rect(e,0,0,o,a,r),e.closePath(),e.clip(),e.translate(o/2,a/2),e.rotate(s*Math.PI/180),e.drawImage(l,-o/2,-a/2),e.restore(),e.restore(),d&&d()},l.src=t}},a.screenshot=function(e){this.jm=e,this.canvas_elem=null,this.canvas_ctx=null,this._inited=!1},a.screenshot.prototype={init:function(){var e,t;this._inited||((e=o("canvas")).style.position="fixed",e.style.top="-1000px",t=e.getContext("2d"),this.canvas_elem=e,this.canvas_ctx=t,document.body.appendChild(e),this._inited=!0,this.resize())},shoot:function(e){this.init(),this._draw(function(){e&&e(),this.clean()}.bind(this))},shootDownload:function(){this.shoot(function(){this._download()}.bind(this))},shootAsDataURL:function(e){this.shoot(function(){e&&e(this.canvas_elem.toDataURL())}.bind(this))},resize:function(){this._inited&&(this.canvas_elem.width=this.jm.view.size.w,this.canvas_elem.height=this.jm.view.size.h)},clean:function(){var e=this.canvas_elem;this.canvas_ctx.clearRect(0,0,e.width,e.height)},_draw:function(e){var t=this.canvas_ctx;t.textAlign="left",t.textBaseline="top",this._draw_bg(),this._draw_lines(function(){this._draw_nodes(e)}.bind(this))},_draw_bg:function(){var e=this.canvas_elem,t=this.canvas_ctx;t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height)},_watermark:function(){var e=this.canvas_elem,t=this.canvas_ctx;t.textAlign="right",t.textBaseline="bottom",t.fillStyle="#000",t.font="11px Verdana,Arial,Helvetica,sans-serif",t.fillText("hizzgdev.github.io/jsmind",e.width-5.5,e.height-2.5),t.textAlign="left",t.fillText(r.location,5.5,e.height-2.5)},_draw_lines:function(e){this.jm.view.graph.copy_to(this.canvas_ctx,e)},_draw_nodes:function(i){var o,e,a=this.jm.mind.nodes;for(e in a)o=a[e],this._draw_node(o);!function e(){console.log("check_node_ready"+new Date);var t,n=!0;for(t in a)n&=(o=a[t]).ready;n?r.setTimeout(i,200):r.setTimeout(e,200)}()},_draw_node:function(e){var t,n,i,o,a,r,s,d,l,c=this.canvas_ctx,h=e._data.view,u=h.element,_=getComputedStyle(u);p(_)?(d=f(_,"background-color"),t=parseInt(f(_,"border-top-left-radius")),l=f(_,"color"),n=parseInt(f(_,"padding-left")),i=parseInt(f(_,"padding-right")),o=parseInt(f(_,"padding-top")),s=parseInt(f(_,"padding-bottom")),a=f(_,"text-overflow"),r=f(_,"font-style")+" "+f(_,"font-variant")+" "+f(_,"font-weight")+" "+f(_,"font-size")+"/"+f(_,"line-height")+" "+f(_,"font-family"),s={x:(u={x:h.abs_x,y:h.abs_y,w:h.width+1,h:h.height+1}).x+n,y:u.y+o,w:u.w-n-i,h:u.h-o-s},c.font=r,c.fillStyle=d,c.beginPath(),m.rect(c,u.x,u.y,u.w,u.h,t),c.closePath(),c.fill(),c.fillStyle=l,"background-image"in e.data&&(d=f(_,"background-image").slice(5,-2),e.ready=!1,l=0,"background-rotation"in e.data&&(l=e.data["background-rotation"]),m.image(c,d,u.x,u.y,u.w,u.h,t,l,function(){e.ready=!0})),e.topic&&("ellipsis"===a?m.text_ellipsis(c,e.topic,s.x,s.y,s.w,s.h):(_=parseInt(f(_,"line-height")),m.text_multiline(c,e.topic,s.x,s.y,s.w,s.h,_))),h.expander&&this._draw_expander(h.expander),"background-image"in e.data||(e.ready=!0)):e.ready=!0},_draw_expander:function(e){var t,n,i=this.canvas_ctx,o=getComputedStyle(e);p(o)&&(t=f(o,"left"),n=f(o,"top"),o=f(o,"font"),t=parseInt(t),n=parseInt(n),e="+"===e.innerHTML,i.lineWidth=1,i.beginPath(),i.font=o,i.strokeStyle="#E5E5E5",i.arc(t+7,n+7,5,0,2*Math.PI,!0),i.stroke(),i.moveTo(t+10,n+7),i.strokeStyle="#8C8C8C",i.lineTo(t+4,n+7),e&&(i.moveTo(t+7,n+4),i.lineTo(t+7,n+10)),i.closePath(),i.stroke())},_download:function(){var e,t=this.canvas_elem,n=this.jm.mind.name+".png";navigator.msSaveBlob&&t.msToBlob?(e=t.msToBlob(),navigator.msSaveBlob(e,n)):(t=this.canvas_elem.toDataURL(),"download"in(e=o("a"))?(e.style.visibility="hidden",e.href=t,e.download=n,i.body.appendChild(e),(n=i.createEvent("MouseEvents")).initEvent("click",!0,!0),e.dispatchEvent(n),i.body.removeChild(e)):location.href=t)},jm_event_handle:function(e,t){e===a.event_type.resize&&this.resize()}},e=new a.plugin("screenshot",function(e){var n=new a.screenshot(e);e.screenshot=n,e.shoot=function(){n.shoot()},e.add_event_listener(function(e,t){n.jm_event_handle.call(n,e,t)})}),a.register_plugin(e))}},85585:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});var i=n(37316),o=n.n(i),a=n(67154),s=n.n(a),r=n(85354),d=n.n(r),l=n(18446),c=n.n(l),t=n(67294),g=n.n(t),i=n(64396),v=n(55815),y=n(8201),w=n(61409),b=n(35239),x=n(92360),E=n(43036);const k=function(e){var t=e.list,n=e.keyword,i=e.x,o=void 0===i?-100:i,a=e.y,i=void 0===a?-100:a,r=e.onSelect,a=document.querySelector("#jsmind_container")||{scrollTop:0},e=a.scrollTop,a=a.scrollLeft,t=t.filter(function(e){return!n||-1!==e.name.toLowerCase().indexOf(n.trim().toLowerCase())});return g().createElement("div",{className:"TipList",style:{top:i-e,left:o-a}},g().createElement("ul",null,t.length?t.map(function(e){return g().createElement("li",{key:e.id,onMouseUp:function(){return r(e.name)}},e.name)}):g().createElement("li",{style:{pointerEvents:"none"}},"暂无数据")))};var h=n(94644),j=n(36490),u=n(86277),a=n(52110),r=n(86737);a(u),r(u),n(89578);const S=function(t){function e(e){var s=t.call(this,e)||this;return s.showErr=function(){var t=s.jm.mind.nodes;Object.keys(t).filter(function(e){return t[e].data.level===s.props.maxLevel}).forEach(function(e){t[e].topic===j.WS&&s.jm.set_node_style(t[e].id,{border:"1px solid #D96969"})})},s.testLevelNode=function(t,n,e){return Object.values(s.jm.mind.nodes).filter(function(e){return e.data.level===t&&e.id!==n}).map(function(e){return e.topic}).includes(e)},s.addLeafNode=function(e,t){var n,i;s.curSelect&&(i={level:n=s.props.maxLevel},s.curSelect.data.level===n&&(s.curSelect.topic===j.WS?(s.jm.update_node(s.curSelect.id,t),setTimeout(function(){return s.jm.set_node_style(s.curSelect.id,{"border-radius":"4px"})},100),s.jm.set_node_style(s.curSelect.id,{border:""})):s.jm.insert_node_after(s.curSelect.id,e,t,(0,j.$P)(i,n))),s.curSelect.data.level===n-1&&s.jm.add_node(s.curSelect.id,e,t,(0,j.$P)(i,n)),setTimeout(function(){return s.props.onDataChange({data:s.jm.get_data().data})},100))},s.addIndex=function(e){s.jm.update_node(s.curSelect.id,e)},s.createBrotherNode=function(){var r=s.props.maxLevel;s.curSelect&&function e(t,n,i){function o(){for(var e=Object.values(s.jm.mind.nodes).filter(function(e){return e.data.level===i}),t=1,n=j.$W[i]+"级指标"+(e.length+t);e.some(function(e){return e.topic===n});)n=j.$W[i]+"级指标"+(e.length+ ++t);return n}var a={level:i,style:{"border-radius":i===r?"14px":"4px",border:i===r?"1px solid #D96969":""}};t===s.curSelect.id?s.jm.insert_node_after(t,n,i===r?j.WS:o(),(0,j.$P)(a,r)):s.jm.add_node(t,n,i===r?j.WS:o(),(0,j.$P)(a,r)),i<r&&e(n,(new Date).getTime()+Math.random(),i+1)}(s.curSelect.id,(new Date).getTime()+Math.random(),s.curSelect.data.level)},s.createNode=function(){var a=s.props.maxLevel;s.curSelect&&s.curSelect.data.level<a&&function e(t,n,i){var o={level:i,style:{"border-radius":i===a?"14px":"4px",border:i===a?"1px solid #D96969":""}};s.jm.add_node(t,n,i===a?j.WS:function(){for(var e=Object.values(s.jm.mind.nodes).filter(function(e){return e.data.level===i}),t=1,n=j.$W[i]+"级指标"+(e.length+t);e.some(function(e){return e.topic===n});)n=j.$W[i]+"级指标"+(e.length+ ++t);return n}(),(0,j.$P)(o,a)),i<a&&e(n,(new Date).getTime()+Math.random(),i+1)}(s.curSelect.id,(new Date).getTime()+Math.random(),s.curSelect.data.level+1)},s.deleteNode=function(){s.curSelect&&(s.jm.find_node_before(s.curSelect.id)||s.jm.find_node_after(s.curSelect.id))&&(s.jm.remove_node(s.curSelect.id),s.curSelect=null)},s.closeNode=function(){s.curSelect&&s.jm.collapse_node(s.curSelect.id)},s.openNode=function(){s.curSelect&&s.jm.expand_node(s.curSelect.id)},s.adapt=function(){},s.real=function(){},s.zoomIn=function(){s.jm.view.zoomIn(),s.setState({scale:2===s.state.scale?2:Number((s.state.scale+.1).toFixed(1))}),s.jm.resize()},s.zoomOut=function(){s.jm.view.zoomOut(),s.setState({scale:.5===s.state.scale?.5:Number((s.state.scale-.1).toFixed(1))}),s.jm.resize()},s.downloadImg=function(){s.jm.screenshot.shootDownload()},s.downloadExcel=function(){var e=function t(n,i){if(void 0===i&&(i=[]),n.children){var o=[];return n.children.forEach(function(e){o.push(t(e,[].concat(i,[n.topic])))}),o}return[].concat(i,[n.topic])}(s.jm.get_data().data).flat(s.props.maxLevel-1),t=e[0][0];e.forEach(function(e){return e.shift()}),e.unshift(new Array(s.props.maxLevel).fill().map(function(e,t){return j.$W[t+1]+"级指标"})),(0,h.aT)([e],t)},s.state={showTip:!1,keyword:"",scale:1},s.event={},s}d()(e,t);var n=e.prototype;return n.componentDidMount=function(){var o=this,e=this.props,t=e.maxLevel,n={meta:{name:e.name,author:"wangshuzhao@skieer.com",version:"0.2"},format:"node_tree",data:this.props.data},e={container:"jsmind_container",mode:"side",editable:!0,view:{engine:"canvas",hmargin:80,vmargin:30,line_width:1,line_color:"#E5E5E5"},shortcut:{enable:!1,handles:{addchild:this.createNode}}},a=u.show(e,n);this.jm=a,document.querySelector(".jsmind_wrap").addEventListener("click",function(){o.curSelect=a.get_selected_node(),o.props.curSelectChange({curSelect:o.curSelect}),setTimeout(function(){return o.props.onDataChange({data:a.get_data().data})},100)}),a.view.e_editor.addEventListener("focus",function(){o.preValue=a.view.e_editor.value,o.preId=o.curSelect.id,o.curSelect.data.level===t&&o.setState({showTip:!0,keyword:""})}),a.view.e_editor.addEventListener("compositionstart",function(e){o.isComposition=!0}),a.view.e_editor.addEventListener("compositionend",function(e){o.isComposition=!1,8<e.target.value.length&&(x.Message.warning("最多输入8个字符"),e.target.value=e.target.value.substring(0,8))}),a.view.e_editor.addEventListener("input",function(e){o.isComposition||e.target&&!o.isComposition&&8<e.target.value.length&&(e.target.value=e.target.value.substring(0,8),x.Message.warning("最多输入8个字符")),o.curSelect.data.level===t&&o.setState({keyword:a.view.e_editor.value})}),a.view.e_editor.addEventListener("blur",function(e){var n,i;o.curSelect.data.level===t?(n=a.view.e_editor.value,i=o.curSelect,setTimeout(function(){var t=o.curSelect&&o.curSelect.topic||n;!Array.isArray(o.props.indexList)||t!==j.WS&&!o.props.indexList.some(function(e){return e.name===t})?(x.Message.warning("请选择列表中存在的指标添加"),a.update_node(o.preId,o.preValue)):t!==j.WS&&o.testLevelNode(i.data.level,o.preId,t)?(x.Message.warning("同级别指标不能重名！"),a.update_node(o.preId,o.preValue)):t!==j.WS&&a.set_node_style(o.preId,{"border-radius":"4px"}),o.jm.set_node_style(i.id,{border:""}),o.setState({showTip:!1})},100)):o.testLevelNode(o.curSelect.data.level,o.curSelect.id,e.target.value)&&(x.Message.warning("同级别指标不能重名！"),a.update_node(o.preId,o.preValue))}),setTimeout(function(){return o.props.onDataChange({data:a.get_data().data})},100)},n.render=function(){var t=this,e=this.createBrotherNode,n=this.createNode,i=this.deleteNode,o=(this.closeNode,this.openNode,this.adapt,this.real,this.downloadImg),a=this.downloadExcel,r=this.addIndex,s=this.zoomIn,d=this.zoomOut,l=this.curSelect,c=this.state,h=c.keyword,u=c.showTip,_=c.scale,f=this.props,p=f.maxLevel,m=f.indexList,v=(l||{_data:{view:{abs_x:0,abs_y:0}}})._data,c=l&&"root"!==l.id,f=l&&l.data.level!==p,l=l&&l.parent&&1!==l.parent.children.length;return g().createElement("div",{className:"jsmind_wrap"},g().createElement("div",{className:"top_tip"},g().createElement("div",{className:"aspect"},j.bc.slice(0,p+1).map(function(e,t){return g().createElement("div",{className:"name",key:t},g().createElement("span",{style:{background:t===p?j.bc[j.bc.length-1]:e}}),g().createElement("span",null,t===p?j.h1[t]+"（末级）":j.h1[t]+(t===p-1?"（次末级）":"")))})),g().createElement("div",{className:"download"},g().createElement(E.Z,{overlay:"导出图片",mouseEnterDelay:.5,placement:"top"},g().createElement("i",{className:"icon-cem_picture-download",onClick:o})),g().createElement(E.Z,{overlay:"导出excel",mouseEnterDelay:.5,placement:"top"},g().createElement("i",{className:"icon-cem_excel-analysis",onClick:a})))),g().createElement("div",{className:"jsmind_wrap"},g().createElement("div",{className:"tool"},g().createElement(E.Z,{overlay:"创建同级枝干",mouseEnterDelay:.5,placement:"top"},g().createElement("svg",{className:"icon "+(c?"":"cantSel"),"aria-hidden":"true",onClick:e},c?g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_create-siblings"}):g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_create-siblings-fiben"}),g().createElement("use",{className:"hover",xlinkHref:"#icon-cem_create-siblings-color"}))),g().createElement(E.Z,{overlay:"创建下级枝干",mouseEnterDelay:.5,placement:"top"},g().createElement("svg",{className:"icon "+(f?"":"cantSel"),"aria-hidden":"true",onClick:n},f?g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_create-subordinates"}):g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_create-subordinates-fiben"}),g().createElement("use",{className:"hover",xlinkHref:"#icon-cem_create-subordinates-color"}))),g().createElement(E.Z,{overlay:"删除",mouseEnterDelay:.5,placement:"top"},g().createElement("svg",{className:"icon "+(l?"":"cantSel"),"aria-hidden":"true",onClick:i},l?g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_delete-indicator-tree"}):g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_delete-indicator-tree-fiben"}),g().createElement("use",{className:"hover",xlinkHref:"#icon-cem_delete-indicator-tree-color"}))),g().createElement(E.Z,{overlay:"放大视图",mouseEnterDelay:.5,placement:"top"},g().createElement("svg",{className:"icon enlarge","aria-hidden":"true",onClick:s},g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_enlarge-new"}),g().createElement("use",{className:"hover",xlinkHref:"#icon-cem_enlarge-new-color"}))),g().createElement("span",{className:"scale"},(100*_).toFixed(0)+"%"),g().createElement(E.Z,{overlay:"缩小视图",mouseEnterDelay:.5,placement:"top"},g().createElement("svg",{className:"icon","aria-hidden":"true",onClick:d},g().createElement("use",{className:"normal",xlinkHref:"#icon-cem_narrow-new"}),g().createElement("use",{className:"hover",xlinkHref:"#icon-cem_narrow-new-color"})))),u&&Array.isArray(m)&&0!==v.view.abs_x&&g().createElement(k,{list:m.filter(function(e){return!(0,j.XV)(t.props.data).includes(e.name)}),keyword:h,x:v.view.abs_x*_+2,y:v.view.abs_y*_+28*_,onSelect:r}),g().createElement("div",{id:"jsmind_container"})))},e}(g().Component);var _=n(61918),f=n(53754);const N=function(t){function e(e){e=t.call(this,e)||this;return e.state={aspectName:"",msgType:void 0,nodeList:void 0},e}d()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.state.pageSize;this.props.data&&this.setState({nodeList:this.props.data})},n.componentDidUpdate=function(e,t){var n=e.data,e=this.props.data;JSON.stringify(n)!==JSON.stringify(e)&&this.setState({nodeList:e})},n.render=function(){var t=this,e=this.state,n=e.aspectName,i=e.msgType,o=e.nodeList,a=this.props,r=a.addedName,e=a.loading,s=a.data,d=a.onNodeClick,l=a.level,c=a.maxLevel,h=a.msgTypeList,u=a.msgTypeOpts,o=o&&o instanceof Array&&0<o.length&&o.filter(function(e){return e.name.includes(n)}).filter(function(t){return(0,j.iU)(i,h,s).some(function(e){return t.name===e})});return g().createElement(y.Z,{className:"yt_aspect_tree_edit_node_wrapper",data:s,loading:e},g().createElement("div",{className:"search_wrap"},g().createElement(_.Z,{placeholder:"搜索指标名称",defValue:n,onSearch:function(e){t.scrollRef&&(t.scrollRef.scrollTop=0),t.setState({aspectName:e})},onClear:function(e){t.scrollRef&&(t.scrollRef.scrollTop=0),t.setState({aspectName:e})},style:{width:168}})),g().createElement("div",{className:"select_wrap"},g().createElement(f.Z,{title:"消息类型",options:u,value:i,onChange:function(e){t.scrollRef&&(t.scrollRef.scrollTop=0),t.setState({msgType:e})}})),g().createElement("p",null,"指标名称"),g().createElement("div",{className:"list_content_wrap",ref:function(e){return t.scrollRef=e}},o&&0<r.length&&0<o.length&&o.map(function(e){return e.name}).every(function(e){return 0<=r.indexOf(e)})?g().createElement("div",{className:"empty-block"},"全局指标已全部添加到当前指标树"):o&&0<o.length?o.map(function(e,t){return g().createElement("div",{key:e.id,className:"content "+(l&&l===c||l&&l===c-1?"":"not_add"),style:{display:r.includes(e.name)?"none":"flex"}},g().createElement(g().Fragment,null,l&&l===c||l&&l===c-1?g().createElement(E.Z,{placement:"topLeft",overlayClassName:"aspect_tree_node_topLeft_overlay",overlay:g().createElement("div",{style:{maxWidth:212,transition:"all 0.8s"}},g().createElement("div",{style:{fontSize:14,fontWeight:"bold"}},"全局指标：",e.name),g().createElement("div",{style:{color:"#626262",paddingTop:4,width:180}},"数据类型：",e.categoryRates&&e.categoryRates.map(function(t){return(u.find(function(e){return e.id===t.category})||{}).name}).join("，")))},g().createElement("div",{className:"left"},g().createElement("div",null,e.name),g().createElement("div",{className:"category ellipsis"},e.categoryRates&&e.categoryRates.map(function(t){return(u.find(function(e){return e.id===t.category})||{}).name}).join("，")))):g().createElement("div",{className:"left"},g().createElement("div",null,e.name),g().createElement("div",{className:"category ellipsis"},e.categoryRates&&e.categoryRates.map(function(t){return(u.find(function(e){return e.id===t.category})||{}).name}).join("，")))),g().createElement("i",{className:"icon-cem_add-to",style:{fontSize:16},onClick:function(){(l&&l===c||l&&l===c-1)&&d(e.id,e.name)}}))}):g().createElement("div",{className:"empty-block"},"暂无数据")))},e}(g().PureComponent);var l=n(55609),p=n(74981),a=(n(97138),n(24203),n(45697)),r=n.n(a),m=n(76010),a=function(e){var t=e.onChange,n=e.value,i=e.placeHolder,e=e.style,e=void 0===e?{}:e,n=(0,m.Z)(n||"",{value:n,onChange:t}),t=n[0],n=n[1];return g().createElement(p.ZP,{style:e,className:"yt_code_editor_warapper",mode:"javascript",theme:"github",placeholder:i,value:t,onChange:n,setOptions:{enableBasicAutocompletion:!1,enableLiveAutocompletion:!1,enableSnippets:!0,showLineNumbers:!0,tabSize:2}})};const C=a;a.propTypes={style:r().object,onChange:r().func,placeHolder:r().string,value:r().string};var r=n(84204),T=n.n(r);var L={wrap_line_length:80},z=i.Z.productExperience.aspectSystem.treeEdit,M={visible:!1,editing:!1,data:{},maxLevel:0,callback:void 0,errMsg:"",aspectDict:{}},t=function(t){function e(e){var r=t.call(this,e)||this;return r.showDialog=function(){r.setState({visible:!0})},r._handleOnCancel=function(){r.setState({visible:!1},function(){setTimeout(function(){r.setState(JSON.parse(JSON.stringify(M)))},200)})},r._handleOnConfrim=function(){var e,t=r.state,n=t.liteData,i=t.aspectDict,o=r.props,a=o.maxLevel,t=o.data,o=!0;try{e=JSON.parse(n)}catch(e){o=!1}o?function n(i,o){return void 0===o&&(o=1),Object.keys(i).reduce(function(e,t){return i[t]instanceof Array?Math.max(o+1,e):Math.max(n(i[t],o+1),e)},o)}(e)!==a&&(o=!1,r.setState({errMsg:"层级不正确"})):r.setState({errMsg:"数据格式错误"});i=function i(o,a){return o instanceof Array?o.reduce(function(e,t){return!(!t||!a[t])&&(e.push({topic:t,id:a[t]}),e)},[]):Object.keys(o).reduce(function(e,t){var n;return!(!(n=i(o[t],a))||!e)&&(n={topic:t,id:Math.floor(Math.random()*(new Date).getTime()),children:n},e.push(n),e)},[])}(e,i);i||(o=!1,r.setState({errMsg:"存在非法叶子数据"})),o&&(i={id:t.id,topic:t.topic,children:i},i=(0,j.j)(i),r.props.save(s()({},i,{showTree:!1})),setTimeout(function(){r.props.save({showTree:!0})},200),r._handleOnCancel())},r._handleOnEditorChange=function(e){r.setState({liteData:e})},r._handleOnFormat=function(){r.setState({liteData:T()(r.state.liteData,L)})},r.state=JSON.parse(JSON.stringify(M)),r}return d()(e,t),e.getDerivedStateFromProps=function(e,t){return t.visible&&!t.editing?{aspectDict:e.indexList.reduce(function(e,t){return e[t.name]=t.id,e},{}),liteData:T()(JSON.stringify(function e(o,a,r){return void 0===r&&(r=1),o.children?o.children.reduce(function(t,n){var i=e(n,a,r+1);return"string"==typeof i?r===a?(t[o.topic]||(t[o.topic]=[]),t[o.topic].push(i)):r<a&&(t[i]={}):"object"==typeof i&&Object.keys(i).forEach(function(e){t[n.topic]||(t[n.topic]={}),n.topic===e?t[n.topic]=i[e]:t[n.topic][e]=i[e]}),t},{}):o.topic}(e.data,e.maxLevel)),L),editing:!0}:null},e.prototype.render=function(){var e=this.state,t=e.visible,n=e.liteData,e=e.errMsg;return g().createElement(x.Dialog,{className:"aspect_system_advance_wrapper",size:"tiny",visible:t,title:g().createElement("span",{style:{}},"编辑指标树",g().createElement(E.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:g().createElement(g().Fragment,null,g().createElement("div",null,"如果你需要快速创建指标树，且你了解Json，你可以使用此功能。如果操作有疑问，请联系客户成功。"),g().createElement("div",null,"郑重声明：此功能是针对有一定编程理解能力的用户准备的。"))},g().createElement("i",{className:"icon-cem_file1",style:{marginLeft:4,color:"#8C8C8C",fontSize:14}}))),closeOnClickModal:!1,onCancel:this._handleOnCancel},g().createElement(x.Dialog.Body,null,g().createElement("div",{className:e?"error":""},g().createElement(C,{value:n,onChange:this._handleOnEditorChange,style:{height:350}}),e&&g().createElement("span",{className:"error_msg"},e))),g().createElement(x.Dialog.Footer,null,g().createElement(x.Button,{onClick:this._handleOnFormat},"格式化"),g().createElement(x.Button,{type:"primary",onClick:this._handleOnConfrim},"确定")))},e}(t.PureComponent);const D=(0,l.connect)(function(e){e=s()({},e)[z];return{data:e.data,maxLevel:e.maxLevel,indexList:e.indexList}},function(t){return{save:function(e){return t({type:z+"/save",payload:e})}}},null,{withRef:!0})(t),O=function(t){function e(e){e=t.call(this,e)||this;return e.event={},e}return d()(e,t),e.prototype.render=function(){var n=this,e=this.props,t=e.data,i=e.maxLevel,o=e.curSelectNode,a=e.curSelectChange,r=e.showTree,s=e.fetchingNode,d=e.indexList,l=e.msgTypeList,c=e.msgList,h=e.onDataChange,u=e.onAdvanceClick,_=e.getAdvanceRef,f=e.name,p=e.getMind,m=e.fetchingTree,e=e.saveingTree;return g().createElement("div",{className:"product_experience_tree_edit"},g().createElement(v.Z,{title:[{title:"所有项目",url:"/account/project"},{title:b.t.get(b.V.backProjectConfig).name,url:"/account/project/preview"},{title:"指标树",url:"/account/project/aspectSystem/tree"},{title:f,url:""}],rightContent:g().createElement("div",null,g().createElement(x.Button,{type:"primary",onClick:u},"高级模式"),g().createElement("span",{style:{margin:"0 16px",color:"#E5E5E5"}},"|"),g().createElement(x.Button,{onClick:function(){return w.mW.go(-1)}},"取消"),g().createElement(x.Button,{type:"primary",onClick:this.props.save},"保存")),overlay:g().createElement("div",null,g().createElement("a",{style:{color:"#0847A6"},target:"_blank",rel:"noopener noreferrer",href:"https://www.yuque.com/docs/share/81b0f257-2352-4fa8-abc7-d63ca9167f0e?#《「指标树」功能说明》"},"功能说明"))}),g().createElement("div",{className:"mind_wrap"},g().createElement("div",{className:"mind"},g().createElement(y.Z,{data:r?{}:void 0,loading:m||e,style:{height:"100%"}},r&&g().createElement(S,{ref:p,name:f,data:t,maxLevel:i,curSelectChange:a,indexList:d,onDataChange:h}))),g().createElement("div",{className:"list"},g().createElement(N,{level:o&&o.data&&o.data.level,maxLevel:i,onNodeClick:function(e,t){n.props.mind.addLeafNode(e,t)},data:d,msgTypeOpts:c,msgTypeList:l,addedName:(0,j.XV)(t),loading:s}))),g().createElement(D,{ref:_}))},e}(g().Component);var I=i.Z.productExperience.aspectSystem.treeEdit,i=function(r){function e(e){var t=r.call(this,e)||this;t._handelDataChange=function(e){0===t.time?(t.props.dataChange(e),t.data=JSON.parse(JSON.stringify(e)),t.time++):c()(t.data,e)||(t.props.dataChange(e),t.data=JSON.parse(JSON.stringify(e)),t.leaveTest=!0)},t._handelSave=function(){(0,j.Dz)(t.props.data)?t.props.saveTree().then(function(e){t.leaveTest=!1,x.Message.success("保存成功")}):(t.mind.showErr(),x.Message.error("请完善末级节点"))},t._handleOnAdvanceClick=function(){t.advanceRef&&t.advanceRef.wrappedInstance&&t.advanceRef.wrappedInstance.showDialog()},t.routerWillLeave=function(e){return!t.leaveTest||"信息还未保存，确认要离开？"},e.location||w.mW.push("/notFind");var n=e.location.state||e.location.query,i=n.name,o=n.level,a=n.module,e=n.id,n=n.moduleName;return t.props.save({name:i,id:e,moduleName:n,projectId:b.t.get(b.V.backProjectConfig).id}),e||i&&o||w.mW.push("/notFind"),e?t.props.fetchTree():t.props.save({data:(0,j.kp)(n,Number(o)),showTree:!0,maxLevel:Number(o),module:a}),t.time=0,t.event={onDataChange:t._handelDataChange,onAdvanceClick:t._handleOnAdvanceClick,getAdvanceRef:function(e){return t.advanceRef=e},getMind:function(e){return t.mind=e},save:t._handelSave},t.props.fetchMsgType(),t.props.fetchNodeList(),t}d()(e,r);var t=e.prototype;return t.componentDidMount=function(){this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave)},t.componentWillUnmount=function(){this.props.clean()},t.render=function(){return g().createElement(O,s()({},this.props,this.event,{mind:this.mind}))},e}(g().Component);const A=(0,l.connect)(function(e){var t=e.loading,e=o()(e,["loading"]);return s()({},e[I],{fetchingNode:t.effects[I+"/fetchNodeList"]||!1,fetchingTree:t.effects[I+"/fetchTree"]||!1,saveingTree:t.effects[I+"/saveTree"]||!1})},function(t){return{save:function(e){return t({type:I+"/save",payload:e})},clean:function(e){return t({type:I+"/clean",payload:e})},fetchTree:function(e){return t({type:I+"/fetchTree",payload:e})},fetchNodeList:function(e){return t({type:I+"/fetchNodeList",payload:e})},fetchMsgType:function(e){return t({type:I+"/fetchMsgType",payload:e})},curSelectChange:function(e){return t({type:I+"/curSelectChange",payload:e})},dataChange:function(e){return t({type:I+"/dataChange",payload:e})},saveTree:function(e){return t({type:I+"/saveTree",payload:e})}}})(i)},61918:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var t=n(67294),c=n.n(t),t=n(45697),n=n.n(t),t=function(e){var t=e.className,n=e.onClear,i=e.onSearch,o=e.placeholder,a=e.style,r=e.defValue,s=e.signal,e=c().useState(r),d=e[0],l=e[1];c().useEffect(function(){l(r)},[r,s]);return c().createElement("div",{style:a,className:"yt_search_input_wrapper "+(t||"")},c().createElement("input",{placeholder:o,value:d,onKeyDown:function(e){13===e.keyCode&&i(d)},onChange:function(e){return l(e.target.value)},autoComplete:"off"}),d&&c().createElement("i",{className:"icon-cem_log-off",onClick:function(){l(""),n&&n("")}}),c().createElement("i",{className:"icon-cem_small-search",onClick:function(){return i(d)}}))};t.propTypes={className:n().string,onSearch:n().func.isRequired,placeholder:n().string,style:n().object,defValue:n().string,signal:n().any,onClear:n().func};const i=t}}]);