(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1204],{31204:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>we});function E(e){var n=["#7262fd","#1890ff","#78d3f8","#60dda9"];return e.length?JSON.parse(JSON.stringify(e)).map(function(e,t){return e.keywords=e.keywords||[],e.isInput=!1,e.color=n[t],e}):[]}var a=n(37316),o=n.n(a),r=n(67154),_=n.n(r),i=n(85354),l=n.n(i),w=n(67294),b=n.n(w),t=n(55609),N=n(39432),T=n(48577),k=n(43036),a=n(45697),r=n.n(a),x=(n(53294),n(56697)),O=(n(43378),n(62443)),F=(n(89858),n(51024)),D=(n(75314),n(11187)),i=n(48926),I=n.n(i),a=n(87757),S=n.n(a),M=n(70715),R=n(30133),Y=n(7660),P=n(35239);const V=function(e){var o=e.comparisonItems,t=e.recordId,r=e.onChange,n=e.fetchingScreeningMap,a=(0,w.useState)(!1),i=a[0],l=a[1],s=(0,w.useState)(!1),a=s[0],c=s[1],s=(0,w.useState)(E(o)),u=s[0],d=s[1],s=(0,w.useState)(0),p=s[0],m=s[1],f=function(){var t=I()(S().mark(function e(t){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:8===t.keyCode&&""===t.target.value&&(u[p].keywords.pop(),d([].concat(u)));case 1:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}();(0,w.useEffect)(function(){P.t.get(P.V.comparisonItemsSession,"session")&&0<P.t.get(P.V.comparisonItemsSession,"session").length?(d(E(P.t.get(P.V.comparisonItemsSession,"session"))),e.save({comparisonItems:P.t.get(P.V.comparisonItemsSession,"session")})):(d(E(o)),e.save({comparisonItems:E(o)})),e.router.setRouteLeaveHook(e.route,function(e){"/explore/free/result"!==e.pathname&&P.t.remove(P.V.comparisonItemsSession,"session")})},[p,i,a]),(0,w.useEffect)(function(){var e=document.querySelector(".rc-tag-input .input-area input");return e&&e.addEventListener("keydown",f),function(){e&&e.removeEventListener("keydown",f)}},[u]);function h(){return b().createElement("div",{className:"overlay_box"},b().createElement("p",{className:"about_word",onClick:g},b().createElement("i",{className:"icon-xiangguanci"}),"相关词"),1<u.length&&b().createElement("p",{className:"delete_word",onClick:function(e){return v(e,p)}},b().createElement("i",{className:"icon-cem_cancel"}),"删除"))}function g(e){e.stopPropagation(),l(!0),setTimeout(function(){var e=document.querySelector(".analyse_rc_input .rc-tag-input .input-area input");e&&(e.focus(),e.value="")},10)}function v(e,t){e.stopPropagation(),e=[].concat(u),1!==u.length&&(e.splice(t,1),d([].concat(e)),r(e,t))}var y=function(){var n=I()(S().mark(function e(t,n){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),t.stopPropagation(),u.forEach(function(e,t){e.isInput=t===n}),e.next=5,d([].concat(u));case 5:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),C=u.length;return b().createElement("div",{className:"analyse_object_wrap"},n&&!t?b().createElement(R.Z,{paragraph:["40%"],className:"explore_res_skeleton"}):b().createElement("div",{className:"analyse_object"},u.map(function(e,n){return e.isInput?b().createElement("div",{className:"analyse_item",style:{width:100/(C+1)+"%"}},b().createElement(F.default,{className:"object_item_input",defaultValue:e.name,onBlur:function(e){return function(n,a){var e=o.find(function(e){return e.name===n.target.value});if(!n.target.value)return u.forEach(function(e,t){e.isInput=!1}),void d([].concat(u));if(e&&n.target.value!==o[a].name)D.default.error("已存在此关键词!");else{if(n.target.value===o[a].name)return u.forEach(function(e,t){e.isInput=!1}),void d([].concat(u));u.forEach(function(e,t){e.isInput=!1,a===t&&(e.name=n.target.value)}),d([].concat(u)),r(u,a)}}(e,n)},autoFocus:!0,onFocus:function(e){e.currentTarget.select()},onKeyUp:function(e){return function(n,a){if(n.stopPropagation(),13===n.keyCode)if(n.target.value)if(o.find(function(e){return e.name===n.target.value})&&n.target.value!==o[a].name)D.default.error("已存在此关键词!");else{if(n.target.value===o[a].name)return u.forEach(function(e,t){e.isInput=!1}),void d([].concat(u));u.forEach(function(e,t){e.isInput=!1,a===t&&(e.name=n.target.value)}),d([].concat(u)),r(u,a)}else u.forEach(function(e,t){e.isInput=!1}),d([].concat(u))}(e,n)},onClick:function(e){e.stopPropagation()}})):b().createElement("div",{className:"analyse_item object_item"+(n+1),key:e.name,style:{width:100/(t?1:3<C?C:C+1)+"%"}},b().createElement("div",{onClick:function(e){return!t&&y(e,n)}},b().createElement("p",{className:"analyse_title",style:{marginTop:e.keywords&&e.keywords.length?"15px":"24px"}},e.name),e.keywords.length?b().createElement(O.default,{content:e.keywords.join("、"),className:"about_words_tooltip",getPopupContainer:function(){return document.querySelector(".analyse_object_wrap .analyse_object")},placement:"bottomLeft"},b().createElement("p",{className:"about_word_tip",style:{display:e.keywords&&e.keywords.length?"block":"none"}},"相关词：",e.keywords.length,"个")):"",!t&&b().createElement(k.Z,{title:"",overlay:h,placement:"bottom",getPopupContainer:function(){return document.querySelector(".analyse_object_wrap .analyse_object")},trigger:"click"},b().createElement("p",{className:"more",onClick:function(e){return t=n,e.stopPropagation(),void m(t);var t}},b().createElement("i",{className:"icon-cem_new-more"})))))}),!t&&o.length<4&&(a?b().createElement("div",{className:"add_object",style:{width:100/(u.length+1)+"%"}},b().createElement(F.default,{autoFocus:!0,onBlur:function(t){if(t.target.value){if(o.find(function(e){return e.name===t.target.value}))return c(!1),void D.default.error("已存在此关键词!");u.push({name:t.target.value,isInput:!1,keywords:[],id:u.length,color:M.EH[u.length]}),d([].concat(u)),r(u,u.length-1),c(!1)}else c(!1)},onKeyUp:function(e){var t;13===(t=e).keyCode&&t.target.value&&(o.find(function(e){return e.name===t.target.value})?D.default.error("已存在此关键词!"):(u.push({name:t.target.value,isInput:!1,keywords:[],id:u.length,color:M.EH[u.length]}),d([].concat(u)),r(u,u.length-1),c(!1)))},className:"add_object_input"})):b().createElement("p",{className:"add_object",onClick:function(){c(!0)},style:{display:3<u.length?"none":"block",width:100/(u.length+1)+"%"}},"+ 添加对比"))),b().createElement(x.Z,{className:"analyse_object_modal",title:"编辑相关词",visible:i,onOk:function(){d([].concat(u));var e=document.querySelector(".analyse_rc_input .rc-tag-input .input-area input");e&&u[p].keywords.length<10&&""!==e.value.trim()&&!u[p].keywords.includes(e.value.trim())&&(u[p].keywords=[].concat(u[p].keywords,[e.value.trim()]),d([].concat(u))),r(u,p),l(!1)},wrapClassName:"explore_about_word_modal",onCancel:function(){u[p].keywords=o[p].keywords,d([].concat(u)),l(!1)}},b().createElement(b().Fragment,null,b().createElement(Y.EG,{classNameWrap:"analyse_rc_input",className:"rule_content "+(u[p]&&u[p].keywords.length?"active":""),tags:u[p]&&u[p].keywords,onAdd:function(e){e=e.name;u[p].keywords.length<10&&""!==e.trim()&&!u[p].keywords.includes(e.trim())&&(u[p].keywords=[].concat(u[p].keywords,[e.trim()])),d([].concat(u))},createTagOnPress:[" ",13],placeholder:u[p]&&u[p].keywords.length?"":"请输入相关词，按回车键可添加多个关键词",onDelete:function(e,t,n){u[p].keywords.splice(t,1),d([].concat(u))},onInputChange:function(e){}}),b().createElement("span",{className:"about_tips"},"* 最多可输入10个相关词"))))};var C=n(8201),j=n(98191),L=[{title:"按小时",value:"HOUR"},{title:"按天",value:"DAY"},{title:"按周",value:"WEEK"},{title:"按月",value:"MONTH"},{title:"按季",value:"QUARTER"},{title:"按年",value:"YEAR"}],i=function(t){function e(e){var n=t.call(this,e)||this;return n.getPanelWidth=function(){var e=n.props,t=e.flavor,e=e.options,e=Math.max.apply(null,e.map(function(e){return(0,N.jD)(e.title,14)}))+2+10+32;return 100<(e+=void 0!==t?24:0)?e:100},n._setPadShowFalse=function(){n.state.show&&n.setState({show:!1})},n._handleParentClick=function(e){n.state.show&&n.props.showFlavor&&n.props.enable&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},n._handleTriggerOnClick=function(){var e=n.state.show;n.props.enable&&setTimeout(function(){n.setState({show:!e})},0)},n.state={show:!1,firstLiHover:!1,panelWidth:n.getPanelWidth()},n}l()(e,t);var n=e.prototype;return n.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},n.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},n.componentDidUpdate=function(e){var t=e.options,e=this.props.options;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({panelWidth:this.getPanelWidth()})},n.render=function(){var e=this.state,t=e.show,n=e.panelWidth,a=this.props,o=a.activeObj,r=void 0===o?"":o,i=a.onChange,l=a.options,s=a.objName,c=a.preTitle,u=a.sufTitle,d=void 0===u?"":u,p=a.showTitle,m=void 0!==p&&p,f=a.overlay,h=a.divider,g=void 0===h?"right":h,v=a.flavor,y=a.className,C=void 0===y?"":y,E=a.onFlavorChange,e=a.sufIcon,o=a.style,u=a.type,p=void 0===u?"text":u,h=a.enable,y=a.iconType,w=a.rightHook,u=a.tips,a=l.find(function(e){return e.value===r}),d=""===r?d:a&&a.title;return r&&(d=(a=L.find(function(e){return e.value===r}))?a.title:r),b().createElement("div",{className:"single-select-button-wrapper single_select_diviver_"+g+" single-select-button_"+p+" "+C,style:o,onClick:this._handleParentClick},b().createElement("div",{className:"button_content "+(h?"":"button_content_disable")},b().createElement("span",{onClick:this._handleTriggerOnClick},b().createElement("span",{className:"button-trigger "+(t?"sel":"")},m&&b().createElement(b().Fragment,null,c&&b().createElement("span",{className:"pre-title"},c,"："),u?b().createElement(O.default,{content:u,placement:"top"},y?b().createElement("i",{className:y+" word_icon_hover "+("no"!==r?"active_light":"")}):b().createElement("span",{className:"button-title"},d)):y?b().createElement("i",{className:y+" word_icon_hover "+("no"!==r?"active_light":"")}):b().createElement("span",{className:"button-title"},d)),h&&b().createElement("i",{className:e||"icon-cem_pull-down-or-take-up",style:{transform:t?"rotate(-180deg)":""}})),f&&b().createElement("span",{style:{marginLeft:4}},b().createElement(k.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:f},b().createElement("i",{className:"icon-cem_file1"})))),b().createElement("div",{className:"button-panel "+(t?"active":""),style:{minWidth:n}},l.map(function(n,e){return b().createElement("div",{className:"panel-item "+(n.value===r?"sel":"")+" "+(n.disabled?"disabled":""),key:n.value,onClick:function(){var e;n.disabled||i(s?((e={})[s]=n.value,e):n.value)}},b().createElement("i",{className:n.icon+" panel-item-icon"}),b().createElement("span",{className:"ellipsis",style:{maxWidth:97.5}},n.title),void 0!==v&&b().createElement("i",{className:v===n.value?"icon-cem_star":"icon-cem_star-filling star_hide",onClick:function(e){var t;e.stopPropagation(),E(v===n.value?s?((e={})[s]="",e):"":s?((t={})[s]=n.value,t):n.value),i(s?((t={})[s]=n.value,t):n.value)}}),b().createElement("i",{className:n.value===r&&w?"icon-cem_right1 choice":""}))}))))},e}(b().PureComponent);i.defaultProps={enable:!0,activeObj:"",sufTitle:"",showTitle:!0,divider:"right",className:"",type:"text"},i.propTypes={activeObj:r().any,onChange:r().func.isRequired,options:r().array.isRequired,objName:r().any,preTitle:r().string,sufTitle:r().string,showTitle:r().bool,overlay:r().string,divider:r().oneOf(["both","left","right","none"]),flavor:r().string,onFlavorChange:r().func,className:r().string,sufIcon:r().string,style:r().object,type:r().oneOf(["button","text"]),enable:r().bool,iconType:r().bool};const W=i;function s(e){var a=e.map(function(e){return e.comparisonItemName}),o={};e.forEach(function(t){t.data.forEach(function(e){o[e.name]=o[e.name]||{},o[e.name][t.comparisonItemName]=e.count})});var t,r=[];for(t in o)!function(t){var n=[t];a.forEach(function(e){return n.push(o[t][e])}),r.push(n)}(t);return a.unshift("日期"),r.splice(0,0),r}var A=n(50976),H=n(94644),J=n(87300),q=[{title:"左图",value:"left"},{title:"右图",value:"right"},{title:"全部",value:"all"},{title:"不显示",value:"no"}],Z={FREE_EXPLORE_MSG_COMMENT:"评论数量",FREE_EXPLORE_MSG_SERVICE:"会话数量"};function z(e,t){var n=t&&0<t.length&&t.map(function(e){return[e.comparisonItemName,e.total]}),e=e.map(function(e){return e.comparisonItemName});return{datasets:[{dimensions:["主题","消息数量"],source:n},{dimensions:["日期"].concat(e),source:t&&0<t.length&&s(t)}]}}function U(e){var t=0;e.forEach(function(e){e=parseFloat(e[1]);t<e&&(t=e)});for(var t=Math.ceil(t),n=0;n<4;n++)t%4!=0&&t++;return{intVal:(t=0===t?4:t)/4,maxVal:t}}function B(e){var e=JSON.parse(JSON.stringify(e)),t=0,n=[];e.forEach(function(e){e.splice(0,1),n.push.apply(n,e)}),n.forEach(function(e){t<e&&(t=e)});for(var t=Math.ceil(t),a=0;a<4;a++)t%4!=0&&t++;return{intVal:(t=0===t?4:t)/4,maxVal:t}}var G,K;const Q=function(e){function a(e){g&&((0,C.P)(u)?(e=function(t,e,n,a,c,u,d){void 0===u&&(u="DAY");var p=z(t,e).datasets;return{title:{text:n},dataset:p.map(function(e){return _()({},e,{sourceHeader:!1})}),legend:{left:18,top:46,itemWidth:10,itemHeight:12,itemGap:24,data:t.map(function(e){return e.comparisonItemName}).map(function(e){return{name:e,icon:"circle"}})},grid:[{left:36,right:"62%",top:90,bottom:50,containLabel:!0},{left:"42%",top:90,right:80,bottom:50,containLabel:!0}],tooltip:{trigger:"axis",showDelay:20,hideDelay:0,className:"explore_line_tooltip",backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n      box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",confine:!0,enterable:!0,padding:0,formatter:function(n,a,o){var e=n[0],r=e.marker,i=e.name,l=e.value,s=e.seriesType;return setTimeout(function(){if("bar"===s)return o(a,(0,J.r)("<span style='position:relative;font-size: 12px;font-weight: 400;color:#8c8c8c;'>消息数量\n                <span style='position:absolute;width:30px;height:250px;top:-50px;left:-36px;'></span>\n                    <span style='position:absolute;width:30px;height:250px;top:-50px;right:-38px;'></span>\n                </span><br/>",['<div class="item_content_row" style="margin-bottom: 12px">'+r+" <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-right:50px;'>"+i+'</span>\n                    <span style="color: #262626">'+l+"</span>\n                  </div>"],[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return c(n[0],i)}}])),!0;n[0].axisValue;var e=n.map(function(e){var t=e.marker,n=e.seriesName,e=e.value;return{name:'\n              <div class="item_content_row" style="margin-bottom: 16px">\n                <span style=\'font-size: 12px;font-weight: 400;color:#8c8c8c;\'>'+t+n+'</span>\n                <span style="color: #262626">'+e+"</span>\n              </div>",value:e}}).sort(function(e,t){return t.value-e.value}).map(function(e){return e.name}),t="\n            <div>\n              <p style='font-size: 12px;font-weight: 400;color:#8c8c8c;'>\n              "+Z[d]+"\n              </p>\n              <p style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-top:15px'>"+(0,N.Sn)(u,i)+"</p>\n            </div>\n          ";o(a,(0,J.r)(t,e))},0)}},xAxis:[{type:"category",gridIndex:0,axisTick:{show:!0},axisPointer:{type:"none",label:{show:!1}},axisLabel:{color:"#626262"},data:t.map(function(e){return e.comparisonItemName})},{type:"category",gridIndex:1,axisPointer:{type:"line",label:{show:!1}},boundaryGap:!1,axisLabel:{color:"#626262",formatter:function(e){return t&&t.length?(0,N.Sn)(u,e):e}},data:t[0].data.map(function(e){return{value:e.name}})}],yAxis:[{type:"value",data:t.map(function(e){return e.data.map(function(e){return e.count})}),axisTick:{length:4},axisLabel:{color:"#626262",formatter:function(e){return(0,N.hE)(e)}},max:U(p[0].source).maxVal,interval:U(p[0].source).intVal,splitNumber:4,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#999"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}},{type:"value",axisLabel:{show:!0,color:"#626262",formatter:function(e){return(0,N.hE)(e)}},data:t.map(function(e){return e.data.map(function(e){return e.count})}),axisPointer:!1,max:B(p[1].source).maxVal,interval:B(p[1].source).intVal,splitNumber:4,gridIndex:1,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}}],series:[{type:"bar",barWidth:30,xAxisIndex:0,yAxisIndex:0,data:p&&0<p.length&&p[0].source&&p[0].source.map(function(e,t){return{name:e[0],value:e[1],itemStyle:{color:M.EH[t]},tooltip:{trigger:"item",formatter:function(e,t,n){var a=e.marker,o=e.name,r=e.value,i=e.seriesType;return setTimeout(function(){"bar"===i&&n(t,(0,J.r)("<span style='position:relative;font-size: 12px;font-weight: 400;color:#8c8c8c;'>消息数量\n                        <span style='position:absolute;width:30px;height:250px;top:-50px;left:-36px;'></span>\n                            <span style='position:absolute;width:30px;height:250px;top:-50px;right:-38px;'></span>\n                        </span><br/>",['<div class="item_content_row" style="margin-bottom: 12px">'+a+" <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-right:50px;'>"+o+'</span>\n                            <span style="color: #262626">'+r+"</span>\n                          </div>"],[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return c(e[0],o)}}]))})}}}}),label:{show:!("left"!=a&&"all"!=a),position:"top",valueAnimation:!0,color:"#8c8c8c"}}].concat(e.map(function(s,t){return{type:"line",name:s.comparisonItemName,xAxisIndex:1,yAxisIndex:1,showSymbol:!0,symbolSize:1,datasetIndex:1,data:p[1].source.map(function(e){return{value:e[t+1],tooltip:{trigger:"item",formatter:function(r,i,l){return setTimeout(function(){var e=r.name,t=r.value,n=r.marker,a=r.seriesName,o="\n                  <div style='font-size: 12px;font-weight: 400;color:#8c8c8c;position:relative;'>\n                    <span> "+Z[d]+"</span>\n                    <span style='position:absolute;width:30px;height:250px;top:-50px;left:-33px;'></span>\n                    <span style='position:absolute;width:30px;height:250px;top:-50px;right:-38px;'></span>\n                  </div><br/>\n                  <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;'>\n                    "+(0,N.Sn)(u,e)+"\n                  </span>\n                ",t=['\n                  <div class="item_content_row" style="margin-bottom: 12px">\n                    '+n+" <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;margin-right:50px;'>"+s.comparisonItemName+'</span><span style="color: #262626">'+(0,N.hE)(t)+"</span>\n                  </div>"];l(i,(0,J.r)(o,t,[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return c(r,a,"",e,p[1].source)}}]))},0)}}}}),itemStyle:{color:M.EH[t]},label:{show:!("right"!=a&&"all"!=a),position:"top",valueAnimation:!0,color:"#8c8c8c"}}}))}}(u,u,"主题对比",e,s,r=p?h.dateGroupType:r,m),g.clear(),g.setOption(e)):v(void 0))}var t=e.labelTypeFlavor,o=e.labelType,n=e.timeOptions,r=e.timeType,i=e.timeTypeFlavor,l=e.save,s=e._handleOnMsgClick,c=e.fetchBarOrLineData,u=e.chartData,d=e.setDefaultValue,p=e.recordId,m=e.selectValue,f=e.barLineLoading,h=(e.filterValue,e.expandParam.dateFilter),e=(0,w.useState)(void 0),g=e[0],v=e[1],y=P.t.get(P.V.curProject).id||"";b().useEffect(function(){G=setTimeout(function(){var e,t,n;g&&(clearInterval(G),a(o),t=(e=g._dom.children)[0],n=e[1],t.addEventListener("mouseleave",function(e){K=setTimeout(function(){K&&(n.style.display="none")},1e3)}),n&&n.addEventListener("mouseenter",function(e){K=void 0}))},200),a(o)},[g,o,r,i,u]);return b().createElement("div",{className:"yt_analyse_object_chart_wrapper"},b().createElement(C.Z,{className:"yt_analyse_object_chart",loading:f,data:u,renderTitle:b().createElement(j.Z,{title:"主题对比",data:u,onMoreClick:function(){}},b().createElement(W,{options:n,activeObj:r,flavor:i,showTitle:!0,rightHook:!0,enable:!p,onChange:function(e){l({timeType:e}),c({projectId:y})},onFlavorChange:function(e){d((e=e)===i?{timeTypeFlavor:""}:{timeTypeFlavor:e})}}),b().createElement(W,{options:q,activeObj:o,flavor:t,tips:"显示图表标签",iconType:"icon-tubiaobiaoqian",rightHook:!0,onChange:function(e){l({labelType:e}),a(o)},onFlavorChange:function(e){d(t===(e=e)?{labelTypeFlavor:""}:{labelTypeFlavor:e})}}),b().createElement("div",{className:"export_icon"},b().createElement(O.default,{content:"导出数据"},b().createElement("i",{className:"icon-daochu",onClick:function(){!function(e,t){e=z(e,t).datasets,t=[e[0].dimensions].concat(e[0].source),e=[e[1].dimensions].concat(e[1].source),t=[].concat(t,[[""]]),e=[].concat(e,[[""]]);(0,H.aT)([t,e],"主题对比")}(u,u)}})),b().createElement(O.default,{content:"导出图片"},b().createElement("i",{className:"icon-xiazaitupian",onClick:function(){(0,H._v)(g,"主题对比")}}))))},b().createElement(A.Z,{theme:"yt_multi_color_4",className:"yt_echarts_style",option:{},style:{width:"100%",height:"100%"},onChartReady:function(e){return v(e)}})))};function c(t,n,a){setTimeout(function(){var e={type:n,seriesIndex:0,seriesName:"overview-wordcloud"};a&&(e.name=a),t.dispatchAction(e)},0)}var v=[{title:"Top10",value:"10"},{title:"Top20",value:"20"},{title:"Top30",value:"30"},{title:"Top50",value:"50"},{title:"Top100",value:"100"}],y=[{title:"单色词云",value:"0",icon:"icon-cem_cloud-new"},{title:"多色词云",value:"1",icon:"icon-duoseciyun"},{title:"表格",value:"2",icon:"icon-biaoge"}],X=[{title:"词云",value:"0",icon:"icon-ciyunxuanze"},{title:"表格",value:"1",icon:"icon-biaoge"}],u=0;const $=function(t){function e(e){var a=t.call(this,e)||this;return a._handleOnMouseOver=function(e){var t=e.componentType,n=e.componentSubType,e=e.name;a.shouldNotCallOutside=!0,"series"===t&&"wordCloud"===n&&(c(a.wordcloudRef,"downplay",e),c(a.wordcloudRef,"showTip",e))},a._handleOnMouseOut=function(e){var t=e.componentType,n=e.componentSubType;a.shouldNotCallOutside=!0;e=a.state.hightlightNames;"series"===t&&"wordCloud"===n&&(c(a.wordcloudRef,"downplay",void 0),e&&c(a.wordcloudRef,"highlight",e),c(a.wordcloudRef,"hideTip",void 0))},a._resize=function(){a.shouldNotCallOutside=!1},a._handleFinished=function(){a.shouldNotCallOutside||(a.lastFinishTimeoutId||a.props.onReady(!1),a.lastFinishTimeoutId&&clearTimeout(a.lastFinishTimeoutId),a.lastFinishTimeoutId=setTimeout(function(){a.props.onReady(!0),a.lastFinishTimeoutId=void 0},100))},a.wordcloudRef,a.lastFinishTimeoutId=void 0,a.shouldNotCallOutside=!1,a.state={hightlightNames:void 0},a}l()(e,t);var n=e.prototype;return n.componentDidUpdate=function(e){var t=this,n=e.data,a=e.top,e=this.props,o=e.data,r=e.top;if(a!==r||JSON.stringify(n)!==JSON.stringify(o)){console.log("inner");var i=void 0;if(0!==r)for(var i=[],l=o.length-1;r<=l;l--)i.push(o[l].name);this.setState({hightlightNames:i},function(){c(t.wordcloudRef,"downplay",void 0),i&&c(t.wordcloudRef,"highlight",i)})}},n.componentDidMount=function(){window.addEventListener("resize",this._resize)},n.componentWillUnmount=function(){window.removeEventListener("resize",this._resize)},n.render=function(){var t=this,e=this.props,n=e.option,a=e.getRef,o=e.style,e=e.colorType;return b().createElement(A.Z,{theme:"0"===e?"":"yt_multi_color_10",option:n,style:o,onChartReady:function(e){a(e),t.wordcloudRef=e}})},e}(b().PureComponent);var ee=n(60496),d=n(92360),p={n:"#729EF8",a:"#F6903D",un:"#60DDA9"},m={n:"名词",a:"形容词",un:"其他"};const te=function(e){var t=e.data,n=e.style,a=e.getRef,o=e.title,r=e.changeTopTable,i=e.wordCloudTotal,e=(0,w.useState)(1),l=e[0],s=e[1];b().useEffect(function(){s(1)},[r]);r=t.slice(40*(l-1),40*l),r.reduce(function(e,t){return e+t.total},0);return b().createElement("div",{className:"explort_wordlist-wrapper",style:n,ref:a},b().createElement("div",{className:"title"},o),b().createElement("div",{className:"list"},r.map(function(e,t){var n=t+1+40*(l-1),a=e.pos?p[e.pos]:n<11?M.Fq[t%M.Fq.length]:"#8c8c8c";return b().createElement(k.Z,{key:e.name+"_"+t,placement:"top",overlay:b().createElement(b().Fragment,null,b().createElement("div",{dangerouslySetInnerHTML:{__html:'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+a+';"></span> '+e.name}}),e.pos&&b().createElement("div",null,"词性："+m[e.pos]))},b().createElement("div",{className:"item"},b().createElement("span",{className:"index "+(100===n?"last_item":""),style:{background:a}},n),b().createElement("span",{className:"name"},e.name),b().createElement("span",{className:"total"},""+(e.total/i*100).toFixed(2))))})),b().createElement("div",{className:"pagination"},b().createElement(d.Pagination,{layout:"prev, pager, next",small:!0,total:t.length,pageSize:40,currentPage:l,onCurrentChange:function(e){return s(e)}})))};var a=n(18446),f=n.n(a),h=[{nounCount:!1},{adjCount:!1},{unCount:!1}],g=[{nounColor:"#729EF8"},{adjColor:"#F6903D"},{unColor:"#60DDA9"}],ne=function(t){function e(e){var c=t.call(this,e)||this;return c.handleOnMoreClick=function(e){var t,n=c.props,a=n.name,o=n.data,r=(n.selectValue,n.enablePos),i=n.wordCloudModal,l=n.modal,s=n.wordCloudTotal;"image"===e&&c.chartRef&&"2"!==i&&"1"!==l?(0,H._v)(c.chartRef,a):"image"===e&&c.getTableRef?(0,H.Mx)(c.getTableRef,a):"data"===e&&(0,C.P)(o)&&(t=["热词","热度"],r&&t.splice(1,0,"词性"),o=o.reduce(function(e,n){return[].concat(e,[[].concat(t.map(function(e){var t;return"热词"===e?t=n.name:"词性"===e&&r?t="n"===n.pos?"名词":"a"===n.pos?"形容词":"un"===n.pos?"其他":"":"热度"===e&&(t=(n.total/s*100).toFixed(2)),t}))])},[t]),(0,H.aT)([o],"热词分析"))},c.handleCustomLegend=function(e){var t,n=c.state.showTag;"n"===(e=void 0===e?"":e)?(h[0].nounCount=!h[0].nounCount,g[0].nounColor=h[0].nounCount?"#e5e5e5":"#729EF8",-1!==n.indexOf("nounCount")?(t=n.indexOf("nounCount"),n.splice(t,1)):n.push("nounCount"),c.setState({showTag:n})):"a"===e?(h[1].adjCount=!h[1].adjCount,g[1].adjColor=h[1].adjCount?"#e5e5e5":"#F6903D",-1!==n.indexOf("adjCount")?(t=n.indexOf("adjCount"),n.splice(t,1)):n.push("adjCount"),c.setState({showTag:n})):"un"===e&&(h[2].unCount=!h[2].unCount,g[2].unColor=h[2].unCount?"#e5e5e5":"#60DDA9",-1!==n.indexOf("unCount")?(e=n.indexOf("unCount"),n.splice(e,1)):n.push("unCount"),c.setState({showTag:n}))},c.handLegendData=function(e,t){void 0===t&&(t=[]);var n=c.props,a=n.onChartClick,o=n.name,r=(n.selectValue,n.color),i=n.enablePos,n=n.wordCloudTotal;return(0,C.P)(e)?function(e,d,t,n,p,a,o,r,m){var i=[];r&&"empty"!==r&&r.length&&(i=r.map(function(e){return e.pos}));e={color:o,title:{top:16,left:19,text:p?"热词-"+p:"热词",textStyle:{color:"#262626",fontSize:14,fontFamily:""+M.I8,fontWeight:"bold"}},graphic:[{type:"group",top:60,left:40,silent:!1,children:[{type:"circle",id:"1",left:i.includes("n")?u+=5:0,ignore:!(i.includes("n")&&a),shape:{cx:5,cy:4,r:5},style:{fill:""+(n[0]&&n[0].nounColor)},onclick:function(){return t("n")}},{type:"text",left:i.includes("n")?u+=18:0,ignore:!(i.includes("n")&&a),style:{text:"名词",font:"bolder 12px "+M.I8,fill:n[0]&&"#729EF8"===n[0].nounColor?"#262626":"#e5e5e5"},onclick:function(){return t("n")}},{type:"circle",id:"2",left:i.includes("a")?i.includes("n")?u+=42:5:0,ignore:!(i.includes("a")&&a),shape:{cx:5,cy:4,r:5},style:{fill:""+(n[1]&&n[1].adjColor)},onclick:function(){return t("a")}},{type:"text",left:i.includes("a")?i.includes("n")?u+=18:23:0,ignore:!(i.includes("a")&&a),style:{text:"形容词",font:"bolder 12px "+M.I8,fill:n[1]&&"#F6903D"===n[1].adjColor?"#262626":"#e5e5e5"},onclick:function(){return t("a")}},{type:"circle",id:"3",left:i.includes("un")?i.includes("n")&&i.includes("a")||!i.includes("n")&&i.includes("a")?u+=52:i.includes("n")&&!i.includes("a")?u+=42:5:0,ignore:!(i.includes("un")&&a),shape:{cx:5,cy:4,r:5},style:{fill:""+(n[2]&&n[2].unColor)},onclick:function(){return t("un")}},{type:"text",left:i.includes("un")?i.includes("n")&&i.includes("a")||i.includes("n")||i.includes("a")?u+=18:23:0,ignore:!(i.includes("un")&&a),style:{text:"其他",font:"bolder 12px "+M.I8,fill:n[2]&&"#60DDA9"===n[2].unColor?"#262626":"#e5e5e5"},onclick:function(){return t("un")}}]}],tooltip:{showDelay:100,hideDelay:0,transitionDuration:0,enterable:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n      box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",formatter:function(e,t,n){var a=e.data,o=a.name,r=a.total,i=a.positiveCount,l=a.negativeCount,s=a.neutralCount,c=a.pos,u=e.marker;return setTimeout(function(){(l/r*100).toFixed(2),(s/r*100).toFixed(2),(i/r*100).toFixed(2);n(t,(0,J.r)("\n              <div style='position:relative;'>\n                <div class=\"title_circle\">"+u+"<span>"+o+'</span></div>\n                <span style="color: #262626">'+(r/m*100).toFixed(2)+"</span>\n                <span style='position:absolute;width:30px;height:140px;top:-50px;left:-36px;'></span>\n                    <span style='position:absolute;width:30px;height:140px;top:-50px;right:-38px;'></span>\n              </div>\n              ",[],[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return d(e,p,{name:o,pos:c})}}]))},0)}},series:[{type:"wordCloud",name:"overview-wordcloud",gridSize:12,sizeRange:[16,50],rotationRange:[0,0],width:"100%",height:"90%",data:e&&e.map(function(e){return _()({},e,{name:e.name,value:Math.sqrt(e.total),escore:[-1,0,1]})}),textStyle:{normal:{color:function(e){switch(e.data.pos){case"n":return"#729EF8";case"a":return"#F6903D";case"un":return"#60DDA9"}}},emphasis:{color:"#D8D8D8"}}}]};return a||delete e.series[0].textStyle.normal,e}(e,a,c.handleCustomLegend,g,o,i,r,t,n):{}},c.shouldComponentUpdate=function(e,t){return e.loading!==c.props.loading||f()(t.showTag,c.state.showTag)||!f()(e.item,c.props.item)},c.state={showTag:["nounCount","adjCount","unCount"],setTopActive:!1,setWordActive:!1,setCloudActive:!1,changeTopTable:""},c}return l()(e,t),e.prototype.render=function(){var t,n=this,e=this.props,a=e.data,o=e.modal,r=e.wordCloudModal,i=e.enablePos,l=e.recordId,s=e.onChange,c=e.name,u=e.loading,d=e.onWordFlavorChange,p=e.wordCloudFlavor,m=e.topN,f=e.wordCloudTotal,h=this.state.showTag,g={};return g=i?(t={n:"nounCount",a:"adjCount",un:"unCount"},e="empty"!==a&&a.filter(function(e){return h.includes(t[e.pos])}),this.handLegendData(e,a)):this.handLegendData(a),b().createElement(C.Z,{className:"yt_explore_word_analysis_chart_wrapper",data:a,loading:u,renderTitle:b().createElement(j.Z,{data:a,onMoreClick:this.handleOnMoreClick,popoverOption:"open",title:"热词-"+(c||""),titleOverlay:"热词是根据关键词热度而得出，关键词热度跟词频和重要程度有关。关键词热度值在1-100之间。"},l?b().createElement(b().Fragment,null,b().createElement("div",{className:"top_title"},b().createElement("span",null,"TOP"+m))):b().createElement(ee.Z,{className:this.state.setTopActive?"set_Top_active":"",options:v,activeObj:m,flavor:p.topN||null,rightHook:!0,onFlavorChange:function(e){d({topN:e})},onChange:function(e){n.setState({setTopActive:!0,changeTopTable:e}),s({topN:e})}}),b().createElement(b().Fragment,null,b().createElement("div",{style:{display:l?"none":"block"}},i?b().createElement(ee.Z,{className:this.state.setWordActive?"set_word_active":"",options:X,activeObj:o,flavor:p.modal||null,rightHook:!0,onFlavorChange:function(e){d({modal:e})},onChange:function(e){n.setState({setWordActive:!0}),s({modal:e})}}):b().createElement(ee.Z,{className:this.state.setCloudActive?"set_cloud_active":"",options:y,activeObj:r,flavor:p.wordCloudModal||null,rightHook:!0,onFlavorChange:function(e){d({wordCloudModal:e})},onChange:function(e){n.setState({setCloudActive:!0}),s({wordCloudModal:e})}}))),b().createElement(O.default,{content:"词性区分",placement:"top",mouseEnterDelay:.2},b().createElement("i",{style:{display:l?"none":"block",color:i?"#7262fd":"#8c8c8c"},className:"icon-cixingqufen icon_type",onClick:function(e){e.stopPropagation(),s({enablePos:!i,modal:X[0].value,wordCloudModal:y[0].value})}})))},"2"===r||"1"===o?(0,C.P)(a)&&b().createElement(te,{getRef:function(e){return n.getTableRef=e},data:a,changeTopTable:this.state.changeTopTable,title:"热词-"+(c||""),wordCloudTotal:f}):(0,C.P)(a)&&b().createElement($,{data:a,getRef:function(e){return n.chartRef=e},option:g,colorType:r,style:{width:"100%",height:"100%"}}))},e}(w.Component);function ae(e){var t=[];return e.forEach(function(e){e.values.forEach(function(e){t.push(e.label+"："+e.values.map(function(e){return e.label}))})}),t}var oe={FREE_EXPLORE_MSG_COMMENT:"电商评论",FREE_EXPLORE_MSG_SERVICE:"客服会话"},i=function(n){var a=n.comparisonItems,o=n.wordCloudFlavor,e=n.filterReady,t=n.filterValue,r=n.filterChange,i=n.onSaveButtonClick,l=n.selectValue,s=n.filterId,c=n.recordId,u=n.recordName,d=n.onWordCloudChange,p=n.onKeyWordChange,m=n.fetchingIndex,f=n.onWordFlavorChange,h=n.getFilterRef,g=n.expandParam,v=n.touchData,y=n._handleOnMsgClick,C=n.findTouchSpotByAccountId,E=g.dateFilter,w=g.messageCategory,x=(x=n.allWordCloudList)&&x.filter(function(e,t){return a&&0<a.length&&a[t]});return b().createElement("div",{className:"explore_pageview_container"},b().createElement(T.Z,{pageType:l,filterId:s,recordId:c,onReady:e,onChange:r,touchData:v,selectValue:l,showList:["fullDate","screening","save"],advanceAuthority:!1,hasHour:!0,ref:h,filterDateFilter:t&&t.dateFilter||{},comparisonItems:a,findTouchSpotByAccountId:C,rightContent:b().createElement("div",{className:"header_Filter_right_wrap_save",onClick:i},b().createElement(k.Z,{overlay:"保存探索结果",placement:"bottom",mouseEnterDelay:.2},b().createElement("i",{className:"icon-baocun"}))),valueConf:["fullInfo"]},c&&b().createElement("div",{className:"explore_result_filter"},b().createElement("div",{className:"filter_time"},b().createElement("p",{className:"filter_title"},"结果名称：",u)),b().createElement("div",{className:"filter_time"},b().createElement("p",{className:"filter_title"},"筛选时间：",(0,N.B1)(E.from),"~",(0,N.B1)(E.to,!0))),b().createElement("div",{className:"filter_result "+(ae(g.expandParam.filterValue).length?"has_value":"")},b().createElement("div",{className:"filter_result_title"},b().createElement("span",{className:"filter_title"},"筛选条件：")),b().createElement("div",{className:"filter_result_content"},b().createElement("p",null,"数据类型：",oe[w]),ae(g.expandParam.filterValue).map(function(e){return b().createElement("p",{key:e},e)})))),b().createElement("div",{className:"explore_result_view"},b().createElement(b().Fragment,null,b().createElement(V,_()({},n,{onChange:p})),b().createElement(Q,n)),b().createElement(b().Fragment,null,l&&a&&0<a.length&&x&&x.map(function(e,t){return b().createElement(ne,_()({key:t,item:e},n,{loading:m===t,name:a[t]?a[t].name:"",color:a[t]?a[t].color:"",data:e&&e.data,enablePos:e&&e.enablePos,modal:e&&e.modal,wordCloudModal:e&&e.wordCloudModal,topN:e&&e.topN,onChange:function(e){return d(t,e)},wordCloudFlavor:o[t]||{},recordId:c,selectValue:l,onWordFlavorChange:function(e){return f(t,e)},onChartClick:y,wordCloudTotal:e&&e.wordCloudTotal}))})))))};i.propTypes={onChartClick:r().func.isRequired};const re=i;var a=n(64396),ie=(n(87219),{FREE_EXPLORE_MSG_COMMENT:"COMMENT",FREE_EXPLORE_MSG_SERVICE:"SERVICE"});var le=n(57522),se=n(5133),ce=n(23570),ue=n(36144),i=function(e){function t(e){return h===name?e({result:"faild"}):h?50<=m?se.Z.warning("您已保存50个探索结果，已达上限，请先删除部分探索结果再保存新探索结果"):(t=e,ue.h.post("/freeExploring/index/searchRecord/add",{projectId:n,messageCategory:a,comparisonItems:o,dateFilter:r,headerFilterParamsNew:s,recordName:h,filterModel:i,wordCountConfigs:l,trendResult:c,wordCountResult:u,expandParam:p}).then(function(e){e=e.data;2e4===e.code&&(t({result:"success"}),se.Z.success(e.msg))}).catch(function(e){})):(C("输入框不能为空"),y(!1)),!1;var t}var n=e.projectId,a=e.messageCategory,o=e.comparisonItems,r=e.dateFilter,i=e.filterModel,l=e.wordCountConfigs,s=e.headerFilterParamsNew,c=e.trendResult,u=e.wordCountResult,d=e.setParams,p=e.expandParam,m=e.count,f=b().useState(name||""),h=f[0],g=f[1],e=b().useState(!0),v=e[0],y=e[1],f=b().useState(""),e=f[0],C=f[1];b().useEffect(function(){d({recordName:h,confirmRun:t}),!v&&h&&h.length<=120&&y(!0)},[h]);return b().createElement("div",{className:"filter_saved_edit_dialog_wrapper"},b().createElement("span",null,"名称"),b().createElement("span",{className:v?"":"required_error",style:{position:"relative"}},b().createElement(ce.Z,{className:"content_item_input",defaultValue:h,placeholder:"请输入名称",onChange:function(e){e=e.target.value;""===e.trim()?(C("输入框不能为空"),y(!1)):120<=e.length?(C("最多只能输入120个字符"),y(!1)):(C(""),y(!0)),g(e)},onBlur:function(e){e=e.target.value;""===e.trim()?(C("输入框不能为空"),y(!1)):120===e.length&&(C(""),y(!0))},maxLength:120}),b().createElement("span",{className:"tip_text"},e)))};const de=i;i.propTypes={name:r().string};const pe={edit:function(e){var n=_()({},e,{showClose:!1,content:b().createElement(de,e)});return n.onOk?(0,le.Z)(n):new Promise(function(e,t){n.onOk=e,n.onCancel=t,(0,le.Z)(n)})}};var me=n(97189),fe=n(2786),he=n(18784),r=n(30381),ge=n.n(r),ve=a.Z.explore.result,ye=a.Z.explore.savaResult,Ce=a.Z.IDBHeaderScreening.headerScreening;function Ee(e){var t=JSON.parse(JSON.stringify(e)),n=e.dateFilter;return n&&(-1===n.to.indexOf(":")&&(t.dateFilter.from=""+ge()(t.dateFilter.from).format("YYYY-MM-DD HH:mm:ss"),t.dateFilter.to=""+ge()(t.dateFilter.to).endOf("day").format("YYYY-MM-DD HH:mm:ss")),/近/.test(n.quickChoice)&&(e=ge()().format("YYYY-MM-DD HH:mm:ss").split(" ")[1],t.dateFilter.from=ge()(n.from).format("YYYY-MM-DD")+" "+e,t.dateFilter.to=""+ge()().format("YYYY-MM-DD HH:mm:ss")),/小时/.test(n.quickChoice)&&(n=(0,he.Ey)(n.quickChoice),t.dateFilter.from=n[0],t.dateFilter.to=n[1])),t}a=function(a){function e(e){var y=a.call(this,e)||this;y._handleFilterReady=function(e,t){var n=Ee(e),a=y.props,e=a.recordId,o=a.comparisonItems;e||(y.props.save({filterValue:n,filterValues:t.fullInfo.filterValue}),y.props.fetchDefaultValue().then(function(){var a=o.length;(function t(n){return y.props.fetchWordCloud({index:n}).then(function(e){n<a-1&&t(n+1)})})(0),y.props.fetchBarOrLineData()}))},y._handleFilterChange=function(e,t){var n=Ee(e);y.props.save(((n={filterValue:n,selectValue:t.selectValue,filterValues:t.fullInfo.filterValue})[t.comparisonItems?"comparisonItems":void 0]=t.comparisonItems,n));var a=y.props.comparisonItems.length;(function e(t){return y.props.fetchWordCloud({index:t}).then(function(){t<a-1&&e(t+1)})})(0),y.props.saveTimeOptions(e.dateFilter),y.props.fetchBarOrLineData()},y._handleKeyWordChange=function(e,t){P.t.set(P.V.comparisonItemsSession,e,"session");var n=y.props,a=n.fetchBarOrLineData,o=n.fetchWordCloud,r=n.comparisonItems,n=n.allWordCloudList;r.length>e.length?(n.splice(t,1),y.props.save({comparisonItems:e,allWordCloudList:JSON.parse(JSON.stringify(n))})):(y.props.save({comparisonItems:e}),o({index:t})),a()},y._handleWordCloudChange=function(e,t){var n=y.props,a=n.allWordCloudList,n=n.fetchWordCloud;a[e]=_()({},a[e],t),y.props.save({allWordCloudList:JSON.parse(JSON.stringify(a))}),1===Object.keys(t).length&&t.wordCloudModal||1===Object.keys(t).length&&t.modal||n({index:e})},y._handleWordFlavorChange=function(e,t){var n=y.props,a=n.wordCloudFlavor,n=n.setDefaultValue;a[e]=_()({},a[e],t),n({wordCloudFlavor:a})},y._handleSaveButtonClick=function(){var e=y.props,t=e.filterValue,n=e.screeningValues,a=e.selectValue,o=e.chartData,r=e.comparisonItems,i=e.allWordCloudList,e=e.timeType,l=[],s=[];i.forEach(function(e,t){l[t]={topN:e.topN,enablePos:e.enablePos,wordCloudModal:e.wordCloudModal,modal:e.modal,wordCloudTotal:e.wordCloudTotal},"object"==typeof e.data?s.push({data:e.data}):s.push({data:[]})}),r.forEach(function(e,t){l[t]=_()({},l[t],{name:e.name}),s[t]=_()({},s[t],{comparisonItemName:e.name})});i=y.filterRef&&y.filterRef.wrappedInstance&&y.filterRef.wrappedInstance.getFullValue(),i={dateFilter:_()({},t.dateFilter,{dateGroupType:e}),expandParam:i,messageCategory:a},i={projectId:P.t.get(P.V.curProject).id,messageCategory:a,comparisonItems:r,dateFilter:t.dateFilter,headerFilterParamsNew:t.headerFilterParamsNew,filterModel:n,trendResult:"object"==typeof o?o:[],wordCountResult:s,wordCountConfigs:l,expandParam:JSON.stringify(i)};pe.edit(_()({},i,{titleText:"保存探索结果",count:y.props.filterData&&y.props.filterData.count,category:"探索结果",onOk:function(e){"success"===e.result&&y.props.fetchSaveFilter(P.t.get(P.V.curProject).id)},onCancel:function(){}}))},y._handleOnMsgClick=function(e,t,n,a,o){var r,i,l=y.props,s=l.projectId,c=l.filterValue,u=l.filterValues,d=l.selectValue,p=l.comparisonItems,m=l.timeType,f=(l.messageCategory,JSON.parse(JSON.stringify(c.headerFilterParamsNew))),h=JSON.parse(JSON.stringify(u)),l={id:"CATEGORY_TYPE",values:[ie[d]]},u={id:"CATEGORY_TYPE",label:"数据类型",values:"COMMENT"===ie[d]?["电商评论"]:"SERVICE"===ie[d]?["客服会话"]:["调查问卷"]};f&&f[0]&&f&&"DEFAULT"==f[0].id?(f&&f[0].values.push(l),h&&h[0].values.push(u)):(f.unshift({id:"DEFAULT",values:[l]}),h.unshift({id:"DEFAULT",values:[u]}));u=JSON.parse(JSON.stringify(c));a&&(r=o.map(function(e){return e[0]}),i=(0,fe.X_)("line",c.dateFilter,a,r,m,!0));var g,v,h={projectId:P.t.get(P.V.curProject).id,dateFilter:a?Object.assign(_()({},u.dateFilter),{from:i.from,to:i.to,quickChoice:i.quickChoice,dateGroupType:m}):_()({},c.dateFilter),filterModel:{content:[{contain:(g=t,v=[],p.forEach(function(e){e.name===g&&(v.push(e.name),e.keywords.length&&e.keywords.forEach(function(e){return v.push(e)}))}),v),queryType:"FUZZY_SEARCH"}],queryType:"FUZZY_SEARCH",project:[s]},headerFilterParamsNew:f,filterValues:h,pageIndex:1,pageSize:20};n&&n.name&&(h.filterModel.content[0].andContain=[n.name],h.textRankWordPos=n.pos||""),h.filterTip=null,"COMMENT"===ie[d]?window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(h))):"SERVICE"===ie[d]&&window.open("/inbox/service?"+encodeURIComponent(JSON.stringify(h)))};var t=e.location.state,n=(0,me.getQuery)("query")?JSON.parse(decodeURI((0,me.getQuery)("query").replace(/\*\*\*/g,"#"))):null;return e.save({projectId:P.t.get(P.V.curProject).id,comparisonItems:n?n.comparisonItems:t&&t.searchValue?[{name:t.searchValue,keywords:[],color:"#7262FD"}]:[],selectValue:n?n.selectValue:t&&t.selectValue?t.selectValue:void 0,filterId:(0,me.getQuery)("filterId")?(0,me.getQuery)("filterId"):void 0,recordId:(0,me.getQuery)("recordId")?(0,me.getQuery)("recordId"):void 0}),y._event={_handleOnMsgClick:y._handleOnMsgClick,onSaveButtonClick:y._handleSaveButtonClick,filterReady:y._handleFilterReady,filterChange:y._handleFilterChange,onWordCloudChange:y._handleWordCloudChange,onKeyWordChange:y._handleKeyWordChange,onWordFlavorChange:y._handleWordFlavorChange,getFilterRef:function(e){return y.filterRef=e}},y}l()(e,a);var t=e.prototype;return t.componentDidMount=function(){var n=this;setTimeout(function(){var e=n.props,t=e.recordId,e=e.filterId;t&&n.props.exploreResultDetail({recordId:t}),e&&n.props.findFilterDetail({filterId:e}),n.props.fetchSaveFilter(P.t.get(P.V.curProject).id)},0)},t.componentWillUnmount=function(){this.props.clean()},t.render=function(){return this.props.selectValue?b().createElement(re,_()({},this.state,this.props,this._event)):null},e}(w.Component);const we=(0,t.connect)(function(e){var t=e.loading,e=o()(e,["loading"]);return _()({},e[ve],e[ye],{loading:t.effects[ve+"/fetchWordCloud"]||!1,barLineLoading:t.effects[ve+"/fetchBarOrLineData"]||!1,fetchingScreeningMap:t.effects[Ce+"/init"]||!1})},function(t){return{save:function(e){return t({type:ve+"/save",payload:e})},clean:function(){return t({type:ve+"/clean"})},fetchWordCloud:function(e){return t({type:ve+"/fetchWordCloud",payload:e})},fetchBarOrLineData:function(e){return t({type:ve+"/fetchBarOrLineData",payload:e})},setDefaultValue:function(e){return t({type:ve+"/setDefaultValue",payload:e})},exploreResultDetail:function(e){return t({type:ve+"/exploreResultDetail",payload:e})},findFilterDetail:function(e){return t({type:ve+"/findFilterDetail",payload:e})},getDefaultValue:function(e){return t({type:ve+"/getDefaultValue",payload:e})},fetchDefaultValue:function(e){return t({type:ve+"/fetchDefaultValue",payload:e})},distributeData:function(e){return t({type:ve+"/distributeData",payload:e})},saveDistributeData:function(e){return t({type:ve+"/saveDistributeData",payload:e})},fetchSaveFilter:function(e){return t({type:ye+"/fetchSaveFilter",payload:e})},saveTimeOptions:function(e){return t({type:ve+"/saveTimeOptions",payload:e})},findTouchSpotByAccountId:function(e){return t({type:ve+"/findTouchSpotByAccountId",payload:e})}}})(a)},2786:(e,t,n)=>{"use strict";n.d(t,{X_:()=>o});var t=n(30381),d=n.n(t),a=n(87219);function p(e,t){var n,a=JSON.parse(JSON.stringify(e)),o=e.quickChoice,r=e.from,i=e.to,e=d()().format("YYYY-MM-DD HH:mm:ss").split(" ")[1];return"近24小时"===o?1===t?(n=r.split(" ").map(function(e){return e.trim()}),a.from=d()(n[0]).format("YYYY-MM-DD")+" "+e,a.to=""+d()(n[0]).endOf("day").format("YYYY-MM-DD HH:mm:ss")):(n=i.split(" ").map(function(e){return e.trim()}),a.from=""+d()(n[0]).startOf("day").format("YYYY-MM-DD"),a.to=d()(n[0]).format("YYYY-MM-DD")+" "+e):/小时/.test(o)&&(o=r.split(" ").map(function(e){return e.trim()}),1===t?(a.from=r,a.to=d()(o[0]).format("YYYY-MM-DD")+" "+d()(r).hour()+":59:59"):(a.from=""+d()(o[0]).startOf("day").format("YYYY-MM-DD HH:mm:ss"),a.to=i)),a}var o=function(e,r,i,l,s,t){r.quickChoice;var c=r.numOfDays,u=/:/.test(r.quickChoice)||-1===r.quickChoice.indexOf("-");return"line"===e&&l instanceof Array&&0<l.length?(0,a.ZP)(r,function(e){var t,n=function(e,t,n){var a=n?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD";switch(t){case"HOUR":return{from:d()(e).format("YYYY-MM-DD HH:00:00"),to:d()(e).format("YYYY-MM-DD HH:59:59")};case"YEAR":var o=d()(e);return{from:o.startOf("year").format(a),to:o.endOf("year").format(a)};case"QUARTER":var r=e.split("-"),r=d()().year(r[0]).quarter(r[1]);return{from:r.startOf("quarter").format(a),to:r.endOf("quarter").format(a)};case"MONTH":var i=d()(e);return{from:i.startOf("month").format(a),to:i.endOf("month").format(a)};case"WEEK":r=e.split("-"),i=r[0],r=r[1],r=d()().year(i).week(r);return{from:r.startOf("week").format(a),to:r.endOf("week").format(a)};case"DAY":default:return{from:e,to:e}}}(i,s,u),a=n.from,o=n.to;"DAY"!==s&&"HOUR"!==s?JSON.stringify(i)===JSON.stringify(l[0])?a=e.from:JSON.stringify(i)===JSON.stringify(l[l.length-1])&&(o=e.to):"DAY"!==s&&"HOUR"!==s||1!==c&&2!==c||(JSON.stringify(i)===JSON.stringify(l[0])?(a=p(r,1).from,o=p(r,1).to):JSON.stringify(i)===JSON.stringify(l[l.length-1])&&(o=p(r,2).to,a=p(r,2).from)),e.from=a,e.to=o,e.numOfDays=(t=o,n=a,t=Date.parse(o),n=Date.parse(n),n=Math.abs(t-n),Math.floor(n/864e5)+1),e.quickChoice=a.replaceAll("-",".")+" - "+o.replaceAll("-",".")}):r}}}]);