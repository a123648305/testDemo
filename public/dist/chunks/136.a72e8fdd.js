(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[136],{70136:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>k});var t=n(37316),a=n.n(t),t=n(67154),r=n.n(t),t=n(85354),i=n.n(t),t=n(67294),h=n.n(t),p=n(19586),d=n(8201),f=n(50976),m=n(25713),o=n(92360);const g=function(e){var t=e.options,n=e.onChange,a=e.activeObj,r=e.objName;return h().createElement("div",{className:"yt-radio-select-button-wrapper"},h().createElement(o.Radio.Group,{value:a,onChange:function(e){var t;n(((t={})[r]=e,t))}},t.map(function(e){return h().createElement(o.Radio.Button,{key:e.title,value:e.value},e.title)})))};var v=n(39432),y=n(70715),C=(0,v.jD)(" ",12);function b(c,e,t){var u,s,d;t<700?(u=1,s=t/2,d=t):700<=t&&t<1200?(s=t/4,d=t/(u=2)):1200<=t&&(s=t/5,d=t/(u=3));var h=.6*d*.5,p=.4*d-16-32,n=Math.ceil(c.length/u),t=Array.from({length:n}),a=Array.from({length:u}),t=t.reduce(function(e,t,l){return[].concat(e,a.reduce(function(e,t,n){var a=l*u+n,r=c[a];if(r){var i={type:"text",style:{text:r.dimensions[1],x:24+n*d,y:80+s*l,font:"14px "+y.I8}},o={itemWidth:12,itemHeight:12,itemGap:8,icon:y.W4.square,type:"scroll",orient:"vertical",align:"left",pageIconSize:10,top:110+s*l,left:.6*d+n*d,height:.72*s,data:r.source[0].slice(1),formatter:function(e){var t=function(e){var t=e,n=(0,v.jD)(e,12);if(72<n)for(var a=0,r=e.length;a<r;a++)if(t=e.substring(0,r-1-(a+1)),(n=(0,v.jD)(t+"...",12))<=72){t+="...";break}return{label:t,labelWidth:n}}(e.split("$_$")[1]),n=t.label,a=t.labelWidth,t=r.source[0].indexOf(e),e=(100*r.source[1][t]).toFixed(2)+"%",t=(0,v.jD)(e,12),t=+((p-a-t)/C).toFixed(0);return"{a|"+n+"}"+Array.from({length:t}).map(function(){return" "}).join("")+"{b|"+e+"}"},textStyle:{rich:{a:{padding:4,color:"#262626"},b:{color:"#8c8c8c"}}}};return[].concat(e,[{title:i,legend:o,serie:{type:"pie",datasetIndex:a,seriesLayoutBy:"row",hoverOffset:4,itemStyle:{borderColor:"#ffffff",borderWidth:2,color:function(e){e=e.dataIndex;return y.Fq[e%y.Fq.length]}},label:{show:!1},labelLine:{show:!1},center:[h+d*n,.5*(s-60)+s*l+80+30],radius:[.45*h,.65*h]}}])}return e},[]))},[]);return{title:{text:"品牌评论数分布"},dataset:c.map(function(e){return r()({},e,{sourceHeader:!0})}),tooltip:{formatter:function(e){var t=e.marker,n=e.data,e=e.percent;return[t+" "+n[0].split("$_$")[1],"数量："+n[2],"占比："+e+"%"].join("</br>")}},legend:t.map(function(e){return e.legend}),graphic:t.map(function(e){return e.title}),series:t.map(function(e){return e.serie}),ext:{rowNum:n,colNum:u,childHeight:s}}}var E=[{title:"导出图片",type:"image"},{title:"导出数据",type:"data"}],D=[{title:"型号",value:"BRAND_MODEL"},{title:"店铺",value:"BRAND_SHOP"}];const w=function(e){var i=e.data,t=e.loading,n=e.dataType,a=e.contentWidth,r=e.onFilterChange,o=e.onMoreClick,l=h().useState(""),e=l[0],c=l[1],l=h().useState(void 0),u=l[0],s=l[1];return h().useEffect(function(){var e,t;u&&((0,d.P)(i)?(t=b(i,0,e=a-24-6),c(t.title.text),u.clear(),u.resize({width:e,height:80+t.ext.rowNum*t.ext.childHeight}),u.setOption(t)):s(void 0))},[i,u,n,a]),h().createElement(d.Z,{data:i,className:"yt-brand-dist-chart-wrapper",renderTitle:e&&h().createElement("div",{className:"title"},h().createElement("span",null,h().createElement(g,{onChange:r,objName:"bdType",options:D,activeObj:n}),h().createElement(m.Z,{onClick:function(e){return t=u,n=i,a=o,r=void 0,"image"===(e=e)?r=t:"data"===e&&(r=[[].concat(n.reduce(function(e,t){return[].concat(e,[t.dimensions],t.source.map(function(e,n){return e.map(function(e,t){return 0===n&&0!==t?e.split("-")[1]:1===n&&0!==t?(100*e).toFixed(2)+"%":e})}),[[""]])},[]))]),void a({type:e,obj:r,name:t.getOption().title[0].text});var t,n,a,r},options:E,style:{float:"right"}})))},i&&h().createElement(h().Fragment,null,h().createElement(f.Z,{theme:"yunting_multi_color",showLoading:t,loadingOption:{text:"",color:"#20a0ff"},option:{},style:{width:"100%",height:0},onChartReady:function(e){return s(e)}})))};var x=n(41103);const l=function(e){var t=e.bdData,n=e.bdType,a=e.onBrandDistFilterChange,r=e.pieChartData,i=e.barChartData,o=e.barChartLoading,l=e.contentWidth,c=e.isInitial,u=e.getFilterRef,s=e.onHeadFilterChange,d=e.onHeadFilterReady,e=e.onMoreClick;return h().createElement("div",{className:"yt-price-brand-analysis-wrapper"},h().createElement(p.Z,{title:"品牌分析",ref:u,showList:["condition","time"],filter:["CONN_CONFIG","SOURCE"],onChange:s,onFilterReady:d}),h().createElement("div",{className:"content",id:"content"},h().createElement(x.Z,{isInitial:c,loading:o,title:"品牌评论数分布",otherChartType:"bar",pieChartData:r,otherChartData:i}),h().createElement(w,{data:t,contentWidth:l,dataType:n,onMoreClick:e,onFilterChange:a})))};var c=n(35239),t=n(55609),u=n(94644),s=n(64396).Z.price.priceBranding,n=function(n){function e(e){var t=n.call(this,e)||this;return t._handleOnBrandDistFilterChange=function(e){t.props.fetchBrandDistributionData(r()({},e))},t._handleOnMoreClick=function(e){"image"===e.type?(0,u._v)(e.obj,e.name):"data"===e.type&&(0,u.aT)(e.obj,e.name)},t._handelOnHeadFilterReady=function(){var e=t.filter.getValue();t._handelOnHeadFilterChange(e)},t._handelOnHeadFilterChange=function(e){t.props.fetchDatas(r()({projectId:c.t.get(c.V.curProject).id},e))},t._handleWindowResize=function(){t.setState({contentWidth:document.getElementById("content").offsetWidth})},t.state={},t.event={onMoreClick:t._handleOnMoreClick,onBrandDistFilterChange:t._handleOnBrandDistFilterChange,onHeadFilterReady:t._handelOnHeadFilterReady,onHeadFilterChange:t._handelOnHeadFilterChange,getFilterRef:function(e){return t.filter=e}},t}i()(e,n);var t=e.prototype;return t.componentDidMount=function(){this._handleWindowResize(),window.addEventListener("resize",this._handleWindowResize)},t.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},t.render=function(){return h().createElement(l,r()({},this.props,this.state,this.event))},e}(h().PureComponent);const k=(0,t.connect)(function(e){var t=e.loading,e=a()(e,["loading"]);return r()({},e[s],{bdLoading:t.effects[s+"/fetchBrandDistributionData"]||!1,barChartLoading:t.effects[s+"/fetchBarChartData"]||!1})},function(t){return{fetchDatas:function(e){return t({type:s+"/fetchDatas",payload:e})},fetchBrandDistributionData:function(e){return t({type:s+"/fetchBrandDistributionData",payload:e})}}})(n)},38177:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(85354),r=n.n(a),t=n(67294),l=n.n(t),a=n(45697),a=n.n(a),c=n(92360),u=n(43036),i=function(t){function e(e){var c=t.call(this,e)||this;return c.getPercentage=function(){for(var e=c.props.data,t=0,n=0,a=0,r=0,i=0,o=0;o<e.length;o++){var l=e[o].value;t+=l,o<100&&(i+=l,o<50&&(r+=l,o<30&&(a+=l,o<10&&(n+=l))))}c.setState({percentage:{10:0===t?0:n/t,30:0===t?0:a/t,50:0===t?0:r/t,100:0===t?0:i/t}})},c.toggleDisplay=function(){var e=c.state.show;c.setState({show:!e})},c.switchTopValue=function(e){c.setState({topValue:e})},c.handleConfirm=function(){var e=c.props.onConfirm,t=c.state.topValue;e&&e(t),c.setState({show:!1})},c.state={show:!1,topValue:e.topValue||0,percentage:{10:0,30:0,50:0,100:0}},c}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.getPercentage()},n.render=function(){var t=this,e=this.state,n=e.show,a=e.topValue,r=e.percentage,i=this.props.data,o=i[0]?i[0].value:0,e=i[a<=i.length?a-1:i.length-1].value||0,i=[10,30,50,100];return l().createElement(c.Dialog,{title:"视图过滤",size:"tiny",visible:n,customClass:"data_filter_wrapper",onCancel:this.toggleDisplay,lockScroll:!0},l().createElement(c.Dialog.Body,null,l().createElement("div",{className:"input_set"},l().createElement(c.Input,{value:o,disabled:!0}),l().createElement("span",null,"-"),l().createElement(c.Input,{value:e,disabled:!0})),l().createElement("div",{className:"bar_set"},i.map(function(e){return l().createElement(u.Z,{placement:"top",overlay:"Top"+e+"占总数据量的"+(100*r[e]).toFixed(2)+"%",key:e},l().createElement("div",{className:a===e?"bar active":"bar",style:{height:100*r[e]+"px"},onClick:function(){return t.switchTopValue(e)}}))})),l().createElement("div",{className:"desc_set"},i.map(function(e){return l().createElement("span",{key:e},"top"+e)}))),l().createElement(c.Dialog.Footer,{className:"dialog-footer"},l().createElement(c.Button,{onClick:this.toggleDisplay},"取消"),l().createElement(c.Button,{type:"primary",onClick:this.handleConfirm},"确定")))},e}(t.Component);i.propTypes={data:a().arrayOf(a().shape({name:a().string.isRequired,value:a().number.isRequired})),topValue:a().number.isRequired,onConfirm:a().func.isRequired}},41103:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var m=n(67294),g=n.n(m),v=n(50976),y=n(30133),C=n(31705),b=n(38177),E=n(94644),t=n(67154),D=n.n(t),w=n(39432);const a=function(e){var t=e.isInitial,n=e.loading,a=e.title,r=e.otherChartType,i=e.pieChartData,o=e.otherChartData,l=e.type,c=e.formatedData,u=e.topValue,s=e.save,d=g().useState(void 0),h=d[0],p=d[1],e=g().useState(void 0),f=e[0],d=e[1];g().useEffect(function(){var e;!t&&!n&&h&&i&&0<i.length&&o&&(e=function(e){var t=e.title,n=e.otherChartType,a=e.pieChartData,r=e.otherChartData,i=e.type,o=0<a.length?a.reduce(function(e,t){return e+t.count},0):0;a.forEach(function(e){var t=0===o?0:e.count/o*100;e.percentage=Number.isInteger(t)?t:t.toFixed(2)});e={type:"pie",id:"pie",radius:["57%","68%"],center:["9%","60%"],legendHoverLink:!1,hoverAnimation:!0,hoverOffset:3,label:{show:!0,position:"center",formatter:["{a|"+w.ZP.formatNumber(o)+"}","{b|"+(i&&"PRODUCT"===i?"评论数":"销量")+"}"].join("\n"),rich:{a:{fontSize:24,lineHeight:32,color:"#262626",padding:[4,0]},b:{fontSize:14,lineHeight:20,color:"#8C8C8C",padding:[4,0]}}},itemStyle:{borderWidth:1,borderColor:"#fff"},data:a.map(function(e){return{name:e.name,value:e.count}})};r.forEach(function(e){var t=0;0<e.data.length&&e.data.forEach(function(e){t+=e.count}),e.total=t}),r.sort(function(e,t){return t.total-e.total});var l="bar"===n?{barMaxWidth:32,large:!0}:{smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{opacity:1}},i=r.map(function(e){var t=e.name,e=e.data;return D()({},l,{name:t,type:n,stack:"stack",data:0<e.length?e.map(function(e){return{name:e.date,value:e.count}}):[]})});return{title:{text:t,textStyle:{fontSize:14,lineHeight:20},left:0,top:0},tooltip:{confine:!0,enterable:a&&17<a.length,axisPointer:{type:"none"},formatter:function(e){return Array.isArray(e)?(e.sort(function(e,t){return e.value-t.value}),e[0].name+e.map(function(e){return"<br/>"+e.marker+e.seriesName+"："+e.value}).reverse().join("")):e.marker+" "+e.name+"："+e.value+"（"+e.percent+"%）"},extraCssText:"max-height: 400px; overflow: auto"},legend:{type:"scroll",orient:"vertical",left:"20%",top:"26%",itemWidth:12,itemHeight:12,itemGap:16,pageIconSize:12,formatter:function(t){return"{a|"+(9<t.length?t.substring(0,9)+"...":t)+"}{b|"+a.filter(function(e){return e.name===t})[0].percentage+"%}"},textStyle:{rich:{a:{width:102,padding:[0,4]},b:{width:48,color:"#8C8C8C",align:"right"}}},data:0<a.length?a.map(function(e){return{name:e.name,icon:"rect"}}):[]},xAxis:{type:"category",boundaryGap:"bar"===n,data:0<r.length?r[0].data.map(function(e){return e.date}):[]},yAxis:{gridIndex:0},grid:{show:!1,top:"26%",left:"40%",right:"2%",bottom:0,containLabel:!0,tooltip:{trigger:"axis"}},series:[].concat(i,[e])}}({title:a,otherChartType:r,pieChartData:i,otherChartData:o,type:l}),h.clear(),h.setOption(e))},[t,n,i,o,h,l]);e=["SPU","SHOP"];return g().createElement("div",{className:"double-chart-wrapper"},t?g().createElement(y.Z,null):0===i.length?g().createElement("div",{className:"empty-block"},"暂无数据"):g().createElement(m.Fragment,null,g().createElement(v.Z,{theme:"yunting_multi_color",option:{},showLoading:n,style:{width:"100",height:"252px",display:0<i.length?"block":"none"},loadingOption:{text:"",color:"#1574B3"},onChartReady:function(e){return p(e)}}),g().createElement(C.Z,{onDownChartClick:function(){(0,E._v)(h,a)},onDownExcelClick:function(){return function(e,t){if(0<e.length){for(var n=e.map(function(e){return e.name}),a=[],r=0;r<e[0].data.length;r++){var i=[];i.push(e[0].data[r].date);for(var o=0;o<e.length;o++)i.push(e[o].data[r].count);a.push(i)}n.splice(0,0,"日期"),a.splice(0,0,n),(0,E.aT)([a],t)}}(o,a)},otherOptions:e.includes(l)?[{label:"视图过滤",clickFun:function(){return f.toggleDisplay()}}]:[]}),e.includes(l)&&g().createElement(b.Z,{data:c,topValue:u,ref:d,onConfirm:function(e){return s({firstTopValue:e})}})))}}}]);