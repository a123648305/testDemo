(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3361],{47303:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-b9e36b"},58476:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-c6a1e8"},13192:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a=n.p+"html-aa245f"},73361:(e,t,g)=>{"use strict";g.r(t),g.d(t,{default:()=>je});var n=g(67154),f=g.n(n),a=g(85354),o=g.n(a),d=g(67294),C=g.n(d),i=g(93913),r=g.n(i),t=g(45697),n=g.n(t),v=g(92360),u=g(5133),p=g(29383),m=g(36144),c=g(95814);const l=function(t){function e(e){var a=t.call(this,e)||this;return a.inputChange=function(e){a.setState({inputVal:e.target.value})},a.keywordChange=function(e){var t=a.state,n=t.inputVal,t=t.inputValMap;"keydown"===e.type&&13===e.keyCode||"keydown"===e.type&&32===e.keyCode||"blur"===e.type?n.trim()&&(t.push(n.trim()),a.setState({inputValMap:t,inputVal:""}),a.onChange()):"keydown"===e.type&&8===e.keyCode||e.type},a.delKeyWords=function(e){var t=a.state.inputValMap;t.splice(e,1),a.setState({inputValMap:t},function(e){return a.onChange()})},a.onChange=function(){a.props.onChange&&a.props.onChange(a.state.inputValMap)},a.state={inputValMap:e.values||[],inputVal:""},a}o()(e,t);var n=e.prototype;return n.componentWillReceiveProps=function(e,t){e.values&&this.setState({inputValMap:e.values})},n.render=function(){var n=this,e=this.state,t=e.inputValMap,a=e.inputVal,i=this.props,e=i.style,i=i.close;return C().createElement("div",{className:"word-segmentation",style:e||{}},i&&C().createElement("i",{className:"close",onClick:i},"×"),C().createElement("div",{className:"input-wrap"},C().createElement("input",{type:"text",className:"keyword-setting",value:a,placeholder:"关键词(输入空格键或回车以分词)",onChange:this.inputChange,onBlur:this.keywordChange,onKeyDown:this.keywordChange})),t.map(function(e,t){return C().createElement("span",{className:"word",key:e+t},e,C().createElement("i",{onClick:function(){return n.delKeyWords(t)}},"×"))}))},e}(d.Component);function h(e,t,n,a,i,r){return m.h.post("/filter/expand/add",{name:e,copy:t,id:n,model:a,projectId:i,filter:r})}var y=g(43036),E=g(35239);const S=function(t){function e(e){var a=t.call(this,e)||this;return a.editTopic=function(e){a.editing=e,a.refs.changeNameInput.refs.input.value=e.name,a.setState({dialogVisible:!0})},a.delTopic=function(t){v.MessageBox.confirm("确认删除该组合分析, 是否继续?","提示",{type:"warning"}).then(function(){m.h.post("/filter/delete",{id:t.id}).then(function(e){a.props.onChange(null,{id:t.id}),2e4===e.data.code?u.Z.success("删除成功"):u.Z.error("删除失败")})}).catch(function(){})},a.getExpandTopicValue=function(e){return m.h.post("/filter/expand/findFilter",{id:e})},a.competeOpen=function(){45<a.refs.topics.offsetHeight?a.setState({showOpen:!0}):a.setState({showOpen:!1})},a._handleChangeName=function(){var t=a.refs.changeNameInput.refs.input.value;a.getExpandTopicValue(a.editing.id).then(function(e){var n=e.data.result;h(t,!1,n.id,a.props.model,E.t.get(E.V.curProject).id,JSON.parse(n.filter)).then(function(e){var t=e.data;2e4===t.code&&(u.Z.success("组合分析名称修改成功"),a.refs.changeNameInput.refs.input.value="",a.setState({dialogVisible:!1},function(){return a.props.fresh(n.id,{name:t.result.name,id:t.result.id})}))})})},a.renderDialog=function(){return C().createElement(v.Dialog,{title:"修改名称",className:"change-name-dialog",size:"tiny",modal:!1,visible:a.state.dialogVisible,onCancel:function(e){return a.setState({dialogVisible:!1})}},C().createElement(v.Dialog.Body,null,C().createElement(v.Input,{className:"name-input",placeholder:"请输入名称",ref:"changeNameInput"})),C().createElement(v.Dialog.Footer,null,C().createElement(v.Button,{type:"primary",onClick:a._handleChangeName},"确定"),C().createElement(v.Button,{type:"default",onClick:function(e){return a.setState({dialogVisible:!1})}},"取消")))},a.state={list:e.list||[],value:e.value||{},showOpen:!1,open:!1,dialogVisible:!1},a}o()(e,t);var n=e.prototype;return n.componentWillReceiveProps=function(e,t){(e.value||e.list)&&(this.setState({value:e.value,list:e.list}),this.competeOpen())},n.componentDidMount=function(){this.competeOpen()},n.render=function(){var n=this,e=this.state,t=e.list,a=e.showOpen,i=e.open,r=e.value,o=this.props,e=o.close,s=o.onChange;return C().createElement("div",{className:"expand-topic",style:{height:i?"":"38px"}},C().createElement("p",{className:"name"},"组合分析",C().createElement(y.Z,{overlay:C().createElement("div",{style:{width:"220px"}},"你可以基于筛选条件生成一个组合的分析对象。在切换分析对象时你可以从“组合分析”中使用你创建的组合分析对象。"),placement:"top"},C().createElement("i",{className:"icon-cem_file1 hide",style:{color:"#8c8c8c"}}))),C().createElement("div",{className:"topics",ref:"topics"},C().createElement("div",{className:"more"},a&&C().createElement("i",{className:"open",onClick:function(e){return n.setState({open:!i})}},i?"收起":"更多",C().createElement("i",{className:i?"icon-cem_pull-or-take-up":"icon-cem_pull-down-or-take-up"})),e&&C().createElement("i",{className:"closeAll",onClick:e},"×")),C().createElement("div",{className:"topic-wrap"},0<t.length?t.map(function(t,e){return C().createElement("span",{className:"topic "+(r.id===t.id?"sel":""),key:t+e},C().createElement(y.Z,{placement:"top",overlay:"单击编辑"},C().createElement("span",{onClick:function(e){return s&&s({id:t.id,name:t.name})}},t.name)),C().createElement(y.Z,{placement:"top",overlay:"重命名"},C().createElement("i",{onClick:function(e){return n.editTopic(t)},className:"icon-cem_screening-editor"})),C().createElement(y.Z,{placement:"top",overlay:"删除"},C().createElement("i",{onClick:function(){return n.delTopic(t)},className:"icon-cem icon-cem_delete"})))}):C().createElement("div",{style:{color:"#262626",lineHeight:"38px"}},"暂无主题值"))),this.renderDialog())},e}(d.Component);var s=function(t){function e(e){e=t.call(this,e)||this;return e.state={defaultChecked:!1},e}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.setState(f()({},this.props))},n.componentWillReceiveProps=function(e){this.setState(f()({},e))},n.handleClick=function(e){var t=this.state,n=t.type,a=t.defaultChecked,i=t.selectedList,t=t.totalList;"checkAll"===n?a?this.props.onChange([]):this.props.onChange(t):(-1<(t=i.indexOf(e))?i.splice(t,1):i.push(e),this.props.onChange(i)),this.setState({defaultChecked:!a})},n.render=function(){var t=this,e=this.state,n=e.type,a=e.defaultChecked,i=e.indeterminate,r=e.uniqueId,e="customized-checkobx";return a?e="customized-checkobx checked":"checkAll"===n&&i&&(e="customized-checkobx indeterminate"),C().createElement("div",{className:"customized-checkobx-wrapper"},C().createElement("div",{className:e,onClick:function(e){e.stopPropagation(),t.handleClick(r)}}))},e}(C().PureComponent);function O(e){var t,n,i,r;if(arguments.length<1)return 1;for(t=1,n=arguments.length;t<n;t++)if(i=[],r=[],!function e(t,n){if(isNaN(t)&&isNaN(n)&&"number"==typeof t&&"number"==typeof n)return 1;if(t===n)return 1;if("function"==typeof t&&"function"==typeof n||t instanceof Date&&n instanceof Date||t instanceof RegExp&&n instanceof RegExp||t instanceof String&&n instanceof String||t instanceof Number&&n instanceof Number)return t.toString()===n.toString();if(t instanceof Object&&n instanceof Object&&!t.isPrototypeOf(n)&&!n.isPrototypeOf(t)&&t.constructor===n.constructor&&t.prototype===n.prototype&&!(-1<i.indexOf(t)||-1<r.indexOf(n))){for(var a in n){if(n.hasOwnProperty(a)!==t.hasOwnProperty(a))return;if(typeof n[a]!=typeof t[a])return}for(a in t){if(n.hasOwnProperty(a)!==t.hasOwnProperty(a))return;if(typeof n[a]!=typeof t[a])return;switch(typeof t[a]){case"object":case"function":if(i.push(t),r.push(n),!e(t[a],n[a]))return;i.pop(),r.pop();break;default:if(t[a]!==n[a])return}}return 1}}(e,arguments[t]))return;return 1}var k=g(39432),N=!0,b=function(t){function e(e){var c=t.call(this,e)||this;return c.init=function(){c.setState(f()({},c.props),function(){c.state.show&&c.fetchData()})},c.switchPage=function(e){c.setState({pageNum:e},function(){return c.fetchData()})},c.switchPageSize=function(e){c.setState({pageSize:e,pageIndex:1},function(){return c.fetchData()})},c.handleCheck=function(e){for(var t=c.state,n=t.currPageList,a=t.selectedList,i=e.length-1;0<=i;i--)-1===a.indexOf(e[i])&&a.push(e[i]);for(var r,o=n.length-1;0<=o;o--)-1!==e.indexOf(n[o].id)||-1<(r=a.indexOf(n[o].id))&&a.splice(r,1);c.setState({currPageSelectedList:e,selectedList:a},function(){return c.handleCheckboxStyle()})},c.handleCheckboxStyle=function(){var e=c.state,t=e.currPageSelectedList,n=e.currPageList,e=e.checkAllStatus;if(t.length===n.length&&0<n.length)e.checked=!0,n.forEach(function(e){e.checked=!0;e=document.getElementById(e.id);e&&e.classList.add("item-active")});else{0===t.length?(e.indeterminate=!1,n.map(function(e){e.checked=!1;var t=document.getElementById(e.id);return t&&t.classList.remove("item-active"),e})):e.indeterminate=!0,e.checked=!1;for(var a=n.length-1;0<=a;a--){for(var i,r=!1,o=t.length-1;0<=o;o--)if(t[o]===n[a].id){n[a].checked=r=!0;var s=document.getElementById(n[a].id);s&&s.addClass("item-active");break}r||(n[a].checked=!1,(i=document.getElementById(n[a].id))&&i.classList.remove("item-active"))}}c.setState({currPageList:n,checkAllStatus:e})},c.handleChange=function(e){c.setState({keywords:e})},c.handleKeyUp=function(e){13===e.keyCode&&c.setState({selectedList:[],pageNum:1},function(){return c.fetchData()})},c.handleSort=function(e){var t=e.prop,e=e.order;c.setState({sortName:t||"createdAt",sortType:e||"descending",selectedList:[],pageNum:1},function(){return c.fetchData()})},c.state={show:!1,queryParams:null,keywords:"",sortName:"createdAt",sortType:"descending",currPageList:[],currPageSelectedList:[],selectedList:[],pageNum:1,pageSize:20,data:[],totalRecords:0,checkAllStatus:{checked:!1,indeterminate:!1},loading:!1,columns:[{label:"",width:16,prop:"paddingLeft"},{label:"",width:56,renderHeader:function(){return C().createElement(s,{type:"checkAll",defaultChecked:c.state.checkAllStatus.checked,indeterminate:c.state.checkAllStatus.indeterminate,onChange:c.handleCheck,selectedList:c.state.currPageSelectedList,totalList:c.state.currPageList.map(function(e){return e.id})})},render:function(e){return C().createElement(s,{type:"checkOne",defaultChecked:e.checked||!1,onChange:c.handleCheck,selectedList:c.state.currPageSelectedList,totalList:c.state.currPageList.map(function(e){return e.id}),uniqueId:e.id})}},{label:"链接名称",render:function(e){var t=e.name,n=e.url;return C().createElement("div",{className:"ellipsis",title:t,onClick:function(e){e.stopPropagation(),n.startsWith("http")&&window.open(n)}},t)}},{label:"总数据量",prop:"total",render:function(e){e=e.total;return C().createElement("div",null,k.ZP.formatNumber(e))}},{label:"创建时间",sortable:"custom",prop:"createdAt",render:function(e){e=e.createdAt;return C().createElement("div",null,e&&e.replace("T"," "))}},{label:"",width:16,prop:"paddingRight"}]},c}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.init()},n.UNSAFE_componentWillReceiveProps=function(e){var t,n=this,a=e.queryParams&&e.queryParams.filterModel,i=this.state.queryParams&&this.state.queryParams.filterModel;O(f()({},i,{connections:[]}),f()({},a,{connections:[]}))||(t=n.props.show,n.setState(f()({},e,{pageNum:1}),function(){t?n.setState({pageNum:1,selectedList:[]},function(){return n.fetchData()}):n.setState({pageNum:1},function(){return n.fetchData()})})),e.show!==this.state.show&&this.setState({show:e.show})},n.fetchData=function(){var n,a=this,e=this.state,t=e.keywords,i=e.queryParams,r=e.sortName,o=e.sortType,s=e.pageNum,c=e.pageSize,l=e.defaultValue,e=this.state,d=e.currPageList,u=e.currPageSelectedList,p=e.selectedList;e.totalRecords;N&&l[0]&&0<l[0].values.length&&(i.filterModel.connections=l[0].values);var h=void 0,e=window.location.pathname;/^\/price/.test(e)&&(h="PRICE"),this.setState({loading:!0},function(){m.h.post("/filter/connection/search",f()({projectId:E.t.get(E.V.curProject).id},i,{name:t,sortName:r,sort:o,pageIndex:s,pageSize:c,queryType:h})).then(function(e){if(200===e.status||304===e.status){e=e.data.result;d=e.list,u=[];for(var t=d.length-1;0<=t;t--)-1<p.indexOf(d[t].id)?(d[t].checked=!0,u.push(d[t].id)):d[t].checked=!1;n=e.count,N&&l[0]&&0<l[0].values.length&&(u=l[0].values,p=l[0].values,N=!1),a.setState({currPageList:d,currPageSelectedList:u,selectedList:p,totalRecords:n,data:e},function(){return a.handleCheckboxStyle()})}}).finally(function(){a.setState({loading:!1})})})},n.getValue=function(){return this.state.selectedList},n.render=function(){var t=this,e=this.state,n=e.show,a=e.currPageList,i=e.currPageSelectedList,r=e.pageNum,o=e.pageSize,s=e.totalRecords,c=e.loading,e=e.columns;return C().createElement("div",{className:"advanced-filter-wrapper",style:{display:n?"block":"none"}},C().createElement("div",{className:"advanced-filter-body"},C().createElement(v.Input,{ref:function(e){return t.searchInput=e},placeholder:"请输入链接名称",onChange:this.handleChange,onKeyUp:this.handleKeyUp,icon:"search"}),C().createElement(v.Loading,{loading:c},C().createElement(p.Z,{className:"connection-table",maxHeight:306,columns:e,data:a,total:s,currentPage:r,pageSize:o,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,onPage:this.switchPage,onSortChange:this.handleSort,rowClassName:function(e){return i.includes(e.id)?"item-active":""},notLimit:!1}))))},e}(C().Component),T=g(61193),I=g(61409),w=g(97189),x=function(t){function e(e){var s=t.call(this,e)||this;return s.getFilter=function(){var t,n,e=s.state,a=(e.filterListShow,e.filterListHide,s.props),i=a.type,e=a.filter,r=a.getTitles,o=[];return m.h.post("/filter/find",{type:i||"INBOX",filterTypes:e,projectId:s.state.projectId}).then(function(e){return o=s.formatData(e.data.result),r&&r(JSON.parse(JSON.stringify(o))),t=JSON.parse(JSON.stringify(o.slice(0,4))),n=JSON.parse(JSON.stringify(o.slice(4))),s.setState({allList:o,filterListShow:t,filterListHide:n},function(e){return s.reFilterList(s.state.value,function(e){s.sortList(s.saveList)})}),e})},s.handleChangeSel=function(t,n,a){var e,i=s.state.value;i.some(function(e){return e.id===t.id&&(e.values=n,a&&0<a.length&&(e.secondValue=a.map(function(e){return{fatherId:t.child.id,id:e.id,values:e.values}})),!0)})||(e={id:t.id,special:t.special,values:n},a&&0<a.length&&(e.secondValue=a.map(function(e){return{fatherId:t.child.id,id:e.id,values:e.values}})),i.push(e)),s.reFilterList(i,function(e){s.onChange()})},s.keyWordChange=function(t,n){var e=s.state.value;0===t.length?e.splice(e.findIndex(function(e){return e.id===n.id}),1):e.some(function(e){if(e.id===n.id)return e.values=t,!0})||e.push({id:n.id,special:n.special,values:t}),s.setState({value:e},function(e){return s.onChange()})},s.expandTopicChange=function(n,e,t){e?s.updateExpandTopic(e.id,e.value):n.id!==s.state.expandTopic.id||t?s.refs.expandTopic.getExpandTopicValue(n.id).then(function(e){var t=D(JSON.parse(e.data.result.filter));s.reFilterList(t,function(e){return s.setState({expandTopic:{id:n.id,name:n.name,value:t}},function(e){s.sortList(),s.props.onExpandTopicChange&&s.props.onExpandTopicChange(s.state.expandTopic)})})}):s.reFilterList([],function(e){return s.setState({expandTopic:{id:"",name:"",value:[]}},function(e){s.sortList(),s.props.onExpandTopicChange&&s.props.onExpandTopicChange(s.state.expandTopic)})})},s.getExpandTopicData=function(){return s.state.expandTopic.id?s.state.expandTopic:null},s.isExpandTopicChanged=function(){return!O(s.state.value.filter(function(e){return"connections"!==e.special}),s.state.expandTopic.value.filter(function(e){return"connections"!==e.special}))},s.updateExpandTopic=function(t,n){var e=s.state.allList;e.some(function(e){if("expandTopic"===e.special)return t?(e.values.splice(e.values.findIndex(function(e){return e.id===t}),1),n&&e.values.unshift(n)):e.values.unshift(n),!0}),s.setState({allList:e},function(e){return s.reFilterList(s.state.value,s.saveList)})},s.saveList=function(){var e,t,n,a;-1===location.pathname.indexOf("inbox")&&(e=s.getFilterList(),a=s.getValue(),t=[],n=[],e.forEach(function(e){e.child&&0<e.child.values.length&&t.push(f()({},e.child,{special:"connConfig"}))}),a.forEach(function(e){e.secondValue&&0<e.secondValue.length&&n.push({id:e.secondValue[0].fatherId,values:e.secondValue.reduce(function(e,t){return e.concat(t.values)},[])})}),e=(e=e.filter(function(e){return!["KEY_WORD"].includes(e.special)})).concat(e.splice(e.findIndex(function(e){return"expandTopic"===e.special}),1)),E.t.set(E.V.filterList,JSON.stringify({list:e.concat(t),value:a.concat(n)})),(a=new Event("setItemEvent")).key="filter-list",window.dispatchEvent(a))},s.onChange=function(){s.props.onFilterChange&&s.props.onFilterChange(s.getReFormatValue())},s.renderCheckBox=function(n,t){var e=s.state,a=e.searchInfo,i=e.value,r=i.filter(function(e){return e.id===n.id})[0]?i.filter(function(e){return e.id===n.id})[0].values:[],e=i.filter(function(e){return e.id===n.id})[0]&&i.filter(function(e){return e.id===n.id})[0].secondValue?i.filter(function(e){return e.id===n.id})[0].secondValue:[],i=a.id===n.id?n.values.filter(function(e){return-1!==e.name.toLowerCase().indexOf(a.keyword.toLowerCase())}):n.values;return 0<n.values.length?C().createElement(c.Z,{key:t,checkedList:r,secondInfo:n.child,secondValue:e,data:i,allListLength:n.values.length,changeState:function(e,t){return s.handleChangeSel(n,e,t)},onSearch:function(e){return s.setState({searchInfo:{isSearching:!0,id:n.id,name:n.name,keyword:""}})},title:n.name,close:function(e){return s.delFilter(t)}}):null},s.toggleAdvancedFilter=function(){s.setState({advancedFilterShow:!s.state.advancedFilterShow})},s.closeAdvancedFilter=function(){s.setState({advancedFilterShow:!1})},s.state={value:s.props.value||[],allList:[],reFilterData:[],filterListShow:[],filterListHide:[],searchInfo:{isSearching:!1,name:"",id:"",keyword:""},expandTopic:{id:"",name:"",value:[]},loading:!1,projectId:E.t.get(E.V.curProject).id,advancedFilterShow:!1},s}o()(e,t);var n=e.prototype;return n.formatData=function(e){var t=[];e.topics&&e.topics.titles&&0<e.topics.titles.length&&(this.setState({reFilterData:e.topics.data}),t.push.apply(t,e.topics.titles.filter(function(e){return e.special="connConfig",1<e.values.length}))),e.source&&0<e.source.length&&t.push({id:"source",name:"数据来源",special:"source",values:e.source}),e.tag&&0<e.tag.length&&e.tag.forEach(function(e){e.special="tag",t.push(e)}),this.props.filterConfig&&this.props.filterConfig.forEach(function(e){switch(e){case"ESCORE":t.push({id:"escore",special:"escore",name:"情感",values:[{id:"1",name:"正面"},{id:"0",name:"中性"},{id:"-1",name:"负面"}]});break;case"MESSAGE_TYPE":t.push({id:"messageType",special:"messageType",name:"消息类型",values:[{id:"PL",name:"评论"},{id:"ZP",name:"追评"},{id:"TW",name:"提问"},{id:"HD",name:"回答"},{id:"SX",name:"私信"},{id:"YW",name:"原文"},{id:"HF",name:"回复"},{id:"KH",name:"客服回复"},{id:"DSWT",name:"电商问题"},{id:"DSDA",name:"电商答案"}]});break;case"KEY_WORD":t.push({id:"KEY_WORD",special:"content",name:"关键词",values:[]})}}),e.expandTopics&&t.push({id:"expandTopic",name:"组合分析",special:"expandTopic",values:e.expandTopics});e=t.map(function(e){return f()({},e,{values:0<e.values.length?(0,k.QM)(e.values):e.values})});return JSON.parse(JSON.stringify(e))},n.sortList=function(t){for(var e=JSON.parse(JSON.stringify(this.state)),n=e.value,a=e.filterListHide,i=e.filterListShow,r=i.length;r--;)i[r]&&!n.some(function(e){return e.id===i[r].id})&&"expandTopic"!==i[r].special&&a.unshift(i.splice(r,1)[0]);n.forEach(function(n){a.forEach(function(e,t){n.id===e.id&&i.push(a.splice(t,1)[0])})}),i.length<4&&(i=i.concat(a.splice(0,4-i.length))),this.setState({filterListHide:a,filterListShow:i},function(e){return t&&t()})},n.addMoreFilter=function(e){var t=this,n=this.state,a=n.filterListShow,n=n.filterListHide;a.push.apply(a,n.splice(e,1)),this.setState({filterListShow:a,filterListHide:n},function(){t.reFilterList(t.state.value)})},n.delFilter=function(t){var n=this,e=this.state,a=e.filterListShow,i=e.filterListHide,r=(r=e.value).filter(function(e){return e.id!==a[t].id});i.push.apply(i,a.splice(t,1)),this.setState({filterListShow:a,filterListHide:i},function(e){return n.reFilterList(r,n.onChange)})},n.closeExpandTopic=function(e){var t=this.state,n=t.filterListShow,t=t.filterListHide;t.push.apply(t,n.splice(n.findIndex(function(e){return"expandTopic"===e.id}),1)),this.setState({filterListShow:n,filterListHide:t})},n.reFilterList=function(e,t){var n=this.state,i=n.reFilterData,s=n.allList,c=n.filterListShow,a=n.filterListHide;if(0!==s.length){s=JSON.parse(JSON.stringify(s)),e=JSON.parse(JSON.stringify(e.filter(function(e){return 0<e.values.length}))).map(function(e,t){return e.index=t,e});var r=JSON.parse(JSON.stringify(e));s.forEach(function(t){e.forEach(function(e){t.id===e.id&&(t.index=e.index)})});for(var o=function(){var a=[],o=r.shift(),e=s.filter(function(e){return e.id===o.id});"connConfig"===o.special&&o.values.length!==(0<e.length?e[0].values.length:0)&&function(){for(var n=[],e=0;e<i.length;e++)!function(t){o.values.forEach(function(e){i[t].map(function(e){return e.id}).includes(e)&&(n=n.concat(i[t]))})}(e);var r=(0,w.uniqueArray)(n.map(function(e){return e.id}));s.forEach(function(i){var t={name:i.name,values:[],id:i.id,special:i.special};void 0!==i.index&&(t.index=i.index);(new Date).getTime();o.id===i.id||void 0!==i.index&&o.index>i.index||"connConfig"!==i.special||!c.map(function(e){return e.id}).includes(i.id)?t.values=i.values:function(){for(var a=r.slice(),e=0;e<i.values.length;e++)!function(n){a.some(function(e,t){return e===i.values[n].id&&(a.splice(t,1),!0)})&&t.values.push(i.values[n])}(e)}(),a.push(t)}),s=JSON.parse(JSON.stringify(a))}()};r.length;)o();s.forEach(function(t){e.forEach(function(e){t.id===e.id&&"connConfig"===e.special&&(e.values=e.values.filter(function(e){return-1!==t.values.map(function(e){return e.id}).indexOf(e)}))})}),s.forEach(function(t){c.forEach(function(e){t.id===e.id&&(e.values=t.values)}),a.forEach(function(e){t.id===e.id&&(e.values=t.values)})}),e.forEach(function(e){return delete e.index}),this.setState({filterListShow:c,filterListHide:a,value:e},function(e){return t&&t()})}},n.getValue=function(){return this.state.value},n.getReFormatValue=function(){function t(e){e.secondValue&&0<e.secondValue.length&&e.secondValue.forEach(function(n){a[e.special].some(function(e){return e.id===n.fatherId&&((t=e.values).push.apply(t,n.values),e.values=Array.from(new Set(e.values)),!0);var t})||a[e.special].push({id:n.fatherId,values:n.values,special:e.special})})}var e=this.state.value,a={};return JSON.parse(JSON.stringify(e)).forEach(function(e){a[e.special]?a[e.special].push({id:e.id,values:e.values,special:e.special}):a[e.special]=[{id:e.id,values:e.values,special:e.special}],t(e)}),a.source&&(a.source=a.source[0].values),a.content&&(a.content=[{contain:a.content[0].values}]),a.escore&&(a.escore=a.escore[0].values),a.messageType&&(a.messageType=a.messageType[0].values),this.refs.advancedFilter&&0<this.refs.advancedFilter.getValue().length&&(a.connections=this.refs.advancedFilter.getValue()),a},n.getFullValue=function(){var e=this.state,t=e.filterListShow,n=e.value,i=[];return t.forEach(function(a){n.forEach(function(e){var n,t;a.id===e.id&&0<e.values.length&&"KEY_WORD"!==e.id?(n=[],a.values.forEach(function(t){e.values.forEach(function(e){t.id===e&&n.push(t)})}),i.push({id:a.id,name:a.name,values:n})):"KEY_WORD"===e.id&&(i.some(function(e){return"KEY_WORD"===e.id})||(t=[],e.values.forEach(function(e){return t.push({name:e})}),i.push({id:e.id,name:"关键词",values:t})))})}),i},n.getFilterList=function(){return JSON.parse(JSON.stringify(this.state.filterListShow.concat(this.state.filterListHide)))},n.componentWillReceiveProps=function(e){var t=this;this.state.expandTopic.id||(JSON.stringify(e.value)===JSON.stringify(this.state.value)?this.setState({value:e.value}):this.reFilterList(e.value,function(){t.sortList(t.saveList)}))},n.componentDidMount=function(){this.props.noBottom&&this.getFilter()},n.componentWillUnmount=function(){},n.render=function(){var a=this,e=this.state,n=e.filterListShow,i=e.filterListHide,t=e.searchInfo,r=e.advancedFilterShow,o=e.expandTopic,s=e.value,c=this.props.style,e={filterModel:this.getReFormatValue()};return i.forEach(function(e,t){"KEY_WORD"===e.id&&n.push(i.splice(t,1)[0]),"expandTopic"===e.id&&i.push(i.splice(t,1)[0])}),n.forEach(function(e,t){"KEY_WORD"===e.id&&n.push(n.splice(t,1)[0]),"expandTopic"===e.id&&n.unshift(n.splice(t,1)[0])}),C().createElement("div",{className:"filter-condition-wrap",style:c||{}},t.isSearching&&C().createElement("div",{className:"filter-search-wrap"},C().createElement("div",{className:"search"},C().createElement("span",null,C().createElement("i",{className:"icon-cem_search"}),C().createElement("span",null,t.name+":")),C().createElement("input",{placeholder:"请输入搜索词",autoFocus:!0,value:t.keyword,onInput:function(e){a.setState({searchInfo:{isSearching:!0,id:t.id,name:t.name,keyword:e.target.value}})}})),C().createElement("i",{className:"icon-cem_delete del",onClick:function(e){return a.setState({searchInfo:{isSearching:!1,id:"",name:"",keyword:""}})}})),C().createElement(v.Loading,{loading:this.state.loading},C().createElement("div",{className:"filter-condition"},n.map(function(t,n){switch(t.id){case"KEY_WORD":return C().createElement("div",{className:"key-word-wrap",key:n},C().createElement("span",{className:"key-word-title"},"关键词"),C().createElement(l,{style:{width:"calc(100% - 108px)"},values:s.filter(function(e){return e.id===t.id})[0]?s.filter(function(e){return e.id===t.id})[0].values:[],onChange:function(e){return a.keyWordChange(e,t)}}));case"expandTopic":return C().createElement(S,{ref:"expandTopic",close:function(e){return a.closeExpandTopic(n)},onChange:a.expandTopicChange,value:o,key:n,list:t.values,fresh:a.updateExpandTopic,model:a.props.model});default:return a.renderCheckBox(t,n)}}),0<i.length&&C().createElement("div",{className:"more-filter bottom-line"},C().createElement("span",{className:"title"},"添加筛选"),C().createElement("div",null,i.filter(function(e){return"connConfig"!==e.special||0<e.values.length}).map(function(e,t){return C().createElement("span",{key:t,className:"filter-card",onClick:function(e){return a.addMoreFilter(t)}},e.name+" +")}))))),T.Z.hasAuthority("CONNECTION_SEARCH")&&C().createElement(b,{ref:"advancedFilter",show:r,queryParams:e,defaultValue:s.filter(function(e){return"connections"===e.special})}),!this.props.noBottom&&C().createElement("div",{className:"bottom"},C().createElement("ul",{className:"handle"},C().createElement("li",null,C().createElement("span",{className:"filter"},this.props.count," 个链接符合条件")),0<s.length&&C().createElement("li",null,C().createElement("span",{className:"clear",onClick:function(e){return a.setState({value:[]},function(e){return a.reFilterList(a.state.value,function(e){a.onChange()})})}},"清空选项"))),T.Z.hasAuthority("CONNECTION_SEARCH")&&C().createElement("span",{className:"advancedFilter",onClick:function(){return a.toggleAdvancedFilter()}},C().createElement("span",null,"高级筛选"),C().createElement("i",{className:"icon-cem_screening-for-more",style:{transform:r?"":"rotate(-180deg)",top:r?"3px":""}})),C().createElement(v.Button,{type:"primary",onClick:function(e){a.saveList(),a.closeAdvancedFilter(),o.id&&a.expandTopicChange(o,null,!0),setTimeout(function(e){return a.props.onConfirm&&a.props.onConfirm()},0)}},"确定"),C().createElement(v.Button,{onClick:function(e){o.id&&a.expandTopicChange(o),a.props.onCancel&&a.props.onCancel()}},"取消")))},e}(d.Component),D=function(e){var n=[];return Object.keys(e).forEach(function(t){"connConfig"===t||"tag"===t?e[t]&&e[t].forEach(function(e){n.push(f()({},e,{special:t}))}):"source"===t||"escore"===t||"messageType"===t||"content"===t?e[t]&&n.push({id:"content"!==t?t:"KEY_WORD",special:t,values:"content"!==t?e[t]:e[t][0].contain}):"connections"===t&&e[t]&&n.push({id:t,special:t,values:e[t]})}),n};x.propTypes={style:n().object,value:n().array,filter:n().array,filterConfig:n().array,onFilterChange:n().func,onExpandTopicChange:n().func,onConfirm:n().func,onCancel:n().func,count:n().oneOfType([n().number,n().string]),type:n().string,noBottom:n().bool};function L(e){var t=[];switch(e){case 0:t=[A()().format(R),A()().format(R)];break;case 1:t=[A()().subtract(1,"days").format(R),A()().subtract(1,"days").format(R)];break;case 2:t=[A()().subtract(2,"days").format(R),A()().subtract(2,"days").format(R)];break;case 3:t=[A()().subtract(364,"days").format(R),A()().format(R)];break;case 4:t=[A()().startOf("week").format(R),A()().format(R)];break;case 5:t=[A()().subtract(1,"weeks").startOf("week").format(R),A()().subtract(1,"weeks").endOf("week").format(R)];break;case 6:t=[A()().subtract(6,"days").format(R),A()().format(R)];break;case 8:t=[A()().startOf("month").format(R),A()().format(R)];break;case 9:t=[A()().subtract(1,"months").startOf("month").format(R),A()().subtract(1,"months").endOf("month").format(R)];break;case 10:t=[A()().subtract(29,"days").format(R),A()().format(R)];break;case 12:t=[A()().startOf("quarter").format(R),A()().format(R)];break;case 13:t=[A()().subtract(1,"quarters").startOf("quarter").format(R),A()().subtract(1,"quarters").endOf("quarter").format(R)];break;case 14:t=[A()().subtract(89,"days").format(R),A()().startOf("day").format(R)];break;case 16:t=[A()().startOf("year").format(R),A()().format(R)];break;case 17:t=[A()().subtract(1,"years").startOf("year").format(R),A()().subtract(1,"years").endOf("year").format(R)];break;case 18:t=[A()().subtract(179,"days").format(R),A()().format(R)]}return t}var a=g(30381),A=g.n(a),F=g(58341),_=["快捷时间筛选器","固定时间筛选器"],j=["今天","昨天","前天","近365天","本周","上周","近7天","","本月","上个月","近30天","","本季","上个季度","近90天","","今年","去年","近180天"],R="YYYY-MM-DD",M=["overview","product","service","marketing"],P="",V=function(t){function e(e){var i=t.call(this,e)||this;return i.getDateRange=function(e){i.setState({selectedDateRange:e})},i.handleClickQuickTime=function(e){var t=i.state,n=t.currSelector,a=t.staredQuickTimeChoice,t=L(e);i.setState({selectedQuickTimeChoice:e,selectedDateRange:t}),i.setDefaultValue(JSON.stringify({module:"ecommerceMonitor",currSelector:n,selectedQuickTimeChoice:e,staredQuickTimeChoice:a,value:[]}))},i.state={show:!1,currSelector:0,selectedDateRange:[],selectedQuickTimeChoice:10,staredQuickTimeChoice:-1,params:e.params},i}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){var n=this;document.querySelectorAll(".right ul li").forEach(function(e,t){7!==t&&11!==e&&15!==e&&(e.addEventListener("mouseover",function(){return n.displayStar(e)}),e.addEventListener("mouseout",function(){return n.hideStar(e)}))})},n.UNSAFE_componentWillReceiveProps=function(e){var t=e.show,e=e.params;this.setState({show:t,params:e})},n.componentWillUnmount=function(){var n=this;document.querySelectorAll(".right ul li").forEach(function(e,t){7!==t&&11!==e&&15!==e&&(e.removeEventListener("mouseover",function(){return n.displayStar(e)}),e.removeEventListener("mouseout",function(){return n.hideStar(e)}))})},n.displayStar=function(e){(0,w.hasClass)(e.children[0],"active")&&(e.children[1].getElementsByTagName("span")[0].style.display="inline-block")},n.hideStar=function(e){e=e.children[1].getElementsByTagName("span")[0];(0,w.hasClass)(e,"star")||(e.style.display="none")},n.switchSlector=function(e){this.setState({currSelector:e})},n.getCurrDate=function(){var e=this.state,t=e.currSelector,n=e.selectedDateRange,a=e.selectedQuickTimeChoice,i=e.params,r=this.formatDate(2),o=n[0],e=n[1],o=A()(e,R).diff(A()(o,R),"days")+1;return{from:n[0],to:n[1],quickChoice:0===t?i&&-1<i.quickChoice.indexOf("-")?i.quickChoice:j[a]:r,dateGroupType:"DAY",numOfDays:o,remoteName:"cTime"}},n.clickStarIcon=function(e,t){e.stopPropagation();var n,a=this.state.staredQuickTimeChoice,i=this.state.selectedQuickTimeChoice;a!==t?(-1!==a&&(n=document.querySelectorAll(".right ul li")[a].children[1],(0,w.removeClass)(n,"star"),n.style.display="none"),a=t,(0,w.addClass)(e.target.parentNode,"star")):(a=-1,(0,w.removeClass)(e.target.parentNode,"star")),this.setState({staredQuickTimeChoice:a}),this.setDefaultValue(JSON.stringify({module:"ecommerceMonitor",currSelector:0,selectedQuickTimeChoice:i,staredQuickTimeChoice:a,value:[]}))},n.fetchDefaultValue=function(){var r=this,e=window.location.pathname.split("/")[1],e=-1<M.indexOf(e)?"insight":e;P="default-time-"+e;var o=[A()().subtract(29,"days").format(R),A()().format(R)];return m.h.post("/default/value/find",{key:P,projectId:E.t.get(E.V.curProject).id}).then(function(e){var t=JSON.parse(e.data.result),n=r.state.params;if(!t){var a=n?[n.from,n.to]:o;return r.setState({selectedDateRange:a}),{from:a[0],to:a[1],quickChoice:n?n.quickChoice:j[10],dateGroupType:"DAY",remoteName:"cTime"}}var i=t.currSelector,e=t.selectedQuickTimeChoice,a=t.staredQuickTimeChoice,t=(t.value,n&&-1===n.quickChoice.indexOf("-")?j.indexOf(n.quickChoice):-1<a?a:e),e=n?-1===n.quickChoice.indexOf("-")?L(t):[n.from,n.to]:L(-1<a?a:e);if(0===i)return r.setState({selectedQuickTimeChoice:t,staredQuickTimeChoice:a,selectedDateRange:e}),{from:e[0],to:e[1],quickChoice:n&&-1<n.quickChoice.indexOf("-")?n.quickChoice:j[t],dateGroupType:"DAY",remoteName:"cTime"}})},n.setDefaultValue=function(e){m.h.post("/default/value/update",{key:P,projectId:E.t.get(E.V.curProject).id,value:e}).then(function(e){})},n.clickConfirmBtn=function(){var e=this;0<this.state.selectedDateRange.length?this.setState({params:null,show:!1},function(){return e.props.onChange(e.getCurrDate())}):u.Z.error("请选择时间范围")},n.clickCancelBtn=function(){this.props.onCancel()},n.formatDate=function(e){for(var t=this.state.selectedDateRange,n="",a=0;a<t.length;a++){for(var i=t[a].split("-"),r=0;r<i.length;r++)0===r&&(n+=i[r]+(1===e?"年":".")),1===r&&(parseInt(i[r],10),n+=i[r]+(1===e?"月":".")),2===r&&(parseInt(i[r],10),n+=i[r]+(1===e?"日":""));0===a&&(n+=" - ")}return n},n.render=function(){var n=this,e=this.state,t=e.show,a=e.currSelector,i=e.selectedDateRange,r=e.selectedQuickTimeChoice,o=e.staredQuickTimeChoice,e=this.formatDate(1);return C().createElement("div",{className:"time-picker-wrapper",style:{display:t?"block":"none"}},C().createElement("div",{className:"time-picker-body"},C().createElement("div",{className:"left"},C().createElement("ul",null,_.map(function(e,t){return C().createElement("li",{key:t,className:a===t?"active":"",onClick:function(){return n.switchSlector(t)}},e)}))),C().createElement("div",{className:"right"},C().createElement("ul",{style:{display:0===a?"block":"none"}},j.map(function(e,t){return C().createElement("li",{key:t,onClick:function(){return n.handleClickQuickTime(t)},style:{pointerEvents:[7,11,15].includes(t)?"none":"auto"}},C().createElement("span",{className:r===t?"active":""},e),C().createElement(v.Popover,{className:"time-picker-star-tooltip",trigger:"hover",placement:"top",width:"50",content:o===t?"取消默认":"设为默认"},C().createElement("span",{className:o===t?"star":"",onClick:function(e){return n.clickStarIcon(e,t)}},C().createElement("i",{className:"icon-cem icon-cem_star"}))))})),C().createElement(F.Z,{getDateRange:this.getDateRange,style:{display:1===a?"block":"none"}}))),C().createElement("div",{className:"time-picker-footer"},C().createElement("span",null,"当前选择时间："),0<i.length?C().createElement("span",null,e):null,C().createElement("div",null,C().createElement(v.Button,{type:"primary",onClick:function(){return n.clickConfirmBtn()}},"确定"),C().createElement(v.Button,{type:"default",onClick:function(){return n.clickCancelBtn()}},"取消"))))},e}(C().PureComponent);V.propTypes={show:n().bool,onChange:n().func};var W=g(85151);function J(e){return m.h.post("/filter/find/save",{id:e})}function B(e,t,n){return m.h.post("/default/value/update",{key:e,projectId:t,value:n})}function Z(e,t,n,a,i,r){return m.h.post("/filter/add",{name:e,copy:t,type:a,id:n,projectId:i,filter:r})}function q(e){return m.h.post("user/opinion/add",f()({},e))}var Y="empty";const z=function(t){function e(e){var s=t.call(this,e)||this;return s.getSelectedFilterObj=function(){return s.state.selFilterObj},s._handleListSelect=function(e,t){e.stopPropagation(),s.props.onFilterChange(t),s.setState({selFilterObj:t})},s._handleListStar=function(e,t,n){e.stopPropagation(),s.lastStaredSaveId=t;var a=s.state,i=a.staredFilterId,r=a.savedKey,o=a.projectId,a=a.staredFilterIndex;i!==t?(-1!==a&&(a=document.querySelectorAll(".saved-condition-list .left .star")[a].children[1],(0,w.removeClass)(a,"star-active")),(0,w.addClass)(e.target.parentNode,"star-active")):(0,w.removeClass)(e.target.parentNode,"star-active"),s.setState({staredFilterIndex:n,staredFilterId:i===t?Y:t},function(){B(r,o,s.state.staredFilterId).then(function(e){2e4!==e.data.code&&s.setState({staredFilterId:s.lastStaredSaveId})})})},s._handleOnEditClick=function(e,t){e.stopPropagation(),s.refs.saveNameInput.refs.input.value=t.name,s.setState({targetFilterObj:t,editDialogVisible:!0})},s._handleConfitionSaveConfirm=function(){var e=s.state,n=e.selFilterObj,a=e.projectId,i=e.targetFilterObj,e=s.props,r=e.model,o=e.onFilterRename;J(i.id).then(function(e){var t=e.data;2e4===t.code&&(e=s.refs.saveNameInput.refs.input.value,o(n.name),Z(e,!1,i.id,r,a,t.result.filter).then(function(e){2e4===e.data.code&&(u.Z.success("修改成功"),s.setState({editDialogVisible:!1}),s.refresh(n.id))}))})},s._handleOnDeleteClick=function(e,t){e.stopPropagation(),s.setState({targetFilterObj:t,delDialogVisible:!0})},s._handleOnDeleteConfirm=function(e){e.stopPropagation();var t=s.state,n=t.targetFilterObj,a=t.savedKey,i=t.projectId,r=t.staredFilterId,e=t.filterList,o=t.selFilterObj,t=[(t=n.id,m.h.post("/filter/delete",{id:t,menuModel:{}}))];r===n.id&&t.push(B(a,i,Y)),Promise.all(t).then(function(e){2e4===e[0].data.code&&s.refresh(n.id===o.id?void 0:o.id)}),s.props.onFilterChange(n.id===o.id?e[0]:o)},s.renderDeleteDialog=function(){var e=s.state,t=e.selFilterObj,e=e.targetFilterObj;return C().createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},C().createElement(v.Dialog,{title:"删除",className:"delete-saved-confition-dialog",size:"tiny",modal:!1,visible:s.state.delDialogVisible,onMouseLeave:function(e){return e.stopPropagation()},onCancel:function(e){return s.setState({delDialogVisible:!1})}},C().createElement(v.Dialog.Body,null,C().createElement("span",null,e&&t&&t.id===e.id?"删除该筛选器后，当前页面的筛选器将自动切换为”全部数据（默认）”筛选器，是否删除？":'是否删除"'+e.name+'"筛选器？')),C().createElement(v.Dialog.Footer,null,C().createElement(v.Button,{type:"primary",onClick:s._handleOnDeleteConfirm},"确定"),C().createElement(v.Button,{type:"default",onClick:function(e){return s.setState({delDialogVisible:!1})}},"取消"))))},s.renderEditDialog=function(){return C().createElement("div",{onMouseLeave:function(e){return e.stopPropagation()}},C().createElement(v.Dialog,{title:"修改名称",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:s.state.editDialogVisible,onCancel:function(e){return s.setState({editDialogVisible:!1})}},C().createElement(v.Dialog.Body,null,C().createElement(v.Input,{className:"name-input",placeholder:"请输入名称",ref:"saveNameInput"})),C().createElement(v.Dialog.Footer,null,C().createElement(v.Button,{type:"primary",onClick:s._handleConfitionSaveConfirm},"确定"),C().createElement(v.Button,{type:"default",onClick:function(e){return s.setState({editDialogVisible:!1})}},"取消"))))},s.state={projectId:E.t.get(E.V.curProject).id,savedKey:e.model+"_SAVED_OBJ",filterList:void 0,selFilterObj:void 0,targetFilterObj:{},staredFilterId:Y,staredFilterIndex:-1,isEditing:!1,delDialogVisible:!1,editDialogVisible:!1},s}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){},n.componentDidUpdate=function(e,t){this.state.filterList;this.props.show===e.show||this.props.show||this.setState({isEditing:!1,fullListShow:!1})},n.componentWillUnmount=function(){},n.refresh=function(o){var s=this,e=this.state,t=e.savedKey,n=e.projectId,a=(e.staredFilterId,this.props),e=a.model,c=(a.onFilterChange,a.shouldShowDefault),l=void 0,e=m.h.post("/filter/list",{type:e,projectId:n}),n=m.h.post("/default/value/find",{key:t,projectId:n});return Promise.all([e,n]).then(function(e){var t,n,a,i,r=e[0].data;2e4===r.code&&(t=r.result.all).unshift({id:"default",name:"全部数据（默认）"});e=e[1].data;return 2e4===e.code&&(n=e.result||Y,a=c?-1:t.findIndex(function(e){return e.id===n}),o&&(i=t.findIndex(function(e){return e.id===o})),l=i?t[i]:-1===a?t[0]:t[a]),s.setState({delDialogVisible:!1,selFilterObj:l,staredFilterIndex:a,filterList:t,staredFilterId:n,fullListShow:15<t.length&&s.state.fullListShow}),l})},n.render=function(){var e=this.state,t=e.filterList,e=(e.selFilterObj,e.staredFilterId,e.isEditing,this.props);e.onFilterChange,e.show,t&&JSON.parse(JSON.stringify(t));return null},e}(C().Component);var U=function(i){function e(e){var s=i.call(this,e)||this;s.changeFilter=function(e){s.setState({selFilterId:e===s.state.selFilterId?null:e})},s.onConditionChange=function(t){var n=[];Object.keys(t).forEach(function(e){"tag"===e||"connConfig"===e?n=n.concat(t[e]):"source"!==e&&"escore"!==e&&"messageType"!==e&&"content"!==e||n.push({id:"content"!==e?e:"KEY_WORD",special:e,values:"content"!==e?t[e]:t[e][0].contain})});var e=s.state.defFilterValue,e=!O(n.filter(function(e){return"connections"!==e.special}),e.filter(function(e){return"connections"!==e.special}));s.setState({isDefFilterChanged:e,filterConditionValue:s.refs.FilterCondition.getValue()},function(e){s.getListCount()})},s.onTimeChange=function(e){s.setState({time:s.refs.timePicker.getCurrDate()},function(e){s.getListCount(),s.handleChange()})},s.handleChange=function(){s.state.filterConditionValue;s.props.onChange&&s.props.onChange(s.getValue()),s.setState({selFilterId:null,detail:s.refs.FilterCondition.getFullValue()},function(e){return s.competeInfoWidth()})},s.competeInfoWidth=function(){var t,e,n;s.refs.info&&(s.refs.info.style.whiteSpace="nowrap",t=[],Array.from(s.refs.info.getElementsByClassName("detail-info")).forEach(function(e){e.style.width="unset",t.push(e.clientWidth),e.style.width="calc(100% - 88px)"}),n=122,n+=700<(e=Math.max.apply(null,t))?700:e,s.refs.info.style.whiteSpace="normal",s.refs.info.style.width=n+"px")},s.init=function(){function e(){var e=[s.refs.FilterCondition.getFilter()];s.state.showList.includes("time")&&e.push(s.refs.timePicker.fetchDefaultValue()),Promise.all(e).then(function(e){var t=s.state.filterConditionValue,n=s.refs.FilterCondition.state.allList.map(function(e){return e.values}).flat(1).map(function(e){return String(e.id)});t.filter(function(e){return!["KEY_WORD"].includes(e.id)}).map(function(e){return e.values}).flat(1).some(function(e){return!n.includes(String(e))})&&s.setState({showWarning:!0,filterConditionValue:[],detail:[]}),s.refs.timePicker?(t=e.filter(function(e){return e.dateGroupType})[0],s.setState({time:t},function(){s.getListCount()})):s.getListCount(),e[2]&&s._handleOnFilterChange(e[2]),setTimeout(function(){return s.props.onFilterReady&&s.props.onFilterReady()},0)})}s.state.projectId?e():s.id=setInterval(function(){E.t.get(E.V.curProject).id&&(clearInterval(s.id),s.setState({projectId:E.t.get(E.V.curProject).id},function(){e()}))},50)},s._handleConfitionSave=function(e){s.setState({dialogType:e,saveNameDialogVisible:!0})},s._handleConfitionSaveAs=function(e){e.stopPropagation(),s.setState({dialogType:"saveAs",saveNameDialogVisible:!0})},s.handleSaveOpinion=function(){var e=s.state,t=e.dialogType,n=e.nameInputVal,e=s.props.currOpinonObj.id,o=n;s.setState({inputName:o});n=E.t.get(E.V.curProject).id;"save"===t?q({opinionTaskId:e,name:o,projectId:n}).then(function(e){if(2e4===e.data.code){var t=e.data.result;if(1===t.length){var n=t[0].id;u.Z.success("保存成功"),s.props.refreshMenuList().then(function(e){window.location.href="/opinion/"+n}),s.setState({saveNameDialogVisible:!1,savedId:n}),s.props.updateCurrOpinonObj(),s.setState({nameInputVal:""})}else{for(var a="",i=s.state.savedOpinionName,r=0;r<t.length;r++)t[r].name===i&&(a=t[r].id);s.setState({savedId:a,opinionTaskList:t,deleteOpinionModalShow:!0,tempInputName:o,showWarning:!1})}}}):"rename"===t&&(n=s.state.savedId,t="",t=3===location.pathname.split("/").length?location.pathname.split("/")[2]:n,t={id:t,name:o},m.h.post("user/opinion/update",f()({},t)).then(function(e){2e4===e.data.code&&(u.Z.success("操作成功"),s.props.refreshMenuList(),s.setState({savedOpinionName:o,saveNameDialogVisible:!1})),s.setState({nameInputVal:""})}))},s.handleUpdate=function(){var e=s.props,t=e.currOpinonObj,n=e.currOpinonObj.id,a=s.state.savedOpinionName,e="";location.pathname.startsWith("/opinion/")&&(e=location.pathname.split("/")[2]);e={opinionTaskId:n,id:e},m.h.post("user/opinion/filter/update",f()({},e)).then(function(e){2e4===e.data.code&&(u.Z.success("更新成功"),(e=JSON.parse(JSON.stringify(t))).changed=!1,e.mode="rename",e.name=a,s.props.updateCurrOpinonObj(e),s.setState({showWarning:!1}))})},s.handleClickOpinion=function(e){var t=s.state.selectedOpinionIds,n=t.indexOf(e);-1<n?t.splice(n,1):t.push(e),s.setState({selectedOpinionIds:t})},s.handleDeleteOpinion=function(){var e=s.state,t=e.selectedOpinionIds,n=e.inputName,a=s.props.currOpinonObj.id;t={ids:t},m.h.post("user/opinion/delete",f()({},t)).then(function(e){2e4===e.data.code&&(s.setState({deleteOpinionModalShow:!1,selectedOpinionIds:[]}),e=E.t.get(E.V.curProject).id,q({opinionTaskId:a,name:n,projectId:e}).then(function(e){var t;2e4!==e.data.code||1===(e=e.data.result).length&&(t=e[0].id,u.Z.success("操作成功"),s.setState({saveNameDialogVisible:!1,savedOpinionName:"",savedId:t}),s.props.refreshMenuList().then(function(e){window.location.href="/opinion/"+t}),s.props.updateCurrOpinonObj(),s.setState({nameInputVal:""}))}))})},s._handleOnFilterChange=function(n){var e;s.setState({isDefFilterChanged:!1}),s.state.hasOutsideFilterValues?(e=H(s.props.values.filterModel),s.setState({filterObj:n,defFilterValue:e,filterConditionValue:JSON.parse(JSON.stringify(e))},function(){s.handleChange()})):"default"!==n.id?J(n.id).then(function(e){var t=e.data,e=H(t.result.filter);2e4===t.code&&s.setState({filterObj:n,defFilterValue:e,filterConditionValue:JSON.parse(JSON.stringify(e)),detail:JSON.parse(JSON.stringify(e))},function(){return s.handleChange()})}):s.setState({filterObj:n,defFilterValue:[],detail:[],filterConditionValue:[]},function(e){return s.handleChange()})},s.handleRename=function(e){var t=s.state.filterObj;t.name=e,s.setState({filterObj:t})},s.onExpandTopicChange=function(e){s.setState({expandTopicData:e}),""===e.id&&s.setState({filterConditionValue:[],isDefFilterChanged:!1})},s._handleSaveExpandTopic=function(e){var t,n,a,i;s.state.expandTopicData.id?(t=s.state.expandTopicData.name,n=s.state.expandTopicData.id,a=s.props.model,i=s.getValue(),h(t,!1,n,a,s.state.projectId,i.filterModel).then(function(e){e=e.data;2e4===e.code&&(u.Z.success("组合分析保存成功"),s.refs.FilterCondition.updateExpandTopic(n,{name:e.result.name,id:e.result.id}),s.setState({dialogType:"save",expandTopicDialogVisible:!1}))})):s.setState({dialogType:"save",expandTopicDialogVisible:!0})},s._handleSaveAsExpandTopic=function(e){s.setState({dialogType:"saveAs",expandTopicDialogVisible:!0})},s._handleExpandTopicSaveConfirm=function(){var e=s.refs.saveExpandTopic.refs.input.value,t="saveAs"===s.state.dialogType,n=t?s.state.expandTopicData.id||s.state.filterObj.id:null,a=s.props.model,i=s.getValue();h(e,t,n,a,s.state.projectId,i.filterModel).then(function(e){e=e.data;2e4===e.code&&(u.Z.success("组合分析保存成功"),s.refs.saveExpandTopic.refs.input.value="",s.refs.FilterCondition.updateExpandTopic(null,{name:e.result.name,id:e.result.id}),s.setState({dialogType:"save",expandTopicDialogVisible:!1}))})},s._handlingOnComposition=function(){s.isCompositionHandling=!0},s._handleOnComposition=function(e){s.isCompositionHandling=!1,s.setState({nameInputVal:e.target.value.substring(0,14)})},s.renderDialog=function(){var e=s.state,t=e.savedOpinionName,n=e.nameInputVal,e=e.check;return C().createElement(v.Dialog,{title:"save"===s.state.dialogType?"保存典型意见":"重命名",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:s.state.saveNameDialogVisible,onCancel:function(e){return s.setState({saveNameDialogVisible:!1})}},C().createElement(v.Dialog.Body,null,C().createElement("div",{className:"form-item"},C().createElement("label",null,"名称"),C().createElement(v.Input,{className:e&&14<=n.length?"error":"",placeholder:"请输入典型意见名称",defaultValue:t,maxLength:14,autoFocus:!0,onFocus:function(){return s.setState({check:!0})},onBlur:function(){return s.setState({check:!1})},onChange:function(e){s.isCompositionHandling||s.setState({nameInputVal:e.substring(0,14)})},onCompositionStart:s._handlingOnComposition,onCompositionUpdate:s._handlingOnComposition,onCompositionEnd:s._handleOnComposition}),e&&14<=n.length&&C().createElement("div",{className:"tip"},"提示：最多只能输入14个字符"))),C().createElement(v.Dialog.Footer,null,C().createElement("span",{className:"tips"},"*可以保存5个典型意见计算结果"),C().createElement(v.Button,{type:"primary",onClick:s.handleSaveOpinion},"确定"),C().createElement(v.Button,{type:"default",onClick:function(e){return s.setState({saveNameDialogVisible:!1})}},"取消")))},s.renderDeleteOpinionDialog=function(){var t="";location.pathname.startsWith("/opinion/")&&(t=location.pathname.split("/")[2]);var e=s.state,n=e.opinionTaskList,a=e.deleteOpinionModalShow,i=e.selectedOpinionIds,e=[{label:"请选择删除的对象",prop:"",align:"center",render:function(e){return C().createElement(W.Jg,{value:e.id,disabled:!!t&&t===e.id,checked:i.includes(e.id),onChange:function(){return s.handleClickOpinion(e.id)}})}},{label:"名称",prop:"name"},{label:"保存时间",prop:"createdAt"}];return C().createElement(v.Dialog,{title:"提醒",className:"opinion-delete-dialog",size:"tiny",modal:!1,visible:a,onCancel:function(e){return s.setState({deleteOpinionModalShow:!1})}},C().createElement(v.Dialog.Body,null,C().createElement("div",{className:"delete-tips"},"最多保存5个典型意见，如果想要保存当前典型意见，请从以下列表中先删除部分典型意见"),C().createElement(p.Z,{columns:e,data:n})),C().createElement(v.Dialog.Footer,null,C().createElement(v.Button,{type:"primary",onClick:s.handleDeleteOpinion},"确定"),C().createElement(v.Button,{type:"default",onClick:function(e){return s.setState({deleteOpinionModalShow:!1})}},"取消")))},s.renderExpandTopicDialog=function(){return C().createElement(v.Dialog,{title:"save"===s.state.dialogType?"保存为组合分析":"组合分析另存为",className:"filter-save-name-dialog",size:"tiny",modal:!1,visible:s.state.expandTopicDialogVisible,onCancel:function(e){return s.setState({expandTopicDialogVisible:!1})}},C().createElement(v.Dialog.Body,null,C().createElement(v.Input,{className:"name-input",placeholder:"请输入名称",ref:"saveExpandTopic"})),C().createElement(v.Dialog.Footer,null,C().createElement(v.Button,{type:"primary",onClick:s._handleExpandTopicSaveConfirm},"确定"),C().createElement(v.Button,{type:"default",onClick:function(e){return s.setState({expandTopicDialogVisible:!1})}},"取消")))};var c,l,t=e.values,n=t&&t.filterModel,a=n?H(t.filterModel):[];return s.state={hasOutsideFilterValues:n,showList:s.props.showList,selFilterId:s.props.defaultShow||null,filterConditionValue:a,expandTopicData:{},time:{},detail:n?(c=t.filterModel,l=(JSON.parse(E.t.get(E.V.filterList))||{list:[]}).list,Object.keys(c).reduce(function(e,t){var n=c[t],a=Object.prototype.toString.call(n);if("[object Array]"===a){var i=n[0],r=Object.prototype.toString.call(i);if("[object String]"===r){var o=l.find(function(e){return e.id===t});return o?f()({},e,((i={})[o.name]=n.map(function(t){return o.values.find(function(e){return e.id===t}).name}).join("，"),i)):e}if("[object Object]"===r)return f()({},e,n.reduce(function(e,t){var n,a=l.find(function(e){return e.id===t.id});return a?f()({},e,((n={})[a.name]=t.values.reduce(function(e,t){var n=a.values.find(function(e){return e.id===t});return n?[].concat(e,[n.name]):e},[]).join("，"),n)):e},{}))}else if("[object Object]"===a){var s=l.find(function(e){return e.id===n.id});return s?f()({},e,((a={})[s.name]=n.values.reduce(function(e,t){var n=s.values.find(function(e){return e.id===t});return n?[].concat(e,[n.name]):e},[]).join("，"),a)):e}return e},{})):[],projectId:E.t.get(E.V.curProject).id,count:"",saveFilterVisible:!1,saveNameDialogVisible:!1,filterObj:void 0,defFilterValue:[],isDefFilterChanged:!1,dialogType:"save",deleteOpinionModalShow:!1,opinionTaskList:[],selectedOpinionIds:[],savedId:"",savedOpinionName:e.currOpinonObj.name,inputName:"",showWarning:!1,nameInputVal:""},s}o()(e,i);var t=e.prototype;return t.getListCount=function(){var e,t=this,n=this.getValue();n.dateFilter?n.dateFilter.dateGroupType=null:(n.dateFilter={},e=window.location.pathname,/^\/price/.test(e)&&(n.queryType="PRICE")),n.projectId=E.t.get(E.V.curProject).id,m.h.post("/filter/connection/find",n).then(function(e){t.setState({count:e.data.result.total})})},t.getValue=function(){var e=this.props.showList,t={};return e.includes("condition")&&Object.assign(t,{filterModel:this.refs.FilterCondition?this.refs.FilterCondition.getReFormatValue():{}}),e.includes("time")&&(t.dateFilter=JSON.parse(JSON.stringify(this.state.time))),t},t.componentDidMount=function(){this.init()},t.UNSAFE_componentWillReceiveProps=function(e){var t=this,n=e.values,a=this.props.values;n&&n.filterModel&&!O(n,a)&&(n=H(n.filterModel)||[],this.setState({filterConditionValue:n}),setTimeout(function(){t.refs.FilterCondition&&t.setState({detail:t.refs.FilterCondition.getFullValue()},function(){return t.competeInfoWidth()})},2500),this.refs.timePicker&&this.refs.timePicker.fetchDefaultValue().then(function(e){setTimeout(function(){t.setState({time:e},function(){t.getListCount()})},1e3)})),O(this.props.currOpinonObj,e.currOpinonObj)||(e.currOpinonObj.name,!this.hasUpdateName&&e.currOpinonObj.name&&(this.setState({savedOpinionName:e.currOpinonObj.name}),this.hasUpdateName=!0))},t._saveConfition=function(n,e,t){var a=this,i=this.state.filterObj,r=this.getValue(),o=this.props.model,s=this.state.projectId;Z(n,e,t,o,s,f()({},r.filterModel)).then(function(e){var t=e.data;2e4===t.code&&(u.Z.success("筛选条件保存成功"),i.name=n,i.id=t.result.id,a.setState({dialogType:"save",saveNameDialogVisible:!1,filterObj:i},function(){return a.refs.SavedConfition.refresh(t.result.id)}))}).catch(function(e){return console.log(e)})},t.render=function(){var n=this,e=this.state,a=e.selFilterId,t=e.showList,i=e.filterConditionValue,r=e.expandTopicData,o=e.detail,s=e.count,c=(e.isDefFilterChanged,e.filterObj),l=e.saveFilterVisible,d=e.hasOutsideFilterValues,u=e.projectId,p=e.savedOpinionName,h=(e.dialogType,e.showWarning),f=this.list,m=this.props,g=m.filterCondition,v=m.title,y=m.model,e=m.values,m=m.currOpinonObj,e=(r.id?r.name:c&&c.name,e&&e.dateFilter?e.dateFilter:void 0);this.refs.FilterCondition&&this.refs.FilterCondition.isExpandTopicChanged();return u?C().createElement("div",{className:"filter-new"},C().createElement("div",{className:"wrap"},t.includes("opinion")&&C().createElement("div",{ref:"save-filter",className:"save-filter"},C().createElement("span",null,r.id?"组合分析：":this.hasOpinionId?"典型意见：":"典型意见"),C().createElement("div",{className:"save-filter-wrap"},C().createElement("span",{style:{cursor:"default"}},p),C().createElement(z,{shouldShowDefault:d,ref:"SavedConfition",show:l,model:y,onFilterChange:this._handleOnFilterChange,onFilterRename:this.handleRename}))),C().createElement("div",{className:"button-zone"},t.includes("opinion")&&!r.id&&C().createElement("div",null,m.changed&&C().createElement("span",{className:"modified"},"已修改"),!this.hasOpinionId&&C().createElement("a",null,C().createElement("span",{className:"save",onClick:function(e){return n._handleConfitionSave("save")}},"保存典型意见")),this.hasOpinionId&&C().createElement("span",{className:"save",onClick:function(e){return n._handleConfitionSave("rename")},style:{marginLeft:"10px"}},"重命名"),this.hasOpinionId&&"update"===m.mode&&C().createElement("span",{className:"save",onClick:function(e){return n.handleUpdate()},style:{marginLeft:"10px"}},"更新"))),!r.id&&C().createElement("div",{className:"info"},C().createElement("span",{className:"detail"},"详情"),C().createElement("div",{className:"info-wrap"},C().createElement("div",null,"当前页面筛选条件"),o&&0<o.length?C().createElement("ul",{ref:"info"},o.map(function(n,e){return C().createElement("li",{key:e},C().createElement("div",{className:"name"},n.name),C().createElement("div",{className:"detail-info"},n.values&&n.values.slice(0,100).map(function(e,t){return C().createElement("span",{key:t},e.name+(t===n.values.length-1?"":"，"))})))})):C().createElement("div",{className:"noData"},"暂无筛选内容"))),r.id&&C().createElement("div",{className:"info"},C().createElement("span",{className:"detail",onClick:function(){return n.refs.FilterCondition.expandTopicChange(n.state.expandTopicData)}},"关闭编辑")),C().createElement("ul",{className:"all-filter-name-wrap"},f.filter(function(e){return t.includes(e.id)}).map(function(t){return C().createElement("li",{key:t.id,className:a===t.id?"sel":"",onClick:function(e){return n.changeFilter(t.id)}},C().createElement("i",{className:t.icon}),C().createElement("span",null,t.name),C().createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:a===t.id?"rotate(180deg) translateY(-1px)":""}}))}))),h&&"condition"===a&&C().createElement("div",{className:"msg_filter_tip"},C().createElement("i",{className:"icon-cem_warning"}),"筛选器使用的某些筛选条件被删除，已不可用，需要你更新筛选条件"),C().createElement(x,{style:{display:"condition"===a?"block":"none"},ref:"FilterCondition",value:i,type:y||"PRICE_WARNING",filter:g&&g.filter?g.filter:["CONN_CONFIG"],filterConfig:g&&g.filterConfig?g.filterConfig:[],onFilterChange:this.onConditionChange,onExpandTopicChange:this.onExpandTopicChange,onConfirm:this.handleChange,onCancel:function(e){return n.setState({selFilterId:null})},count:s}),t.includes("time")&&C().createElement("div",{className:"date"},C().createElement(V,{ref:"timePicker",show:"time"===a,onChange:this.onTimeChange,onCancel:function(e){return n.setState({selFilterId:null})},params:e})),this.renderDialog(),this.renderExpandTopicDialog(),this.renderDeleteOpinionDialog()):C().createElement("div",null)},r()(e,[{key:"list",get:function(){var e="时间";return[{name:"筛选",id:"condition",icon:"icon-cem_screen"},{name:e=this.state&&this.state.time.from?this.state.time.quickChoice||this.state.time.from.replace(/-/g,"/")+"-"+this.state.time.to.replace(/-/g,"/"):e,id:"time",icon:"icon-cem_time-controller"}]}},{key:"hasOpinionId",get:function(){return location.pathname.match(/^\/opinion\/[0-9a-z]+/)}}]),e}(d.Component),H=function(e){var n=[];return Object.keys(e).forEach(function(t){"connConfig"===t||"tag"===t?e[t]&&e[t].forEach(function(e){n.push(f()({},e,{special:t}))}):"source"===t||"escore"===t||"messageType"===t||"content"===t?e[t]&&n.push({id:"content"!==t?t:"KEY_WORD",special:t,values:"content"!==t?e[t]:e[t][0].contain}):"connections"===t&&e[t]&&n.push({id:t,special:t,values:e[t]})}),n};U.propTypes={title:n().oneOfType([n().string,n().node]),showList:n().array,defaultShow:n().string,filterCondition:n().shape({filter:n().array,filterConfig:n().array}),onChange:n().func,onFilterReady:n().func,model:n().string,values:n().object};var i=g(81506),K=g.n(i),G=(g(89777),function(a){function e(){for(var p,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(p=a.call.apply(a,[this].concat(t))||this).resetState=function(){-1!==p.state.selectIndex&&p.setState({selectIndex:-1},function(){p.buildChart()})},p.getChartData=function(){var e;p.refs.chart&&p.refs.chart.myChart&&(e=p.refs.chart.myChart.getOption().series[0].data.map(function(e){return[e.name,e.value]}),p.downloadExcel({titles:["词语","数量"],data:e}))},p.buildChart=function(){var e=p.props.index,t=document.getElementsByClassName("widget-chart")[e];if(t&&2<t.childElementCount)for(var n=document.createElement("span"),a=1;a<t.childElementCount;a++)t.childNodes[a].replaceWith(n);var i,r,o,s,c=p.state,l=c.colors,d=c.selectIndex,u=p.props.json;u?p.props.loading||("string"!=typeof(u="string"!=typeof u&&0===u.length?"没有数据可用":u)?(o=p.refs.chart.myChart,p.jsonStr===JSON.stringify(u)?o.resize():p.jsonStr=JSON.stringify(u),i=o.getHeight(),e=o.getWidth(),r=0,u=u.filter(function(e){return e}),c=Math.min(4,Math.max.apply(Math,u.map(function(e){return e.value}))),u&&u.map(function(e){return r+=14*e.name.length*14*e.value*e.value}),o=Math.floor(14*u[0].count*Math.sqrt(14*c*(i*e)/r)),o=.9*Math.min(i,e/c,o,114),(o={type:"wordCloud",sizeRange:[12,60],rotationRange:[0,0],gridSize:12,textPadding:10,width:"100%",height:"100%",textStyle:{normal:{color:function(e){var t=l[e.dataIndex%l.length];return-1===d||d===e.dataIndex?t:"#D2D2D2"}}}}).data=u.map(function(e){return{name:e.name,value:Math.sqrt(e.value),originValue:e.value}}),s=K()(p),p.refs.chart.setOption({tooltip:{formatter:function(e){var t=e.marker,n=e.name,e=e.data;return t+n+"："+s.buildNum(e.originValue,2)}},grid:{top:0,bottom:0,left:0,right:0},series:[o]},!0)):p.refs.chart.setEmptyOption(u)):p.refs.chart.loading()},p.myChartClick=function(e){var t=e.dataIndex===p.state.selectIndex?void 0:e,e=e.dataIndex===p.state.selectIndex?-1:e.dataIndex;p.setState({selectIndex:e},function(){p.buildChart()}),p.props.myChartClick(t,e)},p.getParams=function(){},p}o()(e,a);var t=e.prototype;return t.componentWillMount=function(){this.setState({colors:this.colors.normal,selectIndex:this.props.activeOpinionIndex})},t.componentWillReceiveProps=function(e){var t=e.json,e=e.activeOpinionIndex;this.setState({json:t,selectIndex:e})},e}(g(53281).Z)),Q=g(25713),X=g(94644),$=g(60496),t=g(55609),a=g(48926),ee=g.n(a),i=g(87757),te=g.n(i);var ne=g(87219);var a=function(a){function e(){for(var u,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(u=a.call.apply(a,[this].concat(t))||this).lineChartRef=C().createRef(),u.barChartRef=C().createRef(),u.fetchAspectLineData=function(a){var e=u.state,t=e.dateType,n=e.filterModel,i=e.dateFilter,r=e.projectId,o=e.compareObj,s=e.emotion,c=a.dateType||t,l=void 0!==a.compareObj?a.compareObj:o,d={projectId:r,dateFilter:(0,ne.ZP)(i,function(e){e.dateGroupType=c}),filterModel:(0,ne.ZP)(n,function(e){l&&e.analysis.values.push(l)})};u.setState({fetchingAspectLineData:!0},function(){var e,t,n;e=d,t=d.projectId,n=d.filterModel,e=d.dateFilter,m.h.post("/widget/data/find/ASPECT_TREND_LINE",{projectId:t,filterModel:n,dateFilter:e}).then(function(e){var t=e.data,n=2e4===t.code&&t.result&&t.result.list&&0<t.result.list.length,e=0;n&&(e=t.result.list[0].data.reduce(function(e,t){return e+t[s]},0),e=k.ZP.getApproximateNum(e)),u.setState(f()({},a,{fetchingAspectLineData:!1,aspectLineData:n?t.result.list:"empty",msgTotal:e}))}).catch(function(){u.setState({fetchingAspectLineData:!1,aspectLineData:"error"})})})},u.fetchAspectBarData=function(i){var e=u.state,t=e.projectId,n=e.dateFilter,a=e.topicObj,r=e.topicOpts,e=e.filterModel,o=i.topicObj||a,r=r.find(function(e){return e.value===o}),s="";r&&(s=r.type);var c={projectId:t,dateFilter:n,filterModel:(0,ne.ZP)(e,function(e){e.analysis.type=function(e){switch(e){case"connConfig":return"TARGET_ANALYSIS";case"source":return"TARGET_SOURCE_ANALYSIS";case"tag":return"TARGET_TAG_ANALYSIS";case"expandTopic":return"TARGET_EXPAND_TOPIC_ANALYSIS";default:return"TARGET_ANALYSIS"}}(s)}),analysisObject:o};u.setState({fetchingAspectBarData:!0},function(){var e,t,n,a;e=c,t=c.projectId,n=c.dateFilter,a=c.filterModel,e=c.analysisObject,m.h.post("/analysis/data",{projectId:t,dateFilter:n,filterModel:a,analysisObject:e}).then(function(e){e=e.data;2e4===e.code&&u.setState(f()({},i,{fetchingAspectBarData:!1,aspectBarData:e.result?e.result.list:"empty"}))}).catch(function(){u.setState({fetchingAspectLineData:!1,aspectLineData:"error"})})})},u.handleOnFilterChange=function(e){void 0!==e.dateType||void 0!==e.compareObj?u.fetchAspectLineData(e):void 0!==e.topicObj&&u.fetchAspectBarData(e)},u.handleOnChartClick=function(e,t){var n=u.props.onChartClick;"bar"===e?u.lineChartRef.current.resetChartRender():"line"===e&&u.barChartRef.current.resetChartRender(),n&&n(t)},u}return o()(e,a),e.prototype.resetChartRender=function(){this.lineChartRef.current.resetChartRender(),this.barChartRef.current.resetChartRender()},e}(C().PureComponent),ae=g(70715),i=function(a){function e(){for(var c,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(c=a.call.apply(a,[this].concat(t))||this).dimensions=void 0,c.source=void 0,c.chartRef=void 0,c.mColor=void 0,c.margin=0,c.chartLength=0,c.dateType="DAY",c.getChartRef=function(e){return c.chartRef=e},c.setValue=function(e,o){c.chartLength=e.length;var s=60;c.dimensions=["日期"],c.source=e.reduce(function(i,e,r){return c.dimensions.push(e.title+("positive"===o?"正面":"负面")+"声量",e.title+"指标"+("positive"===o?"满意度":"差评率")),e.data.forEach(function(e,t){var n=e[o],a=e.positive+e.negative===0?0:e[o]/(e.positive+e.negative);s=Math.max(s,(0,k.jD)(n,12)+40),0===r?i.push([e.title,n,a]):i[t].push(n,a)}),i},[]),c.margin=s,c.mColor=1===c.chartLength?"positive"===o?["#15B374","#108657"]:["#D96969","#C44A4A"]:"positive"===o?["#15B374","#108657","#cdb446","#a89230"]:["#D96969","#c44a4a","#cdb446","#a89230"]},c.getOption=function(e,t,a,n){var i=Array.from({length:c.chartLength}).map(function(e,n){return[{type:"bar",barMaxWidth:24,name:c.dimensions[2*n+1],data:c.source.map(function(e,t){return{value:e[2*n+1],itemStyle:{color:0!==n&&1!==n&&2!==n&&3!==n||-1===a||a===t?c.mColor[2*n%c.mColor.length]:"#d8d8d8"}}})},{type:"line",yAxisIndex:1,name:c.dimensions[2*n+2],data:c.source.map(function(e,t){return{value:e[2*n+2],symbolSize:-1<a&&a===n?8:4,itemStyle:{color:0!==n&&1!==n&&2!==n&&3!==n||-1===a||a===t?c.mColor[(2*n+1)%c.mColor.length]:"#d8d8d8"}}}),lineStyle:{color:n<4&&-1<a?"#d8d8d8":c.mColor[(2*n+1)%c.mColor.length]}}]});return{color:c.mColor,title:{text:e,subtext:t,subtextStyle:{lineHeight:32,color:"#262626",fontSize:24}},grid:{top:140,left:20,right:c.margin,bottom:40,containLabel:!0},dataset:[{source:c.source,dimensions:c.dimensions}],legend:{top:70,left:20,itemWidth:10,itemHeight:10,textStyle:{lineHeight:12},data:c.dimensions.slice(1).map(function(e,t){return{name:e,icon:t%2==0?ae.W4.square:ae.W4.lineRing}})},dataZoom:{show:"slider",bottom:16,xAxisIndex:0,height:16,handleSize:"100%",showDetail:!1},tooltip:{trigger:"axis",formatter:function(e){var t=e[0],e=e.map(function(e,t){t=t%2==0?e.data.value:(100*e.data.value).toFixed(2)+"%";return e.marker+" "+e.seriesName+"："+t});return(0,ae.Zi)((0,k.yV)(c.dateType,t.axisValue))+"</br>"+e.join("</br>")}},xAxis:{type:"category",axisLabel:{formatter:function(e){return(0,k.yV)(c.dateType,e)}},data:c.source.map(function(e){return e[0]})},yAxis:[{type:"value",name:"数量",splitNumber:3,nameTextStyle:{color:"#262626"}},{type:"value",name:"比例",splitNumber:3,nameTextStyle:{color:"#262626"},axisLabel:{formatter:function(e){return(100*e).toFixed(2)+"%"}}}],series:2===c.chartLength?[].concat(i[0],i[1]):[].concat(i[0])}},c}return o()(e,a),e.prototype.renderChart=function(e,t,n,a,i){this.setValue(e,n,i),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,a,i,n))},e}(C().PureComponent),ie=g(8201),re=g(98191),oe=g(50976),se=g(49975),i=function(r){function e(e){var i=r.call(this,e)||this;return i.handleOnDateChange=function(e){i.dateType=e,i.props.onFilterChange({dateType:e}),i.props.onDateTypeChange({id:e})},i.handleOnChartClick=function(e){var t=e.componentType,n=(e.componentSubType,e.name),a=e.dataIndex,e=e.seriesIndex;"series"===t&&i.setState({clickedDataIndex:i.state.clickedDataIndex===a?-1:a,seriesIndex:e},function(){var e=0===i.state.clickedDataIndex?"first":i.state.clickedDataIndex===i.source.length-1?"last":"",e=-1===i.state.clickedDataIndex?null:{name:n,sideType:e};i.props.onChartClick("line",e)})},i.handleOnMoreClick=function(e){var t=i.props,n=t.title,t=t.value;"image"===e&&i.chartRef?(0,X._v)(i.chartRef,n):"data"===e&&(0,ie.P)(t)&&(0,X.aT)([[i.dimensions].concat(i.source)],n)},i.state={clickedDataIndex:-1,seriesIndex:-1},i}o()(e,r);var t=e.prototype;return t.componentDidUpdate=function(e,t){var i=this,n=e.value,a=this.props.value,e=t.clickedDataIndex,t=this.state,r=t.clickedDataIndex,o=t.seriesIndex;(0,ie.P)(a)&&JSON.stringify(n)!==JSON.stringify(a)&&this.renderChart(),!(0,ie.P)(a)&&this.chartRef&&(this.chartRef=void 0),e!==r&&this.chartRef&&(e=this.chartRef.getOption().series.map(function(e,n){var a=n<=0?0:n;return{data:e.data.map(function(e,t){return{value:e.value,symbolSize:-1<r&&r===t?8:4,itemStyle:{color:0!==n&&1!==n&&2!==n&&3!==n||-1===r||r===t&&o===n?i.mColor[a]:"#d8d8d8"}}}),lineStyle:{color:n%2!=0&&-1<r?"#d8d8d8":i.mColor[a]}}}),this.chartRef.setOption({series:e}))},t.componentDidMount=function(){this.renderChart()},t.renderChart=function(){var e=this.props,t=e.value,n=e.title,a=e.emotion,i=e.total,e=this.state.clickedDataIndex;(0,ie.P)(t)&&this.chartRef&&r.prototype.renderChart.call(this,t,n,a,i,e)},t.resetChartRender=function(){this.setState({clickedDataIndex:-1,seriesIndex:-1})},t.render=function(){var e=this.props,t=e.value,n=e.loading,a=e.title,i=e.filterObjOpts,r=e.onFilterChange,o=e.compareObj,s=e.dateRange,e=e.dateType;return C().createElement(ie.Z,{className:"yt_overview_aspect_line_chart_wrapper",data:t,loading:n,renderTitle:C().createElement(re.Z,{title:a,data:t,onMoreClick:this.handleOnMoreClick},C().createElement($.Z,{preTitle:"对比对象",options:i,objName:"compareObj",activeObj:o,sufTitle:"无",onChange:r}),C().createElement(se.Z,{defaultValue:e,noHour:!0,dateRange:s,onChange:this.handleOnDateChange}))},C().createElement(oe.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{click:this.handleOnChartClick}}))},e}(i);const ce=i;i.propTypes={title:n().string,value:n().any,onFilterChange:n().func,emotion:n().string,compareObj:n().string,dateRange:n().number,dateType:n().dateType,filterObjOpts:n().array,onChartClick:n().func,onDateTypeChange:n().func};i=function(a){function e(e){var i=a.call(this,e)||this;return i.handleOnMoreClick=function(e){var t=i.props,n=t.title,t=t.value;"image"===e&&i.chartRef?(0,X._v)(i.chartRef,n):"data"===e&&(0,ie.P)(t)&&(0,X.aT)([[i.dimensions].concat(i.source.map(function(e){return[e[0],e[1],(100*e[2]).toFixed(2)+"%"]}))],n)},i.handleOnChartClick=function(e){var t=e.componentSubType,n=e.componentType,a=e.dataIndex;"series"===n&&"bar"===t&&i.setState({clickedDataIndex:i.state.clickedDataIndex===a?-1:a},function(){var e=i.props,t=e.onChartClick,n=e.value,e=e.topicObj;t&&t("bar",-1===i.state.clickedDataIndex?null:{analysis:{id:e,values:[n[a].id],type:n[a].type}})})},i.handleOnSwitch=function(n){i.setState({showZero:n},function(){var e=i.props,t=e.value,e=e.title;a.prototype.renderChart.call(K()(i),n?t:t.filter(function(e){return e.count}),e)})},i.state={showZero:!1,clickedDataIndex:-1},i}o()(e,a);var t=e.prototype;return t.componentDidMount=function(){this.renderChart()},t.componentDidUpdate=function(e,t){var a=this,n=e.value,e=this.props.value,t=t.clickedDataIndex,i=this.state.clickedDataIndex;(0,ie.P)(e)&&JSON.stringify(n)!==JSON.stringify(e)&&this.renderChart(),!(0,ie.P)(e)&&this.chartRef&&(this.chartRef=void 0),t!==i&&this.chartRef&&(t=this.chartRef.getOption().series.map(function(e,n){return{data:e.data.map(function(e,t){return{value:e.value,itemStyle:{color:-1===i||i===t?a.mColor[n%a.mColor.length]:"#d8d8d8"}}})}}),this.chartRef.setOption({series:t}))},t.renderChart=function(){var e=this.props,t=e.value,n=e.title,e=this.state.showZero;(0,ie.P)(t)&&this.chartRef&&a.prototype.renderChart.call(this,e?t:t.filter(function(e){return e.count}),n)},t.resetChartRender=function(){this.setState({clickedDataIndex:-1})},t.render=function(){var e=this.state.showZero,t=this.props,n=t.value,a=t.loading,i=t.title,r=t.topicOpts,o=t.topicObj,t=t.onFilterChange;return C().createElement(ie.Z,{className:"yt_overview_aspect_bar_chart_wrapper",data:n,loading:a,renderTitle:C().createElement(re.Z,{title:i,data:n,onMoreClick:this.handleOnMoreClick,titleOverlay:C().createElement("span",null,"此图的分析方法是统计分析中常用的柏拉图，",C().createElement("a",{style:{color:"#0747a6"},href:"https://www.yuque.com/docs/share/5cc9676c-e68a-4304-8f36-f2bcdd347edb?#",target:"_blank"},"了解更多"))},C().createElement($.Z,{options:r,objName:"topicObj",preTitle:"分析对象",sufTitle:"无",activeObj:o,onChange:t}),C().createElement(v.Checkbox,{checked:e,onChange:this.handleOnSwitch,className:"zero_switch"},"显示'0'"))},C().createElement(oe.Z,{onChartReady:this.getChartRef,theme:"yunting_multi_color",option:{},style:{height:"100%"},onEvents:{click:this.handleOnChartClick}}))},e}(function(i){function e(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=i.call.apply(i,[this].concat(n))||this).dimensions=void 0,t.source=void 0,t.chartRef=void 0,t.margin=0,t.mColor=ae.Fq,t.getChartRef=function(e){return t.chartRef=e},t.setValue=function(e){t.dimensions=["指标","声量","累计声量占比"];var a=(0,k.jD)("100%",12)+30;t.source=e.reduce(function(e,t,n){return e[n].push(t.count),a=Math.max(a,(0,k.jD)(t.count,12)+30),e[n].push(t.percentage),e},e.map(function(e){return[e.title]})),t.margin=a},t.getOption=function(e){return{title:{text:e},tooltip:{trigger:"axis",formatter:function(e){return e.reduce(function(e,t,n){var a=t.marker,i=t.value,t=t.name;return 0===n?(e.push((0,ae.Zi)(t)),e.push(a+" 声量："+i)):e.push(a+" 累计占比："+(100*i).toFixed(2)+"%"),e},[]).join("</br>")}},legend:{left:20,top:50,itemWidth:10,itemHeight:10,data:[{name:"声量",icon:ae.W4.square},{name:"累计声量占比",icon:ae.W4.lineRing}]},grid:{bottom:70,left:t.margin,right:t.margin,top:110},dataZoom:[{show:"slider",bottom:20,xAxisIndex:[0,1],height:15,handleSize:"100%",showDetail:!1}],dataset:[{source:t.source,dimensions:t.dimensions}],xAxis:[0,1].map(function(e){return{type:"category",data:t.source.map(function(e){return e[0]}),position:"bottom",show:!e}}),yAxis:[0,1].map(function(t){return{type:"value",name:t?"":"各商品指标排行",nameTextStyle:{color:"#262626"},axisLabel:{formatter:function(e){return t?(100*e).toFixed(0)+"%":e}}}}),series:[{type:"bar",yAxisIndex:0,barMaxWidth:40,data:t.source.map(function(e){return{value:e[1],itemStyle:{color:"#1574B3"}}}),markLine:{symbolSize:0,data:[{name:"均值",type:"average",label:{backgroundColor:"rgba(140, 140, 140, 0.3)",textShadowColor:"#1574b3",textShadowBlur:2,padding:[2,4],color:"#fff"}}]}},{type:"line",yAxisIndex:1,data:t.source.map(function(e){return{value:e[2],itemStyle:{color:"#CDB446"}}})}]}},t}return o()(e,i),e.prototype.renderChart=function(e,t){this.setValue(e),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t))},e}(C().PureComponent));const le=i;i.propTypes={value:n().any,topicOpts:n().array,topicObj:n().string,loading:n().bool,title:n().string,onFilterChange:n().func,onChartClick:n().func};a=function(u){function e(e){var t=u.call(this,e)||this;t.getFilterListShowAndHide=function(e){var n=JSON.parse(JSON.stringify(e));t.props.messageRelationConfig&&t.props.messageRelationConfig.unshow&&t.props.messageRelationConfig.unshow.forEach(function(t){n.some(function(e){return e.id===t&&(n.splice(n.findIndex(function(e){return e.id===t}),1),!0)})});var a,i=[],r=[];return t.props.saveFilterListShow&&E.t.get(t.props.saveFilterListShow)&&E.t.get(t.props.saveFilterListShow).some(function(e){return e.projectId===t.state.projectId})?(a=E.t.get(t.props.saveFilterListShow).filter(function(e){return e.projectId===t.state.projectId})[0],n.forEach(function(t){(a.filterListShow.some(function(e){return e.id===t.id})?i:r).push(t)})):(i=JSON.parse(JSON.stringify(n.slice(0,4))),r=JSON.parse(JSON.stringify(n.slice(4)))),{filterListShow:i,filterListHide:r}};var n=e.params,a=n.projectId,i=n.filterModel,r=n.dateFilter,o=n.analysisObjs,s=i&&i.aspect&&i.aspect.emotion&&i.aspect.emotion[0]||"positive",e=[],n=[];try{var c=JSON.parse(E.t.get(E.V.filterList)||localStorage.getItem("filter-list")),l=i.analysis.values[0],d=i.analysis.id;c.list.find(function(e){return e.id===d})&&(e=c.list.find(function(e){return e.id===d}).values.reduce(function(e,t){return t.id!==l&&o.includes(t.id)&&e.push({title:t.name,value:t.id}),e},[{title:"无",value:""}])),n=c.list.reduce(function(e,t){return"escore"!==t.id&&t.id!==d&&e.push({title:t.name,value:t.id,type:t.special}),e},[])}catch(e){}return t.state={aspectLineData:void 0,fetchingAspectLineData:!1,compareObj:"",dateType:r.dateGroupType,msgTotal:0,dateRange:r.numOfDays,aspectBarData:void 0,fetchingAspectBarData:!1,topicObj:0<n.length?n[0].value:"",emotion:s,filterObjOpts:e,topicOpts:n,filterModel:i,dateFilter:r,projectId:a},t}o()(e,u);var t=e.prototype;return t.componentDidMount=function(){var s=this;this.fetchAspectBarData({});var e=this.state,t=e.projectId,e=e.filterObjOpts;(!e||e.length<=0)&&ee()(te().mark(function e(){return te().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.h.post("/filter/find",{type:"OVERVIEW",filterTypes:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"],projectId:t}).then(function(e){var t=s.formatData(e.data.result);console.log(e);var n=s.getFilterListShowAndHide(t),e=n.filterListShow,t=n.filterListHide,n=JSON.parse(JSON.stringify(e.concat(t))),a=[];n.forEach(function(e){e.child&&0<e.child.values.length&&a.push(f()({},e.child,{special:"connConfig"}))}),0<(n=(n=n.filter(function(e){return!["input"].includes(e.type)})).concat(n.splice(n.findIndex(function(e){return"expandTopic"===e.special}),1))).length&&E.t.set(E.V.filterList,JSON.stringify({list:n.concat(a),value:[]}));var e=s.props.params,t=e.filterModel,i=e.analysisObjs,r=t.analysis.values[0],o=t.analysis.id;s.setState({filterObjOpts:n.concat(a).find(function(e){return e.id===o})?n.concat(a).find(function(e){return e.id===o}).values.reduce(function(e,t){return t.id!==r&&i.includes(t.id)&&e.push({title:t.name,value:t.id}),e},[{title:"无",value:""}]):n.concat(a),topicOpts:n.concat(a).reduce(function(e,t){return"escore"!==t.id&&t.id!==o&&e.push({title:t.name,value:t.id,type:t.special}),e},[])})});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))()},t.formatData=function(t){var n=this,a=[],e={};t.topics&&t.topics.titles&&0<t.topics.titles.length&&(e.connConfig=t.topics.data,a.push.apply(a,t.topics.titles.filter(function(e){return e.special="connConfig",e.filterType=t.topics.data?"connConfig":void 0,1<e.values.length}))),t.aspects&&t.aspects.titles&&0<t.aspects.titles.length&&(e.aspects=t.aspects.data,a.push.apply(a,t.aspects.titles.filter(function(e){return e.special="vocAspect",e.filterType=t.aspects.data?"aspects":void 0,1<e.values.length}))),t.brandsSeries&&t.brandsSeries.titles&&0<t.brandsSeries.titles.length&&(e.brandsSeries=t.brandsSeries.data,a.push.apply(a,t.brandsSeries.titles.filter(function(e){return e.special="brandsSeries",e.filterType=t.brandsSeries.data?"brandsSeries":void 0,1<e.values.length}))),this.setState({reFilterData:e}),t.dimension&&a.push.apply(a,t.dimension.filter(function(e){return e.special="dimension",e.type=-1!==["BRAND_INTERACTION_ANALYSIS","BRAND_CONTENT_ANALYSIS","BRAND_CHANNEL_ANALYSIS"].indexOf(n.props.type)?"radio":"",1<e.values.length})),t.source&&0<t.source.length&&a.push({id:"source",name:"数据来源",special:"source",values:t.source}),t.tag&&0<t.tag.length&&t.tag.forEach(function(e){e.special="tag",a.push(e)}),t.userFilter&&a.push({id:"userFilter",special:"userFilter",name:"用户",type:"associateInput",values:t.userFilter}),this.props.filterConfig&&this.props.filterConfig.forEach(function(e){switch(e){case"ESCORE":a.push({id:"escore",special:"escore",name:"通用情感",values:[{id:"1",name:"正面"},{id:"0",name:"中性"},{id:"-1",name:"负面"}]});break;case"MULTI_KEY_WORD":a.push({id:"MULTI_KEY_WORD",special:"content",name:"关键词",type:"multi_input",values:[]});break;case"KEY_WORD":a.push({id:"KEY_WORD",special:"content",name:"关键词",type:"input",values:[]});break;case"USEFUL_DATA":a.push({id:"usefulData",special:"usefulData",name:"数据有效性",values:[{id:"USEFUL",name:"有效数据"},{id:"UNUSEFULL",name:"无效数据"}]});break;case"ASPECT_ESCORE":a.push({id:"aspectEscore",special:"aspectEscore",name:"指标情感",values:[{id:"1",name:"正面"},{id:"0",name:"中性"},{id:"-1",name:"负面"}]});break;case"IS_BUSINESS":a.push({id:"isBusiness",special:"isBusiness",name:"业务数据",values:[{id:"BUSINESS",name:"是"},{id:"UN_BUSINESS",name:"否"}]});break;case"IS_MARKETING":a.push({id:"isMarketing",special:"isMarketing",name:"营销数据",values:[{id:"MARKETING",name:"是"},{id:"UN_MARKETING",name:"否"},{id:"NULL_MARKETING",name:"（空）"}]})}}),t.expandTopics&&a.push({id:"expandTopic",name:"组合分析",special:"expandTopic",values:t.expandTopics,type:"expandTopic"});e=a.map(function(e){return f()({},e,{values:0<e.values.length?(0,k.QM)(e.values):e.values})});return JSON.parse(JSON.stringify(e))},t.render=function(){var e=this.state,t=e.aspectLineData,n=e.fetchingAspectLineData,a=e.compareObj,i=e.dateType,r=e.emotion,o=e.filterObjOpts,s=e.dateRange,c=e.msgTotal,l=e.aspectBarData,d=e.fetchingAspectBarData,u=e.topicOpts,p=e.topicObj,e=this.props.onLineDateTypeChange;return C().createElement("div",{className:"yt_detail_chart_view_wrapper"},C().createElement(ce,{ref:this.lineChartRef,title:"指标声量及走势",emotion:r,total:c,value:t,loading:n,filterObjOpts:o,compareObj:a,dateType:i,dateRange:s,onChartClick:this.handleOnChartClick,onDateTypeChange:e,onFilterChange:this.handleOnFilterChange}),C().createElement(le,{ref:this.barChartRef,value:l,title:"指标分布",loading:d,topicOpts:u,onChartClick:this.handleOnChartClick,topicObj:p,onFilterChange:this.handleOnFilterChange}))},e}(a);const de=a;a.propTypes={params:n().any,onChartClick:n().func,onLineDateTypeChange:n().func};var ue=["#1550B3","#CC6A77","#119073","#CDB446","#D969BF","#2684FF","#C8662B","#9369D9","#0E97AD","#1BBF69","#D07B49","#61799B","#1EA082","#A9A557","#D8727F"],pe=[{title:"导出图片",type:"wImage"},{title:"导出数据",type:"wExcel"}],he={DAY:"天",WEEK:"周",MONTH:"月"},n=function(t){function e(e){var s=t.call(this,e)||this;return s._handleOnWsMessage=function(e){var t=e.data;t.type&&"ws"===t.type&&(t=(e=t.payload).type,e=e.result,"OPINION_TASK_RESULT"===t&&s.props.dispatch({type:"opinionChart/handleOpinion",payload:e}))},s.changeChart=function(e){(0,s.props.dispatch)({type:"opinionChart/save",payload:{wordCloud:e}})},s.myChartClick=function(e){var t=s.props.opinionChart,n=(t.json_bar,t.queryParams.dateFilter),a=n.from,t=n.to,n=s.state.dateType,i=null;e&&e.name?i={time:e.name,type:n,sideType:e.sideType,sideTime:"first"===e.sideType?a:"last"===e.sideType?t:""}:e&&e.analysis&&(i={analysis:e.analysis}),s.clickTimeId&&clearTimeout(s.clickTimeId),s.clickTimeId=setTimeout(function(){s.props.refreshMessage(i),s.refs.wordCloud&&s.refs.wordCloud.resetState(),s.clickTimeId=void 0},1e3)},s.resetWordcloudState=function(){setTimeout(function(){s.refs.wordCloud&&s.refs.wordCloud.resetState(),s.setState({activeOpinionIndex:-1})},0)},s.resetBarchartState=function(){setTimeout(function(){s.refs.bar&&s.refs.bar.resetChartRender()},0)},s.handleMyWordChartClick=function(e,t){var n=s.props.opinionChart,a=n.queryTimeType,n=n.clusterType,n=s.state.activeOpinionIndex!==t&&e?{opinion:e.name,type:a,clusterType:n}:null;s.props.refreshMessage(n),s.clickTimeId&&clearTimeout(s.clickTimeId),s.clickTimeId=setTimeout(function(){s.refs.bar&&s.refs.bar.resetState(),s.setState({activeOpinionIndex:t}),s.clickTimeId=void 0},100)},s.onWindowResize=function(){setTimeout(function(){s.resize()},300)},s.resize=function(){var e;s.flexWrapper&&(e=s.flexWrapper.offsetWidth*s.rate,s.flexSpan.style.fontSize=e+"px"),s.refs.bar&&s.refs.bar.refs.chart.myChart.resize()},s.changeQueryTime=function(e){e.name;var t=e.id,n=s.props,e=n.opinionChart.queryParams,n=n.dispatch,e=JSON.parse(JSON.stringify(e));e.dateFilter.dateGroupType=t,s.setState({dateType:t}),n({type:"opinionChart/save",payload:{queryTimeType:t,queryParams:e}})},s.renderOpinionOverlay=function(){return C().createElement("div",null,C().createElement("div",null,"该数据为您显示：由于所选的消息中不光会有与中心指标情感相关的观点，还会有其他相关指标和情感的观点，用户可以自主控制是否展示仅展示中心指标情感相关的观点；同时对于聚类的观点粗细程度也可以由用户选择。"),C().createElement("div",{style:{margin:"5px 0"}},"算法说明：典型意见的获得大致经历如下几个步骤：①从消息中抽取观点→②对观点聚类→③选举中心观点。在以上步骤上，用户可以在①之后选择即将聚类的观点是否与中心指标情感相关；在②用户可以选择聚类的粗细程序，参数设置越小，聚类的观点越细；在③可能会选举出与中心指标的情感相关的观点，这是用户可以选择排除该中心观点，系统会自动给出第二备选的观点。"),C().createElement("div",null,"名词辨析：典型意见即观点，是一个聚类出的观点簇中的代表。"))},s._handleMoreClick=function(e){var t=s.props.opinionChart,n=t.json_word,a=t.json_bar,t=t.queryTimeType;"wImage"===e?(0,X._v)(s.refs.wordCloud.refs.chart.myChart,"典型意见"):"bImage"===e?(0,X._v)(s.refs.bar.refs.chart.myChart,"数据趋势"):"bExcel"===e?(t=a.reduce(function(e,t){return[].concat(e,[[t.time,t.count]])},[["日期/按"+he[t],"词频"]]),(0,X.aT)([t],"数据趋势")):"wExcel"===e&&(n=n.reduce(function(e,t){return t?[].concat(e,[[t.name,t.value]]):e},[["词名","词频"]]),(0,X.aT)([n],"典型意见"))},s._handleCommonChange=function(e){var t=s.props,n=t.dispatch,a=t.opinionChart,i=a.refreshing,r=a.reloaded,o=a.allData,t=a.type,e=(a.hasRecord,e.clusterType);i&&3!==t&&!r||4===t?n({type:"opinionChart/save",payload:{clusterType:e,json_word:o[e]}}):(n({type:"opinionChart/save",payload:{clusterType:e}}),n({type:"opinionChart/getWordCloudList"})),s.setState({optionPage:1})},s.renderWordOverlay=function(t){return C().createElement("div",{onClick:function(e){e.stopPropagation()}},C().createElement("span",null,t),C().createElement("span",{onClick:function(e){s._handleWordHideClick(t)}},"隐藏"))},s._handleWordHideClick=function(t){var e=s.props,n=e.opinionChart.json_word,a=e.dispatch,e=n.filter(function(e){return e&&e.name!==t}),n=Math.ceil(n.length/30),e=[].concat(e,Array(30*n-e.length).fill(void 0));ge(e),a({type:"opinionChart/save",payload:{json_word:e}})},s.goOpinion=function(){var e=s.props.taskId;window.open("/opinion?id="+e+"&source=detail")},s._handleOnOptionWordListPageChange=function(e){s.setState({optionPage:e})},s.state={activeOpinionIndex:-1,optionPage:1,dateType:"DAY"},s}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){var e=this.props,t=e.type,n=e.dispatch,a=e.opinionChart,i=a.opinion,a=(a.hasRecord,e.taskId);0<location.search.length&&"/tab/detail"===location.pathname&&n({type:"opinionChart/save",payload:{queryParams:e=JSON.parse(decodeURIComponent(location.search).split("?")[1]),queryTimeType:e.dateFilter.dateGroupType,type:t,currTaskId:a}}),!i||2!==t&&3!==t||n({type:"opinionChart/getWordCloudList"}),this.flexWrapper&&(n=this.flexWrapper.offsetWidth,this.rate=.03,this.flexSpan.style.fontSize=n*this.rate+"px"),window.addEventListener("resize",this.onWindowResize)},n.UNSAFE_componentWillReceiveProps=function(e,t){var n=this.props,a=n.dispatch,i=(n.opinionChart.opinion,this.props.taskId),n=e.taskId;i!==n&&a({type:"opinionChart/save",payload:{currTaskId:n}}),this.props.type!==e.type&&a({type:"opinionChart/save",payload:{type:e.type}}),JSON.stringify(this.props.params)!==JSON.stringify(e.params)&&a({type:"opinionChart/save",payload:{queryParams:e.params,queryTimeType:e.params.dateFilter&&e.params.dateFilter.dateGroupType||"DAY"}})},n.componentWillMount=function(){(0,this.props.dispatch)({type:"opinionChart/save",payload:{count:0,average:0,json_bar:"没有数据可用",json_word:[]}}),window.addEventListener("resize",this.onWindowResize),window.addEventListener("message",this._handleOnWsMessage)},n.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage)},n.shouldComponentUpdate=function(e,t){var n=this.props.opinionChart,a=n.clusterType,i=n.json_word,r=n.json_bar,o=n.opinionTaskValid,s=n.queryTimeType,c=n.refreshing,l=n.wordCloud,d=n.allData,u=n.loading,p=e.opinionChart,h=p.clusterType,f=p.json_word,m=p.json_bar,g=p.opinionTaskValid,v=p.queryTimeType,y=p.refreshing,n=p.wordCloud,e=p.allData,p=p.loading;return!(a===h&&o===g&&s===v&&c===y&&l===n&&u===p&&O(i,f)&&O(r,m)&&O(d,e))||this.state.optionPage!==t.optionPage},n.render=function(){var a=this,e=this.props,t=e.opinionChart,n=t.type,i=t.wordCloud,r=(t.json_bar,t.average,t.queryTimeType,t.json_word),o=t.queryParams,s=t.opinion,c=t.clusterType,l=t.refreshing,d=(t.allData,t.opinionTaskValid),u=t.invalidReason,p=(t.hasRecord,t.clusterTypeOptions),h=t.loading,t=e.params;console.log({opinionTaskValid:d,invalidReason:u});var e=this.state,f=e.optionPage,m=e.activeOpinionIndex;return C().createElement("div",{className:"detailChart"},4===n&&t.analysisObjs&&C().createElement(de,{ref:"bar",params:t,onChartClick:this.myChartClick,onLineDateTypeChange:this.changeQueryTime}),s&&C().createElement("div",{className:"detailChart-bottom"},C().createElement("div",{className:"title"},C().createElement("span",null,C().createElement("span",{style:{marginLeft:5,fontSize:14}},"典型意见",4===n&&"（"+(o&&o.seriesName)+"）"),C().createElement(y.Z,{placement:"bottom",overlayClassName:4===n?"popover-detial-wrapper":"popover-opinion-wrapper",overlay:this.renderOpinionOverlay()},C().createElement("i",{className:"icon-cem_file1"}))),C().createElement("span",null,4!==n&&C().createElement(y.Z,{overlay:"当前图表显示的是前5000条消息的典型意见结算结果，系统正在计算全部消息的典型意见，计算好之后会自动刷新图表",placement:"top",overlayClassName:"alert-log-tips"},C().createElement("i",{className:l?"icon-cem_refresh refreshing":"icon-cem_refresh",style:{display:l?"inline-block":"none"}})),C().createElement("span",{className:"clustering"},C().createElement("span",{className:l?"":"disapper"},"聚类颗粒："),C().createElement($.Z,{activeObj:c,onChange:this._handleCommonChange,options:p,objName:"clusterType"})),C().createElement("i",{className:"icon-cem_cloud "+(i?"active":""),onClick:this.changeChart.bind(this,!0)}),C().createElement("i",{className:"icon-cem_listing "+(i?"":"active"),onClick:this.changeChart.bind(this,!1)}),C().createElement("span",{style:{color:"#e5e5e5",marginRight:8}},"|"),C().createElement(Q.Z,{options:pe,onClick:this._handleMoreClick}))),C().createElement(v.Loading,{className:"chart-table",loading:h,text:"拼命加载中"},r?d?i?C().createElement(G,{index:4===n?1:0,ref:"wordCloud",json:r,activeOpinionIndex:m,myChartClick:this.handleMyWordChartClick}):C().createElement(C().Fragment,null,C().createElement("div",{className:"oppion-word"},0!==r.length||h?r.slice(30*(f-1),30*f).map(function(t,e){var n=30*(f-1)+e+1;return C().createElement("div",{key:n},t?C().createElement(y.Z,{overlayClassName:"popover-detail-wrodcloud-list-wrapper",placement:"top",overlay:a.renderWordOverlay(t.name)},C().createElement("span",{className:"option-item "+(-1===m||n===m?"":"inactive-option-item"),onClick:function(e){a.handleMyWordChartClick(t,n)}},C().createElement("span",null,C().createElement("span",{style:{backgroundColor:""+(n<7?ue[n%ue.length]:"#8c8c8c")}},n)),C().createElement("span",null,t.name),C().createElement("span",null,me(t.value,2)),C().createElement("span",null,"("+t.ratio+")"))):null)}):C().createElement("div",{className:"no-data"},C().createElement("img",{src:g(76180)}),C().createElement("span",null,"没有数据可用"))),30<r.length?C().createElement(v.Pagination,{className:"oppion-word-pagination",layout:"prev, pager, next",total:r.length,pageSize:30,currentPage:f,small:!0,onCurrentChange:this._handleOnOptionWordListPageChange}):null):C().createElement("div",{className:"no-data"},0!==u&&C().createElement(C().Fragment,null,C().createElement("img",{src:g(47303)}),C().createElement("span",null,"当前",1===u?"消息中少于20个观点":2===u?"小于50条消息":"大于50万条消息","，无法启动典型意见"),C().createElement("span",null,"请重新选择筛选条件"))):null)))},r()(e,[{key:"formatterData",get:function(){var e=this.props.opinionChart.count,t=String(e);if(3<t.length){var n=t.split(""),a="",i=n.length,t=i-(3+(i%3==0?3:i%3));3<=t&&t<6&&6<i?a="K":6<=t&&(a="M");for(var r=0,o=i;0<o;o--)0!==r&&r%3==0&&n.splice(o,0,","),r++;return n.slice(0,n.indexOf(",")+4).join("")+a}return e}}]),e}(d.Component);const fe=(0,t.connect)(function(e){var t=e.opinionChart;e.loading;return{opinionChart:t}},null,null,{withRef:!0})(n);var me=function(e,t){return e?e/1e4<1?e:e/1e8<1?(e/1e4).toFixed(t||0)+"万":(e/1e8).toFixed(t||0)+"亿":0},ge=function(e){var t=e.reduce(function(e,t){return t?e+t.value:e},0);e.forEach(function(e){e&&(e.ratio=(e.value/t*100).toFixed(2)+"%")})},ve=(g(75314),g(11187)),ye=g(38425),Ce=g(52314),Ee=g(12234),n=g(94184),Se=g.n(n),Oe=(C().PureComponent,g(66746));A().locale("zh-cn");var ke=[{title:"导出数据",type:"excel"}],Ne=function(t){function e(e){var p=t.call(this,e)||this;return p.openItem=function(e,t){p.getAspects(),p.setState({openItem:p.state.openItem===e?null:e,emotion:t})},p.getPageTable=function(e){var t,n=p.state,a=n.info,n=n.isInitial;p.setState({isLoading:!0,pageIndex:e},function(){return p.searchTable(a)}),n||(location.pathname.includes("opinion")?(t=document.getElementsByClassName("content-sidebar")&&document.getElementsByClassName("content-sidebar")[0])&&(t.scrollTop=760):(t=document.getElementsByClassName("content")&&document.getElementsByClassName("content")[0])&&(t.scrollTop=620))},p.searchTable=function(r){var e,t,n,o,s,a=p.state,i=a.params,c=a.pageSize,l=a.pageIndex,d=a.info,u=a.searchValue;(i.filterModel.taskId||i.dateFilter)&&(i.filterModel.aspect||(i.filterModel.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]}),a=(t=p.props).params,t.type,o=JSON.parse(JSON.stringify(i)),t=[],1===(a=(i=JSON.parse(JSON.stringify(a))).filterModel.aspect.emotion).length?t="positive"===a[0]?["正面"]:["负面"]:2===a.length&&(t=["正面","负面"]),p.setState({seriesName:t}),s="",e="/inbox/aspect/find",!r||r.content?(o=i,r&&void 0!==r.hide&&!1===r.hide?s=void 0:r&&r.content&&(s=r.content[0].contain[0])):r.opinion?(e="/opinion/result/message",o={projectId:i.projectId,type:"EMOTION_ASPECT_LEVEL_BAR",filterModel:{taskId:i.taskId,clusterLevel:r&&r.clusterType||20,opinion:r.opinion}},r&&r.opinion&&(s=void 0)):(r||d).type?(o=i,"DAY"===(r||d).type?(o.dateFilter.from=(r||d).time,o.dateFilter.to=(r||d).time):"WEEK"===(r||d).type?(t=(n=(d||r).time.split("-"))[0],n=n[1],t=""+Number(t),n=A()(t).week(n),"first"===r.sideType?o.dateFilter.from=r.sideTime:o.dateFilter.from=n.startOf("week").format("YYYY-MM-DD"),"last"===r.sideType?o.dateFilter.to=r.sideTime:o.dateFilter.to=n.endOf("week").format("YYYY-MM-DD")):"MONTH"===(r||d).type&&(n=A()(r.time),"first"===r.sideType?o.dateFilter.from=r.sideTime:o.dateFilter.from=n.startOf("month").format("YYYY-MM-DD"),"last"===r.sideType?o.dateFilter.to=r.sideTime:o.dateFilter.to=n.endOf("month").format("YYYY-MM-DD")),p.setState({mParams:{from:o.dateFilter.from,to:o.dateFilter.to}}),o.dateFilter.dateGroupType=(r||d).type,o.dateFilter.aspect_bar=!0):r.analysis&&((o=i).filterModel.analysis=r.analysis),o.filterModel.project=[i.projectId],i=[],o.filterModel.content&&o.filterModel.content[0]&&(i=o.filterModel.content[0].contain),o.filterModel.content=[{contain:[].concat(i,(s=void 0===s?"":""===s?u:s)?s.trim().split(" "):[])}],o.pageIndex=JSON.stringify(r)!==JSON.stringify(d)?1:l,o.pageSize=c,p.setState({listLoading:!0},function(){return m.h.post(e,o).then(function(e){var a,i=e.data.result;i.result?(a=i.result.map(function(e){return Array.isArray(e.aspects)?e.aspects=p.cleanData(e.aspects):e.aspects=[],e}),m.h.post("feedback/find",{projectId:E.t.get(E.V.curProject).id,commentIds:a.map(function(e){return e.commentId})}).then(function(e){T.Z.hasAuthority("MESSAGE_ORDER_NO")&&m.h.post("order/find",{projectId:E.t.get(E.V.curProject).id,messageIds:a.map(function(e){return e.oid})}).then(function(e){var t=e.data,e=t.code,t=t.result;2e4===e&&0<t.length&&t.forEach(function(e,t){a[t].oids=e.oid})}).catch(function(e){console.log(e)});var t=e.data,e=t.code,n=t.result;2e4===e&&n&&(a.forEach(function(t){t.feedback=n.find(function(e){return e.commentId===t.commentId})||{status:!1,count:0,modelTime:"",submitTypes:[]}}),setTimeout(function(){p.setState({pageIndex:o.pageIndex,listLoading:!1,isLoading:!1,searchValue:s,info:r,data:a,params:o,count:{total:i.count,aspectTotal:i.aspectTotal},isInitial:!1})},1e3))})):p.setState({pageIndex:o.pageIndex,listLoading:!1,isLoading:!1,searchValue:s,info:r,data:a,params:f()({},o,{aspect:o.filterModel.opinion}),count:{total:i.count,aspectTotal:0},isInitial:!1})})}))},p.getAspects=function(e){var t=new FormData;t.append("widgetId","");var n=p.state.params.projectId;t.append("projectId",n),m.h.post("/inbox/aspect",t).then(function(e){e=JSON.parse(e.data.result);p.setState({aspects:e,selectedIndex:Object.keys(e)[0]})})},p.addAspect=function(e,t,n){p.setState({loadingId:e.commentId});var a=p.state,i=a.emotion,r=(a.data,a.info);m.h.post("inbox/messages/add",{commentId:e.commentId,index:e.index,routing:e.routing,score:i?8:3,aspect1:t,aspect2:n,flag:"aspect"}).then(function(e){p.searchTable(r),p.setState({loadingId:null})})},p.deleteAsp=function(t,e){var a=e.aspectId,n=p.state,i=n.data,r=n.info;p.setState({loadingId:t.commentId}),m.h.post("inbox/messages/delete",{id:a,commentId:t.commentId,index:t.index,routing:t.routing,flag:"aspect",originScore:e.escore,aspectName:e.aspect2}).then(function(e){i.forEach(function(n){n.commentId===t.commentId&&n.aspects.forEach(function(e,t){e.aspectId===a&&n.aspects.splice(t,1)})}),p.setState({data:i,loadingId:null},function(){return p.searchTable(r)})})},p.transformAsp=function(t,n){var e=p.state,a=(e.emotion,e.data),i=e.info,e=a.filter(function(e){return e.commentId===t.commentId}),e=e[0].aspects?e[0].aspects.filter(function(e){return e.escore===(8===n.escore?3:8)}):[],r=8===n.escore?3:8;e.some(function(e){return e.aspect2===n.aspect2})?u.Z.warning("指标已存在"):(p.setState({loadingId:t.commentId}),m.h.post("inbox/messages/update",{id:n.aspectId,index:t.index,commentId:t.commentId,routing:t.routing,score:r,flag:"aspect",originScore:n.escore,aspectName:n.aspect2}).then(function(e){a.forEach(function(e){e.commentId===t.commentId&&e.aspects.forEach(function(e){e.aspectId===n.aspectId&&(e.escore=r)})}),p.setState({data:a,loadingId:null},function(){return p.searchTable(i)})}))},p.selectChange=function(e){p.setState({selectedIndex:e})},p.renderExtend=function(n){var e=p.state,t=e.aspects,a=e.selectedIndex,i=e.emotion,r=e.isLoading,o=n.aspects.filter(function(e){return e.escore===(i?8:3)}).map(function(e){return e.aspect2});return C().createElement(Ce.X,{className:"detail-extend"},C().createElement("div",null,C().createElement(v.Select,{value:p.state.selectedIndex,onChange:p.selectChange},t&&Object.keys(t).map(function(e,t){return C().createElement(v.Select.Option,{label:e,value:e,key:e+n.commentId})})),C().createElement("i",{className:"icon-cem_delete close",onClick:function(){return p.openItem(n.commentId)}})),C().createElement("div",{className:i?"asp asp-positive":"asp asp-negative"},t&&t[a].filter(function(e){return-1===o.indexOf(e)}).map(function(e,t){return C().createElement("span",{key:t,style:{cursor:r?"not-allowed":""},onClick:function(){return r?"":p.addAspect(n,a,e)}},C().createElement("i",{className:"text"},e),C().createElement("i",{className:"hover-state"},C().createElement(Ee.l,{name:"add-to-white"})))})))},p._handleFeedbackCountChange=function(t){p.setState({data:p.state.data.map(function(e){return e.feedback.commentId===t.commentId?f()({},e,{count:t.count,feedback:t}):f()({},e,{count:t.count,feedback:f()({},e.feedback,{count:t.count})})})})},p._handleMsgClick=function(e){var t=p.props.params,n=t.dateFilter,a=t.leftName,t=t.projectId;window.open("/inbox/public?"+encodeURIComponent(JSON.stringify({dateFilter:n,filterModel:{project:[t]},projectId:t,msgId:e,filterTip:"产品洞察/"+(a||"典型意见")+"/消息详情"})))},p.renderAllMessage=function(e){var t=p.state,i=t.openItem,r=t.sourceEmotion,o=(t.params,t.loadingId),s=t.seriesName,t=t.listLoading,c=p.state.lock,l=!1;T.Z.hasAuthority("REVIEW_MESSAGE_LOCK")||(c=!0);var d=(document.documentElement.clientWidth-64-36-76-68-24-32-200)/2;return C().createElement("div",{ref:"blogs",className:"message-list"},C().createElement(v.Loading,{loading:t},0<e.length?e.map(function(e,t){var n=e;l=l||s.includes("正面")||!c;var a=Se()("asp","asp-negative",{"negative-border":l});return C().createElement(v.Loading,{loading:o===e.commentId,key:n.commentId+t},C().createElement("div",{className:"blog-container "+(c?"lock":"unlock")},C().createElement(Ce.X,{className:"blog-title"},C().createElement(Ce.J,{className:"base-info source"},C().createElement("span",{className:"source-img"},C().createElement("img",{src:n.userImage?n.userImage.startsWith("http")?n.userImage:location.protocol+"//"+n.userImage:g(13192),"data-url":n.userImage,alt:"头像"}))),C().createElement(Ce.J,{className:"base-info product"},n.username),C().createElement(Ce.J,{className:"base-info  pull-right"},!!e.oids&&"天猫"===e.sourceName&&C().createElement("span",null,"订单编号:",C().createElement("span",{className:"copyValues",onClick:function(){return(0,k.zp)("copyValues")}},e.oids),C().createElement("i",{className:"icon-fuzhi",onClick:function(){return(0,k.zp)("copyValues")},style:{color:"#7262FD",cursor:"pointer",marginRight:"10px"}})),null!=e.score&&0!==e.score&&C().createElement(v.Rate,{className:"rate",disabled:!0,key:e.score,value:e.score,colors:["#FF8373","#FF8373","#FF8373"],showText:!1}),C().createElement("span",{className:"time"},A()(n.createTime).format("YYYY-MM-DD HH:mm")),C().createElement("span",{className:"type"},n.type?n.type.substring(0,1):""))),C().createElement(Ce.X,{className:"blog-body",dangerouslySetInnerHTML:{__html:p.renderContent(n.content,n.highLight,r)}}),C().createElement(Ce.X,{className:"blog-foot detail-footer"},C().createElement(Ce.J,{className:"asp asp-positive",col:"md-6"},n.aspects.filter(function(e){return 8===e.escore}).map(function(e,t){return C().createElement("span",{key:e.aspect2},C().createElement("i",{className:"text"},e.aspect2),C().createElement("i",{className:"hover-state"},C().createElement("div",null,C().createElement(Ee.l,{name:"delete-white",onClick:function(){return p.deleteAsp(n,e)}})),C().createElement("div",null,C().createElement(Ee.l,{name:"switch-white",onClick:function(){return p.transformAsp(n,e)}}))))}),!c&&C().createElement("span",{className:"add-bar",onClick:function(){return p.openItem(n.commentId,!0)}},C().createElement(Ee.l,{name:"add-to"}))),C().createElement(Ce.J,{className:a,col:"md-6"},n.aspects.filter(function(e){return 3===e.escore}).map(function(e,t){return C().createElement("span",{key:e.aspect2},C().createElement("i",{className:"text"},e.aspect2),C().createElement("i",{className:"hover-state"},C().createElement("div",null,C().createElement(Ee.l,{name:"switch-white",onClick:function(){return p.transformAsp(n,e)}})),C().createElement("div",null,C().createElement(Ee.l,{name:"delete-white",onClick:function(){return p.deleteAsp(n,e)}}))))}),!c&&C().createElement("span",{className:"add-bar",onClick:function(){return p.openItem(n.commentId,!1)}},C().createElement(Ee.l,{name:"add-to"})))),i===n.commentId&&p.renderExtend(n),C().createElement("div",{className:"blog-body message-detail"},C().createElement("span",{className:"title line ellipsis",style:{maxWidth:d},title:n.title||""},"- "+(n.title||"")),C().createElement("div",null,C().createElement("span",{className:"source line ellipsis"},"来源：",n.sourceName),C().createElement("span",{className:"connect line ellipsis",style:{maxWidth:d},title:n.title},"链接：",n.connectionName),C().createElement("a",{href:n.url,target:"_blank",className:"line ellipsis"},"数据源"),C().createElement("span",{className:"feedback",onClick:function(){return p._handleOnFeedback(n)}},"反馈"),C().createElement(Oe.Z,{ref:function(e){return p.drawerRef=e}})))))}):C().createElement("div",{className:"no-data"},C().createElement("img",{src:g(76180)}),C().createElement("span",null,"暂无可用数据"))))},p.handleLock=function(e){p.setState({lock:!p.state.lock,openItem:null})},p.exportData=function(e){e=JSON.parse(JSON.stringify(e));e.name=e.leftName,e.leftName="",ye.Z.exportData(f()({},e,{type:"COMMENT"}),function(e){2e4===e.code?u.Z.info(e.msg+"，请到个人中心的下载列表或者点击右上角“小铃铛”下载。"):u.Z.error(e.msg)})},p.handleReset=function(){p.setState({info:void 0},function(){var e=p.props.params,t=JSON.parse(JSON.stringify(e));t.filterModel.project=[t.projectId];e="正面"===t.seriesName;p.setState({params:t,sourceEmotion:e,searchValue:""},function(){return p.searchTable(p.info)})}),p.props.resetMessage()},p.addAspectBorder=function(e){var t=document.querySelectorAll(".blog-foot")[e].children[0]&&document.querySelectorAll(".blog-foot")[e].children[0].children||[],n=document.querySelectorAll(".blog-foot")[e].children[1]&&document.querySelectorAll(".blog-foot")[e].children[1].children||[];if(0<t.length)for(var a=0;a<t.length;a++)t[a].style.borderColor="#00B76E";if(0<n.length)for(var i=0;i<n.length;i++)n[i].style.borderColor="#D96969"},p._handleOnInputChange=function(e){var t=p.state.info;p.setState({searchValue:e},function(){!e&&p.state.hasSearched&&p.setState({hasSearched:!1},function(){return p.searchTable(t)})})},p._handleSearchButtonClick=function(){var e=p.state,t=e.searchValue,n=e.params,a=e.info;a&&void 0!==a.hide&&delete a.hide,n.filterModel.content||t?p.setState({hasSearched:!0},function(){return p.searchTable(a)}):u.Z.warning("请输入搜索关键词")},p._handleOnFeedback=function(t){var e=p.props.params,n=JSON.parse(JSON.stringify(e));p.drawerRef.show({aspectList:t.aspects,callback:function(e){m.h.post("/data_feedback/save",{feedbackDetails:e,messageId:t.commentId,projectId:n.projectId,messageContent:t.content,historyTag:JSON.stringify(t.aspects.filter(function(e){return e.escore}).map(function(e){return{aspect:e.aspect2,escore:e.escore}}))}).then(function(e){2e4===e.data.code&&ve.default.success({style:{marginTop:"85px"},className:"feedback_success_message",content:C().createElement("div",{className:"feedback_success_tip"},C().createElement("img",{src:g(58476)}),C().createElement("p",null,"指标反馈成功，感谢您的反馈！"))})})}})},p.state={data:null,isLoading:!0,loadingId:null,info:void 0,searchValue:"",params:{},pageIndex:1,pageSize:20,count:{},sourceEmotion:null,emotion:"",lock:!0,listLoading:!1,aspects:null,selectedIndex:null,lastClickedTime:0,lastClickedMsgId:0,seriesName:[],hasSearched:!1,isInitial:!0,mParams:void 0},p}o()(e,t);var n=e.prototype;return n.cleanData=function(n){for(var e=[],t=0;t<n.length;t++)!function(t){e.some(function(e){return n[t].aspect1===e.aspect1&&n[t].aspect2===e.aspect2&&n[t].escore===e.escore})||e.push(n[t])}(t);return e},n.renderContent=function(e,t,n){var a=this.state.params,a=a.filterModel.content&&a.filterModel.content[0]&&a.filterModel.content[0].contain;if(a&&0<a.length){var i=e;return a.forEach(function(e){var t=new RegExp(e,"g");i=i.replace(t,'<a class="highlight-yellow">'+e+"</a>")}),i}if(!t||!e)return e;var t=t.split(",").map(function(e){return(e=e.split("-"))[1]=Number(e[0])+Number(e[1]),e}).sort(function(e,t){return t[1]-e[1]}),r=e.split(""),o=n?'<a class="highlight-green">':'<a class="highlight-red">';return t.forEach(function(e){r.splice(e[0],0,o),r.splice(e[1]+1,0,"<a/>")}),r.join("")},n.componentWillMount=function(){var e,t=this.props.params,n=this.state.seriesName;t?((e=JSON.parse(JSON.stringify(t))).filterModel.project=[e.projectId],t="正面"===e.seriesName,n.push(e.seriesName),this.setState({params:e,sourceEmotion:t,seriesName:n})):this.setState({params:{},sourceEmotion:"",seriesName:""})},n.componentDidMount=function(){this.props.params&&this.searchTable(this.state.info)},n.UNSAFE_componentWillReceiveProps=function(e){var t=e.params,n=this.state.seriesName;t&&((e=JSON.parse(JSON.stringify(t))).filterModel.project=[e.projectId],t="正面"===e.seriesName,n.push(e.seriesName),this.setState({params:e,sourceEmotion:t,seriesName:n}))},n.removeAspectBorder=function(e){var t=document.querySelectorAll(".blog-foot")[e].children[0]&&document.querySelectorAll(".blog-foot")[e].children[0].children||[],n=document.querySelectorAll(".blog-foot")[e].children[1]&&document.querySelectorAll(".blog-foot")[e].children[1].children||[];if(0<t.length)for(var a=0;a<t.length;a++)t[a].style.borderColor="transparent";if(0<n.length)for(var i=0;i<n.length;i++)n[i].style.borderColor="transparent"},n.render=function(){var t=this,e=this.state,n=e.params,a=e.data,i=(e.isLoading,e.pageIndex),r=e.count,o=e.pageSize,s=e.info,c=e.searchValue,l=e.mParams,d=this.props.type;this.state.lock;T.Z.hasAuthority("REVIEW_MESSAGE_LOCK");var u=!(!s||!s.opinion&&!s.hide),e="";return l?(log("试一试"),e=l.from+" ~ "+l.to):s?s.opinion?e=s.opinion:s.content?e=s.content[0].contain[0]:s.time&&(l=(0,k.LV)(s.time,"WEEK"),e="WEEK"===s.type?l.from+" ~ "+l.to:n.dateFilter.from+" ~ "+n.dateFilter.to):n.dateFilter&&(e=n.dateFilter.from+" ~ "+n.dateFilter.to),C().createElement("div",{className:"message-detail-wrapper"},C().createElement("div",{className:"message-top"},C().createElement("div",{className:"left"},C().createElement("span",{style:{marginLeft:5,fontSize:14}},"消息详情"),e&&C().createElement("div",{style:{display:"inline-block"}},C().createElement("span",null,e),C().createElement("span",{onClick:this.handleReset},"清除选择"))),C().createElement("div",{className:"total"},4!==d||r.total&&!r.aspectTotal?C().createElement("span",null,"共",C().createElement("i",null," ",r.total||0," "),"条消息"):C().createElement("span",null,"共",C().createElement("i",null," ",r.total," "),"条消息，",C().createElement("i",null," ",r.aspectTotal," "),"个【",n.aspect,"】",n.seriesName,"指标")),C().createElement("div",{className:"right"},C().createElement(v.Input,{value:c,disabled:u,className:"keyword-input-wrapper "+(u?"disable":""),onKeyDown:function(e){u||13!==e.keyCode||t._handleSearchButtonClick()},placeholder:"请输入关键词",onChange:this._handleOnInputChange,append:C().createElement("i",{onClick:u?void 0:this._handleSearchButtonClick,className:"icon-cem_search "+(u?"disable":"")})}),T.Z.hasAuthority("DATA_DOWNLOAD")&&C().createElement(Q.Z,{options:ke,onClick:function(e){return"excel"===e&&t.exportData(n)}}))),a&&this.renderAllMessage(a),!!r.total&&C().createElement("div",{className:"pager-container"},C().createElement(v.Pagination,{pageSize:o,className:"pagination",small:!0,total:r.total,layout:"prev, pager, next",currentPage:i,onCurrentChange:this.getPageTable})))},e}(d.Component),be=[{type:"sImage",title:"导出图片"},{type:"sExcel",title:"导出数据"}],Te=[{type:"wImage",title:"导出图片"},{type:"wExcel",title:"导出数据"}];const Ie=function(e){var t=e.getScallterChartRef,n=e.getWordcloudChartRef,a=e.onChartClick,i=e.onMoreClick,r=e.onChartMouseOut,o=e.onChartMouseOver,s=e.wcLoading,c=e.loading,l=e.onWordcloudChartFinish,d=e.data,u=d.sOption,e=d.wOption,d=d.chartData;return C().createElement("div",{className:"opinion-chart-wrapper"},C().createElement("div",{className:"scatter"},C().createElement(v.Loading,{loading:s||c,text:"拼命加载中",style:{height:"100%",width:"100%"}},d.wordAgeList&&0<d.wordAgeList.length?C().createElement(C().Fragment,null,C().createElement(oe.Z,{option:u,style:{height:"100%"},theme:"yunting_multi_color",onChartReady:t,onEvents:{mouseout:r,mouseover:o}}),C().createElement("div",{className:"tip"},C().createElement(v.Popover,{width:"376",trigger:"hover",content:"该图表为您显示选中的消息中的词的新旧程度和火热程度，您可以从中更直观的了解用户的关注点的出现时间和关注程度。基于机器学习算法，系统会对消息进行分词处理。对于每一个分出来的词，系统会计算其第一次存在系统中的时长——即词龄，词龄可以标识该词的新旧程度，尤其是词龄较小的词一般是新创建出来的词汇或者近期流行的词汇。同时，系统会统计具体词出现的次数——词频，词频可以标识该词的火热程度。",popperClass:"card_pop"},C().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),C().createElement("div",{className:"buttons"},C().createElement(Q.Z,{onClick:i,options:be}))):C().createElement("div",{className:"no-data"},C().createElement("img",{src:g(76180)}),C().createElement("span",null,"暂无可用数据")))),C().createElement("div",{className:"wordcloud"},C().createElement(v.Loading,{loading:s||c,text:"拼命加载中",style:{height:"100%",width:"100%"}},d.list&&0<d.list.length?C().createElement(C().Fragment,null,C().createElement(oe.Z,{option:e,style:{height:"100%",width:"100%"},theme:"yunting_multi_color",onChartReady:n,onEvents:{click:a,mouseout:r,mouseover:o,finished:l}}),C().createElement("div",{className:"buttons"},C().createElement(Q.Z,{onClick:i,options:Te}))):C().createElement("div",{className:"no-data"},C().createElement("img",{src:g(76180)}),C().createElement("span",null,"暂无可用数据")))))};n=function(t){function e(e){var o=t.call(this,e)||this;return o._resize=function(){o.scatterChartRef&&o.scatterChartRef.resize()},o._fetchData=function(){var e=o.props,t=e.detail,e=e.params;t&&t.projectId&&o.props.fetchWordData(f()({projectId:t.projectId,taskId:t.taskId,filterType:"OPINION_TASK"},e))},o._handleOnMoreClick=function(e){var t,n=o.props.data.chartData;"sImage"===e?(0,X._v)(o.scatterChartRef,"词龄-词频散点图"):"wImage"===e?(0,X._v)(o.wordcloudChartRef,"词云图"):"sExcel"===e?(t=n.wordAgeList.reduce(function(e,t){return[].concat(e,[[t.keyword,t.age,t.count]])},[["词名","词龄","词频"]]),(0,X.aT)([t],"词龄-词频散点图")):"wExcel"===e&&(n=n.list.reduce(function(e,t){return[].concat(e,[[t.name,t.total]])},[["词名","词频"]]),(0,X.aT)([n],"词龄-词频散点图"))},o._handleOnChartClick=function(e){var t,n=e.componentType,a=e.componentSubType,i=e.data.name,e=o.state.selectedWordName,r=o.props.refreshMessage;"series"===n&&"wordCloud"===a&&(t=void 0,e&&e===i?o.dispatchEchartsAction(o.wordcloudChartRef,"downplay",""):(t=i,o.dispatchEchartsAction(o.wordcloudChartRef,"highlight",""),o.dispatchEchartsAction(o.wordcloudChartRef,"downplay",i)),o.setState({selectedWordName:t},function(){i&&(o.clickTimeId&&clearInterval(o.clickTimeId),o.clickTimeId=setTimeout(function(){r({hide:!!t,content:[{contain:[t?i:""]}]}),o.clickTimeId=void 0},100))}))},o._handleOnChartMouseOut=function(e){var t=e.componentType,n=e.componentSubType,a=e.name,e=o.state.selectedWordName;"series"===t&&"wordCloud"===n?(o.dispatchTooltipAction(o.scatterChartRef,"hideTip",a),e&&e!==a&&o.dispatchEchartsAction(o.wordcloudChartRef,"highlight",a)):"series"===t&&"scatter"===n&&o.dispatchTooltipAction(o.wordcloudChartRef,"hideTip",a)},o._handleOnChartMouseOver=function(e){var t=e.componentType,n=e.componentSubType,e=e.name;"series"===t&&"wordCloud"===n?(o.dispatchEchartsAction(o.wordcloudChartRef,"downplay",e),o.dispatchTooltipAction(o.scatterChartRef,"showTip",e),o.dispatchEchartsAction(o.wordcloudChartRef,"downplay",e)):"series"===t&&"scatter"===n&&o.dispatchTooltipAction(o.wordcloudChartRef,"showTip",e)},o.reset=function(){var e=o.state.selectedWordName;e&&o._handleOnChartClick({componentType:"series",componentSubType:"wordCloud",data:{name:e}})},o.dispatchEchartsAction=function(t,n,a){setTimeout(function(){var e={type:n,seriesName:"opinionWordCloud"};a&&(e.name=a),t.dispatchAction(e)},0)},o.dispatchTooltipAction=function(e,t,n){setTimeout(function(){e.dispatchAction({type:t,name:n,seriesIndex:0})},0)},o._handleOnWordcloudChartFinish=function(){o.wcTimeoutId&&clearTimeout(o.wcTimeoutId),o.wcTimeoutId=setTimeout(function(){o.setState({wcLoading:!1}),o.wcTimeoutId=void 0},100)},o.scatterChartRef=void 0,o.wordcloudChartRef=void 0,o.wcTimeoutId=void 0,o.event={onMoreClick:o._handleOnMoreClick,onChartClick:o._handleOnChartClick,onChartMouseOut:o._handleOnChartMouseOut,onChartMouseOver:o._handleOnChartMouseOver,onChartReady:o._handleOnChartReady,onWordcloudChartFinish:o._handleOnWordcloudChartFinish,getScallterChartRef:function(e){return o.scatterChartRef=e},getWordcloudChartRef:function(e){return o.wordcloudChartRef=e}},o.state={selectedWordName:void 0,wcLoading:!0,loading:!0},o}o()(e,t);var n=e.prototype;return n.clearLoading=function(){this.setState({wcLoading:!1,loading:!1})},n.startLoading=function(){this.setState({wcLoading:!0,loading:!0})},n.componentDidMount=function(){this._fetchData(),window.addEventListener("resize",this._resize)},n.componentWillUnmount=function(){var e=this.props.resetData;window.removeEventListener("resize",this._resize),e({topChartData:{chartData:[],sOption:{},wOption:{}}})},n.componentDidUpdate=function(e){var t,n,a;e.fetchWordDataEffecting&&!this.props.fetchWordDataEffecting&&(t=this.state.wcLoading,n=(a=this.props.data.chartData).wordAgeList,a=a.list,this.setState({loading:!1,wcLoading:(0!==n.length||0!==a.length)&&t})),JSON.stringify(e.detail)!==JSON.stringify(this.props.detail)&&this._fetchData()},n.render=function(){return C().createElement(Ie,f()({},this.state,this.props,this.event,this.ref))},e}(C().PureComponent);const we=(0,t.connect)(function(e){var t=e.detail,e=e.loading;return{data:t.topChartData,fetchWordDataEffecting:e.effects["detail/fetchWordData"]||!1}},function(t){return{fetchWordData:function(e){return t({type:"detail/fetchWordData",payload:e})},resetData:function(e){return t({type:"detail/save",payload:e})}}},null,{withRef:!0})(n);function xe(e){if(0<Object.keys(e).length){var t=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach(function(e){t[e]||delete t[e]}),delete t.aspect,t}return{}}var De=g(97911),Le=function(t){function e(e){var s=t.call(this,e)||this;return s.changeState=function(e){s.setState(e,function(){s.updateFilter()})},s.clickCheckbox=function(e){var t=e.aspect1,n=e.aspect2,a=s.state.limit;a&&(t&&t.length>a||n&&n.length>a)?u.Z.warning("当前条件下最多支持选择"+a+"个分析指标"):s.setState(e)},s.clickEmotion=function(e){s.setState({emotion:e})},s.updateFilter=function(){var e=s.state.aspectType,t=s.state,n=t.aspect1,t=t.aspect2;e&&n&&0<n.length?t=[]:0<t.length&&(n=[]),s.setState({aspect1:n,aspect2:t})},s.clickCancelBtn=function(){s.state.aspectShow&&s.props.closePanel()},s.orderAspect=function(e){for(var t=s.state.aspectList,n=[],a=[],i=0;i<t.length;i++){for(var r=!1,o=0;o<e.length;o++)if(t[i].name===e[o]){r=!0,n[o]=t[i];break}r||a.push(t[i])}s.setState({aspectList:n.concat(a)})},s.toggleCheckAll=function(){var e=s.state,t=e.aspect2CheckStatus.allChecked,n=e.allAspect2,e=[];t||(e=JSON.parse(JSON.stringify(n))),s.setState({aspect2:e,aspect2CheckStatus:{allChecked:!t,indeterminate:!1}})},s.handleClickAspect2=function(e){var t=s.state.allAspect2;s.clickCheckbox({aspect2:e}),s.setState({aspect2CheckStatus:{allChecked:t.length===e.length&&0<e.length,indeterminate:0!==e.length&&t.length!==e.length}})},s.state={aspectShow:!1,aspectType:!0,aspect1:[],aspect2:[],emotion:[],rawAspectList:[],aspectList:[],projectId:e.projectId,model:e.model,ready:!1,limit:e.limit,panelWidth:e.panelWidth,allAspect2:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}},s}o()(e,t);var n=e.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){var t=e.aspectShow,n=e.limit,e=e.panelWidth;this.setState({aspectShow:t,limit:n,panelWidth:e})},n.componentDidMount=function(){this.getValue(),window.addEventListener("click",this.clickCancelBtn)},n.componentDidUpdate=function(){this.setLeftBlockHeight()},n.componentWillUnmount=function(){window.removeEventListener("click",this.clickCancelBtn)},n.setLeftBlockHeight=function(){var e=document.querySelectorAll(".analyse-aspect-panel-body .left .new-checkbox-panel .wt-checkbox-group .wt-checkbox"),t=document.querySelectorAll(".analyse-aspect-panel-body .right .new-checkbox-panel .wt-checkbox-group"),n=document.querySelector(".analyse-aspect-panel-body .right");if(document.querySelector(".analyse-aspect-panel-body .emotion").style.height=n.offsetHeight+"px",e.forEach(function(e){return e.style.marginBottom="0"}),0<t.length)for(var a=t.length-1;0<=a;a--){var i=t[a].offsetHeight;36<i&&(e[a].style.marginBottom=i-36+"px")}},n.getValue=function(){var e=this.state,t=e.aspectType,n=e.aspect1,a=e.aspect2,i=e.emotion;if(e.ready)return{aspect1:t?n:[],aspect2:t?[]:a,emotion:function(e){if(Array.isArray(e)){var t=[];return e.includes("正面情感")&&t.push("positive"),e.includes("负面情感")&&t.push("negative"),t}return[]}(i)};a=this.props,i=a.projectId,a=a.model;this.fetchAspects(i,a)},n.getSndIndex=function(e){e=this.state.aspects[e];return e&&0<e.length&&this.setState({aspectType:!1,aspect1:[],aspect2:e}),e},n.setAspectFromOutside=function(e){var t=this.state.allAspect2,n=e.aspect1,a=e.aspect2,i=e.emotion;e&&this.setState(f()({aspectType:0<n.length},e,{emotion:i&&function(e){if(Array.isArray(e)){var t=[];return e.includes("positive")&&t.push("正面情感"),e.includes("negative")&&t.push("负面情感"),t}return[]}(i),aspect2CheckStatus:{allChecked:t.length===a.length&&0<a.length,indeterminate:0!==a.length&&t.length!==a.length}}))},n.fetchAspects=function(n,a){var i=this,e=a.map(function(e){return m.h.post("filter/find",{filterTypes:["ASPECT"],projectId:n,type:e})});Promise.all(e).then(function(e){e.forEach(function(e){var t=e.data.result,e=i.state.rawAspectList;t.aspect&&i.setState({projectId:n,model:a,rawAspectList:e.concat(t.aspect)})}),i.formatData()})},n.formatData=function(){var n,a,e,t=this.state,i=t.model,r=t.aspect1,o=t.aspect2,s=t.rawAspectList,c=(t.limit,this.state),t=c.aspectShow,c=c.aspectType,s=s,l={};"BRAND"===i?(n=s.map(function(e){return e&&JSON.parse(e)}),(i=0)<=(a=T.Z.getAuthority()).indexOf("ANALYZE_PRODUCT")&&i++,0<=a.indexOf("ANALYZE_SERVER")&&i++,0<=a.indexOf("ANALYZE_MARKETING")&&i++,0===i?n.forEach(function(e){Object.keys(e).forEach(function(e,t){return l[t]=e})}):1===i?["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].forEach(function(e,t){0<=a.indexOf(e)&&Object.keys(n[t]).map(function(e,t){return l[t]=e})}):1<i&&(0<=a.indexOf("ANALYZE_PRODUCT")&&(1===(i=Object.keys(n[0])).length?l["产品"]=n[0][i[0]]:1<i.length&&(l["产品"]=n[0])),0<=a.indexOf("ANALYZE_SERVER")&&(1===(e=Object.keys(n[1])).length?l["服务"]=n[1][e[0]]:1<e.length&&(l["服务"]=n[1])),0<=a.indexOf("ANALYZE_MARKETING")&&(1===(e=Object.keys(n[2])).length?l["市场"]=n[2][e[0]]:1<e.length&&(l["市场"]=n[2])))):s&&s[0]&&s.forEach(function(e){l=Object.assign.apply(Object,[l].concat(JSON.parse(e)))});s=Object.keys(l).map(function(e,t){var a=l[e];return{id:t,name:e,contain:a.length?a:Object.keys(a).map(function(e,t){var n=a[e];return{id:t,name:e,contain:n.length?n:Object.keys(n)}})}});s.length<=1&&(c=t=!1);var d=[];Object.keys(l).forEach(function(e){d=d.concat(l[e])}),this.changeState({aspectList:s,aspectShow:t,aspects:l,aspectType:c,aspect1:r,aspect2:o,ready:!0,allAspect2:d})},n.handleClickBlock=function(e,t){var n=this.state,a=n.aspectType;n.aspectShow&&a!==e&&(n=document.querySelectorAll(".analyse-aspect-panel-body div"),a="disabled",e?this.hanldeClass("remove",n[1],a):this.hanldeClass("remove",n[0],a),e?this.setState({aspectType:e,aspect2:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}}):this.setState({aspectType:e,aspect1:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}}))},n.hanldeClass=function(e,t,n){("add"===e?(0,w.addClass):(0,w.removeClass))(t,n)},n.clickConfirmBtn=function(){this.props.onChange(),this.props.closePanel()},n.clearOptions=function(){this.setState({aspect1:[],aspect2:[],emotion:[],aspect2CheckStatus:{allChecked:!1,indeterminate:!1}})},n.render=function(){var n=this,e=this.state,t=e.aspectList,a=e.aspectType,i=e.aspect1,r=e.aspect2,o=e.emotion,s=e.aspectShow,c=e.limit,l=e.panelWidth,d=e.aspect2CheckStatus,e=d.allChecked,d=d.indeterminate;return C().createElement("div",{className:"opinion-analyse-aspect-panel-wrapper",style:{display:s?"block":"none",width:l},onClick:function(e){return e.stopPropagation()}},C().createElement("div",{className:"analyse-aspect-panel-body"},C().createElement("div",{className:"emotion"},C().createElement(De.Z,{changeState:function(e){return n.clickEmotion(e)},checkedList:o,ITEMS:["正面情感","负面情感"].map(function(e){return e.name||e}),categoryTitle:"全部情感",type:"vertical"})),C().createElement("div",{className:a?"left":"left disabled",onClick:function(e){return n.handleClickBlock(!0,e)}},C().createElement(De.Z,{changeState:function(e){return n.clickCheckbox({aspect1:e})},checkedList:i,ITEMS:t.map(function(e){return e.name||e}),categoryTitle:"一级指标",type:"vertical",limit:c})),C().createElement("div",{className:a?"right disabled":"right",onClick:function(e){return n.handleClickBlock(!1,e)}},C().createElement("div",null,C().createElement(W.Jg,{checked:e,indeterminate:d,onChange:this.toggleCheckAll},"二级指标")),0<t.length&&t.map(function(e,t){return C().createElement(De.Z,{changeState:n.handleClickAspect2,checkedList:JSON.parse(JSON.stringify(r)),key:"aspect1-"+t,categoryTitle:e.name,ITEMS:e.contain.map(function(e){return e.name||e}),type:"horizontal",limit:c})}))),C().createElement("div",{className:"analyse-aspect-panel-footer"},C().createElement("span",{onClick:function(){return n.clearOptions()}},"清空全部选项"),C().createElement("div",null,C().createElement(v.Button,{type:"primary",onClick:function(){return n.clickConfirmBtn()}},"确定"),C().createElement("span",{className:"cancelBtn",onClick:function(){return n.clickCancelBtn()}},"取消"))))},e}(C().Component),Ae=function(n){function e(e){var t=n.call(this,e)||this;return t.closePanel=function(){t.setState({showPanel:!1})},t.state={showPanel:!1},t}o()(e,n);var t=e.prototype;return t.togglePanel=function(e){var t=this,n=this.state.showPanel;n&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){return t.setState({showPanel:!n})},0)},t.getValue=function(){if(this.panel)return this.panel.getValue()},t.getSndIndex=function(e){return this.panel.getSndIndex(e)},t.setAspectFromOutside=function(e){return this.panel.setAspectFromOutside(e)},t.orderAspect=function(e){this.panel.orderAspect(e)},t.render=function(){var t=this,e=this.state.showPanel;return C().createElement("div",{className:"opinion-analyse-aspect-wrapper"},C().createElement("div",{className:"analyse-aspect-trigger",style:{color:e?"#0847A6":"#8C8C8C"},onClick:function(e){return t.togglePanel(e)}},C().createElement("span",null,"指标情感"),C().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:e?"rotate(-180deg)":"",color:e?"#0847A6":"#8C8C8C"}})),C().createElement(Le,f()({ref:function(e){t.panel=e},aspectShow:e,closePanel:this.closePanel},this.props)))},e}(C().Component),Fe=function(n){function e(e){var t=n.call(this,e)||this;return t.handleAnalyseAspectChange=function(){var e=t.analyseAspect.getValue();t.setState(f()({},e)),t.props.onAspectChange(JSON.parse(JSON.stringify(e)))},t.state={aspect:e.aspect,opinionTotal:e.opinionTotal,messageTotal:e.messageTotal},t}o()(e,n);var t=e.prototype;return t.componentDidMount=function(){var e=this.state.aspect;this.analyseAspect&&this.analyseAspect.setAspectFromOutside(e)},t.UNSAFE_componentWillReceiveProps=function(e){var t=this.props.aspect,n=e.aspect;JSON.stringify(t)!==JSON.stringify(n)&&this.analyseAspect&&this.analyseAspect.setAspectFromOutside(n),this.setState(f()({},e))},t.render=function(){var t=this,e=this.state,n=e.opinionTotal,a=e.messageTotal,e=E.t.get(E.V.curProject).id;return C().createElement("div",{className:"cards-wrapper"},C().createElement("div",{className:"card"},C().createElement("div",{style:{textAlign:"center",fontWeight:"bold"}},C().createElement("span",{className:"card-content"},C().createElement("span",null,"消息数："),C().createElement("span",null,k.ZP.formatNumber(a))),C().createElement(v.Popover,{width:"300",trigger:"hover",content:"该数据为您显示：符合头部筛选、时间范围和分析对象的指标情感的有效消息数。",popperClass:"card_pop"},C().createElement("i",{className:"icon-cem_file1",style:{marginLeft:"8px",fontSize:"18px",color:"#8c8c8c"}})))),C().createElement("div",{className:"card"},C().createElement("div",{style:{textAlign:"center",fontWeight:"bold"}},C().createElement("span",{className:"card-content"},C().createElement("span",null,"观点数："),C().createElement("span",null,k.ZP.formatNumber(n))),C().createElement(v.Popover,{width:"376",trigger:"hover",content:"该数据为您显示：选中的消息数中包含的观点数。在一个有效评论中，用户会表达至少1个观点。如评论【服务好，质量好，讲解到位。】，这里表述了3个观点。基于我们的典型意见算法，我们会将依据用户的表述将一个消息细化处理为观点。",popperClass:"card_pop"},C().createElement("i",{className:"icon-cem_file1",style:{marginLeft:"8px",fontSize:"18px",color:"#8c8c8c"}})))),C().createElement("div",{className:"card"},C().createElement("div",null,C().createElement(Ae,{ref:function(e){return t.analyseAspect=e},limit:null,model:["PRODUCT","MARKETING","SERVICE"],projectId:e,onChange:this.handleAnalyseAspectChange}))))},e}(d.PureComponent),_e=g(55815),n=function(n){function e(e){var h=n.call(this,e)||this;h.fetchOpinionDetail=function(e){var l=h.props.dispatch;l({type:"opinionChart/reset"});var d=E.t.get(E.V.curProject).id;m.h.post("/user/opinion/find",f()({},e)).then(function(e){var t=e.data;if(2e4===t.code){var n=t.result,a=n.id,i=n.name,r=(n.sequence,n.date),e=n.filter,o=n.messageTotal,s=n.opinionTotal,c=n.status;if(!r||!e)return h.opinionChart&&h.opinionChart.getWrappedInstance().clearLoading(),void l({type:"opinionChart/save",payload:{loading:!1}});e&&!e.aspect&&(e.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]});r=function(e){if(e){var t=JSON.parse(JSON.stringify(e)),n=t.quickChoice;if(-1!==t.quickChoice.indexOf("-"))return t;e=j.indexOf(n),n=L(e),e=n[0],n=n[1];return f()({},t,{from:e,to:n})}}(r);h.setState({type:2,params:{projectId:d,taskId:a||"",leftName:"",analyseName:"",type:"EMOTION_ASPECT_LEVEL_BAR",aspect:"",aspectTotal:o||0,seriesName:"",dateFilter:r,filterModel:e||{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}}},detail:{projectId:d,taskId:a,taskName:window.location.host.substr(0,1).toUpperCase()+"-"+t.result.sequence},currOpinonObj:{id:a,name:i,messageTotal:o,opinionTotal:s,status:c,filter:{filterModel:e||{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:r},mode:a&&!i?"save":"rename"}},function(){var e=20<=s&&50<=o&&o<=5e5&&"DISABLE"!==c,t=0;e||(s<20?t=1:o<50?t=2:5e5<o&&(t=3)),l({type:"opinionChart/save",payload:{opinionTaskValid:e,invalidReason:t,refreshing:e&&"FINISH"!==c,messageTotal:o,reloaded:e}}),e&&l({type:"opinionChart/resetClusterOptions"}),h.refreshData()})}})},h.createOpinionTask=function(l){var d=h.props.dispatch,e=h.state,u=(e.currOpinonObj,e.type),p=e.detail;d({type:"opinionChart/reset"}),4!==u&&p.taskId&&h.opinionChart&&h.opinionChart.getWrappedInstance().startLoading(),l.filterModel.aspect||(l.filterModel.aspect={aspect1:[],aspect2:[],emotion:["positive","negative"]}),m.h.post("/opinion/add",f()({projectId:E.t.get(E.V.curProject).id,filterType:"OPINION_TASK"},l,{temp:4===u?"1":""})).then(function(e){var t,n,a,i,r,o,s,c;2e4===e.data.code&&e.data.result&&(t=h.state.currOpinonObj,n=(c=e.data.result).id,a=c.messageTotal,i=c.opinionTotal,c.name,r=c.sequence,o=c.status,s=c.filter,e=c.date,c=3===u?f()({},h.state.params,{taskId:n,filterModel:l.taskId?s:l.filterModel,dateFilter:l.taskId?e:l.dateFilter,aspectTotal:i}):f()({},h.state.params,{taskId:n}),l.taskId&&(t.filter={filterModel:s,dateFilter:e}),h.setState({currOpinonObj:f()({},t,{status:o,id:n,sequence:r,messageTotal:a,opinionTotal:i}),params:c,detail:f()({},p,{taskId:n})},function(){if(h.refreshData(!0),"FINISH"===o)return d({type:"opinionChart/save",payload:{opinionTaskValid:!0,invalidReason:0,refreshing:!1,clusterType:20,messageTotal:a,loading:!0}}),void setTimeout(function(){d({type:"opinionChart/getWordCloudList"})},200);var e=20<=i&&50<=a&&a<=5e5&&"DISABLE"!==o,t=0;e||(i<20?t=1:a<50?t=2:5e5<a&&(t=3)),d({type:"opinionChart/save",payload:{opinionTaskValid:e,invalidReason:t,refreshing:e&&"FINISH"!==o,clusterType:20,messageTotal:a,loading:e&&"FINISH"!==o}})}))})},h.onFilterChange=function(){var e=h.state,t=e.currOpinonObj,n=e.params,a=e.type,i={filterModel:xe(n.filterModel),dateFilter:(r=n.dateFilter)?{from:r.from,to:r.to,quickChoice:r.quickChoice,dateGroupType:r.dateGroupType,remoteName:r.remoteName}:null};delete i.filterModel.aspect;var e=h.filter&&h.filter.getValue(),r=e.filterModel,e=e.dateFilter;O(i,{filterModel:xe(r),dateFilter:e})||(t.changed=!0,t.mode=1===a?"save":"update",a=n.filterModel.aspect,h.createOpinionTask({filterModel:f()({aspect:a},r),dateFilter:e}),n.dateFilter=e,n.filterModel=f()({aspect:a},r),t.filter={dateFilter:e,filterModel:f()({aspect:a},r)},h.setState({currOpinonObj:t,params:n}))},h.handleOnFilterReady=function(){},h.onAspectChange=function(e){var t=h.state,n=t.currOpinonObj,a=t.params,i=t.params,r=i.filterModel,i=i.dateFilter,t=t.type;O(e,n.filter.filterModel.aspect)||((r=JSON.parse(JSON.stringify(r))).aspect=e,n.changed=!0,n.mode=1===t?"save":"update",n.filter.filterModel=r,a.filterModel=r,h.createOpinionTask({filterModel:r,dateFilter:i}),h.setState({currOpinonObj:n,params:a}))},h.refreshData=function(e){var t=h.state,n=t.detail,a=t.params,i=t.type,t=h.props.dispatch;4!==i&&n.taskId&&t({type:"detail/fetchWordData",payload:f()({projectId:n.projectId,taskId:n.taskId,filterType:"OPINION_TASK"},a)}),4===i||e||t({type:"opinionChart/getWordCloudList"}),h.message.searchTable()},h.refreshMenuList=function(){return(0,h.props.dispatch)({type:"menu/fetchMenuList"})},h.updateCurrOpinonObj=function(e){var t=h.state.currOpinonObj;e?h.setState({currOpinonObj:e}):(t.mode="update",h.setState({currOpinonObj:t}))};var t=4,e=location.pathname;return e.startsWith("/opinion")&&(t=3===e.split("/").length?2:location.search?3:1),h.state={params:{analyseName:"",aspect:"",aspectTotal:0,leftName:"",projectId:E.t.get(E.V.curProject)&&E.t.get(E.V.curProject).id||"",seriesName:"",taskId:"",type:"EMOTION_ASPECT_LEVEL_BAR",filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},detail:{projectId:"",taskId:"",taskName:""},type:t,currOpinonObj:{id:"",name:"",status:status,filter:{filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},messageTotal:0,opinionTotal:0,changed:!1,mode:"update"}},h}o()(e,n);var t=e.prototype;return t.componentDidMount=function(){var e,t,n,a,i,r,o,s=this,c=E.t.get(E.V.curProject).id,l=decodeURIComponent(window.location.search).substr(1),d=location.pathname;console.log({pathName:d}),d.startsWith("/opinion")?3===d.split("/").length?(e=d.split("/")[2],this.fetchOpinionDetail({id:e})):(d=location.search,location.search?(e=d.indexOf("id=")+3,a=d.indexOf("&"),t=d.substring(e,a),(a=this.state.currOpinonObj).changed=!0,this.setState({type:3,currOpinonObj:a},function(){return s.createOpinionTask({taskId:t,filterModel:{},dateFilter:{}})})):this.fetchOpinionDetail({projectId:c})):(n=this.props.dispatch,a=JSON.parse(l),i=a.filterModel,r=a.dateFilter,o=!1,(c=E.t.get(E.V.opinionDetail))&&c.uri&&c.uri===l&&(o=!0,l=(c=E.t.get(E.V.opinionDetail)).data[20],a.taskId=c.taskId,n({type:"opinionChart/save",payload:{hasRecord:!0,allData:c.data,json_word:l,loading:!1}})),this.setState({params:a,type:4},function(){o?s.message.searchTable():(s.createOpinionTask({filterModel:i,dateFilter:r}),n({type:"opinionChart/save",payload:{loading:!0}}))}))},t.render=function(){var t=this,e=this.state,n=e.params,a=e.detail,i=e.currOpinonObj,r=e.currOpinonObj,o=r.messageTotal,s=r.opinionTotal,c=(r.filter,r.filter.filterModel.aspect),l=e.type,r=n&&n.filterModel||{},e=n&&n.dateFilter||null;return C().createElement("div",{className:"detail-wrapper"},4!==l&&C().createElement(d.Fragment,null,C().createElement(U,{ref:function(e){return t.filter=e},model:"MARKETING",title:"典型意见",values:4!==l?{dateFilter:e,filterModel:JSON.parse(JSON.stringify(function(e){if(!e.analysis)return e;var t=JSON.parse(JSON.stringify(e)),n=t.analysis,a=n.id,e=n.type,i=n.values;switch(e){case"CONN_CONFIG":t.connConfig=[{id:a,special:"connConfig",values:i}];break;case"SOURCE":t.source=i}return t}(r)))}:{},showList:["condition","time","opinion"],filterCondition:Object.assign({filter:["CONN_CONFIG","SOURCE","TAG","EXPAND_TOPIC"],filterConfig:["KEY_WORD","ESCORE"]}),currOpinonObj:JSON.parse(JSON.stringify(i)),onChange:this.onFilterChange,onFilterReady:this.handleOnFilterReady,refreshMenuList:this.refreshMenuList,updateCurrOpinonObj:this.updateCurrOpinonObj}),C().createElement(Fe,{messageTotal:o,opinionTotal:s,aspect:JSON.parse(JSON.stringify(c)),onAspectChange:this.onAspectChange})),4===l&&C().createElement(_e.Z,{title:"详情："+n.analyseName+"，"+n.aspect+"，"+n.seriesName}),C().createElement("div",{className:4!==l?"content-sidebar":"content"},4!==l&&C().createElement(we,{ref:function(e){return t.opinionChart=e},detail:a,params:{filterModel:r,dateFilter:e},refreshMessage:function(e){t.detailChart&&t.detailChart.getWrappedInstance().resetWordcloudState(),t.message&&t.message.searchTable(e)}}),C().createElement(fe,{params:n,taskId:i.id&&i.id||n.taskId,ref:function(e){return t.detailChart=e},type:l,refreshMessage:function(e){t.opinionChart&&t.opinionChart.getWrappedInstance().reset(),t.message&&t.message.searchTable(e)}}),C().createElement(Ne,{params:n,ref:function(e){return t.message=e},resetMessage:function(){t.detailChart&&t.detailChart.getWrappedInstance().resetWordcloudState(),t.detailChart&&t.detailChart.getWrappedInstance().resetBarchartState(),t.opinionChart&&t.opinionChart.getWrappedInstance().reset()},type:l})))},e}(d.Component);const je=(0,t.connect)()(n)},97911:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(85354),i=n.n(t),t=n(67294),c=n.n(t),l=n(85151),o=n(5133),a=function(a){function e(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(r=a.call.apply(a,[this].concat(t))||this).handleCheckedAll=function(e){var t=r.props,n=t.ITEMS,a=t.changeState,t=t.checkedList,i=[];e.target.checked?(t.map(function(e){return i.push(e)}),n.filter(function(e){return i.indexOf(e)<0}).map(function(e){return i.push(e)})):t.filter(function(e){return n.indexOf(e)<0}).map(function(e){return i.push(e)}),a&&a(i)},r.handleChange=function(e){var t=r.props,n=t.changeState,a=t.checkedList,t=t.limit;Array.prototype.remove=function(e){e=this.indexOf(e);-1<e&&this.splice(e,1)},t?-1===a.indexOf(e)?a.length<t?a.push(e):o.Z.warning("当前条件下最多支持选择"+t+"个分析指标"):a.remove(e):-1===a.indexOf(e)?a.push(e):a.remove(e),n&&n(a)},r}return i()(e,a),e.prototype.render=function(){var t=this,e=this.props,n=e.ITEMS,a=e.categoryTitle,i=e.titles,r=e.checkedList,o=e.type,s=(e.limit,r.filter(function(e){return 0<=n.indexOf(e)})),e=!!s.length&&s.length===n.length,s=!!s.length&&s.length!==n.length;return c().createElement("div",{className:"vertical"===o?"new-checkbox-panel new-checkbox-panel-vertical":"new-checkbox-panel"},c().createElement(l.Jg,{checked:e,indeterminate:s,onChange:this.handleCheckedAll},a||"全选"),c().createElement(l.CS,{checkedList:r,onChange:function(e){return t.handleChange(e)}},n&&n.map(function(e,t){return c().createElement(l.Jg,{key:t,value:e},i?i[e]:e)})))},e}(t.Component)},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(67154),u=n.n(a),i=n(37316),p=n.n(i),t=n(85354),r=n.n(t),a=n(67294),h=n.n(a),i=n(45697),t=n.n(i),i=n(94184),f=n.n(i),a=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,i=e.block,r=e.indeterminate,o=e.value,s=e.checked,c=e.defaultChecked,l=e.onChange,d=e.disabled,e=p()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),l={value:o,checked:s,defaultChecked:c,onChange:l,disabled:d},a=f()(t,((d={})[t+"-disabled"]=l.disabled,d[t+"-block"]=i,d[t+"-indeterminate"]=r,d),a);return h().createElement("label",u()({tabIndex:l.disabled?-1:0,className:a},e),h().createElement("input",u()({type:"checkbox",className:t+"-input"},l)),h().createElement("span",{className:t+"-status"}),n&&h().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const o=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>s});var a=n(24473),i=n(67154),c=n.n(i),r=n(37316),l=n.n(r),t=n(85354),o=n.n(t),i=n(67294),d=n.n(i),r=n(45697),t=n.n(r),r=n(94184),u=n.n(r),r=function(i){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=i.call.apply(i,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return o()(e,i),e.prototype.render=function(){var i=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,r=(e.onChange,e.values),o=e.checkedList,s=e.block,e=l()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=r?r.map(function(e,t){var n=0!==o.length&&-1!==o.indexOf(e);return d().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return i.handleCheckBoxChange(e)},block:s},e)}):d().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==o.length&&-1!==o.indexOf(a);return d().cloneElement(e,{checked:a,key:t,block:n.block||s,onChange:function(){var e=n.value;i.handleCheckBoxChange(e)}})}});return d().createElement("div",c()({className:u()(t,a)},e),n)},e}(i.Component);r.defaultProps={prefixCls:"wt-checkbox-group"},r.propTypes={onChange:t().func,values:t().array,block:t().bool};const s=r;var p=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},i=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=p(e);return d().createElement("label",{className:e.className,title:e.children},d().createElement("div",{className:"checkbox"},d().createElement("input",c()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),d().createElement("div",{className:"checkbox-body"}))," ",d().createElement("span",null,e.children))},t}(i.Component);i.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},66746:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var t=n(16049),u=n(1825),t=n(89858),p=n(51024),t=n(7940),h=n(31059),t=n(1025),f=n(65400),t=n(75314),o=n(11187),t=n(85354),a=n.n(t),t=n(67294),m=n.n(t),c=n(87219);const i=function(t){function e(e){var s=t.call(this,e)||this;return s.show=function(e){var t=e.aspectList,e=e.callback;s.setState({visible:!0,aspectList:t}),s.callback=e},s._handleOnClose=function(){s.setState({visible:!1,aspectList:void 0,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:""},function(){s.callback=void 0})},s._handleOnConfigConfirm=function(){var e=s.state,t=e.moreChecked,n=e.moreContent,a=e.errorChecked,i=e.errorContent,r=e.lessChecked,o=e.lessContent,e=[];t&&n.length?e.push({feedbackType:"ASPECT_TOO_MANY",feedbackContent:JSON.stringify(n.filter(function(e){return e.escore}))}):e.filter(function(e){return"ASPECT_TOO_MANY"!==e.feedbackType}),a&&i.length?e.push({feedbackType:"EMOTION_WRONG",feedbackContent:JSON.stringify(i.filter(function(e){return e.escore}))}):e.filter(function(e){return"EMOTION_WRONG"!==e.feedbackType}),r?e.push({feedbackType:"ASPECT_NOT_ENOUGH",feedbackContent:o}):e.filter(function(e){return"ASPECT_NOT_ENOUGH"!==e.feedbackType}),s.callback&&s.callback(e),s._handleOnClose()},s._handleOnChange=function(e,t){var n;s.setState(((n={})[t+"Checked"]=e,n)),(t.includes("more")&&!e||t.includes("error")&&!e)&&s.state[t+"Content"]&&s.state[t+"Content"].length&&s.setState(((e={})[t+"Content"]=[],e))},s._handleOnInputChange=function(e){1e3===e.target.value.trim().length&&s.setState({lessTips:"最多输入1000字"}),s.setState({lessContent:e.target.value.trim().substring(0,1e3)})},s._handleOnClickAspect=function(t,n,e){var a=s.state,i=a.moreContent,a=a.errorContent,r="more"===e?i:a,i=(0,c.ZP)(r,function(e){return r.find(function(e){return JSON.stringify(e)===JSON.stringify({aspect:t,escore:n})})?(1===r.length&&o.default.warning("至少保留一个指标选项"),e.filter(function(e){return JSON.stringify(e)!==JSON.stringify({aspect:t,escore:n})})):void e.push({aspect:t,escore:n})});s.setState(((a={})[e+"Content"]=i,a))},s.callback=void 0,s.state={visible:!1,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:"",aspectList:void 0},s}return a()(e,t),e.prototype.render=function(){var n=this,e=this.state,t=e.visible,a=e.moreChecked,i=e.moreContent,r=e.errorChecked,o=e.errorContent,s=e.lessChecked,c=e.aspectList,l=e.lessContent,d=e.lessTips;return m().createElement(u.Z,{title:"我要反馈",placement:"right",width:372,onClose:this._handleOnClose,visible:t,footer:m().createElement("div",{style:{float:"right"}},m().createElement(f.default,{onClick:this._handleOnClose},"取消"),m().createElement(f.default,{disabled:a&&r&&!s&&!i.length&&!o.length||a&&!r&&!s&&!i.length||r&&!a&&!s&&!o.length||!a&&!r&&!s,type:"primary",onClick:this._handleOnConfigConfirm},"确定"))},m().createElement("div",{className:"yt_aspect_feedback_drawer"},c&&c.length?m().createElement("div",{className:"item"},m().createElement(h.default,{checked:a,onChange:function(e){return n._handleOnChange(e.target.checked,"more")}},"多了指标"),m().createElement("div",{className:"feedback_content"},a&&c.map(function(t,e){return m().createElement("span",{key:e,className:8===t.escore?"positive":"negative",onClick:function(){return n._handleOnClickAspect(t.aspect2,t.escore,"more")}},m().createElement("i",{className:"icon-cem_big-gou",style:{display:i.find(function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})})?"inline":"none"}}),t.aspect2)}))):null,c&&c.length?m().createElement("div",{className:"item"},m().createElement(h.default,{checked:r,onChange:function(e){return n._handleOnChange(e.target.checked,"error")}},"情感有误"),m().createElement("div",{className:"feedback_content"},r&&c.map(function(t,e){return m().createElement("span",{key:e,className:8===t.escore?"positive":"negative",onClick:function(){return n._handleOnClickAspect(t.aspect2,t.escore,"error")}},m().createElement("i",{className:"icon-cem_big-gou",style:{display:o.find(function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})})?"inline":"none"}}),t.aspect2)}))):null,m().createElement(h.default,{checked:s,onChange:function(e){return n._handleOnChange(e.target.checked,"less")}},"少了指标"),s&&m().createElement("div",{className:"item"},m().createElement("p",null,"对应的文本或缺失指标说明"),m().createElement(p.default.TextArea,{className:d?"border_err":"",autoSize:{minRows:3,maxRows:13},placeholder:"请输入",onFocus:function(e){d&&n.setState({lessTips:""})},onBlur:function(e){d&&n.setState({lessTips:""})},maxLength:1e3,value:l,onChange:this._handleOnInputChange}),d&&m().createElement("div",{className:"tips"},d))))},e}(m().PureComponent)}}]);