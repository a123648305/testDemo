(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5945],{47303:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});const n=a.p+"html-b9e36b"},58476:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});const n=a.p+"html-c6a1e8"},76180:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});const n=a.p+"html-459a43"},13192:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});const n=a.p+"html-aa245f"},78436:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(85354),i=n.n(t),t=n(67294),r=n.n(t),o=n(94644),a=function(e){function t(){var r=e.call(this)||this;return r.isEmpty=!0,r.group=function(e){r.myChart.group=e,r.echarts.connect(e)},r.refreshChart=function(e){r.setState(e)},r.setWidth=function(e){r.refs.chart.style.width=e,r.init()},r.loading=function(){r.myChart.clear(),r.myChart.showLoading({text:"拼命加载中",color:"#20a0ff",maskColor:"rgba(255, 255, 255, 0.9)",zlevel:0})},r.setOption=function(e){if(e.textStyle={fontFamily:"'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif"},e.legend&&(e.legend.data=e.legend.data.map(function(e){return{name:e,icon:"circle"}}),e.legend.itemWidth=10,e.legend.itemHeight=10),e.tooltip&&!e.tooltip.extraCssText?(e.tooltip.backgroundColor="rgba(255,255,255,0.9)",e.tooltip.textStyle={color:"#262626"},e.tooltip.extraCssText="box-shadow: 0 0 7px rgba(0, 0, 0, 0.3);"):e.tooltip&&(e.tooltip=e.tooltip),e.series.forEach(function(e){"line"===e.type&&(e.showAllSymbol=!0,e.symbol="circle",e.symbolSize=2,e.itemStyle={normal:{borderColor:"rgba(255,255,255,0)",borderWidth:5}})}),e.hoverLayerThreshold=500,e.progressiveThreshold=500,e.animationThreshold=500,r.myChart){var t;r.myChart.clear(),r.myChart.hideLoading();for(var a=arguments.length,n=new Array(1<a?a-1:0),i=1;i<a;i++)n[i-1]=arguments[i];(t=r.myChart).setOption.apply(t,[e].concat(n)),r.isEmpty=!1}},r.setEmptyOption=function(e){var t=r.myChart.getHeight(),a=r.myChart.getWidth(),a=Math.min(t/2,a/2,20),a={type:"pie",radius:[0,0],center:["50%","50%"],silent:!0,data:[{value:0,name:"",label:{normal:{show:!0,position:"center",backgroundColor:{image:n(76180)},padding:a,formatter:function(){return""}}}},{value:0,name:"",label:{normal:{show:!0,position:"center",formatter:function(){return"{a|\n}{b|"+e+"}"},rich:{a:{height:a+60},b:{fontSize:20,color:"#999"}}}}}]};r.myChart&&(r.myChart.clear(),r.myChart.hideLoading(),r.myChart.setOption({series:a,animation:!1},!0),r.isEmpty=!0)},r.init=function(){r.echarts.getInstanceByDom(r.refs.chart)&&r.echarts.dispose(r.refs.chart);var e=r.echarts.init(r.refs.chart);r.myChart=e,r.props.myChartClick&&e.on("click",function(e){r.isEmpty||r.props.myChartClick(e)}),r.props.dataZoomChange&&e.on("dataZoom",function(e){r.isEmpty||r.props.dataZoomChange(e)})},r.downloadExcel=function(e,t){(0,o.aT)([[t].concat(e)],"")},r.echarts=n(70596),r}i()(t,e);var a=t.prototype;return a.componentDidMount=function(){this.init()},a.componentWillUnmount=function(){this.myChart.dispose()},a.render=function(){var e=this.props.minHeight,e=Object.assign({},e?{minHeight:e}:{});return r().createElement("div",{ref:"chart",className:"widget-chart",style:e})},t}(t.Component)},55945:(e,t,E)=>{"use strict";E.r(t),E.d(t,{default:()=>oe});var a=E(37316),n=E.n(a),m=(E(30467),E(55673)),g=(E(58136),E(5789)),f=(E(89626),E(70302)),y=(E(45673),E(8448)),i=E(67154),v=E.n(i),r=E(85354),o=E.n(r),t=(E(23461),E(53740)),a=E(50361),h=E.n(a),c=E(67294),T=E.n(c),N=E(43036),k=(E(9405),E(89552)),i=E(93913),s=E.n(i),r=E(81506),u=E.n(r),C=E(36144);const l={fetchWidgetList:function(e,t){C.h.post("/widget/list",e).then(function(e){t&&t(e.data.result)})},fetchWidgetTemp:function(e,t){C.h.get("/widget/temp/find?type="+e).then(function(e){t&&t(e.data.result)})},fetchWidgetTempById:function(e,t){C.h.get("/widget/edit_temp/find?id="+e).then(function(e){t&&t(e.data.result)})},addWidget:function(e,t){C.h.post("dashboard/widget/add",e).then(function(e){t&&t(e.data.result)})},searchData:function(e,t){C.h.post("/widget/data/find",e).then(function(e){t&&t(e.data.result)},function(e){t&&t(e.data.result)})},fetchProjectTopics:function(e,t){C.h.post("/widget/project_topics/find",e).then(function(e){t&&t(e.data.result)})},editWidget:function(e,t){C.h.post("/widget/edit",e).then(function(e){t&&t(e.data.result)})},findModel:function(e,t){C.h.get("/widget/model/list?project="+e.project).then(function(e){t&&t(e.data.result)})},exportData:function(e,t){C.h.post("/data/export",e).then(function(e){t&&t(e.data)})},findMessage:function(e,t){C.h.post("/widget/aspect/find",e).then(function(e){t&&t(e.data.result)})},findAspectLabel:function(e,t){C.h.post("/widget/aspectLabel",e).then(function(e){t&&t(e.data.result)})},downloadPrice:function(e,t){C.h.post("/data/price/export",e).then(function(e){t&&t(e.data)})}};function w(e,t){return e?e/1e4<1?e:e/1e8<1?(e/1e4).toFixed(t||0)+"万":(e/1e8).toFixed(t||0)+"亿":0}var d=E(78436),O=E(70715);function S(e){var t,a,i,r;if(arguments.length<1)return 1;for(t=1,a=arguments.length;t<a;t++)if(i=[],r=[],!function e(t,a){if(isNaN(t)&&isNaN(a)&&"number"==typeof t&&"number"==typeof a)return 1;if(t===a)return 1;if("function"==typeof t&&"function"==typeof a||t instanceof Date&&a instanceof Date||t instanceof RegExp&&a instanceof RegExp||t instanceof String&&a instanceof String||t instanceof Number&&a instanceof Number)return t.toString()===a.toString();if(t instanceof Object&&a instanceof Object&&!t.isPrototypeOf(a)&&!a.isPrototypeOf(t)&&t.constructor===a.constructor&&t.prototype===a.prototype&&!(-1<i.indexOf(t)||-1<r.indexOf(a))){for(var n in a){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return;if(typeof a[n]!=typeof t[n])return}for(n in t){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return;if(typeof a[n]!=typeof t[n])return;switch(typeof t[n]){case"object":case"function":if(i.push(t),r.push(a),!e(t[n],a[n]))return;i.pop(),r.pop();break;default:if(t[n]!==a[n])return}}return 1}}(e,arguments[t]))return;return 1}E(89777);var b=function(n){function e(){for(var p,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(p=n.call.apply(n,[this].concat(t))||this).colors={normal:["#5B8FF9","#60DDA9","#F6BD15","#F08A8A","#78D3F8","#65789B","#F6903D","#028685","#7262FD","#9661BC"],emotion:["#15B374","#1574B3","#D96969"],aspect:["#15B374","#D96969"]},p.state={title:p.props.name||"",canEdit:p.props.canEdit||!1,showTitle:!1!==p.props.showTitle,toolbox:["image","data"],json:null},p.resetState=function(){-1!==p.state.selectIndex&&p.setState({selectIndex:-1},function(){p.buildChart()})},p.getChartData=function(){var e;p.refs.chart&&p.refs.chart.myChart&&(e=p.refs.chart.myChart.getOption().series[0].data.map(function(e){return[e.name,e.value]}),p.downloadExcel({titles:["词语","数量"],data:e}))},p.buildChart=function(){var e=p.props.index,t=document.getElementsByClassName("widget-chart")[e];if(t&&2<t.childElementCount)for(var a=document.createElement("span"),n=1;n<t.childElementCount;n++)t.childNodes[n].replaceWith(a);var i,r,o,s=p.state,l=s.colors,c=s.selectIndex,d=p.props.json;d?p.props.loading||("string"!=typeof(d="string"!=typeof d&&0===d.length?"没有数据可用":d)?(o=p.refs.chart.myChart,p.jsonStr===JSON.stringify(d)?o.resize():p.jsonStr=JSON.stringify(d),i=o.getHeight(),e=o.getWidth(),r=0,d=d.filter(function(e){return e}),s=Math.min(4,Math.max.apply(Math,d.map(function(e){return e.value}))),d&&d.map(function(e){return r+=14*e.name.length*14*e.value*e.value}),o=Math.floor(14*d[0].count*Math.sqrt(14*s*(i*e)/r)),o=.9*Math.min(i,e/s,o,114),(o={type:"wordCloud",sizeRange:[14,80],rotationRange:[0,0],gridSize:12,textPadding:10,width:"80%",height:"80%",textStyle:{normal:{color:function(e){var t=l[e.dataIndex%l.length];return-1===c||c===e.dataIndex?t:"#D2D2D2"}}}}).data=d.map(function(e){return{name:e.name,value:Math.sqrt(e.value),originValue:e.value}}),u()(p),o={title:{text:"典型意见",top:16,left:24,textStyle:{color:"#262626",fontSize:14,fontFamily:""+O.I8,fontWeight:"bold"}},tooltip:{padding:[16,12],backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",textStyle:{fontSize:12,color:"#262626"},extraCssText:"border-radius: 2px;\n        box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",formatter:function(e){var t=e.marker,a=e.name,e=e.data;return"<span>"+t+" "+a+'<span style="padding-left:46px">'+w(e.originValue,2)+"</span></span>"}},grid:{top:0,bottom:0,left:0,right:0},series:[o]},p.refs.chart.setOption(o,!0)):p.refs.chart.setEmptyOption(d)):p.refs.chart.loading()},p.myChartClick=function(e){var t=e.dataIndex===p.state.selectIndex?void 0:e,e=e.dataIndex===p.state.selectIndex?-1:e.dataIndex;p.setState({selectIndex:e},function(){p.buildChart()}),p.props.myChartClick(t,e)},p.getParams=function(){},p.buildBody=function(){return T().createElement(d.Z,{ref:"chart",className:"widget-chart",myChartClick:p.myChartClick})},p.refreshChart=function(e){e&&(p.projectId=e.projectId,p.type=e.type,p.time=e.time);var t=p.getParams();t?((e=v()({},t)).projectId=p.projectId,e.type=p.type,((t=p.props.id)||p.projectId)&&(p.setState({json:null}),l.searchData(v()({id:t},e),function(e){var t;e?e.indexOf("{")<0&&e.indexOf("[")<0?t=e:(t=JSON.parse(e)).forEach&&0===t.length&&(t="没有可用数据"):t="没有可用数据",p.setState({json:t,time:+new Date})}))):p.setState({json:"没有可用数据",time:+new Date})},p}o()(e,n);var t=e.prototype;return t.UNSAFE_componentWillReceiveProps=function(e){var t=e.json,e=e.activeOpinionIndex;this.setState({json:t,selectIndex:e})},t.UNSAFE_componentWillMount=function(){this.setState({colors:this.colors.normal,selectIndex:this.props.activeOpinionIndex})},t.componentDidUpdate=function(){this.buildChart()},t.componentDidMount=function(){this.width=this.refs.widget.offsetWidth,this.height=this.refs.widget.offsetHeight,window.addEventListener("resize",this.buildChart),this.state.json?this.buildChart():this.refreshChart()},t.componentWillUnmount=function(){window.removeEventListener("resize",this.buildChart)},t.render=function(){return T().createElement("div",{ref:"widget",className:this.isCanSetting?"widget-container with-aspect-bar":"widget-container"},this.buildBody())},e}(c.Component),I=(E(43378),E(62443)),_=E(92360);const x=function(e){var t=e.getRef,a=e.title,n=e.list,i=e.loading,o=e.optionPage,s=e.activeOpinionIndex,l=e.multiColorsPositive,c=e.isAllColors,d=e.buildNum,p=e.renderWordOverlay,u=e.handleMyWordChartClick,e=e.handleOnOptionWordListPageChange;return T().createElement(T().Fragment,null,T().createElement("div",{className:"oppion-word",ref:t},T().createElement("div",{className:"word-title"},a),T().createElement("div",{className:"list"},0!==n.length||i?n.slice(40*(o-1),40*o).map(function(e,t,a){var n=40*(o-1)+t+1,i=n<=10?c?l[e.pos]:l[n%l.length]:c?l[e.pos]:"#8c8c8c",r=/(^[1-9]\d*$)/.test(a.length/10)?10:a.length-10*(a.length/10|0);return T().createElement("div",{key:n,className:a.length-t<=r?"back":"",style:{width:"calc("+(a.length<=30?20<a.length?33:50:25)+"% - 48px)"}},e?T().createElement(I.default,{overlayClassName:"popover-detail-wrodcloud-list-wrapper",placement:"top",content:p(e.name,i)},T().createElement("span",{className:"option-item "+(!1===s||s<0||n-1===s?"":"inactive-option-item"),onClick:function(){u(e,n-1)}},T().createElement("span",null,T().createElement("span",{style:{backgroundColor:""+i}},n)),T().createElement("span",null,e.name),T().createElement("span",null,d(e.value||e.hotWordFix,2)),e.ratio&&T().createElement("span",null,"("+e.ratio+")"))):null)}):T().createElement("div",{className:"no-data"},T().createElement("img",{src:E(76180)}),T().createElement("span",null,"没有数据可用"))),40<n.length?T().createElement(_.Pagination,{className:"oppion-word-pagination",layout:"prev, pager, next",total:n.length,pageSize:40,currentPage:o,small:!0,onCurrentChange:e}):null))};var W=E(94644),M=E(60496),a=E(30381),p=E.n(a);const D=function(e){var t=e.time,a=(e.updateTime,e.descriptions),n=e.stop,i=e.handleOverTime,r=(0,c.useState)(p()()),o=r[0],s=r[1],e=(0,c.useState)(o&&o.diff(p()(t),"minutes")),r=e[0],l=e[1];return(0,c.useEffect)(function(){!0===n&&clearInterval(e);var e=window.setInterval(function(){return s(p()())},1e3);return function(){clearInterval(e)}},[n,r]),(0,c.useEffect)(function(){l(o.diff(p()(t),"minutes")),i(o.diff(p()(t),"minutes")||1)},[o]),T().createElement(T().Fragment,null,a(0<r||-60<=p()(t).diff(o,"seconds")&&p()(t).diff(o,"seconds")<0,r,r<0?p()(t).diff(o,"minutes"):p()(t).diff(o,"seconds"),0<=r&&r<1?"秒":"分钟"))};var i=E(55609),P=E(68096),r=E(64396),j=r.Z.opinion.opinionChart,F=r.Z.opinion.detail,R=P.O9.normal,L={DAY:"天",WEEK:"周",MONTH:"月"},a=function(t){function e(e){var p=t.call(this,e)||this;return p._handleOnWsMessage=function(e){var t,a,n,i=e.data;i.type&&"ws"===i.type&&(t=(n=p.props).resetData,a=n.handleMessageTotal,e=n.params,i=(n=i.payload).type,n=n.result,"OPINION_TASK_RESULT"===i&&(n&&n.data&&e.messageTotal<5e3&&p.setState({status:"FINISH"}),n.taskId===e.taskId&&5e3<=e.messageTotal&&(t(n.taskId),p.setState({status:"FINISH"})),p.props.dispatch({type:j+"/handleOpinion",payload:n})),"OPINION_TASK_RESULT_FINAL"===i&&n.taskId===e.taskId&&a({messageTotal:n.messageTotal,opinionTotal:n.opinionTotal}))},p.changeChart=function(e){e=e.clusterType;(0,p.props.dispatch)({type:j+"/save",payload:{wordCloud:"0"===e}}),p.setState({chartType:e})},p.myChartClick=function(e){var t=p.props,a=(t.json_bar,t.clusterType),n=t.queryParams.dateFilter,i=n.from,t=n.to,n=p.state.dateType,r=null;e&&e.name?r={time:e.name,type:n,sideType:e.sideType,sideTime:"first"===e.sideType?i:"last"===e.sideType?t:""}:e&&e.analysis&&(r={analysis:e.analysis}),r.clusterType=a,p.clickTimeId&&clearTimeout(p.clickTimeId),p.clickTimeId=setTimeout(function(){p.props.refreshMessage(r),p.refs.wordCloud&&p.refs.wordCloud.resetState(),p.clickTimeId=void 0},1e3)},p.resetWordcloudState=function(){setTimeout(function(){p.refs.wordCloud&&p.refs.wordCloud.resetState(),p.setState({activeOpinionIndex:-1,activeOpinionName:""})},0)},p.resetBarchartState=function(){setTimeout(function(){p.refs.bar&&p.refs.bar.resetChartRender()},0)},p.handleMyWordChartClick=function(a,n){var e=p.props,i=e.queryTimeType,r=e.clusterType,o=e.dispatch,s=e.params,l=(e.textRankWord,e.baseType),c=e.refreshOtherChart,d=p.state.activeOpinionIndex;p.setState({activeOpinionIndex:d===n||-1===n?-1:n,activeOpinionName:d===n||-1===n?"":a.name},function(){var e=a?{opinion:d===n?{}:a.name,type:i,clusterType:r}:null,t=e&&e.opinion?l||"typicalOpinion":"textRankWord"===l?l:"";"typicalOpinion"!==t&&t||c(),"typicalOpinion"!==t&&t||o({type:F+"/fetchWordData",payload:{projectId:s.projectId,enablePos:!0,headerFilterParamsNew:s.headerFilterParamsNew,messageCategory:"COMMENT",topSize:100,dateFilter:s.dateFilter,filterModel:s.filterModel,typicalOpinion:d===n||-1===n?"":a.name}}),p.props.refreshMessage(e||{opinion:{}}),o({type:F+"/save",payload:{typicalOpinion:d===n||-1===n?"":a.name,optionPage:1}}),o({type:j+"/save",payload:{baseType:t}}),p.clickTimeId&&clearTimeout(p.clickTimeId),p.clickTimeId=setTimeout(function(){p.refs.bar&&p.refs.bar.resetState(),p.clickTimeId=void 0},100)})},p.onWindowResize=function(){setTimeout(function(){p.resize()},300)},p.resize=function(){var e;p.flexWrapper&&(e=p.flexWrapper.offsetWidth*p.rate,p.flexSpan.style.fontSize=e+"px"),p.refs.bar&&p.refs.bar.refs.chart.myChart.resize()},p.changeQueryTime=function(e){e.name;var t=e.id,a=p.props,e=a.queryParams,a=a.dispatch,e=JSON.parse(JSON.stringify(e));e.dateFilter.dateGroupType=t,p.setState({dateType:t}),a({type:j+"/save",payload:{queryTimeType:t,queryParams:e}})},p.renderOpinionOverlay=function(){return T().createElement("div",null,"针对消息文本中的观点做聚类形成典型意见，聚类颗粒度的粗细会影响典型意见的展示数量，颗粒度越细展示的数量越多度来查看更多典型意见。典型意见形成步骤：①从消息中抽取观点→②对观点聚类→③抽取中心观点。")},p._handleMoreClick=function(e){var t=p.props,a=t.json_word,n=t.json_bar,i=t.queryTimeType,t=t.wordCloud;"wImage"===e?t?(0,W._v)(p.refs.wordCloud.refs.chart.myChart,"典型意见"):(0,W.Mx)(p.state.wordTable,"典型意见"):"bImage"===e?(0,W._v)(p.refs.bar.refs.chart.myChart,"数据趋势"):"bExcel"===e?(i=n.reduce(function(e,t){return[].concat(e,[[t.time,t.count]])},[["日期/按"+L[i],"词频"]]),(0,W.aT)([i],"数据趋势")):"wExcel"===e&&(a=a.reduce(function(e,t){return t?[].concat(e,[[t.name,t.value,t.percent+"%"]]):e},[["典型意见","观点数","占比"]]),(0,W.aT)([a],"典型意见"))},p._handleCommonChange=function(e){var t=p.props,a=t.dispatch,n=t.refreshing,i=t.reloaded,r=t.allData,o=t.type,e=(t.hasRecord,e.clusterType);n&&3!==o&&!i||4===o?(r=r[e],a({type:j+"/save",payload:{clusterType:e,json_word:r,optionPage:1}})):(a({type:j+"/save",payload:{clusterType:e,optionPage:1}}),a({type:j+"/getWordCloudList"})),p.setState({optionPage:1})},p.renderWordOverlay=function(t){return T().createElement("div",{className:"opinion-tooltip",onClick:function(e){e.stopPropagation()}},T().createElement("span",null,t),T().createElement("span",{className:"hide",onClick:function(e){p._handleWordHideClick(t)}},"隐藏"))},p._handleWordHideClick=function(t){var e=p.props,a=e.json_word,n=e.dispatch,e=a.filter(function(e){return e&&e.name!==t}),e=(Math.ceil(a.length/40),[].concat(e));V(e),n({type:j+"/save",payload:{json_word:e}})},p._handleOnOptionWordListPageChange=function(e){p.props.dispatch({type:j+"/save",payload:{optionPage:e}})},p._handleUpdateClick=function(e){var t=p.props,a=t.dispatch,n=t.params,i=t.resetData;a({type:j+"/taskUpdate",payload:{id:e}}).then(function(e){e&&i(n.taskId)})},p._handleResetSelected=function(){p.setState({activeOpinionIndex:-1,activeOpinionName:""})},p.state={activeOpinionName:"",activeOpinionIndex:-1,dateType:"DAY",chartType:void 0,wordTable:void 0,predictTime:void 0,status:void 0},p}o()(e,t);var a=e.prototype;return a.componentDidMount=function(){var e=this.props,t=e.type,a=e.dispatch,n=e.opinion,i=(e.hasRecord,e.taskId),r=e.params;0<location.search.length&&"/tab/detail"===location.pathname&&(e=JSON.parse(decodeURIComponent(location.search).split("?")[1]),a({type:j+"/save",payload:{queryParams:e,queryTimeType:e.dateFilter.dateGroupType,type:t,currTaskId:i,otherTaskId:r.otherTaskId}})),!n||2!==t&&3!==t||a({type:j+"/getWordCloudList"}),this.flexWrapper&&(a=this.flexWrapper.offsetWidth,this.rate=.03,this.flexSpan.style.fontSize=a*this.rate+"px")},a.UNSAFE_componentWillReceiveProps=function(e,t){var a=this.props,n=a.dispatch,i=(a.opinion,this.props.taskId),r=e.taskId,o=this.props.params.otherTaskId,a=e.params.otherTaskId;i===r&&o===a||n({type:j+"/save",payload:{currTaskId:r,otherTaskId:a}}),this.props.type!==e.type&&n({type:j+"/save",payload:{type:e.type}}),JSON.stringify(this.props.params)!==JSON.stringify(e.params)&&n({type:j+"/save",payload:{queryParams:e.params,queryTimeType:e.params.dateFilter&&e.params.dateFilter.dateGroupType||"DAY"}})},a.componentWillMount=function(){(0,this.props.dispatch)({type:j+"/save",payload:{count:0,average:0,json_bar:"没有数据可用",json_word:[]}}),window.addEventListener("message",this._handleOnWsMessage)},a.componentWillUnmount=function(){window.removeEventListener("message",this._handleOnWsMessage)},a.shouldComponentUpdate=function(e,t){var a=this.props,n=a.clusterType,i=a.json_word,r=a.json_bar,o=a.opinionTaskValid,s=a.queryTimeType,l=a.refreshing,c=a.wordCloud,d=a.allData,p=a.loading,u=a.defaultValues,h=a.params,m=a.optionPage,f=e.clusterType,g=e.json_word,y=e.json_bar,v=e.opinionTaskValid,C=e.queryTimeType,O=e.refreshing,E=e.wordCloud,T=e.allData,N=e.loading,k=e.defaultValues,a=e.params,e=e.optionPage;if(!(n===f&&o===v&&s===C&&l===O&&c===E&&p===N&&m===e&&S(i,g)&&S(r,y)&&S(d,T)&&S(u,k)&&S(h,a)))return!0;u=this.state,k=u.activeOpinionIndex,h=u.activeOpinionName,a=u.predictTime,u=u.status;return k!==t.activeOpinionIndex||h!==t.activeOpinionName||a!==t.predictTime||u!==t.status},a.componentDidUpdate=function(e){var t=this.props.json_word,a=e.json_word,e=this.state.activeOpinionName;!S(t,a)&&e&&this.setState({activeOpinionIndex:t.map(function(e){return e&&e.name}).indexOf(e)})},a.render=function(){var t=this,e=this.props,a=e.type,n=e.wordCloud,i=(e.json_bar,e.average,e.queryTimeType,e.json_word),r=(e.queryParams,e.opinion),o=e.clusterType,s=e.refreshing,l=(e.allData,e.opinionTaskValid),c=e.invalidReason,d=(e.hasRecord,e.clusterTypeOptions),p=e.wordSelectOpts,u=e.loading,h=e.params,m=e.handleDefaultValue,f=e.defaultValues,g=e.optionPage,y=f.clusterType,v=this.state,e=v.activeOpinionIndex,f=v.chartType,v=v.status;return T().createElement("div",{className:"detailChart"},r&&T().createElement("div",{className:"detailChart-bottom"},T().createElement(k.default,{wrapperClassName:"chart-table",spinning:u,tip:"正在加载中",size:"large"},i?l?0<i.length?n?T().createElement(b,{index:4===a?1:0,ref:"wordCloud",json:i,activeOpinionIndex:e,myChartClick:this.handleMyWordChartClick}):T().createElement(x,{getRef:function(e){return t.setState({wordTable:e})},title:"典型意见",list:i.filter(function(e){return e}),optionPage:g,activeOpinionIndex:e,multiColorsPositive:R,buildNum:w,renderWordOverlay:this.renderWordOverlay,handleMyWordChartClick:this.handleMyWordChartClick,handleOnOptionWordListPageChange:this._handleOnOptionWordListPageChange}):T().createElement("div",{className:"no-data"},T().createElement("img",{src:E(76180)}),T().createElement("span",null,"暂无数据")):T().createElement("div",{className:"no-data"},0!==c&&T().createElement(T().Fragment,null,T().createElement("img",{src:E(47303),style:{width:"80px"}}),T().createElement("span",null,"当前",1===c?"消息中少于20个观点":2===c?"小于50条消息":"大于50万观点数","，已超上限，无法计算典型意见"))):null),i&&T().createElement(T().Fragment,null,(0===i.length||u)&&T().createElement("div",{className:"t-title"},"典型意见"),T().createElement(N.Z,{placement:"top",overlayStyle:{maxWidth:236},overlay:this.renderOpinionOverlay()},T().createElement("div",{className:"tip"},T().createElement("i",{className:"icon-cem_file1"}))),T().createElement("div",{className:"buttons"},T().createElement("span",{className:"clustering"},T().createElement("span",{className:s?"":"disapper"},"聚类颗粒："),T().createElement(M.Z,{activeObj:o,onChange:this._handleCommonChange,options:d,objName:"clusterType",rightHook:!0})),T().createElement(M.Z,{className:"chartType "+(f?"set_Top_active":""),activeObj:f||y||"0",flavor:y||"0",onFlavorChange:m,onChange:this.changeChart,options:p,objName:"clusterType",rightHook:!0}),T().createElement(N.Z,{overlay:"导出数据",placement:"top",mouseEnterDelay:.6},T().createElement("i",{className:"icon-daochu",onClick:function(){return t._handleMoreClick("wExcel")}})),T().createElement(N.Z,{overlay:"导出图片",placement:"top",mouseEnterDelay:.6},T().createElement("i",{className:"icon-xiazaitupian",onClick:function(){return t._handleMoreClick("wImage")}})))),l&&T().createElement(T().Fragment,null,h.status&&-1<h.status.indexOf("CALCULATING")&&!v&&T().createElement("div",{className:"chartTip"},T().createElement(D,{time:h.predictTime,descriptions:function(e,t,a,n){return e?T().createElement("span",{className:"timeTip"},5e3<h.messageTotal?"当前展示的是最新5000条消息的典型意见结果，计算所有消息的结果":"","已超时",t||1,"分钟，请耐心等待"):T().createElement("span",{className:"timeTip"},5e3<h.messageTotal?"先计算最新的5000条消息，":"","预计",a,n,"后可查看",5e3<h.messageTotal?"所有消息的典型意见":"","结果")},handleOverTime:function(e){return 60<e&&t.setState({status:"FAILURE"})}}),T().createElement("i",{className:"icon-cem_auto-refresh refresh-animation",style:{color:"#7262FD"}})),(h.status&&-1<h.status.indexOf("FAILURE")||"FAILURE"===v)&&T().createElement("p",{className:"chartTip"},"当前展示的是最新5000条消息的典型意见结果，系统计算全部消息的典型意见结果失败，请重新计算",T().createElement("i",{className:"icon-cem_auto-refresh",style:{color:"#7262FD",marginLeft:4,cursor:"pointer"},onClick:function(){return t._handleUpdateClick(h.taskId)}})))))},s()(e,[{key:"formatterData",get:function(){var e=this.props.count,t=String(e);if(3<t.length){var a=t.split(""),n="",i=a.length,t=i-(3+(i%3==0?3:i%3));3<=t&&t<6&&6<i?n="K":6<=t&&(n="M");for(var r=0,o=i;0<o;o--)0!==r&&r%3==0&&a.splice(o,0,","),r++;return a.slice(0,a.indexOf(",")+4).join("")+n}return e}}]),e}(c.Component);const A=(0,i.connect)(function(e){e.loading;e=n()(e,["loading"]);return v()({},e[j],{defaultValues:e[F].defaultValues})},null,null,{withRef:!0})(a);var V=function(e){var t=e.reduce(function(e,t){return t?e+t.value:e},0);e.forEach(function(e){e&&(e.ratio=(e.value/t*100).toFixed(2)+"%")})},H=(E(75314),E(11187)),a=(E(89858),E(51024)),Z=E(5133),J=E(38425),z=(E(12234),E(94184),E(61193)),G=E(66746),B=(E(25713),E(39432));p().locale("zh-cn");var U=a.default.Search,q=function(t){function e(e){var f=t.call(this,e)||this;return f.getPageTable=function(e){var t,a=f.state,a=(a.info,a.isInitial);f.setState({isLoading:!0,pageIndex:e},function(){return f.searchTable(null)}),a||(location.pathname.includes("opinion")?(t=document.getElementsByClassName("content-sidebar")&&document.getElementsByClassName("content-sidebar")[0])&&(t.scrollTop=760):(t=document.getElementsByClassName("content")&&document.getElementsByClassName("content")[0])&&(t.scrollTop=620))},f.searchTable=function(e){var a,t=f.state,n=t.params,i=t.pageSize,r=t.pageIndex,o=t.searchValue,s=(t.data,f.props),l=s.initParams,t=s.clusterType,c=s.baseType,s=f.state.info,d=s.textRankWord,p=s.typicalOpinion;if(n.filterModel||n.dateFilter){var u={projectId:n.projectId,dateFilter:n.dateFilter,headerFilterParamsNew:n.headerFilterParamsNew,messageCategory:"COMMENT",filterModel:Object.assign(n.filterModel||{},{clusterLevel:t||20,taskId:f.props.params.taskId})},t=e?e.opinion?"opinion":"hot":null,h=p.opinion,m=d.content;switch(t){case"hot":u.textRankWord=(d=e).content,u.typicalOpinion="typicalOpinion"===c?h:"";break;case"opinion":"{}"!==JSON.stringify(e.opinion)?u.typicalOpinion=(p=e).opinion:p={},u.textRankWord="textRankWord"===c?m:"";break;default:h&&(u.typicalOpinion=h),m&&(u.textRankWord=m)}u.filterModel.content?o?u.filterModel.content=[{contain:[].concat(o.trim().split(" "))}]:n.filterModel.content&&l.filterModel.content?u.filterModel.content=l.filterModel.content:delete u.filterModel.content:n.filterModel&&!n.filterModel.content&&o&&(u.filterModel.content=[{contain:[].concat(o.trim().split(" "))}]),u.pageSize=i,u.pageIndex=e?0:r,f.setState({listLoading:!0},function(){return C.h.post("/opinion/message/find",v()({},u,{pageIndex:0<u.pageIndex?20*(u.pageIndex-1):0})).then(function(e){var t=e.data.result;t.result?(u.typicalOpinion&&"{}"!==JSON.stringify(u.typicalOpinion)&&0<t.result.length?60<=l.opinionTotal?f.props.handleOpinionHighlight({projectId:u.projectId,messageIds:t.result.map(function(e){return e.messageId}),taskId:f.props.params.taskId,typicalOpinion:u.typicalOpinion,clusterLevel:u.filterModel.clusterLevel}).then(function(e){e&&(a=e.dataMap,f.setState({data:t.result.map(function(e){return e.highLight=a&&a[e.messageId],e})}))}):f.setState({data:t.result.map(function(e){return e.highLight=u.typicalOpinion,e})}):f.setState({data:t.result.map(function(e){return e.highLight=null,e})}),f.setState({pageIndex:u.pageIndex||0,listLoading:!1,isLoading:!1,searchValue:o,info:{textRankWord:d,typicalOpinion:p},data:t.result,params:u,count:{total:5e4<t.count?5e4:t.count,aspectTotal:t.aspectTotal},isInitial:!1})):f.setState({listLoading:!1,isLoading:!1,searchValue:o,info:{textRankWord:d,typicalOpinion:p},data:t.result,params:v()({},u,{aspect:u.filterModel.opinion}),pageIndex:u.pageIndex||0,count:{total:5e4<t.count?5e4:t.count,aspectTotal:0},isInitial:!1})})})}},f.selectChange=function(e){f.setState({selectedIndex:e})},f.renderAllMessage=function(e){var t=f.state,n=t.sourceEmotion,i=(t.params,t.loadingId),t=(t.seriesName,t.listLoading),r=f.state.lock;z.Z.hasAuthority("REVIEW_MESSAGE_LOCK")||(r=!0);var o=(document.documentElement.clientWidth-64-36-76-68-24-32-200)/2;return T().createElement("div",{ref:"blogs",className:"message-list"},T().createElement(k.default,{spinning:t},0<e.length?e.map(function(e,t){var a=e;return T().createElement(k.default,{spinning:i===e.commentId,key:a.commentId+t},T().createElement("div",{className:"blog-container "+(r?"lock":"unlock")},T().createElement(m.default,{className:"blog-title"},T().createElement(g.default,{className:"base-info source"},T().createElement("span",{className:"source-img"},T().createElement("img",{src:a.userImage?a.userImage.startsWith("http")?a.userImage:location.protocol+"//"+a.userImage:E(13192),"data-url":a.userImage,alt:"头像"}))),T().createElement(g.default,{className:"base-info product"},a.username),T().createElement(g.default,{className:"base-info  pull-right"},null!=e.score&&0!==e.score&&T().createElement(_.Rate,{className:"rate",disabled:!0,key:e.score+t,value:e.score,colors:["#FF8373","#FF8373","#FF8373"],showText:!1}),T().createElement("span",{className:"time"},p()(a.createTime).format("YYYY/MM/DD HH:mm")))),T().createElement(m.default,{className:"blog-body",dangerouslySetInnerHTML:{__html:f.renderContent(a.content,a.highLight,n)}}),a.aspects&&0<a.aspects.length&&T().createElement(m.default,{className:"blog-foot detail-footer"},T().createElement(g.default,{className:"asp asp-name",flex:"0 1 40px"},"指标"),T().createElement(g.default,{className:"asp",flex:"1"},a.aspects.sort(function(e,t){return t.escore-e.escore}).map(function(e,t){return T().createElement("span",{key:e.aspect2+t,className:8===e.escore?"asp-positive":"asp-negative"},e.aspect2)}))),T().createElement("div",{className:"blog-body message-detail"},T().createElement("span",{className:"title line ellipsis",style:{maxWidth:o},title:a.title||""},"- "+(a.title||"")),T().createElement("div",null,T().createElement("span",{className:"source line ellipsis"},"来源：",a.sourceName),T().createElement("span",{className:"connect line ellipsis",style:{maxWidth:o},title:a.title},"链接：",a.connectionName),T().createElement("a",{href:a.url,target:"_blank",className:"line ellipsis"},"数据源"),T().createElement("span",{className:"feedback",onClick:function(){return f._handleOnFeedback(a)}},"反馈"),T().createElement(G.Z,{ref:function(e){return f.drawerRef=e}})))))}):T().createElement("div",{className:"no-data"},T().createElement("img",{src:E(76180)}),T().createElement("span",null,"暂无数据"))))},f.exportData=function(e){e=JSON.parse(JSON.stringify(e));e.name=e.leftName,e.leftName="",J.Z.exportData(v()({},e,{type:"COMMENT"}),function(e){2e4===e.code?Z.Z.success(e.msg+"，请到个人中心的下载列表或者点击右上角“小铃铛”下载。"):Z.Z.error(e.msg)})},f._handleSearchButtonClick=function(e){var t=f.state,t=(t.params,t.info);t&&void 0!==t.hide&&delete t.hide,f.setState({hasSearched:!0,searchValue:e},function(){return f.searchTable()})},f._handleOnFeedback=function(t){var e=f.props.params,a=JSON.parse(JSON.stringify(e));f.drawerRef.show({aspectList:t.aspects,callback:function(e){C.h.post("/data_feedback/save",{feedbackDetails:e,messageId:t.commentId,projectId:a.projectId,messageContent:t.content,historyTag:JSON.stringify(t.aspects.filter(function(e){return e.escore}).map(function(e){return{aspect:e.aspect2,escore:e.escore}}))}).then(function(e){2e4===e.data.code&&H.default.success({style:{marginTop:"85px"},className:"feedback_success_message",content:T().createElement("div",{className:"feedback_success_tip"},T().createElement("img",{src:E(58476)}),T().createElement("p",null,"指标反馈成功，感谢您的反馈！"))})})}})},f.state={data:null,isLoading:!0,loadingId:null,info:{textRankWord:{},typicalOpinion:{}},searchValue:"",params:{},pageIndex:1,pageSize:20,count:{},sourceEmotion:null,emotion:"",lock:!0,listLoading:!1,aspects:null,selectedIndex:null,lastClickedTime:0,lastClickedMsgId:0,seriesName:[],hasSearched:!1,isInitial:!0,mParams:void 0},f}o()(e,t);var a=e.prototype;return a.renderContent=function(e,t,a){var n,i,r,o=this.state,s=o.params,l=o.info,o=l.textRankWord,s=(l.typicalOpinion,s.filterModel&&s.filterModel.content&&s.filterModel.content[0]&&s.filterModel.content[0].contain),c=e,o=[].concat([].concat(s,[o.content])).filter(function(e){return e});return Array.isArray(t)&&0<t.length?(r=t.map(function(e){return(e=e.split("-"))[1]=Number(e[0])+Number(e[1]),e}),n=e.split(""),i=a?'<a class="highlight-green">':'<a class="highlight-red">',r.forEach(function(e){n.splice(e[0],0,i),n.splice(e[1]+1,0,"<a/>")}),c=n.join("")):t&&(r=new RegExp(t,"g"),c=c.replace(r,'<span class="highlight-red">'+t+"</span>")),o&&0<o.length&&o.forEach(function(e){var t=new RegExp(e,"g");c=c.replace(t,'<span class="highlight-yellow">'+e+"</span>")}),c},a.componentWillMount=function(){var e=this.props.params,t=this.state.seriesName;e?this.setState({params:e,seriesName:t}):this.setState({params:{},sourceEmotion:"",seriesName:""})},a.componentDidMount=function(){this.props.params&&this.searchTable(this.state.info)},a.UNSAFE_componentWillReceiveProps=function(e){var t=e.params,e=this.state.seriesName;t&&this.setState({params:t,seriesName:e})},a.render=function(){var t=this,e=this.state,a=e.params,n=e.data,i=e.isLoading,r=e.pageIndex,o=e.count,s=e.pageSize,l=e.info,c=e.searchValue,e=e.mParams;this.props.type,this.state.lock;z.Z.hasAuthority("REVIEW_MESSAGE_LOCK");l&&(l.opinion||l.hide);return e?(e.from,e.to):l?l.opinion?l.opinion:l.content?l.content.contain[0]:l.time&&(e=(0,B.LV)(l.time,"WEEK"),"WEEK"===l.type?(e.from,e.to):(a.dateFilter.from,a.dateFilter.to)):a.dateFilter&&(a.dateFilter.from,a.dateFilter.to),T().createElement("div",{className:"message-detail-wrapper"},T().createElement("div",{className:"message-top"},T().createElement("div",{className:"left-title"},T().createElement("span",null,"消息详情",T().createElement(N.Z,{overlay:"根据筛选条件实时查询消息，因为项目中的数据实时更新，有时会跟上面呈现的消息数不一致，属于正常范围。当消息数很多时，只展示最新的5万条消息。",placement:"top",align:{offset:[4,-4]},overlayStyle:{maxWidth:216},mouseEnterDelay:.2},T().createElement("i",{className:"icon-cem_file1"})))),T().createElement("div",{className:"right"},T().createElement(U,{placeholder:"请输入关键词",size:"small",style:{width:180},allowClear:!0,suffix:T().createElement("span",{onClick:function(e){return t._handleSearchButtonClick(c)}},T().createElement("i",{className:"icon-cem_small-search",style:{color:"#8c8c8c"}})),onChange:function(e){return t.setState({searchValue:e.target.value})},onSearch:function(e){return t._handleSearchButtonClick(e)}}),z.Z.hasAuthority("DATA_DOWNLOAD")&&T().createElement(N.Z,{overlay:"导出数据",placement:"top",mouseEnterDelay:.6},T().createElement("i",{className:"icon-daochu",onClick:function(){return t.exportData(a)}})))),n&&this.renderAllMessage(n),!!o.total&&T().createElement("div",{className:"pager-container"},T().createElement(_.Pagination,{pageSize:s,className:"pagination",small:!0,total:o.total,layout:"prev, pager, next",currentPage:r,onCurrentChange:this.getPageTable})),i&&!n&&T().createElement("div",{className:"loadingWrapper"},T().createElement(k.default,{spinning:{loadState:i}})))},e}(c.Component),Y=E(50976);const K=function(e){var t=e.getWordcloudTableRef,a=e.getWordcloudChartRef,n=e.onChartClick,i=e.onMoreClick,r=e.onChartMouseOut,o=e.onChartMouseOver,s=e.loading,l=e.onWordcloudChartFinish,c=e.selectedGraphicName,d=e.wordSelectOpts,p=e.chartType,u=e.defaultValues.clusterHotType,h=e.changeChart,m=e.wordCloud,f=e.optionPage,g=e.activeOpinionIndex,y=e.handleMyWordChartClick,v=e.handleOnOptionWordListPageChange,C=e.handleDefaultValue,O=e.data,e=(O.sOption,O.wOption),O=O.chartData;return T().createElement("div",{className:"opinion-chart-wrapper"},T().createElement("div",{className:"wordcloud"},T().createElement(k.default,{spinning:s,tip:"正在加载中",wrapperClassName:"opinion-chart",size:"large"},O&&0<O.length?T().createElement(T().Fragment,null,m?T().createElement(Y.Z,{option:e,theme:"yt_multi_color_10",onChartReady:a,onEvents:{click:n,mouseout:r,mouseover:o,finished:l},style:{width:"100%",height:"100%"}}):T().createElement(x,{getRef:function(e){return t(e)},title:e.title.text,list:O&&O.filter(function(e){return e}),loading:s,optionPage:f,activeOpinionIndex:g,multiColorsPositive:c?P.FG.reduce(function(e,t){return e[t.id]=t.color,e},{}):P.O9.normal,isAllColors:c,buildNum:w,renderWordOverlay:function(e,t){return T().createElement("span",{className:"opinion-tooltip"},T().createElement("i",{style:{background:t}}),e)},handleMyWordChartClick:y,handleOnOptionWordListPageChange:v})):T().createElement("div",{className:"no-data"},T().createElement("img",{src:E(76180)}),T().createElement("span",null,"暂无数据"))),(!O||0===O.length||s)&&T().createElement("div",{className:"t-title"},"热词"),T().createElement(N.Z,{overlay:"热词是根据关键词热度而得出，关键词热度跟词频和重要程度有关。关键词热度值在1-100之间。",placement:"top",mouseEnterDelay:.2,overlayStyle:{maxWidth:166}},T().createElement("div",{className:"tip"},T().createElement("i",{className:"icon-cem_file1"}))),T().createElement("div",{className:"buttons"},T().createElement(M.Z,{className:"chartType "+(p?"set_Top_active":""),activeObj:p||u||"0",flavor:u||"0",onFlavorChange:C,onChange:h,options:d,objName:"clusterHotType",rightHook:!0}),T().createElement(N.Z,{overlay:"词性区分",placement:"top",mouseEnterDelay:.6},T().createElement("i",{className:"icon-cixingqufen "+(c?"active":""),onClick:function(){return i("wdiff")}})),T().createElement(N.Z,{overlay:"导出数据",placement:"top",mouseEnterDelay:.6},T().createElement("i",{className:"icon-daochu",onClick:function(){return i("wExcel")}})),T().createElement(N.Z,{overlay:"导出图片",placement:"top",mouseEnterDelay:.6},T().createElement("i",{className:"icon-xiazaitupian",onClick:function(){return i("wImage")}})))))};var $=r.Z.opinion.detail,Q=r.Z.opinion.opinionChart,a=function(t){function e(e){var f=t.call(this,e)||this;return f._resize=function(){f.wordcloudChartRef&&f.wordcloudChartRef.resize()},f._fetchData=function(){var e=f.props,t=e.detail,e=e.params;t&&t.projectId&&f.props.fetchWordData({projectId:t.projectId,enablePos:!0,headerFilterParamsNew:e.headerFilterParamsNew,messageCategory:"COMMENT",topSize:100,dateFilter:e.dateFilter,filterModel:e.filterModel})},f._handleOnMoreClick=function(e){var t,a=f.props,n=a.data.chartData,i=a.wordCloud,r=f.state,o=r.selectedGraphicName,a=r.selectedWordName,r=f.state.allGraphicOptions;"wImage"===e?i?(0,W._v)(f.wordcloudChartRef,"热词"):(0,W.Mx)(f.wordcloudTableRef,"热词"):"wExcel"===e?(i=o?n.reduce(function(e,t){return[].concat(e,[[t.name,"n"===t.pos?"名词":"a"===t.pos?"形容词":"其他",t.hotWordFix]])},[["热词","词性","热度"]]):n.reduce(function(e,t){return[].concat(e,[[t.name,t.hotWordFix]])},[["热词","热度"]]),(0,W.aT)([i],"热词分析")):"wdiff"===e&&(o?(r=JSON.parse(JSON.stringify(P.FG)),f._resetOptions(n,void 0,a)):(t=n.map(function(e){return e.pos}),r.filter(function(e){return t.includes(e.id)}),f._resetOptions(n,r,a)),f.setState({allGraphicOptions:r,selectedGraphicName:!o}))},f._handleOnChartClick=function(e){var t=e.componentType,a=e.componentSubType,n=e.data,i=f.state,e=i.selectedWordName;i.activeOpinionIndex;"series"===t&&"wordCloud"===a&&(a=n.name,n=n.index,f._handleMyWordChartClick({name:e&&e===a?void 0:a},n))},f._handleOnChartMouseOut=function(e){var t=e.componentType,a=e.componentSubType,n=e.name,e=f.state.selectedWordName;"series"===t&&"wordCloud"===a?e&&e!==n&&f.dispatchEchartsAction(f.wordcloudChartRef,"highlight",n):"series"===t&&"scatter"===a&&f.dispatchTooltipAction(f.wordcloudChartRef,"hideTip",n)},f._handleOnChartMouseOver=function(e){var t=e.componentType,a=e.componentSubType,e=e.name;"series"===t&&"wordCloud"===a?(f.dispatchEchartsAction(f.wordcloudChartRef,"downplay",e),f.dispatchEchartsAction(f.wordcloudChartRef,"downplay",e)):"series"===t&&"scatter"===a&&f.dispatchTooltipAction(f.wordcloudChartRef,"showTip",e)},f._resetOptions=function(e,t,a){var n=f.props,i=n.resetData,r=n.data.chartData,n=f.state,e=(n.selectedGraphicName,n.allGraphicOptions,t?(0,P.WN)(e||r,t,f._handleGraphicClick,a):(0,P.WN)(e||r,void 0,void 0,a));return i({topChartData:{chartData:r,wOption:e,wSection:{gOptions:t||void 0,_handleGraphicClick:t?f._handleGraphicClick:void 0}},selectedWordName:a}),e},f.dispatchEchartsAction=function(t,a,n){setTimeout(function(){var e={type:a,seriesName:"opinionWordCloud"};n&&(e.name=n),t.dispatchAction(e)},0)},f.dispatchTooltipAction=function(e,t,a){setTimeout(function(){e.dispatchAction({type:t,name:a,seriesIndex:0})},0)},f.changeChart=function(e){var t=e.clusterHotType,e=f.props.save;f.setState({chartType:t}),e({wordCloud:"0"===t})},f._handleOnWordcloudChartFinish=function(){f.wcTimeoutId&&clearTimeout(f.wcTimeoutId),f.wcTimeoutId=setTimeout(function(){f.setState({wcLoading:!1}),f.wcTimeoutId=void 0},100)},f._handleGraphicClick=function(t){void 0===t&&(t="");var e=f.props.data.chartData,a=f.state,n=a.allGraphicOptions,a=a.selectedWordName,e=[].concat(e),i={};n.map(function(e){return e.id===t&&(e.unSelected=!e.unSelected),i[e.id]=e.unSelected,e}),f._resetOptions(e.filter(function(e){return!i[e.pos]}),n,a),f.setState({allGraphicOptions:n})},f._handleMyWordChartClick=function(e,t){var a=f.state,n=a.selectedGraphicName,i=a.allGraphicOptions,r=a.activeOpinionIndex,o=f.props,s=o.refreshMessage,l=o.saveOpinion,c=o.getOpinionWordCloudList,a=o.data.chartData,d=o.opinionTaskValid,p=o.baseType,u=o.refreshOtherChart,h=r===t?-1:t,m=r===t?"":e.name;f.setState({selectedWordName:m,activeOpinionIndex:m?h:-1},function(){var e=m?p||"textRankWord":"typicalOpinion"===p?p:"";"textRankWord"!==e&&e||(u(),d&&l({loading:!0,optionPage:1,textRankWord:m}),d&&c({textRankWord:m})),l({textRankWord:m,baseType:e}),f.clickTimeId=setTimeout(function(){s(m&&-1!==h?{hide:!!m,content:m}:{}),f.clickTimeId=void 0},100)}),f._resetOptions(a,n?i:void 0,m)},f._handleOnOptionWordListPageChange=function(e){f.props.save({optionPage:e})},f._handleResetSelected=function(){var e=f.state,t=e.selectedGraphicName,e=e.allGraphicOptions;f.setState({activeOpinionIndex:-1,selectedWordName:""}),f._resetOptions(void 0,t&&e)},f.wordcloudChartRef=void 0,f.wordcloudTableRef=void 0,f.wcTimeoutId=void 0,f.event={onMoreClick:f._handleOnMoreClick,onChartClick:f._handleOnChartClick,onChartMouseOut:f._handleOnChartMouseOut,onChartMouseOver:f._handleOnChartMouseOver,onChartReady:f._handleOnChartReady,onWordcloudChartFinish:f._handleOnWordcloudChartFinish,getWordcloudChartRef:function(e){return f.wordcloudChartRef=e},getWordcloudTableRef:function(e){return f.wordcloudTableRef=e},changeChart:f.changeChart,handleMyWordChartClick:f._handleMyWordChartClick,handleOnOptionWordListPageChange:f._handleOnOptionWordListPageChange},f.state={selectedGraphicName:!1,selectedWordName:void 0,chartType:void 0,wcLoading:!0,loading:!0,activeOpinionIndex:-1,allGraphicOptions:JSON.parse(JSON.stringify(P.FG))},f}o()(e,t);var a=e.prototype;return a.componentDidMount=function(){this._fetchData(),window.addEventListener("resize",this._resize)},a.componentWillUnmount=function(){var e=this.props.resetData;window.removeEventListener("resize",this._resize),e({topChartData:{chartData:[],sOption:{},wOption:{},wSection:{gOptions:void 0,_handleGraphicClick:void 0}}})},a.componentDidUpdate=function(e){e.fetchWordDataEffecting&&!this.props.fetchWordDataEffecting&&this.setState({loading:!1}),!e.fetchWordDataEffecting&&this.props.fetchWordDataEffecting&&this.setState({loading:!0}),JSON.stringify(e.detail)!==JSON.stringify(this.props.detail)&&this._fetchData()},a.render=function(){return T().createElement(K,v()({},this.state,this.props,this.event,this.ref))},e}(T().PureComponent);const X=(0,i.connect)(function(e){var t=e.loading,e=n()(e,["loading"]);return{defaultValues:e[$].defaultValues,wordCloud:e[$].wordCloud,data:e[$].topChartData,typicalOpinion:e[$].typicalOpinion,optionPage:e[$].optionPage,fetchWordDataEffecting:t.effects[$+"/fetchWordData"]||!1,wordSelectOpts:e[Q].wordSelectOpts,opinionTaskValid:e[Q].opinionTaskValid,baseType:e[Q].baseType}},function(t){return{save:function(e){return t({type:$+"/save",payload:e})},fetchWordData:function(e){return t({type:$+"/fetchWordData",payload:e})},resetData:function(e){return t({type:$+"/save",payload:e})},getOpinionWordCloudList:function(e){return t({type:Q+"/getWordCloudList",payload:e})},saveOpinion:function(e){return t({type:Q+"/save",payload:e})}}},null,{withRef:!0})(a);var ee=E(35239),te=r.Z.opinion.detail,a=r.Z.IDBHeaderScreening,ae=a.headerScreening,ne=a.screening,ie=r.Z.opinion.opinionChart,re=t.Z.Paragraph,t=function(a){function e(e){var u=a.call(this,e)||this;u.fetchOpinionDetail=function(e){var e=e.id,p=u.props.dispatch;p({type:ie+"/reset"}),C.h.post("/opinion/task/find",{id:e}).then(function(e){var t,a,n,i,r,o,s,l,c,d=e.data;2e4===d.code&&d.result&&(t=(c=d.result).id,a=c.name,n=c.filterParam,i=c.projectId,e=c.updateTime,d=c.predictTime,r=c.messageTotal,o=c.opinionTotal,s=c.status,c=c.otherTaskId,l=JSON.parse(n),c=v()({projectId:i,taskId:t,opinionTotal:o,messageTotal:r,status:s,filterModel:l.content?{content:[l.content]}:{clusterLevel:20,taskId:t}},l,{name:a,updateTime:e,predictTime:d,otherTaskId:c}),C.h.post("/default/value/find",{key:"OPINION_HOT_OBJ",projectId:i}).then(function(e){var t=u.props.defaultValues;e.data.result&&(e=JSON.parse(e.data.result),p({type:te+"/save",payload:{wordCloud:!(e.clusterHotType&&"1"===e.clusterHotType&&e.clusterHotType),defaultValues:v()({},t,e)}}),p({type:ie+"/save",payload:{wordCloud:!(e.clusterType&&"1"===e.clusterType&&e.clusterType)}}))}),l&&0<l.headerFilterParamsNew.length&&p({type:ae+"/init",payload:{type:"OPINION_MSG_COMMENT",screening:{value:[],noSavingFilterList:[]}}}).then(function(){var e=u.props.screeningMap;e&&p({type:te+"/refilterList",payload:{screeningMap:e,screeningValues:l.headerFilterParamsNew||[]}})}),u.setState({type:2,params:c,initParams:h()(c),detail:{projectId:i,taskId:t,taskName:a},currOpinonObj:{id:t,name:a,opinionTotal:o,messageTotal:r,status:s,mode:t&&!a?"save":"rename"}},function(){var e=o<=5e5&&!0,t=0;o<20?t=1:o<50?t=2:5e5<o&&(t=3),p({type:ie+"/save",payload:{opinionTaskValid:e,invalidReason:t,refreshing:e&&"FINISH"!==s,messageTotal:r,reloaded:e,loading:e}}),e&&p({type:ie+"/resetClusterOptions"}),u.refreshData()}))})},u.handleOnFilterReady=function(){},u.refreshData=function(e){var t=u.state,a=(t.detail,t.params),a=(a.dateFilter,a.filterModel,t.type),t=u.props.dispatch;4===a||e||t({type:ie+"/getWordCloudList"}),u.message.searchTable()},u.refreshMenuList=function(){return(0,u.props.dispatch)({type:"menu/fetchMenuList"})},u.updateCurrOpinonObj=function(e){var t=u.state.currOpinonObj;e?u.setState({currOpinonObj:e}):(t.mode="update",u.setState({currOpinonObj:t}))},u._handleEditClick=function(t,e){var a;t?t&&40<t.length?Z.Z.error("输入错误，结果名称最多可输入40个字"):(a=u.state.params,C.h.post("/opinion/task/rename",{projectid:ee.t.get(ee.V.curProject).id,newName:t,id:e}).then(function(e){2e4===e.data.code&&(a.name=t,u.setState({params:v()({},a)}))})):Z.Z.error("输入错误，结果名称不能为空")},u._handleKeyWord=function(e){if(e){var t="FUZZY_SEARCH"===e[0].queryType?"或":"且";return e[0].contain.map(function(e){return'"'+e+'"'}).join(t)}},u._setDefaultValue=function(e,t){var a=u.props,n=a.defaultValues,i=a.dispatch,r=v()({},n,t),t=JSON.stringify(r);C.h.post("/default/value/update",{projectId:u.state.params.projectId||ee.t.get(ee.V.curProject).id,key:e,value:t}).then(function(e){2e4===e.data.code&&(i({type:te+"/save",payload:{wordCloud:!(r.clusterHotType&&"1"===r.clusterHotType&&r.clusterHotType),defaultValues:v()({},r)}}),i({type:ie+"/save",payload:{wordCloud:!(r.clusterType&&"1"===r.clusterType&&r.clusterType)}}))})};var t=4,e=location.pathname;return e.startsWith("/opinion")&&(t=3===e.split("/").length?2:location.search?3:1),u.state={params:{},detail:{projectId:"",taskId:"",taskName:""},type:t,currOpinonObj:{id:"",name:"",status:status,filter:{filterModel:{aspect:{aspect1:[],aspect2:[],emotion:["positive","negative"]}},dateFilter:null},messageTotal:0,opinionTotal:0,changed:!1,mode:"update"},filterRef:{}},u}o()(e,a);var t=e.prototype;return t.componentDidMount=function(){var e,t,a,n=this,i=ee.t.get(ee.V.curProject).id,r=decodeURIComponent(window.location.search).substr(1),o=location.pathname;o.startsWith("/opinion")?3===o.split("/").length?(o=o.split("/")[2],this.fetchOpinionDetail({id:o})):(location.search,location.search?(t=JSON.parse(decodeURIComponent(window.location.search.split("?")[1])),this.fetchOpinionDetail(t)):this.fetchOpinionDetail({projectId:i})):(e=this.props.dispatch,(t=JSON.parse(r)).filterModel,t.dateFilter,a=!1,(i=ee.t.get(ee.V.opinionDetail))&&i.uri&&i.uri===r&&(a=!0,r=(i=ee.t.get(ee.V.opinionDetail)).data[20],t.taskId=i.taskId||this.state.params.taskId,e({type:ie+"/save",payload:{hasRecord:!0,allData:i.data,json_word:r}})),this.setState({params:t,type:4},function(){a?n.message.searchTable():e({type:ie+"/save",payload:{loading:!0}})}))},t._handleFilterShow=function(e,t){var a=this.state.filterRef;a[e]?a[e]=Object.assign(a[e],t):a[e]=t,this.setState({filterRef:v()({},a)})},t.render=function(){var a=this,e=this.state,t=e.params,n=e.initParams,i=e.detail,r=e.currOpinonObj,o=e.currOpinonObj,s=o.messageTotal,l=o.opinionTotal,c=e.type,d=e.filterRef,p=this.props,u=p.screeningValues,h=p.clusterType,o=p.baseType,e=t&&t.filterModel||{},p=t&&t.dateFilter||null;return T().createElement("div",{className:"opinion-detail-wrapper"},T().createElement(y.default,{column:1,className:"detail-descriptions"},T().createElement(y.default.Item,{label:"结果名称"},t.name&&T().createElement(re,{editable:{icon:T().createElement("i",{className:"icon-cem_edit"}),tooltip:!1,onChange:function(e){a._handleEditClick(e,t.taskId)}}},t.name)),T().createElement(y.default.Item,{label:"筛选时间"},p?p.from.replace(/-/g,"/")+" ~ "+p.to.replace(/-/g,"/"):""),T().createElement(y.default.Item,{label:"筛选条件",className:"screening"},t.queryType&&T().createElement("p",null,"数据类型：","COMMENT"===t.queryType?"电商评论":""),u&&0<u.length&&u.map(function(t){return T().createElement("dl",{key:t.id},T().createElement("dt",null,t.label,"："),T().createElement("dd",{ref:function(e){return!d[t.id]&&a._handleFilterShow(t.id,{ref:e,clientHeight:e.clientHeight,class:22<e.clientHeight?"collaspe":"",isShow:!1})},className:d[t.id]&&d[t.id].class?"showItem "+(d[t.id].isShow?"":d[t.id].class):""},T().createElement("span",null,t.values.join(", ")),d[t.id]&&d[t.id].class?T().createElement("span",{onClick:function(){return a._handleFilterShow(t.id,{isShow:!d[t.id].isShow})}},d[t.id].isShow?"收起":"展开"):""))}),e.content&&e.content[0].contain&&0<e.content[0].contain.length&&T().createElement("p",null,"关键词：",this._handleKeyWord(e.content)))),T().createElement(m.default,{gutter:24,className:"detail-rows"},T().createElement(g.default,{span:12},T().createElement(f.Z,null,T().createElement("p",null,T().createElement("span",null,"消息数： "),T().createElement("span",null,s&&new String(s).replace(/(?=(\B)(\d{3})+$)/g,",")),T().createElement(N.Z,{overlay:"统计了满足筛选条件的有效消息数量",placement:"top",mouseEnterDelay:.2},T().createElement("i",{className:"icon-cem_file1"}))))),T().createElement(g.default,{span:12},T().createElement(f.Z,null,T().createElement("p",null,T().createElement("span",null,"观点数： "),T().createElement("span",null,l&&new String(l).replace(/(?=(\B)(\d{3})+$)/g,",")),T().createElement(N.Z,{overlay:"观点是指对事物或问题的主观看法。在一个评论中，用户会表达至少1个观点。如评论内容为【服务好，质量好，讲解到位】，那么用户在该内容中表述了3个观点。",placement:"top",mouseEnterDelay:.2,overlayStyle:{maxWidth:446}},T().createElement("i",{className:"icon-cem_file1"})))))),T().createElement("div",{className:4!==c?"content-sidebar":"content"},4!==c&&T().createElement(X,{ref:function(e){return a.opinionChart=e},detail:i,params:t,handleDefaultValue:function(e){return a._setDefaultValue("OPINION_HOT_OBJ",e)},handleMessageTotal:function(e){var t=e.messageTotal,e=e.opinionTotal;return a.setState({currOpinonObj:v()({},r,{messageTotal:t,opinionTotal:e})})},refreshOtherChart:function(){return a.detailChart.wrappedInstance._handleResetSelected()},refreshMessage:function(e){a.message&&a.message.searchTable(e)}}),T().createElement(A,{params:t,taskId:r.id&&r.id||t.taskId,ref:function(e){return a.detailChart=e},type:c,handleDefaultValue:function(e){return a._setDefaultValue("OPINION_HOT_OBJ",e)},refreshOtherChart:function(){return a.opinionChart.wrappedInstance._handleResetSelected()},resetData:function(e){return a.fetchOpinionDetail({id:e})},refreshMessage:function(e){a.message&&a.message.searchTable(e)}}),T().createElement(q,{params:t,initParams:n,baseType:o,ref:function(e){return a.message=e},resetMessage:function(){a.detailChart&&a.detailChart.getWrappedInstance().resetWordcloudState(),a.detailChart&&a.detailChart.getWrappedInstance().resetBarchartState(),a.opinionChart&&a.opinionChart.getWrappedInstance().reset()},handleOpinionHighlight:function(e){return(0,a.props.dispatch)({type:te+"/fetchOpinionHighlightList",payload:v()({},e)})},type:c,clusterType:h})))},e}(c.Component);const oe=(0,i.connect)(function(e){e.loading;e=n()(e,["loading"]);return{screeningValues:e[te].screeningValues,defaultValues:e[te].defaultValues,clusterType:e[ie].clusterType,baseType:e[ie].baseType,screeningMap:e[ne].curScreeningMap}})(t)},38425:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var n=a(36144);const i={fetchWidgetList:function(e,t){n.h.post("/widget/list",e).then(function(e){t&&t(e.data.result)})},fetchWidgetTemp:function(e,t){n.h.get("/widget/temp/find?type="+e).then(function(e){t&&t(e.data.result)})},fetchWidgetTempById:function(e,t){n.h.get("/widget/edit_temp/find?id="+e).then(function(e){t&&t(e.data.result)})},addWidget:function(e,t){n.h.post("dashboard/widget/add",e).then(function(e){t&&t(e.data.result)})},searchData:function(e,t){n.h.post("/widget/data/find",e).then(function(e){t&&t(e.data.result)},function(e){t&&t(e.data.result)})},fetchProjectTopics:function(e,t){n.h.post("/widget/project_topics/find",e).then(function(e){t&&t(e.data.result)})},editWidget:function(e,t){n.h.post("/widget/edit",e).then(function(e){t&&t(e.data.result)})},findModel:function(e,t){n.h.get("/widget/model/list?project="+e.project).then(function(e){t&&t(e.data.result)})},exportData:function(e,t){n.h.post("/data/export",e).then(function(e){t&&t(e.data)})},findMessage:function(e,t){n.h.post("/widget/aspect/find",e).then(function(e){t&&t(e.data.result)})},findAspectLabel:function(e,t){n.h.post("/widget/aspectLabel",e).then(function(e){t&&t(e.data.result)})},downloadPrice:function(e,t){n.h.post("/data/price/export",e).then(function(e){t&&t(e.data)})}}},12234:(e,t,a)=>{"use strict";a.d(t,{l:()=>c});var n=a(67154),i=a.n(n),t=a(37316),r=a.n(t),n=a(85354),o=a.n(n),t=a(67294),s=a.n(t),n=a(94184),l=a.n(n),c=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.className,a=e.name,e=r()(e,["className","name"]),t=l()("icon",["cem-"+a],t);return s().createElement("svg",i()({className:t},e),s().createElement("use",{xlinkHref:"#icon-cem-"+a}))},t}(t.Component)},66746:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var t=a(16049),p=a(1825),t=a(89858),u=a(51024),t=a(7940),h=a(31059),t=a(1025),m=a(65400),t=a(75314),o=a(11187),t=a(85354),n=a.n(t),t=a(67294),f=a.n(t),l=a(87219);const i=function(t){function e(e){var s=t.call(this,e)||this;return s.show=function(e){var t=e.aspectList,e=e.callback;s.setState({visible:!0,aspectList:t}),s.callback=e},s._handleOnClose=function(){s.setState({visible:!1,aspectList:void 0,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:""},function(){s.callback=void 0})},s._handleOnConfigConfirm=function(){var e=s.state,t=e.moreChecked,a=e.moreContent,n=e.errorChecked,i=e.errorContent,r=e.lessChecked,o=e.lessContent,e=[];t&&a.length?e.push({feedbackType:"ASPECT_TOO_MANY",feedbackContent:JSON.stringify(a.filter(function(e){return e.escore}))}):e.filter(function(e){return"ASPECT_TOO_MANY"!==e.feedbackType}),n&&i.length?e.push({feedbackType:"EMOTION_WRONG",feedbackContent:JSON.stringify(i.filter(function(e){return e.escore}))}):e.filter(function(e){return"EMOTION_WRONG"!==e.feedbackType}),r?e.push({feedbackType:"ASPECT_NOT_ENOUGH",feedbackContent:o}):e.filter(function(e){return"ASPECT_NOT_ENOUGH"!==e.feedbackType}),s.callback&&s.callback(e),s._handleOnClose()},s._handleOnChange=function(e,t){var a;s.setState(((a={})[t+"Checked"]=e,a)),(t.includes("more")&&!e||t.includes("error")&&!e)&&s.state[t+"Content"]&&s.state[t+"Content"].length&&s.setState(((e={})[t+"Content"]=[],e))},s._handleOnInputChange=function(e){1e3===e.target.value.trim().length&&s.setState({lessTips:"最多输入1000字"}),s.setState({lessContent:e.target.value.trim().substring(0,1e3)})},s._handleOnClickAspect=function(t,a,e){var n=s.state,i=n.moreContent,n=n.errorContent,r="more"===e?i:n,i=(0,l.ZP)(r,function(e){return r.find(function(e){return JSON.stringify(e)===JSON.stringify({aspect:t,escore:a})})?(1===r.length&&o.default.warning("至少保留一个指标选项"),e.filter(function(e){return JSON.stringify(e)!==JSON.stringify({aspect:t,escore:a})})):void e.push({aspect:t,escore:a})});s.setState(((n={})[e+"Content"]=i,n))},s.callback=void 0,s.state={visible:!1,moreChecked:!1,moreContent:[],errorChecked:!1,errorContent:[],lessChecked:!1,lessContent:"",lessTips:"",aspectList:void 0},s}return n()(e,t),e.prototype.render=function(){var a=this,e=this.state,t=e.visible,n=e.moreChecked,i=e.moreContent,r=e.errorChecked,o=e.errorContent,s=e.lessChecked,l=e.aspectList,c=e.lessContent,d=e.lessTips;return f().createElement(p.Z,{title:"我要反馈",placement:"right",width:372,onClose:this._handleOnClose,visible:t,footer:f().createElement("div",{style:{float:"right"}},f().createElement(m.default,{onClick:this._handleOnClose},"取消"),f().createElement(m.default,{disabled:n&&r&&!s&&!i.length&&!o.length||n&&!r&&!s&&!i.length||r&&!n&&!s&&!o.length||!n&&!r&&!s,type:"primary",onClick:this._handleOnConfigConfirm},"确定"))},f().createElement("div",{className:"yt_aspect_feedback_drawer"},l&&l.length?f().createElement("div",{className:"item"},f().createElement(h.default,{checked:n,onChange:function(e){return a._handleOnChange(e.target.checked,"more")}},"多了指标"),f().createElement("div",{className:"feedback_content"},n&&l.map(function(t,e){return f().createElement("span",{key:e,className:8===t.escore?"positive":"negative",onClick:function(){return a._handleOnClickAspect(t.aspect2,t.escore,"more")}},f().createElement("i",{className:"icon-cem_big-gou",style:{display:i.find(function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})})?"inline":"none"}}),t.aspect2)}))):null,l&&l.length?f().createElement("div",{className:"item"},f().createElement(h.default,{checked:r,onChange:function(e){return a._handleOnChange(e.target.checked,"error")}},"情感有误"),f().createElement("div",{className:"feedback_content"},r&&l.map(function(t,e){return f().createElement("span",{key:e,className:8===t.escore?"positive":"negative",onClick:function(){return a._handleOnClickAspect(t.aspect2,t.escore,"error")}},f().createElement("i",{className:"icon-cem_big-gou",style:{display:o.find(function(e){return JSON.stringify(e)===JSON.stringify({aspect:t.aspect2,escore:t.escore})})?"inline":"none"}}),t.aspect2)}))):null,f().createElement(h.default,{checked:s,onChange:function(e){return a._handleOnChange(e.target.checked,"less")}},"少了指标"),s&&f().createElement("div",{className:"item"},f().createElement("p",null,"对应的文本或缺失指标说明"),f().createElement(u.default.TextArea,{className:d?"border_err":"",autoSize:{minRows:3,maxRows:13},placeholder:"请输入",onFocus:function(e){d&&a.setState({lessTips:""})},onBlur:function(e){d&&a.setState({lessTips:""})},maxLength:1e3,value:c,onChange:this._handleOnInputChange}),d&&f().createElement("div",{className:"tips"},d))))},e}(f().PureComponent)}}]);