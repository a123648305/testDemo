(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[7515],{87515:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var t=a(85354),n=a.n(t),d=a(67294),r=a.n(d),i=a(92360),s=a(5133),h=a(29383),u=a(55815),p=a(66130),t=a(67154),c=a.n(t),m=function(t){function e(e){e=t.call(this,e)||this;return e.state={defaultChecked:!1},e}n()(e,t);var a=e.prototype;return a.componentDidMount=function(){this.setState(c()({},this.props))},a.UNSAFE_componentWillReceiveProps=function(e){this.setState(c()({},e))},a.handleClick=function(e){var t=this.state,a=t.type,n=t.defaultChecked,c=t.selectedList,t=t.totalList;"checkAll"===a?n?this.props.onChange([]):this.props.onChange(t):(-1<(t=c.indexOf(e))?c.splice(t,1):c.push(e),this.props.onChange(c)),this.setState({defaultChecked:!n})},a.render=function(){var t=this,e=this.state,a=e.type,n=e.defaultChecked,c=e.indeterminate,o=e.uniqueId,e="customized-checkobx";return n?e="customized-checkobx checked":"checkAll"===a&&c&&(e="customized-checkobx indeterminate"),r().createElement("div",{className:"customized-checkobx-wrapper"},r().createElement("div",{className:e,onClick:function(e){e.stopPropagation(),t.handleClick(o)}}))},e}(r().PureComponent),f=a(36144),t=a(30381),t=a.n(t),o=a(35239),l="YYYY-MM-DD",k=t()().format(l),g=function(t){function e(e){var h=t.call(this,e)||this;return h.handleDateChange=function(e){h.setState({date:e?e.format(l):k},function(){return h.handleFetchData()})},h.handleFetchData=function(){var e=h.state,t=e.projectId,a=e.date;h.setState({loading:!0},function(){f.h.post("/store/data/list",{projectId:t,dateFilter:{from:a,to:a}}).then(function(e){2e4===e.data.code&&((e=e.data.result.list).forEach(function(e,t){e.id=t,e.checked=!1}),h.setState({data:e,selectedList:[],checkAllStatus:{checked:!1,indeterminate:!1}}))}).finally(function(){h.setState({loading:!1})})})},h.handleCheckAll=function(){var e=h.state,t=e.data,a=[],n={},n=e.checkAllStatus.checked?(a=[],t.forEach(function(e){return e.checked=!1}),{checked:!1,indeterminate:!1}):(a=t.map(function(e){return e.id}),t.forEach(function(e){return e.checked=!0}),{checked:!0,indeterminate:!1});h.setState({selectedList:a,data:t,checkAllStatus:n})},h.handleCheck=function(e){for(var t=h.state.data,a=0;a<t.length;a++)e.includes(t[a].id)?t[a].checked=!0:t[a].checked=!1;h.setState({data:t,selectedList:e,checkAllStatus:{checked:e.length===t.length,indeterminate:0<e.length&&e.length!==t.length}})},h.handleDownload=function(e){var t=h.state.projectId,a=e.platformId,n=e.dataPlatformId,c=e.from,e=e.to;f.h.post("/store/data/download",{projectId:t,platformId:a,dataPlatformId:n,dateFilter:{from:c,to:e}}).then(function(e){2e4===e.data.code&&(e=e.data.result.url,window.open(e))})},h.handleDownloadByGroup=function(){var e=h.state,t=e.projectId,a=e.selectedList,n=e.data;if(0<a.length){for(var c,o,l,d,r=[],i=0;i<n.length;i++)a.includes(n[i].id)&&(c=(d=n[i]).platformId,o=d.dataPlatformId,l=d.from,d=d.to,r.push({projectId:t,platformId:c,dataPlatformId:o,dateFilter:{from:l,to:d}}));f.h.post("/store/data/batch/download",r).then(function(e){2e4===e.data.code&&(e=e.data.result.url,window.open(e))})}else s.Z.warning("请选择需要下载的记录")},h.state={projectId:o.t.get(o.V.curProject)&&o.t.get(o.V.curProject).id,date:k,loading:!1,data:[],pageIndex:1,pageSize:20,total:0,selectedList:[],checkAllStatus:{checked:!1,indeterminate:!1}},h}n()(e,t);var a=e.prototype;return a.componentDidMount=function(){this.handleFetchData()},a.render=function(){var a=this,e=this.state,n=e.data,c=e.selectedList,t=e.loading,o=e.checkAllStatus,l=[{label:"",prop:"paddingLeft",width:16},{label:"",width:56,renderHeader:function(e){return r().createElement(d.Fragment,null,r().createElement(m,{type:"checkAll",defaultChecked:o.checked,indeterminate:o.indeterminate,onChange:a.handleCheckAll}))},render:function(t){return r().createElement(m,{type:"checkOne",ref:function(e){return a["checkOne"+t.id]=e},defaultChecked:t.checked||!1,onChange:a.handleCheck,selectedList:c,totalList:n,uniqueId:t.id})}},{label:"电商平台",prop:"platformName"},{label:"数据平台",prop:"dataPlatformName"},{label:"店铺数",prop:"storeCount"},{label:"已采集",prop:"collectedCount"},{label:"采集中",prop:"collectingCount"},{label:"未采集",prop:"notReadyCount"},{label:"操作",prop:"operation",render:function(t){return r().createElement("span",{className:"operation",onClick:function(e){e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),a.handleDownload(t)}},"下载")}},{label:"",prop:"paddingRight",width:16}],e=document.documentElement.clientHeight-46-48-24;return r().createElement("div",{className:"data-export-wrapper"},r().createElement(u.Z,{title:"数据导出",rightContent:r().createElement(i.Button,{type:"primary",onClick:this.handleDownloadByGroup},"批量下载")}),r().createElement("div",{className:"data-export-body"},r().createElement("div",{style:{minHeight:e}},r().createElement("div",null,r().createElement("span",null,"采集日期"),r().createElement(p.M,{getDateRange:this.handleDateChange})),r().createElement(i.Loading,{loading:t,text:"拼命加载中"},r().createElement(h.Z,{rowClassName:function(e){return c.includes(e.id)?"item active":"item"},columns:l,data:n,total:n.length,currentPage:1,pageSize:100,notLimit:!0})))))},e}(d.Component)}}]);