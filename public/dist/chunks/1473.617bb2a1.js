(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1473],{71473:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var t=a(85354),r=a.n(t),t=a(67294),v=a.n(t),l=a(92360),n=a(5133),o=a(36144),t=a(97189),d=a.n(t),i=function(t){function e(e){var o=t.call(this,e)||this;return o.handleSort=function(e){var n,l,t=e.prop,a=e.order,r=d().deepClone(o.state.stores);t&&a&&(n=t.split("-")[0],l=t.split("-")[1],e=r.filter(function(e){for(var t=e.priceDetail,a=!1,r=t.length-1;0<=r;r--)if(t[r].goodsName===l&&t[r].platform===n){a=!0;break}return a}),r=r.filter(function(e){for(var t=e.priceDetail,a=!1,r=t.length-1;0<=r;r--)if(t[r].goodsName===l&&t[r].platform===n){a=!0;break}return!a}),e.sort(function(e,t){e=o.getTargetPrice(e,l),t=o.getTargetPrice(t,l);return"ascending"===a?e-t:t-e}),o.setState({sortParams:{prop:t,order:a},stores:e.concat(r)}))},o.state={loading:!1,columns:[{width:150,prop:"storeName",fixed:"left",align:"center",render:function(e){return v().createElement("div",{className:"modifiedCell ellipsis",title:e.storeName},e.storeName)}}],stores:[],platforms:[],token:"",sortParams:{}},o}r()(e,t);var a=e.prototype;return a.componentDidMount=function(){var e=this,t=this.props.location.query.token;this.setState({token:t},function(){return e.fetchData()})},a.fetchData=function(){var t=this;this.setState({loading:!0});var e=this.state.token;o.h.post("/price/list/monitors",{token:e}).then(function(e){200!==e.status&&304!==e.status||(e=e.data.result,t.generateColumns(e)),t.setState({loading:!1})}).catch(function(e){return n.Z.error(e.toString())})},a.generateColumns=function(p){for(var f,e=this.state,g=e.platforms,d=e.stores,h=p.length-1;0<=h;h--)p[h].configDetailVoList&&function(){var e=p[h].configDetailVoList;0===h&&(f=e[1].topicTypeValue);for(var t=!1,a=g.length-1;0<=a;a--)e[0].topicValue===g[a].label&&(t=!0);t||g.push({label:e[0].topicValue,goods:[]});for(var r=!1,n=d.length-1;0<=n;n--)d[n].storeName===e[1].topicValue&&(r=!0);r||d.push({storeName:e[1].topicValue,priceDetail:[]});for(var l=e[0].topicValue,o=e[2].topicValue,i=g.length-1;0<=i;i--)if(g[i].label===l){for(var s,c=g[i].goods,u=!1,m=c.length-1;0<=m;m--)c[m].label===o&&(u=!0);u||(s=12*o.length+26,c.push({label:o,prop:l+"-"+o,width:s,align:"center",sortable:"custom",renderHeader:function(e){return v().createElement("span",null,o)},render:function(e){var e=e.priceDetail.filter(function(e){return e.goodsName===o&&e.platform===l})[0],t="modifiedCell";if(e)switch(e.flag){case 0:break;case 1:t+=" increasing";break;case 2:t+=" decreasing"}return e?v().createElement("div",{className:t},0<e.price?e.price:"已下架"):v().createElement("div",{className:t},"-")}}))}}();for(var t=this.state.columns,a=g.length-1;0<=a;a--)t.push({label:g[a].label,subColumns:g[a].goods});t[0].label=f,d=this.generateRows(d,p),this.setState({stores:d,platforms:g,columns:t})},a.generateRows=function(e,t){for(var a=d().deepClone(e),r=t.length-1;0<=r;r--)for(var n=t[r].configDetailVoList,l=0;l<n.length;l++)for(var o=n[0].topicValue,i=n[1].topicValue,s=n[2].topicValue,c=a.length-1;0<=c;c--)if(a[c].storeName===i){var u=a[c].priceDetail;if(0===u.length)u.push({goodsName:s,price:t[r].takePrice,platform:o,flag:t[r].flag});else{for(var m=!1,p=void 0,f=void 0,g=u.length-1;0<=g;g--)u[g].goodsName===s&&u[g].platform===o&&(m=!0,p=u[g].price,f=g);m?t[r].takePrice<p&&a[c].priceDetail.splice(f,1,{goodsName:s,price:t[r].takePrice,platform:o,flag:t[r].flag}):a[c].priceDetail.push({goodsName:s,price:t[r].takePrice,platform:o,flag:t[r].flag})}}return a},a.getTargetPrice=function(e,t){for(var a=d().deepClone(e).priceDetail,r=a.length-1;0<=r;r--)if(a[r].goodsName===t)return a[r].price},a.render=function(){var e=this.state,t=e.loading,a=e.stores,r=e.columns,n=e.sortParams,e=document.documentElement.clientHeight-70;return v().createElement("div",{className:"chartPage"},v().createElement("div",{className:"wrap"},t?v().createElement(l.Loading,{fullscreen:!0}):0<a.length?v().createElement("div",null,v().createElement("ul",{className:"description"},v().createElement("li",{className:"item"},v().createElement("div",{className:"square green"}),v().createElement("span",null,"涨价")),v().createElement("li",{className:"item"},v().createElement("div",{className:"square red"}),v().createElement("span",null,"降价"))),v().createElement(l.Table,{style:{width:"100%"},columns:r,data:a,onSortChange:this.handleSort,border:!0,emptyText:"暂无数据",maxHeight:e,defaultSort:n})):v().createElement("div",{className:"noDataTips"},"暂无数据")))},e}(v().Component)}}]);