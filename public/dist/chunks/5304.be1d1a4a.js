(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5304],{35304:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>I});var a=n(37316),i=n.n(a),r=n(67154),o=n.n(r),t=n(85354),s=n.n(t),a=n(67294),h=n.n(a),r=n(55609),E=n(55815),l=n(39432),m=n(65556),c=n(70715),d=n(90126),t=function(a){function e(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(r=a.call.apply(a,[this].concat(t))||this).chartRef=void 0,r.dimensions=void 0,r.source=void 0,r.chartLength=0,r.color=void 0,r.onChartReady=function(e){r.chartRef=e},r.setValue=function(e,i){r.chartLength=e.length,r.color=c.Fq.slice(),r.dimensions=["日期"],r.source=JSON.parse((0,m.WZ)(e)).reduce(function(n,e,a){r.dimensions.push(e.name);var t=d.fv[e.name.toLocaleLowerCase()];return t&&r.color.splice(a,0,t[""===i?1:3===i?0:2]),e.dateList.forEach(function(e,t){0===a?n.push([e.date,3===i?e.negative:8===i?e.positive:e.count]):n[t].push(3===i?e.negative:8===i?e.positive:e.count)}),n},[])},r.getOption=function(){return{grid:{top:80,left:20,right:40,bottom:40,containLabel:!0},color:r.color,dataset:[{source:r.source,dimensions:r.dimensions}],legend:{top:40,left:20,itemWidth:14,itemHeight:12,type:"scroll",pageIconSize:12,icon:c.W4.lineRing},dataZoom:[{show:"slider",bottom:15,xAxisIndex:0,height:15,handleSize:"100%",showDetail:!1}],tooltip:{trigger:"item",formatter:function(e){var t=e.name,n=e.marker,a=e.seriesName,i=e.seriesIndex,i=e.data[i+1];return'<span class="yt_echart_tooltip_title">\n        声量<span style="color: #8C8C8C;font-weight: 500;">（'+t+"）</span></span><br />"+n+" "+a+"："+l.ZP.getApproximateNum(i)}},xAxis:{type:"category",boundaryGap:!1,axisLabel:{formatter:function(e){return(0,l.yV)(r.dateType,e)}}},yAxis:{type:"value"},series:Array.from({length:r.chartLength}).map(function(e,t){return{type:"line"}})}},r}return s()(e,a),e.prototype.renderChart=function(e,t){this.setValue(e,t),this.chartRef.clear(),this.chartRef.setOption(this.getOption())},e}(h().PureComponent),u=n(8201),p=n(98191),f=n(50976),g=n(94644),a=n(45697),a=n.n(a),t=function(i){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=i.call.apply(i,[this].concat(t))||this)._handleOnMoreClick=function(e){var t=n.props.title;"image"===e&&n.chartRef?(0,g._v)(n.chartRef,t):"data"===e&&(0,g.aT)([[n.dimensions].concat(n.source)],t)},n}s()(e,i);var t=e.prototype;return t.componentDidUpdate=function(e){var t=e.data,n=this.props.data,e=t?t.dataList:void 0,t=n?n.dataList:void 0;(0,u.P)(n)&&JSON.stringify(e)!==JSON.stringify(t)&&this.renderChart(),!(0,u.P)(n)&&this.chartRef&&(this.chartRef=void 0)},t.renderChart=function(){var e=this.props,t=e.data,e=e.aspectEmotion;(0,u.P)(t)&&this.chartRef&&i.prototype.renderChart.call(this,t.dataList,e)},t.render=function(){var e=this.props,t=e.data,n=e.loading,a=e.title,i=e.onClick,e=e.titleOverlay;return h().createElement(u.Z,{data:t,loading:n,className:"yt_social_analysis_top_detail_trend_chart_wrapper",renderTitle:h().createElement(p.Z,{onMoreClick:this._handleOnMoreClick,title:a,titleOverlay:e,data:""})},h().createElement("div",{className:"content"},h().createElement("div",{className:"info_section"},t&&h().createElement(h().Fragment,null,h().createElement("div",{className:"info_main"},l.ZP.getApproximateNum(t.total)),!!t.near30Total&&h().createElement("div",{className:"info_bottom"},h().createElement("span",{className:"bottom_content"},"近30天总量 ",h().createElement("span",null,l.ZP.getApproximateNum(t.near30Total))),h().createElement("span",{className:"bottom_content"},"近30天平均",h().createElement("span",null,l.ZP.getApproximateNum(Math.ceil(t.near30Total/30))))))),h().createElement(f.Z,{option:{},className:"chart_section yt_echarts_style",theme:"yunting_multi_color",onChartReady:this.onChartReady,style:{height:"100%"},onEvents:{click:i}})))},e}(t);const v=t;t.propTypes={data:a().any,title:a().string,loading:a().bool,total:a().number};var _=n(92360),y=n(25022),t=n(30381),S=n.n(t),t=function(n){function e(e){var t=n.call(this,e)||this;return t._handleOnShowAllContentClick=function(){t.setState({isCollapse:!t.state.isCollapse})},t.msgElm,t.state={showCollapse:!1,isCollapse:!1},t}s()(e,n);var t=e.prototype;return t.componentDidMount=function(){var e=this.props.index;this.msgElm=document.getElementById("detail_content_"+e),this.msgElm&&138<this.msgElm.clientHeight&&this.setState({showCollapse:!0,isCollapse:!0})},t.render=function(){var t=this,e=this.props,n=e.content,a=e.index,i=e.className,r=this.state,e=r.showCollapse,r=r.isCollapse;return h().createElement("div",{className:"yt_social_detail_content_wrapper "+(i||""),style:{height:r?138:"unset"}},h().createElement("div",{id:"detail_content_"+a,dangerouslySetInnerHTML:{__html:n}}),e&&h().createElement("div",{className:"content_toggle "+(r?"collapsed":"showed"),ref:function(e){return t.showAllRef=e},onClick:this._handleOnShowAllContentClick},r?"点击显示全文":"收起全文"))},e}(h().PureComponent);const C=t;t.propTypes={content:a().string,index:a().number,className:a().string};var N=n(7810),t=function(e){var t=e.data,n=e.loading,a=e.pageIndex,i=e.pageSize,r=e.onPageChange,o=e.onPageSizeChange,e=e.onMsgClick;return h().createElement(u.Z,{className:"yt_social_tag_messagelist_wrapper",loading:n,data:t,renderTitle:h().createElement("div",null,h().createElement("span",null,"消息详情"),h().createElement(_.Button,{type:"primary",onClick:e},"前往消息模块下载"))},t&&h().createElement("div",{className:"msg_content"},h().createElement("div",{className:"msg_total"},"共",h().createElement("span",null,t.total),"条消息"),t.list&&0<t.list.length&&t.list.map(function(e,t){return h().createElement("div",{key:e.username+e.createTime,className:"msg_item"},h().createElement("div",{className:"msg_top"},h().createElement("span",{className:"user_info"},h().createElement("img",{src:e.userImage||N}),h().createElement("span",null,e.username)),h().createElement("span",{className:"msg_info"},h().createElement("span",null,S()(e.createTime).format("YYYY-MM-DD HH:MM")),h().createElement("span",null,e.type))),h().createElement(C,{className:"msg",index:t,content:e.content}))}),h().createElement(y.Z,{currLength:t.list.length,pageNum:t.list&&t.list.length,onPageChange:r,onSizeChange:o,total:t.total||0,pageIndex:a,pageSize:i})))};const b=t;function R(e){var t=e.reduce(function(e,t){return e+t.count},0);return{datasets:[{dimensions:["机型","声量","占比"],source:e.map(function(e){return[e.type,e.count,e.count/t]})}]}}t.PropTypes={data:a().any,pageIndex:a().number,pageSize:a().number,loading:a().bool,onPageChange:a().func,onPageSizeChange:a().func};t=function(e){var i=e.title,r=e.data,a=e.otherNum,t=e.loading,e=h().useState(void 0),o=e[0],s=e[1];return h().useEffect(function(){var t,e,n;o&&((0,u.P)(r)?(t=r,n=i,0<(e=a)&&t.push({type:"其他",count:e}),n={title:{text:n},tooltip:{triger:"item",formatter:function(e){return e.marker+" "+e.name+"："+e.value+"（"+e.percent+"%）"}},series:[{type:"pie",radius:"60%",hoverAnimation:!1,center:["50%","55%"],label:{position:"outside",color:"#000",formatter:function(e){e=e.data;return["{a|"+e.name+"}","{b|"+(e.value/t.reduce(function(e,t){return e+t.count},0)*100).toFixed(2)+"% }"].join("\n")},rich:{a:{color:"#000000"},b:{color:"#8C8C8C",lineHeight:14,verticalAlign:"bottom"}}},labelLine:{smooth:!0,length:13,lineStyle:{color:"#bfbfbf"}},data:R(t).datasets[0].source.map(function(e,t){t=t<8;return{value:e[1],name:e[0],label:{show:t},labelLine:{show:t},emphasis:{label:{show:t},labelLine:{show:t}}}})}]},o.clear(),o.setOption(n)):s(void 0))},[r,o]),h().createElement(u.Z,{className:"yt_social_detail_pie_wrapper",data:r,loading:t,renderTitle:h().createElement(p.Z,{title:i,data:r,onMoreClick:function(e){var t,n,a;t=o,n=r,a=i,"image"===(e=e)?(0,g._v)(t,a):"data"===e&&(n=[(n=R(n).datasets)[0].dimensions].concat(n[0].source),(0,g.aT)([n],a))}})},h().createElement(f.Z,{theme:"yunting_multi_color",className:"yt_echarts_style",option:{},style:{width:"100%",height:"100%"},onChartReady:function(e){return s(e)}}))};const T=t;t.propTypes={title:a().string,loading:a().bool,data:a().oneOfType([a().string,a().object]),onClick:a().func};const P=function(e){var t=e.trendData,n=e.fetchingTrendData,a=e.messageData,i=e.pageIndex,r=e.pageSize,o=e.fetchingMessageList,s=e.onPageChange,l=e.onPageSizeChange,c=e.pageType,u=e.aspectEmotion,d=e.params,p=e.seriesLoading,m=e.seriesData,f=e.seriesOther,g=e.onSeriesClick,e=e.onMsgClick;return h().createElement("div",{className:"yt_social_tag_detail_wrapper"},h().createElement(E.Z,{title:"详情："+d.analyseName+"、"+d.aspect+"、"+d.seriesName}),h().createElement("div",{className:"content",id:"social_tag_detail_content"},h().createElement(v,{title:"指标声量走势",titleOverlay:"指标声量是指标的出现在消息中的次数。如果一个消息中含有两个两个二级指标，则在统计对应的一级指标时，则声量会被统计为2。",data:t,loading:n,aspectEmotion:u,onClick:g}),c.includes("brand")&&h().createElement(T,{title:"机型指标声量占比分析",data:m,otherNum:f,loading:p}),h().createElement(b,{data:a,loading:o,pageIndex:i,pageSize:r,onPageChange:s,onPageSizeChange:l,onMsgClick:e})))};var O=n(35239),a=n(64396),M=n(87219),A=a.Z.social.tag.detail,a=function(t){function e(e){var p=t.call(this,e)||this;return p._handleOnPageSizeChange=function(e){p.props.fetchMessageList({pageSize:e,pageIndex:1})},p._handleOnPageChange=function(e){p.props.fetchMessageList({pageIndex:e})},p._handleOnSeriesClick=function(e){e.seriesType;var t,n=e.name,a=e.seriesName,i=p.props,r=i.dateFilter,o=i.projectId,s=i.pageType,l=i.filterModel,c=i.aspectEmotion,u=i.label,d=i.trendData;"其他"!==n&&(t=l.some(function(e){return"TAG_RULE"===e.id})&&l.find(function(e){return"TAG_RULE"===e.id}).values,e=l.some(function(e){return"DEFAULT"===e.id})&&l.find(function(e){return"DEFAULT"===e.id}),l=(i=l.some(function(e){return"BRAND_SERIES"===e.id})&&l.find(function(e){return"BRAND_SERIES"===e.id}).values.some(function(e){return"SERIES"===e.id})&&l.find(function(e){return"BRAND_SERIES"===e.id}).values.find(function(e){return"SERIES"===e.id}).values)&&i.map(function(e){return e.split("_")[0]}),c={projectId:o,dateFilter:(0,M.ZP)(r,function(e){e.from=n,e.to=n}),filterModel:{label:u,emotion:(0,m.jn)(c),messageType:["QUE_ANS_QUESTION","QUE_ANS_ANSWER","WEIBO","WEIBO_REPORT","COMMON_POST","NEWS_TEXT","COMPLAINT"],filterTip:"舆情看板/标签分析/标签Top30（"+(s.includes("brand")?"品牌":"机型")+"）/声量走势"}},t&&(c.filterModel.tag=t.map(function(e){return{id:e.id,special:"tag",values:e.values}})),e&&e.values.some(function(e){return"SOURCE"===e.id})&&(c.filterModel.source=e.values.find(function(e){return"SOURCE"===e.id}).values),s.includes("brand")?(d=d.dataList.find(function(e){return e.name===a}).id,c.filterModel.brandsSeries=[{id:"brand",special:"brandsSeries",values:[d]}],i&&c.filterModel.brandsSeries.unshift({id:"series",special:"brandsSeries",values:l})):c.filterModel.brandsSeries=[{id:"series",special:"brandsSeries",values:l}],window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(c))))},p._handleOnMsgClick=function(){var e=p.props,t=e.dateFilter,n=e.projectId,a=e.pageType,i=e.aspectEmotion,r=e.filterModel,o=e.label,s=r.some(function(e){return"VOC_ASPECT"===e.id})&&r.find(function(e){return"VOC_ASPECT"===e.id}).values,l=r.some(function(e){return"TAG_RULE"===e.id})&&r.find(function(e){return"TAG_RULE"===e.id}).values,c=r.some(function(e){return"DEFAULT"===e.id})&&r.find(function(e){return"DEFAULT"===e.id}),u=r.some(function(e){return"BRAND_SERIES"===e.id})&&r.find(function(e){return"BRAND_SERIES"===e.id}).values.some(function(e){return"BRAND"===e.id})&&r.find(function(e){return"BRAND_SERIES"===e.id}).values.find(function(e){return"BRAND"===e.id}).values,e=u&&u.map(function(e){return e.split("_")[0]}),u=r.some(function(e){return"BRAND_SERIES"===e.id})&&r.find(function(e){return"BRAND_SERIES"===e.id}).values.some(function(e){return"SERIES"===e.id})&&r.find(function(e){return"BRAND_SERIES"===e.id}).values.find(function(e){return"SERIES"===e.id}).values,r=u&&u.map(function(e){return e.split("_")[0]}),o={projectId:n,dateFilter:t,filterModel:{emotion:(0,m.jn)(i),messageType:["QUE_ANS_QUESTION","QUE_ANS_ANSWER","WEIBO","WEIBO_REPORT","COMMON_POST","NEWS_TEXT","COMPLAINT"],label:o},filterTip:"舆情看板/标签分析/标签Top30（"+(a.includes("brand")?"品牌":"机型")+"）/消息详情"};l&&(o.filterModel.tag=l.map(function(e){return{id:e.id,special:"tag",values:e.values}})),c&&c.values.some(function(e){return"SOURCE"===e.id})&&(o.filterModel.source=c.values.find(function(e){return"SOURCE"===e.id}).values),s&&(o.filterModel.vocAspect=(0,d.ou)(s)),a.includes("brand")?(o.filterModel.brandsSeries=[{id:"brand",special:"brandsSeries",values:e}],u&&o.filterModel.brandsSeries.unshift({id:"series",special:"brandsSeries",values:r})):o.filterModel.brandsSeries=[{id:"series",special:"brandsSeries",values:r}],window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(o)))},p.queryParam=JSON.parse(decodeURIComponent(window.location.search.substring(1))),p.state={pageType:p.queryParam.pageType,aspectEmotion:p.queryParam.aspectEmotion,params:{analyseName:p.queryParam.name,aspect:p.queryParam.aspect,seriesName:p.queryParam.aspectEmotion?3===p.queryParam.aspectEmotion?"负面":"正面":"全部"}},p.event={onSeriesClick:p._handleOnSeriesClick,onPageChange:p._handleOnPageChange,onPageSizeChange:p._handleOnPageSizeChange,onMsgClick:p._handleOnMsgClick},p}s()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.props.fetchDatas(o()({},this.queryParam,{projectId:O.t.get(O.V.curProject).id}))},n.render=function(){return h().createElement(P,o()({},this.props,this.state,this.event))},e}(h().PureComponent);const I=(0,r.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return o()({},e[A],{seriesLoading:t.effects[A+"/fetchSeriesData"]||!1,fetchingTrendData:t.effects[A+"/fetchTrendData"]||!1,fetchingMessageList:t.effects[A+"/fetchMessageList"]||!1})},function(t){return{fetchDatas:function(e){return t({type:A+"/fetchDatas",payload:e})},fetchMessageList:function(e){return t({type:A+"/fetchMessageList",payload:e})},save:function(e){return t({type:A+"/save",payload:e})},clean:function(e){return t({type:A+"/clean",payload:e})}}})(a)},25022:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),c=n.n(t),u=n(92360),d=n(35303),t=n(45697),t=n.n(t),p=[{label:"10项/页",value:10},{label:"20项/页",value:20},{label:"40项/页",value:40},{label:"100项/页",value:100}];const a=function(e){var t=e.onPageChange,n=e.onSizeChange,a=e.total,i=void 0===a?0:a,r=e.pageIndex,o=e.pageSize,s=e.layout,l=e.className,a=e.currLength,e=0===i?0:(r-1)*o+1,a=0===i?0:a?e+a-1:e+o-1;return 0===i?null:c().createElement("div",{className:"yt-awp-pagination "+(l||"")},c().createElement("span",{className:"total_num"},c().createElement("span",null,e+" - "+a+" "),"项，共",c().createElement("span",null," "+i+" "),"项"),c().createElement("div",{style:{textAlign:"right",float:"right"},className:"new_pagination"},c().createElement(u.Pagination,{small:!0,pageSize:o,currentPage:r,pageCount:Math.ceil(i/o),layout:0===i?"":"prev, pager, next",onCurrentChange:t}),void 0===s||s.includes("sizes")?c().createElement(d.RS,{multiple:!1,tags:!1,showSearch:!1,optionFilterProp:"label",optionLabelProp:"label",animation:"slide-up",dropdownClassName:"custom-pagination-dropdown",value:o||10,onChange:n},p.map(function(e,t){return c().createElement(d.Wx,{key:t,label:e.label,value:e.value},e.label)})):null))};t().propTypes={onPageChange:t().func,onSizeChange:t().func,total:t().number,pageIndex:t().number,pageSize:t().number,layout:t().string,className:t().string}}}]);