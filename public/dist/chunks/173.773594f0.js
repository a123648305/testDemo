(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[173],{60173:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>k});var t=n(93913),a=n.n(t),t=n(81506),l=n.n(t),t=n(85354),r=n.n(t),t=n(67154),i=n.n(t),t=n(37316),o=n.n(t),u=n(67294),h=n.n(u),m=n(92360),s=n(5133),p=n(29383),f=n(12518),g=n(72305),v=n(35303),c=n(43036),d=n(51474),C=n(36144),E=n(61409),b=n(35239),t=n(55609),y=n(64396).Z.public.menu,n=function(e){function t(){var r=e.call(this)||this;return r.handleSort=function(e,t){var n=r.state.idList,a=n[e],l=JSON.parse(JSON.stringify(n));l.splice(e,1),l.splice(1<=t?t:0,0,a),C.h.post("/folder/sort",{idList:l}).then(function(e){2e4===e.data.code&&(r.setState({idList:l}),r.props.fetchMenuList())})},r.initSortable=function(){var n=l()(r),t=n.state.idList,e=document.querySelector(".el-table table tbody");r.sortable=d.ZP.create(e,{sort:!0,animation:150,draggable:".sortable-row",filter:".unsortable-row",onEnd:function(e){var t=e.oldIndex,e=e.newIndex;n.handleSort(t,e)},onMove:function(e){return d.ZP.utils.index(e.related,".sortable-row")!==t.length-1}})},r.manualSort=function(){var e=r.state.idList;r.sortable.sort(e)},r.handleProjectChange=function(e){r.setState({projectId:e})},r.switchRemindType=function(e,t){var n=r.state.targetFolder;r.setState({dialogVisible:!0,dialogType:"toggle",targetFolder:i()({},n,{id:e,remindType:t?"NONE":"EMAIL"})})},r.handleNameChange=function(e){var t=r.state.targetFolder;r.setState({targetFolder:i()({},t,{name:e})})},r.handleAddFolder=function(){var e=r.state,t=e.targetFolder.name,e=e.projectId;0!==e.trim().length?0!==t.trim().length?C.h.post("/folder/add",{name:t,projectId:e}).then(function(e){2e4===e.data.code&&(s.Z.success("添加成功"),r.getFolderList(!0,!0),r.setState({step:2}))}):s.Z.warning("请输入文件夹名称"):s.Z.warning("请选择项目")},r.handleRenameFolder=function(){var e=r.state.targetFolder,t=e.id,e=e.name;0!==e.trim().length?C.h.post("/folder/update",{id:t,name:e}).then(function(e){2e4===e.data.code&&(s.Z.success("更新成功"),r.getFolderList(!0,!0),r.handleCancel())}):s.Z.warning("请输入文件夹名称")},r.handleDeleteFolder=function(){var e=r.state.targetFolder.id;C.h.post("/folder/delete",{id:e}).then(function(e){2e4===e.data.code&&(s.Z.success("删除成功"),r.getFolderList(!0,!0),r.handleCancel())})},r.handleUpdateFolder=function(){var e=r.state.targetFolder,t=e.id,e=e.remindType;C.h.post("/folder/remind/change",{id:t,remindType:e}).then(function(e){2e4===e.data.code&&(r.getFolderList(!1,!0),r.handleCancel())})},r.handleViewRules=function(e){var t=r.state.filterProjectId;E.mW.push({pathname:"/personalSettings/privateMessageRule",state:{projectId:t,folderName:e}})},r.handleConfirm=function(){var e=r.state,t=e.dialogType,n=e.step;switch(t){case"add":1===n?r.handleAddFolder():r.handleCancel();break;case"rename":r.handleRenameFolder();break;case"delete":r.handleDeleteFolder();break;case"toggle":r.handleUpdateFolder()}},r.handleCancel=function(){r.setState({dialogVisible:!1,targetFolder:{name:"",id:"",remindType:""}},function(){r.setState({step:1})})},r.state={targetFolder:{id:"",name:"",remindType:""},columns:[{label:"",prop:"paddingLeft",width:50,render:function(){return h().createElement("div",{className:"move_icon_container"},h().createElement("i",{className:"icon-cem_move"}))}},{label:"文件夹名称",prop:"name"},{label:"消息数",prop:"count"},{label:"提醒方式",prop:"remindType",render:function(e,t,n){e=e.remindType;return h().createElement("span",null,"EMAIL"===e?"邮件":"无")}},{label:"提醒状态",prop:"remindType",render:function(t,e,n){var a=t.remindType;return h().createElement(c.Z,{overlay:"EMAIL"===a?"已启用":"已停用",placement:"top"},h().createElement("span",null,h().createElement(m.Switch,{value:"EMAIL"===a,onText:"",offText:"",onColor:"#0747A6",offColor:"#CCCCCC",onChange:function(e){return r.switchRemindType(t.id,e)}})))}},{label:"操作",width:250,render:function(e,t,n){var a=e.id,l=e.name;e.remindType;return"私人消息"!==l&&h().createElement("span",null,h().createElement("span",{className:"operation_columns",onClick:function(){return r.handleViewRules(e.name)}},"查看规则"),h().createElement("span",{className:"operation_columns",onClick:function(){r.setState({dialogVisible:!0,dialogType:"rename",targetFolder:{id:a,name:l}})}},"重命名"),h().createElement("span",{className:"operation_columns",style:{marginRight:"0"},onClick:function(){r.setState({dialogVisible:!0,dialogType:"delete",targetFolder:{id:a}})}},"删除"))}},{label:"",prop:"paddingRight",width:50}],loading:!1,list:[],idList:[],filterProjectId:b.t.get(b.V.curProject).id,projectId:"",dialogVisible:!1,dialogType:"",step:1},r}r()(t,e);var n=t.prototype;return n.getFolderList=function(e,t){var n=this,a=this.state.filterProjectId;this.setState({loading:!0},function(){C.h.post("/folder/list",{projectId:a}).then(function(e){e=e.data.result;n.setState({list:e||[],idList:e.map(function(e){return e.id})},function(){t&&n.manualSort()})}).finally(function(){n.setState({loading:!1}),n.initSortable(),e&&n.props.fetchMenuList()})})},n.componentDidMount=function(){this.getFolderList(!1,!1)},n.componentDidUpdate=function(){var e=this.state.list,t=document.querySelectorAll(".el-table__body tbody tr");if(t&&0<t.length)for(var n=0;n<t.length;n++)for(var a=0;a<e.length;a++)t[n].children[1].innerText===e[a].name&&t[n].setAttribute("data-id",e[a].id)},n.render=function(){var t=this,e=this.state,n=e.columns,a=e.list,l=e.loading,r=e.dialogType,i=e.dialogVisible,o=e.targetFolder,s=e.step,c=e.projectId,d=e.filterProjectId;return h().createElement("div",{className:"personal-folder"},h().createElement(f.Z,{title:"个人文件夹"}),h().createElement("div",{className:"personal-folder-header"},h().createElement(g.Z,{list:this.projectOptions,onChange:function(e){return t.projectOptions=e}}),h().createElement(m.Button,{onClick:function(){return t.setState({dialogVisible:!0,dialogType:"add",projectId:d})}},"添加文件夹")),h().createElement("div",{className:"personal-folder-table"},h().createElement(m.Loading,{loading:l,text:"拼命加载中"},h().createElement(p.Z,{columns:n,data:a,rowClassName:function(e,t){return t===a.length-1?"sortable-row unsortable-row":"sortable-row"}})),h().createElement(m.Dialog,{title:"rename"===r?"重命名个人文件夹":"add"===r&&1===s?"添加个人文件夹":"",size:"tiny",visible:i,onCancel:function(){return t.handleCancel()},customClass:"toggle"===r?"without-padding-dialogbody":"",lockScroll:!0},h().createElement(m.Dialog.Body,null,"delete"===r&&h().createElement(u.Fragment,null,h().createElement("div",{className:"dialog-title"},h().createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"是否删除该个人文件夹？"),h().createElement("div",{className:"delete-tips"},"删除后，原属于该文件夹的消息将移出到",h().createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"“私人消息”"),"中")),"toggle"===r&&h().createElement("div",{className:"dialog-title"},h().createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"是否","EMAIL"===o.remindType?"启":"停","用消息提醒"),("add"===r&&1===s||"rename"===r)&&h().createElement(u.Fragment,null,"add"===r&&h().createElement("div",{className:"form-item"},h().createElement("label",null,"项目"),h().createElement(v.RS,{tags:!1,multiple:!1,value:c,optionLabelProp:"label",placeholder:"请选择项目",onChange:this.handleProjectChange},b.t.get(b.V.project).map(function(e,t){return h().createElement(v.Wx,{key:t,label:e.name,value:e.id},e.name)}))),h().createElement("div",{className:"form-item"},h().createElement("label",null,"名称"),("add"===r||"rename"===r)&&h().createElement(m.Input,{maxLength:20,value:o.name,placeholder:"请输入名称",onChange:this.handleNameChange}))),"add"===r&&2===s&&h().createElement(u.Fragment,null,h().createElement("div",{className:"dialog-title"},h().createElement("i",{className:"icon-cem_complete1",style:{color:"#00B76E",marginRight:"8px",fontSize:"20px"}}),"添加个人文件夹成功"),h().createElement("div",{className:"add-success"},"点击进入",h().createElement("a",{onClick:function(){return t.handleViewRules()}},"私人消息处理规则"),"列表，为新建文件夹配置规则"))),h().createElement(m.Dialog.Footer,{className:"dialog-footer"},h().createElement(m.Button,{type:"primary",onClick:this.handleConfirm},"delete"===r?"是":"确定"),!("add"===r&&2===s)&&h().createElement(m.Button,{onClick:function(){return t.handleCancel()}},"delete"===r?"否":"取消")))))},a()(t,[{key:"projectOptions",get:function(){var e=this.state.filterProjectId;return[{name:"项目",list:b.t.get(b.V.project),value:e,singleSel:!0}]},set:function(e){var t=this,e=e[0].value;this.setState({filterProjectId:e[0]||""},function(){return t.getFolderList(!1,!1)})}}]),t}(u.Component);const k=(0,t.connect)(function(e){e.loading;e=o()(e,["loading"]);return i()({},e[y])},function(t){return{fetchMenuList:function(e){return t({type:y+"/fetchMenuList",payload:e})}}})(n)},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(67154),u=n.n(a),l=n(37316),h=n.n(l),t=n(85354),r=n.n(t),a=n(67294),m=n.n(a),l=n(45697),t=n.n(l),l=n(94184),p=n.n(l),a=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,l=e.block,r=e.indeterminate,i=e.value,o=e.checked,s=e.defaultChecked,c=e.onChange,d=e.disabled,e=h()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),c={value:i,checked:o,defaultChecked:s,onChange:c,disabled:d},a=p()(t,((d={})[t+"-disabled"]=c.disabled,d[t+"-block"]=l,d[t+"-indeterminate"]=r,d),a);return m().createElement("label",u()({tabIndex:c.disabled?-1:0,className:a},e),m().createElement("input",u()({type:"checkbox",className:t+"-input"},c)),m().createElement("span",{className:t+"-status"}),n&&m().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const i=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>o});var a=n(24473),l=n(67154),s=n.n(l),r=n(37316),c=n.n(r),t=n(85354),i=n.n(t),l=n(67294),d=n.n(l),r=n(45697),t=n.n(r),r=n(94184),u=n.n(r),r=function(l){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=l.call.apply(l,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return i()(e,l),e.prototype.render=function(){var l=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,r=(e.onChange,e.values),i=e.checkedList,o=e.block,e=c()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=r?r.map(function(e,t){var n=0!==i.length&&-1!==i.indexOf(e);return d().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return l.handleCheckBoxChange(e)},block:o},e)}):d().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==i.length&&-1!==i.indexOf(a);return d().cloneElement(e,{checked:a,key:t,block:n.block||o,onChange:function(){var e=n.value;l.handleCheckBoxChange(e)}})}});return d().createElement("div",s()({className:u()(t,a)},e),n)},e}(l.Component);r.defaultProps={prefixCls:"wt-checkbox-group"},r.propTypes={onChange:t().func,values:t().array,block:t().bool};const o=r;var h=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},l=function(e){function t(){return e.apply(this,arguments)||this}return i()(t,e),t.prototype.render=function(){var e=this.props,t=h(e);return d().createElement("label",{className:e.className,title:e.children},d().createElement("div",{className:"checkbox"},d().createElement("input",s()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),d().createElement("div",{className:"checkbox-body"}))," ",d().createElement("span",null,e.children))},t}(l.Component);l.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},72305:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var a=n(49064),r=n.n(a),t=n(85354),i=n.n(t),a=n(67294),u=n.n(a),t=n(93913),l=n.n(t),h=n(85151);const o=function(t){function e(e){var n=t.call(this,e)||this;return n.handleClear=function(e){var t=n.state.list;t.forEach(function(e){return e.sel=!1}),n.setState({list:t},function(e){return n.commitUserSel()})},n.hoverDropToggle=function(e){var t;e?(t=setTimeout(function(){n.setState({open:e,timeout:null})},100),n.setState({timeout:t})):(clearTimeout(n.state.timeout),n.setState({open:e,timeout:null}))},n.clickDropToggle=function(e){n.setState({open:!n.state.open})},n.stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.closeDrop=function(e){n.setState({open:!1})},n.state={list:JSON.parse(JSON.stringify(e.list||[])),searchKeyWords:"",open:!1,timeout:""},n}i()(e,t);var n=e.prototype;return n.search=function(){this.setState({searchKeyWords:this.refs.searchInput.value})},n.handleChecked=function(t){var n=this,e=this.state.list;this.props.singleSel?e.forEach(function(e){e.sel=e.id===t}):e.forEach(function(e){e.id===t&&(e.sel=!e.sel)}),this.setState({list:e},function(e){return n.commitUserSel()})},n.handleCheckedAll=function(){var t=this,n=!this.checkedAll,e=this.state.list;e.forEach(function(e){return e.sel=n}),this.setState({list:e},function(e){return t.commitUserSel()})},n.commitUserSel=function(){this.props.onSel(this.selList)},n.UNSAFE_componentWillReceiveProps=function(t,e){var n;(t.list||t.value)&&((n=JSON.parse(JSON.stringify(t.list))).forEach(function(e){e.sel=-1!==t.value.indexOf(e.id)}),this.setState({list:n}))},n.componentDidMount=function(){var e,t=this;this.props.value&&((e=JSON.parse(JSON.stringify(this.state.list))).forEach(function(e){e.sel=-1!==t.props.value.indexOf(e.id)}),this.setState({list:e}))},n.render=function(){var n=this,e=this.props,t=e.classNames,a=e.style,l=e.title,r=e.selectPosition,i=e.special,o=e.singleSel,s=this.state,c=s.list,d=s.searchKeyWords,e=s.open,s=0<d.length?this.searchList:c,c=c.find(function(e){return n.props.list.value===e.id});return u().createElement("div",{className:(t||"")+" back-search-select-wrap",onClick:function(e){n.stop(e)},style:a,onMouseEnter:function(){n.hoverDropToggle(!0)},onMouseLeave:function(){n.hoverDropToggle(!1)}},u().createElement("div",{className:e?"open sel-wrap":"sel-wrap"},u().createElement("div",{className:"span-wrap"},u().createElement("span",{className:"title"},l+(i?"":" : ")),!i&&(0<this.selList.length?this.selList.map(function(e,t){return u().createElement("span",{key:t},e.name,t===n.selList.length-1?"":" ,")}):u().createElement("span",null,o&&c?c.name:"全部"))),u().createElement("i",{className:"icon-cem_pull-down-or-take-up"})),e&&u().createElement("div",{className:"allSelContent",style:{left:"left"===r?"0":"",right:"right"===r?"0":""}},u().createElement("div",{className:"search"},u().createElement("p",null,u().createElement("input",{value:d,placeholder:"请输入搜索关键词",ref:"searchInput",type:"text",onChange:function(e){return n.search()}})),u().createElement("p",null,u().createElement("span",{onClick:function(e){return n.handleClear()}},"清除已选项目"))),0<s.length?u().createElement("div",{className:"all"},!o&&d.length<1&&u().createElement(h.Jg,{checked:this.checkedAll,indeterminate:this.indeterminate,onChange:function(){return n.handleCheckedAll()},block:!0},"全选"),s.map(function(e){return n.props.singleSel?u().createElement("p",{className:e.sel?"singleSel sel":"singleSel",key:e.id,onClick:function(){return n.handleChecked(e.id)}},e.name):u().createElement(h.Jg,{key:e.id,value:e.id,checked:e.sel,onChange:function(){return n.handleChecked(e.id)},block:!0},e.name)})):u().createElement("div",{className:"all"},"无选项")))},l()(e,[{key:"selList",get:function(){return this.state.list.filter(function(e,t){return e.sel})}},{key:"checkedAll",get:function(){return this.state.list.every(function(e){return e.sel})}},{key:"indeterminate",get:function(){return!this.checkedAll&&this.state.list.some(function(e){return e.sel})}},{key:"searchList",get:function(){var t=this;return this.state.list.filter(function(e){if(-1!==e.name.toLocaleLowerCase().indexOf(t.state.searchKeyWords.trim().toLocaleLowerCase()))return!0})}}]),e}(a.Component);var s=function(l){function e(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=l.call.apply(l,[this].concat(n))||this).state={filterList:[],inputVal:""},t.inputChange=function(e){t.setState({inputVal:e.target.value})},t.keywordChange=function(e){},t}i()(e,l);var t=e.prototype;return t.handleSel=function(t,n){var e=this.props,a=e.list,e=e.onChange;a.forEach(function(e){e.name===t&&(e.value=n.map(function(e){return e.id}))}),e(a)},t.UNSAFE_componentWillReceiveProps=function(e,t){e&&this.setState({filterList:e.list})},t.componentDidMount=function(){},t.buildHeaderFilter=function(){var n=this;r()(this.props);var e=this.state,e=(e.inputVal,e.filterList);return u().createElement("div",{className:"back-end-filter"},e.map(function(e,t){return u().createElement(o,{key:t,list:e&&e.list,value:e.value||[],onSel:n.handleSel.bind(n,e.name),title:e.name,singleSel:e.singleSel})}))},t.render=function(){return this.buildHeaderFilter()},e}(a.Component)}}]);