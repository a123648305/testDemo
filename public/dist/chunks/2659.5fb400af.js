(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[2659],{42659:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(85354),n=a.n(s),i=a(67294),d=a.n(i),c=a(5133),r=a(29383),o=a(92360),l=a(36144),u=a(55815),m=a(88308),h=a(45697),t=a.n(h),s={placeholder:t().string,value:t().string,disabled:t().bool,customItem:t().func,fetchSuggestion:t().func,popperClass:t().string,triggerOnFocus:t().bool,onSelect:t().func,searchBtnClass:t().string,customLabel:t().func,delLabel:t().func,searchClick:t().func},h={placeholder:"",value:"",disabled:!1,triggerOnFocus:!0,searchBtnValue:"添加",delLabel:function(e){console.log("删除的数据："+e)},searchClick:function(e,t){console.log("列表数据："+e),console.log("选中数据："+t)},onSelect:function(e){console.log("该建议的数据如下"),console.log(e)}},t=function(t){function e(e){var s=t.call(this,e)||this;s.checkHide=function(e){var t=s.state.suggestionShow,e=e.target||window.event.srcElement;!t||s.closest(e,".search-input")||s.closest(e,".auto-suggestion-list")||s.suggestionsHide()};e=s.props.value;return s.state={value:e,suggestionShow:!1,data:[]},s}n()(e,t);var s=e.prototype;return s.componentDidMount=function(){document.body.addEventListener("click",this.checkHide,!1),this.resetData()},s.componentWillUnmount=function(){document.body.addEventListener("click",this.checkHide,!1)},s.resetData=function(){var e=this.props.fetchSuggestion,t=document.querySelector(".search-input").value,e=e(t);this.setState({value:t,data:e})},s.focus=function(){var e=this.props.triggerOnFocus;this.state.data;e&&this.setState({suggestionShow:!0})},s.closest=function(e,t){for(var s=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e&&!s.call(e,t);)e=e.parentElement;return e},s.suggestionsHide=function(){this.setState({suggestionShow:!1})},s.search=function(){var e=this.state.data,t=this.props;(0,t.searchClick)(e,t.seclectData)},s.fetchSearch=function(){var e=this.state.value;return(0,this.props.fetchFunc)(e)},s.selectSuggestion=function(e){(0,this.props.onSelect)(e),this.setState({suggestionShow:!1})},s.delLabel=function(e){(0,this.props.delLabel)(e)},s.render=function(){var t=this,e=this.props,s=e.placeholder,n=e.customItem,a=e.popperClass,i=e.seclectData,c=e.searchBtnValue,r=e.disabled,o=e.customLabel,l=e.labelClass,u=this.state,m=u.value,e=u.suggestionShow,u=u.data,h=l?"seclect-label-wrap "+l:"seclect-label-wrap",a=a?"auto-suggestion-list "+a:"auto-suggestion-list";return d().createElement("div",{className:"auto-seatch-wrap"},d().createElement("div",{className:"content"},d().createElement("div",{className:"main-cont"},d().createElement("ul",{className:"select-labels"},i.map(function(e){return d().createElement("li",{className:h,key:e.id},d().createElement("span",{className:"seclect-label"},o(e)),d().createElement("i",{className:"icon-cem_delete",onClick:t.delLabel.bind(t,e)}))})),d().createElement("div",{className:"search-input-cont"},d().createElement("input",{className:"search-input",type:"text",disabled:r,value:m,placeholder:s,onFocus:this.focus.bind(this),onChange:this.resetData.bind(this)}))),d().createElement("span",{className:"search-btn",onClick:this.search.bind(this)},c instanceof Function?c():c)),e&&0<u.length&&d().createElement("ul",{className:a},u.map(function(e){return d().createElement("li",{className:"auto-suggestion-item",onClick:t.selectSuggestion.bind(t,e),key:e.id},n(e))})))},e}(i.Component);t.propTypes=s,t.defaultProps=h;const p=t;var f=function(t){function e(e){var n=t.call(this,e)||this,e=n.props.location.state.id;return n.state={name:"",isEdit:!1,id:e,outUsers:[],curOutUsers:[],inUsers:[],seclectData:[],columns:[{label:"用户",prop:"user",render:function(e,t,s){return d().createElement("div",{className:"user-info"},d().createElement("img",{className:"user-pic",src:e.userHeadUrl||a(7810)}),d().createElement("span",{className:"user-name"},e.username),d().createElement("span",{className:"user-email"},e.email))}},{label:"操作",prop:"operation",width:200,render:function(e,t,s){return d().createElement("div",{className:"operation suggestion-del operation_columns",onClick:function(){return n.contentConfirm(e)}},"移出")}}]},n}n()(e,t);var s=e.prototype;return s.componentDidMount=function(){this.resetTeam()},s.resetTeam=function(){var n=this,e=this.state.id;l.h.post("/team/user/list",{id:e}).then(function(e){var t=e.data.result,s=t.outUsers,e=t.inUsers,t=t.name;n.setState({outUsers:s,curOutUsers:s,inUsers:e,name:t}),n.autosearch.resetData()})},s.closeInput=function(t){var s=this,e=this.state.id;l.h.post("/team/update",{id:e,name:t}).then(function(e){c.Z.success("修改成功"),s.setState({name:t})}).catch(function(e){s.resetTeam()})},s.customLabel=function(e){return e.username},s.customItem=function(e){return d().createElement("div",{className:"user-info"},d().createElement("div",{className:"user-pic"},d().createElement("img",{src:e.userHeadUrl||a(7810)})),d().createElement("span",{className:"user-name"},e.username),d().createElement("span",{className:"user-email"},e.email))},s.fetchSuggestion=function(n){var e=this.state.curOutUsers,a=[];return e.forEach(function(e){var t=-1<e.username.indexOf(n),s=-1<e.email.indexOf(n);(t||s)&&a.push(e)}),a},s.search=function(e,t){var s,n,a,i=this;0!==t.length&&(s=(n=this.state).id,n=n.name,a=[],t.forEach(function(e){a.push(e.id)}),l.h.post("/team/user/add",{id:s,name:n,users:a}).then(function(e){c.Z.success("修改成功"),i.resetTeam(),i.setState({seclectData:[]}),i.autosearch.suggestionsHide(),i.resetTeam()}))},s.selectSuggestion=function(s){var n=this,e=this.state,a=e.curOutUsers,i=e.seclectData;a.forEach(function(e,t){if(e.id===s.id)return i.push(e),a.splice(t,1),n.setState({curOutUsers:a,seclectData:i}),n.autosearch.resetData(),!1})},s.delLabel=function(s){var n=this,e=this.state,a=e.curOutUsers,i=e.seclectData;i.forEach(function(e,t){if(e.id===s.id)return a.push(e),i.splice(t,1),n.setState({curOutUsers:a,seclectData:i}),n.autosearch.resetData(),!1})},s.contentConfirm=function(t){var s=this;o.MessageBox.confirm("确认从该团队中移出此用户?","提示",{type:"warning"}).then(function(e){s.delSuggestion(t)})},s.delSuggestion=function(e){var t=this,s=this.state.id;l.h.post("/team/user/remove",{id:s,users:[e.id]}).then(function(e){c.Z.success("操作成功"),t.resetTeam()}).catch(function(e){console.error(e)})},s.render=function(){var t=this,e=this.state,s=e.name,n=e.inUsers,a=e.seclectData,i=e.columns,c=document.documentElement.clientHeight-46-54-24,e=[{title:"团队",url:"/account/team"},{title:s,url:""}];return d().createElement("div",{className:"flex-col"},d().createElement("div",{className:"flex-other container common-wrapper"},d().createElement(u.Z,{title:e}),d().createElement("div",{className:"common-padding-12"},d().createElement("div",{className:"main-container",style:{minHeight:c,backgroundColor:"#fff"}},d().createElement("div",{className:"team-name-cont"},d().createElement("span",{className:"team-name"},"团队名称"),d().createElement(m.Z,{id:"editTeam",value:s,name:"团队名称",confirm:this.closeInput.bind(this)})),d().createElement("div",{className:"member-wrap"},d().createElement("h4",{className:"section-title"},"管理成员"),d().createElement("div",{className:"search-member"},d().createElement(p,{ref:function(e){return t.autosearch=e},fetchSuggestion:this.fetchSuggestion.bind(this),delLabel:this.delLabel.bind(this),seclectData:a,onSelect:this.selectSuggestion.bind(this),customLabel:this.customLabel.bind(this),customItem:this.customItem.bind(this),searchClick:this.search.bind(this)}))),d().createElement("div",null,d().createElement(r.Z,{className:"edit-team-table",columns:i,data:n,start:1,end:n.length,total:n.length}))))))},e}(i.Component)},88308:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var n=s(85354),a=s.n(n),i=s(67294),l=s.n(i),t=s(45697),n=s.n(t),u=s(5133),m=s(43036),t=s(94184),h=s.n(t),t={value:n().string,id:n().any.isRequired,enter:n().bool,blurFun:n().func,name:n().string,empty:n().bool,placeholder:n().string,type:n().string,confirmNoChange:n().func},n={value:"",enter:!0,name:"名称",empty:!1,placeholder:"",cancel:function(e,t){console.log("取消")},confirm:function(e,t){console.log("确定后的value:"+e)},type:"normal"},i=function(s){function e(e){var t=s.call(this,e)||this;t.enter=function(e){t.props.enter&&13===e.keyCode&&t.confirmEdit()};e=t.props.value;return t.state={isEdit:!1,curValue:e||"",lastVal:e||"",hover:!1,canEdit:!1},t}a()(e,s);var t=e.prototype;return t.UNSAFE_componentWillReceiveProps=function(e){var t=this;e.value!==this.state.lastVal&&e.value&&this.setState({curValue:e.value,lastVal:e.value}),!0!==e.canEdit||this.state.canEdit||this.setState({canEdit:!0},function(e){t.toEdit()})},t.componentDidMount=function(){var n=this;document.body.addEventListener("click",function(e){var t=e.target||window.event.srcElement,s=n.props.className,e="edit-input-wrap";!function(e,t){for(var s=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e&&!s.call(e,t);)e=e.parentElement;return e}(t,"."+(e=s?s.split(" ")[0]:e))&&n.cancelEdit()})},t.changeName=function(){var e=this.props.id,e=document.getElementById(e).value;this.setState({curValue:e})},t.toEdit=function(){var e=this.state,t=e.isEdit,s=(e.canEdit,this.props.id);t||this.setState({isEdit:!0,hover:!0},function(e){var t=document.getElementById(s);setTimeout(function(){t.focus()})})},t.checkEdit=function(){"normal"===this.props.type&&this.toEdit()},t.cancelEdit=function(){var e=this.state,t=e.curValue,s=e.lastVal,n=e.isEdit,e=e.canEdit,a=this.props.cancel;n&&(e&&this.setState({canEdit:!1}),this.setState({isEdit:!1,hover:!1,curValue:s},function(e){a&&a(t,s)}))},t.borderShow=function(){var e=this.state.hover;"normal"!==this.props.type||e||this.setState({hover:!0})},t.borderHide=function(){var e=this.state,t=e.hover,e=e.isEdit;"normal"===this.props.type&&t&&!e&&this.setState({hover:!1})},t.confirmEdit=function(){var e=this.state,t=e.curValue,s=e.lastVal,n=e.canEdit,a=this.props,i=a.confirm,c=a.id,r=a.name,o=a.empty,e=a.confirmNoChange,a=a.inputType,l=document.getElementById(c);""!==String(t).replace(/\s/g,"")||o||"remark"===a?(""===String(t).replace(/\s/g,"")&&o||"remark"==a?(this.setState({isEdit:!1,hover:!1,lastVal:t},function(e){l.blur()}),i&&i(t,s)):s===t?this.setState({isEdit:!1,hover:!1},function(e){l.blur()}):(this.setState({isEdit:!1,hover:!1,lastVal:t},function(e){l.blur()}),i&&i(t,s)),n&&(e&&e(t),this.setState({canEdit:!1}))):(u.Z.warning(r+"不能为空"),this.setState({curValue:s},function(e){l.focus()}))},t.render=function(){var e=this.props,t=e.id,s=e.style,n=e.className,a=e.placeholder,i=this.state,c=i.isEdit,r=i.curValue,o=i.hover,e=h()(["edit-input-wrap",n]),i=h()(["edit-input-cont",{hover:o,"is-edit":c}]),n=h()(["edit-input",{disabled:!c}]);return l().createElement("div",{className:e,style:s},l().createElement("div",{className:i,onMouseEnter:this.borderShow.bind(this),onMouseLeave:this.borderHide.bind(this),onClick:this.checkEdit.bind(this)},l().createElement("input",{id:t,className:n,type:"text",value:r,title:r,placeholder:a,style:s,disabled:!c,onInput:this.changeName.bind(this),onKeyDown:this.enter.bind(this)}),o&&!c&&l().createElement(m.Z,{placement:"top",overlay:"编辑"},l().createElement("div",{className:"btn-wrap",title:"编辑"},l().createElement("i",{className:"name-edit edit-btn icon-cem_edit"}))),o&&c&&l().createElement("div",{className:"btn-wrap"},l().createElement(m.Z,{placement:"top",overlay:"取消"},l().createElement("i",{className:"cancel-edit edit-btn icon-cem_delete",onClick:this.cancelEdit.bind(this),title:"取消"})),l().createElement(m.Z,{placement:"top",overlay:"确认"},l().createElement("i",{className:"confirm-edit edit-btn icon-cem_check-out",onClick:this.confirmEdit.bind(this),title:"确认"})))))},e}(i.Component);i.propTypes=t,i.defaultProps=n;const c=i}}]);