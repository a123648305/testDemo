(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3468],{48850:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>M});var a=n(37316),i=n.n(a),s=n(67154),k=n.n(s),o=n(85354),r=n.n(o),t=n(67294),_=n.n(t),T=n(61918),w=n(43036),b=n(53754),L=n(61409),O=n(92360),a=n(93913),c=n.n(a),y=n(2271),S=n(60496),E=n(17190);const f=function(e){var t=e.data,n=e.detailList,a=e.onChooseSpu,i=e.onChooseSku,s=e.keywordSku,o=e.keywordSpu;return _().createElement("div",{className:"product_setting_edit_left_wrap"},_().createElement("div",{className:"top"},_().createElement(w.Z,{overlay:_().createElement("div",{style:{maxWidth:260},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},onMouseUp:function(){s&&document.querySelector(".product_setting_edit_left_wrap")&&document.querySelector(".product_setting_edit_left_wrap").click(),s&&i(""),a(window.getSelection().toString().trim())}},t.name),placement:"top"},_().createElement("div",{className:"setting_name_wrap"},_().createElement("div",{className:"title",onClick:function(){window.open(""+t.url)}},t.name))),_().createElement("div",{className:"content_item"},n.map(function(e){return _().createElement("div",{className:"product",key:e.id},_().createElement("span",null,e.name),_().createElement("div",{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},e.values.map(function(e,t){return _().createElement("span",{key:e.name,onMouseUp:function(){o&&document.querySelector(".product_setting_edit_left_wrap")&&document.querySelector(".product_setting_edit_left_wrap").click(),o&&a(""),i(window.getSelection().toString().trim())},className:(0===t&&"checked")+" "+(e.offShelf&&"closed")},e.name)})))}))))};var N=n(35303),I=n(29257),C=n(35239);const g=function(t){function e(e){var r=t.call(this,e)||this;return r._handleOnSelectChange=function(e,t,n){var a,i;e&&e.length&&(a=e[e.length-1],r.state["topicValue"+t].find(function(e){return e.value===a})?r.setState(((i={})["value"+n.id]=[a],i["id"+n.id]=r.state["topicValue"+t].find(function(e){return e.value===a}).id,i)):r.props.fetchAddTopicValue({value:a,topicId:n.id}).then(function(e){var t;2e4===e.code&&r.setState(((t={})["value"+n.id]=[a],t["id"+n.id]=e.result,t))})),e.length||r.setState(((e={})["value"+n.id]=void 0,e))},r.getValue=function(){var e=r.state,t=e.spu,n=e.sku,a=e.spuName,i=e.skuName,s=e.topicList,e=e.packageType,o=[];return s.forEach(function(e){r.state["value"+e.id]&&o.push({id:e.id,name:r.state["id"+e.id]})}),{spuId:t,skuId:n,spuName:a,skuName:i,customizeConfig:o,packageType:e}},r.state={spu:e.data.spuId,spuName:null,sku:e.data.skuId,skuName:null,spuTip:e.spuTip,skuTip:e.skuTip,topicList:e.topicList,oddMaxLeng:0,evenMaxLeng:0,packageType:e.data.packageType&&"null"!==e.data.packageType?e.data.packageType:I.$[0].id},r}r()(e,t);var n=e.prototype;return n.setTopicList=function(e,t,n,a){var i=this;this.setState({topicList:[].concat(t.spuTitle.map(function(e,t){return{id:e,name:e,values:n&&i.props.spuList.find(function(e){return e.id===n})?JSON.parse(i.props.spuList.find(function(e){return e.id===n}).config)[e]:""}}),t.skuTitle.map(function(e,t){return{id:e,name:e,values:a&&i.props.skuList.find(function(e){return e.id===a})?JSON.parse(i.props.skuList.find(function(e){return e.id===a}).config)[e]:""}}),e)})},n.componentDidMount=function(){var n=this;this.props.data.spuName===this.state.spuName&&this.props.data.skuName===this.state.skuName||this.setState({spu:this.props.data.spuId,spuName:this.props.data.spuName,sku:this.props.data.skuId,skuName:this.props.data.skuName},function(){n.setTopicList(n.props.topicList,n.props.data,n.props.data.spuId,n.props.data.skuId),setTimeout(function(){var e,t;n.state.topicList&&(e=n.state.topicList.filter(function(e,t){return t%2==0}).map(function(e){return e.name.length}),t=n.state.topicList.filter(function(e,t){return t%2!=0}).map(function(e){return e.name.length}),n.setState({oddMaxLeng:6<Math.max.apply(Math,e)?6:Math.max.apply(Math,e),evenMaxLeng:6<Math.max.apply(Math,t)?6:Math.max.apply(Math,t)}))},0)})},n.componentDidUpdate=function(a,i){var s=this,e=a.data,t=a.spuTip,n=a.skuTip,o=this.props,r=o.data,c=o.topicList,l=o.spuTip,u=o.skuTip,p=o.topicOpts,d=i.spuName,m=i.skuName,o=this.state,h=o.spuName,f=o.skuName,g=o.spu,k=o.sku;JSON.stringify(t)!==JSON.stringify(l)?this.setState({spuTip:l.substring(0,8)}):JSON.stringify(n)!==JSON.stringify(u)&&this.setState({skuTip:u.substring(0,8)}),JSON.stringify(d)===JSON.stringify(h)&&JSON.stringify(m)===JSON.stringify(f)||this.setTopicList([].concat(this.props.topicList.filter(function(e){return"平台"===e.id}),this.props.topicList.filter(function(e){return"店铺类型"===e.id}),this.props.topicList.filter(function(e){return"店铺"===e.id})),r,g,k),JSON.stringify(e)!==JSON.stringify(r)&&this.setState({spu:r.spuId,spuName:r.spuName,sku:r.skuId,skuName:r.skuName,spuTip:"",skuTip:"",packageType:r.packageType||I.$[0].id},function(){p&&p.forEach(function(e,t){var n;s.setState(((n={})["value"+e.id]=void 0,n))}),s.setTopicList(c,r,g,k)}),p.forEach(function(t,e){var n;s.props["topicValue"+e]&&JSON.stringify(a["topicValue"+e]!==JSON.stringify(s.props["topicValue"+e]))&&s.setState(((n={})["topicValue"+e]=s.props["topicValue"+e],n)),JSON.stringify(i["value"+t.id])===JSON.stringify(s.state["value"+t.id])&&JSON.stringify(d)===JSON.stringify(h)&&JSON.stringify(m)===JSON.stringify(f)||s.setTopicList([].concat(s.props.topicList.filter(function(e){return"平台"===e.id}),s.props.topicList.filter(function(e){return"店铺类型"===e.id}),s.props.topicList.filter(function(e){return"店铺"===e.id}),p.map(function(e){return{id:e.id,name:e.name,values:e.id===t.id&&s.state["value"+t.id]&&s.state["value"+e.id]?s.state["value"+t.id][0]:s.state["value"+e.id]?s.state["value"+e.id][0]:""}})),r,g,k)})},n.render=function(){var a=this,e=this.props,t=e.spuList,n=e.skuList,i=e.topicOpts,s=e.onFocus,o=e.keywordSpu,r=e.spuShow,c=e.keywordSku,l=e.skuShow,u=this.state,p=u.spu,d=u.spuName,m=u.sku,h=u.spuTip,f=u.skuTip,g=u.topicList,k=u.oddMaxLeng,v=u.evenMaxLeng,e=u.packageType,u=C.t.get(C.V.curProject).notShowTopicList;return _().createElement("div",{className:"product_setting_edit_right_wrap"},_().createElement("div",{className:"top"},_().createElement("div",{className:"spu_sku_base"},_().createElement("span",null,"SPU词条"),_().createElement("div",null,t&&_().createElement(E.Z,{show:r,onChange:function(e){a.setState({spu:e.id,spuName:e.name,spuSplit:e.split})},trigger:"click",data:t,value:p,onTipClick:function(){h&&a.setState({spuTip:""}),s()},addText:"创建SPU词条",onAddClick:function(){window.open("/account/project/base?drawerVisible=true")},className:h?"content-error":"",keyword:o}),h&&_().createElement("span",{className:"content-error-hint"},h))),_().createElement("div",{className:"spu_sku_base"},_().createElement("span",null,"SKU词条"),_().createElement("div",null,n&&_().createElement(E.Z,{show:l,onChange:function(e){a.setState({sku:e.id,skuName:e.name,skuSplit:e.split})},trigger:"click",data:p?n.filter(function(e){return e.parentId===p}):n,value:m,onTipClick:function(){f&&a.setState({skuTip:""}),s()},addText:"创建SKU词条",disabled:!p,onAddClick:function(){window.open("/account/project/base/sku?spuId="+p+"&spuName="+d+"&drawerVisible=true")},className:f?"content-error":"",keyword:c}),f&&_().createElement("span",{className:"content-error-hint"},f))),!(u&&u.includes("PACKAGE_TYPE"))&&_().createElement("div",{className:"spu_sku_base"},_().createElement("span",null,"销售版本"),_().createElement("div",null,I.$&&_().createElement(E.Z,{onChange:function(e){a.setState({packageType:e.name})},trigger:"click",data:I.$,value:e})))),_().createElement("div",{className:"middle"},_().createElement("div",{className:"title"},_().createElement("h4",null,"自定义主题"),_().createElement("i",{className:"icon-cem_collection-settings",onClick:function(){window.open("/account/project/linkTopic?open=true")}})),_().createElement("div",{className:"content"},i&&i.map(function(t,n){return _().createElement("div",{className:"item",key:t.id},_().createElement("span",{className:"ellipsis"},t.name),_().createElement(N.RS,{tags:!0,multiple:!1,onChange:function(e){a._handleOnSelectChange(e,n,t)},value:a.state["value"+t.id],optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入"},a.state["topicValue"+n]&&a.state["topicValue"+n].map(function(e){return _().createElement(N.Wx,{key:e.id,value:e.value,label:e.value},e.value)})))}))),_().createElement("div",{className:"bottom"},_().createElement("h4",null,"主题值总览"),_().createElement("div",null,_().createElement("div",{className:"content"},g&&g.map(function(e,t){return _().createElement("span",{key:e.id},_().createElement("span",{className:"name",style:{width:t%2==0?12*k+16+"px":12*v+16+"px"}},e.name),_().createElement("span",{className:"value",style:{width:t%2==0?190-12*k-16-32+"px":190-12*v-16-32+"px"}},e.values))})))))},e}(_().PureComponent);var s=n(55609),v=n(5133),o=n(64396),l=o.Z.product.setting.subscribe.overview,u={visible:!1,esId:"",id:"",nextId:"",topicList:[],isNext:!0,data:{spuName:"",skuName:""},detailList:[],spuTip:"",skuTip:"",keywordSpu:"",spuShow:!1,keywordSku:"",skuShow:!1},a=function(t){function e(e){var g=t.call(this,e)||this;return g.show=function(e){var t=e.id,n=e.esId,a=e.nextId,i=e.nextEsId,s=e.topicList,o=e.data,e=e.detailList;g.setState({visible:!0,id:t,nextId:a,nextEsId:i,topicList:s,data:o,detailList:e,esId:n})},g._handleOnOk=function(){g._handleOnCancel()},g._handleOnCancel=function(){g.setState({visible:!1})},g._handleOnAddIgnore=function(a){var e=g.state,t=e.id,n=e.isNext,i=e.nextId,s=e.nextEsId,o=e.data,r=e.esId,c=g.props,l=c.dataList,u=c.total,p=c.keyword,d=c.pageIndex,e=c.pageSize,m=c.topicOpts;if("add"===a){if(!g.contentRef.getValue().spuId)return void g.setState({spuTip:"请选择SPU词条"+(new Date).getTime()});if(!g.contentRef.getValue().skuId)return void g.setState({skuTip:"请选择SKU词条"+(new Date).getTime()});g.props.fetchAdd(k()({connectionId:o.id,esId:r,name:o.name,url:o.url,sourceId:o.sourceId},g.contentRef.getValue()))}else"ignore"===a&&g.props.fetchIgnoreSingle({ignoreId:t});var h=g.contentRef.getValue().spuId,f=g.contentRef.getValue().spuName;n?i?(g.setState({id:i,esId:s}),g.props.fetchDetail({connectionId:i}).then(function(n){2e4===n.data.code&&g.props.fetchLinkList({searchTitleWord:p}).then(function(e){var t=e.findIndex(function(e){return e.id===i});e.length&&g.setState({data:k()({},e.find(function(e){return e.id===i}),{spuId:"add"===a&&!e.find(function(e){return e.id===i}).spuId&&h?h:e.find(function(e){return e.id===i}).spuId,spuName:"add"===a&&!e.find(function(e){return e.id===i}).spuId&&h?f:e.find(function(e){return e.id===i}).spuName}),topicList:[{id:"平台",name:"平台",values:e.find(function(e){return e.id===i}).sourceName},{id:"店铺类型",name:"店铺类型",values:e.find(function(e){return e.id===i}).shopType},{id:"店铺",name:"店铺",values:e.find(function(e){return e.id===i}).shopName}].concat(m.map(function(e){return{id:e.id,name:e.name,values:""}})),detailList:n.data.result,nextId:t!==e.length-1?e[t+1].id:"",nextEsId:t!==e.length-1?e[t+1].esId:""})})})):u>l.length&&d!==Math.ceil(u/e)?g.props.fetchLinkList({searchTitleWord:p,pageIndex:d+1}).then(function(t){var e,n;t.length&&(e=t[0].id,n=t[0].esId,g.setState({id:e,esId:n}),g.props.fetchDetail({connectionId:e}).then(function(e){2e4===e.data.code&&g.setState({data:k()({},t[0],{spuId:"add"===a&&!t[0].spuId&&h?h:t[0].spuId,spuName:"add"===a&&!t[0].spuId&&h?f:t[0].spuName}),topicList:[{id:"平台",name:"平台",values:t[0].sourceName},{id:"店铺类型",name:"店铺类型",values:t[0].shopType},{id:"店铺",name:"店铺",values:t[0].shopName}].concat(m.map(function(e){return{id:e.id,name:e.name,values:""}})),detailList:e.data.result,nextId:t[1]?t[1].id:"",nextEsId:t[1]?t[1].nextEsId:""})}))}):(v.Z.error("当前已是最后一个商品"),setTimeout(function(){g.props.fetchLinkList({searchTitleWord:p}),g._handleOnCancel()},100)):setTimeout(function(){g.props.fetchLinkList({searchTitleWord:p}),g._handleOnCancel()},100)},g._handleOnNextChange=function(e){g.setState({isNext:e})},g._handleOnChooseSpu=function(e){var t=g.state,n=t.spuShow;t.skuShow;g.setState({keywordSpu:e,spuShow:!n,skuShow:!1})},g._handleOnChooseSku=function(e){var t=g.state,n=t.skuShow;t.spuShow;g.setState({keywordSku:e,skuShow:!n,spuShow:!1})},g.state=k()({},Object.assign({},u)),g}return r()(e,t),e.prototype.render=function(){var t=this,e=this.state,n=e.visible,a=e.isNext,i=e.topicList,s=e.data,o=e.detailList,r=e.spuTip,c=e.skuTip,l=e.keywordSpu,u=e.spuShow,p=e.keywordSku,d=e.skuShow,m=this.props,h=m.spuList,e=m.skuList,m=m.topicOpts;return n?_().createElement(O.Dialog,{className:"yt_product_setting_edit_dialog_wrapper",title:"商品链接主题维护",size:"tiny",visible:n,onCancel:function(){t.setState({visible:!1})},lockScroll:!0},_().createElement(O.Dialog.Body,null,_().createElement("div",{style:{display:"flex"}},_().createElement(f,{data:s,detailList:o,onChooseSpu:function(e){return t._handleOnChooseSpu(e)},onChooseSku:function(e){return t._handleOnChooseSku(e)},keywordSku:p,keywordSpu:l}),_().createElement(g,k()({ref:function(e){return t.contentRef=e},data:s,spuList:h,skuList:e,topicList:i,spuTip:r,skuTip:c,topicOpts:m,keywordSpu:l,spuShow:u,keywordSku:p,skuShow:d},this.props)))),_().createElement(O.Dialog.Footer,null,_().createElement(O.Checkbox,{checked:a,onChange:this._handleOnNextChange},"下一商品"),_().createElement(O.Button,{onClick:function(){return t._handleOnAddIgnore("ignore")}},"忽略"),_().createElement(O.Button,{type:"primary",onClick:function(){return t._handleOnAddIgnore("add")}},"添加"))):null},e}(_().PureComponent);const x=(0,s.connect)(function(e){var t=k()({},e),n=t[l],a=n.skuList,i=n.spuList,s=n.dataList,o=n.pageIndex,r=(n.pageSize,n.searchTitleWord),e=n.total,n=n.topicOpts;return k()({},t[l],{skuList:a,spuList:i,dataList:s,pageIndex:o,keyword:r,total:e,topicOpts:n})},function(t){return{fetchLinkList:function(e){return t({type:l+"/fetchLinkList",payload:e})},fetchDetail:function(e){return t({type:l+"/fetchDetail",payload:e})},fetchAdd:function(e){return t({type:l+"/fetchAdd",payload:e})},fetchIgnoreSingle:function(e){return t({type:l+"/fetchIgnoreSingle",payload:e})},fetchTopicOpts:function(e){return t({type:l+"/fetchTopicOpts",payload:e})},fetchAddTopicValue:function(e){return t({type:l+"/fetchAddTopicValue",payload:e})}}},null,{withRef:!0})(a);var p=n(87219);const P=function(t){function e(e){var l=t.call(this,e)||this;return l._handleOnEdit=function(n){var a=l.props.data,i=a.findIndex(function(e){return e.id===n.id});l.props.fetchDetail({connectionId:n.id}).then(function(t){2e4===t.data.code&&l.props.fetchTopicOpts().then(function(e){e.forEach(function(e,n){l.props.fetchTopicValue({topicId:e.id,projectId:C.t.get(C.V.curProject).id}).then(function(e){var t;2e4===e.data.code&&l.props.save(((t={})["topicValue"+n]=e.data.result.result,t))})}),l.editModalRef.wrappedInstance.show({id:n.id,esId:n.esId,nextEsId:i!==a.length-1?a[i+1].esId:"",nextId:i!==a.length-1?a[i+1].id:"",data:n,topicList:[{id:"平台",name:"平台",values:n.sourceName},{id:"店铺类型",name:"店铺类型",values:n.shopType},{id:"店铺",name:"店铺",values:n.shopName}].concat(e.map(function(e){return{id:e.id,name:e.name,values:""}})),detailList:t.data.result})})})},l._handleOnAddIgnore=function(e,t){var n=l.state,a=n.spuName,i=n.skuName,s=n.spu,n=n.sku,s=s||e.spuId,n=n||e.skuId;"add"===t?s?n?(l.props.onFilterChange({spuName:a||e.spuName,skuName:i||e.skuName,spuId:s,skuId:n,connectionId:e.id,esId:e.esId,name:e.name,url:e.url,sourceId:e.sourceId,isList:!0}),setTimeout(function(){l.setState({spu:0,sku:0,spuName:"",skuName:""})},0)):l.setState({skuTip:"请选择SKU词条"}):l.setState({spuTip:"请选择SPU词条"}):"ignore"===t&&l.props.onFilterChange({ignoreId:e.id,isList:!0})},l._handleOnSelectChange=function(t,n){var e=l.state,a=e.checkedName,i=e.clickAllChecked,s=e.notContain,o=l.props,e=o.total,o=o.firstId,r={projectId:C.t.get(C.V.curProject).id,id:n.id,esId:n.esId,spuId:n.id===o&&l.state.spu||n.spuId,spuName:n.id===o&&l.state.spuName||n.spuName,skuId:n.id===o&&l.state.sku||n.skuId,skuName:n.id===o&&l.state.skuName||n.skuName,name:n.name,url:n.url,sourceId:n.sourceId,connectionId:n.id},o=(0,p.ZP)(a,function(e){return t?e.filter(function(e){return e.id!==n.id}):void e.push(r)}),a=(0,p.ZP)(s,function(e){return t?void e.push(r):e.filter(function(e){return e.id!==n.id})}),s=o.length===e,e=!s&&0<o.length||i&&a.length<e;l.setState({checkedName:o,isAllChecked:s,indeterminate:e}),!s&&i&&l.setState({notContain:a})},l._handleOnSelectAll=function(e){var t=l.props,n=t.data,a=t.firstId,i=t.connectionType;l.setState({isAllChecked:e,indeterminate:!1,checkedName:e?n.map(function(e){return{projectId:C.t.get(C.V.curProject).id,id:e.id,esId:e.esId,spuId:e.id===a&&l.state.spu||e.spuId,spuName:e.id===a&&l.state.spuName||e.spuName,skuId:e.id===a&&l.state.sku||e.skuId,skuName:e.id===a&&l.state.skuName||e.skuName,name:e.name,url:e.url,sourceId:e.sourceId,connectionId:e.id,connectionType:i}}):[],clickAllChecked:e})},l.state={operateState:"",isAllChecked:!1,clickAllChecked:!1,indeterminate:!1,checkedName:[],notContain:[],spuTip:"",skuTip:"",keywordSpu:"",spuShow:!1,skuShow:!1,keywordSku:""},l.columns=[{label:"商品详情页标题",prop:"name",width:200,fixed:"",checked:!0},{label:"SPU词条",prop:"spuName",width:220,fixed:"",checked:!0},{label:"SKU词条",prop:"skuName",width:220,fixed:"",checked:!0},{label:"操作",prop:"control",width:120,fixed:"",checked:!0}],l.prefixColumns=[{fixed:"left",label:"",width:16},{width:30,fixed:"left",prop:"selection",label:""}],l.columnRenders={selection:function(e){var t=l.state,n=t.clickAllChecked,a=t.isAllChecked,i=t.notContain,t=t.checkedName,s=a||n&&!i.map(function(e){return e.id}).includes(e.id)||t.map(function(e){return e.id}).includes(e.id);return _().createElement("span",{className:(s?"checkbox_checked":"")+" icon_checkbox",onClick:function(){return l._handleOnSelectChange(s,e)}})},name:function(e){return _().createElement(w.Z,{overlay:_().createElement("div",{style:{maxWidth:260},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},_().createElement("p",{onMouseUp:function(){l.setState({keywordSpu:window.getSelection().toString().trim(),spuShow:!l.state.spuShow})}},e.name),_().createElement("div",{style:{color:"#8c8c8c"},onMouseUp:function(){l.setState({keywordSku:window.getSelection().toString().trim(),skuShow:!l.state.skuShow})},dangerouslySetInnerHTML:{__html:""+(e.urlTopics?Object.values(JSON.parse(e.urlTopics)).join("&nbsp;"):"")}})),placement:"top"},_().createElement("div",{className:"setting_name_wrap"},_().createElement("div",{className:"name",onClick:function(){window.open(""+e.url)}},e.name),_().createElement("div",{className:"ellipsis",dangerouslySetInnerHTML:{__html:""+(e.urlTopics?Object.values(JSON.parse(e.urlTopics)).join("&nbsp;"):"")}})))},spuName:function(t){var e=l.state,n=e.spuTip,a=e.spu,i=l.props,s=i.spuList,e=i.firstId,o=i.onFocus;return t.id===e?_().createElement("div",{className:"entry_select_wrap"},_().createElement(E.Z,{show:l.state.spuShow,onChange:function(e){l.setState({id:t.id,spu:e.id,spuName:e.name})},className:n?"content-error":"",trigger:"hover",data:s,value:t.id===l.state.id?a:"",onTipClick:function(){n&&l.setState({spuTip:""}),o()},defaultValue:t.spuId,addText:"创建SPU词条",onAddClick:function(){window.open("/account/project/base?drawerVisible=true")},keyword:l.state.keywordSpu}),n&&_().createElement("span",{className:"content-error-hint"},n)):_().createElement("span",null,t.spuName)},skuName:function(t){var e=l.state,n=e.skuTip,a=e.sku,i=e.spu,s=e.spuName,o=l.props,r=o.skuList,e=o.firstId,c=o.onFocus;return t.id===e?_().createElement("div",{className:"entry_select_wrap"},_().createElement(E.Z,{show:l.state.skuShow,onChange:function(e){l.setState({id:t.id,sku:e.id,skuName:e.name})},className:n?"content-error":"",trigger:"hover",data:i&&r?r.filter(function(e){return e.parentId===i}):t.spuId&&r?r.filter(function(e){return e.parentId===t.spuId}):r,value:t.id===l.state.id?a:"",onTipClick:function(){n&&l.setState({skuTip:""}),c()},defaultValue:t.skuId,addText:"创建SKU词条",disabled:!t.spuId&&!i,onAddClick:function(){window.open("/account/project/base/sku?spuId="+(i||t.spuId)+"&spuName="+(s||t.spuName)+"&drawerVisible=true")},keyword:l.state.keywordSku}),n&&_().createElement("span",{className:"content-error-hint"},n)):_().createElement("span",null,t.skuName)},control:function(e){var t=l.props.firstId;return e.id===t?_().createElement("div",{className:"control"},_().createElement("span",{onClick:function(){return l._handleOnAddIgnore(e,"add")}},"添加"),_().createElement("span",{onClick:function(){return l._handleOnAddIgnore(e,"ignore")}},"忽略")):_().createElement("div",{className:"control"},_().createElement("span",{onClick:function(){return l._handleOnEdit(e)}},"编辑"))}},l}return r()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.data,a=e.total,i=e.pageIndex,s=e.pageSize,o=e.loading,r=e.className,c=e.onEditChange,l=e.onPageChange,u=e.onPageSizeChange,p=e.onFocus,d=this.state,m=d.checkedName,h=d.visible,f=d.indeterminate,e=d.isAllChecked,g=d.clickAllChecked,k=d.notContain,v=d.operateState;return _().createElement(_().Fragment,null,_().createElement("div",{className:"operate_btn"},_().createElement(S.Z,{type:"button",divider:"none",sufTitle:"批量操作",activeObj:v,enable:f||e,onChange:function(e){t.setState({operateState:e,visible:!0})},options:[{title:"批量添加",value:"add",disabled:!m.length},{title:"批量忽略",value:"ignore"}]})),_().createElement(y.Z,{savedKey:"product_setting_overview",rowKeyProp:"id",total:a,pageIndex:i,pageSize:s,className:r,prefixColumns:this.prefixColumns,data:n,loading:o,columns:this.columns,columnRenders:this.columnRenders,headerRenders:this.headerRenders,onPageChange:l,onPageSizeChange:u}),_().createElement(x,{ref:function(e){return t.editModalRef=e},onFocus:p}),_().createElement(O.Dialog,{className:"yt_product_setting_ignore_dialog_wrapper",title:"确定要批量"+("add"===v?"添加":"忽略")+"选中的商品链接？",size:"tiny",visible:h,onCancel:function(){t.setState({visible:!1})},lockScroll:!0},_().createElement(O.Dialog.Body,null,"add"===v?"添加后的商品链接可在「商品链接」页面找到，在那你可以更好的维护同一详情页下的兄弟商品及其主题值":"这些商品链接将被标记为“暂忽略”，这些商品链接相关的消息不会展示在前台应用中"),_().createElement(O.Dialog.Footer,{className:"dialog-footer"},_().createElement(O.Button,{onClick:function(){t.setState({visible:!1})}},"取消"),_().createElement(O.Button,{type:"primary",onClick:function(){c({checkedName:m,notContain:k,clickAllChecked:g,operateState:v,indeterminate:f}),t.setState({checkedName:[],notContain:[],clickAllChecked:!1,isAllChecked:!1,indeterminate:!1,visible:!1})}},"确定"))))},c()(e,[{key:"headerRenders",get:function(){var n=this;return{selection:function(){var e=n.state,t=e.isAllChecked,e=e.indeterminate;return _().createElement("span",{className:(t?"checkbox_checked":e?"checkbox_indeterminate":"")+" icon_checkbox",onClick:function(){return n._handleOnSelectAll(!t)}})}}}}]),e}(t.PureComponent);var a=n(30381),d=n.n(a);const m=function(t){function e(e){e=t.call(this,e)||this;return e.state={},e}return r()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.formPush,a=e.teamList,i=e.userList,s=e.formPushChange;return _().createElement("div",{className:"pulice_push_rule_edit"},_().createElement(O.Form,{ref:function(e){return t.form=e},model:n,rules:{},labelWidth:"80",className:"form",labelPosition:"left",style:{paddingLeft:"24px"}},_().createElement(O.Form.Item,{label:"提醒时间"},_().createElement(S.Z,{onChange:function(e){s({key:"weekDay",value:e.weekDay})},className:"rule_single_select",style:{position:"relative"},objName:"weekDay",activeObj:n.weekDay,options:[{title:"工作日",value:"1,2,3,4,5"},{title:"整周",value:"1,2,3,4,5,6,7"}]}),_().createElement(O.TimeSelect,{start:"00:00",step:"00:30",end:"23:59",onChange:function(e){s({key:"time",value:d()(e).format("HH:mm")})},value:new Date("2000 "+n.time+":00"),placeholder:"选择时间"})),_().createElement(O.Form.Item,{label:"推送方式",prop:"pass"},_().createElement("span",null,"微信通知",_().createElement(w.Z,{overlay:_().createElement("div",{style:{lineHeight:"24px",color:"#262626"}},"系统会给用户发送微信模板消息和",_().createElement("br",null),"系统提醒，如果接收提醒的用户没",_().createElement("br",null),"有绑定微信，系统会向其邮箱推送",_().createElement("br",null),"绑定微信的操作说明，按邮件说明",_().createElement("br",null),"操作即可。",_().createElement("br",null),"在“个人中心/个人资料”页面扫码",_().createElement("br",null),"绑定微信，即可接受预警通知。",_().createElement("br",null),_().createElement("a",{href:"/personalSettings/overview",target:"_black",style:{color:"#0847a6"}},"立即前往")),placement:"top"},_().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:"8px"}})))),_().createElement(O.Form.Item,{label:"提醒团队",prop:"pass"},_().createElement("ul",{className:"push_member"},_().createElement("li",null,_().createElement("span",null,_().createElement(N.RS,{multiple:!0,tags:!1,onChange:function(e){return s({key:"subscribeTeam",value:e})},value:n.subscribeTeam,optionLabelProp:"label",optionFilterProp:"label"},a.map(function(e,t){return _().createElement(N.Wx,{key:t,value:e.id,label:e.name},e.name)})))))),_().createElement(O.Form.Item,{label:"用户",prop:"pass"},_().createElement("ul",{className:"push_member"},_().createElement("li",null,_().createElement("span",null,_().createElement(N.RS,{multiple:!0,tags:!1,onChange:function(e){return s({key:"subscribeUser",value:e})},value:n.subscribeUser,optionLabelProp:"label",optionFilterProp:"label"},i.map(function(e,t){return _().createElement(N.Wx,{key:t,value:e.id,label:e.username},e.username)}))))))))},e}(_().Component),h=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){var t=this;return _().createElement(O.Dialog,{title:_().createElement("div",null,"设置提醒"),visible:this.props.visible,className:"push_rule_dialog_wrap",onCancel:function(){return t.props.visibleChange(!1)}},_().createElement(O.Dialog.Body,null,_().createElement("div",{className:"push_rule_edit_wrap"},_().createElement("div",null,_().createElement(O.Loading,{loading:this.props.fetchingDetail},_().createElement(m,this.props))))),_().createElement(O.Dialog.Footer,{className:"dialog-footer"},_().createElement(O.Button,{onClick:function(){return t.props.visibleChange(!1)}},"取 消"),_().createElement(O.Button,{type:"primary",onClick:function(){t.props._judge()&&t.props.comfirm().then(function(e){t.props.visibleChange(!1)})}},"确 定")))},t}(t.Component);var A=o.Z.pushRule,a=function(t){function e(e){var a=t.call(this,e)||this;return a.judge=function(){var e=a.props.formPush,t=e.subscribeUser,n=e.subscribeTeam,e="";return(e=!t.length&&!n.length?"请至少选择选一个团队或者用户推送":e)&&!0!==e&&O.Message.warning(e),!e},a.props.save({projectId:C.t.get(C.V.curProject).id}),a._event={_judge:a.judge},a}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.props.getDetail(),this.props.fetchUserList()},n.componentWillUnmount=function(){this.props.clear()},n.render=function(){return _().createElement(h,k()({},this.props,this._event,this.state))},e}(t.Component);const V=(0,s.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return k()({},e[A],{fetchingDetail:t.effects[A+"/getDetail"]||!1})},function(t){return{fetchUserList:function(e){return t({type:A+"/fetchUserList",payload:e})},getDetail:function(e){return t({type:A+"/getDetail",payload:e})},formPushChange:function(e){return t({type:A+"/formPushChange",payload:e})},comfirm:function(e){return t({type:A+"/comfirm",payload:e})},save:function(e){return t({type:A+"/save",payload:e})},clear:function(e){return t({type:A+"/clear",payload:e})},visibleChange:function(e){return t({type:A+"/visibleChange",payload:e})}}})(a);const D=function(e){var t=e.loading,n=e.searchTitleWord,a=e.ruleNumbers,i=e.ruleOpts,s=e.skuList,o=e.spuList,r=e.dataList,c=e.pageIndex,l=e.pageSize,u=e.total,p=e.firstId,d=e.onFilterChange,m=e.onEditChange,h=e.onEdit,f=e.fetchDetail,g=e.fetchTopicOpts,k=e.fetchTopicValue,v=e.onPageChange,y=e.onPageSizeChange,S=e.save,E=e.onFocus,N=e.location,I=e.visibleChange,e=e.connectionType,C=N.pathname.split("/")[3];return _().createElement("div",{className:"yt_product_setting_subscribe_overview_wrapper"},_().createElement("div",{className:"top_zone"},_().createElement("div",null,_().createElement(T.Z,{onSearch:function(e){return d({searchTitleWord:e})},onClear:function(e){return d({searchTitleWord:e})},placeholder:"搜索商品标题",defValue:n,style:{width:168}}),_().createElement(b.Z,{title:"订阅规则",options:i,value:a,onChange:function(e){d({ruleNumbers:e})}})),_().createElement("div",{className:"right_btn"},_().createElement(w.Z,{placement:"top",overlay:"设置提醒"},_().createElement("i",{className:"icon-cem_set-reminders rule_setting-button",onClick:function(){return I(!0)}})),_().createElement(w.Z,{overlay:"查看被标识为“暂忽略”的商品链接",placement:"top"},_().createElement("span",{className:"icon_trash",onClick:function(){L.mW.push({pathname:"/account/project/"+C+"/subscribe/recycling"})}},_().createElement("i",{className:"icon-cem_trash"}))),_().createElement(O.Button,{type:"primary",onClick:function(){L.mW.push({pathname:"/account/project/"+C+"/subscribe/rules"})}},"订阅规则"))),r?_().createElement(P,{className:"list_content_wrap",loading:t,data:r,skuList:s,spuList:o,pageIndex:c,pageSize:l,total:u,firstId:p,onChange:d,onEdit:h,fetchDetail:f,fetchTopicOpts:g,fetchTopicValue:k,save:S,onEditChange:m,onPageChange:v,onPageSizeChange:y,onFilterChange:d,onFocus:E,connectionType:e}):_().createElement(O.Loading,{style:{height:"100%"},loading:t}),_().createElement(V,null))};var j=o.Z.product.setting.public,F=o.Z.product.setting.subscribe.overview,t=function(t){function e(e){var r=t.call(this,e)||this;return r._handleOnFocus=function(){var e=r.props,t=e.spuList,n=e.skuList,e=C.t.get(C.V.newEntry)||{},a=e.spuName,i=e.skuName,s=e.spuId,o=e.skuId;(a&&!t.find(function(e){return a.includes(e.name.replaceAll(e.split,"").replaceAll("|",""))})||i&&!n.find(function(e){return i.includes(e.name.replaceAll(e.split,"").replaceAll("|",""))})||s&&!t.find(function(e){return String(e.id)===String(s)})||o&&!n.find(function(e){return String(e.id)===String(o)}))&&r.props.fetchEntryOpts({projectId:C.t.get(C.V.curProject).id,id:1})},r._handleOnEdit=function(e){r.props.fetchEdit(e)},r._handleOnEditChange=function(e){var t=r.state.connectionType;"ignore"===e.operateState?e.checkedName.length&&e.indeterminate?r.props.fetchIgnore({batchIgnoreId:e.checkedName.map(function(e){return e.id}),connectionType:t}):e.clickAllChecked&&r.props.fetchIgnoreAll({notIgnoreId:e.notContain.length?e.notContain.map(function(e){return e.id}):void 0,connectionType:t}):"add"===e.operateState&&r.props.fetchAddAll(e.checkedName)},r._handleOnFilterChange=function(e){var t=r.state.connectionType;void 0!==e.searchTitleWord?r.props.fetchLinkList({searchTitleWord:e.searchTitleWord,pageIndex:1}):e.ignoreId?r.props.fetchIgnoreSingle({ignoreId:e.ignoreId,isList:e.isList,connectionType:t}):e.esId?r.props.fetchAdd(k()({},e,{connectionType:t})):e.ruleNumbers&&r.props.fetchLinkList({ruleNumbers:e.ruleNumbers,pageIndex:1})},r._handleOnPageChange=function(e){var t=r.props,n=t.searchTitleWord;(0,t.fetchLinkList)({pageIndex:e,searchTitleWord:n})},r._handleOnPageSizeChange=function(e){var t=r.props,n=t.searchTitleWord;(0,t.fetchLinkList)({pageSize:e,pageIndex:1,searchTitleWord:n})},r.state={connectionType:e.location.pathname.includes("/price")?"PRICE":"DEFAULT"},r.event={onFilterChange:r._handleOnFilterChange,onPageChange:r._handleOnPageChange,onPageSizeChange:r._handleOnPageSizeChange,onEditChange:r._handleOnEditChange,onEdit:r._handleOnEdit,onFocus:r._handleOnFocus},e.save({connectionType:e.location.pathname.includes("/price")?"PRICE":"DEFAULT"}),e.titleChange([{title:"智能订阅",state:{type:""}}]),r}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.props.fetchRuleList({projectId:C.t.get(C.V.curProject).id,type:this.state.connectionType}),this.props.fetchEntryOpts({projectId:C.t.get(C.V.curProject).id,connectionType:this.state.connectionType})},n.componentWillUnmount=function(){this.props.clean()},n.render=function(){return _().createElement(D,k()({},this.props,this.state,this.event))},e}(t.PureComponent);const M=(0,s.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return k()({},e[F],{loading:t.effects[F+"/fetchLinkList"]||!1})},function(t){return{save:function(e){return t({type:F+"/save",payload:e})},clean:function(e){return t({type:F+"/clean",payload:e})},fetchLinkList:function(e){return t({type:F+"/fetchLinkList",payload:e})},fetchAdd:function(e){return t({type:F+"/fetchAdd",payload:e})},fetchAddAll:function(e){return t({type:F+"/fetchAddAll",payload:e})},fetchIgnoreSingle:function(e){return t({type:F+"/fetchIgnoreSingle",payload:e})},fetchIgnore:function(e){return t({type:F+"/fetchIgnore",payload:e})},fetchIgnoreAll:function(e){return t({type:F+"/fetchIgnoreAll",payload:e})},fetchDetail:function(e){return t({type:F+"/fetchDetail",payload:e})},fetchEntryOpts:function(e){return t({type:F+"/fetchEntryOpts",payload:e})},fetchTopicOpts:function(e){return t({type:F+"/fetchTopicOpts",payload:e})},fetchTopicValue:function(e){return t({type:F+"/fetchTopicValue",payload:e})},fetchAddTopicValue:function(e){return t({type:F+"/fetchAddTopicValue",payload:e})},fetchRuleList:function(e){return t({type:F+"/fetchRuleList",payload:e})},titleChange:function(e){return t({type:j+"/titleChange",payload:e})},visibleChange:function(e){return t({type:"pushRule/visibleChange",payload:e})}}})(t)}}]);