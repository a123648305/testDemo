(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[236],{43775:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var t=n(67154),a=n.n(t),t=n(85354),i=n.n(t),f=n(67294),E=n.n(f),C=n(92360),r=n(5133),v=n(29383),S=n(59762),y=n(33097),A=n(55815),I=n(53754),s=n(43036),b=n(37841),c=n(61409),L=n(13713),d=n(36144),l=n(35239),w=[{label:"全部",value:""},{label:"启用",value:"ENABLE"},{label:"停用",value:"DISABLE"}],o=function(t){function e(e){var p=t.call(this,e)||this;return p.goEdit=function(){p.setState({visiblePopupConfirmIndex:-1});var e=p.state.targetAlert.id;c.mW.push({pathname:"/account/project/alert/edit",state:{id:e}})},p.resetPopupConfimIndex=function(){p.setState({visiblePopupConfirmIndex:-1})},p.fetchAlertList=function(){var e=p.state,t=e.projectId,n=e.searchText,a=e.team,i=e.user,r=e.status,l=e.sortType,o=e.alertObject,s=e.alertIndex,c=e.pageIndex,u=e.pageSize;p.setState({loading:!0},function(){d.h.post("/warning/project/aspect/list",{projectId:t,title:n,warningStatusList:r?[r]:[],receiverTeamIdList:a,receiverUserIdList:i,filterModel:{analysis:o,aspect:s},sortModelList:[{sortName:"UPDATED_AT",sortType:l},{sortName:"TITLE",sortType:"ASC"}],pageIndex:c,pageSize:u}).then(function(e){var t=e.status,e=e.data.result;(200<=t&&t<300||304===t)&&e&&(t=e.total,e=e.list,p.setState({list:e,total:t}))}).finally(function(){p.setState({loading:!1})})})},p.fetchTeamOptions=function(){try{var e=p.state.projectId;d.h.post("filter/find",{projectId:e,filterTypes:["TEAM","USER"],type:"OVERVIEW"}).then(function(e){var t=e.data,e=t.code,t=t.result;2e4===e&&t&&(e=t.team,t=t.user,p.setState({teamOptions:e.map(function(e){return{id:e.id,name:e.name}}),userOptions:t.map(function(e){return{id:e.id,name:e.username}})}))})}catch(e){console.error(e)}},p.handleChangeTeam=function(e){p.setState({team:e,pageIndex:1},function(){return p.fetchAlertList()})},p.handleChangeUser=function(e){p.setState({user:e,pageIndex:1},function(){return p.fetchAlertList()})},p.handleChangeStatus=function(e){p.setState({status:e,pageIndex:1},function(){return p.fetchAlertList()})},p.handleInputChange=function(e){p.setState({searchText:e})},p.handleKeyUp=function(e){e.stopPropagation(),13===e.keyCode&&p.setState({pageIndex:1},function(){return p.fetchAlertList()})},p.handleAlertObjChange=function(e){p.setState({alertObject:e,pageIndex:1},function(){return p.fetchAlertList()})},p.handleAlertIndexChange=function(e){p.setState({alertIndex:e,pageIndex:1},function(){return p.fetchAlertList()})},p.switchPage=function(e){p.setState({pageIndex:e},function(){return p.fetchAlertList()})},p.switchPageSize=function(e){p.setState({pageSize:e,pageIndex:1},function(){return p.fetchAlertList()})},p.handleSort=function(e){e=e.order;p.setState({sortType:"ascending"===e?"ASC":"DESC"},function(){return p.fetchAlertList()})},p.handleTitleChange=function(e){var t=p.state.targetAlert;p.setState({targetAlert:a()({},t,{title:e})})},p.handleDescChange=function(e){var t=p.state.targetAlert;p.setState({targetAlert:a()({},t,{description:e})})},p.handleConfirm=function(){var e=p.state,t=e.dialogType,e=e.targetAlert,n=e.id,a=e.title,i=e.status,r=e.description;switch(t){case"toggle":p.handleEnableOrDisable(n,i);break;case"delete":p.handleDelete(n);break;case"rename":p.handleRename(n,a,r)}},p.handleCancel=function(){p.setState({dialogShow:!1,targetAlert:{id:"",title:"",description:"",status:""}})},p.handleEnableOrDisable=function(){var e=p.state.targetAlert,t=e.id,e=e.status;d.h.post("/warning/project/aspect/status/update",{id:t,status:"ENABLE"===e?"DISABLE":"ENABLE"}).then(function(e){e=e.status;(200<=e&&e<300||304===e)&&r.Z.success("操作成功")}).finally(function(){p.handleReset(),p.fetchAlertList()})},p.handleDelete=function(e){d.h.post("/warning/project/aspect/delete",{id:e}).then(function(e){e=e.status;(200<=e&&e<300||304===e)&&r.Z.success("删除成功")}).finally(function(){p.handleReset(),p.fetchAlertList()})},p.handleRename=function(e,t,n){d.h.post("/warning/project/aspect/title/update",{id:e,title:t,description:n}).then(function(e){e=e.status;(200<=e&&e<300||304===e)&&r.Z.success("操作成功")}).finally(function(){p.handleReset(),p.fetchAlertList()})},p.handleReset=function(){p.setState({dialogShow:!1,targetAlert:{id:"",title:"",description:"",status:""}})},p.state={projectId:l.t.get(l.V.backProjectConfig)&&l.t.get(l.V.backProjectConfig).id,alertObject:{},alertIndex:{aspect1:[],aspect2:[]},team:[],teamOptions:[],user:[],userOptions:[],status:"",searchText:"",pageIndex:1,pageSize:20,sortType:"DESC",list:[],total:0,loading:!1,targetAlert:{id:"",title:"",description:"",status:""},dialogShow:!1,dialogType:"",visiblePopupConfirmIndex:-1,columns:[{label:"",prop:"paddingLeft",width:48},{label:"预警名称",prop:"title",minWidth:210,render:function(e){return E().createElement(s.Z,{overlay:function(){return p.renderDetailPopup(e.title,e.description)},placement:"topLeft",overlayClassName:"alert-detail-popup"},E().createElement("div",{className:"alert-title"},e.title))}},{label:"推送用户",prop:"user",render:function(e){var t=e.receiverTeamList,e=e.receiverUserList;return E().createElement(f.Fragment,null,E().createElement("div",{className:"teams"},E().createElement("span",null,"团队 | "),E().createElement("span",null,0<t.length?t.map(function(e){return e.name}).join("，"):"无")),E().createElement("div",{className:"teams"},E().createElement("span",null,"成员 | "),E().createElement("span",null,0<e.length?e.map(function(e){return e.name}).join("，"):"无")))},minWidth:240},{label:"预警提醒数",prop:"remindCount",render:function(e){return E().createElement(s.Z,{placement:"top",overlay:"查看近7天的推送日志"},E().createElement("span",{className:"count",onClick:function(){return p.viewLog(e.title)}},e.remindCount))},minWidth:70},{label:"最近修改时间",prop:"updatedAt",sortable:"custom",minWidth:120,render:function(e){return E().createElement("span",null,e.updatedAt.substring(0,16))}},{label:"操作",prop:"operation",minWidth:210,render:function(e,t,n){var a=p.state.visiblePopupConfirmIndex,i=e.id,r=e.title,l=e.description,o=e.status;return E().createElement("div",{className:"handle"},E().createElement(s.Z,{overlay:"ENABLE"===o?"已启用":"已停用",placement:"top",trigger:"hover"},E().createElement("span",null,E().createElement(C.Switch,{value:"ENABLE"===o,onText:"",offText:"",onColor:"#0747A6",offColor:"#CCCCCC",onChange:function(){return p.setState({dialogShow:!0,dialogType:"toggle",targetAlert:{id:i,title:r,description:l,status:o}})}}))),E().createElement("span",{onClick:function(){return c.mW.push({pathname:"/account/project/alert/edit",state:{id:i,edit:!0}})}},"编辑"),E().createElement("span",{onClick:function(){p.setState({dialogShow:!0,dialogType:"rename",targetAlert:{id:i,title:r,description:l,status:o}})}},"重命名"),E().createElement(s.Z,{trigger:"click",overlay:function(){return p.renderPopupConfirm()},placement:"top",overlayClassName:"alert-popup-confirm",visible:a===n},E().createElement("span",{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),p.setState({visiblePopupConfirmIndex:n,targetAlert:{id:i,title:r,description:l,status:o}})}},"复制")),E().createElement("span",{onClick:function(){p.setState({dialogShow:!0,dialogType:"delete",targetAlert:{id:i,title:r,description:l,status:o}})}},"删除"))}},{label:"",prop:"paddingRight",width:48}]},p}i()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.fetchTeamOptions(),this.fetchAlertList(),window.addEventListener("click",this.resetPopupConfimIndex)},n.componentWillUnmount=function(){window.removeEventListener("click",this.resetPopupConfimIndex)},n.renderDetailPopup=function(e,t){return E().createElement(f.Fragment,null,E().createElement("div",{className:"popup-title"},"预警名称"),E().createElement("div",{className:"popup-content",style:{marginBottom:"16px"}},e),E().createElement("div",{className:"popup-title"},"预警说明"),E().createElement("div",{className:"popup-content"},t||"无"))},n.renderPopupConfirm=function(){return E().createElement("div",{onClick:function(e){return e.stopPropagation()}},E().createElement("div",null,E().createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),E().createElement("span",null,"确定创建相似条件预警？")),E().createElement("div",null,E().createElement(C.Button,{type:"default",size:"mini",onClick:this.resetPopupConfimIndex},"取消"),E().createElement(C.Button,{type:"primary",size:"mini",onClick:this.goEdit},"确定")))},n.viewLog=function(e){c.mW.push({pathname:"/account/project/alert/log",state:{title:e}})},n.handleClickCreateBtn=function(){c.mW.push({pathname:"/account/project/alert/edit"})},n.render=function(){var e=this,t=this.state,n=t.projectId,a=t.teamOptions,i=t.userOptions,r=t.status,l=t.searchText,o=t.columns,s=t.loading,c=t.pageIndex,u=t.pageSize,p=t.list,d=t.total,m=t.dialogType,h=t.dialogShow,g=t.targetAlert,t=document.documentElement.clientHeight-46-78-24;return E().createElement("div",{className:"alert-rule"},E().createElement(A.Z,{title:(0,L.u)({title:"预警管理"}),rightContent:E().createElement(C.Button,{type:"primary",onClick:this.handleClickCreateBtn},"新建预警")}),E().createElement("div",null,E().createElement("div",{style:{minHeight:t,backgroundColor:"#fff"}},E().createElement("div",{className:"alert-rule-search"},E().createElement("div",null,E().createElement("div",{className:"search-input-wrapper"},E().createElement(C.Input,{value:l,onChange:this.handleInputChange,onKeyUp:this.handleKeyUp,icon:"search",placeholder:"请输入预警名称",onIconClick:function(){return e.setState({pageIndex:1},function(){return e.fetchAlertList()})}})),E().createElement(S.Z,{projectId:n,type:"OVERVIEW",onChange:this.handleAlertObjChange}),E().createElement(y.Z,{projectId:n,onChange:this.handleAlertIndexChange}),E().createElement(I.Z,{title:"推送团队",options:a,onChange:this.handleChangeTeam}),E().createElement(I.Z,{title:"推送用户",options:i,onChange:this.handleChangeUser}),E().createElement(b.Z,{activeKey:r,options:w,onTabClick:this.handleChangeStatus}))),E().createElement(C.Loading,{loading:s,text:"拼命加载中"},E().createElement(v.Z,{columns:o,data:p,total:d,pagePosition:"down",pageSize:u,currentPage:c,onPage:this.switchPage,onSortChange:this.handleSort,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,notLimit:!0})))),E().createElement(C.Dialog,{title:"rename"===m?"重命名预警":"",size:"tiny",visible:h,onCancel:function(){return e.handleCancel()},lockScroll:!0,customClass:"rename"===m?"rename-modal":""},E().createElement(C.Dialog.Body,null,"delete"===m&&E().createElement(f.Fragment,null,E().createElement("div",{className:"dialog-title"},E().createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"确定删除该预警？"),E().createElement("div",{className:"delete-tips"},"删除后，此预警无法恢复。如果此预警后期还需要继续使用，停用即可")),"toggle"===m&&E().createElement(f.Fragment,null,E().createElement("div",{className:"dialog-title"},E().createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"确定","ENABLE"===g.status?"停":"启","用该预警？"),E().createElement("div",{className:"delete-tips"},"ENABLE"===g.status?"停用后，此预警中的规则将不再生效":"启用后，满足设置的相关规则后相关用户就会收到提醒")),"rename"===m&&E().createElement(f.Fragment,null,E().createElement("div",{className:"form-item"},E().createElement("label",null,"预警名称"),E().createElement(C.Input,{value:g.title,placeholder:"请输入预警名称",onChange:this.handleTitleChange})),E().createElement("div",{className:"form-item"},E().createElement("label",null,"预警描述"),E().createElement(C.Input,{type:"textarea",value:g.description,autosize:{minRows:4,maxRows:4},onChange:this.handleDescChange,placeholder:"请输入预警描述"})))),E().createElement(C.Dialog.Footer,{className:"dialog-footer"},E().createElement(C.Button,{onClick:function(){return e.handleCancel()}},"取消"),E().createElement(C.Button,{type:"primary",onClick:function(){return e.handleConfirm()}},"确定"))))},e}(f.PureComponent)},13713:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var a=n(35239),i=function(e){var t=e.title,e=e.url;return[{title:"所有项目",url:"/account/project"},{title:a.t.get(a.V.backProjectConfig).name,url:"/account/project/preview"},{title:t,url:e}]}},37841:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),i=n.n(t),t=n(45697),n=n.n(t),t=function(e){var n=e.activeKey,t=e.options,a=e.onTabClick;return i().createElement("div",{className:"tabs"},t.map(function(e,t){return i().createElement("div",{key:t,className:n===e.value?"active-tab":"",onClick:function(){return n!==e.value&&a(e.value,e)}},e.key||e.label)}))};t.propTypes={activeKey:n().oneOfType([n().string,n().number]),options:n().arrayOf(n().shape({key:n().string,value:n().oneOfType([n().string,n().number])})).isRequired,onTabClick:n().func.isRequired};const a=t}}]);