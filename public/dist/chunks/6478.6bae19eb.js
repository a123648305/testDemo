(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6478],{86478:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var a=n(93913),s=n.n(a),t=n(85354),r=n.n(t),a=n(67294),i=n.n(a),l=n(29383),o=n(36144),c=n(12518),t=n(30381),u=n.n(t),h=n(72305),p=function(t){function e(e){var l=t.call(this,e)||this;return l.getUsers=function(e){return o.h.get("/history/users/list")},l.getTypes=function(e){return o.h.get("/history/types/list")},l.getHistoryList=function(e){var t=l.state,n=t.startTime,a=t.endTime,s=t.selUsers,r=t.selTypes,i=t.currentPage,t=t.pageSize;o.h.post("history/log/list",{username:s,action:r,startTime:n,endTime:a,pageNum:i,pageSize:t}).then(function(t){l.setState({data:[],pageSize:t.data.result.size,totalNumber:t.data.result.totalElements},function(e){return l.setState({data:t.data.result.content})})})},l.getPage=function(e){l.setState({currentPage:e},function(e){return l.getHistoryList()})},l.timeConfirm=function(e,t,n){l.setState({startTime:e[0],endTime:e[1]},function(e){return l.getPage(1)})},l.state={startTime:u()().subtract(7,"days").format("YYYY-MM-DD"),endTime:u()().startOf("day").format("YYYY-MM-DD"),columns:[{label:"",prop:"paddingLeft",width:16},{label:"姓名",prop:"username"},{label:"操作",prop:"target"},{label:"日期",prop:"createdAt"},{label:"",prop:"paddingRight",width:16}],data:[],users:[],selUsers:[],types:[],selTypes:[],currentPage:1,pageSize:20,totalNumber:0},l}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){var t=this;Promise.all([this.getUsers(),this.getTypes()]).then(function(e){t.setState({users:e[0].data.result.map(function(e){return{name:e.username,id:e.id}}),types:e[1].data.result.map(function(e){return{name:e.action,id:e.keyword}})},function(e){return t.getHistoryList()})})},n.selTopics=function(e,t){var n,a=this;this.setState(((n={})[e]=t,n.currentPage=1,n),function(e){return a.getPage(1)})},n.render=function(){var t=this,e=this.state,n=(e.startTime,e.endTime,e.totalNumber),a=e.currentPage,s=e.pageSize,e=document.documentElement.clientHeight-46-48-44;return i().createElement("div",{className:"historyLog common-wrapper"},i().createElement(c.Z,{title:"操作日志"}),i().createElement("div",{className:"common-padding-12"},i().createElement("div",{style:{minHeight:e,backgroundColor:"#fff"}},i().createElement("div",{className:"filter"},i().createElement(h.Z,{list:this.allList,onChange:function(e){return t.allList=e}})),i().createElement("div",{className:"log"},i().createElement(l.Z,{columns:this.state.columns,data:this.state.data,pageSize:s,currentPage:a,total:n,onPage:this.getPage})))))},s()(e,[{key:"allList",get:function(){return[{name:"用户",list:this.state.users,value:this.state.selUsers},{name:"操作类型",list:this.state.types,value:this.state.selTypes}]},set:function(e){var t=this,n=this.state,a=n.selUsers,s=n.selTypes;e.forEach(function(e){switch(e.name){case"用户":a=e.value;break;case"操作类型":s=e.value}}),this.setState({selUsers:a,selTypes:s,currentPage:1},function(e){return t.getHistoryList()})}}]),e}(a.Component)},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(67154),h=n.n(a),s=n(37316),p=n.n(s),t=n(85354),r=n.n(t),a=n(67294),d=n.n(a),s=n(45697),t=n.n(s),s=n(94184),m=n.n(s),a=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,s=e.block,r=e.indeterminate,i=e.value,l=e.checked,o=e.defaultChecked,c=e.onChange,u=e.disabled,e=p()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),c={value:i,checked:l,defaultChecked:o,onChange:c,disabled:u},a=m()(t,((u={})[t+"-disabled"]=c.disabled,u[t+"-block"]=s,u[t+"-indeterminate"]=r,u),a);return d().createElement("label",h()({tabIndex:c.disabled?-1:0,className:a},e),d().createElement("input",h()({type:"checkbox",className:t+"-input"},c)),d().createElement("span",{className:t+"-status"}),n&&d().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const i=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>l});var a=n(24473),s=n(67154),o=n.n(s),r=n(37316),c=n.n(r),t=n(85354),i=n.n(t),s=n(67294),u=n.n(s),r=n(45697),t=n.n(r),r=n(94184),h=n.n(r),r=function(s){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=s.call.apply(s,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return i()(e,s),e.prototype.render=function(){var s=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,r=(e.onChange,e.values),i=e.checkedList,l=e.block,e=c()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=r?r.map(function(e,t){var n=0!==i.length&&-1!==i.indexOf(e);return u().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return s.handleCheckBoxChange(e)},block:l},e)}):u().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==i.length&&-1!==i.indexOf(a);return u().cloneElement(e,{checked:a,key:t,block:n.block||l,onChange:function(){var e=n.value;s.handleCheckBoxChange(e)}})}});return u().createElement("div",o()({className:h()(t,a)},e),n)},e}(s.Component);r.defaultProps={prefixCls:"wt-checkbox-group"},r.propTypes={onChange:t().func,values:t().array,block:t().bool};const l=r;var p=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},s=function(e){function t(){return e.apply(this,arguments)||this}return i()(t,e),t.prototype.render=function(){var e=this.props,t=p(e);return u().createElement("label",{className:e.className,title:e.children},u().createElement("div",{className:"checkbox"},u().createElement("input",o()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),u().createElement("div",{className:"checkbox-body"}))," ",u().createElement("span",null,e.children))},t}(s.Component);s.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},72305:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(49064),r=n.n(a),t=n(85354),i=n.n(t),a=n(67294),h=n.n(a),t=n(93913),s=n.n(t),p=n(85151);const l=function(t){function e(e){var n=t.call(this,e)||this;return n.handleClear=function(e){var t=n.state.list;t.forEach(function(e){return e.sel=!1}),n.setState({list:t},function(e){return n.commitUserSel()})},n.hoverDropToggle=function(e){var t;e?(t=setTimeout(function(){n.setState({open:e,timeout:null})},100),n.setState({timeout:t})):(clearTimeout(n.state.timeout),n.setState({open:e,timeout:null}))},n.clickDropToggle=function(e){n.setState({open:!n.state.open})},n.stop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.closeDrop=function(e){n.setState({open:!1})},n.state={list:JSON.parse(JSON.stringify(e.list||[])),searchKeyWords:"",open:!1,timeout:""},n}i()(e,t);var n=e.prototype;return n.search=function(){this.setState({searchKeyWords:this.refs.searchInput.value})},n.handleChecked=function(t){var n=this,e=this.state.list;this.props.singleSel?e.forEach(function(e){e.sel=e.id===t}):e.forEach(function(e){e.id===t&&(e.sel=!e.sel)}),this.setState({list:e},function(e){return n.commitUserSel()})},n.handleCheckedAll=function(){var t=this,n=!this.checkedAll,e=this.state.list;e.forEach(function(e){return e.sel=n}),this.setState({list:e},function(e){return t.commitUserSel()})},n.commitUserSel=function(){this.props.onSel(this.selList)},n.UNSAFE_componentWillReceiveProps=function(t,e){var n;(t.list||t.value)&&((n=JSON.parse(JSON.stringify(t.list))).forEach(function(e){e.sel=-1!==t.value.indexOf(e.id)}),this.setState({list:n}))},n.componentDidMount=function(){var e,t=this;this.props.value&&((e=JSON.parse(JSON.stringify(this.state.list))).forEach(function(e){e.sel=-1!==t.props.value.indexOf(e.id)}),this.setState({list:e}))},n.render=function(){var n=this,e=this.props,t=e.classNames,a=e.style,s=e.title,r=e.selectPosition,i=e.special,l=e.singleSel,o=this.state,c=o.list,u=o.searchKeyWords,e=o.open,o=0<u.length?this.searchList:c,c=c.find(function(e){return n.props.list.value===e.id});return h().createElement("div",{className:(t||"")+" back-search-select-wrap",onClick:function(e){n.stop(e)},style:a,onMouseEnter:function(){n.hoverDropToggle(!0)},onMouseLeave:function(){n.hoverDropToggle(!1)}},h().createElement("div",{className:e?"open sel-wrap":"sel-wrap"},h().createElement("div",{className:"span-wrap"},h().createElement("span",{className:"title"},s+(i?"":" : ")),!i&&(0<this.selList.length?this.selList.map(function(e,t){return h().createElement("span",{key:t},e.name,t===n.selList.length-1?"":" ,")}):h().createElement("span",null,l&&c?c.name:"全部"))),h().createElement("i",{className:"icon-cem_pull-down-or-take-up"})),e&&h().createElement("div",{className:"allSelContent",style:{left:"left"===r?"0":"",right:"right"===r?"0":""}},h().createElement("div",{className:"search"},h().createElement("p",null,h().createElement("input",{value:u,placeholder:"请输入搜索关键词",ref:"searchInput",type:"text",onChange:function(e){return n.search()}})),h().createElement("p",null,h().createElement("span",{onClick:function(e){return n.handleClear()}},"清除已选项目"))),0<o.length?h().createElement("div",{className:"all"},!l&&u.length<1&&h().createElement(p.Jg,{checked:this.checkedAll,indeterminate:this.indeterminate,onChange:function(){return n.handleCheckedAll()},block:!0},"全选"),o.map(function(e){return n.props.singleSel?h().createElement("p",{className:e.sel?"singleSel sel":"singleSel",key:e.id,onClick:function(){return n.handleChecked(e.id)}},e.name):h().createElement(p.Jg,{key:e.id,value:e.id,checked:e.sel,onChange:function(){return n.handleChecked(e.id)},block:!0},e.name)})):h().createElement("div",{className:"all"},"无选项")))},s()(e,[{key:"selList",get:function(){return this.state.list.filter(function(e,t){return e.sel})}},{key:"checkedAll",get:function(){return this.state.list.every(function(e){return e.sel})}},{key:"indeterminate",get:function(){return!this.checkedAll&&this.state.list.some(function(e){return e.sel})}},{key:"searchList",get:function(){var t=this;return this.state.list.filter(function(e){if(-1!==e.name.toLocaleLowerCase().indexOf(t.state.searchKeyWords.trim().toLocaleLowerCase()))return!0})}}]),e}(a.Component);var o=function(s){function e(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=s.call.apply(s,[this].concat(n))||this).state={filterList:[],inputVal:""},t.inputChange=function(e){t.setState({inputVal:e.target.value})},t.keywordChange=function(e){},t}i()(e,s);var t=e.prototype;return t.handleSel=function(t,n){var e=this.props,a=e.list,e=e.onChange;a.forEach(function(e){e.name===t&&(e.value=n.map(function(e){return e.id}))}),e(a)},t.UNSAFE_componentWillReceiveProps=function(e,t){e&&this.setState({filterList:e.list})},t.componentDidMount=function(){},t.buildHeaderFilter=function(){var n=this;r()(this.props);var e=this.state,e=(e.inputVal,e.filterList);return h().createElement("div",{className:"back-end-filter"},e.map(function(e,t){return h().createElement(l,{key:t,list:e&&e.list,value:e.value||[],onSel:n.handleSel.bind(n,e.name),title:e.name,singleSel:e.singleSel})}))},t.render=function(){return this.buildHeaderFilter()},e}(a.Component)}}]);