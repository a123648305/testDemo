(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1438],{91438:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var n=a(67154),p=a.n(n),t=a(85354),r=a.n(t),n=a(67294),m=a.n(n),d=a(91751),t=a(82784),f=a.n(t),t=a(30381),i=a.n(t),v=a(5133);const h={setStorage:function(e,t){localStorage.setItem(e||"cem-msg",JSON.stringify(t))},getStorage:function(e){e=JSON.parse(localStorage.getItem(e||"cem-time-msg"))||{};return Object.keys(e).length<=0&&(e.value=[i()().subtract(90,"days").format("YYYY-MM-DD"),i()().startOf("day").format("YYYY-MM-DD")],e.groupBy="MONTH",e.current=9),e}};var t=a(94184),y=a.n(t);a(83839),a(22243);i().locale("zh-cn");function g(e){return e?e.format(E):""}function s(e){switch(e){case 0:return[i()().subtract(1,"days"),i()().subtract(1,"days")];case 1:return[i()().subtract(1,"weeks").startOf("week"),i()().subtract(1,"weeks").endOf("week")];case 2:return[i()().startOf("day"),i()()];case 3:return[i()().startOf("week"),i()()];case 4:return[i()().subtract(6,"days"),i()().startOf("day")];case 5:return[i()().subtract(1,"months").startOf("month"),i()().subtract(1,"months").endOf("month")];case 6:return[i()().subtract(29,"days"),i()().startOf("day")];case 7:return[i()().startOf("month"),i()()];case 8:default:return[i()().subtract(89,"days"),i()().startOf("day")]}}var E="YYYY-MM-DD",k={"昨天":0,"上周":1,"今天":2,"本周":3,"近7天":4,"上月":5,"近30天":6,"本月":7,"近90天":8,"自定义":9},S={"时":"HOUR","天":"DAY","周":"WEEK","月":"MONTH"},u=function(n){function e(){for(var l,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(l=n.call.apply(n,[this].concat(t))||this).state={showLeft:!0,value:[i()(g(s(l.props.current)[0])),i()(g(s(l.props.current)[1]))],currentType:0==l.props.current?0:l.props.current||9,currentGroup:l.props.groupBy||"DAY",hoverValue:[],inputVal:[]},l.handleToggle=function(e){l.setState({showLeft:!l.state.showLeft})},l.onStandaloneSelect=function(e,t){var n=l.state.value;n[e]=t,n[1].diff(n[0],"days")<0||(l.setState({value:n,inputVal:[g(n[0]),g(n[1])]}),t=l.fixedGroup(n),l.setState({currentGroup:t,currentType:k["自定义"]}),Object.keys(k).map(function(e,t){var a=s(k[e]);g(n[0])===g(a[0])&&g(n[1])===g(a[1])&&l.setState({currentType:k[e]})}))},l.onStartChange=function(e){l.onStandaloneSelect(0,e)},l.onEndChange=function(e){l.onStandaloneSelect(1,e)},l.setDateGroup=function(e){l.setState({currentGroup:e})},l.disabledStartDate=function(e){var t=l.state.value[1];return!(!e||!t)&&t.diff(e,"days")<0},l.disabledEndDate=function(e){var t=l.state.value[0];return!(!e||!t)&&e.diff(t,"days")<0},l.fixedGroup=function(e){e=i().duration(e[1]-e[0]).asDays();switch(!0){case e<=1:return"HOUR";case e<30:return"DAY";case 30<=e:return"MONTH";default:return"HOUR"}},l.setQuickTime=function(e,t){var a;9!==e?(a=s(e),l.setState({value:a,currentType:e,currentGroup:l.fixedGroup(a)},function(e){t&&t()})):l.setState({currentType:e,inputVal:[g(l.state.value[0]),g(l.state.value[1])]})},l.inputStart=function(e){var t=l.state.inputVal;t[0]=e.currentTarget.value,l.setState({inputVal:t})},l.inputEnd=function(e){var t=l.state.inputVal;t[1]=e.currentTarget.value,l.setState({inputVal:t})},l.apply=function(e,t){l.props.onceShow&&h.setStorage("cem-time-"+l.props.onceShow,"");var a=l.state,n=a.value,r=a.inputVal,s=a.currentType,u=a.currentGroup,c=l.props,o=c.timeConfirm,a=(c.style,c.handlePanel);if(9===s){c=i()(r[0]),r=i()(r[1]);if(!c.isValid()||!r.isValid())return void v.Z.error("非法输入");if(r.diff(c,"days")<0)return void v.Z.error("非法输入");l.setState({value:[c,r]},function(e){return o([g(l.state.value[0]),g(l.state.value[1])],u,s)})}else o([g(n[0]),g(n[1])],u,s);t||a(e)},l}return r()(e,n),e.prototype.render=function(){var a=this,e=this.state,t=e.showLeft,n=e.inputVal,r=e.value,s=e.currentType,u=e.currentGroup,c=this.props,o=c.style,l=c.group,i=c.onClick,e=y()("filter-date-input-from","fake-textarea",{disabled:9!==s}),c=[];return!n||n.length<2?(c.push(g(r[0])),c.push(g(r[1]))):(c.push(n[0]),c.push(n[1])),m().createElement("div",{className:"time-setting-panel",onClick:i,style:p()({width:t?"772px":"260px"},o)},m().createElement("div",{className:"left-panel",style:{display:t?"inline-block":"none"}},m().createElement(d.Z,{format:E,locale:f(),showDateInput:!1,showOk:!1,value:r[0],disabledDate:this.disabledStartDate,onChange:this.onStartChange}),m().createElement(d.Z,{format:E,showDateInput:!1,locale:f(),showOk:!1,value:r[1],disabledDate:this.disabledEndDate,onChange:this.onEndChange}),l&&m().createElement("div",{className:"date-group"},"时间分组：",Object.keys(S).map(function(t,e){return m().createElement("li",{key:e,className:S[t]===u?"quick-btn active":"quick-btn",onClick:function(e){return a.setDateGroup(S[t])}},m().createElement("span",null,t))}))),m().createElement("div",{className:"quick-setting-panel"},m().createElement("ul",null,Object.keys(k).map(function(t,e){return m().createElement("li",{key:e,className:e===s?"quick-btn active":"quick-btn",onClick:function(e){return a.setQuickTime(k[t])}},m().createElement("span",null,t))})),m().createElement("div",{className:"left-panel-toggle quick-btn",onClick:this.handleToggle},m().createElement("span",null,t?"← 收起":"→ 展开")),9===s?m().createElement("div",{className:"filter-date-input"},m().createElement("input",{className:e,value:c[0],onChange:this.inputStart}),m().createElement("div",{className:"device"},"-"),m().createElement("input",{className:e,value:c[1],onChange:this.inputEnd})):m().createElement("div",{className:"filter-date-input"},m().createElement("input",{className:e,readOnly:!0,value:g(r[0])}),m().createElement("div",{className:"device"},"-"),m().createElement("input",{className:e,readOnly:!0,value:g(r[1])})),m().createElement("div",{className:"apply-btn",onClick:function(e){return a.apply(e)}},"应用")))},e}(n.Component),c=function(t){function e(e){var n=t.call(this,e)||this;n.state={show:!1,value:["2018-01-01","2018-08-01"],current:9,groupBy:"MONTH"},n.handlePanel=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.setState({show:!n.state.show})},n.stopPop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.timeConfirm=function(e,t,a){n.setState({value:e,groupBy:t,current:a},function(){h.setStorage("cem-time-"+n.props.model,n.state),n.props.confirm&&n.props.confirm()})},n.state=h.getStorage("cem-time-"+(n.props.onceShow||n.props.model))||{},n.state.value=n.state.value||n.state.dateRange;e=n.state.current;return e<9&&(e=s(e),n.state.value=[g(e[0]),g(e[1])]),n.state=Object.assign({show:!1,value:["2018-01-01","2018-08-01"],current:9,groupBy:"MONTH"},n.state),n}r()(e,t);var a=e.prototype;return a.componentDidMount=function(){var e=this;this.oneHandler=function(){e.setState({show:!1})},document.addEventListener("click",this.oneHandler)},a.componentWillUnmount=function(){document.removeEventListener("click",this.oneHandler)},a.getParams=function(){var e=this.state,t=e.value,e=e.groupBy;return{from:t[0],to:t[1],dateGroupType:e,remoteName:"cTime"}},a.render=function(){var n=this,e=this.props.group,t=this.state,a=t.value,r=t.current,t=t.groupBy;return m().createElement("div",{className:"date-wrap"},m().createElement("div",null,m().createElement("div",{className:"date-filter filter-box",onClick:function(e){return n.handlePanel(e)}},m().createElement("div",null,m().createElement("span",null,a[0].replace(/-/g,"/"))," -",m().createElement("span",null,a[1].replace(/-/g,"/"))),9!==this.state.current&&m().createElement("div",{className:"date-day-info"},Object.keys(k).filter(function(e){return k[e]===n.state.current})[0]),m().createElement("i",{className:"icon-cem_time-controller"})),m().createElement(u,{ref:"picker",timeConfirm:function(e,t,a){return n.timeConfirm(e,t,a)},value:a,handlePanel:function(e){return n.handlePanel(e)},onClick:this.stopPop,current:r,groupBy:t,group:e,style:{display:this.state.show?"block":"none"}})))},e}(n.Component)}}]);