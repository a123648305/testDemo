(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5932],{5932:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>te});function P(e,n){var t,i=e;return e&&e instanceof Array&&(n.includes("businessPoint")?(i=e.reduce(function(n,i){return i.businessPoint.forEach(function(e){var t=e.id,a=e.name,e=n.find(function(e){return e.view===a});e||n.push(e={id:t,view:a,aspects:[],total:0,positive:0,negative:0});t=i.positive+i.negative;e.aspects.push({view:a,total:t,aspect1:i.aspect1,aspect2:i.aspect2,positive:i.positive,negative:i.negative}),e.total+=i.positive+i.negative,e.positive+=i.positive,e.negative+=i.negative}),n},[]),t=JSON.parse(JSON.stringify(i)).map(function(e){return e.view}),i=i.length?t.reduce(function(e,t){var a=i.find(function(e){return e.view===t});return a&&e.push(a),e},[]):"empty"):"aspect1"===n?i=e.reduce(function(e,t){var a=e.find(function(e){return e.aspect===t[n]});return a||(a={aspect:t[n],messageTotal:0,positive:0,negative:0,businessPoint:t.businessPoint,total:0,aspect2:[]},e.push(a)),a.aspect===t[n]&&(a.aspect2.push({aspect:t.aspect2,messageTotal:t.messageTotal,positive:t.positive,negative:t.negative,businessPoint:t.businessPoint,total:t.positive+t.negative}),a.positive+=t.positive,a.negative+=t.negative,a.messageTotal+=t.messageTotal,a.total+=t.positive+t.negative),e},[]):"aspect2"===n&&(i=e.map(function(e){return{aspect1:e.aspect1,aspect:e.aspect2,negative:e.negative,positive:e.positive,messageTotal:e.messageTotal,total:e.negative+e.positive,businessPoint:e.businessPoint}}))),i}function u(e,a){var n,i=[],s=O.OW.map(function(e){return{color:e,used:!1}});return a&&a instanceof Array&&a.length&&(n=O.OW[0],e.forEach(function(t,e){e<s.length?(a.find(function(e){return e===t[0]})&&(n=s[e].color,i.push([t[0],n])),s[e].used=!!a.find(function(e){return e===t[0]})):a.find(function(e){return e===t[0]})&&(n=s.find(function(e){return!e.used}).color,s.find(function(e){return!e.used}).used=!0,i.push([t[0],n]))})),i}function v(e){var t=0;e.forEach(function(e){e=parseFloat(e[1]);t<e&&(t=e)});for(var t=Math.ceil(t),a=0;a<4;a++)t%4!=0&&t++;return{intVal:(t=0===t?4:t)/4,maxVal:t}}var n=a(37316),i=a.n(n),s=a(67154),C=a.n(s),t=a(85354),o=a.n(t),n=a(67294),I=a.n(n),k=a(48577),L=a(61409),h=(a(43378),a(62443)),p=(a(75314),a(11187)),O=a(70715),m=a(39432),E=a(87300),g=[{title:"一级指标",value:"aspect1"},{title:"二级指标",value:"aspect2"},{title:"业务视角",value:"businessPoint"}],V=[{title:"指标声量",value:"total"},{title:"指标正面声量",value:"positive"},{title:"指标负面声量",value:"negative"}],T=["positive","negative","total"],y=O.OW.map(function(e){return{color:e,used:!1}}),s=function(n){function e(){for(var f,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(f=n.call.apply(n,[this].concat(t))||this).chartRef=void 0,f.source=void 0,f.color=O.OW,f.legendSelected=void 0,f.datasetIndex=-1,f.getChartRef=function(e){return f.chartRef=e},f.getSourceData=function(e,t,a,n,i,s){return"businessPoint"===a?e.sort(function(e,t){return t[n]-e[n]}).reduce(function(e,t){return t.total>=s&&e.push([t.view,t[n]]),e},[t]):"businessPoint_aspect"===a?(i?e.find(function(e){return e.view===i}):e).aspects.sort(function(e,t){return t[n]-e[n]}).reduce(function(e,t){return t.total>=s&&e.push([t.aspect2,t[n],t.view]),e},[t]):"aspect1"===a?e.sort(function(e,t){return t[n]-e[n]}).reduce(function(e,t){return t.total>=s&&e.push([t.aspect,t[n]]),e},[t]):"aspect2"===a?(i?e.filter(function(e){return e.aspect1===i}):e).sort(function(e,t){return t[n]-e[n]}).reduce(function(e,t){return t.total>=s&&e.push([t.aspect,t[n]]),e},[t]):e},f.setValue=function(e,t,a,n,i,s){var o=t.includes("aspect")?["指标","指标声量"]:"businessPoint"===n?["业务视角","指标声量"]:["指标","指标声量","业务视角"],r=f.getSourceData(e,o,n,"total",s,i),l=t.includes("aspect")?["指标","指标正面声量"]:"businessPoint"===n?["业务视角","指标正面声量"]:["指标","指标正面声量","业务视角"],u=f.getSourceData(e,l,n,"positive",s,i),c=t.includes("aspect")?["指标","指标负面声量"]:"businessPoint"===n?["业务视角","指标负面声量"]:["指标","指标负面声量","业务视角"],i=f.getSourceData(e,c,n,"negative",s,i);return f.dataset=[u,i,r].map(function(e,t){return{dimensions:0===t?l:1===t?c:o,source:e,sourceHeader:!1}}),[u,i,r]},f.getOption=function(e,t,a,n,i,s,o,r,l,u,c){var p=T.indexOf(a);f.datasetIndex=p;var a=f.chartRef.getWidth(),a=1<(0,m.jD)(f.dataset[p].source.slice(1).map(function(e){return e[0]}).join(""),12)/(.6*a),d="businessPoint_aspect"===t?n+"-"+e:e;return{title:{text:d},dataset:C()({},f.dataset[p],{source:f.dataset[p].source.slice(1)}),brush:{xAxisIndex:"all",yAxisIndex:"all",transformable:!1,throttleType:"debounce",throttleDelay:1e3,brushStyle:{borderWidth:1,color:"rgba(91,143,249,0.1)",borderColor:"#5B8FF9"},outOfBrush:{colorAlpha:.9}},toolbox:{feature:{dataZoom:{show:!1,yAxisIndex:!1,xAxisIndex:!1},saveAsImage:{show:!1},restore:{show:!1},dataView:{show:!1},magicType:{show:!1},brush:{type:["lineX"],icon:{lineX:"path://M521.472 524.992l501.76 226.816-180.096 90.752L753.024 1024 521.472 524.992zM900.992 64.832v129.6h-64.32V64.832h-128.64V0h192.96zM64.704 842.56h128.704v64.768H0.384V712.96h64.32zM64.704 64.832v129.6H0.384V0h193.024v64.832zM322.048 0h257.28v64.832h-257.28zM322.048 842.56h257.28v64.768h-257.28zM0.384 324.032h64.32v259.2H0.384zM836.672 324.032h64.32v259.2h-64.32z"}}},itemSize:14,iconStyle:{color:"#8c8c8c",borderColor:"#8c8c8c"},emphasis:{iconStyle:{color:"#7262FD"}},top:14,right:148,z:3},tooltip:{trigger:"item",showDelay:20,hideDelay:55,confine:!0,enterable:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n        box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",position:function(e,t,a,n,i){var s=i.contentSize,o=i.viewSize,r=e[0]<o[0]/2?0:-1,i=e[1]<o[1]/2?-.5:-1,o=e[0]<o[0]/2?20:-20;return[e[0]+r*s[0]+o,e[1]+i*s[1]]},formatter:function(e,t,a){var n=e.marker,i=e.name,s=e.value;return setTimeout(function(){a(t,(0,E.r)("                \n                <span>"+i+"</span>",["<div style='display: flex;justify-content: space-between;align-items: center;color: #8c8c8c;'><div><span style='vertical-align: bottom'>"+n+"</span>"+d+"</div><div style='color: #262626;margin-left: 10px;'>"+(0,m.hE)(s)+"</div></div>"],[{title:"消息",icon:"icon-cem_jump-message",callback:function(){return c(e,d)}}],"yt_new_tooltip_wrapper"))},0)}},grid:{top:n&&"aspect2"===t||n&&"businessPoint_aspect"===t?108:60,left:36,right:36,bottom:56,containLabel:!0},dataZoom:{show:!0,bottom:24,xAxisIndex:0,height:20,handleSize:"100%",showDetail:!1,borderColor:"transparent",dataBackground:{lineStyle:{color:"rgba(231, 243, 255, 1)",opacity:1},areaStyle:{color:"rgba(231, 243, 255, 1)",opacity:1}},fillerColor:"rgba(114, 98, 253, 0.3)",handleIcon:"path://M249.376256 0m102.4 0l0 0q102.4 0 102.4 102.4l0 819.2q0 102.4-102.4 102.4l0 0q-102.4 0-102.4-102.4l0-819.2q0-102.4 102.4-102.4Z",handleColor:"rgba(114, 98, 253, 1)",start:r,end:l},xAxis:{type:"category",boundaryGap:[0,.01],triggerEvent:"aspect1"===t||"businessPoint"===t,data:f.dataset[p].source.slice(1).map(function(e){return e[0]}),axisLabel:{interval:a&&o?1:0,rotate:a&&o?45:0,margin:a&&o?15:8,formatter:function(e){return 6<e.length?e.substring(0,6)+"...":e}}},yAxis:{type:"value",axisLabel:{color:"#626262",formatter:function(e){return(0,m.hE)(e)}},interval:v(f.dataset[p].source.slice(1)).intVal,max:v(f.dataset[p].source.slice(1)).maxVal,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}},series:[{type:"bar",barMaxWidth:24,data:f.dataset[p].source.slice(1).map(function(t,e){var a="#BFBFBF";return e<y.length?(s.find(function(e){return e===t[0]})&&(a=y[e].color),y[e].used=!!s.find(function(e){return e===t[0]})):s.find(function(e){return e===t[0]})&&(a=y.find(function(e){return!e.used}).color,y.find(function(e){return!e.used}).used=!0),{name:t[0],value:t[1],itemStyle:{color:a}}}),label:{show:i,position:"top",color:"#8C8C8C"}}]}},f}return o()(e,n),e.prototype.renderChart=function(e,t,a,n,i,s,o,r,l,u,c,p,d,f){this.setValue(e,a,n,i,s,o),this.chartRef.clear(),this.chartRef.setOption(this.getOption(t,i,n,o,r,l,u,c,p,d,f))},e}(I().PureComponent),_=a(8201),b=a(98191),t=a(45697),n=a.n(t),S=a(43036),t=function(t){function e(e){var n=t.call(this,e)||this;return n.getPanelWidth=function(){var e=n.props,t=e.flavor,a=e.options,e=e.rightHook,a=Math.max.apply(null,a.map(function(e){return(0,m.jD)(e.title,14)}))+2+10+32;return a+=void 0!==t?24:0,100<(a+=void 0!==e?30:0)?a:100},n._setPadShowFalse=function(){n.state.show&&n.setState({show:!1})},n._handleParentClick=function(e){n.state.show&&n.props.showFlavor&&n.props.enable&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())},n._handleTriggerOnClick=function(){var e=n.state.show;n.props.enable&&setTimeout(function(){n.setState({show:!e})},0)},n.state={show:!1,firstLiHover:!1,panelWidth:n.getPanelWidth()},n}o()(e,t);var a=e.prototype;return a.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},a.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},a.componentDidUpdate=function(e){var t=e.options,e=this.props.options;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({panelWidth:this.getPanelWidth()})},a.render=function(){var e=this.state,t=e.show,a=e.panelWidth,n=this.props,i=n.activeObj,s=void 0===i?"":i,o=n.onChange,r=n.options,l=n.objName,u=n.preTitle,c=n.sufTitle,p=void 0===c?"":c,d=n.showTitle,f=void 0===d||d,v=n.overlay,h=n.divider,m=void 0===h?"right":h,E=n.flavor,g=n.className,e=void 0===g?"":g,T=n.onFlavorChange,i=n.sufIcon,c=n.style,d=n.type,h=void 0===d?"text":d,g=n.enable,y=n.rightHook,d=r.find(function(e){return e.value===s}),n=""===s?p:d&&d.title,d=""===s?p:d&&d.icon;return I().createElement("div",{className:"single-select-button-wrapper single_select_diviver_"+m+" single-select-button_"+h+" "+e,style:c,onClick:this._handleParentClick},I().createElement("div",{className:"button_content "+(g?"":"button_content_disable")},I().createElement("span",{onClick:this._handleTriggerOnClick},I().createElement("span",{className:"button-trigger "+(t?"sel":"")},f&&I().createElement(I().Fragment,null,u&&I().createElement("span",{className:"pre-title"},u,"："),d?I().createElement("i",{className:d+" word_icon_hover"}):I().createElement("span",{className:"button-title"},n)),I().createElement("i",{className:i||"icon-cem_pull-down-or-take-up",style:{transform:t?"rotate(-180deg)":""}})),v&&I().createElement("span",{style:{marginLeft:4}},I().createElement(S.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:v},I().createElement("i",{className:"icon-cem_file1"})))),I().createElement("div",{className:"button-panel "+(t?"active":""),style:{minWidth:a}},r.map(function(a,e){return I().createElement("div",{className:"panel-item "+(a.value===s?"sel":"")+" "+(a.disabled?"disabled":""),key:a.value,onClick:function(){var e;a.disabled||o(l?((e={})[l]=a.value,e):a.value)}},a.icon&&I().createElement("i",{className:a.icon+" panel-item-icon"}),I().createElement("span",{className:"ellipsis",style:{maxWidth:97.5}},a.title),void 0!==E&&I().createElement("i",{className:E===a.value?"icon-cem_star":"icon-cem_star-filling star_hide",onClick:function(e){var t;e.stopPropagation(),T(E===a.value?l?((e={})[l]="",e):"":l?((t={})[l]=a.value,t):a.value),o(l?((t={})[l]=a.value,t):a.value)}}),I().createElement("i",{className:a.value===s&&y?"icon-cem_right1 choice":""}))}))))},e}(I().PureComponent);t.defaultProps={enable:!0,activeObj:"",sufTitle:"",showTitle:!0,divider:"right",className:"",type:"text"},t.propTypes={activeObj:n().any,onChange:n().func.isRequired,options:n().array.isRequired,objName:n().any,preTitle:n().string,sufTitle:n().string,showTitle:n().bool,overlay:n().string,divider:n().oneOf(["both","left","right","none"]),flavor:n().string,onFlavorChange:n().func,className:n().string,sufIcon:n().string,style:n().object,type:n().oneOf(["button","text"]),enable:n().bool,rightHook:n().bool};const x=t;a(1025);var l=a(65400),c=(a(89858),a(51024)),d=(a(96606),a(36155)),t=a(48926),r=a.n(t),t=a(87757),f=a.n(t),A=a(36144);function N(){return(N=r()(f().mark(function e(t){var a,n;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.projectId,n=t.key,e.abrupt("return",A.h.post("/default/value/find",{projectId:a,key:n}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function F(){return(F=r()(f().mark(function e(t){var a,n,i;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.projectId,n=t.value,i=t.key,e.abrupt("return",A.h.post("/default/value/update",{projectId:a,key:i,value:n}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}var w=a(35239),t=function(t){function e(e){var o=t.call(this,e)||this;return o._setPadShowFalse=function(e){var t=o.state,a=t.show,n=t.showTips,i=t.minNum,s=t.target;setTimeout(function(){!s&&a&&o.setState({show:!1})},0),!s&&n&&o.setState({showTips:!1}),s||o.setState({min:i!==o.originState.min?i:o.originState.min})},o.onOk=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();var t=o.props,a=t.savedKey,n=t.onChange,i=o.state,e=i.min,t=i.show,i=i.minNum;a&&!function(){return F.apply(this,arguments)}({projectId:w.t.get(w.V.curProject).id,key:o.props.savedKey,value:JSON.stringify({min:Number(e)===parseFloat(e)&&0<=Number(e)?e:i!==o.originState.min?i:o.originState.min})}).then(function(e){e.data}),o.setState({show:!t,showTips:!1,min:e,minNum:Number(e)===parseFloat(e)&&0<=Number(e)?e:i!==o.originState.min?i:o.originState.min,active:Number(e)===parseFloat(e)&&0<Number(e)}),n({min:Number(e)===parseFloat(e)&&0<=Number(e)?e:i!==o.originState.min?i:o.originState.min})},o.onMinChange=function(e){var t=o.state.min;e.target.value.trim()&&o.setState({showTips:!0}),void 0!==t&&Number(t)===parseFloat(t)&&String(t).startsWith("0")&&e.target.value?o.setState({min:Number(e.target.value)}):o.setState({min:e.target.value.trim()})},o.onSliderChange=function(e){var t=e[0],e=e[1];o.setState({min:t,max:e})},o.originState={min:e.min||0,minNum:0,show:!1,showTips:!1,target:""},o.state=C()({},Object.assign({},o.originState),{active:!1}),o}o()(e,t);var a=e.prototype;return a.componentDidMount=function(){var a=this,e=this.props,t=e.savedKey,n=e.onChange;t&&!function(){return N.apply(this,arguments)}({projectId:w.t.get(w.V.curProject).id,key:t}).then(function(e){var t,e=e.data;if(2e4===e.code&&e.result)try{t=JSON.parse(e.result).min,a.originState.min=t}catch(e){}finally{a.setState({min:t,minNum:t,active:0<t}),n({min:t})}}),window.addEventListener("click",this._setPadShowFalse)},a.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},a.render=function(){var t=this,e=this.props,a=e.title,n=e.max,i=this.state,s=i.min,o=i.show,r=i.showTips,e=i.active;i.minNum;return I().createElement("div",{className:"yt_slider_range_wrapper",onClick:function(e){o&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation())}},I().createElement(h.default,{placement:"top",content:"数值范围",mouseEnterDelay:.6},I().createElement("i",{className:"icon-cem_volume",style:{color:o||e?"#7262FD":"#8c8c8c"},onClick:function(e){o&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){return t.setState({show:!o})},0)}})),I().createElement("div",{className:"yt_slider_range_content",onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},style:{display:o?"block":"none"}},I().createElement("div",{className:"title"},a),I().createElement(d.Z,{onChange:this.onSliderChange,range:{draggableTrack:!0},value:[s,n],max:this.props.max,min:0,tooltipVisible:!1}),I().createElement("div",{className:"input_wrap",onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},I().createElement(c.default,{style:{marginRight:70},value:s,onChange:this.onMinChange,onFocus:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),t.setState({target:e.target.className})},onBlur:function(e){t.setState({target:""})},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}}),I().createElement("span",null,n)),r&&I().createElement("p",null,"下次默认按设置的最小值展示"),I().createElement("div",{className:"button_wrap",style:{marginTop:r?0:32}},I().createElement(l.default,{onClick:function(){t.setState({min:t.originState.min})}},"重置"),I().createElement("div",{className:"right"},I().createElement(l.default,{type:"primary",onClick:this.onOk},"确定"),I().createElement(l.default,{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),t._setPadShowFalse()}},"取消")))))},e}(I().PureComponent);t.propTypes={title:n().string,savedKey:n().string,min:n().number,max:n().number,onChange:n().func};const D=t;var R=a(87219),M=a(50976),j=a(94644),Y=["positive","negative","total"];const B=function(d){function e(e){var c=d.call(this,e)||this;return c.resizeListener=function(){var e;c.chartRef&&(0,_.P)(c.state.data)&&c.dataset&&(e=c.chartRef.getWidth(),1<(0,m.jD)(c.dataset[c.datasetIndex].source.slice(1).map(function(e){return e[0]}).join(""),12)/(.6*e)&&c.setState({dragEnd:!0}))},c.onAspectChange=function(){var e=c.state,t=e.filterName,a=e.min,n=e.dragEnd,i=c.props,e=i.bsType,s=i.save,o=i.data,r=i.aspectVolumeType;t&&("aspect2"===e?c.setState({filterName:""},function(){var e=c.setValue(P(o,"aspect1"),"aspect1",r,"aspect1",a,"");s({selectAspectObj:{value:e[Y.indexOf(r)].slice(1,6).map(function(e){return e[0]}),type:"aspect1",color:e[Y.indexOf(r)].slice(1,6).map(function(e,t){return[e[0],O.OW[t]]})}}),c.setState({start:0,end:16<e[Y.indexOf(r)].length?Math.floor(15/(e[Y.indexOf(r)].length-1)*100)-.93:100,data:o&&"empty"!==o&&1===e[Y.indexOf(r)].length?"empty_filter":c.props.data})}):"businessPoint_aspect"===e&&c.setState({filterName:""},function(){var e=c.setValue(P(o,"businessPoint"),"businessPoint",r,"businessPoint",a,"");s({selectAspectObj:{value:e[Y.indexOf(r)].slice(1,6).map(function(e){return e[0]}),type:"businessPoint",color:e[Y.indexOf(r)].slice(1,6).map(function(e,t){return[e[0],O.OW[t]]})}}),c.setState({start:0,end:16<e[Y.indexOf(r)].length?Math.floor(15/(e[Y.indexOf(r)].length-1)*100)-.93:100,data:o&&"empty"!==o&&1===e[Y.indexOf(r)].length?"empty_filter":c.props.data})}),n&&c.setState({dragEnd:!1}))},c.onAspectTypeChange=function(e){var t=c.props,a=t.onFilterChange,n=t.data,i=t.aspectVolumeType,s=(t.bsType,c.state),o=s.filterName,t=s.min,s=s.dragEnd,t=(0,_.P)(n)?c.setValue(P(n,e),e,i,e,t,""):[];a({aspectType:e,selectAspectObj:{type:e,value:t[Y.indexOf(i)]&&1<t[Y.indexOf(i)].length?t[Y.indexOf(i)].slice(1,6).map(function(e){return e[0]}):[],color:t[Y.indexOf(i)]&&1<t[Y.indexOf(i)].length?t[Y.indexOf(i)].slice(1,6).map(function(e,t){return[e[0],O.OW[t]]}):[]}}),o&&c.setState({filterName:""}),c.setState({setTypeActive:!0,start:0,end:t[Y.indexOf(i)]&&16<t[Y.indexOf(i)].length?Math.floor(15/(t[Y.indexOf(i)].length-1)*100)-.93:100,data:n&&"empty"!==n&&1===t[Y.indexOf(i)].length?"empty_filter":n}),s&&c.setState({dragEnd:!1})},c.onExportImage=function(){c.chartRef&&(0,j._v)(c.chartRef,c.props.title)},c.onExportExcel=function(){var e=c.props,t=e.title,a=e.bsType,n=c.state,e=n.filterName,n=n.data;(0,_.P)(n)&&(n=[c.dataset[c.datasetIndex].source],(0,j.aT)(n,"businessPoint_aspect"===a?e+"-"+t:t))},c._handleOnJumpMsg=function(e,t){c.props.onMsgClick(e,t)},c.onChartClick=function(e){e.componentSubType;var t=e.componentType,a=(e.color,e.name),n=(e.data,e.seriesIndex,e.value),i=c.props,s=i.bsType,o=i.save,e=i.selectAspectObj,r=i.aspectVolumeType,i=c.state,l=i.min,i=i.dragEnd;"xAxis"===t?("aspect1"===s?c.setState({filterName:n},function(){var e=c.setValue(P(c.props.data,"aspect2"),"aspect2",r,"aspect2",l,n);c.setState({start:0,end:16<e[Y.indexOf(r)].length?Math.floor(15/(e[Y.indexOf(r)].length-1)*100)-.93:100,data:c.props.data&&"empty"!==c.props.data&&1===e[Y.indexOf(r)].length?"empty_filter":c.props.data}),o({selectAspectObj:{value:e[Y.indexOf(r)].slice(1,6).map(function(e){return e[0]}),type:"aspect2",color:e[Y.indexOf(r)].slice(1,6).map(function(e,t){return[e[0],O.OW[t]]})}})}):"businessPoint"===s&&c.setState({filterName:n},function(){var e=c.setValue(P(c.props.data,"businessPoint_aspect"),"businessPoint_aspect",r,"businessPoint_aspect",l,n);c.setState({start:0,end:16<e[Y.indexOf(r)].length?Math.floor(15/(e[Y.indexOf(r)].length-1)*100)-.93:100,data:c.props.data&&"empty"!==c.props.data&&1===e[Y.indexOf(r)].length?"empty_filter":c.props.data}),o({selectAspectObj:{value:e[Y.indexOf(r)].slice(1,6).map(function(e){return e[0]}),type:"businessPoint_aspect",color:e[Y.indexOf(r)].slice(1,6).map(function(e,t){return[e[0],O.OW[t]]})}})}),i&&c.setState({dragEnd:!1})):"series"===t&&(e.type,i=e.value,e.color,t=(0,R.ZP)(i,function(e){return e.find(function(e){return e===a})?1<e.length?e.filter(function(e){return e!==a}):(p.default.warning("趋势图至少保留一条趋势线"),e):void(e.length<10?e.push(a):p.default.warning("最多展示10个趋势线，已满10个。无法再添加趋势线"))}),i=c.dataset[c.datasetIndex].source.slice(1),o({selectAspectObj:C()({},e,{value:t,color:u(i,t)})}))},c.onFilterAspectChange=function(t){var e=c.state,a=e.dragEnd,n=e.filterName,e=c.props,i=e.save,s=e.selectAspectObj,o=e.aspectVolumeType,r=e.aspectType,l=e.data,u=e.bsType;a&&c.setState({dragEnd:!1}),c.setState({min:t.min},function(){var e=(0,_.P)(l)?c.setValue(P(l,u),r,o,u,t.min,n):[];e[Y.indexOf(o)]&&(i({selectAspectObj:{type:s.type,value:1<e[Y.indexOf(o)].length?e[Y.indexOf(o)].slice(1,6).map(function(e){return e[0]}):[],color:1<e[Y.indexOf(o)].length?e[Y.indexOf(o)].slice(1,6).map(function(e,t){return[e[0],O.OW[t]]}):[]}}),c.setState({start:0,end:c.dataset[c.datasetIndex]&&c.dataset[c.datasetIndex].source&&16<c.dataset[c.datasetIndex].source.length?Math.floor(15/(c.dataset[c.datasetIndex].source.length-1)*100)-.93:100,data:l&&"empty"!==l&&1===e[Y.indexOf(o)].length?"empty_filter":l}))})},c.onBrushSelected=function(e){var t,a,n,i=c.dataset[c.datasetIndex].source.slice(1),s=e.type,o=e.batch,r=c.props,e=r.selectAspectObj,r=r.save,l=e.value;e.color;"brushselected"===s&&(s=o[0].selected[0].dataIndex,o=s,n=[],(a=i)&&a instanceof Array&&a.length&&o.forEach(function(e){n.push(a[e][0])}),t=n,!s||!s.length||l.length===t.length&&t.every(function(e){return-1<l.indexOf(e)})?c.chartRef&&c.chartRef.dispatchAction({type:"brush",areas:[]}):(s=(0,R.ZP)(l,function(n){return n.length===t.length&&t.every(function(e){return-1<n.indexOf(e)})?n:10===n.length&&t.length?(p.default.warning("最多展示10个趋势线，已满10个。无法再添加趋势线"),void(c.chartRef&&c.chartRef.dispatchAction({type:"brush",areas:[]}))):void(t.length&&t.forEach(function(t,e,a){n.find(function(e){return e===t})||n.length<10&&n.push(t)}))}),r({selectAspectObj:C()({},e,{value:s,color:u(i,s)})})))},c.onDataZoom=function(e){var t,a,n=e.start,i=e.end;"datazoom"===e.type&&c.chartRef&&(0,_.P)(c.state.data)&&(t=c.chartRef.getWidth(),c.timer&&clearTimeout(c.timer),a=100<c.dataset[c.datasetIndex].source.length-1?73:40,c.timer=setTimeout(function(){t/a<=i-n?c.setState({dragEnd:!0,start:n,end:i}):c.setState({dragEnd:!1,start:n,end:i})},200))},c.state={rangeChecked:!1,showLabel:!1,min:0,filterName:"",setWordActive:!1,setTypeActive:!1,dragEnd:!1,start:0,end:54,data:e.data},c}o()(e,d);var t=e.prototype;return t.componentDidMount=function(){var n=this;this.renderChart(),this.internalId=setInterval(function(){var e,t,a;n.chartRef&&(clearInterval(n.internalId),n.renderChart(),t=(e=n.chartRef._dom.children)[0],a=e[1],t.addEventListener("mouseleave",function(e){n.chartLeaveTimeout=setTimeout(function(){n.chartLeaveTimeout&&(a.style.display="none")},2e3)}),a&&a.addEventListener("mouseenter",function(e){n.chartLeaveTimeout=void 0}))},200),window.addEventListener("resize",this.resizeListener)},t.componentDidUpdate=function(e,t){var a,n=this,i=e.data,s=e.aspectVolumeType,o=e.aspectType,r=(e.bsType,this.props),l=r.data,u=r.aspectVolumeType,c=r.aspectType,p=r.bsType,d=r.save,f=r.selectAspectObj,v=t.min,h=t.showLabel,m=t.dragEnd,E=t.start,g=t.end,T=this.state,y=T.min,b=T.showLabel,S=T.dragEnd,r=T.start,t=T.end,T=T.filterName;JSON.stringify(i)!==JSON.stringify(l)&&(a=(0,_.P)(l)?this.setValue(P(l,p),c,u,p,y,T)[Y.indexOf(u)]:[],p=l&&"empty"!==l&&1===a.length?"empty_filter":l,!(0,_.P)(p)&&this.chartRef&&(this.chartRef=void 0),this.setState({start:0,end:16<a.length?Math.floor(15/(a.length-1)*100)-.93:100,data:p},function(){n.renderChart(),d({selectAspectObj:C()({},f,{value:1<a.length?a.slice(1,6).map(function(e){return e[0]}):[],color:1<a.length?a.slice(1,6).map(function(e,t){return[e[0],O.OW[t]]}):[]})})})),u===s&&JSON.stringify(e.selectAspectObj)===JSON.stringify(f)&&h===b&&o===c||this.renderChart(),Number(v)!==Number(y)&&(u=(0,_.P)(l)?this.setValue(P(l,c),c,u,c,y,T)[Y.indexOf(u)]:[],u=l&&"empty"!==l&&1===u.length?"empty_filter":l,this.setState({data:u},function(){n.renderChart()})),m===S&&E===r&&g===t||this.setState({dragEnd:S,start:r,end:t},function(){n.renderChart()}),!(0,_.P)(l)&&this.chartRef&&(this.chartRef=void 0)},t.componentWillUnmount=function(){window.removeEventListener("resize",this.resizeListener)},t.renderChart=function(){var e=this.props,t=e.title,a=e.aspectType,n=e.aspectVolumeType,i=e.bsType,s=e.selectAspectObj,o=this.state,r=o.showLabel,l=o.filterName,u=o.min,c=o.dragEnd,p=o.start,e=o.end,o=o.data;(0,_.P)(o)&&this.chartRef&&d.prototype.renderChart.call(this,P(o,i),t,a,n,i,u,l,r,s.value,c,p,e,this.onAspectChange,this._handleOnJumpMsg)},t.render=function(){var t=this,e=this.props,a=e.loading,n=e.title,i=e.bsType,s=e.aspectType,o=e.aspectTypeFlavor,r=e.aspectVolumeType,l=e.aspectVolumeTypeFlavor,u=(e.selectAspectObj,e.save,e.onFilterChange),c=e.onFlavorChange,p=this.state,d=p.showLabel,f=p.min,e=p.filterName,v=p.dragEnd,p=p.data;return I().createElement(_.Z,{className:"yt_product_aspectTrend_bar_chart",data:p,loading:a,emptyFilterHint:"暂无对应数据，请重新选择数值范围",renderTitle:I().createElement(b.Z,{title:"businessPoint_aspect"===i?e+"-"+n:n,data:p},I().createElement("div",{className:"operate_zone"},I().createElement(x,{className:this.state.setTypeActive?"set_Top_active":"",options:g,activeObj:s,rightHook:!0,flavor:o,onChange:this.onAspectTypeChange,onFlavorChange:function(e){return c({aspectTypeFlavor:e})}}),I().createElement(x,{className:this.state.setTopActive?"set_Top_active":"",options:V,activeObj:r,flavor:l,rightHook:!0,onChange:function(e){t.setState({setTopActive:!0,start:0,end:t.dataset&&t.dataset[Y.indexOf(e)]&&16<t.dataset[Y.indexOf(e)].source.length?Math.floor(15/(t.dataset[Y.indexOf(e)].source.length-1)*100)-.93:100,data:t.props.data&&"empty"!==t.props.data&&1===t.dataset[Y.indexOf(e)].source.length?"empty_filter":t.props.data}),v&&t.setState({dragEnd:!1}),u({aspectVolumeType:e,value:t.dataset&&t.dataset[Y.indexOf(e)]&&1<t.dataset[Y.indexOf(e)].source.length?t.dataset[Y.indexOf(e)].source.slice(1,6).map(function(e){return e[0]}):[],color:t.dataset&&t.dataset[Y.indexOf(e)]&&1<t.dataset[Y.indexOf(e)].source.length?t.dataset[Y.indexOf(e)].source.slice(1,6).map(function(e,t){return[e[0],O.OW[t]]}):[]})},onFlavorChange:function(e){return c({aspectVolumeTypeFlavor:e})}})),I().createElement("div",{className:"icon_zone"},I().createElement(D,{title:"只对指标声量做数值筛选",min:f,max:(0,_.P)(this.props.data)?Math.max.apply(null,P(this.props.data,s).map(function(e){return e.total})):0,savedKey:"product_aspectTrend_filter",onChange:this.onFilterAspectChange}),I().createElement("div",{className:"icon"},I().createElement(h.default,{placement:"top",content:"显示图表标签",mouseEnterDelay:.6},I().createElement("i",{className:"icon-tubiaobiaoqian "+(d?"active":""),onClick:function(){t.setState({showLabel:!d})}}))),I().createElement("div",{className:"icon"},I().createElement(h.default,{placement:"top",content:"导出数据",mouseEnterDelay:.6},I().createElement("i",{className:"icon-daochu",onClick:this.onExportExcel}))),I().createElement("div",{className:"icon"},I().createElement(h.default,{placement:"top",content:"导出图片",mouseEnterDelay:.6},I().createElement("i",{className:"icon-xiazaitupian",onClick:this.onExportImage})))))},e&&I().createElement("div",{className:"bread_menu"},I().createElement("span",{className:"filter_name",onClick:this.onAspectChange},e),I().createElement("span",null," ",">"," ","aspect2"===i?"二级指标":"末级指标")),I().createElement(M.Z,{onChartReady:this.getChartRef,theme:"yt_multi_color_10",option:{},style:{width:"100%",height:"100%"},onEvents:{click:this.onChartClick,brushselected:this.onBrushSelected,datazoom:this.onDataZoom}}))},e}(s);a(6373);var G=a(82891),W=(a(54214),a(12386)),U=(a(54067),a(64713)),z=[{title:"指标好评率",value:"posRate"},{title:"正面占比",value:"posRatio"},{title:"正面总占比",value:"posRatioTotal"},{title:"指标正面声量",value:"positive"}],Z=[{title:"指标差评率",value:"negRate"},{title:"负面占比",value:"negRatio"},{title:"负面总占比",value:"negRatioTotal"},{title:"指标负面声量",value:"negative"}],J=[{title:"指标声量",value:"total"},{title:"指标提及率",value:"menRate"}],H=[{title:"指标声量",value:"total"},{title:"指标正面声量",value:"positive"},{title:"指标负面声量",value:"negative"},{title:"指标好评率",value:"posRate"},{title:"指标差评率",value:"negRate"}];function q(e){var t=0;e.forEach(function(e){e=e.slice(1).sort(function(e,t){return t-e}),e=parseFloat(e[0]);t<e&&(t=e)});for(var t=Math.ceil(t),a=0;a<4;a++)t%4!=0&&t++;return{intVal:(t=0===t?4:t)/4,maxVal:t}}const K=function(t){function e(e){var d=t.call(this,e)||this;return d.renderChart=function(){var e,l,n,i,t,u,a=d.props,s=a.data,o=a.title,r=a.aspectDateType,c=a.selectAspectObj,p=d.state.showLabel;(0,_.P)(s)&&d.chartRef&&(e=d.rateInfo().rateType,e=function(e,t,a,l,n,u,c){var i,s,e=(s=(i=e).map(function(e){return e.name}),{dateList:o=(i[0]&&i[0].list&&i[0].list.map(function(e){return e.title})||[]).map(function(a){return[a].concat(s.map(function(t){var e=i.find(function(e){return e.name===t});if(e){e=e.list.find(function(e){return e.title===a});if(e)return e.count}return 0}))}),source:[["日期"].concat(s)].concat(o),objNames:s}),o=e.source,r=e.objNames,p=e.dateList,d=!1;u&&(u.includes("Rate")||u.includes("Ratio"))&&(d=!0);var n=n.color,f=n.map(function(e){return e[0]}),v=n.map(function(e){return e[1]}),h=r.map(function(e){return v[f.indexOf(e)]});return{title:{text:t},grid:{top:100,left:36,right:60,bottom:56,containLabel:!0},dataset:{source:o},xAxis:{axisPointer:{type:"line",label:{show:!1}},type:"category",boundaryGap:!1,axisLabel:{formatter:function(e){return(0,m.Sn)(l,e)}},data:p.map(function(e){return e[0]})},yAxis:{type:"value",axisPointer:!1,axisLabel:{color:"#626262",formatter:function(e){return d?Math.round(100*e)+"%":(0,m.hE)(e)}},interval:d?q(o.slice(1).map(function(e){return e.map(function(e){return 100*e})})).intVal/100:q(o.slice(1)).intVal,max:d?q(o.slice(1).map(function(e){return e.map(function(e){return 100*e})})).maxVal/100:q(o.slice(1)).maxVal,axisLine:{show:!1,lineStyle:{type:"dashed",color:"#e5e5e5"}},splitLine:{show:!0,lineStyle:{color:["#e5e5e5"],width:1,type:"dashed"}}},series:[].concat(r.map(function(e,t){return{type:"line",name:r[t],color:h[t],smooth:!0,showSymbol:!0,symbolSize:1,data:p.map(function(e){return{value:e[t+1],tooltip:{trigger:"item",formatter:function(s,o,r){return setTimeout(function(){var e=s.seriesName,t=s.name,a=s.data,n=s.marker,i="\n                <div style=\"font-size: 12px; color: #8c8c8c; font-weight: 400;position:relative;\">\n                  <span style='position:absolute;width:40px;height:150px;left:-40px;top:-30px;'></span>\n                  <span style='position:absolute;width:40px;height:150px;right:-40px;top:-30px;'></span>\n                </div>\n                <span style='font-size: 12px;font-weight: 400;color:#8c8c8c;'>\n                  "+(0,m.Sn)(l,t)+"\n                </span>\n                ",a=[n+" "+e+'<span style="float: right; font-weight: 500; color: #000000;">\n                  '+(d?(100*a.value).toFixed(2)+"%":a.value)+"</span>"];r(o,(0,E.r)(i,a,[{title:"消息",icon:"icon-cem_jump-message",callback:function(){var e=p.map(function(e){return e[0]});c(s,"",t,e,u)}}],"yt_new_tooltip_wrapper"))},0)}},label:{show:a,position:"top",color:"#8C8C8C",formatter:function(e){return d?(100*e.value).toFixed(2)+"%":e.value}}}})}})),tooltip:{trigger:"axis",showDelay:20,hideDelay:10,enterable:!0,confine:!0,padding:0,backgroundColor:"#ffffff",borderColor:"#e5e5e5",borderWidth:"1",extraCssText:"border-radius: 2px;\n      box-shadow: 0px 9px 28px 8px rgba(0,0,0,0.05), 0px 6px 16px 0px rgba(0,0,0,0.08), 0px 3px 6px -4px rgba(0,0,0,0.12)",formatter:function(a,n,i){if(a.length)return setTimeout(function(){var e=a[0].axisValue,t=a.map(function(e){var t=e.marker,a=e.seriesName,e=e.data;return{name:t+" "+a+'<span style="float: right; font-weight: 500; color: #000000;">'+(d?(100*e.value).toFixed(2)+"%":(0,m.hE)(e.value))+"</span>",value:e.value}}).map(function(e){return e.name}),e='<span style="font-size: 12px; color: #8c8c8c; font-weight: 400;">'+(0,m.Sn)(l,e)+"</span>";i(n,(0,E.r)(e,t))},0)}},dataZoom:{show:!0,bottom:24,xAxisIndex:0,height:20,handleSize:"100%",showDetail:!1,borderColor:"transparent",dataBackground:{lineStyle:{color:"rgba(231, 243, 255, 1)",opacity:1},areaStyle:{color:"rgba(231, 243, 255, 1)",opacity:1}},fillerColor:"rgba(114, 98, 253, 0.3)",handleIcon:"path://M249.376256 0m102.4 0l0 0q102.4 0 102.4 102.4l0 819.2q0 102.4-102.4 102.4l0 0q-102.4 0-102.4-102.4l0-819.2q0-102.4 102.4-102.4Z",handleColor:"rgba(114, 98, 253, 1)"},legend:{top:50,left:30,right:48,itemWidth:10,itemHeight:10,type:"scroll",itemGap:24,data:r,icon:"circle",selectedMode:!1}}}((a=s,l=e,i=(s=c).type,t=s.value,u=[],u=(s=a).reduce(function(e,t){var a=e.find(function(e){return e.title===t.title});return a?(a.sum.posSum+=t.positive,a.sum.negSum+=t.negative,a.sum.totalSum+=t.total):(a={title:t.title,sum:{posSum:t.positive,negSum:t.negative,totalSum:t.total}},e.push(a)),e},[]),"aspect1"===i&&(s=a.reduce(function(e,t){var a,n=e.find(function(e){return e.name===t[i]});return n||(n={name:t[i],list:[{title:t.title,data:{positive:0,negative:0,total:0,messageTotal:t.messageTotal}}]},e.push(n)),n.name===t[i]&&((a=n.list.find(function(e){return e.title===t.title}))?(a.data.positive+=t.positive,a.data.negative+=t.negative,a.data.total+=t.total):n.list.push({title:t.title,data:{positive:t.positive,negative:t.negative,total:t.total,messageTotal:t.messageTotal}})),e},[])),"aspect2"!==i&&"businessPoint_aspect"!==i||(n="aspect2",s=a.reduce(function(e,t){var a=e.find(function(e){return e.name===t[n]});return a?a.list.push({title:t.title,data:{positive:t.positive,negative:t.negative,total:t.total,messageTotal:t.messageTotal}}):(a={name:t[n],list:[{title:t.title,data:{positive:t.positive,negative:t.negative,total:t.total,messageTotal:t.messageTotal}}]},e.push(a)),e},[])),s=(s=(s="businessPoint"===i?a.reduce(function(e,t){var a=t.businessPoint,n=(a.id,a.name),a=e.find(function(e){return e.name===n});return a||(a={name:n,list:[{title:t.title,data:{positive:0,negative:0,total:0,messageTotal:t.messageTotal}}]},e.push(a)),a.name===n&&(a.list.find(function(e){return e.title===t.title})?a.list.forEach(function(e){e.title===t.title&&(e.data.positive+=t.positive,e.data.negative+=t.negative,e.data.total+=t.total)}):a.list.push({title:t.title,data:{positive:t.positive,negative:t.negative,total:t.total,messageTotal:t.messageTotal}})),e},[]):s).filter(function(e){e=e.name;return t.includes(e)})).map(function(e){return{name:e.name,list:e.list.map(function(e){var t=e.data,a=e.title,n=u.find(function(e){return e.title===a}).sum,i=n.posSum,s=n.negSum,o=n.totalSum,r=0;switch(l){case"positive":r=t.positive;break;case"negative":r=t.negative;break;case"total":r=t.total;break;case"posRate":r=0===t.total?0:t.positive/t.total;break;case"negRate":r=0===t.total?0:t.negative/t.total;break;case"posRatio":r=0===i?0:t.positive/i;break;case"negRatio":r=0===s?0:t.negative/s;break;case"posRatioTotal":r=0===o?0:t.positive/o;break;case"negRatioTotal":r=0===o?0:t.negative/o;break;case"menRate":r=0===t.messageTotal?0:t.total/t.messageTotal}return{title:e.title,count:isNaN(r)?0:r}})}})),o,p,r,c,e,d.OnJumpMsg)||{},d.chartRef.clear(),d.chartRef.setOption(e))},d.getChartRef=function(e){return d.chartRef=e},d.rateInfo=function(){var e=d.props;return function(e,t,a){var n=[],i="",s="";switch(e){case"total":n=J,i=t.aspectTotalType,s=a.aspectTotalTypeFlavor;break;case"positive":n=z,i=t.aspectPosType,s=a.aspectPosTypeFlavor;break;case"negative":n=Z,i=t.aspectNegType,s=a.aspectNegTypeFlavor;break;case"businessPoint":n=H,i=t.aspectBusType,s=a.aspectBusTypeFlavor}return{rateOptions:n,rateType:i,fRateType:s}}(e.trendEmotion,{aspectTotalType:e.aspectTotalType,aspectPosType:e.aspectPosType,aspectNegType:e.aspectNegType,aspectBusType:e.aspectBusType},{aspectTotalTypeFlavor:e.aspectTotalTypeFlavor,aspectPosTypeFlavor:e.aspectPosTypeFlavor,aspectNegTypeFlavor:e.aspectNegTypeFlavor,aspectBusTypeFlavor:e.aspectBusTypeFlavor})},d.OnJumpMsg=function(e,t,a,n,i){var s=d.props.title;d.props.onMsgClick(e,s,a,n,i)},d.onExportImage=function(){d.chartRef&&(0,j._v)(d.chartRef,d.props.title)},d.onExportExcel=function(){var e=d.props,t=e.data,e=e.title;(0,_.P)(t)&&d.chartRef&&(t=[d.chartRef._model.option.dataset[0].source],(0,j.aT)(t,e))},d.onExportAllExcel=function(e){var t,a,n,i,s;e&&(t=(s=d.props).trendEmotion,a=s.selectAspectObj,n=s.OnExportRateData,i=s.businessPointName,s=s.data,e={type:"aspect1"===a.type?"aspect1":"aspect2",formula:e},"businessPoint"!==t&&(e.emotion=t),i&&(s=(s=s.find(function(e){return e.businessPoint.name===i})).businessPoint&&s.businessPoint.id,e.businessPoint=s+""),n(e))},d.state={showLabel:!1,setWordActive:!1,setTypeActive:!1,data:e.data},d}o()(e,t);var a=e.prototype;return a.componentDidMount=function(){var n=this;this.internalId=setInterval(function(){var e,t,a;n.chartRef&&(clearInterval(n.internalId),n.renderChart(),t=(e=n.chartRef._dom.children)[0],a=e[1],t.addEventListener("mouseleave",function(e){n.chartLeaveTimeout=setTimeout(function(){n.chartLeaveTimeout&&(a.style.display="none")},2e3)}),a&&a.addEventListener("mouseenter",function(e){n.chartLeaveTimeout=void 0}))},200)},a.componentDidUpdate=function(e,t){var a=this,n=e.data,i=e.trendEmotion,s=e.aspectDateType,o=e.aspectTotalType,r=e.aspectPosType,l=e.aspectNegType,u=e.aspectBusType,c=e.title,p=e.selectAspectObj,d=this.props,f=d.data,v=d.trendEmotion,h=d.aspectDateType,m=d.aspectTotalType,E=d.aspectPosType,g=d.aspectNegType,T=d.aspectBusType,y=d.title,e=d.selectAspectObj,d=t.showLabel,t=this.state.showLabel;(0,_.P)(f)&&JSON.stringify(n)!==JSON.stringify(f)&&(n=e.value,n=f&&"empty"!==f&&0===n.length?"empty_filter":f,!(0,_.P)(n)&&this.chartRef&&(this.chartRef=void 0),this.setState({data:n},function(){return a.renderChart()})),d!==t&&this.renderChart(),JSON.stringify(p)!==JSON.stringify(e)&&(e=e.value,e=f&&"empty"!==f&&0===e.length?"empty_filter":f,this.setState({data:e},function(){return a.renderChart()})),i===v&&s===h&&o===m&&r===E&&l===g&&u===T&&c===y||this.renderChart(),!(0,_.P)(f)&&this.chartRef&&(this.chartRef=void 0)},a.render=function(){var t=this,e=this.props,a=e.title,n=void 0===a?"指标趋势":a,i=e.titleOverlay,s=e.loading,o=e.aspectDateOptions,r=e.aspectDateType,l=e.aspectDateTypeFlavor,u=e.trendEmotion,c=e.onFilterChange,p=e.onFlavorChange,d=this.rateInfo(),a=d.rateOptions,f=d.rateType,e=d.fRateType,d=this.state,v=d.showLabel,d=d.data;return I().createElement(_.Z,{data:d,loading:s,className:"yt_prodcut_aspect_line_chart",emptyFilterHint:"暂无数据",renderTitle:I().createElement(b.Z,{title:n,data:d,titleOverlay:i},"businessPoint"!==u&&I().createElement(U.default.Group,{value:u,onChange:function(e){return c({trendEmotion:e.target.value})},size:"small"},I().createElement(U.default.Button,{value:"total"},"全部情感"),I().createElement(U.default.Button,{value:"positive"},"正面"),I().createElement(U.default.Button,{value:"negative"},"负面")),I().createElement(x,{className:this.state.setTypeActive?"set_Top_active":"",options:a,activeObj:f,flavor:e,rightHook:!0,onChange:function(e){t.setState({setTypeActive:!0}),c({rateType:e,emotion:u})},onFlavorChange:function(e){return p({fRateType:e,emotion:u})}}),I().createElement(x,{className:this.state.setTopActive?"set_Top_active":"",options:o,activeObj:r,flavor:l,rightHook:!0,onChange:function(e){t.setState({setTopActive:!0}),c({aspectDateType:e})},onFlavorChange:function(e){return p({aspectDateTypeFlavor:e})}}),I().createElement(h.default,{placement:"top",content:"显示图表标签",mouseEnterDelay:.6},I().createElement("i",{className:"icon-tubiaobiaoqian "+(v?"active":""),onClick:function(){t.setState({showLabel:!v})}})),"businessPoint"!==u?I().createElement(G.default,{placement:"bottomCenter",overlay:I().createElement(W.default,{className:"yt_prodcut_aspect_line_chart"},I().createElement(W.default.Item,{onClick:this.onExportExcel},"导出图中展示数据"),I().createElement(W.default.Item,{onClick:function(){return t.onExportAllExcel(f)}},"导出所有指标数据"))},I().createElement("i",{className:"icon-daochu"})):I().createElement(h.default,{placement:"top",content:"导出数据",mouseEnterDelay:.6},I().createElement("i",{className:"icon-daochu",onClick:this.onExportExcel})),I().createElement(h.default,{placement:"top",content:"导出图片",mouseEnterDelay:.6},I().createElement("i",{className:"icon-xiazaitupian",onClick:this.onExportImage})))},I().createElement(M.Z,{theme:"yt_multi_color_10",option:{},style:{width:"100%",height:"100%"},onChartReady:this.getChartRef}))},e}(I().Component);const X=function(e){var t=e.filterReady,a=e.filterChange,n=e.save,i=e.aspectCountData,s=e.fetchingAspectCountData,o=e.selectAspectObj,r=e.aspectType,l=e.aspectTypeFlavor,u=e.aspectVolumeType,c=e.aspectVolumeTypeFlavor,p=e.onFilterChange,d=e.onFlavorChange,f=e.onMsgClick,v=e.aspectTrendData,h=e.fetchingAspectTrendData,m=e.aspectTotalType,E=e.aspectPosType,g=e.aspectNegType,T=e.aspectBusType,y=e.aspectTotalTypeFlavor,b=e.aspectPosTypeFlavor,S=e.aspectNegTypeFlavor,P=e.aspectBusTypeFlavor,C=e.trendEmotion,O=e.aspectDateOptions,_=e.aspectDateType,x=e.aspectDateTypeFlavor,A=e.OnExportRateData,N=o.type,F=I().useRef(),w=I().useState(""),D=w[0],R=w[1],e=I().useState(""),w=e[0],M=e[1];return I().useEffect(function(){"businessPoint"===N?(R("业务视角趋势"),M("")):"businessPoint_aspect"===N?(R(F.current.state.filterName+"-指标趋势"),M(""+F.current.state.filterName)):(R("指标趋势"),M(""))},[N]),I().createElement("div",{className:"yt_product_aspectTrend_wrapper"},I().createElement(k.Z,{onReady:t,onChange:a,pageType:"ASPECT_TREND",advanceAuthority:!1,valueConf:["fullInfo"],showList:["fullDate","screening","save"],hasHour:!0},I().createElement("div",{className:"content"},I().createElement(B,{ref:F,loading:s,data:i,title:u?V.find(function(e){return e.value===u}).title:"",aspectType:r,aspectTypeFlavor:l,aspectVolumeType:u,aspectVolumeTypeFlavor:c,bsType:o.type||r,onFilterChange:p,onFlavorChange:d,onMsgClick:f,save:n,selectAspectObj:o}),I().createElement(K,{title:D,loading:h,data:v,trendEmotion:"businessPoint"===N?"businessPoint":C,aspectTotalType:m,aspectPosType:E,aspectNegType:g,aspectBusType:T,aspectTotalTypeFlavor:y,aspectPosTypeFlavor:b,aspectNegTypeFlavor:S,aspectBusTypeFlavor:P,aspectDateOptions:O,aspectDateType:_,aspectDateTypeFlavor:x,selectAspectObj:o,businessPointName:w,onFilterChange:p,onFlavorChange:d,OnExportRateData:A,onMsgClick:f,titleOverlay:I().createElement("div",{className:"yt_product_aspectTrend_trendOverlay"},I().createElement(L.rU,{className:"yt-feedback-read-more",to:"https://skieer.feishu.cn/docs/doccnR37Aig3B0ZG9gtMqRG4hwf",target:"_blank"},"了解计算公式"))}))))};var t=a(55609),Q=a(97194),s=a(64396),$=a(2329),ee=s.Z.product.aspectTrend.overview,s=function(t){function e(e){var E=t.call(this,e)||this;return E._handleFilterReady=function(e,t){var a=(0,Q.X)(e.dateFilter.numOfDays,!0),n=a.dateOptions,a=a.defaultDateType;E.props.fetchParams({projectId:w.t.get(w.V.curProject).id,filterModel:e.filterModel,headerFilterParamsNew:e.headerFilterParamsNew,dateFilter:e.dateFilter,aspectDateOptions:n,aspectDateTypeFlavor:a,filterValues:t.fullInfo.filterValue})},E._handleFilterChange=function(e,t,a){var n=(0,Q.X)(e.dateFilter.numOfDays,!0),i=n.dateOptions;E.props.save({filterModel:e.filterModel,headerFilterParamsNew:e.headerFilterParamsNew,dateFilter:C()({},e.dateFilter,{dateGroupType:n.defaultDateType}),aspectDateOptions:i,filterValues:t.fullInfo.filterValue}),E.props.fetchDatas(C()({},e,{dateFilter:C()({},e.dateFilter,{dateGroupType:n.defaultDateType})}))},E._handleOnFilterChange=function(e){var t=E.props,a=t.selectAspectObj,t=t.dateFilter;if(e.dateFilter)E.props.fetchDatas(C()({},e,{filterModel:e.filterValue,shouldRefreshChart:!0,projectId:w.t.get(w.V.curProject).id}));else if(e.aspectType)E.props.save(e);else if(e.aspectVolumeType)E.props.save({aspectVolumeType:e.aspectVolumeType,selectAspectObj:{value:e.value,type:a.type,color:e.color}});else if(e.trendEmotion)E.props.save(e);else if(e.rateType)switch(e.emotion){case"total":E.props.save({aspectTotalType:e.rateType});break;case"positive":E.props.save({aspectPosType:e.rateType});break;case"negative":E.props.save({aspectNegType:e.rateType});break;case"businessPoint":E.props.save({aspectBusType:e.rateType})}else e.aspectDateType&&E.props.fetchAspectTrendData({dateFilter:C()({},t,{dateGroupType:e.aspectDateType})})},E._handleOnFlavorChange=function(e){if(void 0!==e.fRateType)switch(e.emotion){case"total":E.props.setDefaultValue({aspectTotalTypeFlavor:e.fRateType});break;case"positive":E.props.setDefaultValue({aspectPosTypeFlavor:e.fRateType});break;case"negative":E.props.setDefaultValue({aspectNegTypeFlavor:e.fRateType});break;case"businessPoint":E.props.setDefaultValue({aspectBusTypeFlavor:e.fRateType})}else e.aspectDateTypeFlavor,E.props.setDefaultValue(e)},E._handleOnMsgClick=function(e,t,a,n,i){var s,o=e.componentSubType,r=e.seriesName,l=e.name,u=E.props,c=u.dateFilter,p=u.headerFilterParamsNew,d=u.filterValues,f=u.projectId,v=u.selectAspectObj.type,h=u.aspectVolumeType,e=u.aspectCountData,m=u.aspectTrendData,u=u.aspectDateType;"bar"===o&&(s="businessPoint"===v?e.find(function(e){return e.businessPoint[0].name===l}).businessPoint[0].id:null,e={dateFilter:c,filterModel:{project:[f],messageCategory:["COMMENT"]},filterValues:(0,R.ZP)(d,function(e){var t=e.find(function(e){return"DEFAULT"===e.id});t?(t.values.find(function(e){return"CATEGORY_TYPE"===e.id})||t.values.push({id:"CATEGORY_TYPE",label:"数据类型",values:["电商评论"]}),t.values.find(function(e){return"MESSAGE_TYPE"===e.id})||t.values.push({id:"MESSAGE_TYPE",label:"消息类型",values:["电商追评","电商评论"]}),t.values.find(function(e){return"EFFECTIVENESS_TYPE"===e.id})||t.values.push({id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["有效数据"]})):e.push({id:"DEFAULT",values:[{id:"CATEGORY_TYPE",label:"数据类型",values:["电商评论"]},{id:"MESSAGE_TYPE",label:"消息类型",values:["电商追评","电商评论"]},{id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["有效数据"]}]});t=e.find(function(e){return"ASPECT_MODEL"===e.id});t?t.values.find(function(e){return"ASPECT_ESCORE"===e.id})?e.find(function(e){return"ASPECT_MODEL"===e.id}).values.find(function(e){return"ASPECT_ESCORE"===e.id}).values="negative"===h?["负面指标"]:"positive"===h?["正面指标"]:["负面指标","正面指标"]:t.values.push({id:"ASPECT_ESCORE",label:"指标情感",values:"negative"===h?["负面指标"]:"positive"===h?["正面指标"]:["负面指标","正面指标"]}):e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT_ESCORE",label:"指标情感",values:"negative"===h?["负面指标"]:"positive"===h?["正面指标"]:["负面指标","正面指标"]}]});t=e.find(function(e){return"ASPECT_MODEL"===e.id});t?(s&&(t.values.find(function(e){return"BUSINESS_POINT"===e.id})?t.values.find(function(e){return"BUSINESS_POINT"===e.id}).values=[s]:t.values.push({id:"BUSINESS_POINT",label:"业务视角",values:[l]})),"aspect1"===v&&(t.values.find(function(e){return"ASPECT1"===e.id})?t.values.find(function(e){return"ASPECT1"===e.id}).values=[l]:t.values.push({id:"ASPECT1",label:"一级指标",values:[l]})),"aspect2"!==v&&"businessPoint_aspect"!==v||(t.values.find(function(e){return"ASPECT2"===e.id})?t.values.find(function(e){return"ASPECT2"===e.id}).values=[l]:t.values.push({id:"ASPECT2",label:"二级指标",values:[l]}))):(s&&e.push({id:"ASPECT_MODEL",values:[{id:"BUSINESS_POINT",label:"业务视角",values:[l]}]}),"aspect1"===v&&e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT1",label:"一级指标",values:[l]}]}),"aspect2"!==v&&"businessPoint_aspect"!==v||e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT2",label:"二级指标",values:[l]}]}))}),headerFilterParamsNew:(0,R.ZP)(p,function(e){var t=e.find(function(e){return"DEFAULT"===e.id});t?(t.values.find(function(e){return"CATEGORY_TYPE"===e.id})||t.values.push({id:"CATEGORY_TYPE",label:"数据类型",values:["COMMENT"]}),t.values.find(function(e){return"MESSAGE_TYPE"===e.id})||t.values.push({id:"MESSAGE_TYPE",label:"消息类型",values:["COMMENT_APPEND","MESSAGE_COMMENT"]}),t.values.find(function(e){return"EFFECTIVENESS_TYPE"===e.id})||t.values.push({id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["useful"]})):e.push({id:"DEFAULT",values:[{id:"CATEGORY_TYPE",label:"数据类型",values:["COMMENT"]},{id:"MESSAGE_TYPE",label:"消息类型",values:["COMMENT_APPEND","MESSAGE_COMMENT"]},{id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["useful"]}]});t=e.find(function(e){return"ASPECT_MODEL"===e.id});t?t.values.find(function(e){return"ASPECT_ESCORE"===e.id})?e.find(function(e){return"ASPECT_MODEL"===e.id}).values.find(function(e){return"ASPECT_ESCORE"===e.id}).values="negative"===h?["3"]:"positive"===h?["8"]:["3","8"]:t.values.push({id:"ASPECT_MODEL",values:[{id:"ASPECT_ESCORE",label:"指标情感",values:"negative"===h?["3"]:"positive"===h?["8"]:["3","8"]}]}):e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT_ESCORE",label:"指标情感",values:"negative"===h?["3"]:"positive"===h?["8"]:["3","8"]}]});t=e.find(function(e){return"ASPECT_MODEL"===e.id});t?(s&&(t.values.find(function(e){return"BUSINESS_POINT"===e.id})?t.values.find(function(e){return"BUSINESS_POINT"===e.id}).values=[s]:t.values.push({id:"BUSINESS_POINT",label:"业务视角",values:[s]})),"aspect1"===v&&(t.values.find(function(e){return"ASPECT1"===e.id})?t.values.find(function(e){return"ASPECT1"===e.id}).values=[l]:t.values.push({id:"ASPECT1",label:"一级指标",values:[l]})),"aspect2"!==v&&"businessPoint_aspect"!==v||(t.values.find(function(e){return"ASPECT2"===e.id})?t.values.find(function(e){return"ASPECT2"===e.id}).values=[l]:t.values.push({id:"ASPECT2",label:"二级指标",values:[l]}))):(s&&e.push({id:"ASPECT_MODEL",values:[{id:"BUSINESS_POINT",label:"业务视角",values:[s]}]}),"aspect1"===v&&e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT1",label:"一级指标",values:[l]}]}),"aspect2"!==v&&"businessPoint_aspect"!==v||e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT2",label:"二级指标",values:[l]}]}))}),projectId:f,filterTip:null},window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(e)))),"line"===o&&(f={dateFilter:(0,$.X_)("line",c,a,n,u),filterModel:{project:[f],messageCategory:["COMMENT"]},filterValues:(0,R.ZP)(d,function(e){var t=e.find(function(e){return"DEFAULT"===e.id});t?(t.values.find(function(e){return"CATEGORY_TYPE"===e.id})||t.values.push({id:"CATEGORY_TYPE",label:"数据类型",values:["电商评论"]}),t.values.find(function(e){return"MESSAGE_TYPE"===e.id})||t.values.push({id:"MESSAGE_TYPE",label:"消息类型",values:["电商追评","电商评论"]}),t.values.find(function(e){return"EFFECTIVENESS_TYPE"===e.id})||t.values.push({id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["有效数据"]})):e.push({id:"DEFAULT",values:[{id:"CATEGORY_TYPE",label:"数据类型",values:["电商评论"]},{id:"MESSAGE_TYPE",label:"消息类型",values:["电商追评","电商评论"]},{id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["有效数据"]}]});var a=e.find(function(e){return"ASPECT_MODEL"===e.id});a?a.values.find(function(e){return"ASPECT_ESCORE"===e.id})?e.find(function(e){return"ASPECT_MODEL"===e.id}).values.find(function(e){return"ASPECT_ESCORE"===e.id}).values=i.includes("neg")?["负面指标"]:i.includes("pos")?["正面指标"]:["负面指标","正面指标"]:a.values.push({id:"ASPECT_ESCORE",label:"指标情感",values:i.includes("neg")?["负面指标"]:i.includes("pos")?["正面指标"]:["负面指标","正面指标"]}):e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT_ESCORE",label:"指标情感",values:i.includes("neg")?["负面指标"]:i.includes("pos")?["正面指标"]:["负面指标","正面指标"]}]});t=e.find(function(e){return"ASPECT_MODEL"===e.id}),a="businessPoint"===v?m.find(function(e){return e.businessPoint.name===r}).businessPoint.id:null;t?(a&&(t.values.find(function(e){return"BUSINESS_POINT"===e.id})?t.values.find(function(e){return"BUSINESS_POINT"===e.id}).values=[a]:t.values.push({id:"BUSINESS_POINT",label:"业务视角",values:[r]})),"aspect1"===v&&(t.values.find(function(e){return"ASPECT1"===e.id})?t.values.find(function(e){return"ASPECT1"===e.id}).values=[r]:t.values.push({id:"ASPECT1",label:"一级指标",values:[r]})),"aspect2"!==v&&"businessPoint_aspect"!==v||(t.values.find(function(e){return"ASPECT2"===e.id})?t.values.find(function(e){return"ASPECT2"===e.id}).values=[r]:t.values.push({id:"ASPECT2",label:"二级指标",values:[r]}))):(a&&e.push({id:"ASPECT_MODEL",values:[{id:"BUSINESS_POINT",label:"业务视角",values:[r]}]}),"aspect1"===v&&e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT1",label:"一级指标",values:[r]}]}),"aspect2"!==v&&"businessPoint_aspect"!==v||e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT2",label:"二级指标",values:[r]}]}))}),headerFilterParamsNew:(0,R.ZP)(p,function(e){var t=e.find(function(e){return"DEFAULT"===e.id});t?(t.values.find(function(e){return"CATEGORY_TYPE"===e.id})||t.values.push({id:"CATEGORY_TYPE",label:"数据类型",values:["COMMENT"]}),t.values.find(function(e){return"MESSAGE_TYPE"===e.id})||t.values.push({id:"MESSAGE_TYPE",label:"消息类型",values:["COMMENT_APPEND","MESSAGE_COMMENT"]}),t.values.find(function(e){return"EFFECTIVENESS_TYPE"===e.id})||t.values.push({id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["useful"]})):e.push({id:"DEFAULT",values:[{id:"CATEGORY_TYPE",label:"数据类型",values:["COMMENT"]},{id:"MESSAGE_TYPE",label:"消息类型",values:["COMMENT_APPEND","MESSAGE_COMMENT"]},{id:"EFFECTIVENESS_TYPE",label:"数据有效性",values:["useful"]}]});var a=e.find(function(e){return"ASPECT_MODEL"===e.id});a?a.values.find(function(e){return"ASPECT_ESCORE"===e.id})?e.find(function(e){return"ASPECT_MODEL"===e.id}).values.find(function(e){return"ASPECT_ESCORE"===e.id}).values=i.includes("neg")?["3"]:i.includes("pos")?["8"]:["3","8"]:a.values.push({id:"ASPECT_ESCORE",label:"指标情感",values:i.includes("neg")?["3"]:i.includes("pos")?["8"]:["3","8"]}):e.push({id:"ASPECT_MODEL",values:[{id:"ASPECT_ESCORE",label:"指标情感",values:i.includes("neg")?["3"]:i.includes("pos")?["8"]:["3","8"]}]});t=e.find(function(e){return"ASPECT_MODEL"===e.id}),a="businessPoint"===v?m.find(function(e){return e.businessPoint.name===r}).businessPoint.id:null;t?(a&&(t.values.find(function(e){return"BUSINESS_POINT"===e.id})?t.values.find(function(e){return"BUSINESS_POINT"===e.id}).values=[a]:t.values.push({id:"BUSINESS_POINT",label:"业务视角",values:[a]})),"aspect1"===v&&(t.values.find(function(e){return"ASPECT1"===e.id})?t.values.find(function(e){return"ASPECT1"===e.id}).values=[r]:t.values.push({id:"ASPECT1",label:"一级指标",values:[r]})),"aspect2"!==v&&"businessPoint_aspect"!==v||(t.values.find(function(e){return"ASPECT2"===e.id})?t.values.find(function(e){return"ASPECT2"===e.id}).values=[r]:t.values.push({id:"ASPECT2",label:"二级指标",values:[r]}))):(a&&e.push({id:"ASPECT_MODEL",values:[{id:"BUSINESS_POINT",label:"业务视角",values:[a]}]}),"aspect1"===v&&e.push({id:"ASPECT1",label:"一级指标",values:[r]}),"aspect2"!==v&&"businessPoint_aspect"!==v||e.push({id:"ASPECT2",label:"二级指标",values:[r]}))}),projectId:f,filterTip:null},window.open("/inbox/public?"+encodeURIComponent(JSON.stringify(f))))},E._handleOnExportRateData=function(e){E.props.fetchExportRateData(e)},E.state={},E.event={filterReady:E._handleFilterReady,filterChange:E._handleFilterChange,onFilterChange:E._handleOnFilterChange,onFlavorChange:E._handleOnFlavorChange,onMsgClick:E._handleOnMsgClick,OnExportRateData:E._handleOnExportRateData},E}o()(e,t);var a=e.prototype;return a.componentWillUnmount=function(){this.props.clean()},a.render=function(){return I().createElement(X,C()({},this.props,this.state,this.event))},e}(I().PureComponent);const te=(0,t.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return C()({},e[ee],{fetchingAspectCountData:t.effects[ee+"/fetchAspectCountData"]||!1,fetchingAspectCount:t.effects[ee+"/fetchAspectCount"]||!1,fetchingPositiveAspectRate:t.effects[ee+"/fetchPositiveAspectRate"]||!1,fetchingNegativeAspectRate:t.effects[ee+"/fetchNegativeAspectRate"]||!1,fetchingAspectTrendData:t.effects[ee+"/fetchAspectTrendData"]||!1})},function(t){return{fetchParams:function(e){return t({type:ee+"/fetchParams",payload:e})},setDefaultValue:function(e){return t({type:ee+"/setDefaultValue",payload:e})},fetchDatas:function(e){return t({type:ee+"/fetchDatas",payload:e})},save:function(e){return t({type:ee+"/save",payload:e})},clean:function(e){return t({type:ee+"/clean",payload:e})},fetchAspectCountData:function(e){return t({type:ee+"/fetchAspectCountData",payload:e})},fetchAspectTrendData:function(e){return t({type:ee+"/fetchAspectTrendData",payload:e})},fetchExportRateData:function(e){return t({type:ee+"/fetchExportRateData",payload:e})}}})(s)}}]);