(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[5003],{5003:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var t=n(81506),a=n.n(t),t=n(85354),i=n.n(t),r=n(67294),d=n.n(r),s=n(92360),u=n(29383),l=n(36144),m=n(55815),p=n(13713),o=n(51474),c=n(61409),h=n(35239),g=function(t){function e(e){var c=t.call(this,e)||this;return c.initSortable=function(){var n=a()(c),e=document.querySelector(".el-table table tbody");c.sortable=o.ZP.create(e,{sort:!0,animation:150,onEnd:function(e){var t=e.oldIndex,e=e.newIndex;n.handleSort(t,e)}})},c.manualSort=function(){var e=c.state.idList;c.sortable.sort(e)},c.handleSort=function(e,t){var n=c.state,a=n.idList,i=n.id,n=a[e],o=JSON.parse(JSON.stringify(a));o.splice(e,1),o.splice(1<=t?t:0,0,n),l.h.post("/project/config/order",{ids:o,projectId:i}).then(function(e){2e4===e.data.code&&c.setState({idList:o})})},c.handleNameChange=function(e){c.setState({topicName:e})},c.handleConfirm=function(){switch(c.state.dialogType){case"add":c.handleAddTopic();break;case"rename":c.handleRenameTopic();break;case"delete":c.handleDeleteTopic()}},c.handleCancel=function(){c.setState({dialogVisible:!1,topicId:"",topicName:""})},c.handleAddTopic=function(){var e=c.state,t=e.id,e=e.topicName;0!==e.trim().length?l.h.post("/project/config/add",{projectId:t,name:e,parentId:""}).then(function(e){2e4===e.data.code&&(s.Message.success("添加成功"),c.handleCancel(),c.getProject(!1,!0))}):s.Message.warning("请输入主题名称")},c.handleRenameTopic=function(){var e=c.state,t=e.topicId,e=e.topicName;0!==e.trim().length?l.h.post("/project/config/update",{id:t,configName:e}).then(function(e){2e4===e.data.code&&(s.Message.success("更新成功"),c.getProject(!1,!0),c.handleCancel())}):s.Message.warning("请输入主题名称")},c.handleDeleteTopic=function(){var e=c.state.topicId;l.h.post("/project/config/delete",{id:e}).then(function(e){2e4===e.data.code&&(s.Message.success("删除成功"),c.getProject(!1,!0),c.handleCancel())})},c.state={id:h.t.get(h.V.backProjectConfig).id,name:"",type:"",topicId:[],topicName:"",topicList:[],idList:[],data:[],columns:[{label:"",prop:"paddingLeft",width:50,render:function(){return d().createElement("div",{className:"move_icon_container"},d().createElement("i",{className:"icon-cem_move"}))}},{label:"主题",prop:"configName",width:400},{label:"主题值数量",prop:"topicCount",render:function(e){return d().createElement("span",{className:"operation_columns",onClick:c.startEdit.bind(a()(c),e)},e.topicCount)}},{label:"操作",prop:"operate",render:function(e,t,n){return d().createElement("div",{className:"operates"},d().createElement("button",{type:"button",className:"operation_columns",onClick:c.startEdit.bind(a()(c),e)},"主题值管理"),d().createElement("button",{type:"button",className:"operation_columns",onClick:function(){return c.setState({dialogVisible:!0,topicId:e.id,topicName:e.configName,dialogType:"rename"})}},"重命名"),d().createElement("button",{type:"button",className:"operation_columns",onClick:function(){return c.setState({dialogVisible:!0,topicId:e.id,topicName:e.configName,dialogType:"delete"})}},"删除"))}}],dialogVisible:!1,dialogType:""},c}i()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.getProject(!0,!1),this.initSortable()},n.componentDidUpdate=function(){var e=this.state.topicList,t=document.querySelectorAll(".el-table__body tbody tr");if(t&&0<t.length)for(var n=0;n<t.length;n++)for(var a=0;a<e.length;a++)t[n].children[1].innerText===e[a].name&&t[n].setAttribute("data-id",e[a].id)},n.changeData=function(e){var t,n,a=[];for(t in e.configList)e.configList.hasOwnProperty(t)&&((n=e.configList[t]).level=1,n.disabled=!0,n.canEdit=!1,a.push(n),n.child&&(n.child.level=2,n.child.disabled=!0,n.child.canEdit=!1,a.push(n.child),n.child.child&&(n.child.child.level=3,n.child.child.disabled=!0,n.child.child.canEdit=!1,a.push(n.child.child))));return a},n.addChild=function(e){c.mW.push({pathname:"/account/project/topic",state:{id:"",parentTypeId:e,projectId:this.state.id}})},n.startEdit=function(e){c.mW.push({pathname:"/account/project/topic/topicValue",state:{id:e.id,parentTypeId:e.parentId,projectId:this.state.id,name:e.configName}})},n.getProject=function(n,a){var i=this,o=this.state.id;this.setState({loading:!0},function(){l.h.post("/project/config/list",{projectId:o,projectConfigIds:[]}).then(function(e){var t=e.data,e=t.result,t=t.result.configList;e.id=o,i.setState({id:o,name:e.name,type:e.templateName,data:i.changeData(e),idList:t.map(function(e){return e.id})},function(){a&&i.manualSort()}),n&&i.setState({topicList:t.map(function(e){return{id:e.id,name:e.configName}})})}).finally(function(){return i.setState({loading:!1})})})},n.render=function(){var e=this,t=this.state,n=t.columns,a=t.data,i=t.loading,o=t.dialogVisible,c=t.dialogType,l=t.topicName,t=document.documentElement.clientHeight-46-78-24;return d().createElement("div",{className:"flex-col"},d().createElement("div",{className:"flex-other"},d().createElement(m.Z,{title:(0,p.u)({title:"主题"}),rightContent:d().createElement(s.Button,{type:"primary",onClick:function(){return e.setState({dialogVisible:!0,dialogType:"add"})}},"添加主题")}),d().createElement("div",{className:"topic"},d().createElement("div",{style:{minHeight:t}},d().createElement(s.Loading,{loading:i,text:"拼命加载中"},d().createElement(u.Z,{className:"topic-table",columns:n,data:a,rowClassName:function(){return"sortable-row"},notLimit:!0}))),d().createElement(s.Dialog,{title:"rename"===c?"重命名主题":"add"===c?"添加主题":"",size:"tiny",visible:o,onCancel:function(){return e.handleCancel()},customClass:"toggle"===c?"without-padding-dialogbody":"",lockScroll:!0},d().createElement(s.Dialog.Body,null,"delete"===c&&d().createElement(r.Fragment,null,d().createElement("div",{className:"dialog-title"},d().createElement("i",{className:"icon-cem_warning",style:{color:"#D96969"}}),"是否删除该主题？"),d().createElement("div",{className:"delete-tips"},"删除后",d().createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"“",l,"”"),"这个主题后，属于",d().createElement("span",{style:{color:"#262626",fontWeight:"bold"}},"“",l,"”"),"的主题值将从提数任务上移除")),("add"===c||"rename"===c)&&d().createElement(r.Fragment,null,d().createElement("div",{className:"form-item"},d().createElement("label",null,"主题名称"),("add"===c||"rename"===c)&&d().createElement(s.Input,{value:l,placeholder:"请输入主题名称",onChange:this.handleNameChange})))),d().createElement(s.Dialog.Footer,{className:"dialog-footer"},d().createElement(s.Button,{type:"primary",onClick:this.handleConfirm},"delete"===c?"是":"确定"),!("add"===c)&&d().createElement(s.Button,{onClick:function(){return e.handleCancel()}},"delete"===c?"否":"取消"))))))},e}(r.Component)},13713:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var a=n(35239),i=function(e){var t=e.title,e=e.url;return[{title:"所有项目",url:"/account/project"},{title:a.t.get(a.V.backProjectConfig).name,url:"/account/project/preview"},{title:t,url:e}]}}}]);