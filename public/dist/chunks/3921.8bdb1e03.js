(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[3921,1438],{4333:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>B});var a=n(67154),f=n.n(a),t=n(93913),r=n.n(t),a=n(85354),o=n.n(a),v=n(67294),y=n.n(v),S=n(92360),h=n(5133),E=n(29383),g=n(36144),k=n(55815),C=n(1486),i=n(61193),c=n(61409),b=n(35239),t=n(45697),a=n.n(t),l=n(91438),s=n(80157),t=n(94184),u=n.n(t),N=function(r){function e(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=r.call.apply(r,[this].concat(n))||this).getParams=function(){var e=t.refs.filter?{filterModel:t.refs.filter.getParams()}:{filterModel:{}};return t.refs.time&&(e.dateFilter=t.refs.time.getParams()),e},t.getAspect=function(){var e=t.props.filter;return e&&e.show&&e.aspect?t.refs.filter.getAspect():null},t.setAspectType=function(){var e=t.props.filter;return e&&e.show&&e.aspect&&(e=t.refs.filter).changeAspectType.apply(e,arguments)},t}o()(e,r);var t=e.prototype;return t.componentDidMount=function(){this.refs.filter||this.props.confirm&&this.props.confirm()},t.render=function(){var e=this.props,t=e.title,n=e.time,a=e.filter,r=e.className,e=e.confirm,r=u()("header",r);return y().createElement("div",{className:r},t&&y().createElement("div",{className:"page-title"},t),a&&a.show&&y().createElement(s.Z,f()({ref:"filter"},a,{confirm:e})),n&&n.show&&y().createElement(l.default,{ref:"time",model:n.model,group:n.group,onceShow:n.onceShow,confirm:e}))},e}(v.Component);N.defaultProps={title:"",filter:{show:!1,aspect:!1},time:{show:!1,group:!1},model:null,id:null,confirm:null},N.propTypes={confirm:a().func,time:a().object,title:a().string,model:a().string,id:a().string,filter:a().object};var I=n(84267);const _=function(t){function e(e){var i=t.call(this,e)||this;return i.updateVisibleState=function(e,t,n){i.setState({id:e,title:t,body:n,dialogVisible:!i.state.dialogVisible})},i._handleOnConfirm=function(e){var t=i.props,n=t.onConfirm,a=t.title,t=i.state,r=t.id,o=t.title;e.stopPropagation(),i.setState({dialogVisible:!1},function(){return n(r,o||a)})},i._handleOnCancel=function(e){var t=i.props,n=t.onCancel,a=t.title,t=i.state,r=t.id,o=t.title;e.stopPropagation(),i.setState({dialogVisible:!1},function(){return n(r,o||a)})},i.state={id:void 0,title:void 0,body:void 0,dialogVisible:!1},i}return o()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.title,a=e.body,r=this.state,e=r.title,r=r.body;return y().createElement(S.Dialog,{customClass:"cem-delete-dialog-small",title:n||e,modal:!1,closeOnClickModal:!1,visible:this.state.dialogVisible,onCancel:function(e){return t.setState({dialogVisible:!1})}},y().createElement(S.Dialog.Body,null,y().createElement("span",null,a||r)),y().createElement(S.Dialog.Footer,null,y().createElement(S.Button,{type:"primary",onClick:this._handleOnConfirm},"确定"),y().createElement(S.Button,{type:"default",onClick:this._handleOnCancel},"取消")))},e}(y().Component);var d=n(68003),w=n(17190);const p=function(e){var t=e.data,n=e.formModel,a=e.onChange,r=e.onBlur,o=e.spuList,i=e.spuTip,c=e.skuList,l=e.skuTip,s=e.onFocus,e=y().useState(i),u=e[0],d=e[1],e=y().useState(l),p=e[0],m=e[1];return y().useEffect(function(){d(i)},[i]),y().useEffect(function(){m(l)},[l]),y().createElement("div",null,y().createElement("div",null,t.name),y().createElement("div",{className:"divider"}),y().createElement(S.Input,{disabled:!0,placeholder:t.sourceName,prepend:y().createElement("span",null,"数据来源"),className:"prepend-input"}),y().createElement(S.Input,{disabled:!0,placeholder:t.url,prepend:y().createElement("span",null,"SKU链接"),className:"prepend-input"}),y().createElement("div",{className:"source"},y().createElement(S.Checkbox,{checked:!0,disabled:!0,className:"COMMENT"===t.taskType?"checked":""},"评论数据"),y().createElement(S.Checkbox,{checked:!0,disabled:!0,className:"PRICE"===t.taskType?"checked":""},"价格数据")),y().createElement(S.Form.Item,{prop:"name",label:"任务名称"},y().createElement(S.Input,{onBlur:function(e){return r("name",e.target.value)},onChange:function(e){return a("name",e,"")},placeholder:"请输入任务名称",value:n.extra.name})),o&&0<o.length&&y().createElement(S.Form.Item,{prop:"spu",label:"SPU词条",className:"spu_sku_select_item"},y().createElement(w.Z,{onChange:function(e){a("spuGroupId",e,"extra")},trigger:"click",data:o,value:n.extra.spuGroupId,onTipClick:function(){u&&d(""),s()},addText:"创建SPU词条",onAddClick:function(){window.open("/account/project/base?drawerVisible=true")},className:(u?"content-error":"")+" select_opts"}),u&&y().createElement("span",{className:"content-error-hint"},u)),c&&0<c.length&&y().createElement(S.Form.Item,{prop:"sku",label:"SKU词条",className:"spu_sku_select_item"},y().createElement(w.Z,{onChange:function(e){a("skuGroupId",e.id,"extra")},trigger:"click",data:n.extra.spuGroupId?c.filter(function(e){return e.parentId===n.extra.spuGroupId}):c,value:n.extra.skuGroupId,onTipClick:function(){p&&m(""),s()},addText:"创建SKU词条",disabled:!n.extra.spuGroupId,onAddClick:function(){window.open("/account/project/base/sku?spuId="+n.extra.spuGroupId+"&spuName="+o.find(function(e){return e.id===n.extra.spuGroupId}).name+"&drawerVisible=true")},className:(p?"content-error":"")+" select_opts"}),p&&y().createElement("span",{className:"content-error-hint"},p)))};var O=n(35303),t=function(t){function e(e){var o=t.call(this,e)||this;return o._handleOnInputChange=function(e){var n=o.props.separator;o.setState({value:e},function(){var e,t;"space"===n&&(e=(t=o.state).value,t=t.tagData,e.endsWith(" ")&&o._updateValue(e,t))})},o._handleOnKeyDown=function(e){var t=o.props.separator,n=void 0===t?"enter":t,a=o.state,t=a.value,a=a.tagData;13===e.keyCode?o.props.single&&0<a.length?o.setState({value:""}):"space"===n?t?o._updateValue(t,a).then(function(){o._handleOnSearch()}):o._handleOnSearch():"enter"===n&&o._updateValue(t,a):8===e.keyCode&&(t||o._deleteWord())},o._deleteWord=function(){var e=o.props.onChange,t=o.state,n=t.value,t=t.tagData;!n&&0<t.length&&o.setState({tagData:t.splice(0,t.length-1)},function(){e&&e(o.state.tagData.join(" "))})},o._handleOnTagClose=function(t){var e=o.props.onChange;o.setState({tagData:o.state.tagData.filter(function(e){return e!==t})},function(){e&&e(o.state.tagData.join(" "))})},o._handleOnInputBlur=function(e){var t=o.state.tagData;o._updateValue(e.target.value,t)},o._updateValue=function(a,r){return new Promise(function(e){var t=a.trim(" "),n=o.props.onChange;0<t.length&&(r.includes(t)?h.Z.warning("该关键词已存在"):(t=[].concat(r,[t]),o.setState({value:"",tagData:t}),n&&n(t.join(" ")),e()))})},o._handleOnSearch=function(){var e=o.props.onSearch;e&&e(o.state.tagData.join(" "))},o.clear=function(){o.setState({value:"",tagData:[]});var e=o.props.onChange;e&&e("")},o.state={tagData:e.value?e.value.split(" ").filter(function(e){return e}):[],value:""},o}o()(e,t);var n=e.prototype;return n.componentWillUnmount=function(){this.setState({tagData:[],value:""})},n.componentDidUpdate=function(e,t){var n=this.state.tagData,a=this.props,r=a.single,o=a.onChange,a=a.id;r&&1<n.length&&(n=n.slice(0,1),this.setState({value:"",tagData:n}),o(n.join(" "))),a!==e.id&&this.setState({value:"",tagData:[]})},n.render=function(){var t=this,e=this.state,n=e.tagData,a=e.value,r=this.props,o=r.placeholder,i=r.disabled,c=void 0!==i&&i,l=r.append,e=r.size,i=r.onKeyUp,r=r.type,r=void 0===r?"normal":r,o={placeholder:o,disabled:c};return l&&(o.append=l),"search"===r&&(o.append=y().createElement("i",{onClick:this._handleOnSearch,className:"icon-cem_search"})),e&&(o.size=e),i&&(o.size=i),y().createElement(S.Input,f()({value:a,className:"keyword-input-wrapper",onBlur:this._handleOnInputBlur,prepend:y().createElement("span",null,n.map(function(e){return y().createElement(S.Tag,{key:e,closable:!c,closeTransition:!1,onClose:t._handleOnTagClose.bind(t,e)},e)})),onChange:this._handleOnInputChange,onKeyDown:this._handleOnKeyDown},o))},e}(v.Component);const m=t;t.propTypes={type:a().oneOf(["search","normal"]),append:a().object,size:a().string,disabled:a().bool,plactHolder:a().string,onChange:a().func,onKeyUp:a().func,separator:a().oneOf(["space","enter"]),onSearch:a().func,single:a().bool,onClear:a().func};var D=[{label:"包含",value:"contain"},{label:"不包含",value:"notContain"}],T={contain:[""],notContain:[],id:Math.round(1e4*Math.random())},t=function(t){function e(e){var o=t.call(this,e)||this;return o._handleOnRuleGroupAdd=function(){var e=o.state.content,e=[].concat(e,[JSON.parse(JSON.stringify(T))]);o.setState({content:e,formProps:o.getFormProps(e)})},o._handleOnRuleItemAdd=function(e){var t=o.state.content;t[e]&&((t=JSON.parse(JSON.stringify(t)))[e].contain||(t[e].contain=[]),t[e].contain.push(""),o.setState({content:t,formProps:o.getFormProps(t)}))},o._handleOnRuleItemDelete=function(e){var t,n,a;e&&(a=o.state.content,(n=e.split("-"))[0],t=n[1],e=n[2],n=n[3],a[t]&&a[t][e]&&void 0!==a[t][e][n]&&((a=JSON.parse(JSON.stringify(a)))[t][e].splice(n,1),0===a[t].contain.length&&0===a[t].notContain.length&&a.splice(t,1),o.setState({content:a,formProps:o.getFormProps(a)})))},o._handleOnSelecChange=function(e,t){var n,a,r;e&&t&&(a=o.state.content,(r=e.split("-"))[0],n=r[1],e=r[2],r=r[3],a[n]&&a[n][e]&&void 0!==a[n][e][r]&&(r=(a=JSON.parse(JSON.stringify(a)))[n][e].splice(r,1),a[n][t].push(r[0]),o.setState({content:a,formProps:o.getFormProps(a)})))},o._handleOnInputChange=function(e,t){var n,a,r;e&&(r=o.state.content,(a=e.split("-"))[0],n=a[1],e=a[2],a=a[3],r[n]&&r[n][e]&&void 0!==r[n][e][a]&&((r=JSON.parse(JSON.stringify(r)))[n][e][a]=t,o.setState({content:r,formProps:o.getFormProps(r)})))},o.getValue=function(){return o.state.content},o.getFormProps=function(e){var r={model:{},rules:{}};return e&&0<e.length&&e.forEach(function(e,a){e&&["contain","notContain"].forEach(function(n){e[n]&&e[n].forEach(function(e,t){t="rule-"+a+"-"+n+"-"+t;r.model[t]=e,r.rules[t]=[{required:!0,message:"请输入内容规则",trigger:"blur"}]})})}),r},o.formRef=void 0,o.state={content:(e.value||[]).map(function(e){return f()({},e,{id:Math.round(1e4*Math.random())})}),formProps:{model:{},rules:{}}},o}o()(e,t);var n=e.prototype;return n.componentDidUpdate=function(e){var t=e.value,e=this.props.value;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({content:e,formProps:this.getFormProps(e)})},n.render=function(){var o=this,e=this.state,t=e.content,n=e.formProps,e=this.props.editable,i=void 0===e||e;return y().createElement("div",{className:"content-rule-2-wrapper"},y().createElement("span",{className:"content-rule-2-title"},"内容"),y().createElement("div",{className:"content-rule-2"},0<t.length?y().createElement(S.Form,f()({},n,{ref:function(e){return o.formRef=e}}),y().createElement("span",null,"如果"),t.map(function(e,r){return y().createElement("div",{className:"content-rule-2-group",key:e.id},["contain","notContain"].map(function(a){return e[a]&&e[a].map(function(e,t){var n="rule-"+r+"-"+a+"-"+t;return y().createElement("div",{key:n,className:"content-rule-2-group-item"},y().createElement("span",null,"内容"),y().createElement("span",null,y().createElement(S.Select,{disabled:!i,value:a,onChange:function(e){return o._handleOnSelecChange(n,e)}},D.map(function(e){return y().createElement(S.Select.Option,{key:e.value,label:e.label,value:e.value})}))),y().createElement("span",null,y().createElement(S.Form.Item,{prop:n},y().createElement(S.Input,{disabled:!i,value:e,onChange:function(e){return o._handleOnInputChange(n,e)}}))),i&&y().createElement("span",null,y().createElement("i",{className:"icon-cem_delete",onClick:function(){return o._handleOnRuleItemDelete(n)}})))})}),i&&y().createElement(S.Button,{className:"content-rule-2-btn btn-and",onClick:function(){return o._handleOnRuleItemAdd(r)}},"且 +"))}),i&&y().createElement(S.Button,{className:"content-rule-2-btn",type:"primary",onClick:this._handleOnRuleGroupAdd},"或 +")):i&&y().createElement(S.Button,{className:"content-rule-2-btn",type:"primary",onClick:this._handleOnRuleGroupAdd},"添加规则内容")))},e}(y().PureComponent);const x=t;var P={multiple:!(t.propTypes={value:a().array,editable:a().bool}),tags:!1,optionFilterProp:"label",optionLabelProp:"label",showSearch:!1};const L=function(e){var n=e.formModel,t=e.psData,a=e.sData,r=e.onChange,o=e.pcCount,i=e.onBlur,c=e.getContentRuleRef;return y().createElement("div",{className:"keyword-add-wrapper"},y().createElement(S.Form.Item,{prop:"sourceId",label:"数据来源"},y().createElement("div",null,y().createElement(O.RS,f()({className:"m_select_"+(o+0),value:n.extra.sourceId,onChange:function(e){return r("sourceId",e,"extra")}},P),t.values.map(function(e,t){return y().createElement(O.Wx,{key:t,label:e.name,value:e.id},e.name)})))),a&&y().createElement(S.Form.Item,{prop:"sourceChildId",label:"子来源"},y().createElement("div",null,y().createElement(O.RS,f()({className:"m_select_"+(o+1),value:n.extra.sourceChildId,onChange:function(e){return r("sourceChildId",e,"extra")}},P),a.map(function(e,t){return y().createElement(O.Wx,{key:t,label:e.sourceChildShowName,value:e.sourceChildId},e.sourceChildShowName)})))),a&&a.find(function(e){return e.sourceChildId===n.extra.sourceChildId}).viewConfig.map(function(e,t){return y().createElement(S.Form.Item,{key:t,prop:e.itemProperty.name,label:e.itemProperty.showName},function(e,t,n,a,r,o){switch(t.itemType){case"input":return"key"===t.itemProperty.name?y().createElement("div",{style:{padding:"4px 0"}},"11"===e.extra.sourceId?y().createElement(x,{value:e.extra[t.itemProperty.name],ref:o}):y().createElement(m,{id:e.extra.sourceChildId,single:"14"===e.extra.sourceId,placeholder:t.itemProperty.placeholder,onChange:function(e){return n(t.itemProperty.name,e,"extra")}})):y().createElement(S.Input,{onBlur:function(e){return r(t.itemProperty.name,e.target.value)},style:{padding:"4px 0"},value:e.extra[t.itemProperty.name],placeholder:t.itemProperty.placeholder,onChange:function(e){return n(t.itemProperty.name,e,"extra")}});case"select-dropdown":return y().createElement("div",null,y().createElement(O.RS,{className:"m_select_"+a,value:e.extra[t.itemProperty.name],onChange:function(e){return n(t.itemProperty.name,e,"extra")}},t.itemProperty.selectItems.map(function(e,t){return y().createElement(O.Wx,{key:t,label:e.name,value:e.id},e.name)})))}}(n,e,r,o+2+t,i,c))}))},M=function(e){var t=e.data,n=e.formModel,a=e.onChange,r=e.onBlur,e=e.getContentRuleRef;return y().createElement("div",{className:"keyword-edit-wrapper"},y().createElement(S.Input,{style:{padding:"4px 0"},disabled:!0,placeholder:t.sourceName,prepend:y().createElement("span",null,"数据来源"),className:"prepend-input"}),y().createElement(S.Input,{style:{padding:"4px 0"},disabled:!0,placeholder:t.sourceChildName,prepend:y().createElement("span",null,"子来源"),className:"prepend-input"}),y().createElement(S.Form.Item,{prop:"",label:"关键词"},"11"===t.sourceId?y().createElement(x,{value:JSON.parse(t.url),ref:e,editable:!1}):y().createElement(m,{disabled:!0,value:t.url})),y().createElement(S.Form.Item,{prop:"name",label:"任务名称"},y().createElement(S.Input,{onBlur:function(e){return r("name",e.target.value)},onChange:function(e){return a("name",e,"extra")},placeholder:"请输入任务名称",value:n.extra.name})))};var a=function(t){function e(e){var m=t.call(this,e)||this;return m._fetchSourceDetail=function(a){var n=m.state.formModel;g.h.post("/source/sourcechild/config",{sourceId:a.sourceId}).then(function(e){var t=e.data;2e4===t.code&&(t=(e=t.result)[0].viewConfig.reduce(function(e,t){var n;switch(t.itemType){case"input":n="name"===t.itemProperty.name?(m.defName=V(a.sourceName,""),m.defName):("key"===t.itemProperty.name&&(m.keyName=t.itemProperty.showName),"");break;case"select-dropdown":n=t.itemProperty.selectItems[0].id}return f()({},e,((e={})[t.itemProperty.name]=n,e))},{}),t=f()({},n,{extra:f()({},t,{categoryId:e[0].categoryId,categoryName:e[0].categoryName,sourceId:a.sourceId,sourceName:a.sourceName,sourceChildId:e[0].sourceChildId})}),m.setState({sData:e,loading:!1,formModel:t}))})},m._fetchTopics=function(t){g.h.post("/subscribe-topic/list",{projectId:t,pageIndex:1,pageSize:100,name:"",valueFrom:[t]}).then(function(e){e=e.data.result.result.filter(function(e){return"USER_CUSTOMIZE"===e.topicType});m.setState({topicOpts:e}),e.forEach(function(e,n){g.h.post("/subscribe-topic-value/list",{projectId:t,topicId:e.id,valueFrom:[t],pageSize:1e3,pageIndex:1}).then(function(e){var t;2e4===e.data.code&&m.setState(((t={})["topicValue"+n]=e.data.result.result,t))})})})},m._fetchConnectionCommondData=function(e){g.h.post("/projects/connection/search",{id:e}).then(function(e){var t,n,e=e.data;2e4===e.code&&(e=e.result.titles,t=[],n={},e&&e instanceof Array&&e.forEach(function(e){t.push(e),n[e.id]=[];e=e.child;e&&(t.push(e),n[e.id]="")}),0<t.length&&m.setState({pcData:t,defPcData:[].concat(t),formModel:f()({},n),pcFormModel:n}))})},m._handleOnCancel=function(){m.setState(f()({},m.cleanState))},m._handleSelectFilterMethod=function(a,r,o){var e=m.state,i=e.pcData,c=e.formModel,l=c[r.id];l!==a&&(m.filterTimeoutId&&clearTimeout(m.filterTimeoutId),m.filterTimeoutId=setTimeout(function(){var e=r.values.filter(function(e){return e.name.includes(a)}),t=e.find(function(e){return e.name===a});!a||t||0!==e.length&&l===a||e.push({name:a,id:""});var e=f()({},r,{fValues:e});i[o]=e;var n=f()({},c,((e={})[r.id]=a,e));m.setState({pcData:i},function(){return m.setState({formModel:n},function(){var e=document.getElementsByClassName("m_select_"+o)[0];e.childNodes[1].setAttribute("style",A(e.childNodes[0].offsetTop-m.mScrollTop+40,107,"block"))})})},500))},m._handleOnSubmit=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),m.contentRuleRef?0===(m.contentRuleRef?m.contentRuleRef.getValue():[]).length?h.Z.error("关键词不能为空"):m.contentRuleRef.formRef.validate(function(e){e?m._updateConnectionSetting():h.Z.error("提取条件中存在内容规则为空")}):m._updateConnectionSetting()},m._updateConnectionSetting=function(){var e=m.state,t=e.formModel,n=(e.psData,e.type),s=e.pcData,a=e.title,r=(e.spuTip,e.skuTip,e.topicOpts),o=m.props,i=o.projectId,c=o.onConfirm,l=o.spuList,u=o.skuList,e="/connection/update",o=void 0;if(n.includes("add")){if(e="/projects/connection/add",!t.extra.name)return void h.Z.error("名称不能为空");if(m.contentRuleRef){if(0===(o=m.contentRuleRef.getValue()).length||0===o[0].contain.length&&0===o[0].noContain.length)return void h.Z.error("关键词不能为空");o.forEach(function(n){n.contain.forEach(function(e,t){return n.contain[t]=e.toUpperCase()}),n.notContain.forEach(function(e,t){return n.notContain[t]=e.toUpperCase()})})}else if(!t.extra.key)return void h.Z.error(m.keyName+"不能为空")}var d=JSON.parse(JSON.stringify(t));Object.keys(d).forEach(function(t){if("extra"!==t){for(var e=d[t],n=[],a=s.filter(function(e){return e.id===t})[0].values,r=0;r<e.length;r++){for(var o,i,c=!1,l=0;l<a.length;l++)e[r]===a[l].name&&(o=(i=a[l]).id,i=i.name,n.push({id:o,name:i}),c=!0);c||n.push({id:"",name:e[r]})}d[t]=n}});var t=f()({},d.extra),p=[];r&&r.forEach(function(e){m.state["value"+e.id]&&p.push({id:e.id,name:m.state["id"+e.id]})});i=f()({projectId:i,categoryId:t.categoryId,categoryName:t.categoryName,sourceName:t.sourceName,topics:Object.keys(d).filter(function(e){return"extra"!==e}).map(function(t){return{topicTypeId:t,topicArr:"编辑链接任务"===a&&0<d[t].length?d[t]:[{id:s.find(function(e){return e.id===t}).values.find(function(e){return e.name.includes("空值")}).id,name:s.find(function(e){return e.id===t}).values.find(function(e){return e.name.includes("空值")}).name}]}}),customizeConfig:p},t);l&&0<l.length&&u&&0<u.length&&(i.flag="PROJECT"),o&&(i.key=JSON.stringify(o),i.content=o),m.props.spuList&&m.props.spuList.length&&!t.spuGroupId?m.setState({spuTip:"请选择SPU词条"}):m.props.skuList&&m.props.skuList.length&&!t.skuGroupId?m.setState({skuTip:"请选择SKU词条"}):g.h.post(e,i).then(function(e){2e4===e.data.code&&h.Z.success("操作成功"),m.setState(f()({},m.cleanState),function(){return c()})})},m._handleOnSelectChange=function(e,t,n){var a,r;e&&e.length&&(a=e[e.length-1],m.state["topicValue"+t].find(function(e){return e.value===a})?m.setState(((r={})["value"+n.id]=[a],r["id"+n.id]=m.state["topicValue"+t].find(function(e){return e.value===a}).id,r)):g.h.post("/subscribe-topic-value/add",{projectId:m.props.projectId,topicId:n.id,value:a}).then(function(e){var t=e.data;2e4===t.code&&m.setState(((e={})["value"+n.id]=[a],e["id"+n.id]=t.result,e))})),e.length||m.setState(((e={})["value"+n.id]=void 0,e))},m._handleFormValueChange=function(e,t,n){var a=m.state,r=a.formModel,o=a.psData,a=a.sData,i=f()({},r);"extra"===n?(i.extra[e]=t,"sourceId"===e?(i.extra.key="",i.extra.sourceName=o.values.find(function(e){return e.id===t}).name,m.defName=V(i.extra.sourceName,""),i.extra.name=m.defName):"sourceChildId"===e?(i.extra.key="",m.keyName=a.find(function(e){return e.sourceChildId===t}).viewConfig.find(function(e){return"key"===e.itemProperty.name}).itemProperty.showName):"key"===e?(m.defName=V(o.values.find(function(e){return e.id===r.extra.sourceId}).name,t),i.extra.name=m.defName,i.extra[e]="string"==typeof t?t.trim():t instanceof Array?t.filter(function(e){return e})[0]:""):"spuGroupId"===e?(i.extra.spuGroupId=t.id,i.extra.spuGroupName=t.name,i.extra.skuGroupId=void 0):"skuGroupId"===e&&(i.extra.skuGroupId=t)):i[e]=t,m.setState({formModel:i},function(){"sourceId"===e&&m._fetchSourceDetail({sourceId:i.extra.sourceId,sourceName:i.extra.sourceName})})},m._handelOnSelectClick=function(e){m.setState({curSelectIdx:e});e=document.getElementsByClassName("m_select_"+e)[0];e.childNodes[1].setAttribute("style",A(e.childNodes[0].offsetTop-m.mScrollTop+40,107,"block"))},m._handleOnSelectVisibleChange=function(e,t){t||setTimeout(function(){e===m.state.curSelectIdx&&m.setState({curSelectIdx:-1})},100)},m._handleOnNameInputBlur=function(e,t){"name"!==e||t||(t=m.state.formModel,(t=f()({},t)).extra.name=m.defName||"",m.setState({formModel:t}))},m._handleOnSelectBlur=function(e){setTimeout(function(){document.getElementsByClassName("m_select_"+e)[0].childNodes[1].setAttribute("style",A(0,1e4,"none"))},500)},m._handleGetContentRuleRef=function(e){return m.contentRuleRef=e},m._handleOnFocus=function(){var e=m.props,t=e.spuList,n=e.skuList,a=e.projectId,e=b.t.get(b.V.newEntry)||{},r=e.spuName,o=e.skuName,i=e.spuId,c=e.skuId;(r&&!t.find(function(e){return r.includes(e.name.replaceAll(e.split,"").replaceAll("|",""))})||o&&!n.find(function(e){return o.includes(e.name.replaceAll(e.split,"").replaceAll("|",""))})||i&&!t.find(function(e){return String(e.id)===String(i)})||c&&!n.find(function(e){return String(e.id)===String(c)}))&&g.h.post("/subproject-connection/group/list",{projectId:a})},m.renderDiffComp=function(){var e=m.state,t=e.type,n=e.cData,a=e.formModel,r=e.psData,o=e.sData,i=e.pcData,c=e.spuTip,l=e.skuTip,e=m.props,s=e.spuList,u=e.skuList;switch(t){case"connection-edit":return"KEYWORD"===n.taskType?y().createElement(M,{data:n,onBlur:m._handleOnNameInputBlur,formModel:a,onChange:m._handleFormValueChange,getContentRuleRef:m._handleGetContentRuleRef}):y().createElement(p,{data:n,onBlur:m._handleOnNameInputBlur,formModel:a,onChange:m._handleFormValueChange,spuList:s,spuTip:c,skuList:u,skuTip:l,onFocus:m._handleOnFocus});case"keyword-add":return y().createElement(L,{formModel:a,pcCount:i.length,psData:r,onChange:m._handleFormValueChange,sData:o,onBlur:m._handleOnNameInputBlur,getContentRuleRef:m._handleGetContentRuleRef})}},m.renderSelectOption=function(e){return(e.fValues||e.values).map(function(e,t){return y().createElement(O.Wx,{key:t,value:e.name,className:""===e.id?"new-selection":""},e.name)})},m.defName=void 0,m.keyName=void 0,m.state={pcData:[],defPcData:[],title:"",psData:{id:"sources",name:"数据来源",values:[{id:"11",name:"知乎"},{id:"12",name:"新浪微博"},{id:"14",name:"百度贴吧"}]},cData:void 0,sData:void 0,visible:!1,loading:!1,formModel:{extra:{}},pcFormModel:{},curSelectIdx:-1,spuTip:"",skuTip:"",topicOpts:[]},m}o()(e,t);var n=e.prototype;return n.updateVisibleState=function(e,t){var a=this,n=this.state,r=n.pcFormModel,o=n.psData,i=n.topicOpts,c=t||{};switch(e){case"connection-edit":l="KEYWORD"===t.taskType?"编辑关键词任务":"编辑链接任务",(u=c.configDetails.reduce(function(e,t){var n;return t.topicTypeId?f()({},e,((n={})[t.topicTypeId]=t.topicArr.filter(function(e){return!e.name.includes("空值")}).map(function(e){return e.name}),n)):e},{extra:{id:c.id}})).extra.name=c.name,u.extra.spuGroupId=c.spuGroupId,u.extra.skuGroupId=c.skuGroupId,i.forEach(function(t,e){var n;c.skuTopics&&c.skuTopics.find(function(e){return String(e.topicId)===String(t.id)})&&c.skuTopics.find(function(e){return String(e.topicId)===String(t.id)}).topicValueId&&a.setState(((n={})["value"+t.id]=[c.skuTopics.find(function(e){return String(e.topicId)===String(t.id)}).topicValue],n["id"+t.id]=c.skuTopics.find(function(e){return String(e.topicId)===String(t.id)}).topicValueId,n))}),this.defName=c.name;break;case"keyword-add":var l="新增关键词任务",s=o.values[0],u=f()({},r,{extra:{sourceId:s.id}});c.sourceId=s.id,c.sourceName=s.name}var d=e.includes("add");this.setState({type:e,title:l,formModel:u,cData:c,loading:d,visible:!0},function(){return d&&a._fetchSourceDetail(a.state.cData)})},n.componentDidMount=function(){var e=this.props.projectId;this._fetchConnectionCommondData(e),this._fetchTopics(e)},n.render=function(){var a=this,e=this.state,t=e.visible,n=e.loading,r=e.formModel,o=e.pcData,i=e.title,c=e.topicOpts,l=this.props,s=l.title,e=l.spuList,l=l.skuList,o="编辑链接任务"===i?o.map(function(e,t){return f()({},e,{values:e.values.filter(function(e){return!e.name.includes("空值")})})}):o;return y().createElement(S.Dialog,{className:"cem-edit-dialog-large",visible:t,closeOnClickModal:!1,title:s||i,onCancel:this._handleOnCancel},y().createElement(S.Dialog.Body,null,y().createElement(S.Loading,{loading:n},t&&y().createElement(S.Form,{model:r},this.renderDiffComp(),e&&l&&c&&c?c.map(function(t,n){return y().createElement("div",{className:"topic_select_item",key:t.id},y().createElement("span",{className:"ellipsis"},t.name),y().createElement(O.RS,{tags:!0,multiple:!1,onChange:function(e){a._handleOnSelectChange(e,n,t)},value:a.state["value"+t.id],optionLabelProp:"label",optionFilterProp:"label",placeholder:"请选择或者输入"},a.state["topicValue"+n]&&a.state["topicValue"+n].map(function(e){return y().createElement(O.Wx,{key:e.id,value:e.value,label:e.value},e.value)})))}):null,o.map(function(t,e){return y().createElement(S.Form.Item,{key:e,label:t.name,prop:t.id},y().createElement("div",null,y().createElement(O.RS,{className:"m_select_"+e,value:r[t.id],onChange:function(e){return a._handleFormValueChange(t.id,e,"")},placeholder:"请选择已有"+t.name+"或键入新的"+t.name,multiple:!0,tags:!0},a.renderSelectOption(t))))})))),y().createElement(S.Dialog.Footer,null,y().createElement(S.Button,{type:"primary",onClick:this._handleOnSubmit},"确定"),y().createElement(S.Button,{type:"default",onClick:this._handleOnCancel},"取消")))},r()(e,[{key:"cleanState",get:function(){this.mScrollTop=0,this.defName=void 0;var e=this.state,t=e.defPcData,e=e.pcFormModel;return{visible:!1,loading:!1,cData:void 0,pcData:[].concat(t),sData:void 0,curSelectIdx:-1,formModel:f()({},e,{extra:{}}),spuTip:"",skuTip:""}}}]),e}(y().Component),V=function(e,t){return"从"+e+"数据源依据"+t+"关键词提取"},A=function(e,t,n){return"min-width: 595px; top: "+e+"px !important; left: "+t+"px !important; will-change: top, left; transform: all 0.3s; display: "+n+" !important"};const R=a;var j=function(t){function e(e){e=t.call(this,e)||this;return e.state={defaultChecked:!1},e}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.setState(f()({},this.props))},n.componentWillReceiveProps=function(e){this.setState(f()({},e))},n.handleClick=function(e){var t=this.state,n=t.type,a=t.defaultChecked,r=t.selectedList,t=t.totalList;"checkAll"===n?a?this.props.onChange([]):this.props.onChange(t):(-1<(t=r.indexOf(e))?r.splice(t,1):r.push(e),this.props.onChange(r)),this.setState({defaultChecked:!a})},n.render=function(){var t=this,e=this.state,n=e.type,a=e.defaultChecked,r=e.indeterminate,o=e.uniqueId,e="customized-checkobx";return a?e="customized-checkobx checked":"checkAll"===n&&r&&(e="customized-checkobx indeterminate"),y().createElement("div",{className:"customized-checkobx-wrapper"},y().createElement("div",{className:e,onClick:function(e){e.stopPropagation(),t.handleClick(o)}}))},e}(y().PureComponent),a=n(30381),F=n.n(a),B=function(t){function e(e){var p=t.call(this,e)||this;return p._getLinkName=function(e){return e.name||e.configDetails.map(function(e){return e.topicTypeValue}).join(" ")},p._handleDeleteConfirm=function(t){var n=p.state.pageIndex;g.h.post("/connection/delete",{ids:t}).then(function(e){p.setState({selectedList:[],pageIndex:1<t.length?1:n},function(){return p.getList()})})},p.getShowColumns=function(e){p.setState({selectMenuItem:e})},p.selPage=function(e){p.setState({pageIndex:e},function(){return p.getList()})},p.switchPageSize=function(e){p.setState({pageSize:e,pageIndex:1},function(){return p.getList()})},p.getList=function(){var e=p.refs.header.getParams(),t=p.state,n=t.projectId,a=t.keyWord,r=t.pageSize,o=t.pageIndex,i=t.sortType,c=t.sortName,l=t.sortUpdate,s=t.statusVals,u=t.selectedList,d=p.state.currPageSelectedList,e=e.filterModel;g.h.post("/connection/list",{projectId:n,pageSize:r,pageIndex:o,sortModel:{sortType:i,sortName:c,STATUS_TIME:l},name:[a],filterModel:f()({},e,{ucStatus:s})}).then(function(e){var r=e.data.result;p.setState({data:[]},function(){var e=r.from||(p.state.pageIndex-1)*p.state.pageSize+1,t=r.to||((t=p.state.pageIndex*p.state.pageSize)>r.count?r.count:t);d=[];for(var n=r.list,a=n.length-1;0<=a;a--)-1<u.indexOf(n[a].id)?(n[a].checked=!0,d.push(n[a].id)):n[a].checked=!1;p.setState({data:r.list,currPageSelectedList:d,start:e,end:t,total:r.count},function(){p.createTableColumns(),p.handleCheckboxStyle()})})})},p.refresh=function(e){e?p.setState({pageIndex:1},function(){return p.getList()}):p.getList(),b.t.set(b.V.connectionFilter,JSON.stringify(p.refs.header.getParams()))},p._handleBatchAdd=function(){var e=p.state,t=e.title,e=e.projectId;c.mW.push({pathname:"/account/project/connection/batchAdd",state:{title:t,projectId:e}})},p.createTableColumns=function(){var e=p.state,t=e.data,e=e.oriSelectMenuItem,e=[].concat(e),t=0<t.length&&t[0].configDetails.map(function(e,t){return{label:e.topicTypeValue,checked:!0,prop:e.topicTypeValue,render:function(e){return y().createElement("p",{className:"ellipse "+(e.configDetails[t]&&e.configDetails[t].topicArr&&0<e.configDetails[t].topicArr.length&&e.configDetails[t].topicArr.map(function(e){return e.name})[0].includes("空值")?"null_count":"")},e.configDetails[t]&&e.configDetails[t].topicArr&&0<e.configDetails[t].topicArr.length?e.configDetails[t].topicArr.map(function(e){return e.name}).join("，"):"")}}}),n=p.refs.SelectableColumns.competeSelectMenuItem();e.splice.apply(e,[2,0].concat(t)),e=n.length===e.length?e.filter(function(t){return n.find(function(e){return e.label===t.label})}):e,p.setState({selectMenuItem:e},function(){p.refs.SelectableColumns.resize()})},p.addConnection=function(){c.mW.push({pathname:"/account/project/connection/addLink",state:{id:p.state.projectId,projectName:p.state.projectName,type:"add",filterModel:p.refs.header.getParams()||{}}})},p._handleOnInutChange=function(e){p.inputTimeoutId&&clearTimeout(p.inputTimeoutId),p.inputTimeoutId=setTimeout(function(){p.setState({hasKey:""!==e},function(){!e&&p.state.keyWord&&p.setState({keyWord:"",pageIndex:1},function(){return p.getList()})})},500)},p._handleInputOnKeyUp=function(e){"Enter"===e.key&&p.setState({keyWord:e.target.value,pageIndex:1},function(){return p.getList()})},p._handleOnInputIconClick=function(){p.refs.searchInput.refs.input.value="",p.state.keyWord&&p.setState({keyWord:"",pageIndex:1},function(){return p.getList()})},p._handleKeywordAdd=function(e){p.refs.editDialog.updateVisibleState("keyword-add")},p.handleSort=function(e){var t="createdAt"===e.prop?"CREATED_AT":"sourceName"===e.prop?"SOURCE":"statusTime"===e.prop?"STATUS_TIME":e.prop.toUpperCase();p.setState({sortName:t,sortType:"ascending"===e.order?"ASC":"DESC",pageIndex:1},function(){return p.getList()})},p._handleQuickPick=function(){c.mW.push({pathname:"/account/project/connection/quickPick",state:{id:p.state.projectId,projectName:p.state.projectName}})},p._handleDeleteByGroup=function(){var e=p.state.selectedList;0<e.length?p.refs.deleDailog.updateVisibleState(e):h.Z.warning("请至少选择一条链接")},p.handleCheck=function(t){var e=p.state,n=e.currPageSelectedList,a=e.selectedList,e=t.length>n.length?"push":"splice",r="push"==e?t.filter(function(e){return!n.includes(e)}):n.filter(function(e){return!t.includes(e)});if("push"==e)for(var o=r.length-1;0<=o;o--)a.includes(r[o])||a.push(r[o]);else for(var i=r.length-1;0<=i;i--){var c=a.indexOf(r[i]);-1<c&&a.splice(c,1)}p.setState({selectedList:a,currPageSelectedList:t},function(){return p.handleCheckboxStyle()})},p.handleCheckboxStyle=function(){var e=p.state,t=e.currPageSelectedList,n=e.data,e=e.checkAllStatus;if(t.length===n.length&&0<n.length)e.checked=!0,n.forEach(function(e){e.checked=!0});else{0===t.length?(e.indeterminate=!1,n.forEach(function(e){return e.checked=!1})):e.indeterminate=!0,e.checked=!1;for(var a=n.length-1;0<=a;a--){for(var r=!1,o=t.length-1;0<=o;o--)if(t[o]===n[a].id){n[a].checked=r=!0;break}r||(n[a].checked=!1)}}p.setState({data:n,checkAllStatus:e})},p._handleOnStatusChange=function(e){p.setState({statusVals:e.map(function(e){return e.id})},function(){p.getList()})},p.state={title:"电商评论",projectId:b.t.get(b.V.backProjectConfig).id,projectName:b.t.get(b.V.backProjectConfig).name,sortType:"DESC",sortName:"CREATED_AT",sortUpdate:"DESC",data:[],statusVals:[],currPageSelectedList:[],selectedList:[],checkAllStatus:{checked:!1,indeterminate:!1},columns:[{label:"任务名称",prop:"name",fixed:"left",checked:!0,sortable:!0,minWidth:280,render:function(e){return-1!==e.url.indexOf("http")?y().createElement("a",{className:"control",href:e.url,target:"_blank"},p._getLinkName(e)):y().createElement("span",{className:"control"},p._getLinkName(e))}}],selectMenuItem:[],oriSelectMenuItem:[{label:"数据来源",prop:"sourceName",sortable:!0,width:100,checked:!0,render:function(e){return y().createElement("span",null,e.sourceName)}},{label:"任务类型",prop:"taskType",width:80,checked:!0,render:function(e){var t;return"COMMENT"===e.taskType?t="评论":"KEYWORD"===e.taskType?t="关键词":"PRICE"===e.taskType?t="价格":"QUESTION"===e.taskType&&(t="电商问答"),y().createElement("span",null,t)}},{label:"创建时间",prop:"createdAt",checked:!1,sortable:!0,width:100,render:function(e){return y().createElement("p",null,p.getNowFormatDate(e.createdAt))}},{label:"唯一标识",checked:!1,prop:"syncKey",width:150,render:function(e){return y().createElement("p",null,e.syncKey)}},{label:"数据量提取趋势图",checked:!0,width:120,render:function(e,t,n){var a=e.dataList,a=a?a.map(function(e){return e.count}):[];return y().createElement("div",{className:"trend-graphy",style:{width:120,height:"22px",position:"relative"}},y().createElement(d.Z,{key:e.userConnectionId,ref:"data_trend"+n,data:a}),y().createElement("div",{onClick:function(){return p.toDataPage(e.id,e.name,e.syncKey,e.sourceId)},style:{position:"absolute",width:"100%",height:"100%",top:0,cursor:"pointer"}}))}},{label:"链接状态",checked:!0,width:80,prop:"status",render:function(e){var t="";return"ON_SALE"===e.status?t="在售":"OFF_SALE"===e.status&&(t="下架"),t}},{label:"状态更改时间",checked:!0,sortable:!0,width:160,prop:"statusTime",render:function(e){return F()(e.statusTime).format("YYYY-MM-DD HH:mm:ss")}},{label:"操作",prop:"operate",width:120,fixed:"right",checked:!0,render:function(e){return y().createElement("div",{className:"operations"},i.Z.hasAuthority("PROJECT_EDIT")&&y().createElement("span",{type:"text",className:"operation_columns",onClick:function(){return p.refs.editDialog.updateVisibleState("connection-edit",e)}},"编辑"),i.Z.hasAuthority("PROJECT_DELETE")&&y().createElement("span",{type:"text",className:"operation_columns",onClick:function(){return p.refs.deleDailog.updateVisibleState([e.id])}},"删除"))}}],handle:[],form:{name:"",projectId:""},start:0,end:0,total:0,keyWord:"",hasKey:!1,pageSize:20,pageIndex:1,taskType:[],spuList:[],skuList:[]},p}o()(e,t);var n=e.prototype;return n.componentDidMount=function(){var n=this,e=this.state.projectId;g.h.post("/subproject-connection/group/list",{projectId:e}).then(function(e){var t=e.data.result,e=t.spuList,t=t.skuList;n.setState({spuList:e,skuList:t})})},n.toDataPage=function(e,t,n,a){var r=this.state.projectId;window.open("/tab/connectionData?"+encodeURIComponent(JSON.stringify({id:e,name:t,syncKey:n,projectId:r,sourceId:a})))},n.getNowFormatDate=function(e){var t=new Date(e),n=t.getFullYear(),e=t.getMonth()+1,t=t.getDate();return n+"-"+(e=1<=e&&e<=9?"0"+e:e)+"-"+(t=0<=t&&t<=9?"0"+t:t)},n.render=function(){var t=this,e=this.state,n=e.projectId,a=e.data,r=e.columns,o=e.start,i=e.end,c=e.total,l=e.selectMenuItem,s=e.title,u=e.hasKey,d=e.currPageSelectedList,p=e.checkAllStatus,m=e.statusVals,f=e.spuList,h=e.skuList,g=JSON.parse(JSON.stringify(d)),e=r.concat(this.selColumns);e.splice(0,0,{label:"",fixed:"left",width:56,renderHeader:function(e){return y().createElement(v.Fragment,null,y().createElement(j,{type:"checkAll",defaultChecked:p.checked,indeterminate:p.indeterminate,onChange:t.handleCheck,selectedList:g,totalList:a.map(function(e){return e.id})}),y().createElement("span",{style:{marginLeft:"5px"}},"当页"))},render:function(e){return y().createElement(j,{type:"checkOne",defaultChecked:e.checked||!1,onChange:t.handleCheck,selectedList:g,totalList:a,uniqueId:e.id})}});r=document.documentElement.clientHeight-46-78-24;return y().createElement("div",{className:"project-connect"},y().createElement(k.Z,{title:(0,C.u)({title:s})}),y().createElement("div",{className:"project-connect-content"},y().createElement("div",{style:{minHeight:r,background:"#fff"}},y().createElement("div",{className:"operator-panel"},y().createElement("div",{className:"search-input"},y().createElement("i",{className:"icon-cem_search icon-style"}),y().createElement(S.Input,{ref:"searchInput",placeholder:"请输入内容",onKeyPress:this._handleInputOnKeyUp,icon:u?"circle-cross":"",onIconClick:this._handleOnInputIconClick,onChange:this._handleOnInutChange})),y().createElement("div",{className:"button-zone"},y().createElement(S.Button,{type:"default",onClick:this._handleDeleteByGroup},"批量删除"),y().createElement(S.Button,{type:"default",onClick:this._handleQuickPick},"快速采集Sku链接"),y().createElement(S.Button,{type:"default",onClick:this._handleBatchAdd},"批量上传链接任务"),y().createElement(S.Button,{type:"primary",onClick:this.addConnection},"新增链接任务"))),y().createElement(N,{className:"mheader",ref:"header",filter:{show:!0,type:"filter",save:!0,projectId:n,filter:["connConfig","source","taskTypes"],selectConfig:b.t.get(b.V.connectionFilter)&&JSON.parse(b.t.get(b.V.connectionFilter)).filterModel?JSON.parse(b.t.get(b.V.connectionFilter)).filterModel:{},showAllConfig:!0,extraConfig:[{id:"ucStatus",list:[{id:"ON_SALE",name:"在售"},{id:"OFF_SALE",name:"下架"}],name:"链接状态",values:m}],onExtraChange:{ucStatus:this._handleOnStatusChange}},confirm:function(){return t.refresh(1)}}),y().createElement("div",{className:"divider"},y().createElement("div",null)),y().createElement("div",{className:"table-zone"},y().createElement(I.Z,{ref:"SelectableColumns",multiSave:{name:"connection_list"},columns:l,getShowColumns:this.getShowColumns}),y().createElement(E.Z,{className:"connection-table",columns:e,data:a||[],total:c,start:o,end:i,pageSize:this.state.pageSize,currentPage:this.state.pageIndex,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,onPage:this.selPage,onSortChange:this.handleSort,rowClassName:function(e){return d.includes(e.id)?"item-active":""},notLimit:!0})))),y().createElement(_,{ref:"deleDailog",title:"删除任务提示",body:"删除该任务后，该任务提取到的数据不会保留在项目中",onConfirm:this._handleDeleteConfirm,onCancel:function(e,t){}}),y().createElement(R,{ref:"editDialog",onConfirm:this.refresh,onCancel:function(e){},projectId:n,spuList:f,skuList:h}))},r()(e,[{key:"selColumns",get:function(){return this.state.selectMenuItem.filter(function(e){return e.checked})}}]),e}(v.Component)},1486:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});var a=n(35239),r=function(e){var t=e.title,e=e.url;return[{title:"所有项目",url:"/account/project"},{title:a.t.get(a.V.backProjectConfig).name,url:"/account/project/preview"},{title:t,url:e}]}},17190:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var t=n(67154),a=n.n(t),t=n(85354),r=n.n(t),t=n(67294),C=n.n(t),i=void 0;const b=function(e){var t=e.data.name,n=e.onCheck,a=e.checked,e=C().useState(a),r=e[0],o=e[1];return C().useEffect(function(){o(a)},[a]),C().createElement("label",{className:"el-checkbox yt_product_subscribe_editable-radio",onClick:function(e){i=setTimeout(function(){i&&clearTimeout(i);var e=!r;o(e),n(e)},100)}},C().createElement("input",{value:t,className:"ec-label "+(r?"is_checked":""),title:t,maxLength:6,style:{background:"transparent"}}))};var c=n(92360),l=void 0;const N=function(e){var t=e.keyword,n=e.onCloseClick,a=e.onChange,r=C().useState(t),e=r[0],o=r[1];return C().useEffect(function(){o(t)},[t]),C().createElement(c.Input,{placeholder:"请输入关键字",value:e,icon:e&&"close",onIconClick:function(){o(""),n()},onChange:function(e){o(e),l&&clearTimeout(l),l=setTimeout(function(){a(e),l=void 0},500)}})};const o=function(e){var t=e.className,n=e.onTipClick,a=e.show,r=e.onClick,o=e.onMouseEnter,i=e.onMouseLeave,c=e.addText,l=e.data,s=e.value,u=e.trigger,d=e.defaultValue,p=e.onTagChange,m=e.getTagListRef,f=e.onAddClick,h=e.disabled,g=e.keyword,v=s&&l.find(function(e){return e.id===s})?l.find(function(e){return e.id===s}).name:d&&l&&l.some(function(e){return e.id===d})?l&&l.find(function(e){return e.id===d}).name:l&&l.length?"请选择":"请添加",y=C().useState(g||""),S=y[0],E=y[1],e=C().useState(l),y=e[0],k=e[1];return C().useEffect(function(){k(l)},[l]),C().useEffect(function(){var e=S?l.filter(function(e){return 0<=e.name.toLowerCase().indexOf(S.toLowerCase())}):l;k(e)},[S,l]),C().useEffect(function(){g&&E(g)},[g]),C().createElement("div",{className:"yt_product_setting_edit_input_select_wraper "+t,onClick:"click"===u&&n,onMouseEnter:"hover"===u&&n,onMouseLeave:function(){"hover"===u&&(i(),S&&E(""))}},C().createElement("div",null,C().createElement("div",{className:"ets-trigger",onClick:function(){"click"===u&&(r(),S&&E(""))},onMouseEnter:function(){"hover"===u&&(a||o())}},C().createElement("span",{className:"ets-trigger-title",style:{color:s||!l||l.find(function(e){return e.id===s})||d?"#262626":"#bfbfbf"}},v),C().createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:a?"rotate(-180deg)":""}})),C().createElement("div",{className:"ets-option-panel "+(a?"ets-show":""),onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},C().createElement("div",{className:"ets-list",ref:m},l&&0<l.length?C().createElement(C().Fragment,null,C().createElement("div",{style:{maxHeight:260}},C().createElement("div",{className:"ets-search"},C().createElement(N,{keyword:S,onChange:E,onCloseClick:function(){return E("")}})),C().createElement("div",{className:"ets-list-content"},y&&0<y.length?C().createElement(C().Fragment,null,y.slice(0,100).map(function(e){return C().createElement(b,{key:e.id,data:e,checked:s===e.id,onCheck:function(){return e.id?p({id:e.id,name:e.name,split:e.split}):p({name:e.name,split:e.split})}})}),99<y.length&&C().createElement("div",{style:{color:"#d96969",paddingLeft:"18px",fontSize:"12px"}},"— 查看更多请搜索")):C().createElement("div",{className:"no_data"},"暂无数据")))):C().createElement("div",{className:"no_data"},"暂无数据")),C().createElement("div",{className:"ets-add"},C().createElement("div",{className:"ets-add-diviver"}),C().createElement("div",{className:"add_btn "+(h?"add_disabled_btn":""),onClick:function(){h||(f(),S&&E(""),("click"===u?r:o)())}},c)))))},s=function(t){function e(e){var n=t.call(this,e)||this;return n._handleOnTagChange=function(e){n.props.onChange(e),n._setPadShowFalse()},n._setPadShowFalse=function(){n.state.show&&n.setState({show:!1})},n._setPadShowTrue=function(){n.state.show||n.setState({show:!0})},n._handleOnMouseEnter=function(){var e=n.state.show;setTimeout(function(){n.setState({show:!e})},0)},n._handleOnClick=function(e){var t=n.state.show;setTimeout(function(){n.setState({show:!t})},0)},n.tagListRef=void 0,n.state={show:!1},n.event={onClick:n._handleOnClick,onMouseEnter:n._handleOnMouseEnter,onMouseLeave:n._setPadShowFalse,onTagChange:n._handleOnTagChange,getTagListRef:function(e){return n.tagListRef=e}},n}r()(e,t);var n=e.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){e.show!==this.props.show&&this._setPadShowTrue()},n.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},n.componentWillUnmount=function(){window.addEventListener("click",this._setPadShowFalse)},n.render=function(){return C().createElement(o,a()({},this.props,this.state,this.event))},e}(C().PureComponent)},68003:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var t=n(85354),a=n.n(t),t=n(67294),o=n.n(t),i=n(78436),r=function(r){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=r.call.apply(r,[this].concat(t))||this).buildChart=function(){var e=n.props.data;e&&e.length||(e=[]);var t=[];e.forEach(function(e){t.length&&t[t.length-1]===e||t.push(e)}),1===t.length?t.push(t[0]):0===t.length&&(t=[1,1]);e=t.map(function(e,t){return[t+"",e+""]}),e={animation:!1,color:["#0747A6"],grid:{left:5,right:5,bottom:0,top:0,containLabel:!1},xAxis:[{show:!1,type:"category",data:e.map(function(e){return e[0]})}],yAxis:[{show:!1,type:"category",data:t.sort(function(e,t){return e-t}).map(function(e){return e+""})}],series:[{name:"",type:"line",step:"middle",data:e}]};n.refs.chart.setOption(e)},n}a()(e,r);var t=e.prototype;return t.componentDidMount=function(){this.width=this.refs.widget.offsetWidth,this.height=this.refs.widget.offsetHeight,this.buildChart()},t.shouldComponentUpdate=function(e,t){return JSON.stringify(e)!==JSON.stringify(this.props)},t.componentDidUpdate=function(){this.buildChart()},t.render=function(){var e=this.props.data;return o().createElement("div",{ref:"widget",className:"widget-container widget-container-wrap"},o().createElement("div",{className:"widget-body "+(e&&e.length?"middle_line":"line")},o().createElement(i.Z,{ref:"chart",className:"widget-chart"})))},e}(t.Component)},84267:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var t=n(67154),a=n.n(t),t=n(85354),r=n.n(t),t=n(67294),i=n.n(t),o=n(85151),c=n(35239),l=function(t){function e(e){var o=t.call(this,e)||this;return o.openMenu=function(){o.setState({menuState:!o.state.menuState})},o.onChange=function(e){var t,n=o.props,a=n.columns,r=n.getShowColumns,n=n.multiSave;a&&a[e]&&((t=a.slice(0))[e].checked=!t[e].checked);e=n?n.name:"",n=c.t.get(c.V.storageColumns)?c.t.get(c.V.storageColumns):{};n[e]=t,c.t.set(c.V.storageColumns,n),r&&r(t),o.resize(),o.setState({columns:t})},o.competeSelectMenuItem=function(e){var t,n=o.props.multiSave,a=n?n.name:"",r=o.props.columns,n=c.t.get(c.V.storageColumns)?c.t.get(c.V.storageColumns)[a]:[];return r=n&&0!==n.length?("price_check"===a?n.map(function(a,e){return a.render=0<r.filter(function(e){return e.label===a.label}).length?r.filter(function(e){return e.label===a.label})[0].render:function(e,t,n){return i().createElement("span",null,e[a.prop])}}):n.map(function(e,a){return e.render=function(e,t,n){return i().createElement("span",null,e.configDetails[a]&&e.configDetails[a].topicValue)}}),n.slice(0)):e&&e.every(function(e){return e.label&&e.prop})?e:(t=[],e&&e.forEach(function(e,a){t.push({label:e.topicTypeValue,checked:!1,render:function(e,t,n){return i().createElement("span",null,e.configDetails[a].topicValue)}})}),t.slice(0)),o.setState({columns:r}),r},o.resize=function(){var e=document.querySelector(".connection-table .is-sortable");if(e){var t=o.getStyle(e,"width"),e=document.body.offsetWidth,n=o.state.columns;if(800<e&&2<n.length&&parseInt(t)<275)for(var a=0;a<n.length-2;a++)if(n[a].checked)return void o.onChange(a)}},o.close=function(e){o.state.menuState&&o.setState({menuState:!1})},o.state={menuState:!1,multiSave:null,columns:e.columns.map(function(e){return e.checked||(e.checked=!1),e})},o}r()(e,t);var n=e.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){this.setState(a()({},e))},n.getStyle=function(e,t){return e.style[t]||(e.currentStyle||getComputedStyle(e,null))[t]},n.componentDidMount=function(){window.addEventListener("click",this.close),window.addEventListener("resize",this.resize,!1)},n.componentWillUnmount=function(){window.removeEventListener("resize",this.resize,!1),window.removeEventListener("click",this.close)},n.render=function(){var n=this,e=this.state.columns;return i().createElement("div",{className:"menu-wrapper",onClick:function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()}},i().createElement("span",{className:"el-dropdown-link "+(this.state.menuState?"sel":""),onClick:this.openMenu},"列",i().createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:this.state.menuState?"rotate(-180deg)":""}})),this.state.menuState&&i().createElement("div",{className:"menuList"},i().createElement("ul",null,0===e.length?i().createElement("li",{style:{color:"#8c8c8c"}},"无可选择内容"):e.map(function(e,t){return i().createElement("li",{key:t},i().createElement(o.Jg,{key:t,value:e.label,checked:e.checked,onChange:n.onChange.bind(n,t),block:!0},e.label))}))))},e}(t.Component)},91438:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var a=n(67154),d=n.n(a),t=n(85354),r=n.n(t),a=n(67294),p=n.n(a),m=n(91751),t=n(82784),f=n.n(t),t=n(30381),u=n.n(t),h=n(5133);const g={setStorage:function(e,t){localStorage.setItem(e||"cem-msg",JSON.stringify(t))},getStorage:function(e){e=JSON.parse(localStorage.getItem(e||"cem-time-msg"))||{};return Object.keys(e).length<=0&&(e.value=[u()().subtract(90,"days").format("YYYY-MM-DD"),u()().startOf("day").format("YYYY-MM-DD")],e.groupBy="MONTH",e.current=9),e}};var t=n(94184),v=n.n(t);n(83839),n(22243);u().locale("zh-cn");function y(e){return e?e.format(S):""}function o(e){switch(e){case 0:return[u()().subtract(1,"days"),u()().subtract(1,"days")];case 1:return[u()().subtract(1,"weeks").startOf("week"),u()().subtract(1,"weeks").endOf("week")];case 2:return[u()().startOf("day"),u()()];case 3:return[u()().startOf("week"),u()()];case 4:return[u()().subtract(6,"days"),u()().startOf("day")];case 5:return[u()().subtract(1,"months").startOf("month"),u()().subtract(1,"months").endOf("month")];case 6:return[u()().subtract(29,"days"),u()().startOf("day")];case 7:return[u()().startOf("month"),u()()];case 8:default:return[u()().subtract(89,"days"),u()().startOf("day")]}}var S="YYYY-MM-DD",E={"昨天":0,"上周":1,"今天":2,"本周":3,"近7天":4,"上月":5,"近30天":6,"本月":7,"近90天":8,"自定义":9},k={"时":"HOUR","天":"DAY","周":"WEEK","月":"MONTH"},i=function(a){function e(){for(var s,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(s=a.call.apply(a,[this].concat(t))||this).state={showLeft:!0,value:[u()(y(o(s.props.current)[0])),u()(y(o(s.props.current)[1]))],currentType:0==s.props.current?0:s.props.current||9,currentGroup:s.props.groupBy||"DAY",hoverValue:[],inputVal:[]},s.handleToggle=function(e){s.setState({showLeft:!s.state.showLeft})},s.onStandaloneSelect=function(e,t){var a=s.state.value;a[e]=t,a[1].diff(a[0],"days")<0||(s.setState({value:a,inputVal:[y(a[0]),y(a[1])]}),t=s.fixedGroup(a),s.setState({currentGroup:t,currentType:E["自定义"]}),Object.keys(E).map(function(e,t){var n=o(E[e]);y(a[0])===y(n[0])&&y(a[1])===y(n[1])&&s.setState({currentType:E[e]})}))},s.onStartChange=function(e){s.onStandaloneSelect(0,e)},s.onEndChange=function(e){s.onStandaloneSelect(1,e)},s.setDateGroup=function(e){s.setState({currentGroup:e})},s.disabledStartDate=function(e){var t=s.state.value[1];return!(!e||!t)&&t.diff(e,"days")<0},s.disabledEndDate=function(e){var t=s.state.value[0];return!(!e||!t)&&e.diff(t,"days")<0},s.fixedGroup=function(e){e=u().duration(e[1]-e[0]).asDays();switch(!0){case e<=1:return"HOUR";case e<30:return"DAY";case 30<=e:return"MONTH";default:return"HOUR"}},s.setQuickTime=function(e,t){var n;9!==e?(n=o(e),s.setState({value:n,currentType:e,currentGroup:s.fixedGroup(n)},function(e){t&&t()})):s.setState({currentType:e,inputVal:[y(s.state.value[0]),y(s.state.value[1])]})},s.inputStart=function(e){var t=s.state.inputVal;t[0]=e.currentTarget.value,s.setState({inputVal:t})},s.inputEnd=function(e){var t=s.state.inputVal;t[1]=e.currentTarget.value,s.setState({inputVal:t})},s.apply=function(e,t){s.props.onceShow&&g.setStorage("cem-time-"+s.props.onceShow,"");var n=s.state,a=n.value,r=n.inputVal,o=n.currentType,i=n.currentGroup,c=s.props,l=c.timeConfirm,n=(c.style,c.handlePanel);if(9===o){c=u()(r[0]),r=u()(r[1]);if(!c.isValid()||!r.isValid())return void h.Z.error("非法输入");if(r.diff(c,"days")<0)return void h.Z.error("非法输入");s.setState({value:[c,r]},function(e){return l([y(s.state.value[0]),y(s.state.value[1])],i,o)})}else l([y(a[0]),y(a[1])],i,o);t||n(e)},s}return r()(e,a),e.prototype.render=function(){var n=this,e=this.state,t=e.showLeft,a=e.inputVal,r=e.value,o=e.currentType,i=e.currentGroup,c=this.props,l=c.style,s=c.group,u=c.onClick,e=v()("filter-date-input-from","fake-textarea",{disabled:9!==o}),c=[];return!a||a.length<2?(c.push(y(r[0])),c.push(y(r[1]))):(c.push(a[0]),c.push(a[1])),p().createElement("div",{className:"time-setting-panel",onClick:u,style:d()({width:t?"772px":"260px"},l)},p().createElement("div",{className:"left-panel",style:{display:t?"inline-block":"none"}},p().createElement(m.Z,{format:S,locale:f(),showDateInput:!1,showOk:!1,value:r[0],disabledDate:this.disabledStartDate,onChange:this.onStartChange}),p().createElement(m.Z,{format:S,showDateInput:!1,locale:f(),showOk:!1,value:r[1],disabledDate:this.disabledEndDate,onChange:this.onEndChange}),s&&p().createElement("div",{className:"date-group"},"时间分组：",Object.keys(k).map(function(t,e){return p().createElement("li",{key:e,className:k[t]===i?"quick-btn active":"quick-btn",onClick:function(e){return n.setDateGroup(k[t])}},p().createElement("span",null,t))}))),p().createElement("div",{className:"quick-setting-panel"},p().createElement("ul",null,Object.keys(E).map(function(t,e){return p().createElement("li",{key:e,className:e===o?"quick-btn active":"quick-btn",onClick:function(e){return n.setQuickTime(E[t])}},p().createElement("span",null,t))})),p().createElement("div",{className:"left-panel-toggle quick-btn",onClick:this.handleToggle},p().createElement("span",null,t?"← 收起":"→ 展开")),9===o?p().createElement("div",{className:"filter-date-input"},p().createElement("input",{className:e,value:c[0],onChange:this.inputStart}),p().createElement("div",{className:"device"},"-"),p().createElement("input",{className:e,value:c[1],onChange:this.inputEnd})):p().createElement("div",{className:"filter-date-input"},p().createElement("input",{className:e,readOnly:!0,value:y(r[0])}),p().createElement("div",{className:"device"},"-"),p().createElement("input",{className:e,readOnly:!0,value:y(r[1])})),p().createElement("div",{className:"apply-btn",onClick:function(e){return n.apply(e)}},"应用")))},e}(a.Component),c=function(t){function e(e){var a=t.call(this,e)||this;a.state={show:!1,value:["2018-01-01","2018-08-01"],current:9,groupBy:"MONTH"},a.handlePanel=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),a.setState({show:!a.state.show})},a.stopPop=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},a.timeConfirm=function(e,t,n){a.setState({value:e,groupBy:t,current:n},function(){g.setStorage("cem-time-"+a.props.model,a.state),a.props.confirm&&a.props.confirm()})},a.state=g.getStorage("cem-time-"+(a.props.onceShow||a.props.model))||{},a.state.value=a.state.value||a.state.dateRange;e=a.state.current;return e<9&&(e=o(e),a.state.value=[y(e[0]),y(e[1])]),a.state=Object.assign({show:!1,value:["2018-01-01","2018-08-01"],current:9,groupBy:"MONTH"},a.state),a}r()(e,t);var n=e.prototype;return n.componentDidMount=function(){var e=this;this.oneHandler=function(){e.setState({show:!1})},document.addEventListener("click",this.oneHandler)},n.componentWillUnmount=function(){document.removeEventListener("click",this.oneHandler)},n.getParams=function(){var e=this.state,t=e.value,e=e.groupBy;return{from:t[0],to:t[1],dateGroupType:e,remoteName:"cTime"}},n.render=function(){var a=this,e=this.props.group,t=this.state,n=t.value,r=t.current,t=t.groupBy;return p().createElement("div",{className:"date-wrap"},p().createElement("div",null,p().createElement("div",{className:"date-filter filter-box",onClick:function(e){return a.handlePanel(e)}},p().createElement("div",null,p().createElement("span",null,n[0].replace(/-/g,"/"))," -",p().createElement("span",null,n[1].replace(/-/g,"/"))),9!==this.state.current&&p().createElement("div",{className:"date-day-info"},Object.keys(E).filter(function(e){return E[e]===a.state.current})[0]),p().createElement("i",{className:"icon-cem_time-controller"})),p().createElement(i,{ref:"picker",timeConfirm:function(e,t,n){return a.timeConfirm(e,t,n)},value:n,handlePanel:function(e){return a.handlePanel(e)},onClick:this.stopPop,current:r,groupBy:t,group:e,style:{display:this.state.show?"block":"none"}})))},e}(a.Component)}}]);