(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[6083],{86083:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var a=n(85354),i=n.n(a),t=n(67154),c=n.n(t),a=n(37316),o=n.n(a),t=n(67294),s=n.n(t),r=n(5133),l=n(29383),p=n(55815),u=n(13713),d=n(61193),m=n(88308),h=n(61409),f=n(35239),a=n(55609),g=n(92360),E=n(5747),v=n(36144),b=n(64396).Z.public.menu,N=[{icon:"icon-cem_data-task",name:"数据链接",id:"userConnectionTotal",route:d.Z.hasAuthority("COMMENT")?d.Z.hasAuthority("CONNECTION_SMART_COMMENT")?"/account/project/comment/subscribe":"/account/project/comment/link":d.Z.hasAuthority("CONNECTION_SMART_COMMENT")?"/account/project/price/subscribe":"/account/project/price/link"},{icon:"icon-cem_theme-management",name:"主题",id:"topicTotal",route:"/account/project/linkTopic"},{icon:"icon-cem_label-management",name:"标签",id:"tagTotal",route:"/account/project/tag"},{icon:"icon-cem_private-information",name:"消息处理规则",id:"messageRuleTotal",route:"/account/project/messageRule"},{icon:"icon-cem_invalid-message",name:"无效消息",id:"garbageRuleTotal",route:"/account/project/uselessMsg/smart"},{icon:"icon-cem_invalid-words",name:"无效词管理",id:"garbageWordTotal",route:"/account/project/uselessWord"},{icon:"icon-cem_index-system",name:"指标体系",id:"overallAspectTotal",route:"/account/project/aspectSystem/global"},{icon:"icon-cem_words-list",name:"预警管理",id:"aspectWarningTotal",route:"/account/project/alert"},{icon:"icon-shujufankui",name:"数据反馈",id:"dataFeedbackTotal",route:"/account/project/dataFeedback"}],t=function(t){function e(e){var i=t.call(this,e)||this;return i.fetchList=function(){v.h.post("/projects/overview/find",{id:i.state.id}).then(function(e){var t=e.data.result,e=i.state.data.map(function(e){return e.count=t[e.id],e});i.setState({data:e})})},i.startSideCrop=function(e){var t=e.target,e=new FileReader;e.readAsDataURL(t.files[0]),e.onload=function(e){e=e.target.result;i.setState({uploadPic:e,cropShow:!0})}},i.sideCropConfirm=function(a){i.setState({sideCropLoading:!0},function(e){var t=window.location.hostname+"/-128_45.png",n=new FormData;n.append("base64Code",a),n.append("fileName",t);t={base64Code:a,fileName:t,type:"PROJECT_LOGO",projectId:f.t.get(f.V.curProject).id||""},t=JSON.stringify(t);v.v.post("upload/head",t,{headers:{"Content-Type":"application/json"}}).then(function(e){var t=document.querySelector(".project-avatar img"),n=e.data.result+"?_="+(new Date).getTime();t.setAttribute("src",n),r.Z.success(e.data.msg),i.props.changePictureURLDispatch(),i.setState({cropShow:!1,uploadPic:""})})})},i.state={id:f.t.get(f.V.backProjectConfig).id,name:f.t.get(f.V.backProjectConfig).name,data:d.Z.hasAuthority("ASPECT_TREE_SETTING")?N:N.filter(function(e){return"overallAspectTotal"!==e.id}),columns:[{prop:"topic",width:400,renderHeader:function(){return s().createElement("span",{style:{paddingLeft:"74px"}},"名称")},render:function(t,e,n){return s().createElement("div",{className:"tableLink",key:t.id},s().createElement("i",{className:t.icon}),s().createElement("span",{onClick:function(e){"/account/project/comment/subscribe"===t.route&&f.t.set(f.V.leaveRouter,i.props.location||"","session"),h.mW.push({pathname:t.route,state:{titles:[{title:"所有项目",url:"/account/project"}]}})}},t.name))}},{label:"数量",prop:"count"}],cropShow:!1,uploadPic:"",cropLoading:!1},i}i()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.fetchList()},n.UNSAFE_componentWillReceiveProps=function(){var t=this;f.t.get(f.V.backProjectConfig).id!==this.state.id&&this.setState({id:f.t.get(f.V.backProjectConfig).id},function(e){return t.fetchList()})},n.closeInput=function(t){var n=this,e=this.state.id;v.h.post("/projects/update",{id:e,name:t}).then(function(e){r.Z.success("修改成功"),f.t.set(f.V.backProjectConfig,{id:f.t.get(f.V.backProjectConfig).id,name:t}),n.props.fetchMenuList(),n.setState({name:t})})},n.handleBack=function(){h.mW.push("/account/project")},n.render=function(){var t=this,e=this.state,n=e.name,a=e.columns,i=e.data,c=e.uploadPic,o=e.cropShow,r=e.cropLoading,e=document.documentElement.clientHeight-46-78-24;return s().createElement("div",{className:"flex-col preview"},s().createElement("div",{className:"flex-other"},s().createElement(p.Z,{title:(0,u.u)({title:"项目概况"})}),s().createElement("div",{className:"common-pad-24"},s().createElement("div",{style:{minHeight:e,backgroundColor:"#fff"}},s().createElement("div",{className:"project-intro"},s().createElement("span",{className:"info-name"},"项目名称"),s().createElement(m.Z,{id:"editProject",value:n,name:"项目名称",confirm:function(e){return t.closeInput(e)}})),s().createElement("div",{className:"upload-project-logo"},s().createElement(g.Button,{type:"primary",plain:!0,className:"btn-upload-logo"},s().createElement("label",{className:"upload-btn",htmlFor:"project-logo"},s().createElement("i",{className:"icon-shangchuan"})," 上传Logo"),s().createElement("input",{type:"file",hidden:!0,id:"project-logo",accept:"images/png",onChange:this.startSideCrop})),o&&s().createElement(E.Z,{src:c,title:"上传自定义项目Logo",loading:r,tip:"文件小于1M，建议为正方形",confirm:this.sideCropConfirm.bind(this),cancel:function(e){t.setState({cropShow:!1})},borderRadius:!0})),s().createElement(l.Z,{className:"topic-table",columns:a,data:i,start:1,end:i.length,total:i.length})))))},e}(t.Component);const y=(0,a.connect)(function(e){e.loading;e=o()(e,["loading"]);return c()({},e[b])},function(t){return{fetchMenuList:function(e){return t({type:b+"/fetchMenuList",payload:e})},changePictureURLDispatch:function(e){return t({type:b+"/changePictureURLDispatch",payload:e})}}})(t)},13713:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var a=n(35239),i=function(e){var t=e.title,e=e.url;return[{title:"所有项目",url:"/account/project"},{title:a.t.get(a.V.backProjectConfig).name,url:"/account/project/preview"},{title:t,url:e}]}},5747:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(85354),c=n.n(a),i=n(67294),f=n.n(i),t=n(45697),a=n.n(t),t=n(94184),g=n.n(t),E=n(55761),v=n(92360),o=n(5133),r=function(i){function e(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=i.call.apply(i,[this].concat(n))||this).state={src:e.props.src,preCropPic:"",once:!0,fileName:e.props.fileName},e}c()(e,i);var t=e.prototype;return t.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({uploadPic:e.uploadPic},function(e){})},t._crop=function(){var e=this.props.refName,e=this.refs[e].getCroppedCanvas().toDataURL();this.setState({preCropPic:e})},t.profilePicUpload=function(e){var t=this.props.reUpload,n=this,a=e.target.files[0];if(1024<a.size/1024)return o.Z.error("文件不能大于1M"),!1;e=new FileReader;e.readAsDataURL(a),e.onload=function(e){n.setState({src:e.target.result,fileName:a.name}),t&&t(e.target.result)}},t.render=function(){var e=this.state,t=e.src,n=e.preCropPic,a=this.props,i=a.title,c=a.tip,o=a.style,r=a.className,s=a.loading,l=a.refName,p=a.aspectRatio,u=a.accept,d=a.confirm,m=a.cancel,e=a.borderRadius,h=this.state.fileName,a="cropper-pic-wrap";r&&(a=g()("cropper-pic-wrap",r));r=g()("pre-pic",{"border-radius":e}),e=1;return p&&"[object Number]"===Object.prototype.toString.call(e)&&(e=p),f().createElement("div",{className:a},f().createElement("div",{className:"crop-wrap"},f().createElement(v.Loading,{loading:s},f().createElement("div",{className:"crop-title"},f().createElement("span",null,i),f().createElement("i",{className:"icon-cem_cancel",onClick:function(){return m(n)}})),f().createElement("div",{className:"crop-cont"},f().createElement(E.Z,{ref:l,src:t,style:o,aspectRatio:e,guides:!1,crop:this._crop.bind(this)}),f().createElement("div",{className:"option-cont"},f().createElement("div",{className:"pre-cont"},f().createElement("img",{className:r,src:n})),f().createElement("div",{className:"pre-tip"},"预览"),f().createElement("div",{className:"reupload-cont"},f().createElement(v.Button,{type:"primary",onClick:function(){return document.getElementById("reupload").click()}},"重新上传"),f().createElement("input",{type:"file",id:"reupload",hidden:!0,accept:u,onChange:this.profilePicUpload.bind(this)})))),f().createElement("p",{className:"crop-tip"},c),f().createElement("div",{className:"crop-option"},f().createElement(v.Button,{onClick:function(){m(n)}},"取消"),f().createElement(v.Button,{type:"primary",onClick:function(){d(n,h)}},"确定")))),f().createElement("div",{className:"crop-bg"}))},e}(i.Component);r.propTypes={show:a().bool,title:a().string,tip:a().string,src:a().string,refName:a().string,accept:a().string,confirm:a().func,cancel:a().func,reUpload:a().func,borderRadius:a().bool,loading:a().bool,fileName:a().string},r.defaultProps={show:!1,src:"",title:"上传图片",accept:"images/png",tip:"仅支持png格式，文件小于1M",refName:"cropper"+(new Date).getTime(),style:{height:263,width:263},borderRadius:!1,loading:!1,fileName:""}},88308:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(85354),i=n.n(a),c=n(67294),l=n.n(c),t=n(45697),a=n.n(t),p=n(5133),u=n(43036),t=n(94184),d=n.n(t),t={value:a().string,id:a().any.isRequired,enter:a().bool,blurFun:a().func,name:a().string,empty:a().bool,placeholder:a().string,type:a().string,confirmNoChange:a().func},a={value:"",enter:!0,name:"名称",empty:!1,placeholder:"",cancel:function(e,t){console.log("取消")},confirm:function(e,t){console.log("确定后的value:"+e)},type:"normal"},c=function(n){function e(e){var t=n.call(this,e)||this;t.enter=function(e){t.props.enter&&13===e.keyCode&&t.confirmEdit()};e=t.props.value;return t.state={isEdit:!1,curValue:e||"",lastVal:e||"",hover:!1,canEdit:!1},t}i()(e,n);var t=e.prototype;return t.UNSAFE_componentWillReceiveProps=function(e){var t=this;e.value!==this.state.lastVal&&e.value&&this.setState({curValue:e.value,lastVal:e.value}),!0!==e.canEdit||this.state.canEdit||this.setState({canEdit:!0},function(e){t.toEdit()})},t.componentDidMount=function(){var a=this;document.body.addEventListener("click",function(e){var t=e.target||window.event.srcElement,n=a.props.className,e="edit-input-wrap";!function(e,t){for(var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e&&!n.call(e,t);)e=e.parentElement;return e}(t,"."+(e=n?n.split(" ")[0]:e))&&a.cancelEdit()})},t.changeName=function(){var e=this.props.id,e=document.getElementById(e).value;this.setState({curValue:e})},t.toEdit=function(){var e=this.state,t=e.isEdit,n=(e.canEdit,this.props.id);t||this.setState({isEdit:!0,hover:!0},function(e){var t=document.getElementById(n);setTimeout(function(){t.focus()})})},t.checkEdit=function(){"normal"===this.props.type&&this.toEdit()},t.cancelEdit=function(){var e=this.state,t=e.curValue,n=e.lastVal,a=e.isEdit,e=e.canEdit,i=this.props.cancel;a&&(e&&this.setState({canEdit:!1}),this.setState({isEdit:!1,hover:!1,curValue:n},function(e){i&&i(t,n)}))},t.borderShow=function(){var e=this.state.hover;"normal"!==this.props.type||e||this.setState({hover:!0})},t.borderHide=function(){var e=this.state,t=e.hover,e=e.isEdit;"normal"===this.props.type&&t&&!e&&this.setState({hover:!1})},t.confirmEdit=function(){var e=this.state,t=e.curValue,n=e.lastVal,a=e.canEdit,i=this.props,c=i.confirm,o=i.id,r=i.name,s=i.empty,e=i.confirmNoChange,i=i.inputType,l=document.getElementById(o);""!==String(t).replace(/\s/g,"")||s||"remark"===i?(""===String(t).replace(/\s/g,"")&&s||"remark"==i?(this.setState({isEdit:!1,hover:!1,lastVal:t},function(e){l.blur()}),c&&c(t,n)):n===t?this.setState({isEdit:!1,hover:!1},function(e){l.blur()}):(this.setState({isEdit:!1,hover:!1,lastVal:t},function(e){l.blur()}),c&&c(t,n)),a&&(e&&e(t),this.setState({canEdit:!1}))):(p.Z.warning(r+"不能为空"),this.setState({curValue:n},function(e){l.focus()}))},t.render=function(){var e=this.props,t=e.id,n=e.style,a=e.className,i=e.placeholder,c=this.state,o=c.isEdit,r=c.curValue,s=c.hover,e=d()(["edit-input-wrap",a]),c=d()(["edit-input-cont",{hover:s,"is-edit":o}]),a=d()(["edit-input",{disabled:!o}]);return l().createElement("div",{className:e,style:n},l().createElement("div",{className:c,onMouseEnter:this.borderShow.bind(this),onMouseLeave:this.borderHide.bind(this),onClick:this.checkEdit.bind(this)},l().createElement("input",{id:t,className:a,type:"text",value:r,title:r,placeholder:i,style:n,disabled:!o,onInput:this.changeName.bind(this),onKeyDown:this.enter.bind(this)}),s&&!o&&l().createElement(u.Z,{placement:"top",overlay:"编辑"},l().createElement("div",{className:"btn-wrap",title:"编辑"},l().createElement("i",{className:"name-edit edit-btn icon-cem_edit"}))),s&&o&&l().createElement("div",{className:"btn-wrap"},l().createElement(u.Z,{placement:"top",overlay:"取消"},l().createElement("i",{className:"cancel-edit edit-btn icon-cem_delete",onClick:this.cancelEdit.bind(this),title:"取消"})),l().createElement(u.Z,{placement:"top",overlay:"确认"},l().createElement("i",{className:"confirm-edit edit-btn icon-cem_check-out",onClick:this.confirmEdit.bind(this),title:"确认"})))))},e}(c.Component);c.propTypes=t,c.defaultProps=a;const o=c}}]);