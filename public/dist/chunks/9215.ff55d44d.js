(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[9215],{79215:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P});var a=n(37316),h=n.n(a),r=n(67154),f=n.n(r),l=n(85354),o=n.n(l),t=(n(53294),n(56697)),a=n(23279),v=n.n(a),r=n(67294),y=n.n(r),l=n(55609),i=n(40847),g=(n(1025),n(65400)),b=(n(35797),n(64749)),I=(n(9405),n(89552)),E=(n(48145),n(40987)),C=(n(15086),n(94055)),O=(n(89858),n(51024)),R=(n(29809),n(97538)),k=[{value:"brandId",label:"品牌"},{value:"sourceId",label:"平台"},{value:"shopType",label:"店铺类型"},{value:"shopId",label:"店铺"},{value:"catId",label:"类目"},{value:"packageType",label:"销售版本"},{value:"price",label:"价格区间"},{value:"autoAdd",label:"自动添加"}];const s=function(e){var t=e.selTypes,n=e.onOk,a=e.onCancel,r=e.disableType,l=e.initialValues,o=e.searchRule,s=e.onChange,u=e.onSelect,c=e.check,i=e.type,p=h()(e,["selTypes","onOk","onCancel","disableType","initialValues","searchRule","onChange","onSelect","check","type"]),d=R.Z.useForm()[0],t=t.filter(function(e){return"packageType"!==e&&"autoAdd"!==e}),m=v()(function(e,t){c&&p.ruleNameCheck({ruleName:e,type:i}).then(function(e){e?t():t("此规则名称已被使用，请尝试其他规则名称")})},500);return y().createElement("div",{className:"yt_subscribe_rules_edit_wrapper"},y().createElement("div",{className:"content"},y().createElement("div",{className:"condition"},y().createElement("div",{className:"header"},y().createElement("span",null,"订阅条件")),y().createElement("div",{className:"content_rule"},y().createElement(R.Z,f()({},{labelCol:{span:5},wrapperCol:{span:19}},{form:d,name:"control-hooks",initialValues:l,noValidate:!0}),y().createElement(R.Z.Item,{name:"ruleName",label:y().createElement("span",null,"规则名称"),validateFirst:!0,rules:[{required:!0,message:"请输入规则名称"},{validator:function(e,t,n){m(t,n)}},{whitespace:!0,message:"请输入规则名称"},{type:"string",max:20,message:"规则名称不能超过20个字"}]},y().createElement(O.default,{placeholder:"请输入",allowClear:!0,autoFocus:!0,autocomplete:"off"})),t.map(function(n){var e=k.find(function(e){return e.value===n}),t=(p[n+"Opt"]||(p[n+"Opts"]&&p[n+"Opts"].length?p[n+"Opts"]:p[n+"Init"])||[]).map(function(e){return{label:e&&(e.name||e.label),value:e&&(e.id||e.value)}});return y().createElement(R.Z.Item,{key:n,name:n,label:y().createElement("span",null,function(){switch(n){case"price":return y().createElement("span",null,e.label,y().createElement(C.default,{placement:"top",overlayClassName:"alert-log-tips",overlay:"取发现该商品链接时的挂牌价作为所属价格区间判断依据"},y().createElement("i",{className:"icon-cem_file1 price_tip",style:{marginLeft:4}})));case"autoAdd":return y().createElement("span",null,e.label,y().createElement(C.default,{placement:"top",overlayClassName:"alert-log-tips",overlay:"当链接权益使用超过95%时，系统会停止“自动添加”功能；当余额耗尽，“添加”的功能也将停止。如需要获取更多权益，请与客户成功沟通"},y().createElement("i",{className:"icon-cem_file1 autoAdd_tip",style:{marginLeft:4}})));default:return e.label}}()),rules:[{required:"sourceId"===n||"brandId"===n||"shopId"===n,message:"请选择"+e.label}],className:"price"===n?"price_wrap":""},"price"===n?y().createElement("div",null,y().createElement(R.Z.Item,{style:{display:"inline-block",width:"20%"},name:"minPrice",rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return n("maxPrice")&&Number(n("maxPrice"))<Number(t)?Promise.reject(new Error("价格下限不高于价格上限")):Promise.resolve()}}},{type:"number",transform:function(e){if(e)return Number(e)},message:"请输入数字"}]},y().createElement(O.default,{placeholder:"请输入",allowClear:!0,disabled:r})),y().createElement("span",{style:{display:"inline-block",width:"32px",lineHeight:"32px",textAlign:"center",color:"#BFBFBF"}},"-"),y().createElement(R.Z.Item,{style:{display:"inline-block",width:"20%"},name:"maxPrice",rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return n("minPrice")&&Number(n("minPrice"))>Number(t)?Promise.reject(new Error("价格上限不低于价格下限")):Promise.resolve()}}},{type:"number",transform:function(e){if(e)return Number(e)},message:"请输入数字"}]},y().createElement(O.default,{placeholder:"请输入",allowClear:!0,disabled:r}))):"autoAdd"===n?y().createElement(E.Z,null):y().createElement(b.default,{placeholder:"请选择",allowClear:!0,mode:"multiple",showArrow:!0,options:t,getPopupContainer:function(e){return e.parentNode},disabled:r,filterOption:"brandId"!==n&&"shopId"!==n,optionFilterProp:"label",onChange:function(e){return s(n,e)},onSearch:function(e){return o({id:n,words:e})},onSelect:function(e,t){return u(n,t)},onBlur:function(){return u(n)},dropdownRender:function(e){return p[n+"Opts"]&&p[n+"Opts"].length&&!p[n+"Loading"]?e:y().createElement("div",{style:{textAlign:"center"}},y().createElement(I.default,null))}}))}),y().createElement("div",{className:"footer"},y().createElement(g.default,{onClick:a},"取消"),y().createElement(g.default,{type:"primary",htmlType:"submit",onClick:function(){return n({values:d.getFieldsValue(),error:d.getFieldsError()})}},"保存")))))))};var a=n(64396),u=n(35239),p=n(87219),d=n(61409),c=a.Z.product.comment.smartSubscribe,m=t.Z.confirm,r=function(c){function e(e){var o=c.call(this,e)||this;o._handleOnRuleItemChange=function(n){var a=Object.keys(n)[0];o.setState({changed:!0,test:!0,priceTest:!0,rules:(0,p.ZP)(o.state.rules,function(e){var t=e.find(function(e){return e.id===a});t?t.values=n[a]:e.push({id:a,values:n[a]})})})},o._routerWillLeave=function(){return!(o.state.changed&&!o.back)||"你修改的信息将不会被保存，确定离开此页面？"},o._handleOnSettingChange=function(e){o.setState({selTypes:e})},o._handleOnCancel=function(){d.mW.go(-1)},o._showConfirm=function(e){var t,n,a=e.values,r=e.error,l=!1;r.forEach(function(e){e.errors.length&&(l=!0)}),l||(t=a.ruleName,n=a.sourceId,e=a.brandId,r=a.shopId,t&&n&&e&&r&&0!==e.length&&0!==n.length&&0!==r.length&&("复制"===o.props.location.state.title?m({title:"提醒",icon:y().createElement(i.Z,null),className:"fuzhi_tixing",content:"保存后创建成新规则，该规则只能重命名，无法修改规则。",onOk:function(){o._handleOnOk({values:a})},onCancel:function(){}}):o._handleOnOk({values:a})))},o._handleOnOk=function(e){var t=e.values;o.setState({check:!1});e=o.state.id;"重命名"===o.props.location.state.title?o.props.fetchRuleRename({ruleName:t.ruleName,id:e,type:o.props.location.pathname.includes("/price")?"PRICE":"DEFAULT",callback:function(){return d.mW.go(-1)}}):o.props.addRule(f()({},t,{type:o.props.location.pathname.includes("/price")?"PRICE":"DEFAULT",callback:function(){return d.mW.go(-1)}}))},o._searchRule=v()(function(e){var t=e.id,n=e.words,a=o.state,e=a.sourceIdValues,a=a.shopTypeValues;"brandId"===t?o.props.searchRuleParams({queryType:t,words:n}):"shopId"===t&&o.props.searchRuleParams({queryType:t,words:n,platform:e,shopType:a})},500),o._handleOnSelect=function(e,t){var n={};n[e+"Opt"]=void 0,"brandId"===e?n[e+"Opts"]=t&&!o.props.brandIdOpts.find(function(e){return e.name===t.label})?o.props.brandIdOpts.concat(t):o.props.brandIdOpts:"shopId"===e&&(n[e+"Opts"]=t&&!o.props.shopIdOpts.find(function(e){return e.name===t.label})?o.props.shopIdOpts.concat(t):o.props.shopIdOpts),o.props.save(f()({},n))},o._optionsChange=function(e,t){"sourceId"===e?o.setState({sourceIdValues:t},function(){var e=o.state,t=e.sourceIdValues,e=e.shopTypeValues;o.props.searchRuleParams({queryType:"shopType",platform:t,shopType:e,judge:!0}),o.props.searchRuleParams({queryType:"shopId",platform:t,shopType:e,judge:!0})}):"shopType"===e&&o.setState({shopTypeValues:t},function(){var e=o.state,t=e.sourceIdValues,e=e.shopTypeValues;o.props.searchRuleParams({queryType:"shopId",platform:t,shopType:e,judge:!0})})};var t=e.location.state,n=t.id,a=void 0===n?"":n,r=t.rules,n=void 0===r?[]:r,r=t.ruleName,t=t.title,l=k.map(function(e){return e.value});n.length&&(l=n.reduce(function(e,t){t=l.indexOf(t.id);return-1<t&&e.push(l[t]),e},[]));var s={},u={};return a&&(n.map(function(e){return e.values&&(u[e.id+"Init"]=e.values)}),n.map(function(e){return e.values&&(s[e.id]=e.values.map(function(e){return e.id||e}))}),s.maxPrice=1<s.price.length?parseFloat(s.price[1]):"",s.minPrice=s.price.length?parseFloat(s.price[0]):"","重命名"===t&&(s.ruleName=r)),o.state=f()({id:a,rules:n,ruleName:r,test:!0,priceTest:!0,changed:!1,selTypes:l,type:e.location.pathname.includes("/price")?"PRICE":"DEFAULT",flag:!0,disableType:"重命名"===t,initialValues:s,sourceIdValues:[],shopTypeValues:[],check:!0},u),o.event={onRuleItemChange:o._handleOnRuleItemChange,onSettingChange:o._handleOnSettingChange,onCancel:o._handleOnCancel,onOk:o._showConfirm,searchRule:o._searchRule,onChange:o._optionsChange,onSelect:o._handleOnSelect},o}o()(e,c);var t=e.prototype;return t.componentDidMount=function(){var o=this;this.props.router.setRouteLeaveHook(this.props.route,this._routerWillLeave),this.props.fetchRuleParams({projectId:u.t.get(u.V.backProjectConfig).id,type:this.props.location.pathname.includes("/price")?"PRICE":void 0}).then(function(){var n,a,e,t=o.props.location.state,r=t.id,t=t.rules,l={};(void 0===r?"":r)&&((void 0===t?[]:t).map(function(e){return e.values&&(l[e.id]=e.values)}),l.brandId&&l.brandId.length&&(n={},e=o.props.brandIdOpts.concat(l.brandId).reduce(function(e,t){return n[t.id]||(n[t.id]=e.push(t)),e},[]),o.props.save({brandIdOpts:e})),l.shopId&&l.shopId.length&&(a={},e=o.props.shopIdOpts.concat(l.shopId).reduce(function(e,t){return a[t.id]||(a[t.id]=e.push(t)),e},[]),o.props.save({shopIdOpts:e})))}).catch(function(e){})},t.componentWillUnmount=function(){this.props.clean()},t.render=function(){return y().createElement(s,f()({},this.props,this.state,this.event))},e}(r.PureComponent);const P=(0,l.connect)(function(e){var t=e.loading,e=h()(e,["loading"]);return f()({},e[c],{loading:t.effects[c+"/fetchRuleParams"]||!1})},function(t){return{save:function(e){return t({type:c+"/save",payload:e})},clean:function(e){return t({type:c+"/clean",payload:e})},fetchRuleParams:function(e){return t({type:c+"/fetchRuleParams",payload:e})},addRule:function(e){return t({type:c+"/addRule",payload:e})},fetchRuleRename:function(e){return t({type:c+"/fetchRuleRename",payload:e})},searchRuleParams:function(e){return t({type:c+"/searchRuleParams",payload:e})},ruleNameCheck:function(e){return t({type:c+"/ruleNameCheck",payload:e})}}})(r)}}]);