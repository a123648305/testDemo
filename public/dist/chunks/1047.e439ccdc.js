(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[1047],{8469:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var t=n(85354),a=n.n(t),r=n(67294),f=n.n(r),E=n(92360),v=n(29383),C=n(59762),y=n(33097),S=n(55815),T=n(53754),b=n(66130),t=n(30381),t=n.n(t),N=n(43036),L=n(37841),l=n(61409),m=n(36144),I=n(35239),o=n(60742),R=[{key:"全部",value:"BOTH"},{key:"待处理",value:"UNREAD"},{key:"已处理",value:"READ"}],j=["规则被触发时推送出去即视为一次推送","在特定时间内收到推送的用户数","预警推送给特定（多个）用户时，只要被任一用户”处理“，即视为该提醒已处理"],i="YYYY-MM-DD",A=[t()().subtract(6,"days"),t()()],c=function(t){function e(e){var p=t.call(this,e)||this;p.fetchLogList=function(){var e=p.state,t=e.projectId,n=e.searchText,a=e.team,r=e.user,l=e.status,i=e.alertObject,c=e.alertIndex,o=e.pageIndex,s=e.pageSize,u=e.dateFilter;p.setState({loading:!0},function(){m.h.post("/warning/log/project/aspect/list",{projectId:t,title:n,statusList:"BOTH"===l?["READ","UNREAD"]:[l],receiverTeamIdList:a,receiverUserIdList:r,filterModel:{analysis:i,aspect:c},dateFilter:u,pageIndex:o,pageSize:s}).then(function(e){var t,n,a=e.status,r=e.data.result;(200<=a&&a<300||304===a)&&r&&(t=r.total,n=r.remindCount,e=r.remindUserCount,a=r.remindResolveCount,r=r.list,p.setState({list:r,total:t,remindCount:n,remindUserCount:e,remindResolveCount:a}))}).finally(function(){p.setState({loading:!1})})})},p.fetchTeamOptions=function(){try{var e=p.state.projectId;m.h.post("filter/find",{projectId:e,filterTypes:["TEAM","USER"],type:"OVERVIEW"}).then(function(e){var t=e.data,e=t.code,t=t.result;2e4===e&&t&&(e=t.team,t=t.user,p.setState({teamOptions:e.map(function(e){return{id:e.id,name:e.name}}),userOptions:t.map(function(e){return{id:e.id,name:e.username}})}))})}catch(e){console.error(e)}},p.handleChangeTeam=function(e){p.setState({team:e},function(){return p.fetchLogList()})},p.handleChangeUser=function(e){p.setState({user:e},function(){return p.fetchLogList()})},p.handleInputChange=function(e){p.setState({searchText:e})},p.handleKeyUp=function(e){e.stopPropagation(),13===e.keyCode&&p.setState({pageIndex:1},function(){return p.fetchLogList()})},p.handleAlertObjChange=function(e){p.setState({alertObject:e,pageIndex:1},function(){return p.fetchLogList()})},p.handleAlertIndexChange=function(e){p.setState({alertIndex:e,pageIndex:1},function(){return p.fetchLogList()})},p.switchPage=function(e){p.setState({pageIndex:e},function(){return p.fetchLogList()})},p.switchPageSize=function(e){p.setState({pageIndex:1,pageSize:e},function(){return p.fetchLogList()})},p.handleChangeStatus=function(e){p.state.status!==e&&p.setState({status:e,pageIndex:1},function(){return p.fetchLogList()})},p.handleDateChange=function(e){Array.isArray(e)&&2===e.length&&(e={dateGroupType:"DAY",from:e[0],quickChoice:e[0].replace(/-/g,".")+" - "+e[1].replace(/-/g,"."),remoteName:"cTime",to:e[1]},p.setState({dateFilter:e,pageIndex:1},function(){return p.fetchLogList()}))},p.getContent=function(e){if(e){var t=JSON.parse(e),n=t.calType,a=t.dateRangeType,r=t.aspect,l=t.warningValue,i=t.warningBeyondValue,c=t.analysis,e=t.aspectList,t=0<o.B.filter(function(e){return e.value===a}).length&&o.B.filter(function(e){return e.value===a})[0].label,n=n?"PERCENT"===n?"负面声量占比":"负面声量":"";return e?""+c+t+"的"+e.map(function(e){return"【"+e.aspectName+"】"}).join("")+"等负面声量触发预警":""+c+t+"的"+r+"的"+n+"为"+l+"，超过阈值（"+i+"）"}};e=e.location.state;return p.state={projectId:I.t.get(I.V.backProjectConfig)&&I.t.get(I.V.backProjectConfig).id,alertObject:{},alertIndex:{},dateFilter:{dateGroupType:"DAY",from:A[0].format(i),quickChoice:A[0].format(i).replace(/-/g,".")+" - "+A[1].format(i).replace(/-/g,"."),remoteName:"cTime",to:A[1].format(i)},team:[],teamOptions:[],user:[],userOptions:[],status:"BOTH",searchText:e&&e.title||"",pageIndex:1,pageSize:20,list:[],total:0,loading:!1,columns:[{label:"",prop:"paddingLeft",width:48},{label:"预警名称",prop:"title",minWidth:240,render:function(e){return f().createElement(N.Z,{overlay:function(){return p.renderDetailPopup(e.title,e.description)},placement:"topLeft",overlayClassName:"alert-detail-popup"},f().createElement("div",{className:"alert-title",onClick:function(){return p.handleEdit(e.warningId)}},e.title))}},{label:"提醒内容",prop:"content",minWidth:240,render:function(e){return f().createElement("div",{className:"alert-title",onClick:function(){return p.goDetail(e.id)}},e.remindMsg)}},{label:"推送成员",prop:"user",render:function(e){var t=e.receiverTeamList,e=e.receiverUserList;return f().createElement(r.Fragment,null,f().createElement("div",{className:"teams"},f().createElement("span",null,"团队 | "),f().createElement("span",null,0<t.length?t.map(function(e){return e.name}).join("，"):"无")),f().createElement("div",{className:"teams"},f().createElement("span",null,"成员 | "),f().createElement("span",null,0<e.length?e.map(function(e){return e.name}).join("，"):"无")))},minWidth:240},{label:"处理状态",prop:"status",render:function(e){return f().createElement("div",{className:(e.status,"alert-log-status")},"READ"===e.status?"已处理":"待处理")}},{label:"推送时间",prop:"createdAt",minWidth:140,render:function(e){return f().createElement("span",null,e.createdAt.substring(0,16))}},{label:"",prop:"paddingRight",width:48}],remindCount:0,remindUserCount:0,remindResolveCount:0},p}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.fetchTeamOptions(),this.fetchLogList()},n.renderDetailPopup=function(e,t){return f().createElement(r.Fragment,null,f().createElement("div",{className:"popup-title"},"预警名称"),f().createElement("div",{className:"popup-content",style:{marginBottom:"16px"}},e),f().createElement("div",{className:"popup-title"},"预警说明"),f().createElement("div",{className:"popup-content"},t))},n.handleEdit=function(e){l.mW.push({pathname:"/account/project/alert/edit",state:{id:e,edit:!0}})},n.goDetail=function(e){l.mW.push({pathname:"/account/project/alert/detail",state:{id:e}})},n.render=function(){var e,t=this.state,n=t.projectId,a=t.teamOptions,r=t.userOptions,l=t.searchText,i=t.status,c=t.columns,o=t.loading,s=t.list,u=t.pageIndex,p=t.pageSize,m=t.total,d=t.remindCount,g=t.remindUserCount,h=t.remindResolveCount;return f().createElement("div",{className:"alert-log"},f().createElement(S.Z,{title:(t=(e={title:"推送日志"}).title,e=e.url,[{title:"所有项目",url:"/account/project"},{title:I.t.get(I.V.backProjectConfig).name,url:"/account/project/preview"},{title:"预警管理",url:"/account/project/alert"},{title:t,url:e}])}),f().createElement("div",{className:"search_wrapper"},f().createElement("div",{className:"alert-log-search"},f().createElement("div",null,f().createElement("div",{className:"search-input-wrapper"},f().createElement(E.Input,{icon:"search",value:l,onChange:this.handleInputChange,onKeyUp:this.handleKeyUp,placeholder:"请输入预警名称"})),f().createElement(C.Z,{projectId:n,type:"OVERVIEW",onChange:this.handleAlertObjChange}),f().createElement(y.Z,{projectId:n,onChange:this.handleAlertIndexChange}),f().createElement(T.Z,{title:"推送团队",options:a,onChange:this.handleChangeTeam}),f().createElement(T.Z,{title:"推送用户",options:r,onChange:this.handleChangeUser}),f().createElement(L.Z,{activeKey:i,options:R,onTabClick:this.handleChangeStatus})),f().createElement("div",null,f().createElement(b.S,{defaultValue:A,getDateRange:this.handleDateChange})))),f().createElement("div",{className:"alert-log-content"},f().createElement(E.Loading,{loading:o,text:"拼命加载中"},f().createElement("div",{className:"cards"},f().createElement("div",null,f().createElement("span",null,d),f().createElement("span",null,f().createElement("span",null,"推送提醒次数"),f().createElement(N.Z,{overlay:j[0],placement:"top",overlayClassName:"alert-log-tips"},f().createElement("i",{className:"cem-icon icon-cem_problem"})))),f().createElement("div",null,f().createElement("span",null,g),f().createElement("span",null,f().createElement("span",null,"推送用户"),f().createElement(N.Z,{overlay:j[1],placement:"top",overlayClassName:"alert-log-tips"},f().createElement("i",{className:"cem-icon icon-cem_problem"})))),f().createElement("div",null,f().createElement("span",null,h),f().createElement("span",null,f().createElement("span",null,"已处理提醒"),f().createElement(N.Z,{overlay:j[2],placement:"top",overlayClassName:"alert-log-tips"},f().createElement("i",{className:"cem-icon icon-cem_problem"}))))),f().createElement(v.Z,{columns:c,data:s,total:m,pagePosition:"down",pageSize:p,currentPage:u,onPage:this.switchPage,onSortChange:this.handleSort,pageSizeSelectorShow:!0,onPageSizeChange:this.switchPageSize,notLimit:!0}))))},e}(r.PureComponent)},60742:(e,t,n)=>{"use strict";n.d(t,{B:()=>a});var a=[{label:"近3天",value:"LAST_THREE_DAYS"},{label:"近7天",value:"LAST_SENVEN_DAYS"},{label:"近30天",value:"LAST_THIRTY_DAYS"},{label:"当天",value:"CURRENT_DAY"},{label:"当周",value:"CURRENT_WEEK"},{label:"当月",value:"CURRENT_MONTH"}]},37841:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),r=n.n(t),t=n(45697),n=n.n(t),t=function(e){var n=e.activeKey,t=e.options,a=e.onTabClick;return r().createElement("div",{className:"tabs"},t.map(function(e,t){return r().createElement("div",{key:t,className:n===e.value?"active-tab":"",onClick:function(){return n!==e.value&&a(e.value,e)}},e.key||e.label)}))};t.propTypes={activeKey:n().oneOfType([n().string,n().number]),options:n().arrayOf(n().shape({key:n().string,value:n().oneOfType([n().string,n().number])})).isRequired,onTabClick:n().func.isRequired};const a=t}}]);