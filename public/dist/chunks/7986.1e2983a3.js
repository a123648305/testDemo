(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[7986],{86500:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});const n=a.p+"html-4cab33"},90323:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});const n=a.p+"html-db25b2"},87986:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var t=i(67154),n=i.n(t),t=i(85354),l=i.n(t),t=i(67294),u=i.n(t),d=i(61409),p=i(92360),c=i(5133),s=i(43036),o=i(36144),m=(i(55815),i(46701),"template"),f="taskMessage",E="handleResult",h="failLog",a=function(a){function e(e){var r=a.call(this,e)||this;r.dragInit=function(){var t=r.state.timer,a=r.refs.drag;document.ondragover=function(e){clearTimeout(t),t=setTimeout(function(){a.style.display="none"},200),r.setState({timer:t}),a.style.display="block"},a.ondragenter=function(e){r.setState({dragenter:!0})},a.ondragover=function(){return!1},a.ondragleave=function(){r.setState({dragenter:!1})},a.ondrop=function(e){e=e.dataTransfer.files[0];return"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(c.Z.warning("只支持 xlsx 格式,请重新上传"),r.setState({fileTest:!1,dragenter:!1})):r.setState({file:e,fileTest:!0,dragenter:!1},function(e){r.upLoadFile()}),!1}},r.readFile=function(e){e=e.target.files[0];"xlsx"!==e.name.slice(e.name.lastIndexOf(".")+1)?(c.Z.warning("只支持 xlsx 格式,请重新上传"),r.setState({fileTest:!1})):r.setState({file:e,fileTest:!0},function(e){r.upLoadFile()})},r.upLoadFile=function(){r.setState({updateStatue:2});var a=r.xhr=new XMLHttpRequest;a.open("POST","/api/connection/preprocess/batch/url"),a.onreadystatechange=function(e){var t;4===a.readyState&&(200===a.status?(2e4===(t=JSON.parse(a.responseText)).code&&r.setState({updateStatue:3,fileResult:n()({},t.result)}),c.Z[2e4===t.code?"success":"error"](t.msg)):c.Z.error("上传出错"))},a.upload.onprogress=function(e){e.lengthComputable&&(e=Math.floor(e.loaded/e.total*100),r.setState({percent:e}))},a.onabort=function(e){c.Z.error("上传已中断")};var e=new FormData;e.append("file",r.state.file),e.append("projectId",r.state.projectId),e.append("connectionType",r.state.connectionType),a.send(e)},r.downLoadFile=function(e){var t,a=r.state,n=a.projectId,l={connectionType:a.connectionType,projectId:n};switch(e){case m:t="/excel/template/download";break;case f:t="/excel/all/url/connection/download";break;case E:t="/excel/preprocess/download",l.excelId=r.state.fileResult.excelId;break;case h:t="/excel/failure/download",l.excelId=r.state.upLoadResult.excelId;break;default:t=null}t&&(r.setState({loading:!0}),o.h.post(t,l).then(function(e){var t=e.data;r.setState({loading:!1}),2e4===t.code&&t.result?((e=document.createElement("a")).href=t.result,e.click()):c.Z.error("操作失败")}).catch(function(e){r.setState({loading:!1})}))},r.renderUpload=function(){var e=r.state.fileTest;return u().createElement("div",{className:"upload"},u().createElement("input",{ref:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",type:"file",onChange:function(e){return r.readFile(e)}}),u().createElement("div",{className:"add",onClick:function(e){return r.refs.file.click()}},u().createElement("div",null)),u().createElement("b",null,u().createElement("span",{className:"dark-blue",onClick:function(e){return r.refs.file.click()}},"点击上传文件 "),"或者 拖拽上传"),u().createElement("div",{className:"accept",style:{color:e?"":"#D96969"}},"（只支持 xlsx 格式）"),u().createElement("p",null,u().createElement("span",{className:"dark-blue",onClick:function(e){return r.downLoadFile(m)}},"下载标准模板 "),"填写商品链接信息批量新增"))},r.renderUploading=function(){return r.refs.loading&&r.refs.loading.style.setProperty("--x",r.state.percent+"%"),u().createElement("div",{className:"uploading"},u().createElement("b",null,"上传中，请等待..."),u().createElement("div",{ref:"loading"},u().createElement("block",null)),u().createElement("span",{className:"dark-blue"}))},r.renderUploadFinish=function(){var e=r.state.file;return u().createElement("div",{className:"upload-Finish"},u().createElement("img",{src:i(90323),alt:""}),u().createElement("b",null,e.name),u().createElement("p",null,u().createElement("span",{className:"dark-blue",onClick:function(e){return r.downLoadFile(m)}},"下载标准模板 "),"填写商品链接信息批量新增"))},r.renderUpdateType=function(){var e=r.state,t=e.updateType,e=e.fileResult;return u().createElement("div",{className:"update-type"},u().createElement("b",null,"预处理结果"),u().createElement(s.Z,{placement:"top",overlayClassName:"alert-log-tips",overlay:u().createElement("a",{style:{color:"#7262FD"},href:"https://skieer.feishu.cn/docs/doccnbH85LqIFQPZEKoqYWW61Rh?from=from_copylink",target:"_blank",rel:"noopener noreferrer"},"了解更多")},u().createElement("i",{className:"icon-cem_file1",style:{marginLeft:4}})),u().createElement("p",{className:"result-detail"},u().createElement("span",null,"新增：",u().createElement("a",null," ",e.canAdd,"条")),u().createElement("span",null,"更新：",u().createElement("a",null," ",e.updateable,"条"),u().createElement("div",{className:0===t?"sel":"",onClick:function(e){return r.setState({updateType:0})}},"暂不处理"),u().createElement("div",{className:1===t?"sel":"",onClick:function(e){return r.setState({updateType:1})}},"立即更新")),u().createElement("span",null,"待维护：",u().createElement("a",null," ",e.toBeMaintained,"条")),u().createElement("span",null,"不符合模版格式：",u().createElement("a",null," ",e.unqualified,"条"))),u().createElement("p",{className:"pre-result"},u().createElement("span",{className:"dark-blue",onClick:function(e){return r.downLoadFile(E)}},"查看预处理详细结果")))},r.pre=function(){var e=r.state,t=e.stepNow,e=e.updateStatue;1===t&&1===e?d.mW.go(-1):1===t&&1<e?(2===e&&r.xhr.abort(),r.setState({updateStatue:1,file:null})):1<t&&r.setState({stepNow:--t})},r.next=function(){var e=r.state.stepNow;2===e&&r.upLoad(),r.setState({stepNow:++e})},r.upLoad=function(){var e=r.state,t=e.fileResult,a=e.updateType,e=e.projectId;o.h.post("connection/batch/add/url",{excelId:t.excelId,update:Boolean(a),projectId:e}).then(function(e){2e4===e.data.code?(r.setState({upLoadResult:n()({},e.data.result)}),c.Z.success(e.data.msg)):c.Z.error(e.data.msg)})};var t=e.location.state;return r.state={title:[].concat(t.title,["批量上传任务"]),projectId:t.projectId,file:null,updateType:0,fileTest:!0,loading:!1,updateStatue:1,stepNow:1,percent:100,dragEnter:!1,timer:0,fileResult:{canAdd:"",updateable:"",unqualified:"",excelId:""},upLoadResult:{success:"",failure:"",notUpdate:"",excelId:""},connectionType:e.location.pathname.includes("/price")?"PRICE":"DEFAULT"},r}l()(e,a);var t=e.prototype;return t.componentDidMount=function(){this.dragInit()},t.renderContent=function(){var e=this.state,t=e.updateStatue,e=e.stepNow;if(1!==e)return 2===e?this.renderUpdateType():null;switch(t){case 1:return this.renderUpload();case 2:return this.renderUploading();case 3:return this.renderUploadFinish()}},t.render=function(){var t=this,e=this.state,a=e.dragenter,n=e.updateStatue,l=e.stepNow,r=e.upLoadResult,c=e.loading,s=e.fileResult,o=location.pathname.split("/")[3];return u().createElement("div",{className:"batch-add"},u().createElement(p.Loading,{loading:c,style:{height:"100%"}},l<3?u().createElement("div",{className:"step-wrap"},u().createElement("header",null,u().createElement("div",{className:1===l?"sel":""},u().createElement("span",null,"1"),u().createElement("p",null,"上传文件")),u().createElement("div",{className:2===l?"sel":""},u().createElement("span",null,"2"),u().createElement("p",null,"导入列表"))),u().createElement("section",{className:a?"is-drag":""},this.renderContent(),u().createElement("div",{ref:"drag",className:"drag",style:{zIndex:1===l&&1===n?"":"-1"}})),u().createElement("footer",null,u().createElement(p.Button,{onClick:function(e){return t.pre()}},"取消"),u().createElement(p.Button,{type:"primary",disabled:n<3,onClick:function(e){return t.next()}},2===l?"确认导入":"下一步"))):u().createElement("div",{className:"finish"},u().createElement("div",{className:"step-wrap"},u().createElement("header",null,u().createElement("div",{className:1===l?"sel":""},u().createElement("span",null,"1"),u().createElement("p",null,"上传文件")),u().createElement("div",{className:3===l?"sel":""},u().createElement("span",null,"2"),u().createElement("p",null,"选择更新方式")))),u().createElement("div",{className:"finish-content"},u().createElement("img",{src:i(86500),alt:""}),u().createElement("b",null,"提交成功"),u().createElement("p",{className:"result-detail"},u().createElement("span",null,"上传成功：",u().createElement("a",null,r.success," 条")),u().createElement("span",null,"上传失败： ",u().createElement("a",null,r.failure," 条")),u().createElement("span",null,"暂不更新： ",u().createElement("a",null,r.notUpdate," 条"))),u().createElement("p",{className:"pre-result"},u().createElement("span",{className:"dark-blue",onClick:function(e){return t.downLoadFile(h)}},"查看失败日志")),u().createElement("p",{className:"success_link_num"},"上传成功的 ",r.success," 条商品链接中"),u().createElement("p",{className:"result-detail"},u().createElement("span",null,"已添加到项目：",u().createElement("a",null,r.success," 条")),u().createElement("span",null,"需要维护的链接： ",u().createElement("a",null,s.toBeMaintained," 条"))),0<Number(s.toBeMaintained)&&u().createElement(p.Button,{type:"primary",onClick:function(){return d.mW.push({pathname:"/account/project/"+o+"/link/linkMaintenance",state:{batchNo:s.batchNo}})}},"立即维护")))))},e}(t.Component)},46701:(e,t,a)=>{"use strict";a.d(t,{u:()=>l});var n=a(35239),l=function(e){var t=e.title,e=e.url;return[{title:"所有项目",url:"/account/project"},{title:n.t.get(n.V.backProjectConfig).name,url:"/account/project/preview"},{title:"comment"===e.split("/")[3]?"电商评论":"price"===e.split("/")[3]?"电商监控":"数据链接",url:"/account/project/"+e.split("/")[3]},{title:t,url:e}]}}}]);