(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[4400],{24400:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var t=a(67154),h=a.n(t),t=a(85354),n=a.n(t),f=a(67294),v=a.n(f),y=a(92360),N=a(55815),t=a(30381),i=a.n(t),t=a(55609),l=a(36144),b=a(35239),T=a(60742),S=a(50976),r={thresholds:"阈值",values:"实际值"},a=function(t){function e(e){var E=t.call(this,e)||this;E._handleFetchUserStateList=function(){E.props.dispatch({type:"userStateMessage/fetchUserStateList",payload:{pageIndex:1,pageSize:10,timestamp:"",PROGRESS:!1,isNotConcat:!0}})},E.fetchAlertDetail=function(e){E.setState({loading:!0},function(){l.h.post("/warning/log/user/project/aspect/find",{id:e}).then(function(e){var t,a,n,l,r,i,s,c,o,u,d,p=e.status,m=e.data.result;(200<=p&&p<300||304===p)&&(E.props.location.state.isRefreshUserState&&E._handleFetchUserStateList(),t=m.analysisName,a=m.aspectName,n=m.aspectNameList,l=m.aspectValueList,u=m.calType,r=m.createdAt,i=m.dateRangeType,s=m.description,c=m.title,o=m.threshold,e=m.warningData,p=m.filterModel,m=m.content,m=JSON.parse(m).aspectList,E.setState({analysisName:t,aspectName:a,aspectNameList:n,aspectValueList:l,calType:u,createdAt:r,dateRangeType:i,description:s,title:c,threshold:o,currValue:e,filterModel:p,combined:m&&0<m.length}),m&&0<m.length&&(m=0<T.B.filter(function(e){return e.value===i}).length&&T.B.filter(function(e){return e.value===i})[0].label,u={title:t?""+t+m+(u?"PERCENT"===u?"负面声量占比":"负面声量":""):"",list:l.map(function(e){return{aspect:e.aspectName,value:e.warningValue.includes("%")?parseFloat(e.warningValue,2):Number(e.warningValue),threshold:e.warningBeyondValue.includes("%")?parseFloat(e.warningBeyondValue,2):Number(e.warningBeyondValue)}})},d=h()({title:u.title},u.list.reduce(function(e,t){var a,n;return e.aspects.push(t.aspect),e.values.push(t.value),e.thresholds.push(t.threshold),e.beyonds.push(((t.value-t.threshold)/t.threshold*100).toFixed(2)+"%"),e.right=Math.max(e.right,(a=t.value,n=12,(t=document.createElement("canvas").getContext("2d")).font=n+"px 'PingFang SC','Microsoft Yahei', 'Helvetica Neue', Helvetica, Tahoma, Arial, 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif",t.measureText(a).width)),e},{aspects:[],values:[],thresholds:[],beyonds:[],right:0})),0<l.length&&E.setState({isInterger:!l[0].warningValue.includes("%")},function(){return E.getOption(d)})))}).finally(function(){E.setState({loading:!1})})})},E.getMore=function(e){var t=E.state,a=t.createdAt,n=t.dateRangeType,l=t.analysisName,r=t.aspectName,t=t.filterModel,a=function(e,t){var a="YYYY-MM-DD",e=e.substring(0,10),n=i()(e,a),e=n.format(a),l="";switch(t){case"LAST_THREE_DAYS":l=n.subtract(2,"days");break;case"LAST_SENVEN_DAYS":l=n.subtract(6,"days");break;case"LAST_THIRTY_DAYS":l=n.subtract(29,"days");break;case"CURRENT_DAY":l=n;break;case"CURRENT_WEEK":l=n.startOf("week");break;case"CURRENT_MONTH":l=n.startOf("month")}a=l.format(a);return{dateGroupType:"DAY",from:a,to:e,remoteName:"cTime",numOfDays:i()(e).diff(i()(a),"days")+1,quickChoice:a.replace(/-/g,".")+" - "+e.replace(/-/g,".")}}(a,n),n=("/account/project/alert/detail"===location.pathname?b.t.get(b.V.backProjectConfig):b.t.get(b.V.curProject)).id,t=JSON.parse(JSON.stringify(t));e&&(0<t.aspect.aspect1.length?t.aspect.aspect1=[e]:t.aspect.aspect2=[e]),window.open("/tab/detail?"+encodeURIComponent(JSON.stringify({analyseName:l,aspect:e||r,filterModel:t,dateFilter:a,leftName:"",projectId:n,seriesName:"负面",type:"EMOTION_ASPECT_LEVEL_BAR"})))},E.getOption=function(a){var l=E.state.isInterger,t=Math.max.apply(Math,a.values),e={title:{text:a.title},grid:[0,1].map(function(){return{show:!1,left:16,top:80,bottom:0,containLabel:!0,right:a.right+16+24}}),legend:{top:40,left:12,itemWidth:14,itemHeight:14,data:["thresholds","values"].map(function(e,t){return{name:r[e]}})},xAxis:[0,1].map(function(e){return{max:t,show:!1,gridIndex:e}}),yAxis:[0,1].map(function(e){return{gridIndex:e,inverse:!0,data:a.aspects,show:0===e,axisLabel:{interval:0}}}),series:["thresholds","values"].map(function(e,t){return{type:"bar",xAxisIndex:t,yAxisIndex:t,name:r[e],barWidth:0===t?40:20,barGap:"5",barCategoryGap:"5",label:{show:!!t,position:"right",color:"#262626",formatter:function(e){e=e.data.value;return l?e:e+"%"}},data:a[e].map(function(e){return{value:e,itemStyle:{normal:{color:0===t?"#FFEBE9":"#E96165"},emphasis:{color:0===t?"#FFEBE988":"#E9616588"}}}})}}),tooltip:{trigger:"item",backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#ccc",padding:10,textStyle:{color:"#262626"},extraCssText:"box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);",confine:!0,formatter:function(e){var t=e.marker,a=e.name,n=e.seriesName,e=e.value;return a+"<br><div>"+t+n+"："+(l?e:e+"%")+"</div>"}}};E.setState({option:e})};e=e.location.state.id;return E.state={id:e,combined:!1,loading:!1,createdAt:"",currValue:"",threshold:"",title:"",analysisName:"",aspectName:[],aspectNameList:[],aspectValueList:[],dateRangeType:"",calType:"",description:"",collapsed:!0,option:{},isInterger:!1},E}n()(e,t);var a=e.prototype;return a.componentDidMount=function(){var e=this.state.id;this.fetchAlertDetail(e)},a.componentDidUpdate=function(e){var t=e.location.state.id,e=this.props.location.state.id;t&&e&&e!==t&&this.fetchAlertDetail(e)},a.render=function(){var t=this,e=this.state,a=e.loading,n=e.createdAt,l=e.currValue,r=e.threshold,i=e.title,s=e.description,c=e.analysisName,o=e.aspectName,u=e.aspectNameList,d=e.aspectValueList,p=e.calType,m=e.dateRangeType,E=e.collapsed,h=e.option,g=e.combined,e=0<T.B.filter(function(e){return e.value===m}).length&&T.B.filter(function(e){return e.value===m})[0].label,p=p?"PERCENT"===p?"负面声量占比":"负面声量":"",o=c?""+c+e+o+p:"",d=40*(d.length+1)+100;return v().createElement("div",{className:"alert-detail"},v().createElement(N.Z,{title:"/account/project/alert/detail"!==location.pathname?[{title:"指标预警",url:"/aspectWarning"},{title:"预警详情",url:""}]:[{title:"所有项目",url:"/account/project"},{title:b.t.get(b.V.backProjectConfig).name,url:"/account/project/preview"},{title:"预警管理",url:"/account/project/alert"},{title:"推送日志",url:"/account/project/alert/log"},{title:"推送详情",url:"/account/project/alert/detail"}]}),v().createElement(y.Loading,{loading:a,text:"拼命加载中"},v().createElement("div",{className:"alert-detail-bottom"},v().createElement("div",{className:"alert-detail-card"},v().createElement("div",{className:g?"alert-detail-card-header combined":"alert-detail-card-header",style:{height:g?E?"198px":"315px":"auto"}},g?v().createElement(f.Fragment,null,v().createElement("div",null,v().createElement("span",null,"预警基础信息"),v().createElement("span",{onClick:function(){return t.setState({collapsed:!E})}},v().createElement("span",null,"展开更多"),v().createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:E?"rotate(0)":"rotate(180deg)"}}))),v().createElement("div",{className:"alert-detail"},v().createElement("div",null,v().createElement("span",null,"预警名称"),v().createElement("span",null,i)),v().createElement("div",null,v().createElement("span",null,"预警对象"),v().createElement("span",null,c)),v().createElement("div",null,v().createElement("span",null,"预警指标"),v().createElement("span",{title:u.join("、")},u.join("、"))),v().createElement("div",{style:{display:E?"none":"block"}},v().createElement("span",null,"计算公式"),v().createElement("span",null,p)),v().createElement("div",{style:{display:E?"none":"block"}},v().createElement("span",null,"时间范围"),v().createElement("span",null,e)),v().createElement("div",{style:{display:E?"none":"block"}},v().createElement("span",null,"预警说明"),v().createElement("span",null,s)))):v().createElement(f.Fragment,null,v().createElement("div",null,v().createElement("span",null,o),v().createElement("span",null,n)),v().createElement("div",null,v().createElement("span",null,l),v().createElement("span",null,"阈值"),v().createElement("span",null,"（",r,"）")))),v().createElement("div",{className:g?"alert-detail-card-body combined":"alert-detail-card-body"},g?v().createElement("div",null,v().createElement("span",{className:"created-time"},n),v().createElement(S.Z,{theme:"yunting_h5_warning",option:h,style:{height:d,width:"100%"},onEvents:{click:function(e){e=e.name;return t.getMore(e)}}})):v().createElement("div",{className:"alert-info"},v().createElement("div",null,"预警基础信息"),v().createElement("div",{className:"alert-detail"},v().createElement("div",null,v().createElement("span",null,"预警名称"),v().createElement("span",null,i)),v().createElement("div",null,v().createElement("span",null,"预警对象"),v().createElement("span",null,c)),v().createElement("div",null,v().createElement("span",null,"预警指标"),v().createElement("span",{title:u.join("、")},u.join("、"))),v().createElement("div",null,v().createElement("span",null,"计算公式"),v().createElement("span",null,p)),v().createElement("div",null,v().createElement("span",null,"时间范围"),v().createElement("span",null,e)),v().createElement("div",null,v().createElement("span",null,"预警说明"),v().createElement("span",null,s)))),!g&&v().createElement(y.Button,{type:"primary",onClick:function(){return t.getMore()}},"洞察更多"))))))},e}(f.Component);const s=(0,t.connect)()(a)},60742:(e,t,a)=>{"use strict";a.d(t,{B:()=>n});var n=[{label:"近3天",value:"LAST_THREE_DAYS"},{label:"近7天",value:"LAST_SENVEN_DAYS"},{label:"近30天",value:"LAST_THIRTY_DAYS"},{label:"当天",value:"CURRENT_DAY"},{label:"当周",value:"CURRENT_WEEK"},{label:"当月",value:"CURRENT_MONTH"}]}}]);