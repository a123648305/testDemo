(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[9973],{99973:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n(67154),h=n.n(r),t=n(85354),a=n.n(t),r=n(67294),m=n.n(r),i=n(36144),t=n(53281),g=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=i.call.apply(i,[this].concat(n))||this).json=null,t.myChartClick=function(e){return e&&e.data&&e.data.url&&window.open(e.data.url),!1},t.getParams=function(){},t.buildChart=function(n){var i,a,e=t.props.json;e?0!==e.length?(t.jsonStr===JSON.stringify(e)?t.refs.chart.myChart.resize():t.jsonStr=JSON.stringify(e),i=[],a=[],e instanceof Array&&e.map(function(e,t){var n=e.connConfig.map(function(e){return e}),r=n[1];a[t]=r&&r.topicValue,i[t]={id:r&&r.topicId,name:r&&r.topicValue,value:e.price,url:e.url,category:n}}),t.refs.chart.setOption({tooltip:{confine:!0,formatter:function(e){return e.data.category.map(function(e){return e?e.topicTypeValue+"："+e.topicValue+"<br/>":""}).join("")+e.marker+"价格："+e.value}},series:[{type:"bar",data:i,legendHoverLink:!1,barMaxWidth:20,label:{show:!0,position:"right",color:"#262626",formatter:function(e){var t=void 0===n?1:n;return e.data.category[t]?e.data.category[t].topicValue:""}}}],color:["#1574B3"],grid:{containLabel:!0,left:10,right:200,bottom:12,top:0,splitLine:{show:!0}},xAxis:[{show:!0,type:"value",scale:!0,boundaryGap:["20%","30%"],axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1},axisLabel:{color:"#262626"},axisTick:{show:!1}}],yAxis:[{type:"category",data:i,axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},axisLabel:{color:"#262626",formatter:function(e){return e}},axisTick:{show:!1}}]},!0)):t.refs.chart.setEmptyOption("没有数据可用"):t.refs.chart.loading()},t}a()(e,i);var t=e.prototype;return t.componentWillMount=function(){this.setState({json:this.props.json_bar})},t.componentWillReceiveProps=function(e){this.setState({json:e.json_bar})},t.shouldComponentUpdate=function(e){return(!this.json||this.json!==JSON.stringify(e.json))&&(this.json=JSON.stringify(e.json),!0)},e}(t.Z),y=n(29383),v=n(19586),o=n(39432),E=function(i){function e(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(r=i.call.apply(i,[this].concat(t))||this).json=null,r.getParams=function(){},r.myChartClick=function(e){return e&&e.data&&e.data.url&&window.open(e.data.url),!1},r.dateFormatter=function(e){var t=r.props.dateGroupType,e=e.replace("-","年");return 0<=["MONTH","DAY","HOUR"].indexOf(t)&&(e=(e=e.replace("-","月")).replace(" ","日 ")),"HOUR"===t&&(e+="时"),"WEEK"===t&&(e+="周"),e},r.buildChart=function(){var n,i,a,e=r.props.json;e?0!==e.length?(r.jsonStr===JSON.stringify(e)?r.refs.chart.myChart.resize():r.jsonStr=JSON.stringify(e),n=[],i=[],a=[],e instanceof Array&&e[0].data.map(function(e,t){n.push(e.date)}),e instanceof Array&&e.map(function(t,e){var n=t.connConfig[1];n&&i.push(n.topicValue);var r=t.data.map(function(e){return{value:e.price,url:t.url,category:n}});a.push({name:n&&n.topicValue,data:r,type:"line",legendHoverLink:!1,barMaxWidth:20,smooth:!0,connectNulls:!0})}),e={tooltip:{trigger:"axis",confine:!0,formatter:function(e){return"时间："+r.dateFormatter(e[0].name)+"<br/>"+e.map(function(e){var t=e.data.category?(e.data.category.topicValue||"")+(""===e.data.category.topicValue||null===e.data.category.topicValue?"":"：")+(e.value||""):"";return e.marker+t}).join("<br/>")}},series:a,color:["#d96969","#c8662b","#c89b2b","#9369d9","#2684ff","#1574b3","#1ea082","#1bbf69","#3accd3","#d2d2d2"],legend:{type:"scroll",show:!0,orient:"vertical",top:20,right:100,bottom:20,data:i,itemGap:20,textStyle:{padding:[0,0,0,7]},formatter:function(e){var t=e.split("").reduce(function(e,t){return(0,o.jD)(e.join("").concat(t))<200&&e.push(t),e},[]).join("");return t===e?e:t+"..."}},grid:{left:60,right:350,bottom:30,top:20,splitLine:{show:!0}},xAxis:[{show:!0,type:"category",data:n,axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1},axisLabel:{color:"#262626",formatter:r.dateFormatter},axisTick:{show:!1}}],yAxis:[{type:"value",scale:!0,boundaryGap:["20%","30%"],axisLabel:{color:"#262626"},axisTick:{show:!1},axisLine:{show:!0,lineStyle:{color:"#EBEBEB"}},splitLine:{show:!1}}]},r.refs.chart.setOption(e,!0)):r.refs.chart.setEmptyOption("没有数据可用"):r.refs.chart.loading()},r}a()(e,i);var t=e.prototype;return t.componentWillMount=function(){this.setState({json:this.props.json_line})},t.shouldComponentUpdate=function(e){return(!this.json||this.json!==JSON.stringify(e.json))&&(this.json=JSON.stringify(e.json),!0)},e}(t.Z),w=n(13853),l=n(92360),s=n(35239),c=function(t){function e(e){var a=t.call(this,e)||this;return a.ready=function(){a.getBarList(),a.getLineList(),a.getTopics()},a.stop=function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},a.checkHide=function(){(a.state.showCardList2||a.state.showCardList1)&&a.setState({showCardList1:!1,showCardList2:!1})},a.handelCardSel=function(t,n,r){var e,i=a.state["cardValue"+r];i.forEach(function(e){e.id===t&&(e.value=n)}),a.setState(((e={})["cardValue"+r]=i,e),function(e){return 1===r?a.getBarList():a.getLineList()})},a.onWindowResize=function(){a.waiter||(a.waiter=!0,setTimeout(function(){a.resize(),a.waiter=!1},300))},a.resize=function(){a.refs.bar.refs.chart.myChart.resize(),a.refs.line.refs.chart.myChart.resize()},a.getBarList=function(){var t=a.getParams(),e=a.state.cardValue1;t.projectId=a.projectId,t.filterModel.project=t.filterModel.project||[a.projectId],e.forEach(function(e){return t[e.id]=e.value}),a.refs.bar.refs.chart.loading(),a.refs.bar.json=null,i.h.post("/widget/data/find/PRICE_LEVEL_BAR",t).then(function(e){e=e.data.result.list.reverse();a.setState({json_bar:e},function(){return a.refs.bar&&a.refs.bar.resize()})})},a.getTopics=function(){i.h.post("/projects/config/list",[a.projectId]).then(function(e){var n=[];e.data.result.forEach(function(e,t){t={label:e.configName,prop:e.id,checked:1===t,minWidth:"60"};n.push(t)});var t=n,e={label:m().createElement(l.Select,{className:"table-select",onChange:a.changeTopic,value:0<n.filter(function(e){return e.checked}).length?n.filter(function(e){return e.checked})[0].prop:""},t.map(function(e,t){return m().createElement(l.Select.Option,{key:t,label:e.label,value:e.prop},e.label)}))};a.setState({selectMenuItem:t,column:e})})},a.changeTopic=function(r){var e=a.state.selectMenuItem;e.forEach(function(e,t){var n=e.prop===r;(e.checked=n)&&a.refs.bar&&a.refs.bar.buildChart(t)}),a.setState({selectMenuItem:e})},a.getParams=function(){if(a.refs.filter&&a.refs.filter.getValue()&&a.refs.filter.getValue().dateFilter){var e=a.refs.filter.getValue();return e.dateFilter.dateGroupType=new Date(e.dateFilter.to).getTime()-new Date(e.dateFilter.from).getTime()<=6048e5?"HOUR":e.dateFilter.dateGroupType,e}return null},a.selectFilter=function(e){a.setState({tab:e})},a.onFilterChange=function(e){a.getBarList(),a.getLineList()},a.getShowColumns=function(e){a.setState({selectMenuItem:e})},a.state={json_bar:void 0,json_line:void 0,topics:[],selTopics:[],selectMenuItem:[],column:{},columns:[{label:"排序",width:50,render:function(e,t,n){return m().createElement("span",{style:{color:"#8c8c8c"}},+n+1)}},{label:"价格",width:80,prop:"price"}],filterParams:"",tab:0,computed:"MIN",loading:!0,cardList:[{name:"价格类型",id:"priceType",list:[{name:"挂牌价",id:"listPrice"},{name:"到手价",id:"takePrice"}]},{name:"展示方式",id:"priceCompareType",list:[{name:"实时价格",id:"REAL_TIME"},{name:"最高价",id:"MAX"},{name:"最低价",id:"MIN"}]},{name:"显示数量",id:"topSize",list:[{name:"TOP10",id:"10"},{name:"TOP20",id:"20"},{name:"全部",id:"2000"}]},{name:"顺序",id:"sortType",list:[{name:"升序",id:"ASC"},{name:"降序",id:"DESC"}]}],cardValue1:[{id:"priceType",value:"listPrice"},{id:"priceCompareType",value:"REAL_TIME"},{id:"topSize",value:"10"},{id:"sortType",value:"ASC"}],cardValue2:[{id:"priceType",value:"listPrice"},{id:"priceCompareType",value:"MAX"},{id:"topSize",value:"10"},{id:"sortType",value:"ASC"}]},a}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.projectId=s.t.get(s.V.curProject).id,window.addEventListener("click",this.checkHide,!1),window.addEventListener("resize",this.onWindowResize)},n.componentWillUnmount=function(){window.removeEventListener("click",this.checkHide,!1),window.removeEventListener("resize",this.onWindowResize)},n.getLineList=function(){var t=this,n=this.getParams(),e=this.state.cardValue2;n.projectId=this.projectId,n.filterModel.project=n.filterModel.project||[this.projectId],e.forEach(function(e){return n[e.id]=e.value}),this.refs.line.refs.chart.loading(),this.refs.line.json=null,i.h.post("/price/compare/trade/line",n).then(function(e){t.setState({json_line:e.data.result.reverse()},function(){return t.refs.line&&t.refs.line.resize()})})},n.render=function(){var r=this,e=this.state,t=e.column,n=e.columns,i=e.json_bar,a=e.json_line,o=e.selTopics,l=e.selectMenuItem,s=e.cardList,c=e.cardValue1,u=e.showCardList1,p=e.showCardList2,d=e.cardValue2;t.label&&(t.render=function(e){return m().createElement("p",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",paddingRight:"20px"},title:l.filter(function(e){return e.checked}).length?e[l.filter(function(e){return e.checked})[0].prop]:""},l.filter(function(e){return e.checked}).length?e[l.filter(function(e){return e.checked})[0].prop]:"")});var f={json:i,category:o},e={json:a,category:o,dateGroupType:this.getParams()?this.getParams().dateFilter.dateGroupType:null},a=void 0,o=0;return i&&i instanceof Array&&(o=38*i.length,a=i.slice(0).reverse().map(function(t){return t.connConfig.forEach(function(e){e&&(t[e.topicTypeId]=e.topicValue)}),t})),m().createElement("div",{className:"price-chart-wrapper"},m().createElement(v.Z,{title:w.v[window.location.pathname],ref:"filter",filterCondition:{filter:["CONN_CONFIG"]},model:"PRICE_COMPARE",showList:["condition","time","save"],onChange:this.onFilterChange,onFilterReady:this.ready}),m().createElement("div",{className:"chart-wrapper",ref:function(e){return r.flexWrapper=e}},m().createElement("div",{style:{float:"right",paddingTop:"20px"}}),m().createElement("div",{className:"title"},m().createElement("p",null,"价格比较"),m().createElement("div",{className:"more",onClick:this.stop},m().createElement("span",{onClick:function(e){return r.setState({showCardList1:!u})}},"..."),u&&m().createElement("ul",null,s.map(function(n,e){return m().createElement("li",{key:e},m().createElement("p",null,n.name),n.list.map(function(t,e){return m().createElement("span",{onClick:function(e){return r.handelCardSel(n.id,t.id,1)},key:e,className:c.filter(function(e){return e.id===n.id})[0].value===t.id?"sel":""},t.name)}))})))),m().createElement("div",{className:"bar-part",style:{minHeight:(o||570)+58+"px",gridTemplateRows:(o||570)+58+"px",gridTemplateColumns:a&&0<a.length?"calc(100% - 300px) 300px":"100% 0"}},m().createElement(g,h()({},f,{ref:"bar"})),a&&a.length?m().createElement(y.Z,{columns:n.concat(t),data:a}):null),m().createElement("div",{className:"title"},m().createElement("p",null,"价格趋势"),m().createElement("div",{className:"more",onClick:this.stop},m().createElement("span",{onClick:function(e){return r.setState({showCardList2:!p})}},"..."),p&&m().createElement("ul",null,s.filter(function(e){return"sortType"!==e.id}).map(function(n,e){return m().createElement("li",{key:e},m().createElement("p",null,n.name),n.list.map(function(t,e){return"REAL_TIME"===t.id||"2000"===t.id?null:m().createElement("span",{onClick:function(e){return r.handelCardSel(n.id,t.id,2)},key:e,className:d.filter(function(e){return e.id===n.id})[0].value===t.id?"sel":""},t.name)}))})))),m().createElement("div",{className:"line-part"},m().createElement(E,h()({ref:"line"},e)))))},e}(r.Component)}}]);