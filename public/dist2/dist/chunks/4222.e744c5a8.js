(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[4222],{18514:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P});var t=n(85354),a=n.n(t),t=n(67154),o=n.n(t),t=n(37316),l=n.n(t),t=n(67294),s=n.n(t),t=n(55609),u=n(92360),p=n(5133),r=n(55815),c=n(61409),i=n(90355),m=n(43036),d=n(87729),h=n(36144),f=n(61193),g=n(97911),E=n(97189),v=function(t){function e(e){var i=t.call(this,e)||this;return i.changeState=function(e){i.setState(e,function(){i.updateFilter()})},i.clickCheckbox=function(e){var t=e.aspect1,n=e.aspect2,a=i.state.limit;a&&(t&&t.length>a||n&&n.length>a)?p.Z.warning("当前条件下最多支持选择"+a+"个分析指标"):i.setState(e)},i.updateFilter=function(){var e=i.state.aspectType,t=i.state,n=t.aspect1,t=t.aspect2;e&&n&&0<n.length?t=[]:0<t.length&&(n=[]),i.setState({aspect1:n,aspect2:t})},i.clickCancelBtn=function(){i.state.aspectShow&&i.props.closePanel()},i.orderAspect=function(e){for(var t=i.state.aspectList,n=[],a=[],l=0;l<t.length;l++){for(var r=!1,c=0;c<e.length;c++)if(t[l].name===e[c]){r=!0,n[c]=t[l];break}r||a.push(t[l])}i.setState({aspectList:n.concat(a)})},i.state={aspectShow:!1,aspectType:!e.value||0<e.value.aspect1.length,aspect1:e.value&&e.value.aspect1?e.value.aspect1:[],aspect2:e.value&&e.value.aspect2?e.value.aspect2:[],rawAspectList:[],aspectList:[],projectId:e.projectId,model:e.model,ready:!1,limit:e.limit,panelWidth:e.panelWidth},i}a()(e,t);var n=e.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){var t=e.aspectShow,n=e.limit,e=e.panelWidth;this.setState({aspectShow:t,limit:n,panelWidth:e})},n.componentDidMount=function(){this.getValue(),window.addEventListener("click",this.clickCancelBtn)},n.componentDidUpdate=function(){this.setLeftBlockHeight()},n.componentWillUnmount=function(){window.removeEventListener("click",this.clickCancelBtn)},n.setLeftBlockHeight=function(){var e=document.querySelectorAll(".analyse-aspect-panel-body .left .new-checkbox-panel .wt-checkbox-group .wt-checkbox"),t=document.querySelectorAll(".analyse-aspect-panel-body .right .new-checkbox-panel");if(e.forEach(function(e){return e.style.marginBottom="0"}),0<t.length)for(var n=t.length-1;0<=n;n--){var a=t[n].offsetHeight;36<a&&(e[n].style.marginBottom=a-36+"px")}},n.getValue=function(){var e=this.state,t=e.aspectType,n=e.aspect1,a=e.aspect2;if(e.ready)return{aspect1:t?n:[],aspect2:t?[]:a};t=this.props,a=t.projectId,t=t.model;this.fetchAspects(a,t)},n.getSndIndex=function(e){e=this.state.aspects[e];return e&&0<e.length&&this.setState({aspectType:!1,aspect1:[],aspect2:e}),e},n.setAspectFromOutside=function(e){this.setState(o()({aspectType:0<e.aspect1.length},e))},n.fetchAspects=function(n,a){var l=this,e=a.map(function(e){return h.h.post("filter/find",{filterTypes:["ASPECT"],projectId:n,type:e})});Promise.all(e).then(function(e){e.forEach(function(e){var t=e.data.result,e=l.state.rawAspectList;t.aspect&&l.setState({projectId:n,model:a,rawAspectList:e.concat(t.aspect)})}),l.formatData()})},n.formatData=function(){var n,a,e,t=this.state,l=t.model,r=t.aspect1,c=t.aspect2,i=t.rawAspectList,o=(t.limit,this.state),t=o.aspectShow,o=o.aspectType,i=i,s={};"BRAND"===l?(n=i.map(function(e){return e&&JSON.parse(e)}),(l=0)<=(a=f.Z.getAuthority()).indexOf("ANALYZE_PRODUCT")&&l++,0<=a.indexOf("ANALYZE_SERVER")&&l++,0<=a.indexOf("ANALYZE_MARKETING")&&l++,0===l?n.forEach(function(e){Object.keys(e).forEach(function(e,t){return s[t]=e})}):1===l?["ANALYZE_PRODUCT","ANALYZE_SERVER","ANALYZE_MARKETING"].forEach(function(e,t){0<=a.indexOf(e)&&Object.keys(n[t]).map(function(e,t){return s[t]=e})}):1<l&&(0<=a.indexOf("ANALYZE_PRODUCT")&&(1===(l=Object.keys(n[0])).length?s["产品"]=n[0][l[0]]:1<l.length&&(s["产品"]=n[0])),0<=a.indexOf("ANALYZE_SERVER")&&(1===(e=Object.keys(n[1])).length?s["服务"]=n[1][e[0]]:1<e.length&&(s["服务"]=n[1])),0<=a.indexOf("ANALYZE_MARKETING")&&(1===(e=Object.keys(n[2])).length?s["市场"]=n[2][e[0]]:1<e.length&&(s["市场"]=n[2])))):i&&i[0]&&i.forEach(function(e){s=Object.assign.apply(Object,[s].concat(JSON.parse(e)))});i=Object.keys(s).map(function(e,t){var a=s[e];return{id:t,name:e,contain:a.length?a:Object.keys(a).map(function(e,t){var n=a[e];return{id:t,name:e,contain:n.length?n:Object.keys(n)}})}});i.length<=1&&(o=t=!1),this.changeState({aspectList:i,aspectShow:t,aspects:s,aspectType:o,aspect1:r,aspect2:c,ready:!0}),this.props.onChange()},n.handleClickBlock=function(e,t){var n=this.state,a=n.aspectType;n.aspectShow&&a!==e&&(n=document.querySelectorAll(".analyse-aspect-panel-body div"),a="disabled",e?this.hanldeClass("remove",n[1],a):this.hanldeClass("remove",n[0],a),e?this.setState({aspectType:e,aspect2:[]}):this.setState({aspectType:e,aspect1:[]}))},n.hanldeClass=function(e,t,n){("add"===e?(0,E.addClass):(0,E.removeClass))(t,n)},n.clickConfirmBtn=function(){this.props.onChange(),this.props.closePanel()},n.clearOptions=function(){this.setState({aspect1:[],aspect2:[]})},n.render=function(){var n=this,e=this.state,t=e.aspectList,a=e.aspectType,l=e.aspect1,r=e.aspect2,c=e.aspectShow,i=e.limit,e=e.panelWidth;return s().createElement("div",{className:"analyse-aspect-panel-wrapper",style:{display:c?"block":"none",width:e,zIndex:1},onClick:function(e){return e.stopPropagation()}},s().createElement("div",{className:"analyse-aspect-panel-body"},s().createElement("div",{className:a?"left":"left disabled",onClick:function(e){return n.handleClickBlock(!0,e)}},s().createElement(g.Z,{changeState:function(e){return n.clickCheckbox({aspect1:e})},checkedList:l,ITEMS:t.map(function(e){return e.name||e}),categoryTitle:"一级指标",type:"vertical",limit:i})),s().createElement("div",{className:a?"right disabled":"right",onClick:function(e){return n.handleClickBlock(!1,e)}},s().createElement("div",null,"二级指标"),0<t.length&&t.map(function(e,t){return s().createElement(g.Z,{changeState:function(e){return n.clickCheckbox({aspect2:e})},checkedList:JSON.parse(JSON.stringify(r)),key:"aspect1-"+t,categoryTitle:e.name,ITEMS:e.contain.map(function(e){return e.name||e}),type:"horizontal",limit:i})}))),s().createElement("div",{className:"analyse-aspect-panel-footer"},s().createElement("span",{onClick:function(){return n.clearOptions()}},"清空全部选项"),s().createElement("div",null,s().createElement(u.Button,{type:"primary",onClick:function(){return n.clickConfirmBtn()}},"确定"),s().createElement("span",{className:"cancelBtn",onClick:function(){return n.clickCancelBtn()}},"取消"))))},e}(s().Component),y=function(t){function e(e){var n=t.call(this,e)||this;return n.closePanel=function(){n.setState({showPanel:!1})},n.handleAspectChange=function(){n.getFormatedValue(),n.props.onChange()},n.getFormatedValue=function(){var e,t;!n.panel||(t=n.panel.getValue())&&(e=t.aspect1,t=t.aspect2,n.setState({formatedValue:(0===e.length&&0===t.length?"请选择":0===e.length?"二级指标：":"一级指标：")+(0<e.length?e:t).join("，")}))},n.handleClear=function(e){e.stopPropagation(),n.panel&&n.panel.clearOptions(),setTimeout(function(){return n.getFormatedValue()},0)},n.getPanelWidth=function(){},n.state={showPanel:!1,formatedValue:"",showClearIcon:!1,panelWidth:760},n}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.getPanelWidth()},n.togglePanel=function(e){var t=this,n=this.state.showPanel;n&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){return t.setState({showPanel:!n})},0)},n.getValue=function(){if(this.panel)return this.panel.getValue()},n.getSndIndex=function(e){return this.panel.getSndIndex(e)},n.setAspectFromOutside=function(e){return this.panel.setAspectFromOutside(e)},n.orderAspect=function(e){this.panel.orderAspect(e)},n.render=function(){var t=this,e=this.state,n=e.showPanel,a=e.formatedValue,e=(e.showClearIcon,e.panelWidth);return s().createElement("div",{className:"analyse-aspect-wrapper analyse-aspect-wrapper-input-mode",style:{width:"unset",float:"unset",display:"inline-block"}},s().createElement("div",{className:"analyse-aspect-trigger analyse-aspect-trigger-input-mode",onClick:function(e){return t.togglePanel(e)},onMouseOver:function(){return t.setState({showClearIcon:!0})},onMouseLeave:function(){return t.setState({showClearIcon:!1})}},s().createElement(u.Input,{ref:function(e){return t.input=e},value:a}),s().createElement("i",{className:"icon-cem_pull-down-or-take-up",style:{transform:n?"rotate(180deg)":"",top:n?"4px":"5px"}})),s().createElement(v,o()({ref:function(e){t.panel=e},panelWidth:e,aspectShow:n,closePanel:this.closePanel},this.props,{onChange:this.handleAspectChange})))},e}(s().Component),C=n(83425);const b=function(t){function e(e){e=t.call(this,e)||this;return e.state={},e}return a()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.formRule,a=e.projectId,l=e.onCancel,r=e.onConfirm,c=e.formRuleChange;return s().createElement("div",{className:"warning_dialog"},s().createElement(u.Dialog,{title:"新建预警",size:"large",visible:!0,onCancel:l,lockScroll:!1},s().createElement(u.Dialog.Body,null,s().createElement("div",{style:{minHeight:"400px"}},s().createElement(C.Z,{ref:function(e){return t.filter=e},value:n.filterValue,disableIds:[n.filterModel.analysis.id],filter:["CONN_CONFIG","SOURCE","TAG"],projectId:a,style:{display:"block"},type:"PRICE_WARNING",onFilterChange:function(e){c({key:["filterValue"],value:t.filter.getValue()})},filterConfig:["ESCORE","messageType"],noBottom:!0,hideAdvanced:!0,moreFilterPosition:"top"}))),s().createElement(u.Dialog.Footer,{className:"dialog-footer"},s().createElement(u.Button,{onClick:l},"取消"),s().createElement(u.Button,{type:"primary",onClick:function(){r(t.filter.getReFormatValue())}},"确定"))))},e}(s().Component);var k=n(35239),N=["PRODUCT","MARKETING","SERVICE"],S=[{id:"LAST_SENVEN_DAYS",name:"近7天",des:"每次计算预警数值时的时间是从当天往前推6天的00：00：00~当前时间"},{id:"LAST_THREE_DAYS",name:"近3天",des:"每次计算预警数值时的时间是从前天的00:00:00~当前时间"},{id:"LAST_THIRTY_DAYS",name:"近30天",des:"每次计算预警数值时的时间是从当天往前推29天的00:00:00~当前时间"},{id:"CURRENT_DAY",name:"当天",des:"每次计算预警数值时的时间是从当天的00:00:00~当前时间"},{id:"CURRENT_WEEK",name:"当周",des:"当周的计算预警数值的时间是从当周的周天的00:00:00 ~ 当前时间。<br/>上周之前的计算预警数值的事件是从该周的周天00:00:00~该周的周六23:59:59"},{id:"CURRENT_MONTH",name:"当月",des:"当月的计算预警数值的时间是从当月的1日的00:00:00 ~ 当前时间。<br/>上月之前的计算预警数值的事件是从该月的周1日00：00：00~该月的最后1天的23:59:59"}];const I=function(t){function e(e){var a=t.call(this,e)||this;return a.calTypeChange=function(e){a.setState({redIndex:[]}),a.props.formRuleChange({key:["calType"],value:e})},a.previewChange=function(t,n){var e=a.props.formRule;if("all"===t){if(""===a.input.refs.input.value)return void p.Z.warning("输入预警阙值，如50");e.ruleDetail=n.map(function(e){return{name:e,value:a.input.refs.input.value}}),a.setState({value:"",redIndex:[]})}else e.ruleDetail.some(function(e){return e.name===t})?e.ruleDetail.forEach(function(e){e.name===t&&(e.value=n)}):e.ruleDetail.push({name:t,value:n});a.props.formRuleChange({key:["ruleDetail"],value:e.ruleDetail})},a.selInput=function(e,t){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),a.setState({selIndex:t})},a.cancelSel=function(){a.setState({selIndex:null})},a.judge=function(e,t){var n=a.state.redIndex;e?n.includes(t)&&(n.splice(n.indexOf(t),1),a.setState({redIndex:JSON.parse(JSON.stringify(n))})):(p.Z.error("请填写预警阀值"),a.setState({redIndex:[].concat(n,[t])}))},a.state={selIndex:null,visible:!1,value:"",redIndex:[]},a}a()(e,t);var n=e.prototype;return n.componentDidMount=function(){this.times=0,window.addEventListener("click",this.cancelSel)},n.componentWillUnmount=function(){window.removeEventListener("click",this.cancelSel)},n.render=function(){var a=this,e=this.state,l=e.selIndex,t=e.visible,n=e.value,r=e.redIndex,c=this.props.formRule,e=c.filterModel.aspect,i=e.aspect1.length?e.aspect1:e.aspect2.length?e.aspect2:null;return s().createElement("div",{className:"wraning-edit"},s().createElement("h2",null,"预警规则设置",s().createElement(u.Button,{onClick:function(){return a.setState({visible:!0})},disabled:!c.filterModel.analysis.id,style:{float:"right"}},s().createElement("i",{className:"icon-cem_screen"},"筛选条件"))),s().createElement(u.Form,{ref:function(e){return a.form=e},model:c,labelWidth:"100",className:"form"},s().createElement(u.Form.Item,{label:s().createElement("span",{className:"require"},s().createElement("span",null,"*"),"预警对象"),prop:""},s().createElement(d.Uq,{projectId:k.t.get(k.V.backProjectConfig).id,value:c.filterModel.analysis.id?c.filterModel.analysis:null,singelSel:!0,onChange:function(e){return a.props.analysisChange({value:e})}}),s().createElement("span",{className:"analyse_aspect_wrap"},s().createElement("span",{className:"require"},s().createElement("span",null,"*"),"监测指标"),s().createElement(y,{ref:function(e){return a.analyseAspect=e},limit:null,value:e,model:N,projectId:k.t.get(k.V.backProjectConfig).id,onChange:function(){a.props.formRuleChange({key:["filterModel","aspect"],value:a.analyseAspect.getValue(),noChange:0===a.times}),a.times++}}))),s().createElement(u.Form.Item,{label:"计算公式",prop:"calType"},s().createElement(u.Radio,{value:"PERCENT",checked:"PERCENT"===c.calType,onChange:function(e){return a.calTypeChange(e)}},"负面声量占比",s().createElement(m.Z,{overlay:s().createElement("div",null,"描述用户对一个指标的不满意程度，",s().createElement("br",null),"具体是指负面声量占该指标的全部",s().createElement("br",null),"声量的比重。"),placement:"top"},s().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c"}}))),s().createElement(u.Radio,{value:"NUMBER",checked:"NUMBER"===c.calType,onChange:function(e){return a.calTypeChange(e)}},"负面声量")),s().createElement(u.Form.Item,{label:"时间范围",prop:"dateRangeType"},s().createElement(u.Radio.Group,{className:"radio_group",value:c.dateRangeType,onChange:function(e){return a.props.formRuleChange({key:["dateRangeType"],value:e})}},S.map(function(e,t){return s().createElement(u.Radio,{value:e.id,key:e.id},e.name,s().createElement(m.Z,{overlay:s().createElement("div",{style:{width:"220px"},dangerouslySetInnerHTML:{__html:e.des}}),placement:"top"},s().createElement("i",{className:"icon-cem_file1 hide",style:{color:"#8c8c8c"}})))})),"PERCENT"===c.calType?s().createElement("span",{className:"input"},"只有在负面声量大于",s().createElement(u.Input,{value:c.min,onChange:function(e){return a.props.formRuleChange({key:["min"],value:1===String(e).length&&"0"===e?"":e.replace(/[^\d]/g,"")})},onBlur:function(){return(!c.min||c.min<10)&&p.Z.error("请填写负面声量最小值，且该值最小为10")}}),"才会触发预警",s().createElement(m.Z,{overlay:s().createElement("div",null,"当我们基于百分比预警时，为防止",s().createElement("br",null),"声量很小的初期该数据剧烈波动，",s().createElement("br",null),"如一会是0%，一会是100%的情况",s().createElement("br",null),"，你需要设置一个数量，系统默认",s().createElement("br",null),"近7天是100，你可以依据你们的实",s().createElement("br",null),"际业务进行调整。"),placement:"top"},s().createElement("i",{className:"icon-cem_file1 hide",style:{color:"#8c8c8c",paddingLeft:"6px"}}))):""),s().createElement("div",{className:"preview"},s().createElement("p",null,"规则预览(在标题栏中输入可以实现快速填充)",s().createElement(m.Z,{overlay:"以下规则，任一触发预警就会给相关用户推送预警信息",placement:"top"},s().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:"8px"}}))),s().createElement("ul",{style:{width:i?"862px":"432px"}},s().createElement("li",{className:"monitor"},s().createElement("div",{className:"left",style:{width:i&&i.length<=5?"430px":"427px"}},"监测指标",s().createElement("span",null,"（系统会对",c.filterModel.analysis.values&&c.filterModel.analysis.values[0]?c.filterModel.analysis.values[0].name:"预警对象",S.filter(function(e){return e.id===c.dateRangeType})[0].name,"如下指标的负面声量占比进行预警监测)")),i&&s().createElement("div",{className:"right"},s().createElement(u.Input,{ref:function(e){return a.input=e},placeholder:"输入预警阈值，如50",value:n,onChange:function(e){"PERCENT"===c.calType&&100<Number(e)?p.Z.error("计算公式为负面声量占比时，预警阈值需小于等于100%"):a.setState({value:e.length&&0===Number(e)?"0":e.startsWith("0")?String(Number(e)):e.replace(/[^\d]/g,"")})}}),s().createElement(u.Button,{disabled:0===n.length,type:"primary",onClick:function(){return a.previewChange("all",i)}},"批量填充"))),s().createElement("div",{className:"wrap"},i?i.map(function(t,n){var e=c.ruleDetail.some(function(e){return e.name===t})?c.ruleDetail.filter(function(e){return e.name===t})[0].value:"";return s().createElement("li",{key:t},s().createElement("div",{className:"left"},t),s().createElement("div",{className:"right "+(r.includes(n)?"red":""),onClick:function(e){return a.selInput(e,n)}},l!==n&&(""!==e?s().createElement("span",null,"超过",(35<String(e).length?String(e).substring(0,34)+"...":e)+("PERCENT"===c.calType?"%":""),"就预警"):s().createElement("span",null,"请输入预警阈值")),l===n&&s().createElement(u.Input,{value:e,autoFocus:!0,onChange:function(e){"PERCENT"===c.calType&&100<Number(e)?p.Z.error("计算公式为负面声量占比时，预警阈值需小于等于100%"):a.previewChange(t,e.length&&0===Number(e)?"0":e.startsWith("0")?String(Number(e)):e.replace(/[^\d]/g,""))},onBlur:function(){return a.judge(e,n)}})))}):s().createElement("li",null,s().createElement("div",{className:"left",style:{color:"#8C8C8C"}},"当前无任何指标")))))),t&&s().createElement(b,o()({onCancel:function(){return a.setState({visible:!1})},onConfirm:function(e){a.setState({visible:!1}),a.props.formRuleChange({key:["filterModel","filter"],value:e})}},this.props)))},e}(s().Component);var T=n(35303),x=[{name:"每30分钟",id:18e5},{name:"每小时",id:36e5},{name:"每三小时",id:108e5}];const w=function(t){function e(e){e=t.call(this,e)||this;return e.onChange=function(e,t){},e.state={},e}return a()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.formRule,a=e.formPush,l=e.teamList,r=e.userList,c=e.formPushChange;return s().createElement("div",{className:"rule-edit"},s().createElement("h2",null,"推送规则设置"),s().createElement(u.Form,{ref:function(e){return t.form=e},model:a,rules:{},labelWidth:"100",className:"form"},s().createElement(u.Form.Item,{label:"推送成员",prop:"pass"},s().createElement("span",{className:"split_line",style:{paddingRight:"16px"}},"|"),s().createElement("ul",{className:"push_member"},s().createElement("li",null,s().createElement("span",null,"团队"),s().createElement("span",null,s().createElement(T.RS,{multiple:!0,tags:!1,onChange:function(e){return c({key:"receiverTeamIdList",value:e})},value:a.receiverTeamIdList,optionLabelProp:"label",optionFilterProp:"label"},l.map(function(e,t){return s().createElement(T.Wx,{key:t,value:e.id,label:e.name},e.name)})))),s().createElement("li",null,s().createElement("span",null,"用户"),s().createElement("span",null,s().createElement(T.RS,{multiple:!0,tags:!1,onChange:function(e){return c({key:"receiverUserIdList",value:e})},value:a.receiverUserIdList,optionLabelProp:"label",optionFilterProp:"label"},r.map(function(e,t){return s().createElement(T.Wx,{key:t,value:e.id,label:e.username},e.username)})))))),s().createElement(u.Form.Item,{label:"推送方式",prop:"pass"},s().createElement("span",null,"微信通知",s().createElement(m.Z,{overlay:s().createElement("div",{style:{lineHeight:"24px"}},"系统会给用户发送微信模板消息和",s().createElement("br",null),"系统提醒，如果接收提醒的用户没",s().createElement("br",null),"有绑定微信，系统会向其邮箱推送",s().createElement("br",null),"绑定微信的操作说明，按邮件说明",s().createElement("br",null),"操作即可。",s().createElement("br",null),"在“个人中心/个人资料”页面扫码",s().createElement("br",null),"绑定微信，即可接受预警通知。",s().createElement("br",null),s().createElement("a",{href:"/personalSettings/overview",target:"_black",style:{color:"#0847a6"}},"立即前往")),placement:"top"},s().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:"8px"}})))),1<n.ruleDetail.length&&s().createElement(u.Form.Item,{label:"合并推送",prop:"combined"},s().createElement(u.Radio.Group,{value:a.combined,onChange:function(e){return c({key:"combined",value:e})}},s().createElement(u.Radio,{value:!0},"是"),s().createElement(u.Radio,{value:!1},"否"))),s().createElement(u.Form.Item,{label:"预警间隔",prop:"pass"},s().createElement(u.Select,{value:a.interval,onChange:function(e){return c({key:"interval",value:e})}},x.map(function(e,t){return s().createElement(u.Select.Option,{key:e.id,label:e.name,value:e.id})})),s().createElement("span",{style:{paddingLeft:"12px"}},"更新数据计算")),s().createElement(u.Form.Item,{label:s().createElement("div",null,"免打扰",s().createElement(m.Z,{overlay:s().createElement("div",{style:{lineHeight:"24px"}},"只会在周一至周五的早上8：00~",s().createElement("br",null),"晚上10：00给用户推送预警提醒。",s().createElement("br",null),"在免打扰期间触发的预警会在早上",s().createElement("br",null),"8：00的时候集中推送给用户微信",s().createElement("br",null),"用户7天 x 24小时都会在微信收到",s().createElement("br",null),"触发的预警提醒"),placement:"top"},s().createElement("i",{className:"icon-cem_file1",style:{color:"#8c8c8c",marginLeft:"1px"}}))),prop:"checkPass"},s().createElement(u.Radio.Group,{value:a.workType,onChange:function(e){return c({key:"workType",value:e})}},s().createElement(u.Radio,{value:"weekday"},"工作时间"),s().createElement(u.Radio,{value:"all"},"全天候"))),s().createElement(u.Form.Item,{label:"重复提醒",prop:"repeatType"},s().createElement(u.Checkbox,{checked:a.repeatType,onChange:function(e){return c({key:"repeatType",value:e})},className:"checkbox-item",label:"单个监测指标触发预警后当天不再重复推送"}))))},e}(s().Component),R=function(t){function e(e){e=t.call(this,e)||this;return e.state={},e}return a()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.saveInfo,a=e.visible,l=e.onCancel,r=e.onConfirm,c=e.title,e=e.description;return s().createElement("div",{className:"warning_dialog"},s().createElement(u.Dialog,{title:"新建预警",size:"tiny",visible:a,onCancel:l,lockScroll:!1},s().createElement(u.Dialog.Body,null,s().createElement(u.Form,{ref:function(e){return t.form=e},rules:[],labelWidth:"100",className:"demo-ruleForm"},s().createElement(u.Form.Item,{label:s().createElement("span",{className:"require"},s().createElement("span",{style:{lineHeight:"18px",verticalAlign:"top",color:"#D96969"}},"*"),"预警名称")},s().createElement(u.Input,{value:c,onChange:function(e){50<e.length&&p.Z.error("预警名称最大长度为50字符"),n({title:String(e).substring(0,50)})}})),s().createElement(u.Form.Item,{label:"预警描述"},s().createElement(u.Input,{value:e,type:"textarea",onChange:function(e){200<e.length&&p.Z.error("预警描述最大长度为200字符"),n({description:String(e).substring(0,200)})}})))),s().createElement(u.Dialog.Footer,{className:"dialog-footer"},s().createElement(u.Button,{onClick:l},"取消"),s().createElement(u.Button,{type:"primary",onClick:r},"确定"))))},e}(s().Component),A=function(t){function e(e){var a=t.call(this,e)||this;return a.check=function(){var e=a.props,t=e.formRule,n=e.formPush,e=!1;return t.filterModel.analysis.id?t.filterModel.aspect.aspect1.length||t.filterModel.aspect.aspect2.length?"PERCENT"!==t.calType||t.min&&10<=t.min?t.ruleDetail.some(function(e){return!e.value||!String(e.value).trim()})?e="请为每一个指标输入预警阀值":n.receiverTeamIdList.length||n.receiverUserIdList.length||(e="推送成员请至少选取一项进行推送"):e="请填写负面声量最小值，且该值最小为10":e="请至少选择一项监测指标":e="请选择预警对象",!e||(p.Z.error(e),!1)},a.submit=function(){a.props.title?a.props.submit().then(function(e){e&&2e4===e.data.code&&setTimeout(function(){return c.mW.push("/account/project/alert")},0)}):p.Z.error("请填写预警名称")},a.onComfirm=function(){a.check()&&(a.props.isEdit?a.props.update({id:a.props.location.state.id}).then(function(e){2e4===e.data.code&&setTimeout(function(){return c.mW.push("/account/project/alert")},0)}):a.setState({show:!0}))},a.state={show:!1},a}return a()(e,t),e.prototype.render=function(){var e=this,t=this.props.loading;return s().createElement("div",{className:"warning_edit_page_view"},s().createElement(r.Z,{title:(0,i.uT)({title:"预警设置"})}),s().createElement("div",{className:"rule_wrap"},s().createElement(u.Loading,{loading:t,style:{minHeight:"100%"}},!t&&s().createElement(I,this.props),!t&&s().createElement(w,this.props))),s().createElement("div",{className:"bottom"},s().createElement(u.Button,{type:"primary",onClick:this.onComfirm},"确定"),s().createElement(u.Button,{onClick:function(){return c.mW.push("/account/project/alert")}},"取消")),s().createElement(R,o()({visible:this.state.show,onCancel:function(){return e.setState({show:!1})},onConfirm:this.submit},this.props)))},e}(s().Component);var L=n(64396).Z.project.warningEdit,n=function(n){function e(e){var t=n.call(this,e)||this;return t.routerWillLeave=function(){return!t.props.changed||"信息还未保存，确认要离开？"},t.state={loading:!0,projectId:k.t.get(k.V.backProjectConfig).id,modelState:JSON.parse(JSON.stringify(e.state))},t}a()(e,n);var t=e.prototype;return t.componentDidMount=function(){var t=this;this.props.fetchUserList(),this.props.location.state&&this.props.location.state.id?(setTimeout(function(e){return t.props.getWarning({id:t.props.location.state.id}).then(function(e){t.setState({loading:!1})})},500),this.props.saveInfo({isEdit:!!this.props.location.state.edit})):(this.props.saveInfo({isEdit:!1}),this.setState({loading:!1})),this.props.router.setRouteLeaveHook(this.props.route,this.routerWillLeave)},t.componentWillUnmount=function(){this.props.saveInfo(o()({},this.state.modelState))},t.render=function(){return s().createElement(A,o()({},this.props,{loading:this.state.loading,projectId:this.state.projectId}))},e}(s().Component);const P=(0,t.connect)(function(e){var t=e.loading,e=l()(e,["loading"]);return o()({state:e[L]},e[L],{overviewLoading:t.effects[L+"/fetchOverviewData"]})},function(t){return{fetchUserList:function(e){return t({type:L+"/fetchUserList",payload:e})},getWarning:function(e){return t({type:L+"/getWarning",payload:e})},formRuleChange:function(e){return t({type:L+"/formRuleChange",payload:e})},analysisChange:function(e){return t({type:L+"/analysisChange",payload:e})},formPushChange:function(e){return t({type:L+"/formPushChange",payload:e})},saveInfo:function(e){return t({type:L+"/saveInfo",payload:e})},submit:function(e){return t({type:L+"/submit",payload:e})},update:function(e){return t({type:L+"/update",payload:e})}}})(n)},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(67154),p=n.n(a),l=n(37316),m=n.n(l),t=n(85354),r=n.n(t),a=n(67294),d=n.n(a),l=n(45697),t=n.n(l),l=n(94184),h=n.n(l),a=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,l=e.block,r=e.indeterminate,c=e.value,i=e.checked,o=e.defaultChecked,s=e.onChange,u=e.disabled,e=m()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),s={value:c,checked:i,defaultChecked:o,onChange:s,disabled:u},a=h()(t,((u={})[t+"-disabled"]=s.disabled,u[t+"-block"]=l,u[t+"-indeterminate"]=r,u),a);return d().createElement("label",p()({tabIndex:s.disabled?-1:0,className:a},e),d().createElement("input",p()({type:"checkbox",className:t+"-input"},s)),d().createElement("span",{className:t+"-status"}),n&&d().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const c=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>i});var a=n(24473),l=n(67154),o=n.n(l),r=n(37316),s=n.n(r),t=n(85354),c=n.n(t),l=n(67294),u=n.n(l),r=n(45697),t=n.n(r),r=n(94184),p=n.n(r),r=function(l){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=l.call.apply(l,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return c()(e,l),e.prototype.render=function(){var l=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,r=(e.onChange,e.values),c=e.checkedList,i=e.block,e=s()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=r?r.map(function(e,t){var n=0!==c.length&&-1!==c.indexOf(e);return u().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return l.handleCheckBoxChange(e)},block:i},e)}):u().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==c.length&&-1!==c.indexOf(a);return u().cloneElement(e,{checked:a,key:t,block:n.block||i,onChange:function(){var e=n.value;l.handleCheckBoxChange(e)}})}});return u().createElement("div",o()({className:p()(t,a)},e),n)},e}(l.Component);r.defaultProps={prefixCls:"wt-checkbox-group"},r.propTypes={onChange:t().func,values:t().array,block:t().bool};const i=r;var m=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},l=function(e){function t(){return e.apply(this,arguments)||this}return c()(t,e),t.prototype.render=function(){var e=this.props,t=m(e);return u().createElement("label",{className:e.className,title:e.children},u().createElement("div",{className:"checkbox"},u().createElement("input",o()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),u().createElement("div",{className:"checkbox-body"}))," ",u().createElement("span",null,e.children))},t}(l.Component);l.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}}}]);