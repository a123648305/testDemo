(self.webpackChunkyunting=self.webpackChunkyunting||[]).push([[822],{55003:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P});var a=n(37316),i=n.n(a),r=n(67154),c=n.n(r),t=n(85354),l=n.n(t),a=n(67294),f=n.n(a),r=n(55609),g=n(92360),u=n(55815),t=n(45697),a=n.n(t);const d=function(e){var n=e.leftName,a=e.data,t=e.checkedList,i=e.onChange,r=a.length===t.length,l=f().useState(r),e=l[0],o=l[1];return f().useEffect(function(){o(r)},[t]),f().createElement("div",{className:"checkbox-list-wrapper"},f().createElement(g.Checkbox,{className:"checkbox-item",checked:e,onChange:function(e){var t=e?a:[];o(!0),i(((e={})[n]=t,e))}},"全选"),f().createElement(g.Checkbox.Group,{value:t,onChange:function(e){var t;o(e.length===a.length),i(((t={})[n]=e,t))}},a.map(function(e){return f().createElement(g.Checkbox,{key:e,label:e,className:"checkbox-item"})})))};t=function(n){function e(e){var i=n.call(this,e)||this;i._setPadShowFalse=function(){i.state.show&&i.setState({show:!1,tmpValue:{}})},i._setEvent=function(e){return 0===e?{onMouseEnter:function(){i.setState({firstLiHover:!0})},onMouseLeave:function(){i.setState({firstLiHover:!1})}}:{}},i._handleOnClick=function(e){var t=i.state,n=t.show,a=t.conValue;n&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),setTimeout(function(){i.setState({show:!n,tmpValue:n?{}:JSON.parse(JSON.stringify(a))})},0)},i._handleOnLeftClick=function(e){setTimeout(function(){i.setState({selLeftName:e})},0)},i._handleOnCheckboxChange=function(e){var t=i.state.tmpValue;i.setState({tmpValue:c()({},t,JSON.parse(JSON.stringify(e)))})};var t=e.data?Object.keys(e.data):[],e=t.reduce(function(e,t){return c()({},e,((e={})[t]=[],e))},{});return i.state={show:!1,dataKeys:t,selLeftName:void 0,conValue:e,tmpValue:{}},i}l()(e,n);var t=e.prototype;return t.componentDidMount=function(){window.addEventListener("click",this._setPadShowFalse)},t.componentWillUnmount=function(){window.removeEventListener("click",this._setPadShowFalse)},t.componentDidUpdate=function(e){var t=e.data,n=e.value,a=this.props,e=a.data,a=a.value;JSON.stringify(t)!==JSON.stringify(e)&&(e=(t=Object.keys(e)||[]).reduce(function(e,t){return c()({},e,((e={})[t]=[],e))},{}),this.setState({dataKeys:t,conValue:e})),JSON.stringify(n)!==JSON.stringify(a)&&this.setState({conValue:c()({},this.state.conValue,a),selLeftName:Object.keys(a)[0]})},t.render=function(){var t=this,e=this.props,n=e.preTitle,a=e.data,i=e.onConfirm,r=this.state,l=r.show,e=r.selLeftName,o=r.tmpValue,c=r.conValue,r=r.dataKeys,s=e||r[0],e=0<r.length?r.reduce(function(e,t){return e+c[t].join(",")},""):"数据为空";return f().createElement("div",{className:"simple-multi-select-wrapper",onClick:this._handleOnClick},f().createElement("span",{className:"trigger "+(l?"sel":"")},f().createElement("span",{className:"pre-title"},n,":"),f().createElement("span",{className:"title"},e||"全部"),f().createElement("i",{className:"icon-cem_arrow-launches",style:{transform:l?"rotate(-180deg)":""}})),f().createElement("div",{className:"panel "+(l?"active":""),onClick:function(e){e.stopPropagation(),e.nativeEvent&&e.nativeEvent.stopImmediatePropagation()}},s&&l?f().createElement(f().Fragment,null,f().createElement("span",{className:"left"},r.map(function(e){return f().createElement("div",{className:"item "+(s===e?"sel":""),key:e,onClick:function(){t._handleOnLeftClick(e)}},f().createElement("span",null,e,0<o[e].length&&f().createElement("i",{className:"icon-cem_large-screening",style:{marginLeft:5}})),f().createElement("i",{className:"icon-cem_arrow-thick"}))})),f().createElement("span",{className:"right"},f().createElement(d,{leftName:s,data:a[s],checkedList:o[s]||[],onChange:this._handleOnCheckboxChange}))):f().createElement("div",{style:{width:"100%",height:250,display:"flex",justifyContent:"center",alignItems:"center",color:"#bfbfbf"}},"数据为空"),f().createElement("span",{className:"bottom"},f().createElement(g.Button,{type:"primary",onClick:function(){var e=JSON.parse(JSON.stringify(o));t.setState({show:!1,tmpValue:{},conValue:e}),i&&i(e)}},"确定"),f().createElement(g.Button,{onClick:this._setPadShowFalse},"取消"))))},e}(f().PureComponent);const o=t;t.propTypes={preTitle:a().string.isRequired,data:a().object.isRequired,value:a().object,onConfirm:a().func};function s(e,t,n){return f().createElement("div",{className:"message-rule-content-overlay-wrapper"},f().createElement("div",{className:"content-overlay-title"},e),n.map(function(e){return f().createElement("div",{className:"content-overlay-item",key:e},f().createElement("span",{className:"content-overlay-item-type"},e),f().createElement("span",{className:"content-overlay-item-content"},t[e].join("，")))}),t["内容"]&&f().createElement("div",{className:"content-overlay-item"},f().createElement("span",{className:"content-overlay-item-type"},"组合规则"),f().createElement("span",{className:"content-overlay-item-content"},f().createElement("span",{className:"content-list-type"},"内容"),f().createElement("span",{className:"content-list-value"},t["内容"].map(function(e){return f().createElement("span",{key:e},e)})))))}function m(e,t,n,a){if("rule"===t)return f().createElement("div",{key:e,className:"column-item"},f().createElement("span",{className:"column-item-type"},e),f().createElement("span",{className:"column-item-content"},a));var i=(0,h.rV)(""+e+a)+12,r=n-35-36,n=r-(0,h.rV)(e)-12;return f().createElement("div",{key:e,className:"column-item-single"},f().createElement("span",{className:"column-item-type"},e),f().createElement("span",{style:{display:"inline-flex"}},f().createElement("span",{className:"column-item-content",style:{maxWidth:n}},a),r<i&&f().createElement(p.Z,{overlay:"recipient"===t?(i=e,t=a,f().createElement("div",{className:"message-rule-content-overlay-wrapper"},f().createElement("div",{className:"content-overlay-title"},i),f().createElement("div",null,t))):(e=e,a=a,f().createElement("div",{className:"message-rule-content-overlay-wrapper"},f().createElement("span",{style:{color:"#8c8c8c"}},"标签类型："),f().createElement("span",null,e+"， "),f().createElement("span",{style:{color:"#8c8c8c"}},"标签："),f().createElement("span",null,a))),placement:"top"},f().createElement("span",{className:"content-item-detail"},"详情"))))}var p=n(43036),h=n(17945);const v=function(e){var r=e.data,l=e.propType,o=e.maxWidth,t=e.height,c=Object.keys(r).filter(function(e){return"内容"!==e}),e=["无"];return r["内容"]&&0<r["内容"].length&&JSON.stringify(e)!==JSON.stringify(r["内容"])&&(5<r["内容"].length?(e=r["内容"].slice(0,4)).push("..."):e=r["内容"]),f().createElement("div",{className:"column-type-wrapper",style:{height:t}},c.map(function(e,t,n){var a="rule"===l?3:4,i=r[e]?r[e].join("，"):"";return n.length<a||("rule"===l?0===t:t<3)?m(e,l,o,i):("rule"===l?1===t:3===t)?f().createElement("div",{key:t},f().createElement("span",{style:{color:"#8c8c8c"}},"..."),"tag"===l&&f().createElement(p.Z,{overlay:s("标签",r,c),placement:"top"},f().createElement("span",{className:"content-item-detail"},"详情"))):null}),r["内容"]&&f().createElement("div",{className:"column-item"},f().createElement("span",{className:"column-item-type item-"+l},"内容"),f().createElement("span",{className:"column-item-content"},e.map(function(e,t,n){return f().createElement("span",{className:"content-item",key:""+e+t},e)}))),"rule"===l&&f().createElement(p.Z,{overlay:s("消息处理规则",r,c),placement:"top"},f().createElement("span",{className:"content-item-detail"},"详情")))};var E=f().createContext({contentWidth:0});const y=function(e){var t=e.data,n=t.status,a=t.history,i=e.id,r=e.height,e=f().useState("Enable"===n),l=e[0],o=e[1];return f().useEffect(function(){o("Enable"===n)},[n]),f().createElement(E.Consumer,null,function(e){var t=e.onDialogOpen,n=e.onEditTriggerClick;return f().createElement("div",{className:"control-item-wrapper",style:{height:r}},f().createElement(p.Z,{overlay:l?"开启":"关闭",placement:"top"},f().createElement("span",null,f().createElement(g.Switch,{value:l,onText:"",offText:"",onColor:"#0747A6",offColor:"#8c8c8c",onChange:function(e){t({type:l?"stop":"open",id:i,history:"Enable"===a,callback:function(){o(!e)}})}}))),f().createElement("span",{onClick:function(e){n({id:i})}},"编辑"),f().createElement("span",{onClick:function(){t({type:"delete",id:i})}},"删除"))})};var C=n(37841),k=[{key:"全部",value:null},{key:"启用",value:"Enable"},{key:"停用",value:"Disable"}];const b=function(e){var t=e.ruleDatas,a=e.tagData,n=e.recipientData,i=e.onFilterChange,r=(e.onEditTriggerClick,e.selTagData),e=e.filterObj.status;return f().createElement("div",{className:"message-rule-list-wrapper"},f().createElement("div",{className:"button-top",style:{height:"58px"}},f().createElement("span",{className:"button-left"},f().createElement(o,{preTitle:"标签",data:a.options,value:r,onConfirm:function(n){var e=Object.keys(n).reduce(function(e,t){return[].concat(e,n[t].map(function(e){return a.dictionary[e]}))},[]);i({tagIdList:e})}}),f().createElement(o,{preTitle:"接收成员",data:n.options,onConfirm:function(e){var t=e["团队"].map(function(e){return n.dictionary[e]}),e=e["成员"].map(function(e){return n.dictionary[e]});i({teamIdList:t,userIdList:e})}}),f().createElement(C.Z,{activeKey:e,options:k,onTabClick:function(e){return i({status:e})}}))),f().createElement(E.Consumer,null,function(e){var a,i,e=e.contentWidth;return f().createElement(g.Table,{style:{width:"100%",zIndex:0,marginTop:10,minHeight:500},columns:[{label:"",width:48},{label:"消息处理规则",prop:"rule",minWidth:.4*(i=e-24-32-96-180),render:function(e,t,n){return f().createElement(v,{height:24*a[n].ruleLine+20,data:a[n][t.prop],propType:t.prop,maxWidth:.4*i})}},{label:"接收成员",prop:"recipient",minWidth:.3*i,render:function(e,t,n){return f().createElement(v,{height:24*a[n].ruleLine+20,data:a[n][t.prop],propType:t.prop,maxWidth:.3*i})}},{label:"标签",prop:"tag",minWidth:.2*i,render:function(e,t,n){return f().createElement(v,{height:24*a[n].ruleLine+20,data:a[n][t.prop],propType:t.prop,maxWidth:.2*i})}},{label:"操作",width:180,render:function(e,t,n){return f().createElement(y,{height:24*a[n].ruleLine+20,data:{status:a[n].status,history:a[n].history},id:e.id})}},{label:"",width:48}],data:a=t,className:"rule-list-table"})}))};var N={delete:{title:"是否仍要删除该规则？",type:"warning",body:"删除规则后，基于该规则对消息已经打上的标签将会保留。如果要删除标签，请使用标签管理功能。"},stop:{title:"是否仍要停用该规则？",type:"warning",body:"停用后新的消息将不会被本规则处理，但基于该规则对消息已经打上的标签将会保留。如果要删除标签，请使用标签管理功能。"},open:{title:"是否启用该规则？",type:"warning",body:"启用规则后，符合本规则的新消息会被打上相应的标签并 转发给目标收件人。"},leave:{title:"是否仍要离开该页面？",type:"warning",body:"您离开该页面，您输入的数据可能不会被保存"},created:{title:"消息处理规则创建成功",type:"success",body:"规则立即生效\n历史数据将稍后的几分钟内完成标签化工作，但是不会分发消息"},edited:{title:"消息处理规则保存成功",type:"success",body:"规则立即生效\n首先会将该规则的历史标签清除，在稍后的几分钟内完成新的标签化工作，但是不会分发消息"},editNoChecked:{title:"提示",type:"error",body:'"标记标签"和"消息分配给"至少选定一个'},contentInvalid:{title:"提示",type:"error",body:"过滤条件中存在内容规则为空"},filterEmpty:{title:"提示",type:"error",body:"过滤条件不能为空"},tagCheckedEmpty:{title:"提示",type:"error",body:'选定"标记标签"后内容不能为空'},teamCheckedEmpty:{title:"提示",type:"error",body:'选定"消息分配给"后内容不能为空'}};const O=function(n){function e(e){var t=n.call(this,e)||this;return t.showDialog=function(e){t.state.visible?t.setState({visible:!1},function(){return t.setState(c()({history:!1,visible:!0,callback:void 0,cancelCallback:void 0},e))}):t.setState(c()({history:!1,visible:!0,callback:void 0,cancelCallback:void 0},e))},t.state={visible:!1,type:"",id:"",history:!1,callback:void 0,cancelCallback:void 0},t}return l()(e,n),e.prototype.render=function(){var t=this,e=this.state,n=e.visible,a=e.type,i=e.id,r=e.callback,l=e.history,o=e.cancelCallback,e=this.props,c=e.onConfirm,s=e.onCancel,e=a?N[a].body:"";return f().createElement(g.Dialog,{className:"simple-dialog-wrapper simple-dialog-"+(a?N[a].type:""),closeOnClickModal:!1,title:a?N[a].title:"",visible:n,onCancel:function(){return t.setState({visible:!1})},size:"tiny"},f().createElement(g.Dialog.Body,null,f().createElement("div",{className:"dialog-body"},f().createElement("div",{style:{display:e?"block":"none"}},e.split("\n").map(function(e){return f().createElement("p",{key:e},e)})),"open"===a&&f().createElement("div",null,f().createElement(g.Checkbox,{checked:l,onChange:function(e){t.setState({history:e})}},"对满足此规则的历史消息打上标签")))),f().createElement(g.Dialog.Footer,null,f().createElement("div",null,"created"===a||"edited"===a||"editNoChecked"===a||"editFilterEmpty"===a||"contentInvalid"===a||"filterEmpty"===a||"tagCheckedEmpty"===a||"teamCheckedEmpty"===a?f().createElement(g.Button,{type:"primary",onClick:function(){t.setState({visible:!1,type:"",id:""}),c&&c({type:a,id:i,history:l}),r&&r()}},"确定"):f().createElement(f().Fragment,null,f().createElement(g.Button,{type:"primary",onClick:function(){t.setState({visible:!1,id:"",type:""},function(){c&&c({type:a,id:i,history:l}),r&&r()})}},"确定"),f().createElement(g.Button,{onClick:function(){t.setState({visible:!1,id:"",type:""}),s&&s({type:a,id:i,history:l}),o&&o()}},"取消")))))},e}(f().PureComponent);var R=n(35303),S=n(83425),_=n(58992);const L=function(t){function e(e){var r=t.call(this,e)||this;return r.getValue=function(){return new Promise(function(t,n){var a=r.filterConditionRef?r.filterConditionRef.getValue():[],i=r.contentRef?r.contentRef.getValue():[];0<i.length?r.contentRef.formRef.validate(function(e){e?t(c()({},(0,h._l)(a),{content:i})):n("contentInvalid")}):0<a.length?t(c()({},(0,h._l)(a))):n("filterEmpty")})},r.filterConditionRef=void 0,r.getContentRef=void 0,r}return l()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.filter,e=e.content;return f().createElement(f().Fragment,null,f().createElement(S.Z,{ref:function(e){return t.filterConditionRef=e},style:{display:"block"},type:"PRICE_WARNING",value:n,filter:["MESSAGE_RELATION","CONN_CONFIG"],filterConfig:["ESCORE","messageType"],noBottom:!0,moreFilterPosition:"top",hideAdvanced:!0}),f().createElement("div",{className:"dashed-divider"}),f().createElement(_.Z,{value:e,ref:function(e){return t.contentRef=e}}))},e}(f().PureComponent);const D=function(e){var t=e.conditionList,n=(t.tagList,t.userList),a=t.teamList,i=e.tagData,r=e.handleOnConfirm,l=e.handleOnCancel,o=e.getFilterRef,c=e.handleOnCommonChange,s=e.loading,u=e.filter,d=e.tagValues,m=e.teamValues,p=e.userValues,h=e.isTagChecked,t=e.contentValues,e=e.isDiliverChecked;return f().createElement("div",{className:"message-rule-edit-view-wrapper"},f().createElement(g.Loading,{loading:s,style:{height:"100%"}},f().createElement(f().Fragment,null,f().createElement("div",{className:"edit-top"},f().createElement("span",{className:"edit-top-title"},"设置各种过滤条件，以方便对消息进行分类或处理")),f().createElement("div",{className:"solid-divider"}),f().createElement("div",{className:"edit-rule"},f().createElement(L,{ref:o,filter:u,content:t}))),f().createElement("div",{className:"zone-divider"}),f().createElement(f().Fragment,null,f().createElement("div",{className:"edit-top"},f().createElement("span",{className:"edit-top-title"},"满足以上条件时，则执行以下操作")),f().createElement("div",{className:"solid-divider"}),f().createElement("div",{className:"edit-item"},f().createElement("span",null,f().createElement(g.Checkbox,{checked:h,onChange:function(e){return c("isTagChecked",e)}},"标记标签")),f().createElement("span",null,f().createElement(R.RS,{multiple:!0,tags:!0,value:d,onChange:function(e){return c("tagValues",e)}},Object.keys(i.options).map(function(e){return f().createElement(R.Ph.OptGroup,{label:e,key:e},i.options[e].map(function(e){return f().createElement(R.Wx,{key:e,label:e,value:e},e)}))})))),f().createElement("div",{className:"edit-diliver",style:{marginBottom:"40px"}},f().createElement("span",null,f().createElement(g.Checkbox,{checked:e,onChange:function(e){return c("isDiliverChecked",e)}},"消息分配给")),f().createElement("span",null,f().createElement("div",{className:"edit-item"},f().createElement("span",null,"团队"),f().createElement("span",null,f().createElement(R.RS,{multiple:!0,tags:!0,value:m,onChange:function(e){return c("teamValues",e)}},a.map(function(e){return f().createElement(R.Wx,{key:e.id,label:e.name,value:e.name},e.name)})))),f().createElement("div",{className:"edit-item"},f().createElement("span",null,"用户"),f().createElement("span",null,f().createElement(R.RS,{multiple:!0,tags:!0,value:p,onChange:function(e){return c("userValues",e)}},n.map(function(e){return f().createElement(R.Wx,{key:e.id,label:e.name,value:e.name},e.name)}))))))),f().createElement("div",{className:"button-zone",style:{padding:"10px 24px",width:"100%"}},f().createElement("span",{className:"rigth"},f().createElement(g.Button,{type:"primary",onClick:r},"保存"),f().createElement(g.Button,{onClick:l},"取消")))))};var w=n(35239),t=n(64396),I=t.Z.project.messageRule,a=function(o){function e(e){var y=o.call(this,e)||this;y._handleEvent=function(e){e&&"filter-list"===e.key&&y.setState({loading:!1})},y._checkValidateValue=function(e,n){return e.reduce(function(e,t){return e&&!!n.find(function(e){return e.name===t})},!0)},y._handleOnCommonChange=function(e,t){var n=y.state,a=n.isDiliverChecked,i=n.isTagChecked,r=n.userValues,l=n.tagValues,o=n.teamValues,c=y.props.conditionList,s=c.tagList,n=c.userList,c=c.teamList;"tagValues"===e&&!y._checkValidateValue(t,s)||"userValues"===e&&!y._checkValidateValue(t,n)||"teamValues"===e&&!y._checkValidateValue(t,c)||y.setState(((l={isDiliverChecked:"userValues"===e||"teamValues"===e?0<t.length:a,isTagChecked:"tagValues"===e?0<t.length:i,userValues:"isDiliverChecked"!==e||t?r:[],teamValues:"isDiliverChecked"!==e||t?o:[],tagValues:"isTagChecked"!==e||t?l:[]})[e]=t,l))},y._handleOnConfrim=function(){var e=y.props,i=e.onDialogOpen,t=e.conditionList,r=t.tagList,l=t.userList,o=t.teamList,t=e.editData,c=t.id,s=t.history,u=e.addRule,d=e.updateRule,m=e.filterObj,e=y.state,p=e.isDiliverChecked,h=e.isTagChecked,f=e.teamValues,g=e.tagValues,v=e.userValues,E=e.projectId;p||h?h&&0===g.length?i({type:"tagCheckedEmpty"}):p&&0===v.length&&0===f.length?i({type:"teamCheckedEmpty"}):y.filterRef&&y.filterRef.getValue().then(function(e){var t=h?g.map(function(t){var e=r.find(function(e){return e.name===t});return e?e.id:t}):[],n=p?v.map(function(t){var e=l.find(function(e){return e.name===t});return e?e.id:t}):[],a=p?f.map(function(t){var e=o.find(function(e){return e.name===t});return e?e.id:t}):[];c?d({id:c,projectId:E,filterModel:e,teamIdList:a,tagIdList:t,userIdList:n,history:s,onDialogOpen:i,filterObj:m}):u({projectId:E,filterModel:e,tagIdList:t,teamIdList:a,userIdList:n,onDialogOpen:i,filterObj:m})}).catch(function(e){i({type:e})}):i({type:"editNoChecked"})},y._handleOnCancel=function(){var e=y.props,t=e.onEditTriggerClick;(0,e.onDialogOpen)({type:"leave",callback:function(){t(void 0)}})},y.filterRef=void 0;var t=e.editData,n=t.filter,a=t.tagList,i=t.teamList,r=t.userList,l=n&&n.content||void 0,e=a&&a.map(function(e){return e.name})||[],t=i&&i.map(function(e){return e.name})||[],a=r&&r.map(function(e){return e.name})||[],i=0<e.length,r=0<t.length||0<a.length;return y.state={projectId:w.t.get(w.V.backProjectConfig).id,filter:n?(0,h.Bd)(n):[],tagValues:e,teamValues:t,userValues:a,isTagChecked:i,contentValues:l,isDiliverChecked:r,loading:!0},y.events={getFilterRef:function(e){return y.filterRef=e},handleOnCommonChange:y._handleOnCommonChange,handleOnConfirm:y._handleOnConfrim,handleOnCancel:y._handleOnCancel},y}l()(e,o);var t=e.prototype;return t.componentDidMount=function(){window.addEventListener("setItemEvent",this._handleEvent)},t.componentWillUnmount=function(){window.removeEventListener("setItemEvent",this._handleEvent)},t.render=function(){return f().createElement(D,c()({},this.props,this.state,this.events))},e}(f().PureComponent);const j=(0,r.connect)(function(e){c()({},e);return{}},function(t){return{addRule:function(e){return t({type:I+"/addRule",payload:e})},updateRule:function(e){return t({type:I+"/updateRule",payload:e})}}})(a);const T=function(e){var t=e.headerTitle,n=e.onDialogConfirm,a=e.getDialogRef,i=e.editData,r=e.onDialogCancel,l=e.loading,o=e.onBreadcrumbBeforeJump,c=e.onEditTriggerClick,s=document.documentElement.clientHeight-46-78-24;return f().createElement("div",{className:"message-rule-wrapper"},f().createElement(u.Z,{title:t,beforeJump:i?o:void 0,rightContent:i?null:f().createElement(g.Button,{type:"primary",onClick:function(e){return c({})}},"创建规则")}),f().createElement("div",{className:"content",id:"message-rule-content"},f().createElement("div",{style:{minHeight:s,backgroundColor:"#fff",padding:"16px",marginBottom:i?46:""}},f().createElement(g.Loading,{loading:l,style:{height:"100%"}},void 0===i?f().createElement(b,e):f().createElement(j,e)))),f().createElement(O,{onConfirm:n,onCancel:r,ref:a}))};var V=n(13713),x=t.Z.project.messageRule,t=function(t){function e(e){var l=t.call(this,e)||this;return l._handleWindowResize=function(){var e=document.getElementById("message-rule-content").offsetWidth;l.setState({contentWidth:e})},l._handleWindowPoststate=function(e){e.preventDefault(),e.stopImmediatePropagation(),l.state.editData||l._handleOnDialogOpen({type:"leave"})},l._handleOnFilterChange=function(e){var t=l.state.filterObj,n=l.props.fetchRuleList,a=c()({},t,e);l.setState({filterObj:a},function(){n(a)})},l._handleOnDialogConfirm=function(e){var t=l.props,n=t.updateHistoryRule,a=t.deleteRule,i=t.setRuleStatus,r=l.state.filterObj;switch(e.type){case"edited":case"created":l._handleOnEditTriggerClick(void 0),n({projectId:r.projectId,id:e.id,history:e.history?"Enable":"Disable",filterObj:r});break;case"delete":a({projectId:r.projectId,id:e.id,filterObj:r});break;case"stop":i({projectId:r.projectId,id:e.id,history:e.history?"Enable":"Disable",status:"Disable",filterObj:r});break;case"open":i({projectId:r.projectId,id:e.id,history:e.history?"Enable":"Disable",status:"Enable",filterObj:r});break;case"leave":l._handleOnEditTriggerClick(void 0)}},l._handleOnDialogCancel=function(e){var t=l.props.fetchRuleList,n=l.state.filterObj;"created"===e.type&&(l._handleOnEditTriggerClick(void 0),t({projectId:n.projectId}))},l._handleOnDialogOpen=function(e){l.simpleDialogRef.showDialog(e)},l._handleOnEditTriggerClick=function(t){var e=l.state.headerTitle,n=l.props.ruleList,n=t?0<Object.keys(t).length?n.find(function(e){return e.id===t.id}):{}:void 0;n?(e.push({title:n.id?"修改规则":"创建规则",url:""}),l.setState({editData:n,headerTitle:e})):l.setState({editData:n,headerTitle:(0,V.u)({title:"消息处理规则",url:"/account/project/messageRule"})})},l._handleOnBreadcrumbBeforeJump=function(e,t){l._handleOnDialogOpen({type:"leave",callback:function(){l._handleOnEditTriggerClick(void 0)}})},l.simpleDialogRef=void 0,l.filterConditionRef=void 0,l.state={headerTitle:(0,V.u)({title:"消息处理规则",url:"/account/project/messageRule"}),contentWidth:0,selTagData:{},filterObj:{projectId:w.t.get(w.V.backProjectConfig).id,status:null,tagIdList:[],teamIdList:[],userIdList:[]},editData:void 0,loading:!0},l.events={getDialogRef:function(e){return l.simpleDialogRef=e},onFilterChange:l._handleOnFilterChange,onDialogConfirm:l._handleOnDialogConfirm,onDialogCancel:l._handleOnDialogCancel,onDialogOpen:l._handleOnDialogOpen,onEditTriggerClick:l._handleOnEditTriggerClick,onBreadcrumbBeforeJump:l._handleOnBreadcrumbBeforeJump},l}l()(e,t);var n=e.prototype;return n.componentDidMount=function(){(0,this.props.fetchCondition)({projectId:this.state.filterObj.projectId}),window.addEventListener("resize",this._handleWindowResize),window.addEventListener("popstate",this._handleWindowPoststate),this._handleWindowResize()},n.componentDidUpdate=function(e){var t=this,n=this.state.filterObj,a=this.props,i=a.fetchRuleList,r=a.location,l=a.conditionList;!this.props.fetchConditionEffecting&&e.fetchConditionEffecting&&(r=(a=r.state&&r.state.tagIdList||[]).reduce(function(e,t){var n=l.tagList.find(function(e){return e.id===t});return n&&(e[n.value]||(e[n.value]=[]),e[n.value].push(n.name)),e},{}),this.setState({selTagData:r,filterObj:c()({},n,{tagIdList:a})},function(){return i(t.state.filterObj)})),!this.props.ruleListEffecting&&e.ruleListEffecting&&this.setState({loading:!1})},n.componentWillUnmount=function(){window.removeEventListener("resize",this._handleWindowResize)},n.render=function(){return f().createElement(E.Provider,{value:{contentWidth:this.state.contentWidth,onDialogOpen:this._handleOnDialogOpen,onEditTriggerClick:this._handleOnEditTriggerClick}},f().createElement(T,c()({},this.props,this.state,this.events)))},e}(f().PureComponent);const P=(0,r.connect)(function(e){var t=e.loading,e=i()(e,["loading"]);return c()({},e[x],{ruleListEffecting:t.effects[x+"/fetchRuleList"],fetchConditionEffecting:t.effects[x+"/fetchCondition"]})},function(t){return{fetchRuleList:function(e){return t({type:x+"/fetchRuleList",payload:e})},fetchCondition:function(e){return t({type:x+"/fetchCondition",payload:e})},updateHistoryRule:function(e){return t({type:x+"/updateHistoryRule",payload:e})},deleteRule:function(e){return t({type:x+"/deleteRule",payload:e})},setRuleStatus:function(e){return t({type:x+"/setRuleStatus",payload:e})}}})(t)},13713:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var a=n(35239),i=function(e){var t=e.title,e=e.url;return[{title:"所有项目",url:"/account/project"},{title:a.t.get(a.V.backProjectConfig).name,url:"/account/project/preview"},{title:t,url:e}]}},24473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(67154),d=n.n(a),i=n(37316),m=n.n(i),t=n(85354),r=n.n(t),a=n(67294),p=n.n(a),i=n(45697),t=n.n(i),i=n(94184),h=n.n(i),a=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){var e=this.props,t=e.prefixCls,n=e.children,a=e.className,i=e.block,r=e.indeterminate,l=e.value,o=e.checked,c=e.defaultChecked,s=e.onChange,u=e.disabled,e=m()(e,["prefixCls","children","className","block","indeterminate","value","checked","defaultChecked","onChange","disabled"]),s={value:l,checked:o,defaultChecked:c,onChange:s,disabled:u},a=h()(t,((u={})[t+"-disabled"]=s.disabled,u[t+"-block"]=i,u[t+"-indeterminate"]=r,u),a);return p().createElement("label",d()({tabIndex:s.disabled?-1:0,className:a},e),p().createElement("input",d()({type:"checkbox",className:t+"-input"},s)),p().createElement("span",{className:t+"-status"}),n&&p().createElement("span",{className:t+"-text",title:n},n))},t}(a.Component);a.propTypes={prefixCls:t().string,value:t().oneOfType([t().string,t().number]),checked:t().bool,defaultChecked:t().bool,onChange:t().func,indeterminate:t().bool,disabled:t().bool,block:t().bool},a.defaultProps={prefixCls:"wt-checkbox"};const l=a},85151:(e,t,n)=>{"use strict";n.d(t,{Jg:()=>a.Z,CS:()=>o});var a=n(24473),i=n(67154),c=n.n(i),r=n(37316),s=n.n(r),t=n(85354),l=n.n(t),i=n(67294),u=n.n(i),r=n(45697),t=n.n(r),r=n(94184),d=n.n(r),r=function(i){function e(){for(var n,e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=i.call.apply(i,[this].concat(t))||this).handleCheckBoxChange=function(e){var t=n.props.onChange;t&&t(e)},n}return l()(e,i),e.prototype.render=function(){var i=this,e=this.props,t=e.prefixCls,n=e.children,a=e.className,r=(e.onChange,e.values),l=e.checkedList,o=e.block,e=s()(e,["prefixCls","children","className","onChange","values","checkedList","block"]),n=r?r.map(function(e,t){var n=0!==l.length&&-1!==l.indexOf(e);return u().createElement(Checkbox,{key:t,value:e,checked:n,onChange:function(e){return i.handleCheckBoxChange(e)},block:o},e)}):u().Children.map(n,function(e,t){if(e){var n=e.props,a=n.value,a=0!==l.length&&-1!==l.indexOf(a);return u().cloneElement(e,{checked:a,key:t,block:n.block||o,onChange:function(){var e=n.value;i.handleCheckBoxChange(e)}})}});return u().createElement("div",c()({className:d()(t,a)},e),n)},e}(i.Component);r.defaultProps={prefixCls:"wt-checkbox-group"},r.propTypes={onChange:t().func,values:t().array,block:t().bool};const o=r;var m=function(t){var n={};return Object.keys(t).forEach(function(e){/^data\-.+$/.test(e)&&(n[e]=t[e])}),n},i=function(e){function t(){return e.apply(this,arguments)||this}return l()(t,e),t.prototype.render=function(){var e=this.props,t=m(e);return u().createElement("label",{className:e.className,title:e.children},u().createElement("div",{className:"checkbox"},u().createElement("input",c()({checked:e.checked,type:"checkbox",name:e.name,onChange:e.onChange,disabled:e.disabled},t)),u().createElement("div",{className:"checkbox-body"}))," ",u().createElement("span",null,e.children))},t}(i.Component);i.defaultProps={className:"",name:"",checked:!1,disabled:!1,onChange:function(e){return e}}},58992:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var t=n(67154),l=n.n(t),t=n(85354),a=n.n(t),t=n(67294),g=n.n(t),v=n(92360),t=n(45697),t=n.n(t),E=n(2258),y=n.n(E),C=n(85151),k=[{label:"包含",value:"contain"},{label:"不包含",value:"notContain"}];const o=function(e){var r=e.ruleGroup,l=e.formRef,o=e.groupIdx,i=e.editable,c=e.onSelectChange,s=e.onInputChange,u=e.onRuleItemDelete,t=e.onRuleGroupDelete,n=e.onRuleItemAdd,a=e.onActiveRuleCheckChange,d=(0===r.contain.length||""===r.contain[0])&&0===r.notContain.length,m=g().useState(d),p=m[0],h=m[1],e=g().useState(""),d=e[0],f=e[1];g().useEffect(function(){var e,n;p||f((e=r.sentence,n=r,(e?"一句话中":"全文中")+"："+["contain","notContain"].reduce(function(e,t){return n[t]&&0<n[t].length?[].concat(e,[("contain"===t?"包含":"不包含")+n[t].map(function(e){return'<span style="color: #262626;">“'+e+"”</span>"}).join("，")]):e},[]).join("，且")))},[p]);m=r.contain.length+r.notContain.length,e=42*m+30+10;return g().createElement("div",{className:"content-rule-group"},g().createElement("div",{className:"content-rule-group-top"},g().createElement("span",{className:"show-icon",onClick:function(){var t,a,e,n,i;p?(t=r,a=o,e=l,n=["contain","notContain"].reduce(function(e,n){return[].concat(e,t[n].map(function(e,t){return"rule-"+a+"-"+n+"-"+t}))},[]),i=e[0],n=n.map(function(e){return new Promise(function(t,n){i?i.validateField(e,function(e){(null===e?t:n)()}):n()})}),Promise.all(n).then(function(){h(!1)})):h(!0)}},g().createElement("i",{className:"icon-cem_pull-or-take-up",style:{transform:"rotate("+(p?-180:0)+"deg)"}})),g().createElement("span",{className:"content-rule-group-title"},p?g().createElement("span",{className:"group-title-check"},g().createElement(C.Jg,{checked:r.sentence,onChange:function(e){e=e.currentTarget.checked;return a(o,e)}}),g().createElement("span",{style:{marginLeft:8}},"以下关键词出现在",g().createElement("span",{style:{color:"#262626"}},"“一句话”"),"中条件才生效?")):g().createElement("span",{dangerouslySetInnerHTML:{__html:d}})),g().createElement("span",{className:"group-delete",onClick:function(){return t(o)}},g().createElement("i",{className:"icon-cem_delete"}))),g().createElement("div",{className:"content-rule-group-list",style:{height:p?e:0,paddingTop:p?10:0}},g().createElement("div",{className:"group-list "+(1<m?"mulit-group-list":"")},g().createElement("span",{className:"list-left"},g().createElement("span",{style:{fontSize:14}},"且")),g().createElement("span",{className:"list-right"},["contain","notContain"].map(function(a){return r[a]&&r[a].map(function(e,t){var n="rule-"+o+"-"+a+"-"+t;return g().createElement("div",{key:n,className:"content-rule-group-item"},g().createElement("span",null,g().createElement(y(),{disabled:!i,value:k.find(function(e){return e.value===a}).label,onChange:function(e){return c(n,e)}},k.map(function(e){return g().createElement(E.Option,{key:e.value,title:e.label},e.label)}))),g().createElement("span",{style:{height:42}},g().createElement(v.Form.Item,{prop:n},g().createElement(v.Input,{disabled:!i,value:e,onChange:function(e){return s(n,e)}}))),i&&g().createElement("span",{onClick:function(){return u(n)}},g().createElement("i",{className:"icon-cem_delete"})))})}))),i&&g().createElement(g().Fragment,null,g().createElement("span",{className:"add-icon",onClick:function(){return n(o)}},g().createElement("i",{className:"icon-cem_add-to"})),g().createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"添加新的关键词"))))};var i={contain:[""],notContain:[],sentence:!0,id:Math.round(1e4*Math.random())},n=function(t){function e(e){var o=t.call(this,e)||this;o._handleOnRuleGroupAdd=function(){var e=o.state.content,e=[].concat(e,[JSON.parse(JSON.stringify(i))]);o.setState({content:e,formProps:o.getFormProps(e),hasChanged:!0})},o._handleOnRuleItemAdd=function(e){var t,n=o.state.content,a=o.props.onChange;n[e]&&((t=JSON.parse(JSON.stringify(n)))[e].contain||(t[e].contain=[]),t[e].contain.push(""),o.setState({content:t,formProps:o.getFormProps(t),hasChanged:!0},function(){return a&&a(t)}))},o._handleOnRuleItemDelete=function(e){var t,n,a,i,r;e&&(t=o.state.content,n=o.props.onChange,(i=e.split("-"))[0],a=i[1],e=i[2],i=i[3],t[a]&&t[a][e]&&void 0!==t[a][e][i]&&((r=JSON.parse(JSON.stringify(t)))[a][e].splice(i,1),0===r[a].contain.length&&0===r[a].notContain.length&&r.splice(a,1),o.setState({content:r,formProps:o.getFormProps(r),hasChanged:!0},function(){return n&&n(r)})))},o._handleOnSelecChange=function(e,t){var n,a,i,r,l;e&&t&&(n=o.state.content,a=o.props.onChange,(l=e.split("-"))[0],i=l[1],e=l[2],l=l[3],n[i]&&n[i][e]&&void 0!==n[i][e][l]&&(l=(r=JSON.parse(JSON.stringify(n)))[i][e].splice(l,1),r[i][t].push(l[0]),o.setState({content:r,formProps:o.getFormProps(r),hasChanged:!0},function(){return a&&a(r)})))},o._handleOnInputChange=function(e,t){var n,a,i,r,l;e&&(n=o.state.content,a=o.props.onChange,(r=e.split("-"))[0],i=r[1],e=r[2],r=r[3],n[i]&&n[i][e]&&void 0!==n[i][e][r]&&((l=JSON.parse(JSON.stringify(n)))[i][e][r]=t,o.setState({content:l,formProps:o.getFormProps(l),hasChanged:!0},function(){return a&&a(l)})))},o._handleOnActiveRuleCheckChange=function(e,t){var n,a=o.state.content,i=o.props.onChange;a[e]&&((n=JSON.parse(JSON.stringify(a)))[e].sentence=t,o.setState({content:n,hasChanged:!0},function(){return i&&i(n)}))},o._handleOnRuleGroupDelete=function(e){var t,n=o.state.content,a=o.props.onChange;!n[e]||(t=JSON.parse(JSON.stringify(n))).splice(e,1)&&o.setState({content:t,hasChanged:!0,formProps:o.getFormProps(t)},function(){return a&&a(t)})},o.getValue=function(){return o.state.content},o.hasChanged=function(){return o.state.hasChanged},o.getFormProps=function(e){var i={model:{},rules:{}};return e&&0<e.length&&e.forEach(function(e,a){e&&["contain","notContain"].forEach(function(n){e[n]&&e[n].forEach(function(e,t){t="rule-"+a+"-"+n+"-"+t;i.model[t]=e,i.rules[t]=[{required:!0,message:" ",trigger:"blur"}]})})}),i},o.mRefs=[],o.formRef=void 0;e=(e.value||[i]).map(function(e){return l()({},e,{id:Math.round(1e4*Math.random())})});return o.state={content:e,formProps:o.getFormProps(e),hasChanged:!1},o}a()(e,t);var n=e.prototype;return n.componentDidUpdate=function(e){var t=e.value,e=this.props.value;JSON.stringify(t)!==JSON.stringify(e)&&this.setState({content:e,formProps:this.getFormProps(e)})},n.render=function(){var n=this,e=this.state,t=e.content,a=e.formProps,i=this.props,e=i.editable,r=void 0===e||e,i=i.className,i=void 0===i?"":i;return g().createElement("div",{className:"content-rule-wrapper "+i},g().createElement("span",{className:"content-rule-title"},"内容"),g().createElement("div",{className:"content-rule"},g().createElement(v.Form,l()({},a,{ref:function(e){n.formRef=e,n.mRefs.splice(0,n.mRefs.length),n.mRefs.push(e)}}),0<t.length&&g().createElement("span",{className:"content-rule-hint"},"满足任意一组条件，该规则即生效"),t.map(function(e,t){return g().createElement(o,{key:e.id,formRef:n.mRefs,ruleGroup:e,groupIdx:t,editable:r,onSelectChange:n._handleOnSelecChange,onRuleGroupDelete:n._handleOnRuleGroupDelete,onInputChange:n._handleOnInputChange,onRuleItemDelete:n._handleOnRuleItemDelete,onRuleItemAdd:n._handleOnRuleItemAdd,onActiveRuleCheckChange:n._handleOnActiveRuleCheckChange})})),r&&g().createElement(g().Fragment,null,g().createElement("span",{className:"add-icon",onClick:this._handleOnRuleGroupAdd},g().createElement("i",{className:"icon-cem_add-to"})),g().createElement("span",{style:{marginLeft:8,color:"#262626",fontSize:14}},"添加新的条件"))))},e}(g().PureComponent);const r=n;n.propTypes={value:t().array,editable:t().bool,onChange:t().func,className:t().string}},37841:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var t=n(67294),i=n.n(t),t=n(45697),n=n.n(t),t=function(e){var n=e.activeKey,t=e.options,a=e.onTabClick;return i().createElement("div",{className:"tabs"},t.map(function(e,t){return i().createElement("div",{key:t,className:n===e.value?"active-tab":"",onClick:function(){return n!==e.value&&a(e.value,e)}},e.key||e.label)}))};t.propTypes={activeKey:n().oneOfType([n().string,n().number]),options:n().arrayOf(n().shape({key:n().string,value:n().oneOfType([n().string,n().number])})).isRequired,onTabClick:n().func.isRequired};const a=t}}]);